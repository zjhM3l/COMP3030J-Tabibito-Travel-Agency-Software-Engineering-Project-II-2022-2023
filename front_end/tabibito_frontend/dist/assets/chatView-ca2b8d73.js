import{U as e,V as t,W as n,X as i,Y as r,Z as o,$ as a,a0 as s,a1 as c,i as u,L as l,y as d,a2 as p,K as h,r as f,C as g,z as m,O as v,F as _,g as y,a3 as I,b as M,a4 as T,a5 as C,q as S,a6 as E,P as k,M as b,_ as D,o as w,c as A,e as R,t as L,m as O,R as N,d as P,G as U,T as x,n as G,p as F,j as V,a7 as q,a8 as B,S as H,f as j,w as K,k as z,l as W,a9 as Y,aa as $,a as J,ab as X,ac as Z,ad as Q,v as ee,Q as te,ae as ne,af as ie,ag as re,h as oe,ah as ae,ai as se,aj as ce,ak as ue,al as le,am as de,an as pe,ao as he,ap as fe,aq as ge,ar as me,as as ve,at as _e,au as ye,av as Ie,aw as Me,ax as Te,ay as Ce,az as Se,aA as Ee,aB as ke,aC as be,aD as De,aE as we,aF as Ae,aG as Re,aH as Le,aI as Oe,aJ as Ne,J as Pe}from"./index-5baf022e.js";import{N as Ue}from"./navigationBar-ac3b4d44.js";function xe(e){return(xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ge(o,a){if(e(2,arguments),!a||"object"!==xe(a))return new Date(NaN);var s=a.years?t(a.years):0,c=a.months?t(a.months):0,u=a.weeks?t(a.weeks):0,l=a.days?t(a.days):0,d=a.hours?t(a.hours):0,p=a.minutes?t(a.minutes):0,h=a.seconds?t(a.seconds):0,f=n(o),g=c||s?i(f,c+12*s):f,m=l||u?r(g,l+7*u):g,v=1e3*(h+60*(p+60*d));return new Date(m.getTime()+v)}function Fe(i,r){var a,s,c,u,l,d,p,h;e(1,arguments);var f=o(),g=t(null!==(a=null!==(s=null!==(c=null!==(u=null==r?void 0:r.weekStartsOn)&&void 0!==u?u:null==r||null===(l=r.locale)||void 0===l||null===(d=l.options)||void 0===d?void 0:d.weekStartsOn)&&void 0!==c?c:f.weekStartsOn)&&void 0!==s?s:null===(p=f.locale)||void 0===p||null===(h=p.options)||void 0===h?void 0:h.weekStartsOn)&&void 0!==a?a:0);if(!(g>=0&&g<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var m=n(i),v=m.getDay(),_=(v<g?7:0)+v-g;return m.setDate(m.getDate()-_),m.setHours(0,0,0,0),m}function Ve(t){return e(1,arguments),Fe(t,{weekStartsOn:1})}function qe(t){e(1,arguments);var i=function(t){e(1,arguments);var i=n(t),r=i.getFullYear(),o=new Date(0);o.setFullYear(r+1,0,4),o.setHours(0,0,0,0);var a=Ve(o),s=new Date(0);s.setFullYear(r,0,4),s.setHours(0,0,0,0);var c=Ve(s);return i.getTime()>=a.getTime()?r+1:i.getTime()>=c.getTime()?r:r-1}(t),r=new Date(0);return r.setFullYear(i,0,4),r.setHours(0,0,0,0),Ve(r)}function Be(t,i){e(2,arguments);var r=n(t),o=n(i);return r.getTime()>o.getTime()}function He(t,i){e(2,arguments);var r=n(t),o=n(i);return r.getTime()<o.getTime()}function je(i,r){e(2,arguments);var o=n(i),a=t(r);return o.setMilliseconds(a),o}function Ke(n,r){e(2,arguments);var o=t(r);return i(n,-o)}function ze(e){return(ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function We(n,i){if(e(2,arguments),!i||"object"!==ze(i))return new Date(NaN);var o=i.years?t(i.years):0,a=i.months?t(i.months):0,s=i.weeks?t(i.weeks):0,c=i.days?t(i.days):0,u=i.hours?t(i.hours):0,l=i.minutes?t(i.minutes):0,d=i.seconds?t(i.seconds):0,p=function(n,i){e(2,arguments);var o=t(i);return r(n,-o)}(Ke(n,a+12*o),c+7*s),h=1e3*(d+60*(l+60*u));return new Date(p.getTime()-h)}function Ye(){return"undefined"!=typeof navigator&&"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}}const $e="function"==typeof Proxy,Je="devtools-plugin:setup";let Xe,Ze;function Qe(){return void 0!==Xe||("undefined"!=typeof window&&window.performance?(Xe=!0,Ze=window.performance):"undefined"!=typeof global&&(null===(e=global.perf_hooks)||void 0===e?void 0:e.performance)?(Xe=!0,Ze=global.perf_hooks.performance):Xe=!1),Xe?Ze.now():Date.now();var e}class et{constructor(e,t){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=e,this.hook=t;const n={};if(e.settings)for(const o in e.settings){const t=e.settings[o];n[o]=t.defaultValue}const i=`__vue-devtools-plugin-settings__${e.id}`;let r=Object.assign({},n);try{const e=localStorage.getItem(i),t=JSON.parse(e);Object.assign(r,t)}catch(ok){}this.fallbacks={getSettings:()=>r,setSettings(e){try{localStorage.setItem(i,JSON.stringify(e))}catch(ok){}r=e},now:()=>Qe()},t&&t.on("plugin:settings:set",((e,t)=>{e===this.plugin.id&&this.fallbacks.setSettings(t)})),this.proxiedOn=new Proxy({},{get:(e,t)=>this.target?this.target.on[t]:(...e)=>{this.onQueue.push({method:t,args:e})}}),this.proxiedTarget=new Proxy({},{get:(e,t)=>this.target?this.target[t]:"on"===t?this.proxiedOn:Object.keys(this.fallbacks).includes(t)?(...e)=>(this.targetQueue.push({method:t,args:e,resolve:()=>{}}),this.fallbacks[t](...e)):(...e)=>new Promise((n=>{this.targetQueue.push({method:t,args:e,resolve:n})}))})}async setRealTarget(e){this.target=e;for(const t of this.onQueue)this.target.on[t.method](...t.args);for(const t of this.targetQueue)t.resolve(await this.target[t.method](...t.args))}}function nt(e,t){const n=e,i=Ye(),r=Ye().__VUE_DEVTOOLS_GLOBAL_HOOK__,o=$e&&n.enableEarlyProxy;if(!r||!i.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__&&o){const e=o?new et(n,r):null;(i.__VUE_DEVTOOLS_PLUGINS__=i.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:n,setupFn:t,proxy:e}),e&&t(e.proxiedTarget)}else r.emit(Je,e,t)}const it={theme:"dark"};const rt={name:"TUITheme",plugin:function(e){e.setCommonStore(it)},install:function(e){}},ot="undefined"!=typeof window,at="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,st=e=>at?Symbol(e):e,ct=(e,t,n)=>ut({l:e,k:t,s:n}),ut=e=>JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029").replace(/\u0027/g,"\\u0027"),lt=e=>"number"==typeof e&&isFinite(e),dt=e=>"[object Date]"===bt(e),pt=e=>"[object RegExp]"===bt(e),ht=e=>Dt(e)&&0===Object.keys(e).length;
/*!
  * shared v9.2.0-beta.32
  * (c) 2022 kazuya kawaguchi
  * Released under the MIT License.
  */function ft(e,t){}const gt=Object.assign;let mt;const vt=()=>mt||(mt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{});function _t(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}const yt=Object.prototype.hasOwnProperty;function It(e,t){return yt.call(e,t)}const Mt=Array.isArray,Tt=e=>"function"==typeof e,Ct=e=>"string"==typeof e,St=e=>"boolean"==typeof e,Et=e=>null!==e&&"object"==typeof e,kt=Object.prototype.toString,bt=e=>kt.call(e),Dt=e=>"[object Object]"===bt(e),wt={EXPECTED_TOKEN:1,INVALID_TOKEN_IN_PLACEHOLDER:2,UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER:3,UNKNOWN_ESCAPE_SEQUENCE:4,INVALID_UNICODE_ESCAPE_SEQUENCE:5,UNBALANCED_CLOSING_BRACE:6,UNTERMINATED_CLOSING_BRACE:7,EMPTY_PLACEHOLDER:8,NOT_ALLOW_NEST_PLACEHOLDER:9,INVALID_LINKED_FORMAT:10,MUST_HAVE_MESSAGES_IN_PLURAL:11,UNEXPECTED_EMPTY_LINKED_MODIFIER:12,UNEXPECTED_EMPTY_LINKED_KEY:13,UNEXPECTED_LEXICAL_ANALYSIS:14,__EXTEND_POINT__:15};function At(e,t,n={}){const{domain:i,messages:r,args:o}=n,a=new SyntaxError(String(e));return a.code=e,t&&(a.location=t),a.domain=i,a}function Rt(e){throw e}function Lt(e,t,n){const i={start:e,end:t};return null!=n&&(i.source=n),i}const Ot=" ",Nt="\r",Pt="\n",Ut=String.fromCharCode(8232),xt=String.fromCharCode(8233);function Gt(e){const t=e;let n=0,i=1,r=1,o=0;const a=e=>t[e]===Nt&&t[e+1]===Pt,s=e=>t[e]===xt,c=e=>t[e]===Ut,u=e=>a(e)||(e=>t[e]===Pt)(e)||s(e)||c(e),l=e=>a(e)||s(e)||c(e)?Pt:t[e];function d(){return o=0,u(n)&&(i++,r=0),a(n)&&n++,n++,r++,t[n]}return{index:()=>n,line:()=>i,column:()=>r,peekOffset:()=>o,charAt:l,currentChar:()=>l(n),currentPeek:()=>l(n+o),next:d,peek:function(){return a(n+o)&&o++,o++,t[n+o]},reset:function(){n=0,i=1,r=1,o=0},resetPeek:function(e=0){o=e},skipToPeek:function(){const e=n+o;for(;e!==n;)d();o=0}}}const Ft=void 0,Vt="'",qt="tokenizer";function Bt(e,t={}){const n=!1!==t.location,i=Gt(e),r=()=>i.index(),o=()=>{return e=i.line(),t=i.column(),n=i.index(),{line:e,column:t,offset:n};var e,t,n},a=o(),s=r(),c={currentType:14,offset:s,startLoc:a,endLoc:a,lastType:14,lastOffset:s,lastStartLoc:a,lastEndLoc:a,braceNest:0,inLinked:!1,text:""},u=()=>c,{onError:l}=t;function d(e,t,n,...i){const r=u();if(t.column+=n,t.offset+=n,l){const n=At(e,Lt(r.startLoc,t),{domain:qt,args:i});l(n)}}function p(e,t,i){e.endLoc=o(),e.currentType=t;const r={type:t};return n&&(r.loc=Lt(e.startLoc,e.endLoc)),null!=i&&(r.value=i),r}const h=e=>p(e,14);function f(e,t){return e.currentChar()===t?(e.next(),t):(d(wt.EXPECTED_TOKEN,o(),0,t),"")}function g(e){let t="";for(;e.currentPeek()===Ot||e.currentPeek()===Pt;)t+=e.currentPeek(),e.peek();return t}function m(e){const t=g(e);return e.skipToPeek(),t}function v(e){if(e===Ft)return!1;const t=e.charCodeAt(0);return t>=97&&t<=122||t>=65&&t<=90||95===t}function _(e,t){const{currentType:n}=t;if(2!==n)return!1;g(e);const i=function(e){if(e===Ft)return!1;const t=e.charCodeAt(0);return t>=48&&t<=57}("-"===e.currentPeek()?e.peek():e.currentPeek());return e.resetPeek(),i}function y(e){g(e);const t="|"===e.currentPeek();return e.resetPeek(),t}function I(e,t=!0){const n=(t=!1,i="",r=!1)=>{const o=e.currentPeek();return"{"===o?"%"!==i&&t:"@"!==o&&o?"%"===o?(e.peek(),n(t,"%",!0)):"|"===o?!("%"!==i&&!r)||!(i===Ot||i===Pt):o===Ot?(e.peek(),n(!0,Ot,r)):o!==Pt||(e.peek(),n(!0,Pt,r)):"%"===i||t},i=n();return t&&e.resetPeek(),i}function M(e,t){const n=e.currentChar();return n===Ft?Ft:t(n)?(e.next(),n):null}function T(e){return M(e,(e=>{const t=e.charCodeAt(0);return t>=97&&t<=122||t>=65&&t<=90||t>=48&&t<=57||95===t||36===t}))}function C(e){return M(e,(e=>{const t=e.charCodeAt(0);return t>=48&&t<=57}))}function S(e){return M(e,(e=>{const t=e.charCodeAt(0);return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102}))}function E(e){let t="",n="";for(;t=C(e);)n+=t;return n}function k(e){const t=e.currentChar();switch(t){case"\\":case"'":return e.next(),`\\${t}`;case"u":return b(e,t,4);case"U":return b(e,t,6);default:return d(wt.UNKNOWN_ESCAPE_SEQUENCE,o(),0,t),""}}function b(e,t,n){f(e,t);let i="";for(let r=0;r<n;r++){const n=S(e);if(!n){d(wt.INVALID_UNICODE_ESCAPE_SEQUENCE,o(),0,`\\${t}${i}${e.currentChar()}`);break}i+=n}return`\\${t}${i}`}function D(e){m(e);const t=f(e,"|");return m(e),t}function w(e,t){let n=null;switch(e.currentChar()){case"{":return t.braceNest>=1&&d(wt.NOT_ALLOW_NEST_PLACEHOLDER,o(),0),e.next(),n=p(t,2,"{"),m(e),t.braceNest++,n;case"}":return t.braceNest>0&&2===t.currentType&&d(wt.EMPTY_PLACEHOLDER,o(),0),e.next(),n=p(t,3,"}"),t.braceNest--,t.braceNest>0&&m(e),t.inLinked&&0===t.braceNest&&(t.inLinked=!1),n;case"@":return t.braceNest>0&&d(wt.UNTERMINATED_CLOSING_BRACE,o(),0),n=A(e,t)||h(t),t.braceNest=0,n;default:let i=!0,r=!0,a=!0;if(y(e))return t.braceNest>0&&d(wt.UNTERMINATED_CLOSING_BRACE,o(),0),n=p(t,1,D(e)),t.braceNest=0,t.inLinked=!1,n;if(t.braceNest>0&&(5===t.currentType||6===t.currentType||7===t.currentType))return d(wt.UNTERMINATED_CLOSING_BRACE,o(),0),t.braceNest=0,R(e,t);if(i=function(e,t){const{currentType:n}=t;if(2!==n)return!1;g(e);const i=v(e.currentPeek());return e.resetPeek(),i}(e,t))return n=p(t,5,function(e){m(e);let t="",n="";for(;t=T(e);)n+=t;return e.currentChar()===Ft&&d(wt.UNTERMINATED_CLOSING_BRACE,o(),0),n}(e)),m(e),n;if(r=_(e,t))return n=p(t,6,function(e){m(e);let t="";return"-"===e.currentChar()?(e.next(),t+=`-${E(e)}`):t+=E(e),e.currentChar()===Ft&&d(wt.UNTERMINATED_CLOSING_BRACE,o(),0),t}(e)),m(e),n;if(a=function(e,t){const{currentType:n}=t;if(2!==n)return!1;g(e);const i=e.currentPeek()===Vt;return e.resetPeek(),i}(e,t))return n=p(t,7,function(e){m(e),f(e,"'");let t="",n="";const i=e=>e!==Vt&&e!==Pt;for(;t=M(e,i);)n+="\\"===t?k(e):t;const r=e.currentChar();return r===Pt||r===Ft?(d(wt.UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER,o(),0),r===Pt&&(e.next(),f(e,"'")),n):(f(e,"'"),n)}(e)),m(e),n;if(!i&&!r&&!a)return n=p(t,13,function(e){m(e);let t="",n="";const i=e=>"{"!==e&&"}"!==e&&e!==Ot&&e!==Pt;for(;t=M(e,i);)n+=t;return n}(e)),d(wt.INVALID_TOKEN_IN_PLACEHOLDER,o(),0,n.value),m(e),n}return n}function A(e,t){const{currentType:n}=t;let i=null;const r=e.currentChar();switch(8!==n&&9!==n&&12!==n&&10!==n||r!==Pt&&r!==Ot||d(wt.INVALID_LINKED_FORMAT,o(),0),r){case"@":return e.next(),i=p(t,8,"@"),t.inLinked=!0,i;case".":return m(e),e.next(),p(t,9,".");case":":return m(e),e.next(),p(t,10,":");default:return y(e)?(i=p(t,1,D(e)),t.braceNest=0,t.inLinked=!1,i):function(e,t){const{currentType:n}=t;if(8!==n)return!1;g(e);const i="."===e.currentPeek();return e.resetPeek(),i}(e,t)||function(e,t){const{currentType:n}=t;if(8!==n&&12!==n)return!1;g(e);const i=":"===e.currentPeek();return e.resetPeek(),i}(e,t)?(m(e),A(e,t)):function(e,t){const{currentType:n}=t;if(9!==n)return!1;g(e);const i=v(e.currentPeek());return e.resetPeek(),i}(e,t)?(m(e),p(t,12,function(e){let t="",n="";for(;t=T(e);)n+=t;return n}(e))):function(e,t){const{currentType:n}=t;if(10!==n)return!1;const i=()=>{const t=e.currentPeek();return"{"===t?v(e.peek()):!("@"===t||"%"===t||"|"===t||":"===t||"."===t||t===Ot||!t)&&(t===Pt?(e.peek(),i()):v(t))},r=i();return e.resetPeek(),r}(e,t)?(m(e),"{"===r?w(e,t)||i:p(t,11,function(e){const t=(n=!1,i)=>{const r=e.currentChar();return"{"!==r&&"%"!==r&&"@"!==r&&"|"!==r&&r?r===Ot?i:r===Pt?(i+=r,e.next(),t(n,i)):(i+=r,e.next(),t(!0,i)):i};return t(!1,"")}(e))):(8===n&&d(wt.INVALID_LINKED_FORMAT,o(),0),t.braceNest=0,t.inLinked=!1,R(e,t))}}function R(e,t){let n={type:14};if(t.braceNest>0)return w(e,t)||h(t);if(t.inLinked)return A(e,t)||h(t);const i=e.currentChar();switch(i){case"{":return w(e,t)||h(t);case"}":return d(wt.UNBALANCED_CLOSING_BRACE,o(),0),e.next(),p(t,3,"}");case"@":return A(e,t)||h(t);default:if(y(e))return n=p(t,1,D(e)),t.braceNest=0,t.inLinked=!1,n;if(I(e))return p(t,0,function(e){let t="";for(;;){const n=e.currentChar();if("{"===n||"}"===n||"@"===n||"|"===n||!n)break;if("%"===n){if(!I(e))break;t+=n,e.next()}else if(n===Ot||n===Pt)if(I(e))t+=n,e.next();else{if(y(e))break;t+=n,e.next()}else t+=n,e.next()}return t}(e));if("%"===i)return e.next(),p(t,4,"%")}return n}return{nextToken:function(){const{currentType:e,offset:t,startLoc:n,endLoc:a}=c;return c.lastType=e,c.lastOffset=t,c.lastStartLoc=n,c.lastEndLoc=a,c.offset=r(),c.startLoc=o(),i.currentChar()===Ft?p(c,14):R(i,c)},currentOffset:r,currentPosition:o,context:u}}const Ht="parser",jt=/(?:\\\\|\\'|\\u([0-9a-fA-F]{4})|\\U([0-9a-fA-F]{6}))/g;function Kt(e,t,n){switch(e){case"\\\\":return"\\";case"\\'":return"'";default:{const e=parseInt(t||n,16);return e<=55295||e>=57344?String.fromCodePoint(e):"�"}}}function zt(e={}){const t=!1!==e.location,{onError:n}=e;function i(e,t,i,r,...o){const a=e.currentPosition();if(a.offset+=r,a.column+=r,n){const e=At(t,Lt(i,a),{domain:Ht,args:o});n(e)}}function r(e,n,i){const r={type:e,start:n,end:n};return t&&(r.loc={start:i,end:i}),r}function o(e,n,i,r){e.end=n,r&&(e.type=r),t&&e.loc&&(e.loc.end=i)}function a(e,t){const n=e.context(),i=r(3,n.offset,n.startLoc);return i.value=t,o(i,e.currentOffset(),e.currentPosition()),i}function s(e,t){const n=e.context(),{lastOffset:i,lastStartLoc:a}=n,s=r(5,i,a);return s.index=parseInt(t,10),e.nextToken(),o(s,e.currentOffset(),e.currentPosition()),s}function c(e,t){const n=e.context(),{lastOffset:i,lastStartLoc:a}=n,s=r(4,i,a);return s.key=t,e.nextToken(),o(s,e.currentOffset(),e.currentPosition()),s}function u(e,t){const n=e.context(),{lastOffset:i,lastStartLoc:a}=n,s=r(9,i,a);return s.value=t.replace(jt,Kt),e.nextToken(),o(s,e.currentOffset(),e.currentPosition()),s}function l(e){const t=e.context(),n=r(6,t.offset,t.startLoc);let a=e.nextToken();if(9===a.type){const t=function(e){const t=e.nextToken(),n=e.context(),{lastOffset:a,lastStartLoc:s}=n,c=r(8,a,s);return 12!==t.type?(i(e,wt.UNEXPECTED_EMPTY_LINKED_MODIFIER,n.lastStartLoc,0),c.value="",o(c,a,s),{nextConsumeToken:t,node:c}):(null==t.value&&i(e,wt.UNEXPECTED_LEXICAL_ANALYSIS,n.lastStartLoc,0,Wt(t)),c.value=t.value||"",o(c,e.currentOffset(),e.currentPosition()),{node:c})}(e);n.modifier=t.node,a=t.nextConsumeToken||e.nextToken()}switch(10!==a.type&&i(e,wt.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,Wt(a)),a=e.nextToken(),2===a.type&&(a=e.nextToken()),a.type){case 11:null==a.value&&i(e,wt.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,Wt(a)),n.key=function(e,t){const n=e.context(),i=r(7,n.offset,n.startLoc);return i.value=t,o(i,e.currentOffset(),e.currentPosition()),i}(e,a.value||"");break;case 5:null==a.value&&i(e,wt.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,Wt(a)),n.key=c(e,a.value||"");break;case 6:null==a.value&&i(e,wt.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,Wt(a)),n.key=s(e,a.value||"");break;case 7:null==a.value&&i(e,wt.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,Wt(a)),n.key=u(e,a.value||"");break;default:i(e,wt.UNEXPECTED_EMPTY_LINKED_KEY,t.lastStartLoc,0);const l=e.context(),d=r(7,l.offset,l.startLoc);return d.value="",o(d,l.offset,l.startLoc),n.key=d,o(n,l.offset,l.startLoc),{nextConsumeToken:a,node:n}}return o(n,e.currentOffset(),e.currentPosition()),{node:n}}function d(e){const t=e.context(),n=r(2,1===t.currentType?e.currentOffset():t.offset,1===t.currentType?t.endLoc:t.startLoc);n.items=[];let d=null;do{const r=d||e.nextToken();switch(d=null,r.type){case 0:null==r.value&&i(e,wt.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,Wt(r)),n.items.push(a(e,r.value||""));break;case 6:null==r.value&&i(e,wt.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,Wt(r)),n.items.push(s(e,r.value||""));break;case 5:null==r.value&&i(e,wt.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,Wt(r)),n.items.push(c(e,r.value||""));break;case 7:null==r.value&&i(e,wt.UNEXPECTED_LEXICAL_ANALYSIS,t.lastStartLoc,0,Wt(r)),n.items.push(u(e,r.value||""));break;case 8:const o=l(e);n.items.push(o.node),d=o.nextConsumeToken||null}}while(14!==t.currentType&&1!==t.currentType);return o(n,1===t.currentType?t.lastOffset:e.currentOffset(),1===t.currentType?t.lastEndLoc:e.currentPosition()),n}function p(e){const t=e.context(),{offset:n,startLoc:a}=t,s=d(e);return 14===t.currentType?s:function(e,t,n,a){const s=e.context();let c=0===a.items.length;const u=r(1,t,n);u.cases=[],u.cases.push(a);do{const t=d(e);c||(c=0===t.items.length),u.cases.push(t)}while(14!==s.currentType);return c&&i(e,wt.MUST_HAVE_MESSAGES_IN_PLURAL,n,0),o(u,e.currentOffset(),e.currentPosition()),u}(e,n,a,s)}return{parse:function(n){const a=Bt(n,gt({},e)),s=a.context(),c=r(0,s.offset,s.startLoc);return t&&c.loc&&(c.loc.source=n),c.body=p(a),14!==s.currentType&&i(a,wt.UNEXPECTED_LEXICAL_ANALYSIS,s.lastStartLoc,0,n[s.offset]||""),o(c,a.currentOffset(),a.currentPosition()),c}}}function Wt(e){if(14===e.type)return"EOF";const t=(e.value||"").replace(/\r?\n/gu,"\\n");return t.length>10?t.slice(0,9)+"…":t}function Yt(e,t){for(let n=0;n<e.length;n++)$t(e[n],t)}function $t(e,t){switch(e.type){case 1:Yt(e.cases,t),t.helper("plural");break;case 2:Yt(e.items,t);break;case 6:$t(e.key,t),t.helper("linked");break;case 5:t.helper("interpolate"),t.helper("list");break;case 4:t.helper("interpolate"),t.helper("named")}}function Jt(e,t={}){const n=function(e,t={}){const n={ast:e,helpers:new Set};return{context:()=>n,helper:e=>(n.helpers.add(e),e)}}(e);n.helper("normalize"),e.body&&$t(e.body,n);const i=n.context();e.helpers=Array.from(i.helpers)}function Xt(e,t){const{helper:n}=e;switch(t.type){case 0:!function(e,t){t.body?Xt(e,t.body):e.push("null")}(e,t);break;case 1:!function(e,t){const{helper:n,needIndent:i}=e;if(t.cases.length>1){e.push(`${n("plural")}([`),e.indent(i());const r=t.cases.length;for(let n=0;n<r&&(Xt(e,t.cases[n]),n!==r-1);n++)e.push(", ");e.deindent(i()),e.push("])")}}(e,t);break;case 2:!function(e,t){const{helper:n,needIndent:i}=e;e.push(`${n("normalize")}([`),e.indent(i());const r=t.items.length;for(let o=0;o<r&&(Xt(e,t.items[o]),o!==r-1);o++)e.push(", ");e.deindent(i()),e.push("])")}(e,t);break;case 6:!function(e,t){const{helper:n}=e;e.push(`${n("linked")}(`),Xt(e,t.key),t.modifier&&(e.push(", "),Xt(e,t.modifier)),e.push(")")}(e,t);break;case 8:case 7:case 9:case 3:e.push(JSON.stringify(t.value),t);break;case 5:e.push(`${n("interpolate")}(${n("list")}(${t.index}))`,t);break;case 4:e.push(`${n("interpolate")}(${n("named")}(${JSON.stringify(t.key)}))`,t)}}const Zt=(e,t={})=>{const n=Ct(t.mode)?t.mode:"normal",i=Ct(t.filename)?t.filename:"message.intl",r=!!t.sourceMap,o=null!=t.breakLineCode?t.breakLineCode:"arrow"===n?";":"\n",a=t.needIndent?t.needIndent:"arrow"!==n,s=e.helpers||[],c=function(e,t){const{sourceMap:n,filename:i,breakLineCode:r,needIndent:o}=t,a={source:e.loc.source,filename:i,code:"",column:1,line:1,offset:0,map:void 0,breakLineCode:r,needIndent:o,indentLevel:0};function s(e,t){a.code+=e}function c(e,t=!0){const n=t?r:"";s(o?n+"  ".repeat(e):n)}return{context:()=>a,push:s,indent:function(e=!0){const t=++a.indentLevel;e&&c(t)},deindent:function(e=!0){const t=--a.indentLevel;e&&c(t)},newline:function(){c(a.indentLevel)},helper:e=>`_${e}`,needIndent:()=>a.needIndent}}(e,{mode:n,filename:i,sourceMap:r,breakLineCode:o,needIndent:a});c.push("normal"===n?"function __msg__ (ctx) {":"(ctx) => {"),c.indent(a),s.length>0&&(c.push(`const { ${s.map((e=>`${e}: _${e}`)).join(", ")} } = ctx`),c.newline()),c.push("return "),Xt(c,e),c.deindent(a),c.push("}");const{code:u,map:l}=c.context();return{ast:e,code:u,map:l?l.toJSON():void 0}};
/*!
  * devtools-if v9.2.0-beta.32
  * (c) 2022 kazuya kawaguchi
  * Released under the MIT License.
  */
const Qt={I18nInit:"i18n:init",FunctionTranslate:"function:translate"},en=[];
/*!
  * core-base v9.2.0-beta.32
  * (c) 2022 kazuya kawaguchi
  * Released under the MIT License.
  */en[0]={w:[0],i:[3,0],"[":[4],o:[7]},en[1]={w:[1],".":[2],"[":[4],o:[7]},en[2]={w:[2],i:[3,0],0:[3,0]},en[3]={i:[3,0],0:[3,0],w:[1,1],".":[2,1],"[":[4,1],o:[7,1]},en[4]={"'":[5,0],'"':[6,0],"[":[4,2],"]":[1,3],o:8,l:[4,0]},en[5]={"'":[4,0],o:8,l:[5,0]},en[6]={'"':[4,0],o:8,l:[6,0]};const tn=/^\s?(?:true|false|-?[\d.]+|'[^']*'|"[^"]*")\s?$/;function nn(e){if(null==e)return"o";switch(e.charCodeAt(0)){case 91:case 93:case 46:case 34:case 39:return e;case 95:case 36:case 45:return"i";case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"w"}return"i"}function rn(e){const t=e.trim();return("0"!==e.charAt(0)||!isNaN(parseInt(e)))&&(n=t,tn.test(n)?function(e){const t=e.charCodeAt(0);return t!==e.charCodeAt(e.length-1)||34!==t&&39!==t?e:e.slice(1,-1)}(t):"*"+t);var n}const on=new Map;function an(e,t){return Et(e)?e[t]:null}const sn=e=>e,cn=e=>"",un="text",ln=e=>0===e.length?"":e.join(""),dn=e=>null==e?"":Mt(e)||Dt(e)&&e.toString===kt?JSON.stringify(e,null,2):String(e);function pn(e,t){return e=Math.abs(e),2===t?e?e>1?1:0:1:e?Math.min(e,2):0}function hn(e={}){const t=e.locale,n=function(e){const t=lt(e.pluralIndex)?e.pluralIndex:-1;return e.named&&(lt(e.named.count)||lt(e.named.n))?lt(e.named.count)?e.named.count:lt(e.named.n)?e.named.n:t:t}(e),i=Et(e.pluralRules)&&Ct(t)&&Tt(e.pluralRules[t])?e.pluralRules[t]:pn,r=Et(e.pluralRules)&&Ct(t)&&Tt(e.pluralRules[t])?pn:void 0,o=e.list||[],a=e.named||{};lt(e.pluralIndex)&&function(e,t){t.count||(t.count=e),t.n||(t.n=e)}(n,a);function s(t){const n=Tt(e.messages)?e.messages(t):!!Et(e.messages)&&e.messages[t];return n||(e.parent?e.parent.message(t):cn)}const c=Dt(e.processor)&&Tt(e.processor.normalize)?e.processor.normalize:ln,u=Dt(e.processor)&&Tt(e.processor.interpolate)?e.processor.interpolate:dn,l={list:e=>o[e],named:e=>a[e],plural:e=>e[i(n,e.length,r)],linked:(t,n)=>{const i=s(t)(l);return Ct(n)?(r=n,e.modifiers?e.modifiers[r]:sn)(i):i;var r},message:s,type:Dt(e.processor)&&Ct(e.processor.type)?e.processor.type:un,interpolate:u,normalize:c};return l}let fn=null;const gn=mn(Qt.FunctionTranslate);function mn(e){return t=>fn&&fn.emit(e,t)}function vn(e,t,n){return[...new Set([n,...Mt(t)?t:Et(t)?Object.keys(t):Ct(t)?[t]:[n]])]}function _n(e,t,n){const i=Ct(n)?n:Sn,r=e;r.__localeChainCache||(r.__localeChainCache=new Map);let o=r.__localeChainCache.get(i);if(!o){o=[];let e=[n];for(;Mt(e);)e=yn(o,e,t);const a=Mt(t)||!Dt(t)?t:t.default?t.default:null;e=Ct(a)?[a]:a,Mt(e)&&yn(o,e,!1),r.__localeChainCache.set(i,o)}return o}function yn(e,t,n){let i=!0;for(let r=0;r<t.length&&St(i);r++){const o=t[r];Ct(o)&&(i=In(e,t[r],n))}return i}function In(e,t,n){let i;const r=t.split("-");do{i=Mn(e,r.join("-"),n),r.splice(-1,1)}while(r.length&&!0===i);return i}function Mn(e,t,n){let i=!1;if(!e.includes(t)&&(i=!0,t)){i="!"!==t[t.length-1];const r=t.replace(/!/g,"");e.push(r),(Mt(n)||Dt(n))&&n[r]&&(i=n[r])}return i}const Tn="9.2.0-beta.32",Cn=-1,Sn="en-US",En="";let kn,bn,Dn;let wn=null;const An=e=>{wn=e},Rn=()=>wn;let Ln=null;const On=e=>{Ln=e},Nn=()=>Ln;let Pn=0;function Un(e={}){const t=Ct(e.version)?e.version:Tn,n=Ct(e.locale)?e.locale:Sn,i=Mt(e.fallbackLocale)||Dt(e.fallbackLocale)||Ct(e.fallbackLocale)||!1===e.fallbackLocale?e.fallbackLocale:n,r=Dt(e.messages)?e.messages:{[n]:{}},o=Dt(e.datetimeFormats)?e.datetimeFormats:{[n]:{}},a=Dt(e.numberFormats)?e.numberFormats:{[n]:{}},s=gt({},e.modifiers||{},{upper:e=>Ct(e)?e.toUpperCase():e,lower:e=>Ct(e)?e.toLowerCase():e,capitalize:e=>Ct(e)?`${e.charAt(0).toLocaleUpperCase()}${e.substr(1)}`:e}),c=e.pluralRules||{},u=Tt(e.missing)?e.missing:null,l=!St(e.missingWarn)&&!pt(e.missingWarn)||e.missingWarn,d=!St(e.fallbackWarn)&&!pt(e.fallbackWarn)||e.fallbackWarn,p=!!e.fallbackFormat,h=!!e.unresolving,f=Tt(e.postTranslation)?e.postTranslation:null,g=Dt(e.processor)?e.processor:null,m=!St(e.warnHtmlMessage)||e.warnHtmlMessage,v=!!e.escapeParameter,_=Tt(e.messageCompiler)?e.messageCompiler:kn,y=Tt(e.messageResolver)?e.messageResolver:bn||an,I=Tt(e.localeFallbacker)?e.localeFallbacker:Dn||vn,M=Et(e.fallbackContext)?e.fallbackContext:void 0,T=Tt(e.onWarn)?e.onWarn:ft,C=e,S=Et(C.__datetimeFormatters)?C.__datetimeFormatters:new Map,E=Et(C.__numberFormatters)?C.__numberFormatters:new Map,k=Et(C.__meta)?C.__meta:{};Pn++;const b={version:t,cid:Pn,locale:n,fallbackLocale:i,messages:r,modifiers:s,pluralRules:c,missing:u,missingWarn:l,fallbackWarn:d,fallbackFormat:p,unresolving:h,postTranslation:f,processor:g,warnHtmlMessage:m,escapeParameter:v,messageCompiler:_,messageResolver:y,localeFallbacker:I,fallbackContext:M,onWarn:T,__meta:k};return b.datetimeFormats=o,b.numberFormats=a,b.__datetimeFormatters=S,b.__numberFormatters=E,__INTLIFY_PROD_DEVTOOLS__&&function(e,t,n){fn&&fn.emit(Qt.I18nInit,{timestamp:Date.now(),i18n:e,version:t,meta:n})}(b,t,k),b}function xn(e,t,n,i,r){const{missing:o,onWarn:a}=e;if(null!==o){const i=o(e,n,t,r);return Ct(i)?i:t}return t}function Gn(e,t,n){e.__localeChainCache=new Map,e.localeFallbacker(e,n,t)}const Fn=e=>e;let Vn=Object.create(null);let qn=wt.__EXTEND_POINT__;const Bn=()=>++qn,Hn={INVALID_ARGUMENT:qn,INVALID_DATE_ARGUMENT:Bn(),INVALID_ISO_DATE_ARGUMENT:Bn(),__EXTEND_POINT__:Bn()};function jn(e){return At(e,null,void 0)}const Kn=()=>"",zn=e=>Tt(e);function Wn(e,...t){const{fallbackFormat:n,postTranslation:i,unresolving:r,messageCompiler:o,fallbackLocale:a,messages:s}=e,[c,u]=Jn(...t),l=St(u.missingWarn)?u.missingWarn:e.missingWarn,d=St(u.fallbackWarn)?u.fallbackWarn:e.fallbackWarn,p=St(u.escapeParameter)?u.escapeParameter:e.escapeParameter,h=!!u.resolvedMessage,f=Ct(u.default)||St(u.default)?St(u.default)?c:u.default:n?o?c:()=>c:"",g=n||""!==f,m=Ct(u.locale)?u.locale:e.locale;p&&function(e){Mt(e.list)?e.list=e.list.map((e=>Ct(e)?_t(e):e)):Et(e.named)&&Object.keys(e.named).forEach((t=>{Ct(e.named[t])&&(e.named[t]=_t(e.named[t]))}))}(u);let[v,_,y]=h?[c,m,s[m]||{}]:Yn(e,c,m,a,d,l),I=v,M=c;if(h||Ct(I)||zn(I)||g&&(I=f,M=I),!(h||(Ct(I)||zn(I))&&Ct(_)))return r?Cn:c;let T=!1;const C=zn(I)?I:$n(e,c,_,I,M,(()=>{T=!0}));if(T)return I;const S=function(e,t,n,i){const{modifiers:r,pluralRules:o,messageResolver:a,fallbackLocale:s,fallbackWarn:c,missingWarn:u,fallbackContext:l}=e,d=i=>{let r=a(n,i);if(null==r&&l){const[,,e]=Yn(l,i,t,s,c,u);r=a(e,i)}if(Ct(r)){let n=!1;const o=$n(e,i,t,r,i,(()=>{n=!0}));return n?Kn:o}return zn(r)?r:Kn},p={locale:t,modifiers:r,pluralRules:o,messages:d};e.processor&&(p.processor=e.processor);i.list&&(p.list=i.list);i.named&&(p.named=i.named);lt(i.plural)&&(p.pluralIndex=i.plural);return p}(e,_,y,u),E=function(e,t,n){const i=t(n);return i}(0,C,hn(S)),k=i?i(E):E;if(__INTLIFY_PROD_DEVTOOLS__){const t={timestamp:Date.now(),key:Ct(c)?c:zn(I)?I.key:"",locale:_||(zn(I)?I.locale:""),format:Ct(I)?I:zn(I)?I.source:"",message:k};t.meta=gt({},e.__meta,Rn()||{}),gn(t)}return k}function Yn(e,t,n,i,r,o){const{messages:a,onWarn:s,messageResolver:c,localeFallbacker:u}=e,l=u(e,i,n);let d,p={},h=null;for(let f=0;f<l.length&&(d=l[f],p=a[d]||{},null===(h=c(p,t))&&(h=p[t]),!Ct(h)&&!Tt(h));f++){const n=xn(e,t,d,0,"translate");n!==t&&(h=n)}return[h,d,p]}function $n(e,t,n,i,r,o){const{messageCompiler:a,warnHtmlMessage:s}=e;if(zn(i)){const e=i;return e.locale=e.locale||n,e.key=e.key||t,e}const c=a(i,function(e,t,n,i,r,o){return{warnHtmlMessage:r,onError:e=>{throw o&&o(e),e},onCacheKey:e=>ct(t,n,e)}}(0,n,r,0,s,o));return c.locale=n,c.key=t,c.source=i,c}function Jn(...e){const[t,n,i]=e,r={};if(!Ct(t)&&!lt(t)&&!zn(t))throw jn(Hn.INVALID_ARGUMENT);const o=lt(t)?String(t):(zn(t),t);return lt(n)?r.plural=n:Ct(n)?r.default=n:Dt(n)&&!ht(n)?r.named=n:Mt(n)&&(r.list=n),lt(i)?r.plural=i:Ct(i)?r.default=i:Dt(i)&&gt(r,i),[o,r]}function Xn(e,...t){const{datetimeFormats:n,unresolving:i,fallbackLocale:r,onWarn:o,localeFallbacker:a}=e,{__datetimeFormatters:s}=e,[c,u,l,d]=Zn(...t);St(l.missingWarn)?l.missingWarn:e.missingWarn;St(l.fallbackWarn)?l.fallbackWarn:e.fallbackWarn;const p=!!l.part,h=Ct(l.locale)?l.locale:e.locale,f=a(e,r,h);if(!Ct(c)||""===c)return new Intl.DateTimeFormat(h).format(u);let g,m={},v=null;for(let I=0;I<f.length&&(g=f[I],m=n[g]||{},v=m[c],!Dt(v));I++)xn(e,c,g,0,"datetime format");if(!Dt(v)||!Ct(g))return i?Cn:c;let _=`${g}__${c}`;ht(d)||(_=`${_}__${JSON.stringify(d)}`);let y=s.get(_);return y||(y=new Intl.DateTimeFormat(g,gt({},v,d)),s.set(_,y)),p?y.formatToParts(u):y.format(u)}function Zn(...e){const[t,n,i,r]=e;let o,a={},s={};if(Ct(t)){const e=t.match(/(\d{4}-\d{2}-\d{2})(T|\s)?(.*)/);if(!e)throw jn(Hn.INVALID_ISO_DATE_ARGUMENT);const n=e[3]?e[3].trim().startsWith("T")?`${e[1].trim()}${e[3].trim()}`:`${e[1].trim()}T${e[3].trim()}`:e[1].trim();o=new Date(n);try{o.toISOString()}catch(ok){throw jn(Hn.INVALID_ISO_DATE_ARGUMENT)}}else if(dt(t)){if(isNaN(t.getTime()))throw jn(Hn.INVALID_DATE_ARGUMENT);o=t}else{if(!lt(t))throw jn(Hn.INVALID_ARGUMENT);o=t}return Ct(n)?a.key=n:Dt(n)&&(a=n),Ct(i)?a.locale=i:Dt(i)&&(s=i),Dt(r)&&(s=r),[a.key||"",o,a,s]}function Qn(e,t,n){const i=e;for(const r in n){const e=`${t}__${r}`;i.__datetimeFormatters.has(e)&&i.__datetimeFormatters.delete(e)}}function ei(e,...t){const{numberFormats:n,unresolving:i,fallbackLocale:r,onWarn:o,localeFallbacker:a}=e,{__numberFormatters:s}=e,[c,u,l,d]=ti(...t);St(l.missingWarn)?l.missingWarn:e.missingWarn;St(l.fallbackWarn)?l.fallbackWarn:e.fallbackWarn;const p=!!l.part,h=Ct(l.locale)?l.locale:e.locale,f=a(e,r,h);if(!Ct(c)||""===c)return new Intl.NumberFormat(h).format(u);let g,m={},v=null;for(let I=0;I<f.length&&(g=f[I],m=n[g]||{},v=m[c],!Dt(v));I++)xn(e,c,g,0,"number format");if(!Dt(v)||!Ct(g))return i?Cn:c;let _=`${g}__${c}`;ht(d)||(_=`${_}__${JSON.stringify(d)}`);let y=s.get(_);return y||(y=new Intl.NumberFormat(g,gt({},v,d)),s.set(_,y)),p?y.formatToParts(u):y.format(u)}function ti(...e){const[t,n,i,r]=e;let o={},a={};if(!lt(t))throw jn(Hn.INVALID_ARGUMENT);const s=t;return Ct(n)?o.key=n:Dt(n)&&(o=n),Ct(i)?o.locale=i:Dt(i)&&(a=i),Dt(r)&&(a=r),[o.key||"",s,o,a]}function ni(e,t,n){const i=e;for(const r in n){const e=`${t}__${r}`;i.__numberFormatters.has(e)&&i.__numberFormatters.delete(e)}}"boolean"!=typeof __INTLIFY_PROD_DEVTOOLS__&&(vt().__INTLIFY_PROD_DEVTOOLS__=!1);
/*!
  * vue-i18n v9.2.0-beta.32
  * (c) 2022 kazuya kawaguchi
  * Released under the MIT License.
  */
const ii="9.2.0-beta.32";let ri=wt.__EXTEND_POINT__;const oi=()=>++ri,ai={UNEXPECTED_RETURN_TYPE:ri,INVALID_ARGUMENT:oi(),MUST_BE_CALL_SETUP_TOP:oi(),NOT_INSLALLED:oi(),NOT_AVAILABLE_IN_LEGACY_MODE:oi(),REQUIRED_VALUE:oi(),INVALID_VALUE:oi(),CANNOT_SETUP_VUE_DEVTOOLS_PLUGIN:oi(),NOT_INSLALLED_WITH_PROVIDE:oi(),UNEXPECTED_ERROR:oi(),NOT_COMPATIBLE_LEGACY_VUE_I18N:oi(),BRIDGE_SUPPORT_VUE_2_ONLY:oi(),MUST_DEFINE_I18N_OPTION_IN_ALLOW_COMPOSITION:oi(),NOT_AVAILABLE_COMPOSITION_IN_LEGACY:oi(),__EXTEND_POINT__:oi()};function si(e,...t){return At(e,null,void 0)}const ci=st("__transrateVNode"),ui=st("__datetimeParts"),li=st("__numberParts"),di=st("__setPluralRules");st("__intlifyMeta");const pi=st("__injectWithOption");function hi(e){if(!Et(e))return e;for(const t in e)if(It(e,t))if(t.includes(".")){const n=t.split("."),i=n.length-1;let r=e;for(let e=0;e<i;e++)n[e]in r||(r[n[e]]={}),r=r[n[e]];r[n[i]]=e[t],delete e[t],Et(r[n[i]])&&hi(r[n[i]])}else Et(e[t])&&hi(e[t]);return e}function fi(e,t){const{messages:n,__i18n:i,messageResolver:r,flatJson:o}=t,a=Dt(n)?n:Mt(i)?{}:{[e]:{}};if(Mt(i)&&i.forEach((e=>{if("locale"in e&&"resource"in e){const{locale:t,resource:n}=e;t?(a[t]=a[t]||{},mi(n,a[t])):mi(n,a)}else Ct(e)&&mi(JSON.parse(e),a)})),null==r&&o)for(const s in a)It(a,s)&&hi(a[s]);return a}const gi=e=>!Et(e)||Mt(e);function mi(e,t){if(gi(e)||gi(t))throw si(ai.INVALID_VALUE);for(const n in e)It(e,n)&&(gi(e[n])||gi(t[n])?t[n]=e[n]:mi(e[n],t[n]))}function vi(e){return e.type}function _i(e,t,n){let i=Et(t.messages)?t.messages:{};"__i18nGlobal"in n&&(i=fi(e.locale.value,{messages:i,__i18n:n.__i18nGlobal}));const r=Object.keys(i);if(r.length&&r.forEach((t=>{e.mergeLocaleMessage(t,i[t])})),Et(t.datetimeFormats)){const n=Object.keys(t.datetimeFormats);n.length&&n.forEach((n=>{e.mergeDateTimeFormat(n,t.datetimeFormats[n])}))}if(Et(t.numberFormats)){const n=Object.keys(t.numberFormats);n.length&&n.forEach((n=>{e.mergeNumberFormat(n,t.numberFormats[n])}))}}function yi(e){return M(T,null,e,0)}const Ii="__INTLIFY_META__";let Mi=0;function Ti(e){return(t,n,i,r)=>e(n,i,y()||void 0,r)}const Ci=()=>{const e=y();let t=null;return e&&(t=vi(e)[Ii])?{[Ii]:t}:null};function Si(e={},t){const{__root:n}=e,i=void 0===n;let r=!St(e.inheritLocale)||e.inheritLocale;const o=f(n&&r?n.locale.value:Ct(e.locale)?e.locale:Sn),a=f(n&&r?n.fallbackLocale.value:Ct(e.fallbackLocale)||Mt(e.fallbackLocale)||Dt(e.fallbackLocale)||!1===e.fallbackLocale?e.fallbackLocale:o.value),s=f(fi(o.value,e)),c=f(Dt(e.datetimeFormats)?e.datetimeFormats:{[o.value]:{}}),u=f(Dt(e.numberFormats)?e.numberFormats:{[o.value]:{}});let l=n?n.missingWarn:!St(e.missingWarn)&&!pt(e.missingWarn)||e.missingWarn,d=n?n.fallbackWarn:!St(e.fallbackWarn)&&!pt(e.fallbackWarn)||e.fallbackWarn,p=n?n.fallbackRoot:!St(e.fallbackRoot)||e.fallbackRoot,h=!!e.fallbackFormat,m=Tt(e.missing)?e.missing:null,_=Tt(e.missing)?Ti(e.missing):null,y=Tt(e.postTranslation)?e.postTranslation:null,I=n?n.warnHtmlMessage:!St(e.warnHtmlMessage)||e.warnHtmlMessage,M=!!e.escapeParameter;const T=n?n.modifiers:Dt(e.modifiers)?e.modifiers:{};let C,S=e.pluralRules||n&&n.pluralRules;C=function(){i&&On(null);const t={version:ii,locale:o.value,fallbackLocale:a.value,messages:s.value,modifiers:T,pluralRules:S,missing:null===_?void 0:_,missingWarn:l,fallbackWarn:d,fallbackFormat:h,unresolving:!0,postTranslation:null===y?void 0:y,warnHtmlMessage:I,escapeParameter:M,messageResolver:e.messageResolver,__meta:{framework:"vue"}};t.datetimeFormats=c.value,t.numberFormats=u.value,t.__datetimeFormatters=Dt(C)?C.__datetimeFormatters:void 0,t.__numberFormatters=Dt(C)?C.__numberFormatters:void 0;const n=Un(t);return i&&On(n),n}(),Gn(C,o.value,a.value);const E=g({get:()=>o.value,set:e=>{o.value=e,C.locale=o.value}}),k=g({get:()=>a.value,set:e=>{a.value=e,C.fallbackLocale=a.value,Gn(C,o.value,e)}}),b=g((()=>s.value)),D=g((()=>c.value)),w=g((()=>u.value));function A(e,t,r,l,d,h){let f;if(o.value,a.value,s.value,c.value,u.value,__INTLIFY_PROD_DEVTOOLS__)try{An(Ci()),i||(C.fallbackContext=n?Nn():void 0),f=e(C)}finally{An(null),i||(C.fallbackContext=void 0)}else f=e(C);if(lt(f)&&f===Cn){const[e,i]=t();return n&&p?l(n):d(e)}if(h(f))return f;throw si(ai.UNEXPECTED_RETURN_TYPE)}function R(...e){return A((t=>Reflect.apply(Wn,null,[t,...e])),(()=>Jn(...e)),0,(t=>Reflect.apply(t.t,t,[...e])),(e=>e),(e=>Ct(e)))}const L={normalize:function(e){return e.map((e=>Ct(e)?yi(e):e))},interpolate:e=>e,type:"vnode"};function O(e){return s.value[e]||{}}Mi++,n&&ot&&(v(n.locale,(e=>{r&&(o.value=e,C.locale=e,Gn(C,o.value,a.value))})),v(n.fallbackLocale,(e=>{r&&(a.value=e,C.fallbackLocale=e,Gn(C,o.value,a.value))})));const N={id:Mi,locale:E,fallbackLocale:k,get inheritLocale(){return r},set inheritLocale(e){r=e,e&&n&&(o.value=n.locale.value,a.value=n.fallbackLocale.value,Gn(C,o.value,a.value))},get availableLocales(){return Object.keys(s.value).sort()},messages:b,get modifiers(){return T},get pluralRules(){return S||{}},get isGlobal(){return i},get missingWarn(){return l},set missingWarn(e){l=e,C.missingWarn=l},get fallbackWarn(){return d},set fallbackWarn(e){d=e,C.fallbackWarn=d},get fallbackRoot(){return p},set fallbackRoot(e){p=e},get fallbackFormat(){return h},set fallbackFormat(e){h=e,C.fallbackFormat=h},get warnHtmlMessage(){return I},set warnHtmlMessage(e){I=e,C.warnHtmlMessage=e},get escapeParameter(){return M},set escapeParameter(e){M=e,C.escapeParameter=e},t:R,getLocaleMessage:O,setLocaleMessage:function(e,t){s.value[e]=t,C.messages=s.value},mergeLocaleMessage:function(e,t){s.value[e]=s.value[e]||{},mi(t,s.value[e]),C.messages=s.value},getPostTranslationHandler:function(){return Tt(y)?y:null},setPostTranslationHandler:function(e){y=e,C.postTranslation=e},getMissingHandler:function(){return m},setMissingHandler:function(e){null!==e&&(_=Ti(e)),m=e,C.missing=_},[di]:function(e){S=e,C.pluralRules=S}};return N.datetimeFormats=D,N.numberFormats=w,N.rt=function(...e){const[t,n,i]=e;if(i&&!Et(i))throw si(ai.INVALID_ARGUMENT);return R(t,n,gt({resolvedMessage:!0},i||{}))},N.te=function(e,t){const n=O(Ct(t)?t:o.value);return null!==C.messageResolver(n,e)},N.tm=function(e){const t=function(e){let t=null;const n=_n(C,a.value,o.value);for(let i=0;i<n.length;i++){const r=s.value[n[i]]||{},o=C.messageResolver(r,e);if(null!=o){t=o;break}}return t}(e);return null!=t?t:n&&n.tm(e)||{}},N.d=function(...e){return A((t=>Reflect.apply(Xn,null,[t,...e])),(()=>Zn(...e)),0,(t=>Reflect.apply(t.d,t,[...e])),(()=>En),(e=>Ct(e)))},N.n=function(...e){return A((t=>Reflect.apply(ei,null,[t,...e])),(()=>ti(...e)),0,(t=>Reflect.apply(t.n,t,[...e])),(()=>En),(e=>Ct(e)))},N.getDateTimeFormat=function(e){return c.value[e]||{}},N.setDateTimeFormat=function(e,t){c.value[e]=t,C.datetimeFormats=c.value,Qn(C,e,t)},N.mergeDateTimeFormat=function(e,t){c.value[e]=gt(c.value[e]||{},t),C.datetimeFormats=c.value,Qn(C,e,t)},N.getNumberFormat=function(e){return u.value[e]||{}},N.setNumberFormat=function(e,t){u.value[e]=t,C.numberFormats=u.value,ni(C,e,t)},N.mergeNumberFormat=function(e,t){u.value[e]=gt(u.value[e]||{},t),C.numberFormats=u.value,ni(C,e,t)},N[pi]=e.__injectWithOption,N[ci]=function(...e){return A((t=>{let n;const i=t;try{i.processor=L,n=Reflect.apply(Wn,null,[i,...e])}finally{i.processor=null}return n}),(()=>Jn(...e)),0,(t=>t[ci](...e)),(e=>[yi(e)]),(e=>Mt(e)))},N[ui]=function(...e){return A((t=>Reflect.apply(Xn,null,[t,...e])),(()=>Zn(...e)),0,(t=>t[ui](...e)),(()=>[]),(e=>Ct(e)||Mt(e)))},N[li]=function(...e){return A((t=>Reflect.apply(ei,null,[t,...e])),(()=>ti(...e)),0,(t=>t[li](...e)),(()=>[]),(e=>Ct(e)||Mt(e)))},N}function Ei(e={},t){{const t=Si(function(e){const t=Ct(e.locale)?e.locale:Sn,n=Ct(e.fallbackLocale)||Mt(e.fallbackLocale)||Dt(e.fallbackLocale)||!1===e.fallbackLocale?e.fallbackLocale:t,i=Tt(e.missing)?e.missing:void 0,r=!St(e.silentTranslationWarn)&&!pt(e.silentTranslationWarn)||!e.silentTranslationWarn,o=!St(e.silentFallbackWarn)&&!pt(e.silentFallbackWarn)||!e.silentFallbackWarn,a=!St(e.fallbackRoot)||e.fallbackRoot,s=!!e.formatFallbackMessages,c=Dt(e.modifiers)?e.modifiers:{},u=e.pluralizationRules,l=Tt(e.postTranslation)?e.postTranslation:void 0,d=!Ct(e.warnHtmlInMessage)||"off"!==e.warnHtmlInMessage,p=!!e.escapeParameterHtml,h=!St(e.sync)||e.sync;let f=e.messages;if(Dt(e.sharedMessages)){const t=e.sharedMessages;f=Object.keys(t).reduce(((e,n)=>{const i=e[n]||(e[n]={});return gt(i,t[n]),e}),f||{})}const{__i18n:g,__root:m,__injectWithOption:v}=e,_=e.datetimeFormats,y=e.numberFormats;return{locale:t,fallbackLocale:n,messages:f,flatJson:e.flatJson,datetimeFormats:_,numberFormats:y,missing:i,missingWarn:r,fallbackWarn:o,fallbackRoot:a,fallbackFormat:s,modifiers:c,pluralRules:u,postTranslation:l,warnHtmlMessage:d,escapeParameter:p,messageResolver:e.messageResolver,inheritLocale:h,__i18n:g,__root:m,__injectWithOption:v}}(e)),n={id:t.id,get locale(){return t.locale.value},set locale(e){t.locale.value=e},get fallbackLocale(){return t.fallbackLocale.value},set fallbackLocale(e){t.fallbackLocale.value=e},get messages(){return t.messages.value},get datetimeFormats(){return t.datetimeFormats.value},get numberFormats(){return t.numberFormats.value},get availableLocales(){return t.availableLocales},get formatter(){return{interpolate:()=>[]}},set formatter(e){},get missing(){return t.getMissingHandler()},set missing(e){t.setMissingHandler(e)},get silentTranslationWarn(){return St(t.missingWarn)?!t.missingWarn:t.missingWarn},set silentTranslationWarn(e){t.missingWarn=St(e)?!e:e},get silentFallbackWarn(){return St(t.fallbackWarn)?!t.fallbackWarn:t.fallbackWarn},set silentFallbackWarn(e){t.fallbackWarn=St(e)?!e:e},get modifiers(){return t.modifiers},get formatFallbackMessages(){return t.fallbackFormat},set formatFallbackMessages(e){t.fallbackFormat=e},get postTranslation(){return t.getPostTranslationHandler()},set postTranslation(e){t.setPostTranslationHandler(e)},get sync(){return t.inheritLocale},set sync(e){t.inheritLocale=e},get warnHtmlInMessage(){return t.warnHtmlMessage?"warn":"off"},set warnHtmlInMessage(e){t.warnHtmlMessage="off"!==e},get escapeParameterHtml(){return t.escapeParameter},set escapeParameterHtml(e){t.escapeParameter=e},get preserveDirectiveContent(){return!0},set preserveDirectiveContent(e){},get pluralizationRules(){return t.pluralRules||{}},__composer:t,t(...e){const[n,i,r]=e,o={};let a=null,s=null;if(!Ct(n))throw si(ai.INVALID_ARGUMENT);const c=n;return Ct(i)?o.locale=i:Mt(i)?a=i:Dt(i)&&(s=i),Mt(r)?a=r:Dt(r)&&(s=r),Reflect.apply(t.t,t,[c,a||s||{},o])},rt:(...e)=>Reflect.apply(t.rt,t,[...e]),tc(...e){const[n,i,r]=e,o={plural:1};let a=null,s=null;if(!Ct(n))throw si(ai.INVALID_ARGUMENT);const c=n;return Ct(i)?o.locale=i:lt(i)?o.plural=i:Mt(i)?a=i:Dt(i)&&(s=i),Ct(r)?o.locale=r:Mt(r)?a=r:Dt(r)&&(s=r),Reflect.apply(t.t,t,[c,a||s||{},o])},te:(e,n)=>t.te(e,n),tm:e=>t.tm(e),getLocaleMessage:e=>t.getLocaleMessage(e),setLocaleMessage(e,n){t.setLocaleMessage(e,n)},mergeLocaleMessage(e,n){t.mergeLocaleMessage(e,n)},d:(...e)=>Reflect.apply(t.d,t,[...e]),getDateTimeFormat:e=>t.getDateTimeFormat(e),setDateTimeFormat(e,n){t.setDateTimeFormat(e,n)},mergeDateTimeFormat(e,n){t.mergeDateTimeFormat(e,n)},n:(...e)=>Reflect.apply(t.n,t,[...e]),getNumberFormat:e=>t.getNumberFormat(e),setNumberFormat(e,n){t.setNumberFormat(e,n)},mergeNumberFormat(e,n){t.mergeNumberFormat(e,n)},getChoiceIndex:(e,t)=>-1,__onComponentInstanceCreated(t){const{componentInstanceCreatedListener:i}=e;i&&i(t,n)}};return n}}const ki={tag:{type:[String,Object]},locale:{type:String},scope:{type:String,validator:e=>"parent"===e||"global"===e,default:"parent"},i18n:{type:Object}};function bi(e){return _}const Di={name:"i18n-t",props:gt({keypath:{type:String,required:!0},plural:{type:[Number,String],validator:e=>lt(e)||!isNaN(e)}},ki),setup(e,t){const{slots:n,attrs:i}=t,r=e.i18n||Fi({useScope:e.scope,__useComponent:!0}),o=Object.keys(n).filter((e=>"_"!==e));return()=>{const n={};e.locale&&(n.locale=e.locale),void 0!==e.plural&&(n.plural=Ct(e.plural)?+e.plural:e.plural);const a=function({slots:e},t){if(1===t.length&&"default"===t[0])return(e.default?e.default():[]).reduce(((e,t)=>[...e,...Mt(t.children)?t.children:[t]]),[]);return t.reduce(((t,n)=>{const i=e[n];return i&&(t[n]=i()),t}),{})}(t,o),s=r[ci](e.keypath,a,n),c=gt({},i),l=Ct(e.tag)||Et(e.tag)?e.tag:bi();return u(l,c,s)}}};function wi(e,t,n,i){const{slots:r,attrs:o}=t;return()=>{const t={part:!0};let a={};e.locale&&(t.locale=e.locale),Ct(e.format)?t.key=e.format:Et(e.format)&&(Ct(e.format.key)&&(t.key=e.format.key),a=Object.keys(e.format).reduce(((t,i)=>n.includes(i)?gt({},t,{[i]:e.format[i]}):t),{}));const s=i(e.value,t,a);let c=[t.key];Mt(s)?c=s.map(((e,t)=>{const n=r[e.type];return n?n({[e.type]:e.value,index:t,parts:s}):[e.value]})):Ct(s)&&(c=[s]);const l=gt({},o),d=Ct(e.tag)||Et(e.tag)?e.tag:bi();return u(d,l,c)}}const Ai=["localeMatcher","style","unit","unitDisplay","currency","currencyDisplay","useGrouping","numberingSystem","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits","notation","formatMatcher"],Ri={name:"i18n-n",props:gt({value:{type:Number,required:!0},format:{type:[String,Object]}},ki),setup(e,t){const n=e.i18n||Fi({useScope:"parent",__useComponent:!0});return wi(e,t,Ai,((...e)=>n[li](...e)))}},Li=["dateStyle","timeStyle","fractionalSecondDigits","calendar","dayPeriod","numberingSystem","localeMatcher","timeZone","hour12","hourCycle","formatMatcher","weekday","era","year","month","day","hour","minute","second","timeZoneName"],Oi={name:"i18n-d",props:gt({value:{type:[Number,Date],required:!0},format:{type:[String,Object]}},ki),setup(e,t){const n=e.i18n||Fi({useScope:"parent",__useComponent:!0});return wi(e,t,Li,((...e)=>n[ui](...e)))}};function Ni(e){const t=(t,{instance:n,value:i,modifiers:r})=>{if(!n||!n.$)throw si(ai.UNEXPECTED_ERROR);const o=function(e,t){const n=e;if("composition"===e.mode)return n.__getInstance(t)||e.global;{const i=n.__getInstance(t);return null!=i?i.__composer:e.global.__composer}}(e,n.$),a=function(e){if(Ct(e))return{path:e};if(Dt(e)){if(!("path"in e))throw si(ai.REQUIRED_VALUE);return e}throw si(ai.INVALID_VALUE)}(i);t.textContent=Reflect.apply(o.t,o,[...Pi(a)])};return{beforeMount:t,beforeUpdate:t}}function Pi(e){const{path:t,locale:n,args:i,choice:r,plural:o}=e,a={},s=i||{};return Ct(n)&&(a.locale=n),lt(r)&&(a.plural=r),lt(o)&&(a.plural=o),[t,s,a]}function Ui(e,t){e.locale=t.locale||e.locale,e.fallbackLocale=t.fallbackLocale||e.fallbackLocale,e.missing=t.missing||e.missing,e.silentTranslationWarn=t.silentTranslationWarn||e.silentFallbackWarn,e.silentFallbackWarn=t.silentFallbackWarn||e.silentFallbackWarn,e.formatFallbackMessages=t.formatFallbackMessages||e.formatFallbackMessages,e.postTranslation=t.postTranslation||e.postTranslation,e.warnHtmlInMessage=t.warnHtmlInMessage||e.warnHtmlInMessage,e.escapeParameterHtml=t.escapeParameterHtml||e.escapeParameterHtml,e.sync=t.sync||e.sync,e.__composer[di](t.pluralizationRules||e.pluralizationRules);const n=fi(e.locale,{messages:t.messages,__i18n:t.__i18n});return Object.keys(n).forEach((t=>e.mergeLocaleMessage(t,n[t]))),t.datetimeFormats&&Object.keys(t.datetimeFormats).forEach((n=>e.mergeDateTimeFormat(n,t.datetimeFormats[n]))),t.numberFormats&&Object.keys(t.numberFormats).forEach((n=>e.mergeNumberFormat(n,t.numberFormats[n]))),e}const xi=st("global-vue-i18n");function Gi(e={},t){const n=__VUE_I18N_LEGACY_API__&&St(e.legacy)?e.legacy:__VUE_I18N_LEGACY_API__,i=!!e.globalInjection,r=!__VUE_I18N_LEGACY_API__||!n||!!e.allowComposition,o=new Map,a=function(e,t,n){return __VUE_I18N_LEGACY_API__&&t?Ei(e):Si(e)}(e,n),s=st("");{const e={get mode(){return __VUE_I18N_LEGACY_API__&&n?"legacy":"composition"},get allowComposition(){return r},async install(t,...r){t.__VUE_I18N_SYMBOL__=s,t.provide(t.__VUE_I18N_SYMBOL__,e),!n&&i&&function(e,t){const n=Object.create(null);Vi.forEach((e=>{const i=Object.getOwnPropertyDescriptor(t,e);if(!i)throw si(ai.UNEXPECTED_ERROR);const r=I(i.value)?{get:()=>i.value.value,set(e){i.value.value=e}}:{get:()=>i.get&&i.get()};Object.defineProperty(n,e,r)})),e.config.globalProperties.$i18n=n,qi.forEach((n=>{const i=Object.getOwnPropertyDescriptor(t,n);if(!i||!i.value)throw si(ai.UNEXPECTED_ERROR);Object.defineProperty(e.config.globalProperties,`$${n}`,i)}))}(t,e.global),__VUE_I18N_FULL_INSTALL__&&function(e,t,...n){const i=Dt(n[0])?n[0]:{},r=!!i.useI18nComponentName;(!St(i.globalInstall)||i.globalInstall)&&(e.component(r?"i18n":Di.name,Di),e.component(Ri.name,Ri),e.component(Oi.name,Oi)),e.directive("t",Ni(t))}(t,e,...r),__VUE_I18N_LEGACY_API__&&n&&t.mixin(function(e,t,n){return{beforeCreate(){const i=y();if(!i)throw si(ai.UNEXPECTED_ERROR);const r=this.$options;if(r.i18n){const n=r.i18n;r.__i18n&&(n.__i18n=r.__i18n),n.__root=t,this===this.$root?this.$i18n=Ui(e,n):(n.__injectWithOption=!0,this.$i18n=Ei(n))}else r.__i18n?this===this.$root?this.$i18n=Ui(e,r):this.$i18n=Ei({__i18n:r.__i18n,__injectWithOption:!0,__root:t}):this.$i18n=e;r.__i18nGlobal&&_i(t,r,r),e.__onComponentInstanceCreated(this.$i18n),n.__setInstance(i,this.$i18n),this.$t=(...e)=>this.$i18n.t(...e),this.$rt=(...e)=>this.$i18n.rt(...e),this.$tc=(...e)=>this.$i18n.tc(...e),this.$te=(e,t)=>this.$i18n.te(e,t),this.$d=(...e)=>this.$i18n.d(...e),this.$n=(...e)=>this.$i18n.n(...e),this.$tm=e=>this.$i18n.tm(e)},mounted(){},unmounted(){const e=y();if(!e)throw si(ai.UNEXPECTED_ERROR);delete this.$t,delete this.$rt,delete this.$tc,delete this.$te,delete this.$d,delete this.$n,delete this.$tm,n.__deleteInstance(e),delete this.$i18n}}}(a,a.__composer,e))},get global(){return a},__instances:o,__getInstance:function(e){return o.get(e)||null},__setInstance:function(e,t){o.set(e,t)},__deleteInstance:function(e){o.delete(e)}};return e}}function Fi(e={}){const t=y();if(null==t)throw si(ai.MUST_BE_CALL_SETUP_TOP);if(!t.isCE&&null!=t.appContext.app&&!t.appContext.app.__VUE_I18N_SYMBOL__)throw si(ai.NOT_INSLALLED);const n=function(e){{const t=l(e.isCE?xi:e.appContext.app.__VUE_I18N_SYMBOL__);if(!t)throw si(e.isCE?ai.NOT_INSLALLED_WITH_PROVIDE:ai.UNEXPECTED_ERROR);return t}}(t),i=function(e){return"composition"===e.mode?e.global:e.global.__composer}(n),r=vi(t),o=function(e,t){return ht(e)?"__i18n"in t?"local":"global":e.useScope?e.useScope:"local"}(e,r);if(__VUE_I18N_LEGACY_API__&&"legacy"===n.mode&&!e.__useComponent){if(!n.allowComposition)throw si(ai.NOT_AVAILABLE_IN_LEGACY_MODE);return function(e,t,n,i={}){const r="local"===t,o=h(null);if(r&&e.proxy&&!e.proxy.$options.i18n)throw si(ai.MUST_DEFINE_I18N_OPTION_IN_ALLOW_COMPOSITION);const a=!St(i.inheritLocale)||i.inheritLocale,s=f(r&&a?n.locale.value:Ct(i.locale)?i.locale:Sn),c=f(r&&a?n.fallbackLocale.value:Ct(i.fallbackLocale)||Mt(i.fallbackLocale)||Dt(i.fallbackLocale)||!1===i.fallbackLocale?i.fallbackLocale:s.value),u=f(fi(s.value,i)),l=f(Dt(i.datetimeFormats)?i.datetimeFormats:{[s.value]:{}}),d=f(Dt(i.numberFormats)?i.numberFormats:{[s.value]:{}}),p=r?n.missingWarn:!St(i.missingWarn)&&!pt(i.missingWarn)||i.missingWarn,v=r?n.fallbackWarn:!St(i.fallbackWarn)&&!pt(i.fallbackWarn)||i.fallbackWarn,_=r?n.fallbackRoot:!St(i.fallbackRoot)||i.fallbackRoot,y=!!i.fallbackFormat,I=Tt(i.missing)?i.missing:null,M=Tt(i.postTranslation)?i.postTranslation:null,T=r?n.warnHtmlMessage:!St(i.warnHtmlMessage)||i.warnHtmlMessage,C=!!i.escapeParameter,S=r?n.modifiers:Dt(i.modifiers)?i.modifiers:{},E=i.pluralRules||r&&n.pluralRules;function k(){return[s.value,c.value,u.value,l.value,d.value]}const b=g({get:()=>o.value?o.value.locale.value:s.value,set:e=>{o.value&&(o.value.locale.value=e),s.value=e}}),D=g({get:()=>o.value?o.value.fallbackLocale.value:c.value,set:e=>{o.value&&(o.value.fallbackLocale.value=e),c.value=e}}),w=g((()=>o.value?o.value.messages.value:u.value)),A=g((()=>l.value)),R=g((()=>d.value));function L(){return o.value?o.value.getPostTranslationHandler():M}function O(e){o.value&&o.value.setPostTranslationHandler(e)}function N(){return o.value?o.value.getMissingHandler():I}function P(e){o.value&&o.value.setMissingHandler(e)}function U(e){return k(),e()}function x(...e){return o.value?U((()=>Reflect.apply(o.value.t,null,[...e]))):U((()=>""))}function G(...e){return o.value?Reflect.apply(o.value.rt,null,[...e]):""}function F(...e){return o.value?U((()=>Reflect.apply(o.value.d,null,[...e]))):U((()=>""))}function V(...e){return o.value?U((()=>Reflect.apply(o.value.n,null,[...e]))):U((()=>""))}function q(e){return o.value?o.value.tm(e):{}}function B(e,t){return!!o.value&&o.value.te(e,t)}function H(e){return o.value?o.value.getLocaleMessage(e):{}}function j(e,t){o.value&&(o.value.setLocaleMessage(e,t),u.value[e]=t)}function K(e,t){o.value&&o.value.mergeLocaleMessage(e,t)}function z(e){return o.value?o.value.getDateTimeFormat(e):{}}function W(e,t){o.value&&(o.value.setDateTimeFormat(e,t),l.value[e]=t)}function Y(e,t){o.value&&o.value.mergeDateTimeFormat(e,t)}function $(e){return o.value?o.value.getNumberFormat(e):{}}function J(e,t){o.value&&(o.value.setNumberFormat(e,t),d.value[e]=t)}function X(e,t){o.value&&o.value.mergeNumberFormat(e,t)}const Z={get id(){return o.value?o.value.id:-1},locale:b,fallbackLocale:D,messages:w,datetimeFormats:A,numberFormats:R,get inheritLocale(){return o.value?o.value.inheritLocale:a},set inheritLocale(e){o.value&&(o.value.inheritLocale=e)},get availableLocales(){return o.value?o.value.availableLocales:Object.keys(u.value)},get modifiers(){return o.value?o.value.modifiers:S},get pluralRules(){return o.value?o.value.pluralRules:E},get isGlobal(){return!!o.value&&o.value.isGlobal},get missingWarn(){return o.value?o.value.missingWarn:p},set missingWarn(e){o.value&&(o.value.missingWarn=e)},get fallbackWarn(){return o.value?o.value.fallbackWarn:v},set fallbackWarn(e){o.value&&(o.value.missingWarn=e)},get fallbackRoot(){return o.value?o.value.fallbackRoot:_},set fallbackRoot(e){o.value&&(o.value.fallbackRoot=e)},get fallbackFormat(){return o.value?o.value.fallbackFormat:y},set fallbackFormat(e){o.value&&(o.value.fallbackFormat=e)},get warnHtmlMessage(){return o.value?o.value.warnHtmlMessage:T},set warnHtmlMessage(e){o.value&&(o.value.warnHtmlMessage=e)},get escapeParameter(){return o.value?o.value.escapeParameter:C},set escapeParameter(e){o.value&&(o.value.escapeParameter=e)},t:x,getPostTranslationHandler:L,setPostTranslationHandler:O,getMissingHandler:N,setMissingHandler:P,rt:G,d:F,n:V,tm:q,te:B,getLocaleMessage:H,setLocaleMessage:j,mergeLocaleMessage:K,getDateTimeFormat:z,setDateTimeFormat:W,mergeDateTimeFormat:Y,getNumberFormat:$,setNumberFormat:J,mergeNumberFormat:X};function Q(e){e.locale.value=s.value,e.fallbackLocale.value=c.value,Object.keys(u.value).forEach((t=>{e.mergeLocaleMessage(t,u.value[t])})),Object.keys(l.value).forEach((t=>{e.mergeDateTimeFormat(t,l.value[t])})),Object.keys(d.value).forEach((t=>{e.mergeNumberFormat(t,d.value[t])})),e.escapeParameter=C,e.fallbackFormat=y,e.fallbackRoot=_,e.fallbackWarn=v,e.missingWarn=p,e.warnHtmlMessage=T}return m((()=>{if(null==e.proxy||null==e.proxy.$i18n)throw si(ai.NOT_AVAILABLE_COMPOSITION_IN_LEGACY);const n=o.value=e.proxy.$i18n.__composer;"global"===t?(s.value=n.locale.value,c.value=n.fallbackLocale.value,u.value=n.messages.value,l.value=n.datetimeFormats.value,d.value=n.numberFormats.value):r&&Q(n)})),Z}(t,o,i,e)}if("global"===o)return _i(i,e,r),i;if("parent"===o){let r=function(e,t,n=!1){let i=null;const r=t.root;let o=t.parent;for(;null!=o;){const t=e;if("composition"===e.mode)i=t.__getInstance(o);else if(__VUE_I18N_LEGACY_API__){const e=t.__getInstance(o);null!=e&&(i=e.__composer,n&&i&&!i[pi]&&(i=null))}if(null!=i)break;if(r===o)break;o=o.parent}return i}(n,t,e.__useComponent);return null==r&&(r=i),r}const a=n;let s=a.__getInstance(t);if(null==s){const n=gt({},e);"__i18n"in r&&(n.__i18n=r.__i18n),i&&(n.__root=i),s=Si(n),function(e,t,n){d((()=>{}),t),p((()=>{e.__deleteInstance(t)}),t)}(a,t),a.__setInstance(t,s)}return s}const Vi=["locale","fallbackLocale","availableLocales"],qi=["t","rt","d","n","tm"];var Bi,Hi;if(Bi=function(e,t={}){{const n=(t.onCacheKey||Fn)(e),i=Vn[n];if(i)return i;let r=!1;const o=t.onError||Rt;t.onError=e=>{r=!0,o(e)};const{code:a}=function(e,t={}){const n=gt({},t),i=zt(n).parse(e);return Jt(i,n),Zt(i,n)}(e,t),s=new Function(`return ${a}`)();return r?s:Vn[n]=s}},kn=Bi,bn=function(e,t){if(!Et(e))return null;let n=on.get(t);if(n||(n=function(e){const t=[];let n,i,r,o,a,s,c,u=-1,l=0,d=0;const p=[];function h(){const t=e[u+1];if(5===l&&"'"===t||6===l&&'"'===t)return u++,r="\\"+t,p[0](),!0}for(p[0]=()=>{void 0===i?i=r:i+=r},p[1]=()=>{void 0!==i&&(t.push(i),i=void 0)},p[2]=()=>{p[0](),d++},p[3]=()=>{if(d>0)d--,l=4,p[0]();else{if(d=0,void 0===i)return!1;if(i=rn(i),!1===i)return!1;p[1]()}};null!==l;)if(u++,n=e[u],"\\"!==n||!h()){if(o=nn(n),c=en[l],a=c[o]||c.l||8,8===a)return;if(l=a[0],void 0!==a[1]&&(s=p[a[1]],s&&(r=n,!1===s())))return;if(7===l)return t}}(t),n&&on.set(t,n)),!n)return null;const i=n.length;let r=e,o=0;for(;o<i;){const e=r[n[o]];if(void 0===e)return null;r=e,o++}return r},Dn=_n,"boolean"!=typeof __VUE_I18N_FULL_INSTALL__&&(vt().__VUE_I18N_FULL_INSTALL__=!0),"boolean"!=typeof __VUE_I18N_LEGACY_API__&&(vt().__VUE_I18N_LEGACY_API__=!0),"boolean"!=typeof __INTLIFY_PROD_DEVTOOLS__&&(vt().__INTLIFY_PROD_DEVTOOLS__=!1),__INTLIFY_PROD_DEVTOOLS__){const e=vt();e.__INTLIFY__=!0,Hi=e.__INTLIFY_DEVTOOLS_GLOBAL_HOOK__,fn=Hi}const ji={...{en:{"取消":"Cancel","发送":"Send","系统通知":"System notification","关闭":"Close","确定":"Save",TUIChat:{"撤回":"Recall message","删除":"Delete message","复制":"Copy","重新发送":"Resend","转发":"Forward","引用":"Reference","回复":"Reply","回复详情":"Replies","条回复":"replies","打开":"Open","已读":"Read","全部已读":"All read","人已读":" read","人未读":" unread","人关闭阅读状态":" read status closed","消息详情":"Message Detail","关闭阅读状态":"Read status closed","该消息不存在":"The message does not exist","无法定位到原消息":"Unable to navigate to the original message","未读":"Unread","您":"You","撤回了一条消息":"recalled a message","重新编辑":"Re-edit","我":"I","查看更多":"View more","转发给":"Forward to","请输入消息":"Enter a message","描述":"Description","经度":"Longitude","纬度":"Latitude","自定义消息":"Custom message","图片":"[photo]","语音":"[audio]","视频":"[video]","表情":"[face]","文件":"[file]","自定义":"[custom message]","管理员开启全员禁言":"The admin enables Mute All","您已被管理员禁言":"You have been muted by the admin","按Enter发送，Ctrl+Enter换行":"Press Enter to send a message and Ctrl+Enter to start a new line","单击下载":"Click download","确认重发该消息？":"Confirm to resend the message?","取消":"Cancel","确定":"Submit","对方正在输入":"Typing...","回到最新位置":"Back to the latest location","条新消息":" new messages","安全提示":"【Security Tips】This APP is only used to experience the functions of Tencent Cloud Instant Messaging products, and cannot be used for business negotiation and expansion. Don't trust money-related information such as remittances and lottery wins, don't make unfamiliar phone calls easily, and beware of being deceived.","点此投诉":"Complain","语音通话":"Voice Call","视频通话":"Video Call","发起群语音":"Make group voice call","发起群视频":"Make group video call","已接听":"Answered","拒绝通话":"Decline Call","无应答":"No Answer","取消通话":"Cancel Call","发起通话":"Start Call","结束群聊":"Edit Group Call","通话时长":"Duration","欢迎使用TUICallKit":"Welcome to TUICallKit","检测到您暂未集成TUICallKit，无法体验音视频通话功能":"It is detected that you have not integrated TUI CallKit yet, so you cannot experience the audio and video call. ","请点击":"Please click","集成TUICallKit":" Integrate TUICallKit ","开通腾讯实时音视频服务":"Integration Tencent Real-Time Communication","进行体验":"to experience.","您当前购买使用的套餐包暂未开通此功能":"The package you purchased does not support this ability.","选择提醒的人":"Select Contact",manage:{"群公告":"Group notice","群成员":"Group member","群管理":"Manage group","好友工作群":"Work","陌生人社交群":"Public","临时会议群":"Meeting","直播群":"AVChatRom","自由加入":"Join freely","需要验证":"Require approval","禁止加群":"Disallow group joining","人":"","群ID":"Group ID","群头像":"Group profile photo","群类型":"Group type","加群方式":"Group joining mode","转让群组":"Transfer ownership","解散群聊":"Disband group","退出群组":"Quit group","群管理员":"Group admin","全员禁言":"Mute All","全员禁言开启后，只允许群主和管理员发言。":"If Mute All is enabled, only the group owner and admin can speak.","单独禁言人员":"Mute a member","删除成员":"Remove member","确定从群聊中删除该成员？":"Are you sure you want to remove this member from the group chat?","确定从群聊中删除所选成员？":"Are you sure you want to remove selected member(s) from the group chat?","暂无公告":"No notice","发布":"Post","编辑":"Edit","群名称":"Group name","查看更多":"View more","管理员":"Admin","群主":"Group owner","我":"me","添加成员":"Add member","新增管理员":"Add admin","移除管理员":"Revoke admin","新增禁言用户":"Add muted member","移除禁言用户":"Remove muted member","修改群聊名称":"Edit group name","修改群聊名称后，将在群内通知其他成员":"After modifying the group chat name, other members will be notified in the group","仅限中文、字母、数字和下划线，2-20个字":"Chinese, letters, numbers and underscores only, 2-20 words","请先注册 TUIGroup 模块":"Please register the TUIGroup module first","该用户不存在":"The user does not exist","该用户不在群组内":"The user is not in the group"}},TUIConversation:{"发起单聊":"New one-to-one chat","发起群聊":"New group chat","请输入userID":"Enter a user ID","删除会话":"Delete conversation","系统通知":"System notification","置顶会话":"Top conversation","取消置顶":"cancel top conversation","消息免打扰":"Message not disturb","取消免打扰":"cancel not disturb","有人@我":"Someone {'@'} me","@所有人":"{'@'}Everyone","条":"strip","我":"me","网络异常，请您检查网络设置":"Network exception, please check the network settings"},TUIGroup:{"输入groupID搜索":"Enter groupId search","群名称":"Group name","群ID":"Group ID","加入群聊":"Join","解散群聊":"Dissolution","退出群聊":"Quit","群类型":"Group type","请填写验证信息":"Please fill in the verification information","申请加入":"Apply Join","已申请":"Applied"},TUIProfile:{"资料设置":"Edit profile","头像":"Profile photo","昵称":"Name","账号":"Account","个性签名":"Status","性别":"Gender","男":"Male","女":"Female","不显示":"Rather not say","出生年月":"Birthday","取消":"Cancel","保存":"Save","请选择出生日期":"Select the date of birthday","选择头像":"Select Avatar","设置昵称":"Setting Name","仅限中文、字母、数字和下划线，2-20个字":"Chinese, letters, numbers and underscores only, 2-20 words","请输入昵称":"Enter Name","性别选择":"Select gender","请输入内容":"Enter content","用户ID":"userID","暂未设置":"Not set yet"},TUIContact:{"群聊通知":"Group Chat Notifications","系统通知":"System Notifications","我的群聊":"My Group Chats","输入群ID，按回车搜索":"Enter a group ID","群名称":"Group name","群ID":"Group ID","加入群聊":"Join group chat","解散群聊":"Disband group chat","退出群聊":"Quit group chat","进入群聊":"Enter group chat","群类型":"Group type","请填写验证信息":"Enter the verification info","申请加入":"Request to join","已申请":"Requested","接受":"Accept","拒绝":"Refuse","已处理":"Handled","添加群聊":"add group chat","已加入":"joined","该群组不存在":"The group does not exist","加群":"join","我的好友":"Friend","发送消息":"Send Message","个性签名":"Signature"},message:{tip:{"群成员":"group members","加入群组":"joined the group","退出群组":"left the group","被":"by","踢出群组":"was kicked out of the group","成为管理员":"was set as an admin","被撤销管理员":"was revoked","被禁言":" was unmuted","被取消禁言":"cancel the prohibition","群提示消息":"group prompt message","管理员":"The admin","开启全员禁言":"enabled Mute All","取消全员禁言":"disabled Mute All","成为新的群主":"became the new group owner","修改群名为":"changed the group name to","发布新公告":"posted a new notice","申请加入群组":"requested to join the group","成功加入群组":"Successfully joined the group","被拒绝":"The request to join the group was refused","你被管理员":"You","群":"group","解散":"disbanded","创建群":"created the group","邀请你加群":"invite you to join the group","你退出群组":"You left the group","你被":"You were","设置为群":"set as group","的管理员":"as an admin","撤销群":"revoked","的管理员身份":"admin role of the group","同意加群":"agreed to join the group","拒接加群":"refused to join the group","自定义群系统通知":"Custom group system notification"},custom:{"自定义消息":"Custom message","通话时长":"Call duration","结束群聊":"End","切换语音通话":"Switch voice call","切换视频通话":"Switch video call","发起通话":"Start a call","取消通话":"Cancel","已接听":"Answered","拒绝通话":"Decline","无应答":"No answer","对本次服务评价":"Rate this service","查看详情>>":"View details >>"}},component:{"取消":"Cancel","完成":"Done","已选中":"Selected","人":"","保存":"Save","请输入userID":"Enter an Username or 'Staff 1' to chat","确定":"submit","全选":"All","已在群聊中":"exists"},time:{"周":"week(s) ","天":"day(s)","小时":"hour(s) ","分钟":"minute(s)","刚刚":"Just now","前":" ago","昨天":"Yesterday","星期一":"Monday","星期二":"Tuesday","星期三":"Wednesday","星期四":"Thursday","星期五":"Friday","星期六":"Saturday","星期日":"Sunday"},Evaluate:{"请对本次服务进行评价":"Please rate this service","提交评价":"Feedback","服务评价工具":"Service rate tool","使用":"Build with","自定义消息":"Custom message","搭建":"","星":"Star"},Words:{"请对本次服务进行评价":"Please rate this service","提交评价":"Feedback","常用语-快捷回复工具":"Common Expressions - Quick Reply Tool","使用":"Build with","自定义消息":"Custom message","搭建":"","在吗？在吗？在吗？重要的话说三遍。":"Are you there? ","好久没聊天了，快来和我说说话～":"It’s been a long time. How about you?","好的，就这么说定了。":"Okay. It's a deal.","感恩的心，感谢有你。":"So grateful! ","糟糕！是心动的感觉！":"Oh, no. Flipped.","心疼地抱抱自己，我太难了！":"Give myself a warm hug. ","没关系，别在意，事情过去就过去了。":"Take it easy.","早上好，今天也是让人期待的一天呢！":"Good morning. Have a wonderful day.","熬夜有什么用，又没人陪你聊天，早点休息吧。":"It's better to go to bed early."},TUISearch:{"发起会话":"Start chat","发起单聊":"Chat/Human-service",ai:"AI Service","发起群聊":"New group chat","该用户不存在":"The user does not exist","创建群聊，请注册 TUIGroup 模块":"To create a group chat, please register the TUIGroup module","创建成功":"Creation successful","发起多人会话（群聊）":"New group chat","群头像":"Group profile photo","群名称":"Group name","群ID":"Group ID","群类型":"Group type","选填":"Optional","取消":"Cancel","创建":"Create","类似普通微信群，创建后仅支持已在群内的好友邀请加群，且无需被邀请方同意或群主神奇。详见":"Similar to a WeChat group. Users can join the group only via invitation by existing members. The invitation does not need to be agreed by the invitee or approved by the group owner. See the documentation for details.","类似 QQ 群，创建后群主可以指定群管理员，用户搜索群 ID 发起加群申请后，需要群主或管理员审批通过才能入群。详见":"Similar to a QQ group. After a public group is created, the group owner can designate group admins. To join the group, a user needs to search the group ID and send a request, which needs to be approved by the group owner or an admin before the user can join the group. See the documentation for details. ","创建后可以随意进出，且支持查看入群前消息；适合用于音视频会议场景、在线教育场景等与实时音视频产品结合的场景。详见":"After the group is created, a user can join and quit the group freely and can view the messages sent before joining the group. It is suitable for scenarios that integrate Tencent Real-Time Communication (TRTC), such as audio and video conferences and online education. See the documentation for details.","创建后可以随意进出，没有群成员数量上限，但不支持历史消息存储；适合与直播产品结合，用于弹幕聊天场景。详见":"After a group is created, a user can join and quit the group freely. The group can have an unlimited number of members, but it does not store message history. It can be combined with Live Video Broadcasting (LVB) to support on-screen comment scenarios. See the documentation for details. ","产品文档":"product documentation","设置群名称":"Group name","请输入群名称":"Enter the group name","设置群ID":"Group ID","请输入群ID":"Enter the group ID","选择群类型":"Group type"}}},...{zh_cn:{"取消":"取消","发送":"发送","系统通知":"系统通知","关闭":"关闭","确定":"确定",TUIChat:{"撤回":"撤回","删除":"删除","复制":"复制","重新发送":"重新发送","转发":"转发","引用":"引用","回复":"回复","回复详情":"回复详情","条回复":"条回复","打开":"打开","已读":"已读","未读":"未读","人已读":"人已读","人未读":"人未读","人关闭阅读状态":"人关闭阅读状态","全部已读":"全部已读","消息详情":"消息详情","关闭阅读状态":"关闭","您":"您","撤回了一条消息":"撤回了一条消息","重新编辑":"重新编辑","我":"我","自定义消息":"自定义消息","查看更多":"查看更多","确认重发该消息？":"确认重发该消息？","取消":"取消","确定":"确定","转发给":"转发给","请输入消息":"请输入消息","描述":"描述","经度":"经度","纬度":"纬度","图片":"[图片]","语音":"[语音]","视频":"[视频]","表情":"[表情]","文件":"[文件]","自定义":"[自定义消息]","管理员开启全员禁言":"管理员开启全员禁言","您已被管理员禁言":"您已被管理员禁言","按Enter发送，Ctrl+Enter换行":"按Enter发送，Ctrl+Enter换行","单击下载":"单击下载","该消息不存在":"该消息不存在","无法定位到原消息":"无法定位到原消息","对方正在输入":"对方正在输入...","回到最新位置":"回到最新位置","条新消息":"条新消息","安全提示":"【安全提示】本 APP 仅用于体验腾讯云即时通信 IM 产品功能，不可用于业务洽谈与拓展。请勿轻信汇款、中奖等涉及钱款的信息，勿轻易拨打陌生电话，谨防上当受骗。","点此投诉":"点此投诉","语音通话":"语音通话","视频通话":"视频通话","发起群语音":"发起群语音","发起群视频":"发起群视频","已接听":"已接听","拒绝通话":"拒绝通话","无应答":"无应答","取消通话":"取消通话","发起通话":"发起通话","结束群聊":"结束群聊","通话时长":"通话时长","欢迎使用TUICallKit":"欢迎使用腾讯云音视频通话组件TUICallKit ","检测到您暂未集成TUICallKit，无法体验音视频通话功能":"检测到您暂未集成TUICallKit，无法体验音视频通话功能。","请点击":"请点击","集成TUICallKit":"集成 TUICallKit ","开通腾讯实时音视频服务":"开通腾讯实时音视频服务","进行体验":"进行体验。","您当前购买使用的套餐包暂未开通群消息已读回执功能":"您当前购买使用的套餐包暂未开通【群消息已读回执】功能，请升级至旗舰版进行体验","您当前购买使用的套餐包暂未开通在线用户列表功能":"您当前购买使用的套餐包暂未开通【在线用户列表】功能，请升级至旗舰版进行体验","您当前购买使用的套餐包暂未开通此功能":"您当前购买使用的套餐包暂未开通此功能。","选择提醒的人":"选择提醒的人",manage:{"群公告":"群公告","群成员":"群成员","群管理":"群管理","好友工作群":"好友工作群","陌生人社交群":"陌生人社交群","临时会议群":"临时会议群","直播群":"直播群","自由加入":"自由加入","需要验证":"需要验证","禁止加群":"禁止加群","人":"人","群ID":"群ID","群头像":"群头像","群类型":"群类型","加群方式":"加群方式","转让群组":"转让群组","解散群聊":"解散群聊","退出群组":"退出群组","群管理员":"群管理员","全员禁言":"全员禁言","全员禁言开启后，只允许群主和管理员发言。":"全员禁言开启后，只允许群主和管理员发言。","单独禁言人员":"单独禁言人员","删除成员":"删除成员","确定从群聊中删除该成员？":"确定从群聊中删除该成员？","确定从群聊中删除所选成员？":"确定从群聊中删除所选成员？","暂无公告":"暂无公告","发布":"发布","编辑":"编辑","群名称":"群名称","查看更多":"查看更多","管理员":"管理员","群主":"群主","我":"我","添加成员":"添加成员","新增管理员":"新增管理员","移除管理员":"移除管理员","新增禁言用户":"新增禁言用户","移除禁言用户":"移除禁言用户","修改群聊名称":"修改群聊名称","修改群聊名称后，将在群内通知其他成员":"修改群聊名称后，将在群内通知其他成员","仅限中文、字母、数字和下划线，2-20个字":"仅限中文、字母、数字和下划线，2-20个字","请先注册 TUIGroup 模块":"请先注册 TUIGroup 模块","该用户不存在":"该用户不存在","该用户不在群组内":"该用户不在群组内"}},TUIConversation:{"发起单聊":"发起单聊","发起群聊":"发起群聊","请输入userID":"请输入userID","删除会话":"删除会话","置顶会话":"置顶会话","取消置顶":"取消置顶","消息免打扰":"消息免打扰","取消免打扰":"取消免打扰","系统通知":"系统通知","有人@我":"有人{'@'}我","@所有人":"{'@'}所有人","条":"条","我":"我","网络异常，请您检查网络设置":"网络异常，请您检查网络设置"},TUIGroup:{"输入groupID搜索":"输入groupID搜索","群名称":"群名称","群ID":"群ID","加入群聊":"加入群聊","解散群聊":"解散群聊","退出群聊":"退出群聊","群类型":"群类型","请填写验证信息":"请填写验证信息","申请加入":"申请加入","已申请":"已申请"},TUIProfile:{"资料设置":"资料设置","头像":"头像","昵称":"昵称","账号":"账号","个性签名":"个性签名","性别":"性别","男":"男","女":"女","不显示":"不显示","出生年月":"出生年月","取消":"取消","保存":"保存","请选择出生日期":"请选择出生日期","选择头像":"选择头像","设置昵称":"设置昵称","仅限中文、字母、数字和下划线，2-20个字":"仅限中文、字母、数字和下划线，2-20个字","请输入昵称":"请输入昵称","性别选择":"性别选择","请输入内容":"请输入内容","用户ID":"用户ID","暂未设置":"暂未设置"},TUIContact:{"群聊通知":"群聊通知","系统通知":"系统通知","我的群聊":"我的群聊","输入群ID，按回车搜索":"输入群ID，按回车搜索","群名称":"群名称","群ID":"群ID","加入群聊":"加入群聊","解散群聊":"解散群聊","退出群聊":"退出群聊","进入群聊":"进入群聊","群类型":"群类型","请填写验证信息":"请填写验证信息","申请加入":"申请加入","已申请":"已申请","接受":"接受","拒绝":"拒绝","已处理":"已处理","添加群聊":"添加群聊","已加入":"已加入","该群组不存在":"该群组不存在","加群":"加群","我的好友":"我的好友","发送消息":"发送消息","个性签名":"个性签名"},message:{tip:{"群成员":"群成员","加入群组":"加入群组","退出群组":"退出群组","被":"被","踢出群组":"踢出群组","成为管理员":"成为管理员","被撤销管理员":"被撤销管理员","被禁言":"被禁言","被取消禁言":"被取消禁言","群提示消息":"群提示消息","管理员":"管理员","开启全员禁言":"开启全员禁言","取消全员禁言":"取消全员禁言","成为新的群主":"成为新的群主","修改群名为":"修改群名为","发布新公告":"发布新公告","申请加入群组":"申请加入群组","成功加入群组":"成功加入群组","被拒绝":"被拒绝","你被管理员":"你被管理员","群":"群","解散":"解散","创建群":"创建群","邀请你加群":"邀请你加群","你退出群组":"你退出群组","你被":"你被","设置为群":"设置为群","的管理员":"的管理员","撤销群":"撤销群","的管理员身份":"的管理员身份","同意加群":"同意加群","拒接加群":"拒接加群","自定义群系统通知":"自定义群系统通知"},custom:{"自定义消息":"自定义消息","通话时长":"通话时长","结束群聊":"结束群聊","切换语音通话":"切换语音通话","切换视频通话":"切换视频通话","发起通话":"发起通话","取消通话":"取消通话","已接听":"已接听","拒绝通话":"拒绝通话","无应答":"无应答","对本次服务评价":"对本次服务评价","查看详情>>":"查看详情>>"}},component:{"取消":"取消","完成":"完成","已选中":"已选中","人":"人","保存":"保存","请输入userID":"请输入用户名或者'Staff 1'来开始聊天","确定":"确定","全选":"全选","已在群聊中":"已在群聊中"},time:{"周":"周","天":"天","小时":"小时","分钟":"分钟","刚刚":"刚刚","前":"前","昨天":"昨天","星期一":"星期一","星期二":"星期二","星期三":"星期三","星期四":"星期四","星期五":"星期五","星期六":"星期六","星期日":"星期日"},Evaluate:{"请对本次服务进行评价":"请对本次服务进行评价","提交评价":"提交评价","服务评价工具":"服务评价工具","使用":"使用","自定义消息":"自定义消息","搭建":"搭建","星":"星"},Words:{"常用语-快捷回复工具":"常用语-快捷回复工具","在吗？在吗？在吗？重要的话说三遍。":"在吗？在吗？在吗？重要的话说三遍。","好久没聊天了，快来和我说说话～":"好久没聊天了，快来和我说说话～","好的，就这么说定了。":"好的，就这么说定了。","感恩的心，感谢有你。":"感恩的心，感谢有你。","糟糕！是心动的感觉！":"糟糕！是心动的感觉！","心疼地抱抱自己，我太难了！":"心疼地抱抱自己，我太难了！","没关系，别在意，事情过去就过去了。":"没关系，别在意，事情过去就过去了。","早上好，今天也是让人期待的一天呢！":"早上好，今天也是让人期待的一天呢！","熬夜有什么用，又没人陪你聊天，早点休息吧。":"熬夜有什么用，又没人陪你聊天，早点休息吧。"},TUISearch:{"发起会话":"发起会话","发起单聊":"游客交流/在线客服",ai:"AI客服","发起群聊":"发起群聊","该用户不存在":"该用户不存在","创建群聊，请注册 TUIGroup 模块":"创建群聊，请注册 TUIGroup 模块","创建成功":"创建成功","发起多人会话（群聊）":"发起多人会话（群聊）","群头像":"群头像","群名称":"群名称","群ID":"群ID","群类型":"群类型","选填":"选填","取消":"取消","创建":"创建","类似普通微信群，创建后仅支持已在群内的好友邀请加群，且无需被邀请方同意或群主神奇。详见":"类似普通微信群，创建后仅支持已在群内的好友邀请加群，且无需被邀请方同意或群主神奇。详见","类似 QQ 群，创建后群主可以指定群管理员，用户搜索群 ID 发起加群申请后，需要群主或管理员审批通过才能入群。详见":"类似 QQ 群，创建后群主可以指定群管理员，用户搜索群 ID 发起加群申请后，需要群主或管理员审批通过才能入群。详见","创建后可以随意进出，且支持查看入群前消息；适合用于音视频会议场景、在线教育场景等与实时音视频产品结合的场景。详见":"创建后可以随意进出，且支持查看入群前消息；适合用于音视频会议场景、在线教育场景等与实时音视频产品结合的场景。详见","创建后可以随意进出，没有群成员数量上限，但不支持历史消息存储；适合与直播产品结合，用于弹幕聊天场景。详见":"创建后可以随意进出，没有群成员数量上限，但不支持历史消息存储；适合与直播产品结合，用于弹幕聊天场景。详见","产品文档":"产品文档","设置群名称":"设置群名称","请输入群名称":"请输入群名称","设置群ID":"设置群ID","请输入群ID":"请输入群ID","选择群类型":"选择群类型"}}}};class Ki{constructor(e){this.messages={en:{},zh_cn:{}},this.messages=e}static getInstance(){return Ki.instance||(Ki.instance=new Ki(ji)),Ki.instance}provideMessage(e){return this.messages.en={...this.messages.en,...e.en},this.messages.zh_cn={...this.messages.zh_cn,...e.zh_cn},this.messages}useI18n(){return Fi()}static install(e){const t=Ki.getInstance();t.i18n=Gi({legacy:!1,globalInjection:!0,global:!0,locale:"zh_cn",fallbackLocale:"zh_cn",messages:t.messages}),e.use(t.i18n)}static plugin(e){e.config.i18n=Ki.getInstance()}}const zi=function(){const e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),n=/(?:SymbianOS)/.test(e)||t,i=/(?:Android)/.test(e),r=/(?:Firefox)/.test(e),o=/(?:iPad|PlayBook)/.test(e)||i&&!/(?:Mobile)/.test(e)||r&&/(?:Tablet)/.test(e),a=/(?:iPhone)/.test(e)&&!o;return{isTablet:o,isPhone:a,isAndroid:i,isPC:!a&&!i&&!n,isH5:a||i||o}},Wi=[{name:"TUILongPress",callback:(e,t,n)=>{if("function"!=typeof t.value){const e=n.context.name;let i=`[longpress:] provided expression '${t.expression}' is not afunction, but has to be `;e&&(i+=`Found in component '${e}' `)}let i=null;const r=e=>{"click"===e.type&&0!==e.button||null===i&&(i=setTimeout((()=>{a(e)}),1e3))},o=e=>{null!==i&&(clearTimeout(i),i=null)},a=e=>{t.value(e)};e.addEventListener("mousedown",r,!1),e.addEventListener("touchstart",r,!1),e.addEventListener("click",o),e.addEventListener("mouseout",o),e.addEventListener("touchend",o),e.addEventListener("touchcancel",o)}}];const Yi="https://web.sdk.qcloud.com/im/assets/emoji/",$i={"[NO]":"emoji_0@2x.png","[OK]":"emoji_1@2x.png","[下雨]":"emoji_2@2x.png","[么么哒]":"emoji_3@2x.png","[乒乓]":"emoji_4@2x.png","[便便]":"emoji_5@2x.png","[信封]":"emoji_6@2x.png","[偷笑]":"emoji_7@2x.png","[傲慢]":"emoji_8@2x.png","[再见]":"emoji_9@2x.png","[冷汗]":"emoji_10@2x.png","[凋谢]":"emoji_11@2x.png","[刀]":"emoji_12@2x.png","[删除]":"emoji_13@2x.png","[勾引]":"emoji_14@2x.png","[发呆]":"emoji_15@2x.png","[发抖]":"emoji_16@2x.png","[可怜]":"emoji_17@2x.png","[可爱]":"emoji_18@2x.png","[右哼哼]":"emoji_19@2x.png","[右太极]":"emoji_20@2x.png","[右车头]":"emoji_21@2x.png","[吐]":"emoji_22@2x.png","[吓]":"emoji_23@2x.png","[咒骂]":"emoji_24@2x.png","[咖啡]":"emoji_25@2x.png","[啤酒]":"emoji_26@2x.png","[嘘]":"emoji_27@2x.png","[回头]":"emoji_28@2x.png","[困]":"emoji_29@2x.png","[坏笑]":"emoji_30@2x.png","[多云]":"emoji_31@2x.png","[大兵]":"emoji_32@2x.png","[大哭]":"emoji_33@2x.png","[太阳]":"emoji_34@2x.png","[奋斗]":"emoji_35@2x.png","[奶瓶]":"emoji_36@2x.png","[委屈]":"emoji_37@2x.png","[害羞]":"emoji_38@2x.png","[尴尬]":"emoji_39@2x.png","[左哼哼]":"emoji_40@2x.png","[左太极]":"emoji_41@2x.png","[左车头]":"emoji_42@2x.png","[差劲]":"emoji_43@2x.png","[弱]":"emoji_44@2x.png","[强]":"emoji_45@2x.png","[彩带]":"emoji_46@2x.png","[彩球]":"emoji_47@2x.png","[得意]":"emoji_48@2x.png","[微笑]":"emoji_49@2x.png","[心碎了]":"emoji_50@2x.png","[快哭了]":"emoji_51@2x.png","[怄火]":"emoji_52@2x.png","[怒]":"emoji_53@2x.png","[惊恐]":"emoji_54@2x.png","[惊讶]":"emoji_55@2x.png","[憨笑]":"emoji_56@2x.png","[手枪]":"emoji_57@2x.png","[打哈欠]":"emoji_58@2x.png","[抓狂]":"emoji_59@2x.png","[折磨]":"emoji_60@2x.png","[抠鼻]":"emoji_61@2x.png","[抱抱]":"emoji_62@2x.png","[抱拳]":"emoji_63@2x.png","[拳头]":"emoji_64@2x.png","[挥手]":"emoji_65@2x.png","[握手]":"emoji_66@2x.png","[撇嘴]":"emoji_67@2x.png","[擦汗]":"emoji_68@2x.png","[敲打]":"emoji_69@2x.png","[晕]":"emoji_70@2x.png","[月亮]":"emoji_71@2x.png","[棒棒糖]":"emoji_72@2x.png","[汽车]":"emoji_73@2x.png","[沙发]":"emoji_74@2x.png","[流汗]":"emoji_75@2x.png","[流泪]":"emoji_76@2x.png","[激动]":"emoji_77@2x.png","[灯泡]":"emoji_78@2x.png","[炸弹]":"emoji_79@2x.png","[熊猫]":"emoji_80@2x.png","[爆筋]":"emoji_81@2x.png","[爱你]":"emoji_82@2x.png","[爱心]":"emoji_83@2x.png","[爱情]":"emoji_84@2x.png","[猪头]":"emoji_85@2x.png","[猫咪]":"emoji_86@2x.png","[献吻]":"emoji_87@2x.png","[玫瑰]":"emoji_88@2x.png","[瓢虫]":"emoji_89@2x.png","[疑问]":"emoji_90@2x.png","[白眼]":"emoji_91@2x.png","[皮球]":"emoji_92@2x.png","[睡觉]":"emoji_93@2x.png","[磕头]":"emoji_94@2x.png","[示爱]":"emoji_95@2x.png","[礼品袋]":"emoji_96@2x.png","[礼物]":"emoji_97@2x.png","[篮球]":"emoji_98@2x.png","[米饭]":"emoji_99@2x.png","[糗大了]":"emoji_100@2x.png","[红双喜]":"emoji_101@2x.png","[红灯笼]":"emoji_102@2x.png","[纸巾]":"emoji_103@2x.png","[胜利]":"emoji_104@2x.png","[色]":"emoji_105@2x.png","[药]":"emoji_106@2x.png","[菜刀]":"emoji_107@2x.png","[蛋糕]":"emoji_108@2x.png","[蜡烛]":"emoji_109@2x.png","[街舞]":"emoji_110@2x.png","[衰]":"emoji_111@2x.png","[西瓜]":"emoji_112@2x.png","[调皮]":"emoji_113@2x.png","[象棋]":"emoji_114@2x.png","[跳绳]":"emoji_115@2x.png","[跳跳]":"emoji_116@2x.png","[车厢]":"emoji_117@2x.png","[转圈]":"emoji_118@2x.png","[鄙视]":"emoji_119@2x.png","[酷]":"emoji_120@2x.png","[钞票]":"emoji_121@2x.png","[钻戒]":"emoji_122@2x.png","[闪电]":"emoji_123@2x.png","[闭嘴]":"emoji_124@2x.png","[闹钟]":"emoji_125@2x.png","[阴险]":"emoji_126@2x.png","[难过]":"emoji_127@2x.png","[雨伞]":"emoji_128@2x.png","[青蛙]":"emoji_129@2x.png","[面条]":"emoji_130@2x.png","[鞭炮]":"emoji_131@2x.png","[风车]":"emoji_132@2x.png","[飞吻]":"emoji_133@2x.png","[飞机]":"emoji_134@2x.png","[饥饿]":"emoji_135@2x.png","[香蕉]":"emoji_136@2x.png","[骷髅]":"emoji_137@2x.png","[麦克风]":"emoji_138@2x.png","[麻将]":"emoji_139@2x.png","[鼓掌]":"emoji_140@2x.png","[龇牙]":"emoji_141@2x.png"},Ji=["[龇牙]","[调皮]","[流汗]","[偷笑]","[再见]","[敲打]","[擦汗]","[猪头]","[玫瑰]","[流泪]","[大哭]","[嘘]","[酷]","[抓狂]","[委屈]","[便便]","[炸弹]","[菜刀]","[可爱]","[色]","[害羞]","[得意]","[吐]","[微笑]","[怒]","[尴尬]","[惊恐]","[冷汗]","[爱心]","[示爱]","[白眼]","[傲慢]","[难过]","[惊讶]","[疑问]","[困]","[么么哒]","[憨笑]","[爱情]","[衰]","[撇嘴]","[阴险]","[奋斗]","[发呆]","[右哼哼]","[抱抱]","[坏笑]","[飞吻]","[鄙视]","[晕]","[大兵]","[可怜]","[强]","[弱]","[握手]","[胜利]","[抱拳]","[凋谢]","[米饭]","[蛋糕]","[西瓜]","[啤酒]","[瓢虫]","[勾引]","[OK]","[爱你]","[咖啡]","[月亮]","[刀]","[发抖]","[差劲]","[拳头]","[心碎了]","[太阳]","[礼物]","[皮球]","[骷髅]","[挥手]","[闪电]","[饥饿]","[咒骂]","[折磨]","[抠鼻]","[鼓掌]","[糗大了]","[左哼哼]","[打哈欠]","[快哭了]","[吓]","[篮球]","[乒乓]","[NO]","[跳跳]","[怄火]","[转圈]","[磕头]","[回头]","[跳绳]","[激动]","[街舞]","[献吻]","[左太极]","[右太极]","[闭嘴]","[猫咪]","[红双喜]","[鞭炮]","[红灯笼]","[麻将]","[麦克风]","[礼品袋]","[信封]","[象棋]","[彩带]","[蜡烛]","[爆筋]","[棒棒糖]","[奶瓶]","[面条]","[香蕉]","[飞机]","[左车头]","[车厢]","[右车头]","[多云]","[下雨]","[钞票]","[熊猫]","[灯泡]","[风车]","[闹钟]","[雨伞]","[彩球]","[钻戒]","[沙发]","[纸巾]","[手枪]","[青蛙]"],Xi=[{icon:1,list:["yz00","yz01","yz02","yz03","yz04","yz05","yz06","yz07","yz08","yz09","yz10","yz11","yz12","yz13","yz14","yz15","yz16","yz17"]},{icon:2,list:["ys00","ys01","ys02","ys03","ys04","ys05","ys06","ys07","ys08","ys09","ys10","ys11","ys12","ys13","ys14","ys15"]},{icon:3,list:["gcs00","gcs01","gcs02","gcs03","gcs04","gcs05","gcs06","gcs07","gcs08","gcs09","gcs10","gcs11","gcs12","gcs13","gcs14","gcs15","gcs16"]}];function Zi(e){const t=[];let n=e.text,i=-1,r=-1;for(;""!==n;)switch(i=n.indexOf("["),r=n.indexOf("]"),i){case 0:if(-1===r)t.push({name:"text",text:n}),n="";else{const e=n.slice(0,r+1);$i[e]?(t.push({name:"img",src:Yi+$i[e]}),n=n.substring(r+1)):(t.push({name:"text",text:"["}),n=n.slice(1))}break;case-1:t.push({name:"text",text:n}),n="";break;default:t.push({name:"text",text:n.slice(0,i)}),n=n.substring(i)}return t}var Qi={};({get exports(){return Qi},set exports(e){Qi=e}}).exports=function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){a(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(fe){return!1}}function d(e,t,n){return(d=l()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&u(r,n.prototype),r}).apply(null,arguments)}function p(e){var t="function"==typeof Map?new Map:void 0;return(p=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return d(e,arguments,c(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),u(i,e)})(e)}function h(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}function m(e){var t=l();return function(){var n,i=c(e);if(t){var r=c(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}function v(e,t){return y(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);a=!0);}catch(c){s=!0,r=c}finally{try{a||null==n.return||n.return()}finally{if(s)throw r}}return o}}(e,t)||M(e,t)||S()}function _(e){return function(e){if(Array.isArray(e))return T(e)}(e)||I(e)||M(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e){if(Array.isArray(e))return e}function I(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function M(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function S(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function E(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=M(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}var k={SDK_READY:"sdkStateReady",SDK_NOT_READY:"sdkStateNotReady",SDK_DESTROY:"sdkDestroy",MESSAGE_RECEIVED:"onMessageReceived",MESSAGE_MODIFIED:"onMessageModified",MESSAGE_REVOKED:"onMessageRevoked",MESSAGE_READ_BY_PEER:"onMessageReadByPeer",MESSAGE_READ_RECEIPT_RECEIVED:"onMessageReadReceiptReceived",MESSAGE_EXTENSIONS_UPDATED:"onMessageExtensionsUpdated",MESSAGE_EXTENSIONS_DELETED:"onMessageExtensionsDeleted",CONVERSATION_LIST_UPDATED:"onConversationListUpdated",TOTAL_UNREAD_MESSAGE_COUNT_UPDATED:"onTotalUnreadMessageCountUpdated",CONVERSATION_GROUP_LIST_UPDATED:"onConversationGroupListUpdated",CONVERSATION_IN_GROUP_UPDATED:"onConversationInGroupUpdated",GROUP_LIST_UPDATED:"onGroupListUpdated",GROUP_SYSTEM_NOTICE_RECEIVED:"receiveGroupSystemNotice",GROUP_ATTRIBUTES_UPDATED:"groupAttributesUpdated",GROUP_COUNTER_UPDATED:"onGroupCounterUpdated",TOPIC_CREATED:"onTopicCreated",TOPIC_DELETED:"onTopicDeleted",TOPIC_UPDATED:"onTopicUpdated",PROFILE_UPDATED:"onProfileUpdated",USER_STATUS_UPDATED:"onUserStatusUpdated",BLACKLIST_UPDATED:"blacklistUpdated",FRIEND_LIST_UPDATED:"onFriendListUpdated",FRIEND_GROUP_LIST_UPDATED:"onFriendGroupListUpdated",FRIEND_APPLICATION_LIST_UPDATED:"onFriendApplicationListUpdated",KICKED_OUT:"kickedOut",ERROR:"error",NET_STATE_CHANGE:"netStateChange",SDK_RELOAD:"sdkReload"},b={MSG_TEXT:"TIMTextElem",MSG_IMAGE:"TIMImageElem",MSG_SOUND:"TIMSoundElem",MSG_AUDIO:"TIMSoundElem",MSG_FILE:"TIMFileElem",MSG_FACE:"TIMFaceElem",MSG_VIDEO:"TIMVideoFileElem",MSG_GEO:"TIMLocationElem",MSG_LOCATION:"TIMLocationElem",MSG_GRP_TIP:"TIMGroupTipElem",MSG_GRP_SYS_NOTICE:"TIMGroupSystemNoticeElem",MSG_CUSTOM:"TIMCustomElem",MSG_MERGER:"TIMRelayElem",MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",CONV_C2C:"C2C",CONV_GROUP:"GROUP",CONV_TOPIC:"TOPIC",CONV_SYSTEM:"@TIM#SYSTEM",CONV_AT_ME:1,CONV_AT_ALL:2,CONV_AT_ALL_AT_ME:3,CONV_MARK_TYPE_STAR:1,CONV_MARK_TYPE_UNREAD:2,CONV_MARK_TYPE_FOLD:4,CONV_MARK_TYPE_HIDE:8,GRP_PRIVATE:"Private",GRP_WORK:"Private",GRP_PUBLIC:"Public",GRP_CHATROOM:"ChatRoom",GRP_MEETING:"ChatRoom",GRP_AVCHATROOM:"AVChatRoom",GRP_COMMUNITY:"Community",GRP_MBR_ROLE_OWNER:"Owner",GRP_MBR_ROLE_ADMIN:"Admin",GRP_MBR_ROLE_MEMBER:"Member",GRP_MBR_ROLE_CUSTOM:"Custom",GRP_TIP_MBR_JOIN:1,GRP_TIP_MBR_QUIT:2,GRP_TIP_MBR_KICKED_OUT:3,GRP_TIP_MBR_SET_ADMIN:4,GRP_TIP_MBR_CANCELED_ADMIN:5,GRP_TIP_GRP_PROFILE_UPDATED:6,GRP_TIP_MBR_PROFILE_UPDATED:7,GRP_TIP_BAN_AVCHATROOM_MEMBER:10,GRP_TIP_UNBAN_AVCHATROOM_MEMBER:11,MSG_REMIND_ACPT_AND_NOTE:"AcceptAndNotify",MSG_REMIND_ACPT_NOT_NOTE:"AcceptNotNotify",MSG_REMIND_DISCARD:"Discard",GENDER_UNKNOWN:"Gender_Type_Unknown",GENDER_FEMALE:"Gender_Type_Female",GENDER_MALE:"Gender_Type_Male",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",KICKED_OUT_REST_API:"REST_API_Kick",ALLOW_TYPE_ALLOW_ANY:"AllowType_Type_AllowAny",ALLOW_TYPE_NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_TYPE_DENY_ANY:"AllowType_Type_DenyAny",FORBID_TYPE_NONE:"AdminForbid_Type_None",FORBID_TYPE_SEND_OUT:"AdminForbid_Type_SendOut",JOIN_OPTIONS_FREE_ACCESS:"FreeAccess",JOIN_OPTIONS_NEED_PERMISSION:"NeedPermission",JOIN_OPTIONS_DISABLE_APPLY:"DisableApply",JOIN_STATUS_SUCCESS:"JoinedSuccess",JOIN_STATUS_ALREADY_IN_GROUP:"AlreadyInGroup",JOIN_STATUS_WAIT_APPROVAL:"WaitAdminApproval",INVITE_OPTIONS_DISABLE_INVITE:"DisableInvite",INVITE_OPTIONS_NEED_PERMISSION:"NeedPermission",INVITE_OPTIONS_FREE_ACCESS:"FreeAccess",GRP_PROFILE_OWNER_ID:"ownerID",GRP_PROFILE_CREATE_TIME:"createTime",GRP_PROFILE_LAST_INFO_TIME:"lastInfoTime",GRP_PROFILE_MEMBER_NUM:"memberNum",GRP_PROFILE_MAX_MEMBER_NUM:"maxMemberNum",GRP_PROFILE_JOIN_OPTION:"joinOption",GRP_PROFILE_INVITE_OPTION:"inviteOption",GRP_PROFILE_INTRODUCTION:"introduction",GRP_PROFILE_NOTIFICATION:"notification",GRP_PROFILE_MUTE_ALL_MBRS:"muteAllMembers",SNS_ADD_TYPE_SINGLE:"Add_Type_Single",SNS_ADD_TYPE_BOTH:"Add_Type_Both",SNS_DELETE_TYPE_SINGLE:"Delete_Type_Single",SNS_DELETE_TYPE_BOTH:"Delete_Type_Both",SNS_APPLICATION_TYPE_BOTH:"Pendency_Type_Both",SNS_APPLICATION_SENT_TO_ME:"Pendency_Type_ComeIn",SNS_APPLICATION_SENT_BY_ME:"Pendency_Type_SendOut",SNS_APPLICATION_AGREE:"Response_Action_Agree",SNS_APPLICATION_AGREE_AND_ADD:"Response_Action_AgreeAndAdd",SNS_CHECK_TYPE_BOTH:"CheckResult_Type_Both",SNS_CHECK_TYPE_SINGLE:"CheckResult_Type_Single",SNS_TYPE_NO_RELATION:"CheckResult_Type_NoRelation",SNS_TYPE_A_WITH_B:"CheckResult_Type_AWithB",SNS_TYPE_B_WITH_A:"CheckResult_Type_BWithA",SNS_TYPE_BOTH_WAY:"CheckResult_Type_BothWay",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",MSG_AT_ALL:"__kImSDK_MesssageAtALL__",READ_ALL_C2C_MSG:"readAllC2CMessage",READ_ALL_GROUP_MSG:"readAllGroupMessage",READ_ALL_MSG:"readAllMessage",USER_STATUS_UNKNOWN:0,USER_STATUS_ONLINE:1,USER_STATUS_OFFLINE:2,USER_STATUS_UNLOGINED:3},D=function(){function e(){i(this,e),this.cache=[],this.options=null}return o(e,[{key:"use",value:function(e){if("function"!=typeof e)throw"middleware must be a function";return this.cache.push(e),this}},{key:"next",value:function(e){if(this.middlewares&&this.middlewares.length>0)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}},{key:"run",value:function(e){return this.middlewares=this.cache.map((function(e){return e})),this.options=e,this.next()}}]),e}(),w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i(this,e),this.high=t,this.low=n}return o(e,[{key:"equal",value:function(e){return null!==e&&this.low===e.low&&this.high===e.high}},{key:"toString",value:function(){var e=Number(this.high).toString(16),t=Number(this.low).toString(16);if(t.length<8)for(var n=8-t.length;n;)t="0"+t,n--;return e+t}}]),e}(),A={TEST:{CHINA:{DEFAULT:"wss://wss-dev.tim.qq.com"},OVERSEA:{DEFAULT:"wss://wss-dev.tim.qq.com"},SINGAPORE:{DEFAULT:"wss://wsssgp-dev.im.qcloud.com"},KOREA:{DEFAULT:"wss://wsskr-dev.im.qcloud.com"},GERMANY:{DEFAULT:"wss://wssger-dev.im.qcloud.com"},IND:{DEFAULT:"wss://wssind-dev.im.qcloud.com"},JPN:{DEFAULT:"wss://wssjpn-dev.im.qcloud.com"},USA:{DEFAULT:"wss://wssusa-dev.im.qcloud.com"}},PRODUCTION:{CHINA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.tim.qq.com",STAT:"https://events.im.qcloud.com",ANYCAST:"wss://162.14.13.203"},OVERSEA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.my-imcloud.com",STAT:"https://api.my-imcloud.com"},SINGAPORE:{DEFAULT:"wss://wsssgp.im.qcloud.com",BACKUP:"wss://wsssgp.my-imcloud.com",STAT:"https://apisgp.my-imcloud.com"},KOREA:{DEFAULT:"wss://wsskr.im.qcloud.com",BACKUP:"wss://wsskr.my-imcloud.com",STAT:"https://apikr.my-imcloud.com"},GERMANY:{DEFAULT:"wss://wssger.im.qcloud.com",BACKUP:"wss://wssger.my-imcloud.com",STAT:"https://apiger.my-imcloud.com"},IND:{DEFAULT:"wss://wssind.my-imcloud.com",BACKUP:"wss://wssind.im.qcloud.com",STAT:"https://apiind.my-imcloud.com"},JPN:{DEFAULT:"wss://wssjpn.im.qcloud.com",BACKUP:"wss://wssjpn.my-imcloud.com",STAT:"https://apijpn.my-imcloud.com"},USA:{DEFAULT:"wss://wssusa.im.qcloud.com",BACKUP:"wss://wssusa.my-imcloud.com",STAT:"https://apiusa.my-imcloud.com"}}},R={ANDROID:2,IOS:3,MAC:4,WEB:7,WX_MP:8,QQ_MP:9,TT_MP:10,BAIDU_MP:11,ALI_MP:12,IPAD:13,UNI_NATIVE_APP:15},L="1.7.3",O=537048168,N="CHINA",P="OVERSEA",U="SINGAPORE",x="KOREA",G="GERMANY",F="IND",V="JPN",q="USA",B={HOST:{CURRENT:{DEFAULT:"wss://wss.im.qcloud.com",STAT:"https://events.im.qcloud.com"},setCurrent:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N;this.CURRENT=A.PRODUCTION[e]}},NAME:{OPEN_IM:"openim",OPEN_IM_MSG_EXT:"openim_msg_ext_http_svc",GROUP:"group_open_http_svc",GROUP_AVCHATROOM:"group_open_avchatroom_http_svc",GROUP_COMMUNITY:"million_group_open_http_svc",GROUP_ATTR:"group_open_attr_http_svc",FRIEND:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GROUP_NO_AUTH:"group_open_http_noauth_svc",BIG_GROUP_LONG_POLLING:"group_open_long_polling_http_svc",BIG_GROUP_LONG_POLLING_NO_AUTH:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",WEB_IM:"webim",IM_COS_SIGN:"im_cos_sign_svr",CUSTOM_UPLOAD:"im_cos_msg",HEARTBEAT:"heartbeat",IM_OPEN_PUSH:"im_open_push",IM_OPEN_STATUS:"im_open_status",IM_LONG_MESSAGE:"im_long_msg",IM_CONFIG_MANAGER:"im_sdk_config_mgr",STAT_SERVICE:"StatSvc",OVERLOAD_PUSH:"OverLoadPush",IM_MSG_AUDIT_MGR:"im_msg_audit_mgr",TUIROOM_SVR:"tui_room_svr",IM_OPEN_TRANSLATE:"im_open_translate"},CMD:{LOGIN:"wslogin",LOGOUT_LONG_POLL:"longpollinglogout",LOGOUT:"wslogout",HELLO:"wshello",STAT_BACKGROUND:"ws_stat_background",STAT_FOREGROUND:"ws_stat_foreground",SET_TOKEN:"ws_stat_settoken",PORTRAIT_GET:"portrait_get_all",PORTRAIT_SET:"portrait_set",GET_LONG_POLL_ID:"getlongpollingid",LONG_POLL:"longpolling",AVCHATROOM_LONG_POLL:"get_msg",ADD_FRIEND:"friend_add",UPDATE_FRIEND:"friend_update",GET_FRIEND_LIST:"friend_get",GET_FRIEND_PROFILE:"friend_get_specified",DELETE_FRIEND:"friend_delete",CHECK_FRIEND:"friend_check",GET_FRIEND_GROUP_LIST:"group_get",RESPOND_FRIEND_APPLICATION:"friend_response",GET_FRIEND_APPLICATION_LIST:"pendency_get",DELETE_FRIEND_APPLICATION:"pendency_delete",REPORT_FRIEND_APPLICATION:"pendency_report",GET_GROUP_APPLICATION:"get_pendency",CREATE_FRIEND_GROUP:"group_add",DELETE_FRIEND_GROUP:"group_delete",UPDATE_FRIEND_GROUP:"group_update",GET_BLACKLIST:"black_list_get",ADD_BLACKLIST:"black_list_add",DELETE_BLACKLIST:"black_list_delete",CREATE_GROUP:"create_group",GET_JOINED_GROUPS:"get_joined_group_list",SET_GROUP_ATTRIBUTES:"set_group_attr",MODIFY_GROUP_ATTRIBUTES:"modify_group_attr",DELETE_GROUP_ATTRIBUTES:"delete_group_attr",CLEAR_GROUP_ATTRIBUTES:"clear_group_attr",GET_GROUP_ATTRIBUTES:"get_group_attr",SEND_MESSAGE:"sendmsg",REVOKE_C2C_MESSAGE:"msgwithdraw",DELETE_C2C_MESSAGE:"delete_c2c_msg_ramble",MODIFY_C2C_MESSAGE:"modify_c2c_msg",MODIFY_C2C_MESSAGE_EXTENSIONS:"set_key_values",GET_C2C_MESSAGE_EXTENSIONS:"get_key_values",SEND_GROUP_MESSAGE:"send_group_msg",REVOKE_GROUP_MESSAGE:"group_msg_recall",DELETE_GROUP_MESSAGE:"delete_group_ramble_msg_by_seq",MODIFY_GROUP_MESSAGE:"modify_group_msg",MODIFY_GROUP_MESSAGE_EXTENSIONS:"group_set_key_values",GET_GROUP_MESSAGE_EXTENSIONS:"group_get_key_values",GET_GROUP_INFO:"get_group_self_member_info",GET_GROUP_MEMBER_INFO:"get_specified_group_member_info",GET_GROUP_MEMBER_LIST:"get_group_member_info",GET_AVCHATROOM_MEMBER_LIST:"get_members",MARK_AVCHATROOM_MEMBER_INFO:"modify_user_info",QUIT_GROUP:"quit_group",CHANGE_GROUP_OWNER:"change_group_owner",DESTROY_GROUP:"destroy_group",ADD_GROUP_MEMBER:"add_group_member",DELETE_GROUP_MEMBER:"delete_group_member",BAN_AVCHATROOM_MEMBER:"ban_group_member",SEARCH_GROUP_BY_ID:"get_group_public_info",APPLY_JOIN_GROUP:"apply_join_group",HANDLE_APPLY_JOIN_GROUP:"handle_apply_join_group",HANDLE_INVITE_JOIN_GROUP:"handle_invite_join_permission_group",HANDLE_GROUP_INVITATION:"handle_invite_join_group",MODIFY_GROUP_INFO:"modify_group_base_info",MODIFY_GROUP_MEMBER_INFO:"modify_group_member_info",DELETE_GROUP_SYSTEM_MESSAGE:"deletemsg",DELETE_GROUP_AT_TIPS:"deletemsg",GET_GROUP_NOTIFY:"get_group_notify",GET_CONVERSATION_LIST:"get",PAGING_GET_CONVERSATION_LIST:"page_get",DELETE_CONVERSATION:"batch_delete",CLEAR_HISTORY_MESSAGE:"clear_msg",PIN_CONVERSATION:"top",SET_CONVERSATION_CUSTOM_DATA:"mark_contact",MARK_CONVERSATION:"mark_contact",CREATE_CONVERSATION_GROUP:"create_contact_group",DELETE_CONVERSATION_GROUP:"del_contact_group",UPDATE_CONVERSATION_GROUP:"update_contact_group",GET_CONVERSATION_GROUP_LIST:"get_contact_group",GET_MESSAGES:"getmsg",GET_C2C_ROAM_MESSAGES:"getroammsg",SET_C2C_PEER_MUTE_NOTIFICATIONS:"set_c2c_peer_mute_notifications",GET_C2C_PEER_MUTE_NOTIFICATIONS:"get_c2c_peer_mute_notifications",GET_GROUP_ROAM_MESSAGES:"group_msg_get",GET_READ_RECEIPT:"get_group_msg_receipt",GET_READ_RECEIPT_DETAIL:"get_group_msg_receipt_detail",SEND_READ_RECEIPT:"group_msg_receipt",SEND_C2C_READ_RECEIPT:"c2c_msg_read_receipt",SET_C2C_MESSAGE_READ:"msgreaded",GET_PEER_READ_TIME:"get_peer_read_time",SET_GROUP_MESSAGE_READ:"msg_read_report",FILE_READ_AND_WRITE_AUTHKEY:"authkey",FILE_UPLOAD:"pic_up",COS_SIGN:"cos",COS_PRE_SIG:"pre_sig",VIDEO_COVER:"video_cover",TIM_WEB_REPORT_V2:"tim_web_report_v2",BIG_DATA_HALLWAY_AUTH_KEY:"authkey",GET_ONLINE_MEMBER_NUM:"get_online_member_num",ALIVE:"alive",MESSAGE_PUSH:"msg_push",MULTI_MESSAGE_PUSH:"multi_msg_push_ws",MESSAGE_PUSH_ACK:"ws_msg_push_ack",STATUS_FORCE_OFFLINE:"stat_forceoffline",DOWNLOAD_MERGER_MESSAGE:"get_relay_json_msg",UPLOAD_MERGER_MESSAGE:"save_relay_json_msg",FETCH_CLOUD_CONTROL_CONFIG:"fetch_config",PUSHED_CLOUD_CONTROL_CONFIG:"push_configv2",FETCH_COMMERCIAL_CONFIG:"fetch_imsdk_purchase_bitsv2",PUSHED_COMMERCIAL_CONFIG:"push_imsdk_purchase_bitsv2",KICK_OTHER:"KickOther",OVERLOAD_NOTIFY:"notify2",SET_ALL_MESSAGE_READ:"read_all_unread_msg",CREATE_TOPIC:"create_topic",DELETE_TOPIC:"destroy_topic",UPDATE_TOPIC_PROFILE:"modify_topic",GET_TOPIC_LIST:"get_topic",SET_SELF_STATUS:"ws_set_custom_status",GET_USER_STATUS:"ws_get_user_status",SUBSCRIBE_USER_STATUS:"ws_status_subscribe",UNSUBSCRIBE_USER_STATUS:"ws_status_unsubscribe",GET_RPOFANITY_LIST:"get_local_words",TRANSLATE_TEXT:"ws_batch_trans_text",UPDATE_GROUP_COUNTER:"update_group_counter",GET_GROUP_COUNTER:"get_group_counter"},CHANNEL:{SOCKET:1,XHR:2,AUTO:0},NAME_VERSION:{openim:"v4",group_open_http_svc:"v4",sns:"v4",profile:"v4",recentcontact:"v4",openpic:"v4",group_open_http_noauth_svc:"v4",group_open_long_polling_http_svc:"v4",group_open_long_polling_http_noauth_svc:"v4",imopenstat:"v4",im_cos_sign_svr:"v4",im_cos_msg:"v4",webim:"v4",im_open_push:"v4",im_open_status:"v4"}},H={SEARCH_MSG:new w(0,Math.pow(2,0)).toString(),SEARCH_GRP_SNS:new w(0,Math.pow(2,1)).toString(),AVCHATROOM_HISTORY_MSG:new w(0,Math.pow(2,2)).toString(),GRP_COMMUNITY:new w(0,Math.pow(2,3)).toString(),MSG_TO_SPECIFIED_GRP_MBR:new w(0,Math.pow(2,4)).toString(),AVCHATROOM_MBR_LIST:new w(0,Math.pow(2,6)).toString(),USER_STATUS:new w(0,Math.pow(2,7)).toString(),CONV_MARK:new w(0,Math.pow(2,9)).toString(),CONV_GROUP:new w(0,Math.pow(2,10)).toString(),AVCHATROOM_BAN_MBR:new w(0,Math.pow(2,11)).toString(),MSG_EXT:new w(0,Math.pow(2,13)).toString(),GRP_COUNTER:new w(0,Math.pow(2,15)).toString()},j="c2c_text_message",K="c2c_custom_message",z="group_text_message",W="group_custom_message",Y="user_profile",$="sns",J="group_profile",X="group_member_profile";B.HOST.setCurrent(N);var Z="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),Q="undefined"!=typeof qq&&"function"==typeof qq.getSystemInfoSync&&Boolean(qq.getSystemInfoSync().fontSizeSetting),ee="undefined"!=typeof tt&&"function"==typeof tt.getSystemInfoSync&&Boolean(tt.getSystemInfoSync().fontSizeSetting),te="undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync&&Boolean(swan.getSystemInfoSync().fontSizeSetting),ne="undefined"!=typeof my&&"function"==typeof my.getSystemInfoSync&&Boolean(my.getSystemInfoSync().fontSizeSetting),ie="undefined"!=typeof jd&&"function"==typeof jd.getSystemInfoSync,re="undefined"!=typeof uni&&"undefined"==typeof window&&"function"==typeof uni.requireNativePlugin,oe="undefined"!=typeof uni,ae=Z||Q||ee||te||ne||re||ie,se=("undefined"!=typeof uni||"undefined"!=typeof window)&&!ae,ce=Q?qq:ee?tt:te?swan:ne?my:Z?wx:re?uni:ie?jd:{},ue=se&&window&&window.navigator&&window.navigator.userAgent||"",le=/(micromessenger|webbrowser)/i.test(ue),de=/AppleWebKit\/([\d.]+)/i.exec(ue);de&&parseFloat(de.pop());var pe,he,fe,ge=(pe="WEB",le?pe="WEB":Q?pe="QQ_MP":ee?pe="TT_MP":te?pe="BAIDU_MP":ne?pe="ALI_MP":Z?pe="WX_MP":re&&(pe="UNI_NATIVE_APP"),R[pe]),me=/iPad/i.test(ue),ve=/iPhone/i.test(ue)&&!me,_e=/iPod/i.test(ue),ye=ve||me||_e,Ie=(he=ue.match(/OS (\d+)_/i))&&he[1]?he[1]:null,Me=/Android/i.test(ue),Te=function(){var e=ue.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+"."+e[2]):t||null}();(fe=ue.match(/Chrome\/(\d+)/))&&fe[1]&&parseFloat(fe[1]);var Ce=/MSIE/.test(ue)||ue.indexOf("Trident")>-1&&ue.indexOf("rv:11.0")>-1,Se=function(){var e=/MSIE\s(\d+)\.\d/.exec(ue),t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(ue)&&/rv:11.0/.test(ue)&&(t=11),t}();!function(){var e=ue.match(/TBS\/(\d+)/i);e&&e[1]&&e[1]}();var Ee,ke,be=/Windows/i.test(ue),De=/MAC OS X/i.test(ue),we=se&&"undefined"!=typeof Worker&&!Ce,Ae=Me||ye,Re=se&&void 0!==window.tencent_cloud_im_csig_flutter_for_web_25F_cy;Ee="undefined"!=typeof console?console:void 0!==C&&C.console?C.console:"undefined"!=typeof window&&window.console?window.console:{};for(var Le=function(){},Oe=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],Ne=Oe.length;Ne--;)ke=Oe[Ne],console[ke]||(Ee[ke]=Le);var Pe=Ee,Ue=0,xe=function(){return(new Date).getTime()+Ue},Ge=function(){Ue=0},Fe=function(){return Math.floor(xe()/1e3)},Ve=0;function qe(){return Xt()?"%c TIM %c":"TIM"}function Be(){var e,t=((e=new Date).setTime(xe()),e);return t.toLocaleTimeString("en-US",{hour12:!1})+"."+function(e){var t;switch(e.toString().length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}return t}(t.getMilliseconds())}var He={arguments2String:function(e){var t="";if(1===e.length)t=e[0];else for(var n=0,i=e.length;n<i;n++)ft(e[n])?mt(e[n])?t+=It(e[n]):t+=JSON.stringify(e[n]):t+=e[n],t+=" ";return t},_exec:function(e,t){Xt()?Pe[e](qe(),"background:#0abf5b; padding:1px; border-radius:3px; color: #fff","background:transparent",Be(),t):Pe[e]("".concat(qe()," ").concat(Be()," ").concat(t))},d:function(){if(Ve<=-1){var e=this.arguments2String(arguments);this._exec("debug",e)}},l:function(){if(Ve<=0){var e=this.arguments2String(arguments);this._exec("log",e)}},log:function(){if(Ve<=0){var e=this.arguments2String(arguments);this._exec("log",e)}},i:function(){if(Ve<=1){var e=this.arguments2String(arguments);this._exec("info",e)}},w:function(){if(Ve<=2){var e=this.arguments2String(arguments);this._exec("warn",e)}},e:function(){if(Ve<=3){var e=this.arguments2String(arguments);this._exec("error",e)}},setLevel:function(e){e<4&&this._exec("log","set level from "+Ve+" to "+e),Ve=e},getLevel:function(){return Ve}},je={JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255},Ke={NICK:"Tag_Profile_IM_Nick",GENDER:"Tag_Profile_IM_Gender",BIRTHDAY:"Tag_Profile_IM_BirthDay",LOCATION:"Tag_Profile_IM_Location",SELFSIGNATURE:"Tag_Profile_IM_SelfSignature",ALLOWTYPE:"Tag_Profile_IM_AllowType",LANGUAGE:"Tag_Profile_IM_Language",AVATAR:"Tag_Profile_IM_Image",MESSAGESETTINGS:"Tag_Profile_IM_MsgSettings",ADMINFORBIDTYPE:"Tag_Profile_IM_AdminForbidType",LEVEL:"Tag_Profile_IM_Level",ROLE:"Tag_Profile_IM_Role"},ze="Tag_SNS_IM_Group",We="Tag_SNS_IM_Remark",Ye="Tag_SNS_IM_AddSource",$e="Tag_SNS_IM_AddWording",Je="Tag_SNS_IM_AddTime",Xe={UNKNOWN:"Gender_Type_Unknown",FEMALE:"Gender_Type_Female",MALE:"Gender_Type_Male"},Ze={NONE:"AdminForbid_Type_None",SEND_OUT:"AdminForbid_Type_SendOut"},Qe={NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_ANY:"AllowType_Type_AllowAny",DENY_ANY:"AllowType_Type_DenyAny"},et="JoinedSuccess",nt="WaitAdminApproval",it="@TGS#_",rt="@TOPIC#_",ot=["url"],at=function(e){return"map"===vt(e)},st=function(e){return"file"===vt(e)},ct=function(e){return null!==e&&("number"==typeof e&&!isNaN(e-0)||"object"===n(e)&&e.constructor===Number)},ut=function(e){return"string"==typeof e},lt=function(e){return null!==e&&"object"===n(e)},dt=function(e){if("object"!==n(e)||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var i=t;null!==Object.getPrototypeOf(i);)i=Object.getPrototypeOf(i);return t===i},pt=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"array"===vt(e)},ht=function(e){return void 0===e},ft=function(e){return pt(e)||lt(e)},gt=function(e){return"function"==typeof e},mt=function(e){return e instanceof Error},vt=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()},_t=function(e){if("string"!=typeof e)return!1;var t=e[0];return!/[^a-zA-Z0-9]/.test(t)};Date.now||(Date.now=function(){return(new Date).getTime()});var yt=function e(t,n,i,r){if(!ft(t)||!ft(n))return 0;for(var o,a=0,s=Object.keys(n),c=0,u=s.length;c<u;c++)if(o=s[c],!(ht(n[o])||i&&i.includes(o)))if(ft(t[o])&&ft(n[o]))a+=e(t[o],n[o],i,r);else{if(r&&r.includes(n[o]))continue;t[o]!==n[o]&&(t[o]=n[o],a+=1)}return a},It=function(e){return JSON.stringify(e,["message","code"])},Mt=function(e){if(0===e.length)return 0;for(var t=0,n=0,i="undefined"!=typeof document&&void 0!==document.characterSet?document.characterSet:"UTF-8";void 0!==e[t];)n+=e[t++].charCodeAt[t]<=255?1:!1===i?3:2;return n},Tt=function(e){var t=e||99999999;return Math.round(Math.random()*t)},Ct="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",St=Ct.length,Et=function(e,t){for(var n in e)if(e[n]===t)return!0;return!1},kt={},bt=function(e){return-1===e.indexOf("http://")||-1===e.indexOf("https://")?"https://"+e:e.replace(/https|http/,"https")},Dt=function e(t){if(0===Object.getOwnPropertyNames(t).length)return Object.create(null);var i=Array.isArray(t)?[]:Object.create(null),r="";for(var o in t)null!==t[o]?void 0!==t[o]?(r=n(t[o]),["string","number","function","boolean"].indexOf(r)>=0?i[o]=t[o]:i[o]=e(t[o])):i[o]=void 0:i[o]=null;return i};function wt(e,t){if(!pt(e)||!pt(t))return!1;var n=!1;return t.forEach((function(t){var i=t.key,r=t.value,o=e.find((function(e){return e.key===i}));o?o.value!==r&&(o.value=r,n=!0):(e.push({key:i,value:r}),n=!0)})),n}var At=function(e){return e===b.GRP_AVCHATROOM},Rt=function(e){var t=e.type,n=e.groupID;return t===b.GRP_COMMUNITY||"".concat(n).startsWith(it)&&!"".concat(n).includes(rt)},Lt=function(e){return"".concat(e).startsWith(it)&&"".concat(e).includes(rt)},Ot=function(e){return ut(e)&&e.slice(0,3)===b.CONV_C2C},Nt=function(e){return ut(e)&&e.slice(0,5)===b.CONV_GROUP},Pt=function(e){return ut(e)&&e===b.CONV_SYSTEM};function Ut(e,t){var n={};return Object.keys(e).forEach((function(i){n[i]=t(e[i],i)})),n}function xt(e){return ae?new Promise((function(t,n){ce.getImageInfo({src:e,success:function(e){t({width:e.width,height:e.height})},fail:function(){t({width:0,height:0})}})})):Ce&&9===Se?Promise.resolve({width:0,height:0}):new Promise((function(t,n){var i=new Image;i.onload=function(){t({width:this.width,height:this.height}),i=null},i.onerror=function(){t({width:0,height:0}),i=null},i.src=e}))}function Gt(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"".concat(e()+e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e())}function Ft(){var e="unknown";if(De&&(e="mac"),be&&(e="windows"),ye&&(e="ios"),Me&&(e="android"),ae)try{var t=ce.getSystemInfoSync().platform;void 0!==t&&(e=t)}catch(n){}return e}function Vt(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length);e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(var i=0;i<n;i++){var r=parseInt(e[i]),o=parseInt(t[i]);if(r>o)return 1;if(r<o)return-1}return 0}function qt(e){var t=e.originUrl,n=void 0===t?void 0:t,i=e.originWidth,r=e.originHeight,o=e.min,a=void 0===o?198:o,s=parseInt(i),c=parseInt(r),u={url:void 0,width:0,height:0};if((s<=c?s:c)<=a)u.url=n,u.width=s,u.height=c;else{c<=s?(u.width=Math.ceil(s*a/c),u.height=a):(u.width=a,u.height=Math.ceil(c*a/s));var l=n&&n.indexOf("?")>-1?"".concat(n,"&"):"".concat(n,"?");u.url="".concat(l,198===a?"imageView2/3/w/198/h/198":"imageView2/3/w/720/h/720")}return ht(n)?(u.url,h(u,ot)):u}function Bt(e){var t=e[2];e[2]=e[1],e[1]=t;for(var n=0;n<e.length;n++)e[n].setType(n)}function Ht(e){var t=e.servcmd;return t.slice(t.indexOf(".")+1)}function jt(e,t){return Math.round(Number(e)*Math.pow(10,t))/Math.pow(10,t)}function Kt(e,t){return e.includes(t)}function zt(e,t){return e.includes(t)}function Wt(e){return e.split(rt)[0]}var Yt=function(e,t,n){if(ht(t))return"";switch(e){case b.MSG_TEXT:return t.text;case b.MSG_IMAGE:return n?"[Image]":"[图片]";case b.MSG_LOCATION:return n?"[Location]":"[位置]";case b.MSG_AUDIO:return n?"[Voice]":"[语音]";case b.MSG_VIDEO:return n?"[Video]":"[视频]";case b.MSG_FILE:return n?"[File]":"[文件]";case b.MSG_CUSTOM:return n?"[Custom Messages]":"[自定义消息]";case b.MSG_GRP_TIP:return n?"[Group Notification]":"[群提示消息]";case b.MSG_GRP_SYS_NOTICE:return n?"[Group System Message]":"[群系统通知]";case b.MSG_FACE:return n?"[Animated Sticker]":"[动画表情]";case b.MSG_MERGER:return n?"[Chat Record]":"[聊天记录]";default:return""}};function $t(e){return e===b.MSG_TEXT||e===b.MSG_CUSTOM||e===b.MSG_LOCATION||e===b.MSG_FACE}function Jt(e){var t=[];if(!ut(e))return t;var n=e.length;if(0===n)return t;for(var i=n-1;i>=0;i--)"1"===e[i]&&t.push(Math.pow(2,n-i-1));return t}function Xt(){return!Ce&&!ae}function Zt(e){return"the length of userIDList cannot exceed ".concat(e)}function Qt(e,t){if(e){var n=e;return t&&(e.startsWith("http://")?n=e.replace(/^http:\/\/[^/]+/,t):e.startsWith("https://")&&(n=e.replace(/^https:\/\/[^/]+/,t))),n}}var en=Object.prototype.hasOwnProperty;function tn(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(dt(e)){for(var t in e)if(en.call(e,t))return!1;return!0}return!(!at(e)&&(n=e,"set"!==vt(n))&&!st(e))&&0===e.size;var n}function nn(e,t,n){if(void 0===t)return!0;var i=!0;if(dt(t))Object.keys(t).forEach((function(r){var o=1===e.length?e[0][r]:void 0;i=!!rn(o,t[r],n,r)&&i}));else if(pt(t))for(var r=0;r<t.length;r++)i=!!rn(e[r],t[r],n,t[r].name)&&i;if(i)return i;throw new Error("Params validate failed.")}function rn(e,t,n,i){if(void 0===t)return!0;var r=!0;if(t.required&&tn(e)&&(He.e("[".concat(n,'] Missing required params: "').concat(i,'".')),r=!1),!tn(e)){var o=vt(e),a=t.type.toLowerCase();o!==a&&("asyncfunction"===o&&"function"===a||(He.e("[".concat(n,'] Invalid params: type check failed for "').concat(i,'".Expected ').concat(t.type,".")),r=!1))}return t.validator&&!t.validator(e)&&(He.e("[".concat(n,"] Invalid params: custom validator check failed for params.")),r=!1),r}var on,an={UNSEND:"unSend",SUCCESS:"success",FAIL:"fail"},sn={NOT_START:"notStart",PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"},cn=function(e){if(!e)return!1;if(Ot(e)||Nt(e)||Pt(e))return!0;var t=Nn("InvalidConversationID",e);return t&&He.w(t),!1},un=function(e){""!==e.desc&&""!==Nn("API_REFER")&&He.w("[".concat(e.api,"] | ").concat(e.param," | ").concat(e.desc,", ").concat(Nn("API_REFER")).concat(e.api))},ln=function(){return Nn("StringRequiredLog")},dn=function(e){return Nn("NonEmptyStringRequiredLog",e)},pn=function(){return Nn("NumberRequiredLog")},hn=function(){return Nn("UndefinedNotAllowedLog")},fn=function(){return Nn("FileRequiredLog")},gn=function(){return Nn("FunctionRequiredLog")},mn=function(){return Nn("ArrayRequiredLog")},vn=function(){return Nn("NonEmptyArrayLog")},_n=function(){return Nn("CallbackMissingLog")},yn=function(){return Nn("PositiveIntegerRequiredLog")},In=function(e,t){return Nn("StringNotLongerThanLog",e,t)},Mn=function(e,t){return Nn("NumberLessThanLog",e,t)},Tn=function(e){return Nn("KeyValueStringRequiredLog",e)},Cn=function(){return Nn("PlainObjectRequiredLog")},Sn=function(){return Nn("NonEmptyContentRequiredLog")},En=function(){return Nn("FileNotSelectedLog")},kn=function(){return Nn("MessageInstanceRequiredLog")},bn=function(){return Nn("NonAnonymousFunctionLog")},Dn=function(){return Nn("MessageExtensionNotAvailableLog")},wn={type:"String",required:!0},An={type:"Array",required:!0},Rn={type:"Object",required:!0},Ln={type:"Boolean",required:!0},On={type:"number",required:!0},Nn=null,Pn={hookGetAPITips:function(e){Nn=e},login:{userID:wn,userSig:wn},addToBlacklist:{userIDList:An},removeFromBlacklist:{userIDList:An},on:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(un({api:"on",param:"eventName",desc:dn("eventName")}),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(un({api:"on",param:"handler",desc:gn()}),!1):(""===e.name&&un({api:"on",param:"handler",desc:bn()}),!0)}}],once:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(un({api:"once",param:"eventName",desc:dn("eventName")}),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(un({api:"once",param:"handler",desc:gn()}),!1):(""===e.name&&un({api:"once",param:"handler",desc:bn()}),!0)}}],off:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(un({api:"off",param:"eventName",desc:dn("eventName")}),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(un({api:"off",param:"handler",desc:gn()}),!1):(""===e.name&&un({api:"off",param:"handler",desc:bn()}),!0)}}],sendMessage:[t({name:"message"},Rn)],setMessageExtensions:[t(t({name:"message"},Rn),{},{validator:function(e){return e.status===an.SUCCESS&&!0===e.isSupportExtension||(un({api:"setMessageExtensions",param:"message",desc:Dn()}),!1)}}),t({name:"extensions"},An)],getMessageExtensions:[t(t({name:"message"},Rn),{},{validator:function(e){return e.status===an.SUCCESS&&!0===e.isSupportExtension||(un({api:"getMessageExtensions",param:"message",desc:Dn()}),!1)}})],deleteMessageExtensions:[t(t({name:"message"},Rn),{},{validator:function(e){return e.status===an.SUCCESS&&!0===e.isSupportExtension||(un({api:"deleteMessageExtensions",param:"message",desc:Dn()}),!1)}})],getMessageList:{conversationID:t(t({},wn),{},{validator:function(e){return cn(e)}}),nextReqMessageID:{type:"String"},count:{type:"Number",validator:function(e){return!(!ht(e)&&!/^[1-9][0-9]*$/.test(e)&&(un({api:"getMessageList",param:"count",desc:yn()}),1))}}},getMessageListHopping:{conversationID:t(t({},wn),{},{validator:function(e){return cn(e)}}),sequence:{type:"Number"},time:{type:"Number"},direction:{type:"Number",validator:function(e){return!(!ht(e)&&0!==e&&1!==e&&(un({api:"getMessageListHopping",param:"direction",desc:Nn("0Or1RequiredLog")}),1))}},count:{type:"Number",validator:function(e){return!(!ht(e)&&!/^[1-9][0-9]*$/.test(e)&&(un({api:"getMessageListHopping",param:"count",desc:yn}),1))}}},setMessageRead:{conversationID:t(t({},wn),{},{validator:function(e){return cn(e)}})},setAllMessageRead:{scope:{type:"String",required:!1,validator:function(e){return!e||-1!==[b.READ_ALL_C2C_MSG,b.READ_ALL_GROUP_MSG,b.READ_ALL_MSG].indexOf(e)||(un({api:"setAllMessageRead",param:"scope",desc:"TIM.TYPES.READ_ALL_C2C_MSG or TIM.TYPES.READ_ALL_GROUP_MSG or TIM.TYPES.READ_ALL_MSG required"}),!1)}}},getConversationProfile:[t(t({name:"conversationID"},wn),{},{validator:function(e){return cn(e)}})],clearHistoryMessage:[t(t({name:"conversationID"},wn),{},{validator:function(e){return cn(e)}})],pinConversation:{conversationID:t(t({},wn),{},{validator:function(e){return cn(e)}}),isPinned:t({},Ln)},setConversationCustomData:{conversationIDList:t({},An),customData:{type:"String",validator:function(e){return ut(e)?!(e.length>256&&(un({api:"setConversationCustomData",param:"customData",desc:In("customData",256)}),1)):(un({api:"setConversationCustomData",param:"customData",desc:ln()}),!1)}}},markConversation:{conversationIDList:t({},An),markType:{type:"number",validator:function(e){return ct(e)?e<=0?(un({api:"markConversation",param:"markType",desc:(t="markType",n=0,Nn("NumberGreaterThanLog",t,n))}),!1):!(e>=Math.pow(2,64)&&(un({api:"markConversation",param:"markType",desc:Mn("markType","Math.pow(2,64)")}),1)):(un({api:"markConversation",param:"markType",desc:pn()}),!1);var t,n}},enableMark:t({},Ln)},createConversationGroup:{conversationIDList:t({},An),groupName:t(t({},wn),{},{validator:function(e){return!(!e||e.length>32&&(un({api:"createConversationGroup",param:"groupName",desc:In("groupName",32)}),1))}})},deleteConversationGroup:[t({name:"groupName"},wn)],renameConversationGroup:{oldName:t({},wn),newName:t(t({},wn),{},{validator:function(e){return!(!e||e.length>32&&(un({api:"renameConversationGroup",param:"newName",desc:In("newName",32)}),1))}})},addConversationsToGroup:{conversationIDList:t({},An),groupName:t({},wn)},deleteConversationsFromGroup:{conversationIDList:t({},An),groupName:t({},wn)},getGroupList:{groupProfileFilter:{type:"Array"}},getGroupProfile:{groupID:wn,groupCustomFieldFilter:{type:"Array"},memberCustomFieldFilter:{type:"Array"}},getGroupProfileAdvance:{groupIDList:An},createGroup:{name:wn},joinGroup:{groupID:wn,type:{type:"String"},applyMessage:{type:"String"}},quitGroup:[t({name:"groupID"},wn)],handleApplication:{message:Rn,handleAction:wn,handleMessage:{type:"String"}},changeGroupOwner:{groupID:wn,newOwnerID:wn},updateGroupProfile:{groupID:wn,muteAllMembers:{type:"Boolean"}},dismissGroup:[t({name:"groupID"},wn)],searchGroupByID:[t({name:"groupID"},wn)],initGroupAttributes:{groupID:wn,groupAttributes:t(t({},Rn),{},{validator:function(e){var t=!0;return Object.keys(e).forEach((function(n){if(!ut(e[n]))return un({api:"initGroupAttributes",param:"groupAttributes",desc:Tn("value")}),t=!1})),t}})},setGroupAttributes:{groupID:wn,groupAttributes:t(t({},Rn),{},{validator:function(e){var t=!0;return Object.keys(e).forEach((function(n){if(!ut(e[n]))return un({api:"setGroupAttributes",param:"groupAttributes",desc:Tn("value")}),t=!1})),t}})},deleteGroupAttributes:{groupID:wn,keyList:{type:"Array",validator:function(e){if(ht(e)||!pt(e))return un({api:"deleteGroupAttributes",param:"keyList",desc:mn()}),!1;if(!tn(e)){var t=!0;return e.forEach((function(e){if(!ut(e))return un({api:"deleteGroupAttributes",param:"keyList",desc:Nn("StringArrayRequiredLog")}),t=!1})),t}return!0}}},getGroupAttributes:{groupID:wn,keyList:{type:"Array",validator:function(e){if(ht(e)||!pt(e))return un({api:"getGroupAttributes",param:"keyList",desc:mn()}),!1;if(!tn(e)){var t=!0;return e.forEach((function(e){if(!ut(e))return un({api:"getGroupAttributes",param:"keyList",desc:Tn("key")}),t=!1})),t}return!0}}},setGroupCounters:{groupID:wn,counters:Rn},increaseGroupCounter:{groupID:wn,key:wn,value:On},decreaseGroupCounter:{groupID:wn,key:wn,value:On},getGroupCounters:{groupID:wn},getGroupMemberList:{groupID:wn,count:{type:"Number"}},getGroupMemberProfile:{groupID:wn,userIDList:An,memberCustomFieldFilter:{type:"Array"}},addGroupMember:{groupID:wn,userIDList:An},setGroupMemberRole:{groupID:wn,userID:wn,role:wn},setGroupMemberMuteTime:{groupID:wn,userID:wn,muteTime:{type:"Number",validator:function(e){return e>=0}}},setGroupMemberNameCard:{groupID:wn,userID:{type:"String"},nameCard:{type:"String",validator:function(e){return ut(e)?(e.length,!0):(un({api:"setGroupMemberNameCard",param:"nameCard",desc:ln()}),!1)}}},setGroupMemberCustomField:{groupID:wn,userID:{type:"String"},memberCustomField:An},deleteGroupMember:{groupID:wn},markGroupMemberList:{groupID:wn,markType:{type:"number",validator:function(e){return ct(e)?!(e<1e3&&(un({api:"markGroupMemberList",param:"markType",desc:(t="markType",n=1e3,Nn("NumberGreaterOrEqualLog",t,n))}),1)):(un({api:"markGroupMemberList",param:"markType",desc:pn()}),!1);var t,n}},userIDList:t({},An),enableMark:t({},Ln)},createTextMessage:{to:wn,conversationType:wn,payload:t(t({},Rn),{},{validator:function(e){return dt(e)?ut(e.text)?0!==e.text.length||(un({api:"createTextMessage",param:"payload.text",desc:Sn()}),!1):(un({api:"createTextMessage",param:"payload.text",desc:ln()}),!1):(un({api:"createTextMessage",param:"payload",desc:Cn()}),!1)}})},createTextAtMessage:{to:wn,conversationType:wn,payload:t(t({},Rn),{},{validator:function(e){return dt(e)?ut(e.text)?0===e.text.length?(un({api:"createTextAtMessage",param:"payload.text",desc:Sn()}),!1):!(e.atUserList&&!pt(e.atUserList)&&(un({api:"createTextAtMessage",param:"payload.atUserList",desc:mn()}),1)):(un({api:"createTextAtMessage",param:"payload.text",desc:ln()}),!1):(un({api:"createTextAtMessage",param:"payload",desc:Cn()}),!1)}})},createCustomMessage:{to:wn,conversationType:wn,payload:t(t({},Rn),{},{validator:function(e){return dt(e)?e.data&&!ut(e.data)?(un({api:"createCustomMessage",param:"payload.data",desc:ln()}),!1):e.description&&!ut(e.description)?(un({api:"createCustomMessage",param:"payload.description",desc:ln()}),!1):!(e.extension&&!ut(e.extension)&&(un({api:"createCustomMessage",param:"payload.extension",desc:ln()}),1)):(un({api:"createCustomMessage",param:"payload",desc:Cn()}),!1)}})},createImageMessage:{to:wn,conversationType:wn,payload:t(t({},Rn),{},{validator:function(e){if(!dt(e))return un({api:"createImageMessage",param:"payload",desc:Cn()}),!1;if(ht(e.file))return un({api:"createImageMessage",param:"payload.file",desc:hn()}),!1;if(se){if(!(e.file instanceof HTMLInputElement||st(e.file)))return dt(e.file)&&"undefined"!=typeof uni?0!==e.file.tempFilePaths.length&&0!==e.file.tempFiles.length||(un({api:"createImageMessage",param:"payload.file",desc:En()}),!1):(un({api:"createImageMessage",param:"payload.file",desc:fn()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return un({api:"createImageMessage",param:"payload.file",desc:En()}),!1}return!0},onProgress:{type:"Function",required:!1,validator:function(e){return ht(e)&&un({api:"createImageMessage",param:"onProgress",desc:_n()}),!0}}})},createAudioMessage:{to:wn,conversationType:wn,payload:t(t({},Rn),{},{validator:function(e){return!!dt(e)||(un({api:"createAudioMessage",param:"payload",desc:Cn()}),!1)}}),onProgress:{type:"Function",required:!1,validator:function(e){return ht(e)&&un({api:"createAudioMessage",param:"onProgress",desc:_n()}),!0}}},createVideoMessage:{to:wn,conversationType:wn,payload:t(t({},Rn),{},{validator:function(e){if(!dt(e))return un({api:"createVideoMessage",param:"payload",desc:Cn()}),!1;if(ht(e.file))return un({api:"createVideoMessage",param:"payload.file",desc:hn()}),!1;if(se){if(!(e.file instanceof HTMLInputElement||st(e.file)))return dt(e.file)&&"undefined"!=typeof uni?!!st(e.file.tempFile)||(un({api:"createVideoMessage",param:"payload.file",desc:En()}),!1):(un({api:"createVideoMessage",param:"payload.file",desc:fn()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return un({api:"createVideoMessage",param:"payload.file",desc:En()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e){return ht(e)&&un({api:"createVideoMessage",param:"onProgress",desc:_n()}),!0}}},createFaceMessage:{to:wn,conversationType:wn,payload:t(t({},Rn),{},{validator:function(e){return dt(e)?ct(e.index)?!!ut(e.data)||(un({api:"createFaceMessage",param:"payload.data",desc:ln()}),!1):(un({api:"createFaceMessage",param:"payload.index",desc:pn()}),!1):(un({api:"createFaceMessage",param:"payload",desc:Cn()}),!1)}})},createFileMessage:{to:wn,conversationType:wn,payload:t(t({},Rn),{},{validator:function(e){if(!dt(e))return un({api:"createFileMessage",param:"payload",desc:Cn()}),!1;if(ht(e.file))return un({api:"createFileMessage",param:"payload.file",desc:hn()}),!1;if(se){if(!(e.file instanceof HTMLInputElement||st(e.file)))return dt(e.file)&&"undefined"!=typeof uni?0!==e.file.tempFilePaths.length&&0!==e.file.tempFiles.length||(un({api:"createFileMessage",param:"payload.file",desc:En()}),!1):(un({api:"createFileMessage",param:"payload.file",desc:fn()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return un({api:"createFileMessage",param:"payload.file",desc:En()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e){return ht(e)&&un({api:"createFileMessage",param:"onProgress",desc:_n()}),!0}}},createLocationMessage:{to:wn,conversationType:wn,payload:t(t({},Rn),{},{validator:function(e){return dt(e)?ut(e.description)?ct(e.longitude)?!!ct(e.latitude)||(un({api:"createLocationMessage",param:"payload.latitude",desc:pn()}),!1):(un({api:"createLocationMessage",param:"payload.longitude",desc:pn()}),!1):(un({api:"createLocationMessage",param:"payload.description",desc:ln()}),!1):(un({api:"createLocationMessage",param:"payload",desc:Cn()}),!1)}})},createMergerMessage:{to:wn,conversationType:wn,payload:t(t({},Rn),{},{validator:function(e){if(tn(e.messageList))return un({api:"createMergerMessage",param:"payload.messageList",desc:vn()}),!1;if(tn(e.compatibleText))return un({api:"createMergerMessage",param:"payload.compatibleText",desc:dn("compatibleText")}),!1;var t=!1;return e.messageList.forEach((function(e){e.status===an.FAIL&&(t=!0)})),!t||(un({api:"createMergerMessage",param:"payload.messageList",desc:Nn("MergeFailedMessageLog")}),!1)}})},revokeMessage:[t(t({name:"message"},Rn),{},{validator:function(e){return tn(e)?(un({api:"revokeMessage",param:"message",desc:kn()}),!1):e.conversationType===b.CONV_SYSTEM?(un({api:"revokeMessage",param:"message",desc:Nn("MessageCanBeRevokedDesc")}),!1):!0!==e.isRevoked||(un({api:"revokeMessage",param:"message",desc:Nn("MessageRevokedLog")}),!1)}})],deleteMessage:[t(t({name:"messageList"},An),{},{validator:function(e){return!tn(e)||(un({api:"deleteMessage",param:"messageList",desc:vn()}),!1)}})],translateText:{sourceTextList:An,sourceLanguage:wn,targetLanguage:wn},modifyMessage:[t(t({name:"message"},Rn),{},{validator:function(e){return tn(e)?(un({api:"modifyMessage",param:"message",desc:kn()}),!1):e.conversationType===b.CONV_SYSTEM?(un({api:"modifyMessage",param:"message",desc:Nn("MessageCanBeModifiedLog")}),!1):!0!==e._onlineOnlyFlag||(un({api:"modifyMessage",param:"message",desc:Nn("OnlineMessageNotSupportLog")}),!1)}})],getUserProfile:{userIDList:{type:"Array",validator:function(e){return pt(e)?(0===e.length&&un({api:"getUserProfile",param:"userIDList",desc:vn()}),!0):(un({api:"getUserProfile",param:"userIDList",desc:mn()}),!1)}}},updateMyProfile:{profileCustomField:{type:"Array",validator:function(e){return!!ht(e)||!!pt(e)||(un({api:"updateMyProfile",param:"profileCustomField",desc:mn()}),!1)}}},setSelfStatus:{customStatus:{type:"String",validator:function(e){return!!ut(e)||(un({api:"setSelfStatus",param:"customStatus",desc:ln()}),!1)}}},getUserStatus:{userIDList:{type:"Array",validator:function(e){return pt(e)?0!==e.length||(un({api:"getUserStatus",param:"userIDList",desc:vn()}),!1):(un({api:"getUserStatus",param:"userIDList",desc:mn()}),!1)}}},subscribeUserStatus:{userIDList:{type:"Array",validator:function(e){return pt(e)?0!==e.length||(un({api:"subscribeUserStatus",param:"userIDList",desc:vn()}),!1):(un({api:"subscribeUserStatus",param:"userIDList",desc:mn()}),!1)}}},unsubscribeUserStatus:{userIDList:{type:"Array",validator:function(e){return!e||!!pt(e)||(un({api:"subscribeUserStatus",param:"userIDList",desc:mn()}),!1)}}},addFriend:{to:wn,source:{type:"String",required:!0,validator:function(e){return!(!e||(e.startsWith("AddSource_Type_")?e.replace("AddSource_Type_","").length>8&&(un({api:"addFriend",param:"source",desc:In("keyword",8)}),1):(un({api:"addFriend",param:"source",desc:Nn("SourcePrefixLog")}),1)))}},remark:{type:"String",required:!1,validator:function(e){return!(ut(e)&&e.length>96&&(un({api:"addFriend",param:"remark",desc:In("remark",96)}),1))}}},deleteFriend:{userIDList:An},checkFriend:{userIDList:An},getFriendProfile:{userIDList:An},updateFriend:{userID:wn,remark:{type:"String",required:!1,validator:function(e){return!(ut(e)&&e.length>96&&(un({api:"updateFriend",param:"remark",desc:In("remark",96)}),1))}},friendCustomField:{type:"Array",required:!1,validator:function(e){if(e){if(!pt(e))return un({api:"updateFriend",param:"friendCustomField",desc:mn()}),!1;var t=!0;return e.forEach((function(e){return ut(e.key)&&-1!==e.key.indexOf("Tag_SNS_Custom")?ut(e.value)?e.key.replace("Tag_SNS_Custom_","").length>8?(un({api:"updateFriend",param:"friendCustomField",desc:In("keyword",8)}),t=!1):void 0:(un({api:"updateFriend",param:"friendCustomField",desc:Tn("value")}),t=!1):(un({api:"updateFriend",param:"friendCustomField",desc:Nn("FriendCustomFieldPrefixLog")}),t=!1)})),t}return!0}}},acceptFriendApplication:{userID:wn},refuseFriendApplication:{userID:wn},deleteFriendApplication:{userID:wn},createFriendGroup:{name:wn},deleteFriendGroup:{name:wn},addToFriendGroup:{name:wn,userIDList:An},removeFromFriendGroup:{name:wn,userIDList:An},renameFriendGroup:{oldName:wn,newName:wn},sendMessageReadReceipt:[{name:"messageList",type:"Array",validator:function(e){return pt(e)?0!==e.length||(un({api:"sendMessageReadReceipt",param:"messageList",desc:vn()}),!1):(un({api:"sendMessageReadReceipt",param:"messageList",desc:mn()}),!1)}}],getMessageReadReceiptList:[{name:"messageList",type:"Array",validator:function(e){return pt(e)?0!==e.length||(un({api:"getMessageReadReceiptList",param:"messageList",desc:vn()}),!1):(un({api:"getMessageReadReceiptList",param:"messageList",desc:mn()}),!1)}}],createTopicInCommunity:{groupID:wn,topicName:wn},deleteTopicFromCommunity:{groupID:wn,topicIDList:{type:"Array",validator:function(e){return!e||!!pt(e)||(un({api:"deleteTopicFromCommunity",param:"topicIDList",desc:mn()}),!1)}}},updateTopicProfile:{groupID:wn,topicID:wn},getTopicList:{groupID:wn,topicIDList:{type:"Array",validator:function(e){return!e||!!pt(e)||(un({api:"getTopicList",param:"topicIDList",desc:mn()}),!1)}}}},Un={login:1,logout:1,on:1,once:1,off:1,setLogLevel:1,registerPlugin:1,destroy:1,createTextMessage:1,createTextAtMessage:1,createImageMessage:1,createAudioMessage:1,createVideoMessage:1,createCustomMessage:1,createFaceMessage:1,createFileMessage:1,createLocationMessage:1,createMergerMessage:1,downloadMergerMessage:1,createForwardMessage:1,sendMessage:1,resendMessage:1,revokeMessage:1,deleteMessage:1,translateText:1,modifyMessage:1,sendMessageReadReceipt:1,getGroupMessageReadMemberList:1,getMessageReadReceiptList:1,setMessageExtensions:1,getMessageExtensions:1,deleteMessageExtensions:1,getMessageList:1,findMessage:1,getMessageListHopping:1,setMessageRead:1,setAllMessageRead:1,getConversationList:1,getConversationProfile:1,deleteConversation:1,pinConversation:1,getTotalUnreadMessageCount:1,setConversationCustomData:1,markConversation:1,createConversationGroup:1,getConversationGroupList:1,deleteConversationGroup:1,renameConversationGroup:1,addConversationsToGroup:1,deleteConversationsFromGroup:1,clearHistoryMessage:1,getGroupList:1,getGroupProfile:1,createGroup:1,joinGroup:1,updateGroupProfile:1,quitGroup:1,dismissGroup:1,changeGroupOwner:1,searchGroupByID:1,setMessageRemindType:1,getGroupApplicationList:1,handleGroupApplication:1,initGroupAttributes:1,setGroupAttributes:1,deleteGroupAttributes:1,getGroupAttributes:1,setGroupCounters:1,increaseGroupCounter:1,decreaseGroupCounter:1,getGroupCounters:1,getJoinedCommunityList:1,createTopicInCommunity:1,deleteTopicFromCommunity:1,updateTopicProfile:1,getTopicList:1,getGroupMemberProfile:1,getGroupMemberList:1,addGroupMember:1,deleteGroupMember:1,setGroupMemberNameCard:1,setGroupMemberMuteTime:1,setGroupMemberRole:1,setGroupMemberCustomField:1,getGroupOnlineMemberCount:1,markGroupMemberList:1,getMyProfile:1,getUserProfile:1,updateMyProfile:1,setSelfStatus:1,getUserStatus:1,subscribeUserStatus:1,unsubscribeUserStatus:1,getBlacklist:1,addToBlacklist:1,removeFromBlacklist:1,getFriendList:1,addFriend:1,deleteFriend:1,checkFriend:1,updateFriend:1,getFriendProfile:1,getFriendApplicationList:1,refuseFriendApplication:1,deleteFriendApplication:1,acceptFriendApplication:1,setFriendApplicationRead:1,getFriendGroupList:1,createFriendGroup:1,renameFriendGroup:1,deleteFriendGroup:1,addToFriendGroup:1,removeFromFriendGroup:1,callExperimentalAPI:1},xn=1,Gn=2,Fn=3,Vn=4,qn=6,Bn=7,Hn=8,jn=9,Kn=10,zn=11,Wn=12,Yn=13,$n=14,Jn=15,Xn=16,Zn=17,Qn=18,ei=19,ti=20,ni=21,ii=22,ri=23,oi=24,ai=25,si=26,ci=27,ui=28,li=29,di=30,pi=31,hi=32,fi=function(){function e(t){i(this,e),this._m=t,this._n=""}return o(e,[{key:"isLoggedIn",value:function(){return this._m.getModule(Wn).isLoggedIn()}},{key:"isOversea",value:function(){return this._m.getModule(Wn).isOversea()}},{key:"isPrivateNetWork",value:function(){return this._m.getModule(Wn).isPrivateNetWork()}},{key:"getFileDownloadProxy",value:function(){return this._m.getModule(Wn).getFileDownloadProxy()}},{key:"getMyUserID",value:function(){return this._m.getModule(Wn).getUserID()}},{key:"getMyTinyID",value:function(){return this._m.getModule(Wn).getTinyID()}},{key:"getSDKAppID",value:function(){return this._m.getModule(Wn).getSDKAppID()}},{key:"isIntl",value:function(){return this._m.getModule(Wn).isIntl()}},{key:"isDevMode",value:function(){return this._m.getModule(Wn).isDevMode()}},{key:"getModule",value:function(e){return this._m.getModule(e)}},{key:"getPlatform",value:function(){return ge}},{key:"getNetworkType",value:function(){return this._m.getModule(Jn).getNetworkType()}},{key:"probeNetwork",value:function(e){return this._m.getModule(Jn).probe(e)}},{key:"getCloudConfig",value:function(e){return this._m.getModule(ri).getCloudConfig(e)}},{key:"emitOuterEvent",value:function(e,t){this._m.getOuterEmitterInstance().emit(e,t)}},{key:"emitInnerEvent",value:function(e,t){this._m.getInnerEmitterInstance().emit(e,t)}},{key:"getInnerEmitterInstance",value:function(){return this._m.getInnerEmitterInstance()}},{key:"generateTjgID",value:function(e){return this._m.getModule(Wn).getTinyID()+"-"+e.random}},{key:"filterModifiedMessage",value:function(e){if(!tn(e)){var t=e.filter((function(e){return!0===e.isModified}));t.length>0&&this.emitOuterEvent(k.MESSAGE_MODIFIED,t)}}},{key:"filterUnmodifiedMessage",value:function(e){return tn(e)?[]:e.filter((function(e){return!1===e.isModified}))}},{key:"request",value:function(e){return this._m.getModule(ti).request(e)}},{key:"canIUse",value:function(e){return this._m.getModule(ci).canIUse(e)}},{key:"getErrorMessage",value:function(e,t,n){return this._m.getErrorMessage(e,t,n)}},{key:"outputWarning",value:function(e,t,n){var i=this.getErrorMessage(e,t,n);i&&He.w(i)}}]),e}(),gi="wslogin",mi="wslogout",vi="wshello",_i="KickOther",yi="getmsg",Ii="authkey",Mi="sendmsg",Ti="send_group_msg",Ci="portrait_get_all",Si="portrait_set",Ei="black_list_get",ki="black_list_add",bi="black_list_delete",Di="friend_get",wi="friend_get_specified",Ai="friend_check",Ri="friend_delete",Li="friend_add",Oi="friend_update",Ni="friend_response",Pi="pendency_get",Ui="pendency_delete",xi="pendency_report",Gi="group_get",Fi="group_add",Vi="group_delete",qi="group_update",Bi="msgwithdraw",Hi="msgreaded",ji="set_c2c_peer_mute_notifications",Ki="get_c2c_peer_mute_notifications",zi="getroammsg",Wi="get_peer_read_time",Yi="delete_c2c_msg_ramble",$i="modify_c2c_msg",Ji="set_key_values",Xi="get_key_values",Zi="page_get",Qi="get",er="batch_delete",tr="clear_msg",nr="top",ir="deletemsg",rr="set_conv_custom_data",or="mark_contact",ar="create_contact_group",sr="del_contact_group",cr="update_contact_group",ur="add_conv_to_group",lr="del_conv_from_group",dr="get_contact_group",pr="get_joined_group_list",hr="get_group_self_member_info",fr="create_group",gr="destroy_group",mr="modify_group_base_info",vr="apply_join_group",_r="apply_join_group_noauth",yr="quit_group",Ir="get_group_public_info",Mr="change_group_owner",Tr="handle_apply_join_group",Cr="handle_invite_join_permission_group",Sr="handle_invite_join_group",Er="group_msg_recall",kr="msg_read_report",br="read_all_unread_msg",Dr="group_msg_get",wr="get_group_msg_receipt",Ar="group_msg_receipt",Rr="c2c_msg_read_receipt",Lr="get_group_msg_receipt_detail",Or="get_pendency",Nr="deletemsg",Pr="get_msg",Ur="get_msg_noauth",xr="get_online_member_num",Gr="delete_group_ramble_msg_by_seq",Fr="modify_group_msg",Vr="set_group_attr",qr="modify_group_attr",Br="delete_group_attr",Hr="clear_group_attr",jr="get_group_attr",Kr="group_set_key_values",zr="group_get_key_values",Wr="get_group_notify",Yr="update_group_counter",$r="get_group_counter",Jr="get_group_member_info",Xr="get_members",Zr="get_specified_group_member_info",Qr="add_group_member",eo="delete_group_member",to="ban_group_member",no="modify_group_member_info",io="modify_user_info",ro="cos",oo="pre_sig",ao="video_cover",so="tim_web_report_v2",co="alive",uo="msg_push",lo="multi_msg_push_ws",po="ws_msg_push_ack",ho="stat_forceoffline",fo="save_relay_json_msg",go="get_relay_json_msg",mo="fetch_config",vo="push_configv2",_o="fetch_imsdk_purchase_bitsv2",yo="push_imsdk_purchase_bitsv2",Io="notify2",Mo="create_topic",To="destroy_topic",Co="modify_topic",So="get_topic",Eo="ws_set_custom_status",ko="ws_get_user_status",bo="ws_status_subscribe",Do="ws_status_unsubscribe",wo="ws_stat_background",Ao="ws_stat_foreground",Ro="ws_stat_settoken",Lo="get_local_words",Oo="ws_batch_trans_text",No={NO_SDKAPPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USERSIG:2003,NO_TINYID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,REPEAT_LOGIN:2025,COS_UNDETECTED:2040,COS_GET_SIG_FAIL:2041,MESSAGE_SEND_FAIL:2100,MESSAGE_SEND_FAIL_NOT_IN_AVCHATROOM:2101,MESSAGE_SEND_NEED_MESSAGE_INSTANCE:2105,MESSAGE_SEND_INVALID_CONVERSATION_TYPE:2106,MESSAGE_FILE_IS_EMPTY:2108,MESSAGE_ONPROGRESS_FUNCTION_ERROR:2109,MESSAGE_REVOKE_FAIL:2110,MESSAGE_DELETE_FAIL:2111,MESSAGE_UNREAD_ALL_FAIL:2112,READ_RECEIPT_MESSAGE_LIST_EMPTY:2114,MESSAGE_SEND_GROUP_WITH_TOPIC_FAIL:2115,CANNOT_DELETE_GROUP_SYSTEM_NOTICE:2116,TRANSLATE_TEXT_FAIL:2117,MESSAGE_IMAGE_SELECT_FILE_FIRST:2251,MESSAGE_IMAGE_TYPES_LIMIT:2252,MESSAGE_IMAGE_SIZE_LIMIT:2253,MESSAGE_AUDIO_UPLOAD_FAIL:2300,MESSAGE_AUDIO_SIZE_LIMIT:2301,MESSAGE_VIDEO_UPLOAD_FAIL:2350,MESSAGE_VIDEO_SIZE_LIMIT:2351,MESSAGE_VIDEO_TYPES_LIMIT:2352,MESSAGE_FILE_UPLOAD_FAIL:2400,MESSAGE_FILE_SELECT_FILE_FIRST:2401,MESSAGE_FILE_SIZE_LIMIT:2402,MESSAGE_FILE_URL_IS_EMPTY:2403,MESSAGE_MERGER_TYPE_INVALID:2450,MESSAGE_MERGER_KEY_INVALID:2451,MESSAGE_MERGER_DOWNLOAD_FAIL:2452,MESSAGE_FORWARD_TYPE_INVALID:2453,MESSAGE_MODIFY_CONFLICT:2480,MESSAGE_MODIFY_DISABLED_IN_AVCHATROOM:2481,CONVERSATION_NOT_FOUND:2500,USER_OR_GROUP_NOT_FOUND:2501,CONVERSATION_UN_RECORDED_TYPE:2502,INVALID_CONVERSATION_ID:2503,ILLEGAL_GROUP_TYPE:2600,CANNOT_JOIN_WORK:2601,ILLEGAL_GROUP_ID:2602,CANNOT_FIND_GROUP:2603,CANNOT_CHANGE_OWNER_IN_AVCHATROOM:2620,CANNOT_CHANGE_OWNER_TO_SELF:2621,CANNOT_DISMISS_WORK:2622,MEMBER_NOT_IN_GROUP:2623,JOIN_GROUP_FAIL:2660,CANNOT_ADD_MEMBER_IN_AVCHATROOM:2661,CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN:2662,NOT_OWNER:2681,CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM:2682,INVALID_MEMBER_ROLE:2683,CANNOT_SET_SELF_MEMBER_ROLE:2684,CANNOT_MUTE_SELF:2685,BAN_DURATION_INVALID:2686,NOT_MY_FRIEND:2700,ALREADY_MY_FRIEND:2701,FRIEND_GROUP_EXISTED:2710,FRIEND_GROUP_NOT_EXIST:2711,FRIEND_APPLICATION_NOT_EXIST:2716,UPDATE_PROFILE_INVALID_PARAM:2721,UPDATE_PROFILE_NO_KEY:2722,CANNOT_ADD_SELF_TO_BLACKLIST:2742,NETWORK_ERROR:2800,NETWORK_TIMEOUT:2801,NO_NETWORK:2805,UNCAUGHT_ERROR:2903,INVALID_OPERATION:2905,OVER_FREQUENCY_LIMIT:2996,CANNOT_FIND_PROTOCOL:2997,CANNOT_FIND_MODULE:2998,SDK_IS_NOT_READY:2999,LOGGING_IN:3e3,LOGIN_FAILED:3001,KICKED_OUT_MULT_DEVICE:3002,KICKED_OUT_MULT_ACCOUNT:3003,KICKED_OUT_USERSIG_EXPIRED:3004,LOGGED_OUT:3005,KICKED_OUT_REST_API:3006,ILLEGAL_TOPIC_ID:3021,CANNOT_USE_COMMERCIAL_ABILITY:3122,PROFANITY_FOUND:3123,MESSAGE_A2KEY_EXPIRED:20002,ACCOUNT_A2KEY_EXPIRED:70001,HELLO_ANSWER_KICKED_OUT:1002,OPEN_SERVICE_OVERLOAD_ERROR:60022},Po="networkRTT",Uo="messageE2EDelay",xo="sendMessageC2C",Go="sendMessageGroup",Fo="sendMessageGroupAV",Vo="sendMessageRichMedia",qo="cosUpload",Bo="messageReceivedGroup",Ho="messageReceivedGroupAVPush",jo="messageReceivedGroupAVPull",Ko=(a(on={},Po,2),a(on,Uo,3),a(on,xo,4),a(on,Go,5),a(on,Fo,6),a(on,Vo,7),a(on,Bo,8),a(on,Ho,9),a(on,jo,10),a(on,qo,11),on),zo={info:4,warning:5,error:6},Wo={wifi:1,"2g":2,"3g":3,"4g":4,"5g":5,unknown:6,none:7,online:8},Yo={login:4},$o=function(){function e(t){i(this,e),this._n="SSOLogData",this.eventType=Yo[t]||0,this.timestamp=0,this.networkType=8,this.code=0,this.message="",this.moreMessage="",this.extension=t,this.costTime=0,this.duplicate=!1,this.level=4,this.uiPlatform=void 0,this._sentFlag=!1,this._startts=xe()}return o(e,[{key:"updateTimeStamp",value:function(){this.timestamp=xe()}},{key:"start",value:function(e){return this._startts=e,this}},{key:"end",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._sentFlag){var n=xe();0===this.costTime&&(this.costTime=n-this._startts),this.setMoreMessage("startts:".concat(this._startts," endts:").concat(n)),t?(this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)):setTimeout((function(){e._sentFlag=!0,e._eventStatModule&&e._eventStatModule.pushIn(e)}),0)}}},{key:"setError",value:function(e,t,n){if(!(e instanceof Error))return He.w("".concat(this._n,".setError value not instanceof Error, please check!")),this;if(this._sentFlag)return this;if(this.setNetworkType(n),t)e.code&&this.setCode(e.code),e.message&&this.setMoreMessage(e.message);else{var i=No.NO_NETWORK;this.setCode(i)}return this.setLevel("error"),this}},{key:"setCode",value:function(e){return ht(e)||this._sentFlag||("ECONNABORTED"===e&&(this.code=103),ct(e)?this.code=e:He.w("".concat(this._n,".setCode value not a number, please check!"),e,n(e))),this}},{key:"setMessage",value:function(e){return ht(e)||this._sentFlag||(ct(e)&&(this.message=e.toString()),ut(e)&&(this.message=e)),this}},{key:"setCostTime",value:function(e){return this.costTime=e,this}},{key:"setLevel",value:function(e){return ht(e)||this._sentFlag||(this.level=zo[e]),this}},{key:"setMoreMessage",value:function(e){return tn(this.moreMessage)?this.moreMessage="".concat(e):this.moreMessage+=" ".concat(e),this}},{key:"setNetworkType",value:function(e){if(ht(e))He.w("".concat(this._n,".setNetworkType value is undefined, please check!"));else{var t=Wo[e.toLowerCase()];ht(t)||(this.networkType=t)}return this}},{key:"getStartTs",value:function(){return this._startts}},{key:"setUIPlatform",value:function(e){this.uiPlatform=e}}],[{key:"bindEventStatModule",value:function(t){e.prototype._eventStatModule=t}}]),e}(),Jo=function(){function e(t){i(this,e),this.type=b.MSG_TEXT,this.content={text:t.text||""}}return o(e,[{key:"setText",value:function(e){this.content.text=e}},{key:"sendable",value:function(){return 0!==this.content.text.length}}]),e}(),Xo=function(){function e(t,n){i(this,e),this._imageMemoryURL="",this._fileDownloadProxy=n,ae?this.createImageDataASURLInWXMiniApp(t.file):this.createImageDataASURLInWeb(t.file),this._initImageInfoModel(),this.type=b.MSG_IMAGE,this._percent=0,this.content={imageFormat:t.imageFormat||je.UNKNOWN,uuid:t.uuid,imageInfoArray:[]},this.initImageInfoArray(t.imageInfoArray),this._autoFixUrl()}return o(e,[{key:"_initImageInfoModel",value:function(){var e=this;this._ImageInfoModel=function(t){this.instanceID=Tt(9999999),this.sizeType=t.type||0,this.type=0,this.size=t.size||0,this.width=t.width||0,this.height=t.height||0,this.imageUrl=t.url||"",this.url=Qt(t.url||e._imageMemoryURL,e._fileDownloadProxy)},this._ImageInfoModel.prototype={setSizeType:function(e){this.sizeType=e},setType:function(e){this.type=e},setImageUrl:function(e){e&&(this.imageUrl=e)},getImageUrl:function(){return this.imageUrl}}}},{key:"initImageInfoArray",value:function(e){for(var t=0,n=null,i=null;t<=2;)i=ht(e)||ht(e[t])?{type:0,size:0,width:0,height:0,url:""}:e[t],(n=new this._ImageInfoModel(i)).setSizeType(t+1),n.setType(t),this.addImageInfo(n),t++;this.updateAccessSideImageInfoArray()}},{key:"updateImageInfoArray",value:function(e){for(var t,n=this.content.imageInfoArray.length,i=0;i<n;i++)t=this.content.imageInfoArray[i],e[i].size&&(t.size=e[i].size),e[i].url&&t.setImageUrl(e[i].url),e[i].width&&(t.width=e[i].width),e[i].height&&(t.height=e[i].height)}},{key:"_autoFixUrl",value:function(){for(var e=this.content.imageInfoArray.length,t="",n="",i=["http","https"],r=null,o=0;o<e;o++)this.content.imageInfoArray[o].url&&""!==(r=this.content.imageInfoArray[o]).imageUrl&&(n=r.imageUrl.slice(0,r.imageUrl.indexOf("://")+1),t=r.imageUrl.slice(r.imageUrl.indexOf("://")+1),i.indexOf(n)<0&&(n="https:"),this.content.imageInfoArray[o].setImageUrl([n,t].join("")))}},{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateImageFormat",value:function(e){this.content.imageFormat=je[e.toUpperCase()]||je.UNKNOWN}},{key:"createImageDataASURLInWeb",value:function(e){void 0!==e&&e.files.length>0&&(this._imageMemoryURL=window.URL.createObjectURL(e.files[0]))}},{key:"createImageDataASURLInWXMiniApp",value:function(e){e&&e.url&&(this._imageMemoryURL=e.url)}},{key:"replaceImageInfo",value:function(e,t){this.content.imageInfoArray[t]instanceof this._ImageInfoModel||(this.content.imageInfoArray[t]=e)}},{key:"addImageInfo",value:function(e){this.content.imageInfoArray.length>=3||this.content.imageInfoArray.push(e)}},{key:"updateAccessSideImageInfoArray",value:function(){var e=this.content.imageInfoArray,t=e[0],n=t.width,i=void 0===n?0:n,r=t.height,o=void 0===r?0:r;0!==i&&0!==o&&(Bt(e),Object.assign(e[2],qt({originWidth:i,originHeight:o,min:720})))}},{key:"sendable",value:function(){return 0!==this.content.imageInfoArray.length&&""!==this.content.imageInfoArray[0].imageUrl&&0!==this.content.imageInfoArray[0].size}}]),e}(),Zo=function(){function e(t){i(this,e),this.type=b.MSG_FACE,this.content=t||null}return o(e,[{key:"sendable",value:function(){return null!==this.content}}]),e}(),Qo=function(){function e(t,n){i(this,e),this.type=b.MSG_AUDIO,this._percent=0,this.content={downloadFlag:2,second:t.second,size:t.size,url:Qt(t.url,n),remoteAudioUrl:t.url||"",uuid:t.uuid}}return o(e,[{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateAudioUrl",value:function(e){this.content.remoteAudioUrl=e}},{key:"sendable",value:function(){return""!==this.content.remoteAudioUrl}}]),e}(),ea={from:!0,groupID:!0,groupName:!0,to:!0},ta=function(){function e(t){i(this,e),this.type=b.MSG_GRP_TIP,this.content={},this._initContent(t)}return o(e,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"remarkInfo":case"operatorInfo":case"memberExtraInfo":case"onlineMemberInfo":break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;case"memberInfoList":case"msgMemberInfo":t._updateMemberList(e[n]);break;case"memberNum":t.content[n]=e[n],t.content.memberCount=e[n];break;case"newGroupProfile":t.content.newGroupProfile={},t._initNewGroupProfile(e[n]);break;default:t.content[n]=e[n]}})),this.content.userIDList||(this.content.userIDList=[this.content.operatorID])}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];ea[i]&&(this.content.groupProfile[i]=e[i])}}},{key:"_updateMemberList",value:function(e){tn(this.content.memberList)?this.content.memberList=e:this.content.memberList.forEach((function(t){e.forEach((function(e){t.userID===e.userID&&Object.assign(t,e)}))}))}},{key:"_initNewGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];this.content.newGroupProfile[i]="muteAllMembers"!==i?e[i]:1===e[i]}}}]),e}(),na={from:!0,groupID:!0,groupName:!0,to:!0},ia=function(){function e(t){i(this,e),this.type=b.MSG_GRP_SYS_NOTICE,this.content={},this._initContent(t)}return o(e,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"memberInfoList":break;case"remarkInfo":t.content.handleMessage=e[n];break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;default:t.content[n]=e[n]}}))}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];na[i]&&("groupName"===i?this.content.groupProfile.name=e[i]:this.content.groupProfile[i]=e[i])}}}]),e}(),ra=function(){function e(t,n){i(this,e),this.type=b.MSG_FILE,this._percent=0;var r=this._getFileInfo(t);this.content={downloadFlag:2,fileUrl:Qt(t.url,n)||"",uuid:t.uuid,fileName:r.name||"",fileSize:r.size||0}}return o(e,[{key:"_getFileInfo",value:function(e){if(!ht(e.fileName)&&!ht(e.fileSize))return{size:e.fileSize,name:e.fileName};var t=e.file.files[0];if(re){if(t.path&&-1!==t.path.indexOf(".")){var n=t.path.slice(t.path.lastIndexOf(".")+1).toLowerCase();t.type=n,t.name||(t.name="".concat(Tt(999999),".").concat(n))}t.name||(t.type="",t.name=t.path.slice(t.path.lastIndexOf("/")+1).toLowerCase()),t.suffix&&(t.type=t.suffix),t.url||(t.url=t.path)}return{size:t.size,name:t.name}}},{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateFileUrl",value:function(e){this.content.fileUrl=e}},{key:"sendable",value:function(){return""!==this.content.fileUrl&&""!==this.content.fileName&&0!==this.content.fileSize}}]),e}(),oa=function(){function e(t){i(this,e),this.type=b.MSG_CUSTOM,this.content={data:t.data||"",description:t.description||"",extension:t.extension||""}}return o(e,[{key:"setData",value:function(e){return this.content.data=e,this}},{key:"setDescription",value:function(e){return this.content.description=e,this}},{key:"setExtension",value:function(e){return this.content.extension=e,this}},{key:"sendable",value:function(){return 0!==this.content.data.length||0!==this.content.description.length||0!==this.content.extension.length}}]),e}(),aa=function(){function e(t,n){i(this,e),this.type=b.MSG_VIDEO,this._percent=0,this.content={remoteVideoUrl:t.remoteVideoUrl||t.videoUrl||"",videoFormat:t.videoFormat,videoSecond:parseInt(t.videoSecond,10),videoSize:t.videoSize,videoUrl:Qt(t.videoUrl,n),videoDownloadFlag:2,videoUUID:t.videoUUID,thumbUUID:t.thumbUUID,thumbFormat:t.thumbFormat,thumbWidth:t.thumbWidth,snapshotWidth:t.thumbWidth,thumbHeight:t.thumbHeight,snapshotHeight:t.thumbHeight,thumbSize:t.thumbSize,snapshotSize:t.thumbSize,thumbDownloadFlag:2,thumbUrl:Qt(t.thumbUrl,n),snapshotUrl:Qt(t.thumbUrl,n)}}return o(e,[{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateVideoUrl",value:function(e){e&&(this.content.remoteVideoUrl=e)}},{key:"updateSnapshotInfo",value:function(e){var t=e.snapshotUrl,n=e.snapshotWidth,i=e.snapshotHeight;tn(t)||(this.content.thumbUrl=this.content.snapshotUrl=t),tn(n)||(this.content.thumbWidth=this.content.snapshotWidth=Number(n)),tn(i)||(this.content.thumbHeight=this.content.snapshotHeight=Number(i))}},{key:"sendable",value:function(){return""!==this.content.remoteVideoUrl}}]),e}(),sa=function(){function e(t){i(this,e),this.type=b.MSG_LOCATION;var n=t.description,r=t.longitude,o=t.latitude;this.content={description:n,longitude:r,latitude:o}}return o(e,[{key:"sendable",value:function(){return!0}}]),e}(),ca=function(){function e(t,n){if(i(this,e),this.from=t.from,this.messageSender=t.from,this.time=t.time,this.messageSequence=t.sequence,this.clientSequence=t.clientSequence||t.sequence,this.messageRandom=t.random,this.cloudCustomData=t.cloudCustomData||"",this.clientTime=t.clientTime||void 0,t.ID)this.ID=t.ID||"",this.nick=t.nick||"",this.avatar=t.avatar||"",this.messageBody=[{type:t.type,payload:t.payload}],t.conversationType.startsWith(b.CONV_C2C)?this.receiverUserID=t.to:t.conversationType.startsWith(b.CONV_GROUP)&&(this.receiverGroupID=t.to),this.messageReceiver=t.to;else{this.nick=t.nick||"",this.avatar=t.avatar||"",this.messageBody=[];var r=t.elements[0].type,o=t.elements[0].content;this._patchRichMediaPayload(r,o),this._updateRichMediaDownloadUrl(r,o,n),r===b.MSG_MERGER?this.messageBody.push({type:r,payload:new ua(o).content}):this.messageBody.push({type:r,payload:o}),t.groupID&&(this.receiverGroupID=t.groupID,this.messageReceiver=t.groupID),t.to&&(this.receiverUserID=t.to,this.messageReceiver=t.to),this.ID="".concat(t.tinyID,"-").concat(t.clientTime,"-").concat(t.random)}}return o(e,[{key:"_patchRichMediaPayload",value:function(e,t){e===b.MSG_IMAGE?t.imageInfoArray.forEach((function(e){!e.imageUrl&&e.url&&(e.imageUrl=e.url,e.sizeType=e.type,1===e.type?e.type=0:3===e.type&&(e.type=1))})):e===b.MSG_VIDEO?!t.remoteVideoUrl&&t.videoUrl&&(t.remoteVideoUrl=t.videoUrl):e===b.MSG_AUDIO?!t.remoteAudioUrl&&t.url&&(t.remoteAudioUrl=t.url):e===b.MSG_FILE&&!t.fileUrl&&t.url&&(t.fileUrl=t.url,t.url=void 0)}},{key:"_updateRichMediaDownloadUrl",value:function(e,t,n){n&&(e===b.MSG_IMAGE?t.imageInfoArray.forEach((function(e){e.url=Qt(e.url,n)})):e===b.MSG_VIDEO?(t.videoUrl=Qt(t.videoUrl,n),t.snapshotUrl=Qt(t.thumbUrl,n),t.snapshotHeight=t.thumbHeight,t.snapshotWidth=t.thumbWidth):e===b.MSG_AUDIO?t.url=Qt(t.url,n):e===b.MSG_FILE&&(t.fileUrl=Qt(t.fileUrl,n)))}}]),e}(),ua=function(){function e(t,n){if(i(this,e),this.type=b.MSG_MERGER,this.content={downloadKey:"",pbDownloadKey:"",messageList:[],title:"",abstractList:[],compatibleText:"",version:0,layersOverLimit:!1},t.downloadKey){var r=t.downloadKey,o=t.pbDownloadKey,a=t.title,s=t.abstractList,c=t.compatibleText,u=t.version;this.content.downloadKey=r,this.content.pbDownloadKey=o,this.content.title=a,this.content.abstractList=s,this.content.compatibleText=c,this.content.version=u||0}else if(tn(t.messageList))1===t.layersOverLimit&&(this.content.layersOverLimit=!0);else{var l=t.messageList,d=t.title,p=t.abstractList,h=t.compatibleText,f=t.version,g=[];l.forEach((function(e){if(!tn(e)){var t=new ca(e,n);g.push(t)}})),this.content.messageList=g,this.content.title=d,this.content.abstractList=p,this.content.compatibleText=h,this.content.version=f||0}}return o(e,[{key:"sendable",value:function(){return!tn(this.content.messageList)||!tn(this.content.downloadKey)}}]),e}(),la={1:b.MSG_PRIORITY_HIGH,2:b.MSG_PRIORITY_NORMAL,3:b.MSG_PRIORITY_LOW,4:b.MSG_PRIORITY_LOWEST},da=function(){function e(t){i(this,e),this.ID="",this.conversationID=t.conversationID||null,this.conversationType=t.conversationType||b.CONV_C2C,this.conversationSubType=t.conversationSubType,this.time=t.time||Math.ceil(Date.now()/1e3),this.sequence=t.sequence||0,this.clientSequence=t.clientSequence||t.sequence||0,this.random=t.random||0===t.random?t.random:Tt(),this.priority=this._computePriority(t.priority),this.nick=t.nick||"",this.avatar=t.avatar||"",this.isPeerRead=!1,this.nameCard="",this._elements=[],this.isPlaceMessage=t.isPlaceMessage||0,this.isRevoked=2===t.isPlaceMessage||8===t.msgFlagBits,this.from=t.from||null,this.to=t.to||null,this.flow="",this.isSystemMessage=t.isSystemMessage||!1,this.protocol=t.protocol||"JSON",this.isResend=!1,this.isRead=!1,this.status=t.status||an.SUCCESS,this._onlineOnlyFlag=!1,this._groupAtInfoList=[],this._relayFlag=!1,this.atUserList=[],this.cloudCustomData=t.cloudCustomData||"",this.isDeleted=!1,this.isModified=!1,this._isExcludedFromUnreadCount=!(!t.messageControlInfo||1!==t.messageControlInfo.excludedFromUnreadCount),this._isExcludedFromLastMessage=!(!t.messageControlInfo||1!==t.messageControlInfo.excludedFromLastMessage),this.clientTime=t.clientTime||Fe()||0,this.senderTinyID=t.senderTinyID||t.tinyID||"",this.readReceiptInfo=t.readReceiptInfo||{readCount:void 0,unreadCount:void 0,isPeerRead:void 0},this.needReadReceipt=!0===t.needReadReceipt||1===t.needReadReceipt,this.version=t.messageVersion||0,this.isBroadcastMessage=t.isBroadcastMessage||!1,this._receiverList=t.receiverList||void 0,this.isSupportExtension=!0===t.isSupportExtension||1===t.isSupportExtension,this.revoker=t.revokerInfo&&t.revokerInfo.revoker||null,this.reInitialize(t.currentUser),this.extractGroupInfo(t.groupProfile||null),this.handleGroupAtInfo(t),this.initC2CReadReceiptInfo(t.readReceiptSentByPeer)}return o(e,[{key:"elements",get:function(){return this._elements}},{key:"getElements",value:function(){return this._elements}},{key:"extractGroupInfo",value:function(e){if(null!==e){ut(e.nick)&&(this.nick=e.nick),ut(e.avatar)&&(this.avatar=e.avatar);var t=e.messageFromAccountExtraInformation;dt(t)&&ut(t.nameCard)&&(this.nameCard=t.nameCard)}}},{key:"handleGroupAtInfo",value:function(e){var t=this;e.payload&&e.payload.atUserList&&e.payload.atUserList.forEach((function(e){e!==b.MSG_AT_ALL?(t._groupAtInfoList.push({groupAtAllFlag:0,groupAtUserID:e}),t.atUserList.push(e)):(t._groupAtInfoList.push({groupAtAllFlag:1}),t.atUserList.push(b.MSG_AT_ALL))})),pt(e.groupAtInfo)&&e.groupAtInfo.forEach((function(e){0===e.groupAtAllFlag?t.atUserList.push(e.groupAtUserID):1===e.groupAtAllFlag&&t.atUserList.push(b.MSG_AT_ALL)}))}},{key:"getGroupAtInfoList",value:function(){return this._groupAtInfoList}},{key:"_initProxy",value:function(){this._elements[0]&&(this.payload=this._elements[0].content,this.type=this._elements[0].type)}},{key:"reInitialize",value:function(e){e&&(this.status=this.from?an.SUCCESS:an.UNSEND,!this.from&&(this.from=e)),this._initFlow(e),this._initSequence(e),this._concatConversationID(e),this.generateMessageID()}},{key:"isSendable",value:function(){return 0!==this._elements.length&&"function"==typeof this._elements[0].sendable&&this._elements[0].sendable()}},{key:"_initTo",value:function(e){this.conversationType===b.CONV_GROUP&&(this.to=e.groupID)}},{key:"_initSequence",value:function(e){0===this.clientSequence&&e&&(this.clientSequence=function(e){if(!e)return!1;if(void 0===kt[e]){var t=new Date,n="3".concat(t.getHours()).slice(-2),i="0".concat(t.getMinutes()).slice(-2),r="0".concat(t.getSeconds()).slice(-2);kt[e]=parseInt([n,i,r,"0001"].join("")),n=null,i=null,r=null,He.l("autoIncrementIndex start index:".concat(kt[e]))}return kt[e]++}(e)),0===this.sequence&&this.conversationType===b.CONV_C2C&&(this.sequence=this.clientSequence)}},{key:"generateMessageID",value:function(){this.from===b.CONV_SYSTEM&&(this.senderTinyID="144115198244471703"),this.ID="".concat(this.senderTinyID,"-").concat(this.clientTime,"-").concat(this.random)}},{key:"_initFlow",value:function(e){""!==e&&(e===this.from?(this.flow="out",this.isRead=!0):this.flow="in")}},{key:"_concatConversationID",value:function(e){var t=this.to,n="",i=this.conversationType;i!==b.CONV_SYSTEM?(n=i===b.CONV_C2C?e===this.from?t:this.from:this.to,this.conversationID=n?"".concat(i).concat(n):null):this.conversationID=b.CONV_SYSTEM}},{key:"isElement",value:function(e){return e instanceof Jo||e instanceof Xo||e instanceof Zo||e instanceof Qo||e instanceof ra||e instanceof aa||e instanceof ta||e instanceof ia||e instanceof oa||e instanceof sa||e instanceof ua}},{key:"setElement",value:function(e,t){var n=this;if(this.isElement(e))return this._elements=[e],void this._initProxy();var i=function(e){if(e.type&&e.content)switch(e.type){case b.MSG_TEXT:n.setTextElement(e.content);break;case b.MSG_IMAGE:n.setImageElement(e.content,t);break;case b.MSG_AUDIO:n.setAudioElement(e.content,t);break;case b.MSG_FILE:n.setFileElement(e.content,t);break;case b.MSG_VIDEO:n.setVideoElement(e.content,t);break;case b.MSG_CUSTOM:n.setCustomElement(e.content);break;case b.MSG_LOCATION:n.setLocationElement(e.content);break;case b.MSG_GRP_TIP:n.setGroupTipElement(e.content);break;case b.MSG_GRP_SYS_NOTICE:n.setGroupSystemNoticeElement(e.content);break;case b.MSG_FACE:n.setFaceElement(e.content);break;case b.MSG_MERGER:n.setMergerElement(e.content,t)}};if(pt(e))for(var r=0;r<e.length;r++)i(e[r]);else i(e);this._initProxy()}},{key:"clearElement",value:function(){this._elements.length=0}},{key:"setTextElement",value:function(e){var t="string"==typeof e?e:e.text,n=new Jo({text:t});this._elements.push(n)}},{key:"setImageElement",value:function(e,t){var n=new Xo(e,t);this._elements.push(n)}},{key:"setAudioElement",value:function(e,t){var n=new Qo(e,t);this._elements.push(n)}},{key:"setFileElement",value:function(e,t){var n=new ra(e,t);this._elements.push(n)}},{key:"setVideoElement",value:function(e,t){var n=new aa(e,t);this._elements.push(n)}},{key:"setLocationElement",value:function(e){var t=new sa(e);this._elements.push(t)}},{key:"setCustomElement",value:function(e){var t=new oa(e);this._elements.push(t)}},{key:"setGroupTipElement",value:function(e){var t={},n=e.operationType;if(tn(e.memberInfoList)?e.operatorInfo&&(t=e.operatorInfo):n!==b.GRP_TIP_MBR_JOIN&&n!==b.GRP_TIP_MBR_KICKED_OUT&&n!==b.GRP_TIP_MBR_SET_ADMIN&&n!==b.GRP_TIP_MBR_CANCELED_ADMIN||(t=e.memberInfoList[0]),!tn(e.memberExtraInfo)){var i=e.memberExtraInfo.reason;e.msgMemberInfo.forEach((function(e){e.reason=i}))}var r=t,o=r.nick,a=r.avatar;ut(o)&&(this.nick=o),ut(a)&&(this.avatar=a);var s=new ta(e);this._elements.push(s)}},{key:"setGroupSystemNoticeElement",value:function(e){var t=new ia(e);this._elements.push(t)}},{key:"setFaceElement",value:function(e){var t=new Zo(e);this._elements.push(t)}},{key:"setMergerElement",value:function(e,t){var n=new ua(e,t);this._elements.push(n)}},{key:"setIsRead",value:function(e){this.isRead=e}},{key:"setRelayFlag",value:function(e){this._relayFlag=e}},{key:"getRelayFlag",value:function(){return this._relayFlag}},{key:"_computePriority",value:function(e){if(ht(e))return b.MSG_PRIORITY_NORMAL;if(ut(e)&&-1!==Object.values(la).indexOf(e))return e;if(ct(e)){var t=""+e;if(-1!==Object.keys(la).indexOf(t))return la[t]}return b.MSG_PRIORITY_NORMAL}},{key:"setNickAndAvatar",value:function(e){var t=e.nick,n=e.avatar;ut(t)&&(this.nick=t),ut(n)&&(this.avatar=n)}},{key:"setNameCard",value:function(e){ut(e)&&(this.nameCard=e)}},{key:"initC2CReadReceiptInfo",value:function(e){this.conversationType===b.CONV_C2C&&!0===this.needReadReceipt&&(this.readReceiptInfo.isPeerRead=1===e)}}]),e}(),pa=function(e){return{code:0,data:e||{}}},ha=function(e){s(n,e);var t=m(n);function n(e){var r;i(this,n),r=t.call(this);var o=e.code,a=e.message,s=e.data;return r.code=o,r.message=a||r._getErrorMessage(r.code),r.data=s||{},r}return o(n)}(p(Error)),fa=null,ga=function(e){fa=e},ma=function(e){return Promise.resolve(pa(e))},va=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e instanceof ha)return t&&null!==fa&&fa.emit(k.ERROR,e),Promise.reject(e);if(e instanceof Error){var n=new ha({code:No.UNCAUGHT_ERROR});return t&&null!==fa&&fa.emit(k.ERROR,n),Promise.reject(n)}if(!ht(e)&&!ht(e.code)){var i=new ha(e);return t&&null!==fa&&fa.emit(k.ERROR,i),Promise.reject(i)}},_a=function(e){s(r,e);var n=m(r);function r(e){var t;return i(this,r),(t=n.call(this,e))._n="C2CModule",t._messageFromUnreadDBMap=new Map,t._signalingFromUnreadDBList=[],t}return o(r,[{key:"onNewC2CMessage",value:function(e){var t=e.dataList,n=e.isInstantMessage,i=e.C2CRemainingUnreadList,r=e.C2CPairUnreadList;He.d("".concat(this._n,".onNewC2CMessage count:").concat(t.length," isInstantMessage:").concat(n));var o=this._newC2CMessageStoredAndSummary({dataList:t,C2CRemainingUnreadList:i,C2CPairUnreadList:r,isInstantMessage:n}),a=o.conversationOptionsList,s=o.messageList,c=o.isUnreadC2CMessage;this.filterModifiedMessage(s),a.length>0&&this.getModule(zn).onNewMessage({conversationOptionsList:a,isInstantMessage:n,isUnreadC2CMessage:c});var u=this.filterUnmodifiedMessage(s);n&&u.length>0&&this.emitOuterEvent(k.MESSAGE_RECEIVED,u),s.length=0}},{key:"_newC2CMessageStoredAndSummary",value:function(e){for(var t=e.dataList,n=e.C2CRemainingUnreadList,i=e.C2CPairUnreadList,r=e.isInstantMessage,o=null,a=[],s=[],c={},u=this.getModule(Xn),l=this.getModule(si),d=!1,p=this.getModule(zn),h=this.getFileDownloadProxy(),f=0,g=t.length;f<g;f++)if(this._isSignaling(t[f]))this._signalingFromUnreadDBList.push(t[f].eventArray[0].c2CNotifyMsgArray[0]);else{var m=t[f];m.currentUser=this.getMyUserID(),m.conversationType=b.CONV_C2C,m.isSystemMessage=!!m.isSystemMessage,(ht(m.nick)||ht(m.avatar))&&(d=!0,He.d("".concat(this._n,"._newC2CMessageStoredAndSummary nick or avatar missing!"))),o=new da(m),m.elements=u.parseElements(m.elements,m.from),o.setElement(m.elements,h),o.setNickAndAvatar({nick:m.nick,avatar:m.avatar});var v=o.conversationID;if(r){if(1===this._messageFromUnreadDBMap.get(o.ID))continue;var _=!1;if(o.from!==this.getMyUserID()){var y=p.getLatestMessageSentByPeer(v);if(y){var I=y.nick,M=y.avatar;d?o.setNickAndAvatar({nick:I,avatar:M}):I===o.nick&&M===o.avatar||(_=!0)}}else{var T=p.getLatestMessageSentByMe(v);if(T){var C=T.nick,S=T.avatar;C===o.nick&&S===o.avatar||p.modifyMessageSentByMe({conversationID:v,latestNick:o.nick,latestAvatar:o.avatar})}}var E=1===t[f].isModified;if(p.isMessageSentByCurrentInstance(o)?o.isModified=E:E=!1,0===m.msgLifeTime)o._onlineOnlyFlag=!0,p.isMessageSentByCurrentInstance(o)||s.push(o);else{if(!p.pushIntoMessageList(s,o,E))continue;_&&(p.modifyMessageSentByPeer({conversationID:v,latestNick:o.nick,latestAvatar:o.avatar}),p.updateUserProfileSpecifiedKey({conversationID:v,nick:o.nick,avatar:o.avatar}))}r&&o.clientTime>0&&l.addMessageDelay(o.clientTime)}else this._messageFromUnreadDBMap.set(o.ID,1);if(0!==m.msgLifeTime){if(!1===o._onlineOnlyFlag){var k=p.getLastMessageTime(v);if(ct(k)&&o.time<k)continue;if(ht(c[v])){var D=0;"in"===o.flow&&(o._isExcludedFromUnreadCount||(D=1)),c[v]=a.push({conversationID:v,unreadCount:D,type:o.conversationType,subType:o.conversationSubType,lastMessage:o._isExcludedFromLastMessage?"":o})-1}else{var w=c[v];a[w].type=o.conversationType,a[w].subType=o.conversationSubType,a[w].lastMessage=o._isExcludedFromLastMessage?"":o,"in"===o.flow&&(o._isExcludedFromUnreadCount||a[w].unreadCount++)}}}else o._onlineOnlyFlag=!0}this._handleSignalingFromUnreadDB();var A=!1;if(pt(i))for(var R=function(e,t){if(i[e].unreadCount>0){A=!0;var n=a.find((function(t){return t.conversationID==="C2C".concat(i[e].from)}));n?n.unreadCount=i[e].unreadCount:a.push({conversationID:"C2C".concat(i[e].from),unreadCount:i[e].unreadCount,type:b.CONV_C2C})}},L=0,O=i.length;L<O;L++)R(L);if(pt(n))for(var N=function(e,t){a.find((function(t){return t.conversationID==="C2C".concat(n[e].from)}))||a.push({conversationID:"C2C".concat(n[e].from),type:b.CONV_C2C,lastMsgTime:n[e].lastMsgTime})},P=0,U=n.length;P<U;P++)N(P);return{conversationOptionsList:a,messageList:s,isUnreadC2CMessage:A}}},{key:"_isSignaling",value:function(e){var t=e.eventArray;return!(!pt(t)||10!==t[0].event)}},{key:"_handleSignalingFromUnreadDB",value:function(){var e=this._signalingFromUnreadDBList.length;if(He.l("".concat(this._n,"._handleSignalingFromUnreadDB signalingCount:").concat(e)),0!==e){var t=[];this._signalingFromUnreadDBList.forEach((function(e){e.hasOwnProperty("c2cMessageRevokedNotify")&&t.push(e)})),this.onC2CMessageRevoked({dataList:t}),this._signalingFromUnreadDBList.length=0,t.length=0}}},{key:"onC2CMessageRevoked",value:function(e){var t=this,n=this.getModule(zn),i=[],r=null,o=!0;e.dataList.forEach((function(e){if(e.c2cMessageRevokedNotify){var a=e.c2cMessageRevokedNotify.revokedInfos;ht(a)||a.forEach((function(e){var a=t.getMyUserID()===e.from?"".concat(b.CONV_C2C).concat(e.to):"".concat(b.CONV_C2C).concat(e.from);r=n.revoke(a,e.sequence,e.random);var s=e.revokerInfo&&e.revokerInfo.revoker;if(r)r.revoker||(r.revoker=s,i.push(r));else{var c={conversationID:a,sequence:e.sequence,time:e.time,revoker:s};n.isLastMessageRevoked(c)&&(i.push(c),o=!1)}}))}})),0!==i.length&&(n.onMessageRevoked(i),!0===o&&(He.l("".concat(this._n,".onC2CMessageRevoked count:").concat(i.length)),this.emitOuterEvent(k.MESSAGE_REVOKED,i)))}},{key:"onC2CMessageReadReceipt",value:function(e){var t=this;e.dataList.forEach((function(e){if(!tn(e.c2cMessageReadReceipt)){var n=e.c2cMessageReadReceipt.to;e.c2cMessageReadReceipt.uinPairReadArray.forEach((function(e){var i=e.peerReadTime;He.d("".concat(t._n,"._onC2CMessageReadReceipt to:").concat(n," peerReadTime:").concat(i));var r="".concat(b.CONV_C2C).concat(n),o=t.getModule(zn);o.recordPeerReadTime(r,i),o.updateMessageIsPeerReadProperty(r,i)}))}}))}},{key:"onC2CMessageReadNotice",value:function(e){var t=this;e.dataList.forEach((function(e){if(!tn(e.c2cMessageReadNotice)){var n=t.getModule(zn);e.c2cMessageReadNotice.uinPairReadArray.forEach((function(e){var i=e.from,r=e.peerReadTime;He.d("".concat(t._n,".onC2CMessageReadNotice from:").concat(i," lastReadTime:").concat(r));var o="".concat(b.CONV_C2C).concat(i);n.updateIsReadAfterReadReport({conversationID:o,lastMessageTime:r}),n.updateUnreadCount(o)}))}}))}},{key:"onC2CMessageModified",value:function(e){He.d("".concat(this._n,".onC2CMessageModified options:"),JSON.stringify(e));var n=this.getModule(zn);e.dataList.forEach((function(e){n.onMessageModified(t(t({},e),{},{conversationType:b.CONV_C2C}))}))}},{key:"onReadReceiptList",value:function(e){He.d("".concat(this._n,".onReadReceiptList options:"),JSON.stringify(e));var t=e.dataList,n=t.userID,i=t.readReceiptList;this.getModule(zn).updateReadReceiptInfo({userID:n,readReceiptList:i})}},{key:"sendMessage",value:function(e,t){var n=this._createC2CMessagePack(e,t);return this.request(n)}},{key:"_createC2CMessagePack",value:function(e,t){var n=null;t&&(t.offlinePushInfo&&(n=t.offlinePushInfo),!0===t.onlineUserOnly&&(n?n.disablePush=!0:n={disablePush:!0}));var i="";ut(e.cloudCustomData)&&e.cloudCustomData.length>0&&(i=e.cloudCustomData);var r=[];if(dt(t)&&dt(t.messageControlInfo)){var o=t.messageControlInfo,a=o.excludedFromUnreadCount,s=o.excludedFromLastMessage,c=o.excludedFromContentModeration;!0===a&&r.push("NoUnread"),!0===s&&r.push("NoLastMsg"),!0===c&&r.push("NoMsgCheck")}var u=this.isOnlineMessage(e,t)?0:void 0;return{protocolName:Mi,tjgID:this.generateTjgID(e),requestData:{fromAccount:this.getMyUserID(),toAccount:e.to,msgBody:e.getElements(),cloudCustomData:i,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:u,nick:e.nick,avatar:e.avatar,offlinePushInfo:n?{pushFlag:!0===n.disablePush?1:0,title:n.title||"",desc:n.description||"",ext:n.extension||"",apnsInfo:{badgeMode:!0===n.ignoreIOSBadge?1:0,isVoipPush:this._isVoipPush(n)},androidInfo:{OPPOChannelID:n.androidOPPOChannelID||""}}:void 0,messageControlInfo:0!==u?r:void 0,clientTime:e.clientTime,needReadReceipt:!0===e.needReadReceipt?1:0,isSupportExtension:!0===e.isSupportExtension?1:0}}}},{key:"_isVoipPush",value:function(e){var t=void 0;return ht(e.disableVoipPush)||(t=!1===e.disableVoipPush?1:0),t}},{key:"isOnlineMessage",value:function(e,t){return!(!t||!0!==t.onlineUserOnly)}},{key:"revokeMessage",value:function(e){return this.request({protocolName:Bi,requestData:{msgInfo:{fromAccount:e.from,toAccount:e.to,msgSeq:e.sequence,msgRandom:e.random,msgTimeStamp:e.time}}})}},{key:"deleteMessage",value:function(e){var t=e.to,n=e.keyList;return He.l("".concat(this._n,".deleteMessage toAccount:").concat(t," count:").concat(n.length)),this.request({protocolName:Yi,requestData:{fromAccount:this.getMyUserID(),to:t,keyList:n}})}},{key:"modifyRemoteMessage",value:function(e){var t=e.from,n=e.to,i=e.version,r=void 0===i?0:i,o=e.sequence,a=e.random,s=e.time,c=e.payload,u=e.type,l=e.cloudCustomData,d=void 0;return $t(u)&&(d=[]).push({type:u,content:c}),this.request({protocolName:$i,requestData:{from:t,to:n,version:r,sequence:o,random:a,time:s,elements:d,cloudCustomData:l}})}},{key:"setMessageRead",value:function(e){var t=this,n=e.conversationID,i=e.lastMessageTime,r="".concat(this._n,".setMessageRead");He.l("".concat(r," conversationID:").concat(n," lastMessageTime:").concat(i)),ct(i)||this.outputWarning("DoNotModifyLastTime");var o=new $o("setC2CMessageRead");return o.setMessage("conversationID:".concat(n," lastMessageTime:").concat(i)),this.request({protocolName:Hi,requestData:{C2CMsgReaded:{cookie:"",C2CMsgReadedItem:[{toAccount:n.replace("C2C",""),lastMessageTime:i,receipt:1}]}}}).then((function(){o.setNetworkType(t.getNetworkType()).end(),He.l("".concat(r," ok"));var e=t.getModule(zn);return e.updateIsReadAfterReadReport({conversationID:n,lastMessageTime:i}),e.updateUnreadCount(n),pa()})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),He.l("".concat(r," failed. error:"),e),va(e)}))}},{key:"getRoamingMessage",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessage"),i=e.peerAccount,r=e.conversationID,o=e.count,a=e.lastMessageTime,s=e.messageKey,c="peerAccount:".concat(i," count:").concat(o||15," lastMessageTime:").concat(a||0," messageKey:").concat(s);He.l("".concat(n," ").concat(c));var u=new $o("getC2CRoamingMessages");return this.request({protocolName:zi,requestData:{peerAccount:i,count:o||15,lastMessageTime:a||0,messageKey:s}}).then((function(e){var i=e.data,o=i.complete,a=i.messageList,s=i.messageKey,l=i.lastMessageTime;ht(a)?He.l("".concat(n," ok. complete:").concat(o," but messageList is undefined!")):He.l("".concat(n," ok. complete:").concat(o," count:").concat(a.length)),u.setNetworkType(t.getNetworkType()).setMessage("".concat(c," complete:").concat(o," length:").concat(a.length)).end();var d=t.getModule(zn);1===o&&d.setCompleted(r);var p=d.onRoamingMessage(a,r);d.modifyMessageList(r),d.updateIsRead(r),d.updateRoamingMessageKeyAndTime(r,s,l);var h=d.getPeerReadTime(r);if(He.l("".concat(n," update isPeerRead property. conversationID:").concat(r," peerReadTime:").concat(h)),h)d.updateMessageIsPeerReadProperty(r,h);else{var f=r.replace(b.CONV_C2C,"");t.getRemotePeerReadTime([f]).then((function(){d.updateMessageIsPeerReadProperty(r,d.getPeerReadTime(r))}))}var g="";if(p.length>0)g=p[0].ID;else{var m=d.getLocalOldestMessage(r);m&&(g=m.ID)}return He.l("".concat(n," nextReqID:").concat(g," stored message count:").concat(p.length)),{nextReqID:g,storedMessageList:p}})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];u.setMessage(c).setError(e,i,r).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessagesHopping"),i=e.peerAccount,r=e.time,o=void 0===r?0:r,a=e.count,s=e.direction,c="".concat(b.CONV_C2C).concat(i),u="peerAccount:".concat(i," count:").concat(a," time:").concat(o," direction:").concat(s);He.l("".concat(n," ").concat(u));var l=new $o("getC2CRoamingMessagesHopping");return this.request({protocolName:zi,requestData:{peerAccount:i,count:a+1,lastMessageTime:o,direction:s}}).then((function(e){var i=e.data,r=i.complete,o=i.messageList,a=void 0===o?[]:o,d=i.lastMessageTime;He.l("".concat(n," ok. complete:").concat(r," count:").concat(a.length)),l.setNetworkType(t.getNetworkType()).setMessage("".concat(u," complete:").concat(r," length:").concat(a.length)).end(),1!==r&&(1===s?a.pop():a.shift());var p=t.getModule(zn).onRoamingMessage(a,c,!1);t._modifyMessageList(c,p);var h=t._computeResult({complete:r,lastMessageTime:d,resultList:p});return pa(h)})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];l.setMessage(u).setError(e,i,r).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"_computeResult",value:function(e){var t=e.complete,n=void 0===t?0:t,i=e.lastMessageTime,r=e.resultList,o={messageList:_(void 0===r?[]:r),isCompleted:!1,nextMessageTime:""};return 1===n?(o.isCompleted=!0,o):(o.nextMessageTime=i,o)}},{key:"_modifyMessageList",value:function(e,t){var n=this.getModule(zn).getLocalConversation(e);if(n)for(var i=n.userProfile.nick,r=n.userProfile.avatar,o=this.getModule(Vn).getNickAndAvatarByUserID(this.getMyUserID()),a=o.nick,s=o.avatar,c=t.length-1;c>=0;c--){var u=t[c];"in"===u.flow&&(u.nick!==i&&u.setNickAndAvatar({nick:i}),u.avatar!==r&&u.setNickAndAvatar({avatar:r})),"out"===u.flow&&(u.nick!==a&&u.setNickAndAvatar({nick:a}),u.avatar!==s&&u.setNickAndAvatar({avatar:s}))}}},{key:"getRemotePeerReadTime",value:function(e){var t=this,n="".concat(this._n,".getRemotePeerReadTime");if(tn(e))return He.w("".concat(n," userIDList is empty!")),Promise.resolve();var i=new $o("getPeerReadTime");return He.l("".concat(n," userIDList:").concat(e)),this.request({protocolName:Wi,requestData:{userIDList:e}}).then((function(r){var o=r.data.peerReadTimeList;He.l("".concat(n," ok. peerReadTimeList:").concat(o));for(var a="",s=t.getModule(zn),c=0;c<e.length;c++)a+="".concat(e[c],"-").concat(o[c]," "),o[c]>0&&s.recordPeerReadTime("C2C".concat(e[c]),o[c]);i.setNetworkType(t.getNetworkType()).setMessage(a).end()})).catch((function(e){t.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),He.w("".concat(n," failed. error:"),e)}))}},{key:"sendReadReceipt",value:function(e){var t=this,n=e[0].conversationID.replace(b.CONV_C2C,""),i=new $o("sendC2CReadReceipt");i.setMessage("peerAccount:".concat(n));var r=this.getMyUserID(),o=e.filter((function(e){return e.from!==r&&!0===e.needReadReceipt})).map((function(e){return{fromAccount:e.from,toAccount:e.to,sequence:e.sequence,random:e.random,time:e.time,clientTime:e.clientTime}}));if(0===o.length)return va({code:No.READ_RECEIPT_MESSAGE_LIST_EMPTY});var a="".concat(this._n,".sendReadReceipt");return He.l("".concat(a,". peerAccount:").concat(n," messageInfoList length:").concat(o.length)),this.request({protocolName:Rr,requestData:{peerAccount:n,messageInfoList:o}}).then((function(e){return i.end(),He.l("".concat(a," ok")),pa()})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),He.w("".concat(a," failed. error:"),e),va(e)}))}},{key:"getReadReceiptList",value:function(e){var t="".concat(this._n,".getReadReceiptList"),n=this.getMyUserID(),i=e.filter((function(e){return e.from===n&&!0===e.needReadReceipt}));return He.l("".concat(t," userID:").concat(n," messageList length:").concat(i.length)),ma({messageList:i})}},{key:"getMessageExtensions",value:function(e,t){return He.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.request({protocolName:Xi,requestData:{from:e.from,to:e.to,messageKey:this._getMessageKey(e),startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return He.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n)),this.request({protocolName:Ji,requestData:{from:e.from,to:e.to,messageKey:this._getMessageKey(e),extensionList:t,operateType:n}})}},{key:"_getMessageKey",value:function(e){var t=e.clientSequence,n=e.random,i=e.time;return"".concat(t,"_").concat(n,"_").concat(i)}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._messageFromUnreadDBMap.clear(),this._signalingFromUnreadDBList.length=0}}]),r}(fi),ya=function(){function e(){i(this,e),this.list=new Map,this._n="MessageListHandler",this._latestMessageSentByPeerMap=new Map,this._latestMessageSentByMeMap=new Map}return o(e,[{key:"getLocalOldestMessageByConversationID",value:function(e){if(!e)return null;if(!this.list.has(e))return null;var t=this.list.get(e).values();return t?t.next().value:null}},{key:"pushIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.conversationID,i=!0;this.list.has(n)||this.list.set(n,new Map);var r=this._getUniqueIDOfMessage(e);if(this.list.get(n).has(r)){var o=this.list.get(n).get(r);if(!t||!0===o.isModified)return!1}return this.list.get(n).set(r,e),this._setLatestMessageSentByPeer(n,e),this._setLatestMessageSentByMe(n,e),i}},{key:"unshift",value:function(e,t){var n;if(pt(e)?e.length>0&&(n=e[0].conversationID,this._unshiftMultipleMessages(e,t)):(n=e.conversationID,this._unshiftSingleMessage(e,t)),n&&n.startsWith(b.CONV_C2C)){var i=Array.from(this.list.get(n).values()),r=i.length;if(0===r)return;for(var o=r-1;o>=0;o--)if("out"===i[o].flow){this._setLatestMessageSentByMe(n,i[o]);break}for(var a=r-1;a>=0;a--)if("in"===i[a].flow){this._setLatestMessageSentByPeer(n,i[a]);break}}}},{key:"_unshiftSingleMessage",value:function(e,t){var n=e.conversationID,i=this._getUniqueIDOfMessage(e);if(!this.list.has(n))return this.list.set(n,new Map),this.list.get(n).set(i,e),void t.push(e);var r=this.list.get(n),o=Array.from(r);r.has(i)||(o.unshift([i,e]),this.list.set(n,new Map(o)),t.push(e))}},{key:"_unshiftMultipleMessages",value:function(e,t){for(var n=e.length,i=[],r=e[0].conversationID,o=this.list.get(r),a=this.list.has(r)?Array.from(o):[],s=0;s<n;s++){var c=this._getUniqueIDOfMessage(e[s]);o&&o.has(c)||(i.push([c,e[s]]),t.push(e[s]))}this.list.set(r,new Map(i.concat(a)))}},{key:"remove",value:function(e){var t=e.conversationID,n=this._getUniqueIDOfMessage(e);this.list.has(t)&&this.list.get(t).delete(n)}},{key:"revoke",value:function(e,t,n){if(He.d("revoke message",e,t,n),this.list.has(e)){var i,r=E(this.list.get(e));try{for(r.s();!(i=r.n()).done;){var o=v(i.value,2)[1];if(o.sequence===t&&(ht(n)||o.random===n))return o.isRevoked||(o.isRevoked=!0),o}}catch(a){r.e(a)}finally{r.f()}}return null}},{key:"removeByConversationID",value:function(e){this.list.has(e)&&(this.list.delete(e),this._latestMessageSentByPeerMap.delete(e),this._latestMessageSentByMeMap.delete(e))}},{key:"findMessage",value:function(e){var t,n=null,i=E(this.list);try{for(i.s();!(t=i.n()).done;)for(var r=_(v(t.value,2)[1].values()),o=r.length,a=0;a<o;a++)if(r[a].ID===e){n=r[a];break}}catch(s){i.e(s)}finally{i.f()}return n}},{key:"updateMessageIsPeerReadProperty",value:function(e,t){var n=[];if(this.list.has(e)){var i,r=E(this.list.get(e));try{for(r.s();!(i=r.n()).done;){var o=v(i.value,2)[1];o.time<=t&&!o.isPeerRead&&"out"===o.flow&&(o.isPeerRead=!0,n.push(o))}}catch(a){r.e(a)}finally{r.f()}He.l("".concat(this._n,".updateMessageIsPeerReadProperty conversationID:").concat(e," peerReadTime:").concat(t," count:").concat(n.length))}return n}},{key:"updateMessageIsModifiedProperty",value:function(e){var t=e.conversationID;if(this.list.has(t)){var n=this._getUniqueIDOfMessage(e),i=this.list.get(t).get(n);i&&(i.isModified=!0)}}},{key:"hasLocalMessageList",value:function(e){return this.list.has(e)}},{key:"getLocalMessageList",value:function(e){return this.hasLocalMessageList(e)?_(this.list.get(e).values()):[]}},{key:"hasLocalMessage",value:function(e,t){for(var n=!1,i=this.getLocalMessageList(e),r=i.length,o=0;o<r;o++)i[o].ID===t&&(n=!0);return n}},{key:"getLocalMessage",value:function(e,t){for(var n=null,i=this.getLocalMessageList(e),r=i.length,o=0;o<r;o++)if(i[o].ID===t){n=i[o];break}return n}},{key:"getLocalLastMessage",value:function(e){var t=this.getLocalMessageList(e);return t[t.length-1]}},{key:"getLocalOldestMessage",value:function(e){return this.getLocalMessageList(e)[0]}},{key:"_setLatestMessageSentByPeer",value:function(e,t){e.startsWith(b.CONV_C2C)&&"in"===t.flow&&this._latestMessageSentByPeerMap.set(e,t)}},{key:"_setLatestMessageSentByMe",value:function(e,t){e.startsWith(b.CONV_C2C)&&"out"===t.flow&&this._latestMessageSentByMeMap.set(e,t)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._latestMessageSentByPeerMap.get(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._latestMessageSentByMeMap.get(e)}},{key:"modifyMessageSentByPeer",value:function(e){var t=e.conversationID,n=e.latestNick,i=e.latestAvatar,r=this.list.get(t);if(!tn(r)){var o=Array.from(r.values()),a=o.length;if(0!==a){for(var s=null,c=0,u=!1,l=a-1;l>=0;l--)"in"===o[l].flow&&((s=o[l]).nick!==n&&(s.setNickAndAvatar({nick:n}),u=!0),s.avatar!==i&&(s.setNickAndAvatar({avatar:i}),u=!0),u&&(c+=1));He.l("".concat(this._n,".modifyMessageSentByPeer conversationID:").concat(t," count:").concat(c))}}}},{key:"modifyMessageSentByMe",value:function(e){var t=e.conversationID,n=e.latestNick,i=e.latestAvatar,r=this.list.get(t);if(!tn(r)){var o=Array.from(r.values()),a=o.length;if(0!==a){for(var s=null,c=0,u=!1,l=a-1;l>=0;l--)"out"===o[l].flow&&((s=o[l]).nick!==n&&(s.setNickAndAvatar({nick:n}),u=!0),s.avatar!==i&&(s.setNickAndAvatar({avatar:i}),u=!0),u&&(c+=1));He.l("".concat(this._n,".modifyMessageSentByMe conversationID:").concat(t," count:").concat(c))}}}},{key:"getTopicConversationIDList",value:function(e){return _(this.list.keys()).filter((function(t){return t.startsWith("".concat(b.CONV_GROUP).concat(e))}))}},{key:"traversal",value:function(){if(0!==this.list.size&&-1===He.getLevel()){var e,t=E(this.list);try{for(t.s();!(e=t.n()).done;){var n=v(e.value,2);n[0],n[1]}}catch(i){t.e(i)}finally{t.f()}}}},{key:"onMessageModified",value:function(e,t){if(!this.list.has(e))return{isUpdated:!1,message:null};var n=this._getUniqueIDOfMessage(t),i=this.list.get(e).has(n);if(He.d("".concat(this._n,".onMessageModified conversationID:").concat(e," uniqueID:").concat(n," has:").concat(i)),i){var r=this.list.get(e).get(n),o=t.messageVersion,a=t.elements,s=t.cloudCustomData;return r.version<o?(r.version=o,r._elements=JSON.parse(JSON.stringify(a)),r.payload=JSON.parse(JSON.stringify(a[0].content)),r.type=a[0].type,r.cloudCustomData=s,r.isModified=!0,{isUpdated:!0,message:r}):{isUpdated:!1,message:r}}return{isUpdated:!1,message:null}}},{key:"_getUniqueIDOfMessage",value:function(e){var t=e.from,n=e.to,i=e.random,r=e.sequence,o=e.time;return"".concat(t,"-").concat(n,"-").concat(i,"-").concat(r,"-").concat(o)}},{key:"reset",value:function(){this.list.clear(),this._latestMessageSentByPeerMap.clear(),this._latestMessageSentByMeMap.clear()}}]),e}(),Ia="_a2KeyAndTinyIDUpdated",Ma="_cloudConfigUpdated",Ta="_profileUpdated";function Ca(e){this.mixin(e)}Ca.mixin=function(e){var t=e.prototype||e;t._isReady=!1,t.ready=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)return this._isReady?void(t?e.call(this):setTimeout(e,1)):(this._readyQueue=this._readyQueue||[],void this._readyQueue.push(e))},t.triggerReady=function(){var e=this;this._isReady=!0,setTimeout((function(){var t=e._readyQueue;e._readyQueue=[],t&&t.length>0&&t.forEach((function(e){e.call(this)}),e)}),1)},t.resetReady=function(){this._isReady=!1,this._readyQueue=[]},t.isReady=function(){return this._isReady}};var Sa=["jpg","jpeg","gif","png","bmp","image","webp"],Ea=["mp4","quicktime","mov"],ka=1,ba=2,Da=3,wa=255,Aa=function(){function e(t){var n=this;i(this,e),tn(t)||(this.userID=t.userID||"",this.nick=t.nick||"",this.gender=t.gender||"",this.birthday=t.birthday||0,this.location=t.location||"",this.selfSignature=t.selfSignature||"",this.allowType=t.allowType||b.ALLOW_TYPE_ALLOW_ANY,this.language=t.language||0,this.avatar=t.avatar||"",this.messageSettings=t.messageSettings||0,this.adminForbidType=t.adminForbidType||b.FORBID_TYPE_NONE,this.level=t.level||0,this.role=t.role||0,this.lastUpdatedTime=0,this.profileCustomField=[],tn(t.profileCustomField)||t.profileCustomField.forEach((function(e){n.profileCustomField.push({key:e.key,value:e.value})})))}return o(e,[{key:"validate",value:function(e){var t=!0,n="";if(tn(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var i=e.profileCustomField.length,r=null,o=0;o<i;o++){if(r=e.profileCustomField[o],!ut(r.key)||-1===r.key.indexOf("Tag_Profile_Custom"))return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!ut(r.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if("profileCustomField"===a)continue;if(tn(e[a])&&!ut(e[a])&&!ct(e[a])){n="key:"+a+", invalid value:"+e[a],t=!1;continue}switch(a){case"nick":ut(e[a])||(n="nick must be a string",t=!1),Mt(e[a])>500&&(n="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(Mt(e[a])," bytes"),t=!1);break;case"gender":Et(Xe,e.gender)||(n="key:gender, invalid value:"+e.gender,t=!1);break;case"birthday":ct(e.birthday)||(n="birthday must be a number",t=!1);break;case"location":ut(e.location)||(n="location must be a string",t=!1);break;case"selfSignature":ut(e.selfSignature)||(n="selfSignature must be a string",t=!1);break;case"allowType":Et(Qe,e.allowType)||(n="key:allowType, invalid value:"+e.allowType,t=!1);break;case"language":ct(e.language)||(n="language must be a number",t=!1);break;case"avatar":ut(e.avatar)||(n="avatar must be a string",t=!1);break;case"messageSettings":0!==e.messageSettings&&1!==e.messageSettings&&(n="messageSettings must be 0 or 1",t=!1);break;case"adminForbidType":Et(Ze,e.adminForbidType)||(n="key:adminForbidType, invalid value:"+e.adminForbidType,t=!1);break;case"level":ct(e.level)||(n="level must be a number",t=!1);break;case"role":ct(e.role)||(n="role must be a number",t=!1);break;default:n="unknown key:"+a+"  "+e[a],t=!1}}return{valid:t,tips:n}}}]),e}(),Ra=o((function e(t){i(this,e),this.value=t,this.next=null})),La=function(){function e(t){i(this,e),this.MAX_LENGTH=t,this.pTail=null,this.pNodeToDel=null,this.map=new Map}return o(e,[{key:"set",value:function(e){var t=new Ra(e);if(this.map.size<this.MAX_LENGTH)null===this.pTail?(this.pTail=t,this.pNodeToDel=t):(this.pTail.next=t,this.pTail=t),this.map.set(e,1);else{var n=this.pNodeToDel;this.pNodeToDel=this.pNodeToDel.next,this.map.delete(n.value),n.next=null,n=null,this.pTail.next=t,this.pTail=t,this.map.set(e,1)}}},{key:"has",value:function(e){return this.map.has(e)}},{key:"delete",value:function(e){this.has(e)&&this.map.delete(e)}},{key:"tail",value:function(){return this.pTail}},{key:"size",value:function(){return this.map.size}},{key:"data",value:function(){return Array.from(this.map.keys())}},{key:"reset",value:function(){for(var e;null!==this.pNodeToDel;)e=this.pNodeToDel,this.pNodeToDel=this.pNodeToDel.next,e.next=null,e=null;this.pTail=null,this.map.clear()}}]),e}(),Oa=["groupID","name","avatar","type","introduction","notification","ownerID","selfInfo","createTime","infoSequence","lastInfoTime","lastMessage","nextMessageSeq","memberNum","maxMemberNum","memberList","joinOption","groupCustomField","muteAllMembers","isSupportTopic","inviteOption","_lastRevokedTime"],Na=function(){function e(t){i(this,e),this.groupID="",this.name="",this.avatar="",this.type="",this.introduction="",this.notification="",this.ownerID="",this.createTime="",this.infoSequence="",this.lastInfoTime="",this.selfInfo={messageRemindType:"",joinTime:"",nameCard:"",role:"",userID:"",memberCustomField:void 0,readedSequence:0,excludedUnreadSequenceList:void 0},this.lastMessage={lastTime:"",lastSequence:"",fromAccount:"",messageForShow:""},this.nextMessageSeq="",this.memberNum="",this.memberCount="",this.maxMemberNum="",this.maxMemberCount="",this.joinOption="",this.inviteOption="",this.groupCustomField=[],this.muteAllMembers=!1,this.isSupportTopic=!1,this._lastRevokedTime=0,this._initGroup(t)}return o(e,[{key:"memberNum",get:function(){return this.memberCount},set:function(e){}},{key:"maxMemberNum",get:function(){return this.maxMemberCount},set:function(e){}},{key:"_initGroup",value:function(e){for(var t in e)Oa.indexOf(t)<0||("selfInfo"!==t?("memberNum"===t&&(this.memberCount=e[t]),"maxMemberNum"===t&&(this.maxMemberCount=e[t]),"isSupportTopic"!==t?this[t]=e[t]:this.isSupportTopic=1===e[t]):this.updateSelfInfo(e[t]))}},{key:"updateGroup",value:function(e){var t=this;e.appid=void 0,e.grossTopicNextMsgSeq=void 0,e.selfInfo&&(e.selfInfo.grossTopicReadSeq=void 0);var n=JSON.parse(JSON.stringify(e));n.lastMsgTime&&(this.lastMessage.lastTime=n.lastMsgTime),ht(n.muteAllMembers)||("On"===n.muteAllMembers?n.muteAllMembers=!0:n.muteAllMembers=!1),n.groupCustomField&&wt(this.groupCustomField,n.groupCustomField),ht(n.memberNum)||(this.memberCount=n.memberNum),ht(n.maxMemberNum)||(this.maxMemberCount=n.maxMemberNum),ht(n.isSupportTopic)||(this.isSupportTopic=ct(n.isSupportTopic)?1===n.isSupportTopic:n.isSupportTopic),yt(this,n,["members","errorCode","lastMsgTime","groupCustomField","memberNum","maxMemberNum","isSupportTopic"]),pt(n.members)&&n.members.length>0&&n.members.forEach((function(e){e.userID===t.selfInfo.userID&&yt(t.selfInfo,e,["sequence"])}))}},{key:"updateSelfInfo",value:function(e){var n={nameCard:e.nameCard,joinTime:e.joinTime,role:e.role,messageRemindType:e.messageRemindType,readedSequence:e.readedSequence,excludedUnreadSequenceList:e.excludedUnreadSequenceList};yt(this.selfInfo,t({},n),[],["",null,void 0,0,NaN])}},{key:"setSelfNameCard",value:function(e){this.selfInfo.nameCard=e}}]),e}(),Pa=function(e,n){return ht(e)?{lastTime:0,lastSequence:0,fromAccount:0,messageForShow:"",payload:null,type:"",isRevoked:!1,cloudCustomData:"",onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:!1,revoker:null}:e instanceof da?{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",messageForShow:Yt(e.type,e.payload,n),payload:e.payload||null,type:e.type||null,isRevoked:e.isRevoked||!1,cloudCustomData:e.cloudCustomData||"",onlineOnlyFlag:e._onlineOnlyFlag||!1,nick:e.nick||"",nameCard:e.nameCard||"",version:e.version||0,isPeerRead:e.isPeerRead||!1,revoker:e.revoker||null}:t(t({},e),{},{messageForShow:Yt(e.type,e.payload,n)})},Ua=function(){function e(t,n){i(this,e),this.conversationID=t.conversationID||"",this.unreadCount=t.unreadCount||0,this.type=t.type||"",this.lastMessage=Pa(t.lastMessage,n),t.lastMsgTime&&(this.lastMessage.lastTime=t.lastMsgTime),this._isInfoCompleted=!1,this.peerReadTime=t.peerReadTime||0,this.groupAtInfoList=[],this.remark="",this.isPinned=t.isPinned||!1,this.messageRemindType="",this.markList=t.markList||[],this.customData=t.customData||"",this.conversationGroupList=t.conversationGroupList||[],this._initProfile(t)}return o(e,[{key:"toAccount",get:function(){return this.conversationID.startsWith(b.CONV_C2C)?this.conversationID.replace(b.CONV_C2C,""):this.conversationID.startsWith(b.CONV_GROUP)?this.conversationID.replace(b.CONV_GROUP,""):""}},{key:"subType",get:function(){return this.groupProfile?this.groupProfile.type:""}},{key:"_initProfile",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"userProfile":t.userProfile=e.userProfile;break;case"groupProfile":t.groupProfile=e.groupProfile}})),ht(this.userProfile)&&this.type===b.CONV_C2C?this.userProfile=new Aa({userID:e.conversationID.replace("C2C","")}):ht(this.groupProfile)&&this.type===b.CONV_GROUP&&(this.groupProfile=new Na({groupID:e.conversationID.replace("GROUP","")}))}},{key:"updateUnreadCount",value:function(e){var t=e.nextUnreadCount,n=e.isFromGetConversations,i=e.isUnreadC2CMessage;ht(t)||(At(this.subType)?this.unreadCount=0:n&&this.type===b.CONV_GROUP||n&&this.type===b.CONV_TOPIC||i&&this.type===b.CONV_C2C?this.unreadCount=t:this.unreadCount=this.unreadCount+t)}},{key:"updateLastMessage",value:function(e){this.lastMessage=Pa(e)}},{key:"updateGroupAtInfoList",value:function(e){if(!this._isNeedMergeGroupAtInfo(e)){var t,n=(y(t=e.groupAtType)||I(t)||M(t)||S()).slice(0);-1!==n.indexOf(b.CONV_AT_ME)&&-1!==n.indexOf(b.CONV_AT_ALL)&&(n=[b.CONV_AT_ALL_AT_ME]);var i={from:e.from,groupID:e.groupID,topicID:e.topicID,messageSequence:e.sequence,atTypeArray:n,__random:e.__random,__sequence:e.__sequence};this.groupAtInfoList.push(i)}}},{key:"_isNeedMergeGroupAtInfo",value:function(e){var t=e.groupID,n=e.sequence;if(!Rt({groupID:t}))return!1;var i=!1;return this.groupAtInfoList.forEach((function(t){t.messageSequence===n&&(t.atTypeArray.indexOf(b.CONV_AT_ME)>-1&&e.groupAtType.indexOf(b.CONV_AT_ALL)>-1&&(t.atTypeArray=[b.CONV_AT_ALL_AT_ME]),t.atTypeArray.indexOf(b.CONV_AT_ALL)>-1&&e.groupAtType.indexOf(b.CONV_AT_ME)>-1&&(t.atTypeArray=[b.CONV_AT_ALL_AT_ME],t.__random=e.__random,t.__sequence=e.__sequence),i=!0)})),i}},{key:"clearGroupAtInfoList",value:function(){this.groupAtInfoList.length=0}},{key:"reduceUnreadCount",value:function(){return this.unreadCount>=1&&(this.unreadCount-=1,!0)}},{key:"isLastMessageRevoked",value:function(e){var t=e.sequence,n=e.time;return this.type===b.CONV_C2C&&t===this.lastMessage.lastSequence&&n===this.lastMessage.lastTime||this.type===b.CONV_GROUP&&t===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}}]),e}(),xa=function(){function e(t){i(this,e),this._conversationModule=t,this._n="MessageRemindHandler",this._updateSequence=0}return o(e,[{key:"getC2CMessageRemindType",value:function(){var e=this,t="".concat(this._n,".getC2CMessageRemindType");return this._conversationModule.request({protocolName:Ki,updateSequence:this._updateSequence}).then((function(n){He.l("".concat(t," ok"));var i=n.data,r=i.updateSequence,o=i.muteFlagList;e._updateSequence=r,e._patchC2CMessageRemindType(o)})).catch((function(e){He.e("".concat(t," failed. error:"),e)}))}},{key:"_patchC2CMessageRemindType",value:function(e){var t=this,n=0,i="";pt(e)&&e.length>0&&e.forEach((function(e){var r=e.userID,o=e.muteFlag;0===o?i=b.MSG_REMIND_ACPT_AND_NOTE:1===o?i=b.MSG_REMIND_DISCARD:2===o&&(i=b.MSG_REMIND_ACPT_NOT_NOTE),!0===t._conversationModule.patchMessageRemindType({ID:r,isC2CConversation:!0,messageRemindType:i})&&(n+=1)})),He.l("".concat(this._n,"._patchC2CMessageRemindType count:").concat(n))}},{key:"set",value:function(e){return e.groupID?this._setGroupMessageRemindType(e):pt(e.userIDList)?this._setC2CMessageRemindType(e):void 0}},{key:"_setGroupMessageRemindType",value:function(e){var t=this,n="".concat(this._n,"._setGroupMessageRemindType"),i=e.groupID,r=e.messageRemindType,o="groupID:".concat(i," messageRemindType:").concat(r),a=new $o("setMessageRemindType");return a.setMessage(o),this._getModule(jn).modifyGroupMemberInfo({groupID:i,messageRemindType:r,userID:this._conversationModule.getMyUserID()}).then((function(){a.setNetworkType(t._conversationModule.getNetworkType()).end(),He.l("".concat(n," ok. ").concat(o));var i=t.onGroupMessageRemindTypeUpdated(e);return t._conversationModule.emitTotalUnreadMessageCountUpdate(),pa(i)})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"onGroupMessageRemindTypeUpdated",value:function(e){var t=e.groupID,n=e.messageRemindType,i=this._getModule(Bn).getLocalGroupProfile(t);if(i&&(i.selfInfo.messageRemindType=n),Lt(t)){var r=t,o=Wt(r),a=this._getModule(Kn).getLocalTopic(o,r);return a&&(a.updateSelfInfo({messageRemindType:n}),this._conversationModule.emitOuterEvent(k.TOPIC_UPDATED,{groupID:o,topic:a})),{topic:a}}return this._conversationModule.patchMessageRemindType({ID:t,isC2CConversation:!1,messageRemindType:n})&&this._emitConversationUpdate(),{group:i}}},{key:"_setC2CMessageRemindType",value:function(e){var t=this,n="".concat(this._n,"._setC2CMessageRemindType"),i=e.userIDList,r=e.messageRemindType,o=i.slice(0,30),a=0;r===b.MSG_REMIND_DISCARD?a=1:r===b.MSG_REMIND_ACPT_NOT_NOTE&&(a=2);var s="userIDList:".concat(o," messageRemindType:").concat(r),c=new $o("setMessageRemindType");return c.setMessage(s),this._conversationModule.request({protocolName:ji,requestData:{userIDList:o,muteFlag:a}}).then((function(e){c.setNetworkType(t._conversationModule.getNetworkType()).end();var i=e.data,a=i.updateSequence,s=i.errorList;t._updateSequence=a;var u=[],l=[];pt(s)&&s.forEach((function(e){u.push(e.userID),l.push({userID:e.userID,code:e.errorCode})}));var d=o.filter((function(e){return-1===u.indexOf(e)}));He.l("".concat(n," ok. successUserIDList:").concat(d," failureUserIDList:").concat(JSON.stringify(l)));var p=0;return d.forEach((function(e){t._conversationModule.patchMessageRemindType({ID:e,isC2CConversation:!0,messageRemindType:r})&&(p+=1)})),p>=1&&t._emitConversationUpdate(),o.length=u.length=0,t._conversationModule.emitTotalUnreadMessageCountUpdate(),ma({successUserIDList:d.map((function(e){return{userID:e}})),failureUserIDList:l})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"_getModule",value:function(e){return this._conversationModule.getModule(e)}},{key:"_emitConversationUpdate",value:function(){this._conversationModule.emitConversationUpdate(!0,!1)}},{key:"setUpdateSequence",value:function(e){this._updateSequence=e}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._updateSequence=0}}]),e}(),Ga=function(){function e(t){i(this,e),this._conversationModule=t,this._n="ConvGroupHandler",this._convGroupMap=new Map,this._startIndex=0,this._pagingStatus=sn.NOT_START}return o(e,[{key:"setConvCustomData",value:function(e){var t=this,n="".concat(this._n,".").concat("setConvCustomData"),i=e.conversationIDList,r=e.customData;He.l("".concat(n," options:"),e);var o=new $o("setConvCustomData");o.setMessage(JSON.stringify(e));var a={fromAccount:this._getMyUserID(),itemList:[]},s=[],c=[];return i.forEach((function(e){if(!t._hasLocalConversation(e))return t._onConversationNotFound(c,e),!0;if(!Ot(e)&&!Nt(e))return t._onConversationIDInvalid(c,e),!0;var n={operationType:2,contactItem:void 0,customMark:r};Ot(e)?n.contactItem={type:1,toAccount:e.replace(b.CONV_C2C,"")}:Nt(e)&&(n.contactItem={type:2,groupID:e.replace(b.CONV_GROUP,"")}),a.itemList.push(n)})),c.length===i.length?ma({successConversationIDList:s,failureConversationIDList:c}):this._conversationModule.request({protocolName:rr,requestData:a}).then((function(e){o.setNetworkType(t._conversationModule.getNetworkType()).end(),He.l("".concat(n," ok"));var i=e.data.resultItem;if(pt(i)){var a,u,l=!1;i.forEach((function(e){a=t._concatConversationID(e.contactItem),0===e.resultCode?(s.push(a),(u=t._getLocalConversation(a))&&u.customData!==r&&(u.customData=r,l=!0)):c.push({conversationID:a,code:e.resultCode,message:e.resultInfo})})),!0===l&&t._emitConversationUpdate()}return pa({successConversationIDList:s,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"markConversation",value:function(e){var t=this;if(!this._conversationModule.canIUse(H.CONV_MARK))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("markConversation"),i=e.conversationIDList,r=e.markType,o=e.enableMark;He.l("".concat(n," options:"),e);var a=new $o("markConversation");a.setMessage(JSON.stringify(e));var s=void 0,c=void 0,u=this._getFlagBit(r);!0===o?c=[u]:s=[u];var l={fromAccount:this._getMyUserID(),itemList:[]},d=[],p=[];return i.forEach((function(e){if(!t._hasLocalConversation(e))return t._onConversationNotFound(p,e),!0;if(!Ot(e)&&!Nt(e))return t._onConversationIDInvalid(p,e),!0;var n={operationType:1,contactItem:void 0,clearMark:s,setMark:c};Ot(e)?n.contactItem={type:1,toAccount:e.replace(b.CONV_C2C,"")}:Nt(e)&&(n.contactItem={type:2,groupID:e.replace(b.CONV_GROUP,"")}),l.itemList.push(n)})),p.length===i.length?ma({successConversationIDList:d,failureConversationIDList:p}):this._conversationModule.request({protocolName:or,requestData:l}).then((function(e){a.setNetworkType(t._conversationModule.getNetworkType()).end(),He.l("".concat(n," ok"));var i=e.data.resultItem;if(pt(i)){var s,c,u=!1;i.forEach((function(e){if(s=t._concatConversationID(e.contactItem),0===e.resultCode){if(d.push(s),c=t._getLocalConversation(s)){var n=c.markList.indexOf(r);!0===o?-1===n&&(c.markList.push(r),u=!0):-1!==n&&(c.markList.splice(n,1),u=!0)}}else p.push({conversationID:s,code:e.resultCode,message:e.resultInfo})})),!0===u&&t._emitConversationUpdate()}return pa({successConversationIDList:d,failureConversationIDList:p})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"getLocalConvGroupList",value:function(){var e=this;return He.l("".concat(this._n,".getLocalConvGroupList pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===sn.REJECTED?this.getRemoteConvGroupList().then((function(){return pa(_(e._convGroupMap.values()))})):ma(_(this._convGroupMap.values()))}},{key:"getRemoteConvGroupList",value:function(){var e=this,t="".concat(this._n,".getRemoteConvGroupList");return this._pagingStatus=sn.PENDING,this._conversationModule.request({protocolName:dr,requestData:{fromAccount:this._getMyUserID(),startIndex:this._startIndex,startTime:Fe()}}).then((function(n){var i,r,o=n.data,a=o.completeFlag,s=o.contactItem,c=o.nextStartIndex,u=void 0===c?0:c,l=o.groupItem;if(e._startIndex=u,He.l("".concat(t," completeFlag:").concat(a," nextStartIndex:").concat(u)),pt(l)&&l.forEach((function(t){var n=t.convGroupID,i=t.groupName;e._convGroupMap.set(n,i)})),pt(s)&&s.forEach((function(t){var n=t.standardMark,o=t.customData,a=t.convGroupIDList;if(i=e._concatConversationID(t),(r=e._getLocalConversation(i))&&(r.markList=Jt(n),r.customData=o||"",pt(a))){var s=[];a.forEach((function(t){e._convGroupMap.has(t)&&s.push(e._convGroupMap.get(t))})),r.conversationGroupList=[].concat(s),s.length=0}})),0===a)return e.getRemoteConvGroupList();1===a&&(e._pagingStatus=sn.RESOLVED,e._emitConversationUpdate(),e._emitConvGroupListUpdate())})).catch((function(n){e._pagingStatus=sn.REJECTED,He.w("".concat(t," failed. error:"),n)}))}},{key:"createConvGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(H.CONV_GROUP))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("createConvGroup");He.l("".concat(n," options:"),e);var i=new $o("createConvGroup");i.setMessage(JSON.stringify(e));var r=e.groupName,o=e.conversationIDList,a={fromAccount:this._getMyUserID(),itemList:[{groupName:r,contactItem:[]}]},s=[],c=[];return o.forEach((function(e){return t._hasLocalConversation(e)?Ot(e)||Nt(e)?void(Ot(e)?a.itemList[0].contactItem.push({type:1,toAccount:e.replace(b.CONV_C2C,"")}):Nt(e)&&a.itemList[0].contactItem.push({type:2,groupID:e.replace(b.CONV_GROUP,"")})):(t._onConversationIDInvalid(c,e),!0):(t._onConversationNotFound(c,e),!0)})),c.length===o.length?ma({successConversationIDList:s,failureConversationIDList:c}):this._conversationModule.request({protocolName:ar,requestData:a}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),He.l("".concat(n," ok"));var o=e.data.groupResultItem[0],a=o.groupItem,u=o.resultItem;if(dt(a)&&(t._convGroupMap.set(a.convGroupID,a.groupName),t._emitConvGroupListUpdate()),pt(u)){var l,d,p=!1;u.forEach((function(e){l=t._concatConversationID(e.contactItem),0===e.resultCode?(s.push(l),(d=t._getLocalConversation(l))&&-1===d.conversationGroupList.indexOf(r)&&(d.conversationGroupList.push(r),p=!0)):c.push({conversationID:l,code:e.resultCode,message:e.resultInfo})})),!0===p&&(t._emitConversationUpdate(),t._emitConvGroupListUpdate())}return pa({successConversationIDList:s,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"deleteConvGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(H.CONV_GROUP))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("deleteConvGroup");He.l("".concat(n," groupName:").concat(e));var i=new $o("deleteConvGroup");return i.setMessage(e),this._conversationModule.request({protocolName:sr,requestData:{fromAccount:this._getMyUserID(),groupName:[e]}}).then((function(r){i.setNetworkType(t._conversationModule.getNetworkType()).end(),He.l("".concat(n," ok"));var o=r.data.groupItem;if(pt(o)){var a=!1;o.forEach((function(e){t._convGroupMap.has(e.convGroupID)&&(t._convGroupMap.delete(e.convGroupID),a=!0)})),!0===a&&t._emitConvGroupListUpdate()}t._eraseFromConversationGroupList([e])})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"renameConvGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(H.CONV_GROUP))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("renameConvGroup");He.l("".concat(n," options:"),e);var i=new $o("renameConvGroup");i.setMessage(JSON.stringify(e));var r=e.oldName,o=e.newName;return this._conversationModule.request({protocolName:cr,requestData:{fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:1,oldName:r,newName:o}}}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),He.l("".concat(n," ok"));var a=e.data.updateGroupResult.convGroupID;t._convGroupMap.set(a,o),t._emitConvGroupListUpdate();var s,c,u=t._conversationModule.getLocalConversationList(),l=!1;u.forEach((function(e){s=e.conversationGroupList,-1!==(c=s.indexOf(r))&&(s.splice(c,1,o),l=!0)})),!0===l&&t._emitConversationUpdate()})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"addConvsToGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(H.CONV_GROUP))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("addConvsToGroup");He.l("".concat(n," options:"),e);var i=new $o("addConvsToGroup");i.setMessage(JSON.stringify(e));var r=e.conversationIDList,o=e.groupName,a={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:o,updateItem:[]}},s=[],c=[];return r.forEach((function(e){return t._hasLocalConversation(e)?Ot(e)||Nt(e)?void(Ot(e)?a.updateGroup.updateItem.push({operationType:1,contactItem:{type:1,toAccount:e.replace(b.CONV_C2C,"")}}):Nt(e)&&a.updateGroup.updateItem.push({operationType:1,contactItem:{type:2,groupID:e.replace(b.CONV_GROUP,"")}})):(t._onConversationIDInvalid(c,e),!0):(t._onConversationNotFound(c,e),!0)})),c.length===r.length?ma({successConversationIDList:s,failureConversationIDList:c}):this._conversationModule.request({protocolName:ur,requestData:a}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),He.l("".concat(n," ok"));var r=e.data.updateGroupResult.contactResultItem;if(pt(r)){var a,u,l=!1;r.forEach((function(e){a=t._concatConversationID(e.contactItem),0===e.resultCode?(u=t._getLocalConversation(a))&&-1===u.conversationGroupList.indexOf(o)&&(u.conversationGroupList.push(o),s.push(a),l=!0):c.push({conversationID:a,code:e.resultCode,message:e.resultInfo})})),!0===l&&(t._emitConversationUpdate(),t._emitConvInGroupUpdate(o))}return pa({successConversationIDList:s,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"deleteConvsFromGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(H.CONV_GROUP))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("deleteConvsFromGroup");He.l("".concat(n," options:"),e);var i=new $o("deleteConvsFromGroup");i.setMessage(JSON.stringify(e));var r=e.conversationIDList,o=e.groupName,a={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:o,updateItem:[]}},s=[],c=[];return r.forEach((function(e){return t._hasLocalConversation(e)?Ot(e)||Nt(e)?void(Ot(e)?a.updateGroup.updateItem.push({operationType:2,contactItem:{type:1,toAccount:e.replace(b.CONV_C2C,"")}}):Nt(e)&&a.updateGroup.updateItem.push({operationType:2,contactItem:{type:2,groupID:e.replace(b.CONV_GROUP,"")}})):(t._onConversationIDInvalid(c,e),!0):(t._onConversationNotFound(c,e),!0)})),c.length===r.length?ma({successConversationIDList:s,failureConversationIDList:c}):this._conversationModule.request({protocolName:lr,requestData:a}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),He.l("".concat(n," ok"));var r=e.data.updateGroupResult.contactResultItem;if(pt(r)){var a,u,l=!1;r.forEach((function(e){if(a=t._concatConversationID(e.contactItem),0===e.resultCode){if(u=t._getLocalConversation(a)){var n=u.conversationGroupList.indexOf(o);-1!==n&&(u.conversationGroupList.splice(n,1),s.push(a),l=!0)}}else c.push({conversationID:a,code:e.resultCode,message:e.resultInfo})})),!0===l&&(t._emitConversationUpdate(),t._emitConvInGroupUpdate(o))}return pa({successConversationIDList:s,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"onConvMarkUpdated",value:function(e){var t=this;if(!tn(e)){var n,i;He.d("".concat(this._n,".onConvMarkUpdated markItemList:"),e);var r=!1;e.forEach((function(e){var o=e.recentContactItem,a=e.optType,s=e.standardMark,c=e.customMark;if(n=t._concatConversationID(o),i=t._getLocalConversation(n))if(1===a){var u=Jt(s);!0!==function(e,t){if(e===t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}(i.markList,u)&&(i.markList=u,r=!0)}else 2===a&&i.customData!==c&&void 0!==c&&(i.customData=c,r=!0)})),!0===r&&this._emitConversationUpdate()}}},{key:"onConvGroupCreated",value:function(e){var t=this;He.d("".concat(this._n,".onConvGroupCreated resultList:"),e);var n=!1,i=!1;pt(e)&&(e.forEach((function(e){var r=e.msgGroupItem,o=r.groupID,a=r.groupName;t._convGroupMap.get(o)!==a&&(t._convGroupMap.set(o,a),i=!0);var s,c,u=e.msgRecentContactItem;pt(u)&&u.forEach((function(e){s=t._concatConversationID(e),(c=t._getLocalConversation(s))&&-1===c.conversationGroupList.indexOf(a)&&(c.conversationGroupList.push(a),n=!0)}))})),!0===n&&this._emitConversationUpdate(),!0===i&&this._emitConvGroupListUpdate())}},{key:"onConvGroupDeleted",value:function(e){var t=this;He.d("".concat(this._n,".onConvGroupDeleted groupItemList:"),e);var n=[];if(pt(e)){var i=!1;e.forEach((function(e){var r=e.groupID,o=e.groupName;t._convGroupMap.has(r)&&(t._convGroupMap.delete(r),i=!0,n.push(o))})),!0===i&&this._emitConvGroupListUpdate()}this._eraseFromConversationGroupList(n)}},{key:"_eraseFromConversationGroupList",value:function(e){tn(e)||(this._conversationModule.getLocalConversationList().forEach((function(t){t.conversationGroupList=t.conversationGroupList.filter((function(t){return!e.includes(t)}))})),this._emitConversationUpdate())}},{key:"onConvGroupNameUpdated",value:function(e){He.d("".concat(this._n,".onConvGroupNameUpdated options:"),e);var t=e.groupID,n=e.groupName,i=e.oldGroupName;if(this._convGroupMap.get(t)!==n){this._convGroupMap.set(t,n),this._emitConvGroupListUpdate();var r,o,a=this._conversationModule.getLocalConversationList(),s=!1;a.forEach((function(e){r=e.conversationGroupList,-1!==(o=r.indexOf(i))&&(r.splice(o,1,n),s=!0)})),!0===s&&this._emitConversationUpdate()}}},{key:"onConvInGroupUpdated",value:function(e){var t=this;He.d("".concat(this._n,".onConvInGroupUpdated options:"),e);var n=e.oldGroupName,i=e.recentContactUpdateGroupItem;if(pt(i)){var r,o,a,s=!1;i.forEach((function(e){var i=e.contactOptType,c=e.recentContactItem;r=t._concatConversationID(c),(o=t._getLocalConversation(r))&&(a=o.conversationGroupList.indexOf(n),1===i?-1===a&&(o.conversationGroupList.push(n),s=!0):2===i&&-1!==a&&(o.conversationGroupList.splice(a,1),s=!0))})),!0===s&&(this._emitConversationUpdate(),this._emitConvInGroupUpdate(n))}}},{key:"onConvAddedToOrDeletedFromGroup",value:function(e){var t=this;He.d("".concat(this._n,".onConvAddedToOrDeletedFromGroup options:"),e);var n=e.msgRecentContactItem,i=e.msgRecentContactUpdateContactItem,r=this._concatConversationID(n),o=this._getLocalConversation(r);if(o&&pt(i)){var a,s=!1;i.forEach((function(e){var n=e.groupOptType,i=e.recentContactGroupItem.groupName;a=o.conversationGroupList.indexOf(i),1===n?-1===a&&(o.conversationGroupList.push(i),s=!0):2===n&&-1!==a&&(o.conversationGroupList.splice(a,1),s=!0),!0===s&&t._emitConvInGroupUpdate(i)})),!0===s&&this._emitConversationUpdate()}}},{key:"onConvGroupListSynced",value:function(e){var t=this;pt(e)&&0!==e.length&&(He.l("".concat(this._n,".onConvGroupListSynced groupItemList:"),e),e.forEach((function(e){t._convGroupMap.set(e.convGroupID,e.groupName)})))}},{key:"getConvGroupListByID",value:function(e){var t=this;if(!tn(e)){var n=[];return e.forEach((function(e){t._convGroupMap.has(e)&&n.push(t._convGroupMap.get(e))})),n}}},{key:"_onConversationNotFound",value:function(e,t){e.push({conversationID:t,code:No.CONVERSATION_NOT_FOUND,message:this._conversationModule.getErrorMessage(No.CONVERSATION_NOT_FOUND)})}},{key:"_onConversationIDInvalid",value:function(e,t){e.push({conversationID:t,code:No.INVALID_CONVERSATION_ID,message:this._conversationModule.getErrorMessage(No.INVALID_CONVERSATION_ID)})}},{key:"_getFlagBit",value:function(e){for(var t=e.toString(2),n=t.length,i=n-1;i>=0;i--)if("1"===t[i])return n-i-1}},{key:"_concatConversationID",value:function(e){var t,n=e.type,i=e.to,r=e.groupID,o=e.userID;return 1===n?ht(o)?ht(i)||(t="".concat(b.CONV_C2C).concat(i)):t="".concat(b.CONV_C2C).concat(o):2===n&&(t="".concat(b.CONV_GROUP).concat(r)),t}},{key:"_getMyUserID",value:function(){return this._conversationModule.getMyUserID()}},{key:"_insertConversationGroup",value:function(e,t){var n=this._getLocalConversation(e);if(n){var i=n.conversationGroupList;-1===i.indexOf(t)&&i.push(t)}}},{key:"_getLocalConversation",value:function(e){return this._conversationModule.getLocalConversation(e)}},{key:"_hasLocalConversation",value:function(e){return this._conversationModule.hasLocalConversation(e)}},{key:"_emitConversationUpdate",value:function(){this._conversationModule.emitConversationUpdate(!0,!1)}},{key:"_emitConvGroupListUpdate",value:function(){this._conversationModule.emitOuterEvent(k.CONVERSATION_GROUP_LIST_UPDATED,_(this._convGroupMap.values()))}},{key:"_emitConvInGroupUpdate",value:function(e){var t={groupName:e,conversationList:[]},n=this._conversationModule.getLocalConversationList();t.conversationList=n.filter((function(t){return t.conversationGroupList.includes(e)})),this._conversationModule.emitOuterEvent(k.CONVERSATION_IN_GROUP_UPDATED,t)}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._convGroupMap.clear(),this._startIndex=0,this._pagingStatus=sn.NOT_START}}]),e}(),Fa=function(e){s(r,e);var n=m(r);function r(e){var t;return i(this,r),(t=n.call(this,e))._n="ConversationModule",Ca.mixin(f(t)),t._messageListHandler=new ya,t._messageRemindHandler=new xa(f(t)),t._convGroupHandler=new Ga(f(t)),t.singlyLinkedList=new La(100),t._pagingStatus=sn.NOT_START,t._pagingTimeStamp=0,t._pagingStartIndex=0,t._pagingPinnedTimeStamp=0,t._pagingPinnedStartIndex=0,t._pagingConvIDMap=new Map,t._convIDFromUnreadDBMap=new Map,t._conversationMap=new Map,t._tmpGroupList=[],t._tmpGroupAtTipsList=[],t._peerReadTimeMap=new Map,t._completedMap=new Map,t._roamingMessageKeyAndTimeMap=new Map,t._roamingMessageSequenceMap=new Map,t._remoteGroupReadSequenceMap=new Map,t._convTotalUnreadCount=0,t._initListeners(),t}return o(r,[{key:"_initListeners",value:function(){var e=this.getInnerEmitterInstance();e.on(Ia,this._initLocalConversationList,this),e.on(Ta,this._onProfileUpdated,this)}},{key:"onCheckTimer",value:function(e){e%60==0&&this._messageListHandler.traversal()}},{key:"_initLocalConversationList",value:function(){var e=this,t=new $o("_initLocalConversationList");He.l("".concat(this._n,".").concat("_initLocalConversationList"));var n="",i=this._getStorageConversationList(),r=this.isIntl();if(i){for(var o=i.length,a=0;a<o;a++){var s=i[a];if(s){if(s.conversationID==="".concat(b.CONV_C2C,"@TLS#ERROR")||s.conversationID==="".concat(b.CONV_C2C,"@TLS#NOT_FOUND"))continue;if(s.groupProfile){var c=s.groupProfile.type;if(At(c))continue}}this._conversationMap.set(i[a].conversationID,new Ua(i[a],r))}this.emitConversationUpdate(!0,!1),n="count:".concat(o)}else n="count:0";t.setNetworkType(this.getNetworkType()).setMessage(n).end(),this.getModule(qn)||this.triggerReady(),this.ready((function(){e._tmpGroupList.length>0&&(e.updateConversationGroupProfile(e._tmpGroupList),e._tmpGroupList.length=0)})),this.syncConversationList()}},{key:"onMessageSent",value:function(e){this._onSendOrReceiveMessage({conversationOptionsList:e.conversationOptionsList,isInstantMessage:!0})}},{key:"onNewMessage",value:function(e){this._onSendOrReceiveMessage(e)}},{key:"_onSendOrReceiveMessage",value:function(e){var t=this,n=e.conversationOptionsList,i=e.isInstantMessage,r=void 0===i||i,o=e.isUnreadC2CMessage,a=void 0!==o&&o,s=e.updateUnreadCount,c=void 0===s||s;this._isReady?0!==n.length&&(this._getC2CPeerReadTime(n),this._updateLocalConversationList({conversationOptionsList:n,isInstantMessage:r,isUnreadC2CMessage:a,isFromGetConversations:!1,updateUnreadCount:c}),r||(this._convIDFromUnreadDBMap=new Map([].concat(_(this._convIDFromUnreadDBMap),_(n.map((function(e){return[e.conversationID,1]}))))),this._diffAndDeleteConversation()),this._setStorageConversationList(),n.filter((function(e){return e.type===b.CONV_TOPIC})).length>0||this.emitConversationUpdate()):this.ready((function(){t._onSendOrReceiveMessage(e)}))}},{key:"updateConversationGroupProfile",value:function(e){var t=this;if(!pt(e)||0!==e.length)if(0!==this._conversationMap.size){var n=!1;e.forEach((function(e){var i="GROUP".concat(e.groupID);if(t._conversationMap.has(i)){n=!0;var r=t._conversationMap.get(i);r.groupProfile=JSON.parse(JSON.stringify(e)),r.lastMessage.lastSequence<e.nextMessageSeq&&(r.lastMessage.lastSequence=e.nextMessageSeq-1),r.subType||(r.subType=e.type)}})),n&&this.emitConversationUpdate(!0,!1)}else this._tmpGroupList=e}},{key:"_updateConversationUserProfile",value:function(e){var t=this;e.data.forEach((function(e){var n="C2C".concat(e.userID);t._conversationMap.has(n)&&(t._conversationMap.get(n).userProfile=e)})),this.emitConversationUpdate(!0,!1)}},{key:"onMessageRevoked",value:function(e){var t=this;if(0!==e.length){var n=null,i=!1,r=[];e.forEach((function(e){(n=t._conversationMap.get(e.conversationID))&&(n.type===b.CONV_TOPIC?r.push(e):(n.reduceUnreadCount()&&(i=!0),n.isLastMessageRevoked({sequence:e.sequence,time:e.time})&&(n.setLastMessageRevoked(!0),n.setLastMessageRevoker(e.revoker),i=!0)))})),this.getModule(Kn).onMessageRevoked(r),i&&(this.emitConversationUpdate(!0,!1),this.emitTotalUnreadMessageCountUpdate())}}},{key:"isLastMessageRevoked",value:function(e){var t=!1,n=e.conversationID,i=e.sequence,r=e.time,o=this._conversationMap.get(n);return o&&(t=o.type===b.CONV_TOPIC?this.getModule(Kn).isLastMessageRevoked({topicID:n.replace(b.CONV_GROUP,""),sequence:i}):o.isLastMessageRevoked({sequence:i,time:r})),He.l("".concat(this._n,".isLastMessageRevoked options:").concat(JSON.stringify(e)," ret:").concat(t)),t}},{key:"onMessageDeleted",value:function(e){var t=this;if(0!==e.length){var n=null;e.forEach((function(e){(n=t._messageListHandler.getLocalMessage(e.conversationID,e.ID))&&(n.isDeleted=!0),e!==n&&(e.isDeleted=!0)}));for(var i=e[0].conversationID,r=this._messageListHandler.getLocalMessageList(i),o={},a=r.length-1;a>=0;a--)if(!r[a].isDeleted){o=r[a];break}var s=this._conversationMap.get(i);if(s){var c=!1;s.lastMessage.lastSequence===o.sequence&&s.lastMessage.lastTime===o.time||(tn(o)&&(o=void 0),s.updateLastMessage(o),s.type!==b.CONV_TOPIC&&(c=!0),He.l("".concat(this._n,".onMessageDeleted. update conversationID:").concat(i," with lastMessage:"),s.lastMessage)),i.startsWith(b.CONV_C2C)&&this.updateUnreadCount(i),c&&this.emitConversationUpdate(!0,!1)}}}},{key:"onMessageModified",value:function(e){var t=e.conversationType,n=e.from,i=e.to,r=e.time,o=e.sequence,a=e.elements,s=e.cloudCustomData,c=e.messageVersion,u=this.getMyUserID(),l="".concat(t).concat(i);i===u&&t===b.CONV_C2C&&(l="".concat(t).concat(n));var d=this._messageListHandler.onMessageModified(l,e),p=d.isUpdated,h=d.message;!0===p&&this.emitOuterEvent(k.MESSAGE_MODIFIED,[h]);var f=this._isTopicConversation(l);if(He.l("".concat(this._n,".onMessageModified isUpdated:").concat(p," isTopicMessage:").concat(f," from:").concat(n," to:").concat(i)),f)this.getModule(Kn).onMessageModified(e);else{var g=this._conversationMap.get(l);if(g){var m=g.lastMessage;He.d("".concat(this._n.onMessageModified," lastMessage:"),JSON.stringify(m),"options:",JSON.stringify(e)),m&&m.lastTime===r&&m.lastSequence===o&&m.version!==c&&(m.type=a[0].type,m.payload=a[0].content,m.messageForShow=Yt(m.type,m.payload,this.isIntl()),m.cloudCustomData=s,m.version=c,this.emitConversationUpdate(!0,!1))}}return h}},{key:"onNewGroupAtTips",value:function(e){var n=this,i=e.dataList,r=null;i.forEach((function(e){e.groupAtTips?r=e.groupAtTips:e.elements?r=t(t({},e.elements),{},{sync:!0}):e.groupAtType&&(r=t(t({},e),{},{sync:!0})),r.__random=e.random,r.__sequence=e.clientSequence,n._tmpGroupAtTipsList.push(r)})),He.d("".concat(this._n,".onNewGroupAtTips isReady:").concat(this._isReady),this._tmpGroupAtTipsList),this._isReady&&this._handleGroupAtTipsList()}},{key:"_handleGroupAtTipsList",value:function(){var e=this;if(0!==this._tmpGroupAtTipsList.length){var t=!1;this._tmpGroupAtTipsList.forEach((function(n){var i=n.groupID,r=n.from,o=n.topicID,a=void 0===o?void 0:o,s=n.sync,c=void 0!==s&&s;if(r!==e.getMyUserID())if(ht(a)){var u=e._conversationMap.get("".concat(b.CONV_GROUP).concat(i));u&&(u.updateGroupAtInfoList(n),t=!0)}else{var l=e._conversationMap.get("".concat(b.CONV_GROUP).concat(a));if(l){l.updateGroupAtInfoList(n);var d=e.getModule(Kn),p=l.groupAtInfoList;d.onConversationProxy({topicID:a,groupAtInfoList:p})}tn(l)&&c&&(e.updateTopicConversation([{conversationID:"".concat(b.CONV_GROUP).concat(a),type:b.CONV_TOPIC}]),e._conversationMap.get("".concat(b.CONV_GROUP).concat(a)).updateGroupAtInfoList(n))}})),t&&this.emitConversationUpdate(!0,!1),this._tmpGroupAtTipsList.length=0}}},{key:"_getC2CPeerReadTime",value:function(e){var t=this,n=[];if(e.forEach((function(e){t._conversationMap.has(e.conversationID)||e.type!==b.CONV_C2C||n.push(e.conversationID.replace(b.CONV_C2C,""))})),n.length>0){He.d("".concat(this._n,"._getC2CPeerReadTime userIDList:").concat(n));var i=this.getModule(qn);i&&i.getRemotePeerReadTime(n)}}},{key:"_getStorageConversationList",value:function(){return this.getModule(Yn).getItem("conversationMap")}},{key:"_setStorageConversationList",value:function(){var e=this.getLocalConversationList().filter((function(e){return e.type===b.CONV_C2C||e.type===b.CONV_GROUP&&e.lastMessage.type!==b.MSG_GRP_TIP})).slice(0,20).map((function(e){return{conversationID:e.conversationID,type:e.type,subType:e.subType,lastMessage:e.lastMessage,groupProfile:e.groupProfile,userProfile:e.userProfile}}));this.getModule(Yn).setItem("conversationMap",e)}},{key:"emitConversationUpdate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalConversationList();if(t){var i=this.getModule(Bn);i&&i.updateGroupLastMessage(n)}e&&this.emitOuterEvent(k.CONVERSATION_LIST_UPDATED)}},{key:"getLocalConversationList",value:function(){return _(this._conversationMap.values()).filter((function(e){return e.type!==b.CONV_TOPIC}))}},{key:"getLocalConversation",value:function(e){return this._conversationMap.get(e)}},{key:"hasLocalConversation",value:function(e){return this._conversationMap.has(e)}},{key:"getLocalOldestMessage",value:function(e){return this._messageListHandler.getLocalOldestMessage(e)}},{key:"syncConversationList",value:function(){var e=this,t=new $o("syncConversationList");return this._pagingStatus===sn.NOT_START&&this._conversationMap.clear(),this._pagingGetConversationList().then((function(n){return e._pagingStatus=sn.RESOLVED,e._diffAndDeleteConversation(),e.emitConversationUpdate(!0,!1),e._setStorageConversationList(),e._handleC2CPeerReadTime(),e._patchConversationProperties(),t.setMessage(e._conversationMap.size).setNetworkType(e.getNetworkType()).end(),n})).catch((function(n){return e._pagingStatus=sn.REJECTED,t.setMessage(e._pagingTimeStamp),e.probeNetwork().then((function(e){var i=v(e,2),r=i[0],o=i[1];t.setError(n,r,o).end()})),va(n)}))}},{key:"_diffAndDeleteConversation",value:function(){var e=this;if(this._isSyncCompleted()){var t=[];this._conversationMap.forEach((function(n,i){!e._pagingConvIDMap.has(i)&&e._convIDFromUnreadDBMap.has(i)&&(e._conversationMap.delete(i),t.push(i))})),He.l("".concat(this._n,"._diffAndDeleteConversation list:").concat(t))}}},{key:"_patchConversationProperties",value:function(){var e=this,t=Date.now(),n=this.checkAndPatchRemark(),i=this._messageRemindHandler.getC2CMessageRemindType(),r=this.getModule(Bn).getGroupList();Promise.all([n,i,r]).then((function(){var n=Date.now()-t;He.l("".concat(e._n,"._patchConversationProperties ok. cost ").concat(n," ms")),e.emitConversationUpdate(!0,!1),e.emitTotalUnreadMessageCountUpdate()}))}},{key:"_pagingGetConversationList",value:function(){var e=this,t="".concat(this._n,"._pagingGetConversationList");return He.l("".concat(t," timeStamp:").concat(this._pagingTimeStamp," startIndex:").concat(this._pagingStartIndex)+" pinnedTimeStamp:".concat(this._pagingPinnedTimeStamp," pinnedStartIndex:").concat(this._pagingPinnedStartIndex)),this._pagingStatus=sn.PENDING,this.request({protocolName:Zi,requestData:{fromAccount:this.getMyUserID(),timeStamp:this._pagingTimeStamp,startIndex:this._pagingStartIndex,pinnedTimeStamp:this._pagingPinnedTimeStamp,pinnedStartIndex:this._pagingPinnedStartIndex,orderType:1}}).then((function(n){var i=n.data,r=i.completeFlag,o=i.conversations,a=void 0===o?[]:o,s=i.timeStamp,c=i.startIndex,u=i.pinnedTimeStamp,l=i.pinnedStartIndex,d=i.groupItem;if(He.l("".concat(t," ok. completeFlag:").concat(r," count:").concat(a.length," isReady:").concat(e._isReady)),e._convGroupHandler.onConvGroupListSynced(d),a.length>0){var p=e._getConversationOptions(a);e._pagingConvIDMap=new Map([].concat(_(e._pagingConvIDMap),_(p.map((function(e){return[e.conversationID,1]}))))),e._updateLocalConversationList({conversationOptionsList:p,isFromGetConversations:!0}),e.isLoggedIn()&&e.emitConversationUpdate()}if(!e._isReady){if(!e.isLoggedIn())return ma();e.triggerReady()}return e._pagingTimeStamp=s,e._pagingStartIndex=c,e._pagingPinnedTimeStamp=u,e._pagingPinnedStartIndex=l,1!==r?e._pagingGetConversationList():(e._handleGroupAtTipsList(),e._convGroupHandler.getRemoteConvGroupList(),ma())})).catch((function(n){throw e.isLoggedIn()&&(e._isReady||(He.w("".concat(t," failed. error:"),n),e.triggerReady())),n}))}},{key:"_updateLocalConversationList",value:function(e){var t,n=e.isFromGetConversations,i=e.isInstantMessage,r=Date.now();t=this._getTmpConversationListMapping(e),this._conversationMap=new Map(this._sortConversationList([].concat(_(t.toBeUpdatedConversationList),_(this._conversationMap)))),n||(this._updateUserOrGroupProfile(t.newConversationList),i&&this.emitTotalUnreadMessageCountUpdate()),He.d("".concat(this._n,"._updateLocalConversationList cost ").concat(Date.now()-r," ms"))}},{key:"_getTmpConversationListMapping",value:function(e){for(var t=e.conversationOptionsList,n=e.isFromGetConversations,i=e.isInstantMessage,r=e.isUnreadC2CMessage,o=void 0!==r&&r,a=e.updateUnreadCount,s=[],c=[],u=this.getModule(Bn),l=this.getModule(Hn),d=this.isIntl(),p=0,h=t.length;p<h;p++){var f=new Ua(t[p],d),g=f.conversationID;if(g!=="".concat(b.CONV_C2C,"@TLS#ERROR")&&g!=="".concat(b.CONV_C2C,"@TLS#NOT_FOUND"))if(this._conversationMap.has(g)){var m=this._conversationMap.get(g),v=["unreadCount","allowType","adminForbidType","payload","isPinned"];!1===i&&v.push("lastMessage");var _=t[p].lastMessage,y=!ht(_);y||t[p].type===b.CONV_TOPIC||this._onLastMessageNotExist(t[p]),ht(i)&&y&&null===m.lastMessage.payload&&(m.lastMessage.payload=_.payload),tn(m.lastMessage.revoker)||(m.lastMessage.revoker=null),yt(m,f,v,[null,void 0,"",0,NaN]),!0===a&&m.updateUnreadCount({nextUnreadCount:f.unreadCount,isFromGetConversations:n,isUnreadC2CMessage:o}),i&&y&&(_.payload&&(m.lastMessage.payload=_.payload),m.type===b.CONV_GROUP&&(m.lastMessage.nameCard=_.nameCard,m.lastMessage.nick=_.nick)),y&&m.lastMessage.cloudCustomData!==_.cloudCustomData&&(m.lastMessage.cloudCustomData=_.cloudCustomData||""),this._conversationMap.delete(g),s.push([g,m])}else{if(f.type===b.CONV_GROUP&&u){var I=f.groupProfile.groupID,M=u.getLocalGroupProfile(I);M&&(f.groupProfile=M,!0===a&&f.updateUnreadCount({nextUnreadCount:0}))}else if(f.type===b.CONV_C2C){var T=g.replace(b.CONV_C2C,"");l&&l.isMyFriend(T)&&(f.remark=l.getFriendRemark(T))}c.push(f),s.push([g,f])}}var C=this.getModule(Kn);return s.forEach((function(e){if(e[1].type===b.CONV_TOPIC){var t=e[1],n=t.conversationID,i=t.unreadCount,r=t.groupAtInfoList;C.onConversationProxy({topicID:n.replace(b.CONV_GROUP,""),unreadCount:i,groupAtInfoList:tn(r)?void 0:r})}})),{toBeUpdatedConversationList:s,newConversationList:c}}},{key:"_onLastMessageNotExist",value:function(e){new $o("lastMessageNotExist").setMessage("".concat(JSON.stringify(e))).setNetworkType(this.getNetworkType()).end()}},{key:"_sortConversationList",value:function(e){var t=[],n=[],i=[],r=[];return e.forEach((function(e){!0===e[1].isPinned?tn(e[1].lastMessage.lastTime)?n.push(e):t.push(e):tn(e[1].lastMessage.lastTime)?r.push(e):i.push(e)})),t.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})).concat(n).concat(i.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime}))).concat(r)}},{key:"_sortConversationListAndEmitEvent",value:function(){this._conversationMap=new Map(this._sortConversationList(_(this._conversationMap))),this.emitConversationUpdate(!0,!1)}},{key:"_updateUserOrGroupProfile",value:function(e){var t=this;if(0!==e.length){var n=[],i=[],r=this.getModule(Vn),o=this.getModule(Bn);e.forEach((function(e){if(e.type===b.CONV_C2C)n.push(e.toAccount);else if(e.type===b.CONV_GROUP){var t=e.toAccount;o.hasLocalGroup(t)?e.groupProfile=o.getLocalGroupProfile(t):i.push(t)}})),He.l("".concat(this._n,"._updateUserOrGroupProfile c2cUserIDList:").concat(n," groupIDList:").concat(i)),n.length>0&&r.getUserProfile({userIDList:n}).then((function(e){var n=e.data;pt(n)?n.forEach((function(e){t._doUpdateUserProfile("C2C".concat(e.userID),e)})):t._doUpdateUserProfile("C2C".concat(n.userID),n)})),i.length>0&&o.getGroupProfileAdvance({groupIDList:i,responseFilter:{groupBaseInfoFilter:["Type","Name","FaceUrl"]}}).then((function(e){e.data.successGroupList.forEach((function(e){var n="GROUP".concat(e.groupID);if(t._conversationMap.has(n)){var i=t._conversationMap.get(n);yt(i.groupProfile,e,[],[null,void 0,"",0,NaN]),!i.subType&&e.type&&(i.subType=e.type)}}))}))}}},{key:"_doUpdateUserProfile",value:function(e,t){this.hasLocalConversation(e)&&(this.getLocalConversation(e).userProfile=t)}},{key:"_getConversationOptions",value:function(e){var n=this,i=[],r=e.filter((function(e){var t=e.type,n=e.userID;return 1===t&&"@TLS#NOT_FOUND"!==n&&"@TLS#ERROR"!==n||2===t})),o=this.getMyUserID(),a=r.map((function(e){if(ht(e.lastMsg)&&(e.lastMsg={elements:[]}),1===e.type){var r={userID:e.userID,nick:e.peerNick,avatar:e.peerAvatar};return i.push(r),{conversationID:"C2C".concat(e.userID),type:"C2C",lastMessage:{lastTime:e.time,lastSequence:e.sequence,fromAccount:e.lastC2CMsgFromAccount,messageForShow:e.messageShow,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:null,payload:e.lastMsg.elements[0]?n._amendLayersOverLimitProperty(e.lastMsg.elements[0].content):null,cloudCustomData:e.lastMsg.cloudCustomData||"",isRevoked:8===e.lastMessageFlag,onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:e.lastC2CMsgFromAccount===o&&e.time<=e.c2cPeerReadTime,revoker:e.lastMsg.revokerInfo?e.lastMsg.revokerInfo.revoker:null},userProfile:new Aa(r),peerReadTime:e.c2cPeerReadTime,isPinned:1===e.isPinned,messageRemindType:"",customData:e.customMark||"",markList:Jt(e.standardMark),conversationGroupList:n._convGroupHandler.getConvGroupListByID(e.contactGroupId)}}return{conversationID:"GROUP".concat(e.groupID),type:"GROUP",lastMessage:t(t({lastTime:e.time,lastSequence:e.sequence,fromAccount:e.msgGroupFromAccount,messageForShow:e.messageShow},n._patchTypeAndPayload(e)),{},{cloudCustomData:e.lastMsg.cloudCustomData||"",isRevoked:2===e.lastMessageFlag,onlineOnlyFlag:!1,nick:e.senderNick||"",nameCard:e.senderNameCard||"",revoker:e.lastMsg.revokerInfo?e.lastMsg.revokerInfo.revoker:null}),groupProfile:new Na({groupID:e.groupID,name:e.groupNick,avatar:e.groupImage}),unreadCount:e.unreadCount,peerReadTime:0,isPinned:1===e.isPinned,messageRemindType:"",version:0,customData:e.customMark||"",markList:Jt(e.standardMark),conversationGroupList:n._convGroupHandler.getConvGroupListByID(e.contactGroupId)}}));return i.length>0&&this.getModule(Vn).onConversationsProfileUpdated(i),a}},{key:"_patchTypeAndPayload",value:function(e){var n=e.lastMsg,i=n.event,r=void 0===i?void 0:i,o=n.elements,a=void 0===o?[]:o,s=n.groupTips,c=void 0===s?{}:s;if(!ht(r)&&!tn(c)){var u=new da(c);u.setElement({type:b.MSG_GRP_TIP,content:t(t({},c.elements),{},{groupProfile:c.groupProfile})});var l=JSON.parse(JSON.stringify(u.payload));return u=null,{type:b.MSG_GRP_TIP,payload:l}}return{type:a[0]?a[0].type:null,payload:a[0]?this._amendLayersOverLimitProperty(a[0].content):null}}},{key:"_amendLayersOverLimitProperty",value:function(e){var t=e.layersOverLimit;return 0===t?e.layersOverLimit=!1:1===t&&(e.layersOverLimit=!0),e}},{key:"getLocalMessageList",value:function(e){return this._messageListHandler.getLocalMessageList(e)}},{key:"deleteLocalMessage",value:function(e){e instanceof da&&this._messageListHandler.remove(e)}},{key:"onConversationDeleted",value:function(e){if(pt(e)){var t=e.map((function(e){var t=e.type,n=e.userID,i=e.groupID;return 1===t?"".concat(b.CONV_C2C).concat(n):2===t?"".concat(b.CONV_GROUP).concat(i):void 0}));He.l("".concat(this._n,".onConversationDeleted conversationIDList:").concat(t)),this.deleteLocalConversationList(t)}}},{key:"onConversationPinned",value:function(e){var t=this;if(pt(e)){var n=!1;e.forEach((function(e){var i,r=e.type,o=e.userID,a=e.groupID;1===r?i=t.getLocalConversation("".concat(b.CONV_C2C).concat(o)):2===r&&(i=t.getLocalConversation("".concat(b.CONV_GROUP).concat(a))),i&&(He.l("".concat(t._n,".onConversationPinned conversationID:").concat(i.conversationID," isPinned:").concat(i.isPinned)),i.isPinned||(i.isPinned=!0,n=!0))})),n&&this._sortConversationListAndEmitEvent()}}},{key:"onConversationUnpinned",value:function(e){var t=this;if(pt(e)){var n=!1;e.forEach((function(e){var i,r=e.type,o=e.userID,a=e.groupID;1===r?i=t.getLocalConversation("".concat(b.CONV_C2C).concat(o)):2===r&&(i=t.getLocalConversation("".concat(b.CONV_GROUP).concat(a))),i&&(He.l("".concat(t._n,".onConversationUnpinned conversationID:").concat(i.conversationID," isPinned:").concat(i.isPinned)),i.isPinned&&(i.isPinned=!1,n=!0))})),n&&this._sortConversationListAndEmitEvent()}}},{key:"getMessageList",value:function(e){var t=this,n=e.conversationID,i=e.nextReqMessageID,r=e.count,o="".concat(this._n,".getMessageList"),a=this.getLocalConversation(n),s="";if(a&&a.groupProfile&&(s=a.groupProfile.type),At(s))return He.l("".concat(o," not available in avchatroom. conversationID:").concat(n)),ma({messageList:[],nextReqMessageID:"",isCompleted:!0});(ht(r)||r>15)&&(r=15),!i&&this._isNotInCommunity(n)&&(this._messageListHandler.removeByConversationID(n),this._completedMap.delete(n),this._roamingMessageSequenceMap.delete(n));var c=this._computeRemainingCount({conversationID:n,nextReqMessageID:i}),u=this._completedMap.has(n);if(He.l("".concat(o," conversationID:").concat(n," nextReqMessageID:").concat(i)+" remainingCount:".concat(c," count:").concat(r," isCompleted:").concat(u)),this._needGetHistory({conversationID:n,remainingCount:c,count:r}))return this.getHistoryMessages({conversationID:n,nextReqMessageID:i,count:20}).then((function(e){var i=e.nextReqID,r=e.storedMessageList,a=t._completedMap.has(n),s=r;c>0&&(s=t._messageListHandler.getLocalMessageList(n).slice(0,r.length+c));var u={nextReqMessageID:a?"":i,messageList:s,isCompleted:a};return He.l("".concat(o," ret.nextReqMessageID:").concat(u.nextReqMessageID," ret.isCompleted:").concat(u.isCompleted," ret.length:").concat(s.length)),pa(u)}));this.modifyMessageList(n);var l=this._getMessageListFromMemory({conversationID:n,nextReqMessageID:i,count:r});return ma(l)}},{key:"_getMessageListFromMemory",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,i=e.count,r="".concat(this._n,"._getMessageListFromMemory"),o=this._messageListHandler.getLocalMessageList(t),a=o.length,s=0,c={isCompleted:!1,nextReqMessageID:"",messageList:[]};return n?(s=o.findIndex((function(e){return e.ID===n})))>i?(c.messageList=o.slice(s-i,s),c.nextReqMessageID=o[s-i].ID):(c.messageList=o.slice(0,s),c.isCompleted=!0):a>i?(s=a-i,c.messageList=o.slice(s,a),c.nextReqMessageID=o[s].ID):(c.messageList=o.slice(0,a),c.isCompleted=!0),He.l("".concat(r," conversationID:").concat(t)+" ret.nextReqMessageID:".concat(c.nextReqMessageID," ret.isCompleted:").concat(c.isCompleted," ret.length:").concat(c.messageList.length)),c}},{key:"getMessageListHopping",value:function(e){var t=e.conversationID,n=e.sequence,i=e.time,r=e.count,o=e.direction,a=void 0===o?0:o;if((ht(r)||r>15)&&(r=15),t.startsWith(b.CONV_C2C)){var s=this.getModule(qn),c=t.replace(b.CONV_C2C,"");return s.getRoamingMessagesHopping({peerAccount:c,time:i,count:r,direction:a})}if(t.startsWith(b.CONV_GROUP)){var u=this.getModule(Bn),l=t.replace(b.CONV_GROUP,"");return u.getRoamingMessagesHopping({groupID:l,sequence:n,count:r,direction:a})}}},{key:"_computeRemainingCount",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,i=this._messageListHandler.getLocalMessageList(t),r=i.length;if(!n)return r;var o=0;return Ot(t)?o=i.findIndex((function(e){return e.ID===n})):Nt(t)&&(o=-1!==n.indexOf("-")?i.findIndex((function(e){return e.ID===n})):i.findIndex((function(e){return e.sequence===n}))),-1===o&&(o=0),o}},{key:"_getMessageListSize",value:function(e){return this._messageListHandler.getLocalMessageList(e).length}},{key:"_needGetHistory",value:function(e){var t=e.conversationID,n=e.remainingCount,i=e.count,r=this.getLocalConversation(t),o="";return r&&r.groupProfile&&(o=r.groupProfile.type),!Pt(t)&&!At(o)&&!(Nt(t)&&this._isPagingGetGroupListCompleted()&&this._getLocalGroupCount()<=4e3&&!this._hasLocalGroup(t)&&!this._isTopicConversation(t))&&n<=i&&!this._completedMap.has(t)}},{key:"_isTopicConversation",value:function(e){var t=e.replace(b.CONV_GROUP,"");return Lt(t)}},{key:"getHistoryMessages",value:function(e){var t=e.conversationID,n=e.count;if(t===b.CONV_SYSTEM)return ma();var i=15;n>20&&(i=20);var r=null;if(Ot(t)){var o=this._roamingMessageKeyAndTimeMap.has(t);return(r=this.getModule(qn))?r.getRoamingMessage({conversationID:t,peerAccount:t.replace(b.CONV_C2C,""),count:i,lastMessageTime:o?this._roamingMessageKeyAndTimeMap.get(t).lastMessageTime:0,messageKey:o?this._roamingMessageKeyAndTimeMap.get(t).messageKey:""}):va({code:No.CANNOT_FIND_MODULE})}if(Nt(t)){if(!(r=this.getModule(Bn)))return va({code:No.CANNOT_FIND_MODULE});var a=null;this._conversationMap.has(t)&&(a=this._conversationMap.get(t).lastMessage);var s=0;a&&(s=a.lastSequence);var c=this._roamingMessageSequenceMap.get(t);return r.getRoamingMessage({conversationID:t,groupID:t.replace(b.CONV_GROUP,""),count:i,sequence:c||s})}return ma()}},{key:"patchConversationLastMessage",value:function(e){var t=this.getLocalConversation(e);if(t){var n=t.lastMessage,i=n.messageForShow,r=n.payload;if(tn(i)||tn(r)){var o=this._messageListHandler.getLocalMessageList(e);if(0===o.length)return;var a=o[o.length-1];He.l("".concat(this._n,".patchConversationLastMessage conversationID:").concat(e," payload:"),a.payload),t.updateLastMessage(a)}}}},{key:"onRoamingMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=n.startsWith(b.CONV_C2C)?b.CONV_C2C:b.CONV_GROUP,o=null,a=[],s=[],c=0,u=e.length,l=null,d=r===b.CONV_GROUP,p=this.getModule(Xn),h=this.getFileDownloadProxy(),f=function(){c=d?e.length-1:0,u=d?0:e.length},g=function(){d?--c:++c},m=function(){return d?c>=u:c<u};for(f();m();g())if(d&&1===e[c].sequence&&i&&this.setCompleted(n),1!==e[c].isPlaceMessage)if((o=new da(e[c])).to=e[c].to,r!==b.CONV_GROUP||ht(e[c].topicID)||(o.to=e[c].topicID),o.isSystemMessage=!!e[c].isSystemMessage,o.conversationType=r,4===e[c].event?l={type:b.MSG_GRP_TIP,content:t(t({},e[c].elements),{},{groupProfile:e[c].groupProfile})}:(e[c].elements=p.parseElements(e[c].elements,e[c].from),l=e[c].elements),d||o.setNickAndAvatar({nick:e[c].nick,avatar:e[c].avatar}),tn(l)){var v=new $o("emptyMessageBody");v.setMessage("from:".concat(o.from," to:").concat(o.to," sequence:").concat(o.sequence," event:").concat(e[c].event)),v.setNetworkType(this.getNetworkType()).setLevel("warning").end()}else o.setElement(l,h),o.reInitialize(this.getMyUserID()),a.push(o);return f=g=m=null,i?(this._messageListHandler.unshift(a,s),a=null,s):(s=null,a)}},{key:"findMessage",value:function(e){return this._messageListHandler.findMessage(e)}},{key:"_isNotInCommunity",value:function(e){var t=!1;if(e.startsWith(b.CONV_GROUP)&&this._isTopicConversation(e)){var n=Wt(e.replace(b.CONV_GROUP,""));this.getModule(Bn).hasLocalGroup(n)||(t=!0)}return t}},{key:"deleteTopicRoamingMessageInfo",value:function(e){var t=this;Rt({groupID:e})&&this._messageListHandler.getTopicConversationIDList(e).forEach((function(e){t._messageListHandler.removeByConversationID(e),t._completedMap.delete(e),t._roamingMessageSequenceMap.delete(e)}))}},{key:"deleteGroupRomaingMessageInfo",value:function(e){var t="".concat(b.CONV_GROUP).concat(e);this._messageListHandler.removeByConversationID(t),this._completedMap.delete(t),this._roamingMessageSequenceMap.delete(t)}},{key:"setMessageRead",value:function(e){var t=e.conversationID,n=this.getLocalConversation(t);if(He.l("".concat(this._n,".setMessageRead conversationID:").concat(t," unreadCount:").concat(n?n.unreadCount:0)),!n)return ma();if(n.type!==b.CONV_GROUP&&n.type!==b.CONV_TOPIC||tn(n.groupAtInfoList)||this.deleteGroupAtTips(t),0===n.unreadCount)return ma();if(n.type===b.CONV_GROUP&&!this._hasLocalGroup(t))return 0!==n.unreadCount&&(n.unreadCount=0,this.emitConversationUpdate(!0,!1)),ma();var i=this._messageListHandler.getLocalLastMessage(t),r=n.lastMessage.lastTime;i&&r<i.time&&(r=i.time);var o=n.lastMessage.lastSequence;if(i&&o<i.sequence&&(o=i.sequence),n.type===b.CONV_TOPIC&&ht(i)){var a=this.getModule(Kn),s=t.replace(b.CONV_GROUP,""),c=Wt(s),u=a.getLocalTopic(c,s);u&&(o=u.nextMessageSeq-1)}var l=null;switch(n.type){case b.CONV_C2C:return(l=this.getModule(qn))?l.setMessageRead({conversationID:t,lastMessageTime:r}):va({code:No.CANNOT_FIND_MODULE});case b.CONV_GROUP:case b.CONV_TOPIC:return(l=this.getModule(Bn))?l.setMessageRead({conversationID:t,lastMessageSeq:o}):va({code:No.CANNOT_FIND_MODULE});case b.CONV_SYSTEM:return n.unreadCount=0,this.emitConversationUpdate(!0,!1),ma();default:return ma()}}},{key:"setAllMessageRead",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="setAllMessageRead",i="".concat(this._n,".").concat(n);t.scope||(t.scope=b.READ_ALL_MSG),He.l("".concat(i," options:"),t);var r=this._createSetAllMessageReadPack(t);if(0===r.readAllC2CMessage&&0===r.groupMessageReadInfoList.length)return ma();var o=new $o(n);return this.request({protocolName:br,requestData:r}).then((function(n){var i=n.data,r=e._handleAllMessageRead(i);return o.setMessage("scope:".concat(t.scope," failureGroups:").concat(JSON.stringify(r))).setNetworkType(e.getNetworkType()).end(),ma()})).catch((function(t){return e.probeNetwork().then((function(e){var n=v(e,2),i=n[0],r=n[1];o.setError(t,i,r).end()})),He.w("".concat(i," failed. error:"),t),va({code:t&&t.code?t.code:No.MESSAGE_UNREAD_ALL_FAIL,message:t&&t.message?t.message:void 0})}))}},{key:"setConversationCustomData",value:function(e){return this._convGroupHandler.setConvCustomData(e)}},{key:"markConversation",value:function(e){return this._convGroupHandler.markConversation(e)}},{key:"getConversationGroupList",value:function(){return this._convGroupHandler.getLocalConvGroupList()}},{key:"createConversationGroup",value:function(e){return this._convGroupHandler.createConvGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._convGroupHandler.deleteConvGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._convGroupHandler.renameConvGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._convGroupHandler.addConvsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._convGroupHandler.deleteConvsFromGroup(e)}},{key:"onConversationMarkUpdated",value:function(e){this._convGroupHandler.onConvMarkUpdated(e)}},{key:"onConversationGroupCreated",value:function(e){this._convGroupHandler.onConvGroupCreated(e)}},{key:"onConversationGroupDeleted",value:function(e){this._convGroupHandler.onConvGroupDeleted(e)}},{key:"onConversationGroupNameUpdated",value:function(e){this._convGroupHandler.onConvGroupNameUpdated(e)}},{key:"onConversationInGroupUpdated",value:function(e){this._convGroupHandler.onConvInGroupUpdated(e)}},{key:"onConversationAddedToOrDeletedFromGroup",value:function(e){this._convGroupHandler.onConvAddedToOrDeletedFromGroup(e)}},{key:"_getConversationLastMessageSequence",value:function(e){var t=this._messageListHandler.getLocalLastMessage(e.conversationID),n=e.lastMessage.lastSequence;return t&&n<t.sequence&&(n=t.sequence),n}},{key:"_getConversationLastMessageTime",value:function(e){var t=this._messageListHandler.getLocalLastMessage(e.conversationID),n=e.lastMessage.lastTime;return t&&n<t.time&&(n=t.time),n}},{key:"_createSetAllMessageReadPack",value:function(e){var t,n={readAllC2CMessage:0,groupMessageReadInfoList:[]},i=e.scope,r=E(this._conversationMap);try{for(r.s();!(t=r.n()).done;){var o=v(t.value,2)[1];if(o.unreadCount>0)if(o.type===b.CONV_C2C&&0===n.readAllC2CMessage){if(i===b.READ_ALL_MSG)n.readAllC2CMessage=1;else if(i===b.READ_ALL_C2C_MSG){n.readAllC2CMessage=1;break}}else if(o.type===b.CONV_GROUP&&(i===b.READ_ALL_GROUP_MSG||i===b.READ_ALL_MSG)){var a=this._getConversationLastMessageSequence(o);n.groupMessageReadInfoList.push({groupID:o.groupProfile.groupID,messageSequence:a})}}}catch(s){r.e(s)}finally{r.f()}return n}},{key:"onPushedAllMessageRead",value:function(e){this._handleAllMessageRead(e)}},{key:"_handleAllMessageRead",value:function(e){var t=e.groupMessageReadInfoList,n=e.readAllC2CMessage,i=this._parseGroupReadInfo(t);return this._updateAllConversationUnreadCount({readAllC2CMessage:n})>=1&&(this.emitConversationUpdate(!0,!1),this.emitTotalUnreadMessageCountUpdate()),i}},{key:"_parseGroupReadInfo",value:function(e){var t=[];if(e&&e.length)for(var n=0,i=e.length;n<i;n++){var r=e[n],o=r.groupID,a=r.sequence,s=r.retCode,c=r.lastMessageSeq;ht(s)?this._remoteGroupReadSequenceMap.set(o,c):(this._remoteGroupReadSequenceMap.set(o,a),0!==s&&t.push("".concat(o,"-").concat(a,"-").concat(s)))}return t}},{key:"_updateAllConversationUnreadCount",value:function(e){var t,n=e.readAllC2CMessage,i=0,r=E(this._conversationMap);try{for(r.s();!(t=r.n()).done;){var o=v(t.value,2),a=o[0],s=o[1];if(s.unreadCount>=1){if(1===n&&s.type===b.CONV_C2C){var c=this._getConversationLastMessageTime(s);this.updateIsReadAfterReadReport({conversationID:a,lastMessageTime:c})}else if(s.type===b.CONV_GROUP){var u=a.replace(b.CONV_GROUP,"");if(this._remoteGroupReadSequenceMap.has(u)){var l=this._remoteGroupReadSequenceMap.get(u),d=this._getConversationLastMessageSequence(s);this.updateIsReadAfterReadReport({conversationID:a,remoteReadSequence:l}),d>=l&&this._remoteGroupReadSequenceMap.delete(u)}}this.updateUnreadCount(a,!1)&&(i+=1)}}}catch(p){r.e(p)}finally{r.f()}return i}},{key:"isRemoteRead",value:function(e){var t=e.conversationID,n=e.sequence,i=t.replace(b.CONV_GROUP,""),r=!1;if(this._remoteGroupReadSequenceMap.has(i)){var o=this._remoteGroupReadSequenceMap.get(i);n<=o&&(r=!0,He.l("".concat(this._n,".isRemoteRead conversationID:").concat(t," messageSequence:").concat(n," remoteReadSequence:").concat(o))),n>=o+10&&this._remoteGroupReadSequenceMap.delete(i)}return r}},{key:"updateIsReadAfterReadReport",value:function(e){var t=e.conversationID,n=e.lastMessageSeq,i=e.lastMessageTime,r=this._messageListHandler.getLocalMessageList(t);if(0!==r.length)for(var o,a=r.length-1;a>=0;a--)if(o=r[a],!(i&&o.time>i||n&&o.sequence>n)){if("in"===o.flow&&o.isRead)break;o.setIsRead(!0)}}},{key:"updateUnreadCount",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!1,i=this.getLocalConversation(e),r=this._messageListHandler.getLocalMessageList(e);if(i){var o=i.unreadCount,a=r.filter((function(e){return!e.isRead&&!e._onlineOnlyFlag&&!e.isDeleted})).length;if(o!==a&&(i.unreadCount=a,n=!0,He.l("".concat(this._n,".updateUnreadCount from ").concat(o," to ").concat(a,", conversationID:").concat(e)),!0===t&&(this.emitConversationUpdate(!0,!1),this.emitTotalUnreadMessageCountUpdate())),n&&i.type===b.CONV_TOPIC){var s=i.unreadCount,c=this.getModule(Kn),u=e.replace(b.CONV_GROUP,"");c.onConversationProxy({topicID:u,unreadCount:s})}return n}}},{key:"clearGroupAtInfoList",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalConversation(e);if(n&&n.groupAtInfoList.length>0){if(n.clearGroupAtInfoList(),He.l("".concat(this._n,".clearGroupAtInfoList conversationID:").concat(e)),n.type===b.CONV_TOPIC){var i=n.groupAtInfoList,r=this.getModule(Kn),o=e.replace(b.CONV_GROUP,"");r.onConversationProxy({topicID:o,groupAtInfoList:i})}!0===t&&this.emitConversationUpdate(!0,!1)}}},{key:"updateReadReceiptInfo",value:function(e){var t=this,n=e.userID,i=void 0===n?void 0:n,r=e.groupID,o=void 0===r?void 0:r,a=e.readReceiptList;if(!tn(a)){var s=[];if(ht(i)){if(!ht(o)){var c="".concat(b.CONV_GROUP).concat(o);a.forEach((function(e){var n=e.tinyID,i=e.clientTime,r=e.random,a=e.readCount,u=e.unreadCount,l="".concat(n,"-").concat(i,"-").concat(r),d=t._messageListHandler.getLocalMessage(c,l),p={groupID:o,messageID:l,readCount:0,unreadCount:0};d&&(ct(a)&&(d.readReceiptInfo.readCount=a,p.readCount=a),ct(u)&&(d.readReceiptInfo.unreadCount=u,p.unreadCount=u),s.push(p))}))}}else{var u="".concat(b.CONV_C2C).concat(i);a.forEach((function(e){var n=e.tinyID,r=e.clientTime,o=e.random,a="".concat(n,"-").concat(r,"-").concat(o),c=t._messageListHandler.getLocalMessage(u,a);if(c){c.readReceiptInfo.isPeerRead=!0;var l={userID:i,messageID:a,isPeerRead:!0};s.push(l)}}))}s.length>0&&this.emitOuterEvent(k.MESSAGE_READ_RECEIPT_RECEIVED,s)}}},{key:"recomputeGroupUnreadCount",value:function(e){var t=e.conversationID,n=e.count,i=this.getLocalConversation(t);if(i){var r=i.unreadCount,o=r-n;o<0&&(o=0),i.unreadCount=o,He.l("".concat(this._n,".recomputeGroupUnreadCount from ").concat(r," to ").concat(o,", conversationID:").concat(t))}}},{key:"updateIsRead",value:function(e){var t=this.getLocalConversation(e),n=this.getLocalMessageList(e);if(t&&0!==n.length&&!Pt(t.type)){for(var i=[],r=0,o=n.length;r<o;r++)"in"!==n[r].flow?"out"!==n[r].flow||n[r].isRead||n[r].setIsRead(!0):i.push(n[r]);var a=0;if(t.type===b.CONV_C2C){var s=i.slice(-t.unreadCount).filter((function(e){return e.isRevoked})).length;a=i.length-t.unreadCount-s}else a=i.length-t.unreadCount;for(var c=0;c<a&&!i[c].isRead;c++)i[c].setIsRead(!0)}}},{key:"deleteGroupAtTips",value:function(e){var t=this,n="".concat(this._n,".deleteGroupAtTips");He.l("".concat(n));var i=this._conversationMap.get(e);if(!i)return Promise.resolve();var r=i.groupAtInfoList;if(0===r.length)return Promise.resolve();var o=void 0;e.startsWith(b.CONV_GROUP)&&(o=e.replace(b.CONV_GROUP,""));var a=_(r);if((Rt({groupID:o})||Lt(o))&&0===(a=r.filter((function(e){return!e.atTypeArray.includes(b.CONV_AT_ALL)}))).length)return this.clearGroupAtInfoList(e,!1),Promise.resolve();var s=this.getMyUserID();return this.request({protocolName:ir,requestData:{messageListToDelete:a.map((function(e){return{from:e.from,to:s,messageSeq:e.__sequence,messageRandom:e.__random,groupID:ht(e.topicID)?e.groupID:e.topicID}}))}}).then((function(){return He.l("".concat(n," ok. count:").concat(r.length)),t.clearGroupAtInfoList(e,!1),Promise.resolve()})).catch((function(e){return He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"appendToMessageList",value:function(e){this._messageListHandler.pushIn(e)}},{key:"setMessageRandom",value:function(e){this.singlyLinkedList.set(e.random)}},{key:"deleteMessageRandom",value:function(e){this.singlyLinkedList.delete(e.random)}},{key:"pushIntoMessageList",value:function(e,t,n){return!(!this._messageListHandler.pushIn(t,n)||this._isMessageFromCurrentInstance(t)&&!n||(e.push(t),0))}},{key:"_isMessageFromCurrentInstance",value:function(e){return this.singlyLinkedList.has(e.random)}},{key:"revoke",value:function(e,t,n){return this._messageListHandler.revoke(e,t,n)}},{key:"getPeerReadTime",value:function(e){return this._peerReadTimeMap.get(e)}},{key:"recordPeerReadTime",value:function(e,t){this._peerReadTimeMap.has(e)?this._peerReadTimeMap.get(e)<t&&this._peerReadTimeMap.set(e,t):this._peerReadTimeMap.set(e,t)}},{key:"updateMessageIsPeerReadProperty",value:function(e,t){if(e.startsWith(b.CONV_C2C)&&t>0){var n=this._messageListHandler.updateMessageIsPeerReadProperty(e,t);if(n.length>0&&this.emitOuterEvent(k.MESSAGE_READ_BY_PEER,n),this._conversationMap.has(e)){var i=this._conversationMap.get(e).lastMessage;tn(i)||i.fromAccount===this.getMyUserID()&&i.lastTime<=t&&!i.isPeerRead&&(i.isPeerRead=!0,this.emitConversationUpdate(!0,!1))}}}},{key:"updateMessageIsModifiedProperty",value:function(e){this._messageListHandler.updateMessageIsModifiedProperty(e)}},{key:"setCompleted",value:function(e){He.l("".concat(this._n,".setCompleted. conversationID:").concat(e)),this._completedMap.set(e,!0)}},{key:"updateRoamingMessageKeyAndTime",value:function(e,t,n){this._roamingMessageKeyAndTimeMap.set(e,{messageKey:t,lastMessageTime:n})}},{key:"updateRoamingMessageSequence",value:function(e,t){this._roamingMessageSequenceMap.set(e,t)}},{key:"getConversationList",value:function(e){var t=this,n="getConversationList",i="".concat(this._n,".").concat(n),r="pagingStatus:".concat(this._pagingStatus,", local conversation count:").concat(this._conversationMap.size,", options:").concat(e);if(He.l("".concat(i,". ").concat(r)),this._pagingStatus===sn.REJECTED){var o=new $o(n);return o.setMessage(r),this.syncConversationList().then((function(){o.setNetworkType(t.getNetworkType()).end();var n=t._getConversationList(e);return pa({conversationList:n,isSyncCompleted:t._isSyncCompleted()})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),He.e("".concat(i," failed. error:"),e),va(e)}))}if(0===this._conversationMap.size){var a=new $o(n);return a.setMessage(r),this.syncConversationList().then((function(){a.setNetworkType(t.getNetworkType()).end();var n=t._getConversationList(e);return pa({conversationList:n,isSyncCompleted:t._isSyncCompleted()})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),He.e("".concat(i," failed. error:"),e),va(e)}))}var s=this._getConversationList(e);return He.l("".concat(i,". returned conversation count:").concat(s.length)),ma({conversationList:s,isSyncCompleted:this._isSyncCompleted()})}},{key:"_getConversationList",value:function(e){if(ht(e))return this.getLocalConversationList();if(pt(e))return 0===e.length?[]:this.getLocalConversationList().filter((function(t){return e.includes(t.conversationID)}));if(dt(e)){var t=e.type,n=e.markType,i=e.groupName;return this.getLocalConversationList().filter((function(e){return(t!==b.CONV_C2C&&t!==b.CONV_GROUP||e.type===t)&&(!ut(i)||e.conversationGroupList.includes(i))&&(!ct(n)||e.markList.includes(n))}))}return[]}},{key:"_handleC2CPeerReadTime",value:function(){var e,t=E(this._conversationMap);try{for(t.s();!(e=t.n()).done;){var n=v(e.value,2),i=n[0],r=n[1];r.type===b.CONV_C2C&&(He.d("".concat(this._n,"._handleC2CPeerReadTime conversationID:").concat(i," peerReadTime:").concat(r.peerReadTime)),this.recordPeerReadTime(i,r.peerReadTime))}}catch(o){t.e(o)}finally{t.f()}}},{key:"_isPagingGetGroupListCompleted",value:function(){return this.getModule(Bn).isPagingGetCompleted()}},{key:"_getLocalGroupCount",value:function(){return this.getModule(Bn).getLocalGroupList().length}},{key:"_hasLocalGroup",value:function(e){return this.getModule(Bn).hasLocalGroup(e.replace(b.CONV_GROUP,""))}},{key:"getConversationProfile",value:function(e){var t,n=this;if((t=this._conversationMap.has(e)?this._conversationMap.get(e):new Ua({conversationID:e,type:e.slice(0,3)===b.CONV_C2C?b.CONV_C2C:b.CONV_GROUP},this.isIntl()))._isInfoCompleted||t.type===b.CONV_SYSTEM)return ma({conversation:t});if(Nt(e)&&!this._hasLocalGroup(e))return ma({conversation:t});var i="".concat(this._n,".").concat("getConversationProfile"),r=new $o("getConversationProfile");return He.l("".concat(i,". conversationID:").concat(e," remark:").concat(t.remark," lastMessage:"),t.lastMessage),this._updateUserOrGroupProfileCompletely(t).then((function(o){r.setNetworkType(n.getNetworkType()).setMessage("conversationID:".concat(e," unreadCount:").concat(o.data.conversation.unreadCount)).end();var a=n.getModule(Hn);if(a&&t.type===b.CONV_C2C){var s=e.replace(b.CONV_C2C,"");if(a.isMyFriend(s)){var c=a.getFriendRemark(s);t.remark!==c&&(t.remark=c,He.l("".concat(i,". conversationID:").concat(e," patch remark:").concat(t.remark)))}}return He.l("".concat(i," ok. conversationID:").concat(e)),o})).catch((function(t){return n.probeNetwork().then((function(n){var i=v(n,2),o=i[0],a=i[1];r.setError(t,o,a).setMessage("conversationID:".concat(e)).end()})),He.e("".concat(i," failed. error:"),t),va(t)}))}},{key:"_updateUserOrGroupProfileCompletely",value:function(e){var t=this;return e.type===b.CONV_C2C?this.getModule(Vn).getUserProfile({userIDList:[e.toAccount]}).then((function(n){var i=n.data;return 0===i.length?va(new ha({code:No.USER_OR_GROUP_NOT_FOUND})):(e.userProfile=i[0],e._isInfoCompleted=!0,t._unshiftConversation(e),ma({conversation:e}))})):this.getModule(Bn).getGroupProfile({groupID:e.toAccount}).then((function(n){return e.groupProfile=n.data.group,e._isInfoCompleted=!0,t._unshiftConversation(e),ma({conversation:e})}))}},{key:"_unshiftConversation",value:function(e){e instanceof Ua&&!this._conversationMap.has(e.conversationID)&&(this._conversationMap=new Map([[e.conversationID,e]].concat(_(this._conversationMap))),this._setStorageConversationList(),this.emitConversationUpdate(!0,!1))}},{key:"_onProfileUpdated",value:function(e){var t=this;e.data.forEach((function(e){var n=e.userID;if(n===t.getMyUserID())t._onMyProfileModified({latestNick:e.nick,latestAvatar:e.avatar});else{var i=t._conversationMap.get("".concat(b.CONV_C2C).concat(n));i&&(i.userProfile=e)}}))}},{key:"_isSyncCompleted",value:function(){return this._pagingStatus===sn.RESOLVED}},{key:"_errorLog",value:function(e,t,n,i){var r=new Error("Params validate failed."),o="".concat(this.getErrorMessage("API_REFER")).concat(e);throw He.w("[".concat(e,"] | ").concat(t," | ").concat(this.getErrorMessage(n,i),", ").concat(o)),He.e("[".concat(e,"] Invalid ").concat(t,": type check failed for ").concat(t,".")),r}},{key:"_isValidConversationID",value:function(e){return Ot(e)||Nt(e)||Pt(e)}},{key:"deleteConversation",value:function(e){var t=this,n="deleteConversation";return ut(e)||lt(e)||this._errorLog(n,"options","StringOrObjectRequiredLog"),ut(e)?(this._isValidConversationID(e)||this._errorLog(n,"options","InvalidConversationID",e),He.l("".concat(this._n,".").concat(n," conversationID:").concat(e)),this.deleteConversationList({conversationIDList:[e],flag:1})):(pt(e.conversationIDList)||this._errorLog(n,"conversationIDList","ArrayRequiredLog"),0===e.conversationIDList.length&&this._errorLog(n,"conversationIDList","NonEmptyArrayLog"),e.conversationIDList.forEach((function(e){t._isValidConversationID(e)||t._errorLog(n,"conversationIDList","InvalidConversationID",e)})),"clearHistoryMessage"in e&&"boolean"!=typeof e.clearHistoryMessage&&this._errorLog(n,"clearHistoryMessage","BooleanRequiredLog"),e.conversationIDList.length>100&&(e.conversationIDList=e.conversationIDList.slice(0,100)),this.deleteConversationList(e))}},{key:"deleteConversationList",value:function(e){var t=this,n=e.conversationIDList,i=void 0===n?[]:n,r=e.clearHistoryMessage,o=void 0===r||r,a=e.flag,s=void 0===a?0:a,c="".concat(this._n,".").concat("deleteConversationList");He.l("".concat(c," conversationIDList.length:").concat(i.length," clearHistoryMessage:").concat(o));var u=new $o("deleteConversationList");return u.setMessage("conversationIDList:".concat(i)),Promise.all([this.rmLocalOnlyConversationList(i),this.rmLocalAndRemoteConversationList(i,o)]).then((function(e){u.setNetworkType(t.getNetworkType()).end();var n=[].concat(_(e[0]),_(e[1]));return 0===n.length?va(new ha({code:No.CONVERSATION_NOT_FOUND})):(He.l("".concat(c," ok")),ma(1===s?{conversationID:n[0]}:{conversationIDList:n}))})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];u.setError(e,i,r).end()})),He.e("".concat(c," failed. error:"),e),va(e)}))}},{key:"rmLocalOnlyConversationList",value:function(e){var t=this;return e.filter((function(e){if(!t._conversationMap.has(e))return!1;var n=t.getLocalConversation(e).type;return n!==b.CONV_GROUP||t._hasLocalGroup(e)?n===b.CONV_SYSTEM&&(t.getModule(Bn).deleteGroupSystemNotice({messageList:t._messageListHandler.getLocalMessageList(e)}),t.deleteLocalConversation(e),!0):(t.deleteLocalConversation(e),!0)}))}},{key:"rmLocalAndRemoteConversationList",value:function(e,t){var n=this,i={fromAccount:this.getMyUserID(),conversationList:[],clearHistoryMessage:t?1:0};return e.forEach((function(e){if(n._conversationMap.has(e)){var t=n.getLocalConversation(e).type;t===b.CONV_C2C?i.conversationList.push({toAccount:e.replace(t,""),type:1}):t===b.CONV_GROUP&&n._hasLocalGroup(e)&&i.conversationList.push({toGroupID:e.replace(t,""),type:2})}})),0===i.conversationList.length?[]:this.request({protocolName:er,requestData:i}).then((function(e){var t=[];return e.data.resultList.length>0&&e.data.resultList.map((function(e){if(0===e.code){var n="".concat(1===e.type?b.CONV_C2C:b.CONV_GROUP).concat(e.to);t.push(n)}})),n.deleteLocalConversationList(t),t}))}},{key:"clearHistoryMessage",value:function(e){var t=this,n={fromAccount:this.getMyUserID(),toAccount:void 0,type:void 0,toGroupID:void 0};if(!this._conversationMap.has(e))return va({code:No.CONVERSATION_NOT_FOUND});var i=this._conversationMap.get(e).type;if(i===b.CONV_C2C)n.type=1,n.toAccount=e.replace(b.CONV_C2C,"");else{if(i!==b.CONV_GROUP)return i===b.CONV_SYSTEM?(this.getModule(Bn).deleteGroupSystemNotice({messageList:this._messageListHandler.getLocalMessageList(e)}),ma({conversationID:e})):va({code:No.CONVERSATION_UN_RECORDED_TYPE});n.type=2,n.toGroupID=e.replace(b.CONV_GROUP,"")}var r="".concat(this._n,".").concat("clearHistoryMessage"),o=new $o("clearHistoryMessage");return o.setMessage("conversationID:".concat(e)),He.l("".concat(r,". conversationID:").concat(e)),this.setMessageRead({conversationID:e}).then((function(){return t.request({protocolName:tr,requestData:n})})).then((function(){o.setNetworkType(t.getNetworkType()).end(),He.l("".concat(r," ok")),t._messageListHandler.removeByConversationID(e),t.setCompleted(e);var n=t.getLocalConversation(e);return n&&(n.updateLastMessage(),t._sortConversationListAndEmitEvent()),ma({conversationID:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),He.e("".concat(r," failed. error:"),e),va(e)}))}},{key:"pinConversation",value:function(e){var t=this,n=e.conversationID,i=e.isPinned;if(!this._conversationMap.has(n))return va({code:No.CONVERSATION_NOT_FOUND});var r=this.getLocalConversation(n);if(r.isPinned===i)return ma({conversationID:n});var o="".concat(this._n,".").concat("pinConversation"),a=new $o("pinConversation");a.setMessage("conversationID:".concat(n," isPinned:").concat(i)),He.l("".concat(o,". conversationID:").concat(n," isPinned:").concat(i));var s=null;return Ot(n)?s={type:1,toAccount:n.replace(b.CONV_C2C,"")}:Nt(n)&&(s={type:2,groupID:n.replace(b.CONV_GROUP,"")}),this.request({protocolName:nr,requestData:{fromAccount:this.getMyUserID(),operationType:!0===i?1:2,itemList:[s]}}).then((function(){return a.setNetworkType(t.getNetworkType()).end(),He.l("".concat(o," ok")),r.isPinned!==i&&(r.isPinned=i,t._sortConversationListAndEmitEvent()),pa({conversationID:n})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),He.e("".concat(o," failed. error:"),e),va(e)}))}},{key:"setMessageRemindType",value:function(e){return this._messageRemindHandler.set(e)}},{key:"patchMessageRemindType",value:function(e){var t=e.ID,n=e.isC2CConversation,i=e.messageRemindType,r=!1,o=this.getLocalConversation(n?"".concat(b.CONV_C2C).concat(t):"".concat(b.CONV_GROUP).concat(t));return o&&o.messageRemindType!==i&&(o.messageRemindType=i,r=!0),He.d("".concat(this._n,".patchMessageRemindType options:"),e,"ret:".concat(r)),r}},{key:"onC2CMessageRemindTypeSynced",value:function(e){var t=this,n="".concat(this._n,".onC2CMessageRemindTypeSynced");He.d(n,e),e.dataList.forEach((function(e){if(!tn(e.muteNotificationsSync)){var i,r=e.muteNotificationsSync,o=r.to,a=r.updateSequence,s=r.muteFlag;t._messageRemindHandler.setUpdateSequence(a),0===s?i=b.MSG_REMIND_ACPT_AND_NOTE:1===s?i=b.MSG_REMIND_DISCARD:2===s&&(i=b.MSG_REMIND_ACPT_NOT_NOTE);var c=0;t.patchMessageRemindType({ID:o,isC2CConversation:!0,messageRemindType:i})&&(c+=1),He.l("".concat(n," updateCount:").concat(c)),c>=1&&t.emitConversationUpdate(!0,!1)}}))}},{key:"onGroupMessageRemindTypeSynced",value:function(e){He.d("".concat(this._n,".onGroupMessageRemindTypeSynced options:"),e),this._messageRemindHandler.onGroupMessageRemindTypeUpdated(e)}},{key:"deleteLocalConversation",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this._conversationMap.has(e);if(He.d("".concat(this._n,".deleteLocalConversation conversationID:").concat(e," has:").concat(n)),n&&(this._conversationMap.delete(e),this._roamingMessageKeyAndTimeMap.has(e)&&this._roamingMessageKeyAndTimeMap.delete(e),this._roamingMessageSequenceMap.has(e)&&this._roamingMessageSequenceMap.delete(e),this._setStorageConversationList(),this._messageListHandler.removeByConversationID(e),this._completedMap.delete(e),t)){var i=!this._isTopicConversation(e);this.emitConversationUpdate(i,!1)}}},{key:"deleteLocalConversationList",value:function(e){var t=this,n=0,i=!1;e.forEach((function(e){t._conversationMap.has(e)&&(n+=t._conversationMap.get(e).unreadCount||0,t.deleteLocalConversation(e,!1),i=!0)})),He.l("".concat(this._n,".deleteLocalConversationList conversationIDList.length:").concat(e.length," isConvIDExisted:").concat(i)),i&&(this.emitConversationUpdate(!0,!1),n>0&&this.emitTotalUnreadMessageCountUpdate())}},{key:"isMessageSentByCurrentInstance",value:function(e){return!(!this._messageListHandler.hasLocalMessage(e.conversationID,e.ID)&&!this.singlyLinkedList.has(e.random))}},{key:"modifyMessageList",value:function(e){if(e.startsWith(b.CONV_C2C)&&this._conversationMap.has(e)){var t=this._conversationMap.get(e),n=Date.now();this._messageListHandler.modifyMessageSentByPeer({conversationID:e,latestNick:t.userProfile.nick,latestAvatar:t.userProfile.avatar});var i=this.getModule(Vn).getNickAndAvatarByUserID(this.getMyUserID());this._messageListHandler.modifyMessageSentByMe({conversationID:e,latestNick:i.nick,latestAvatar:i.avatar}),He.l("".concat(this._n,".modifyMessageList conversationID:").concat(e," cost ").concat(Date.now()-n," ms"))}}},{key:"updateUserProfileSpecifiedKey",value:function(e){He.l("".concat(this._n,".updateUserProfileSpecifiedKey options:"),e);var t=e.conversationID,n=e.nick,i=e.avatar;if(this._conversationMap.has(t)){var r=this._conversationMap.get(t).userProfile;ut(n)&&r.nick!==n&&(r.nick=n),ut(i)&&r.avatar!==i&&(r.avatar=i),this.emitConversationUpdate(!0,!1)}}},{key:"_onMyProfileModified",value:function(e){var n=this,i=this.getLocalConversationList(),r=Date.now();i.forEach((function(i){n.modifyMessageSentByMe(t({conversationID:i.conversationID},e))})),He.l("".concat(this._n,"._onMyProfileModified. modify all messages sent by me, cost ").concat(Date.now()-r," ms"))}},{key:"modifyMessageSentByMe",value:function(e){this._messageListHandler.modifyMessageSentByMe(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._messageListHandler.getLatestMessageSentByMe(e)}},{key:"modifyMessageSentByPeer",value:function(e){this._messageListHandler.modifyMessageSentByPeer(e)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._messageListHandler.getLatestMessageSentByPeer(e)}},{key:"pushIntoNoticeResult",value:function(e,t){return!(!this._messageListHandler.pushIn(t)||this.singlyLinkedList.has(t.random)||(e.push(t),0))}},{key:"getLocalLastMessage",value:function(e){return this._messageListHandler.getLocalLastMessage(e)}},{key:"checkAndPatchRemark",value:function(){var e=Promise.resolve();if(0===this._conversationMap.size)return e;var t=this.getModule(Hn);if(!t)return e;var n=_(this._conversationMap.values()).filter((function(e){return e.type===b.CONV_C2C}));if(0===n.length)return e;var i=0;return n.forEach((function(e){var n=e.conversationID.replace(b.CONV_C2C,"");if(t.isMyFriend(n)){var r=t.getFriendRemark(n);e.remark!==r&&(e.remark=r,i+=1)}})),He.l("".concat(this._n,".checkAndPatchRemark. c2c conversation count:").concat(n.length,", patched count:").concat(i)),e}},{key:"updateTopicConversation",value:function(e){this._updateLocalConversationList({conversationOptionsList:e,isFromGetConversations:!0})}},{key:"sendReadReceipt",value:function(e){var t=e[0],n=null;return t.conversationType===b.CONV_C2C?n=this._m.getModule(qn):t.conversationType===b.CONV_GROUP&&(n=this._m.getModule(Bn)),n?n.sendReadReceipt(e):va({code:No.CANNOT_FIND_MODULE})}},{key:"getReadReceiptList",value:function(e){var t=e[0],n=null;return t.conversationType===b.CONV_C2C?n=this._m.getModule(qn):t.conversationType===b.CONV_GROUP&&(n=this._m.getModule(Bn)),n?n.getReadReceiptList(e):va({code:No.CANNOT_FIND_MODULE})}},{key:"getLastMessageTime",value:function(e){var t=this.getLocalConversation(e);return t?t.lastMessage.lastTime:0}},{key:"getTotalUnreadMessageCount",value:function(){var e=this.getLocalConversationList(),t=0;return e.forEach((function(e){e.type!==b.CONV_SYSTEM&&(""!==e.messageRemindType&&e.messageRemindType!==b.MSG_REMIND_ACPT_AND_NOTE||(t+=e.unreadCount))})),t}},{key:"emitTotalUnreadMessageCountUpdate",value:function(){var e=this.getTotalUnreadMessageCount();this._convTotalUnreadCount!==e&&(He.l("".concat(this._n,".emitTotalUnreadMessageCountUpdate from ").concat(this._convTotalUnreadCount," to ").concat(e)),this._convTotalUnreadCount=e,this.emitOuterEvent(k.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED))}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._pagingStatus=sn.NOT_START,this._messageListHandler.reset(),this._messageRemindHandler.reset(),this._roamingMessageKeyAndTimeMap.clear(),this._roamingMessageSequenceMap.clear(),this.singlyLinkedList.reset(),this._peerReadTimeMap.clear(),this._completedMap.clear(),this._conversationMap.clear(),this._pagingTimeStamp=0,this._pagingStartIndex=0,this._pagingPinnedTimeStamp=0,this._pagingPinnedStartIndex=0,this._remoteGroupReadSequenceMap.clear(),this._convTotalUnreadCount=0,this.resetReady()}}]),r}(fi),Va=function(){function e(t){i(this,e),this._groupModule=t,this._n="GroupTipsHandler",this._cachedGroupTipsMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this._getTopicPendingMap=new Map}return o(e,[{key:"onCheckTimer",value:function(e){e%1==0&&this._cachedGroupTipsMap.size>0&&this._checkCachedGroupTips()}},{key:"_checkCachedGroupTips",value:function(){var e=this;this._cachedGroupTipsMap.forEach((function(t,n){var i=e._checkCountMap.get(n),r=e._groupModule.hasLocalGroup(n);He.l("".concat(e._n,"._checkCachedGroupTips groupID:").concat(n," hasLocalGroup:").concat(r," checkCount:").concat(i)),r?(e._notifyCachedGroupTips(n),e._checkCountMap.delete(n),e._groupModule.deleteUnjoinedAVChatRoom(n)):i>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupTips(n),e._checkCountMap.delete(n)):(i++,e._checkCountMap.set(n,i))}))}},{key:"onNewGroupTips",value:function(e){He.d("".concat(this._n,".onReceiveGroupTips count:").concat(e.dataList.length));var t=this.newGroupTipsStoredAndSummary(e),n=t.eventDataList,i=t.result,r=t.AVChatRoomMessageList;r.length>0&&this._groupModule.onAVChatRoomMessage(r),n.length>0&&(this._groupModule.updateNextMessageSeq(n),this._groupModule.getModule(zn).onNewMessage({conversationOptionsList:n,isInstantMessage:!0})),i.length>0&&(this._groupModule.emitOuterEvent(k.MESSAGE_RECEIVED,i),this.handleMessageList(i))}},{key:"newGroupTipsStoredAndSummary",value:function(e){for(var n=this,i=e.event,r=e.dataList,o=null,a=[],s=[],c={},u=[],l=function(e,l){var d=Dt(r[e]);if(6===i){if(n._groupModule.isGroupAttributesUpdatedNotice(d))return"continue";if(n._groupModule.isGroupCountersNotice(d))return"continue"}var p=d.groupProfile,h=p.groupID,f=p.communityType,g=void 0===f?0:f,m=p.topicID,v=void 0===m?void 0:m,_=p.invisible,y=void 0,I=n._groupModule.isMessageFromTopic(g,v);if(I){y=b.CONV_TOPIC,d.to=v;var M=n._groupModule.getModule(Kn);M.hasLocalTopic(h,v)||n._getTopicPendingMap.has(v)||(n._getTopicPendingMap.set(v,1),M.getTopicList({groupID:h,topicIDList:[v]}).finally((function(){n._getTopicPendingMap.delete(v)})))}var T=n._groupModule.hasLocalGroup(h);if(!T&&n._groupModule.isUnjoinedAVChatRoom(h))return"continue";if(!T&&!I)return n._cacheGroupTipsAndProbe({groupID:h,event:i,item:d}),"continue";if(n._groupModule.isMessageFromOrToAVChatroom(h))return d.event=i,u.push(d),"continue";if(d.currentUser=n._groupModule.getMyUserID(),d.conversationType=b.CONV_GROUP,(o=new da(d)).setElement({type:b.MSG_GRP_TIP,content:t(t({},d.elements),{},{groupProfile:d.groupProfile})}),o.isSystemMessage=!1,1===_)return n._qualityStat(o),"continue";var C=n._groupModule.getModule(zn),S=o,E=S.conversationID,k=S.sequence;if(6===i)o._onlineOnlyFlag=!0,s.push(o);else if(!C.pushIntoNoticeResult(s,o))return"continue";if(n._groupModule.isMessageFromCommunityOfTopic(g,v))return"continue";if(6===i&&C.getLocalConversation(E))return"continue";6!==i&&n._qualityStat(o);var D=C.isRemoteRead({conversationID:E,sequence:k});if(ht(c[E])){var w=0;"in"===o.flow&&(o._isExcludedFromUnreadCount||o._onlineOnlyFlag||D||(w=1)),c[E]=a.push({conversationID:E,unreadCount:w,type:ht(y)?o.conversationType:y,subType:o.conversationSubType,lastMessage:o._isExcludedFromLastMessage?"":o})-1}else{var A=c[E];a[A].type=o.conversationType,a[A].subType=o.conversationSubType,a[A].lastMessage=o._isExcludedFromLastMessage?"":o,"in"===o.flow&&(o._isExcludedFromUnreadCount||o._onlineOnlyFlag||D||a[A].unreadCount++)}},d=0,p=r.length;d<p;d++)l(d);return{eventDataList:a,result:s,AVChatRoomMessageList:u}}},{key:"_qualityStat",value:function(e){this._groupModule.getModule(si).addMessageSequence({key:Bo,message:e})}},{key:"handleMessageList",value:function(e){var t=this;e.forEach((function(e){switch(e.payload.operationType){case 1:t._onNewMemberComeIn(e);break;case 2:t._onMemberQuit(e);break;case 3:t._onMemberKickedOut(e);break;case 4:t._onMemberSetAdmin(e);break;case 5:t._onMemberCancelledAdmin(e);break;case 6:t._onGroupProfileModified(e);break;case 7:t._onMemberInfoModified(e);break;case 8:t._onTopicProfileUpdated(e);break;default:He.w("".concat(t._n,".handleMessageList unknown operationType:").concat(e.payload.operationType))}}))}},{key:"_onNewMemberComeIn",value:function(e){var t=e.payload,n=t.memberNum,i=t.groupProfile.groupID,r=this._groupModule.getLocalGroupProfile(i);r&&ct(n)&&r.memberCount!==n&&(r.memberCount=n,this._updateConversationGroupProfile(r))}},{key:"_onMemberQuit",value:function(e){var t=e.payload,n=t.memberNum,i=t.groupProfile.groupID,r=this._groupModule.getLocalGroupProfile(i);r&&ct(n)&&r.memberCount!==n&&(r.memberCount=n,this._updateConversationGroupProfile(r)),this._groupModule.getModule(jn).deleteLocalGroupMembers(i,e.payload.userIDList)}},{key:"_onMemberKickedOut",value:function(e){var t=e.payload,n=t.memberNum,i=t.groupProfile.groupID,r=this._groupModule.getLocalGroupProfile(i);r&&ct(n)&&r.memberCount!==n&&(r.memberCount=n,this._updateConversationGroupProfile(r)),this._groupModule.getModule(jn).deleteLocalGroupMembers(i,e.payload.userIDList)}},{key:"_updateConversationGroupProfile",value:function(e){this._groupModule.getModule(zn).updateConversationGroupProfile([e])}},{key:"_onMemberSetAdmin",value:function(e){var t=e.payload.groupProfile.groupID,n=e.payload.userIDList,i=this._groupModule.getModule(jn);n.forEach((function(e){var n=i.getLocalGroupMemberInfo(t,e);n&&n.updateRole(b.GRP_MBR_ROLE_ADMIN)}))}},{key:"_onMemberCancelledAdmin",value:function(e){var t=e.payload.groupProfile.groupID,n=e.payload.userIDList,i=this._groupModule.getModule(jn);n.forEach((function(e){var n=i.getLocalGroupMemberInfo(t,e);n&&n.updateRole(b.GRP_MBR_ROLE_MEMBER)}))}},{key:"_onGroupProfileModified",value:function(e){var t=this,n=e.payload,i=n.newGroupProfile,r=n.groupProfile.groupID,o=this._groupModule.getLocalGroupProfile(r);Object.keys(i).forEach((function(e){switch(e){case"ownerID":t._ownerChanged(o,i);break;case"groupName":o.name=i[e];break;default:o[e]=i[e]}}));var a=!o.isSupportTopic;this._groupModule.emitGroupListUpdate(!0,a)}},{key:"_ownerChanged",value:function(e,t){var n=e.groupID,i=this._groupModule.getLocalGroupProfile(n),r=this._groupModule.getMyUserID();if(r===t.ownerID){i.updateGroup({selfInfo:{role:b.GRP_MBR_ROLE_OWNER}});var o=this._groupModule.getModule(jn),a=o.getLocalGroupMemberInfo(n,r),s=this._groupModule.getLocalGroupProfile(n).ownerID,c=o.getLocalGroupMemberInfo(n,s);a&&a.updateRole(b.GRP_MBR_ROLE_OWNER),c&&c.updateRole(b.GRP_MBR_ROLE_MEMBER)}}},{key:"_onMemberInfoModified",value:function(e){var t=e.to,n=e.payload,i=n.groupProfile,r=n.memberList,o=i.groupID;Lt(t)&&this._updateTopicMuteTime(e);var a=this._groupModule.getModule(jn);r.forEach((function(e){var t=a.getLocalGroupMemberInfo(o,e.userID);t&&ct(e.muteTime)&&t.updateMuteUntil(e.muteTime)}))}},{key:"_updateTopicMuteTime",value:function(e){var t=e.to,n=e.payload,i=n.groupProfile,r=n.memberList,o=void 0===r?[]:r,a=this._groupModule.getModule(Kn),s=i.groupID,c=a.getLocalTopic(s,t);if(c){for(var u=!1,l=0;l<o.length;l++){var d=o[l];if(d.userID===this._groupModule.getMyUserID()&&d.muteTime>=0){c.updateSelfInfo({muteTime:d.muteTime}),u=!0;break}}u&&this._groupModule.emitOuterEvent(k.TOPIC_UPDATED,{groupID:s,topic:c})}}},{key:"_onTopicProfileUpdated",value:function(e){var n=e.payload,i=n.groupProfile.groupID,r=n.newTopicInfo;this._groupModule.getModule(Kn).onTopicProfileUpdated(t({groupID:i,topicID:e.to},r))}},{key:"_cacheGroupTips",value:function(e,t){this._cachedGroupTipsMap.has(e)||this._cachedGroupTipsMap.set(e,[]),this._cachedGroupTipsMap.get(e).push(t)}},{key:"_deleteCachedGroupTips",value:function(e){this._cachedGroupTipsMap.has(e)&&this._cachedGroupTipsMap.delete(e)}},{key:"_notifyCachedGroupTips",value:function(e){var t=this,n=this._cachedGroupTipsMap.get(e)||[];n.forEach((function(e){t.onNewGroupTips(e)})),this._deleteCachedGroupTips(e),He.l("".concat(this._n,"._notifyCachedGroupTips groupID:").concat(e," count:").concat(n.length))}},{key:"_cacheGroupTipsAndProbe",value:function(e){var t=this,n=e.groupID,i=e.event,r=e.item;this._cacheGroupTips(n,{event:i,dataList:[r]}),this._groupModule.getGroupSimplifiedInfo(n).then((function(e){e.type===b.GRP_AVCHATROOM?t._groupModule.hasLocalGroup(n)?t._notifyCachedGroupTips(n):t._groupModule.setUnjoinedAVChatRoom(n):(t._groupModule.updateGroupMap([e]),t._notifyCachedGroupTips(n))})),this._checkCountMap.has(n)||this._checkCountMap.set(n,0),He.l("".concat(this._n,"._cacheGroupTipsAndProbe groupID:").concat(n))}},{key:"reset",value:function(){this._cachedGroupTipsMap.clear(),this._checkCountMap.clear(),this._getTopicPendingMap.clear()}}]),e}(),qa=function(){function e(t){i(this,e),this._groupModule=t,this._n="CommonGroupHandler",this.tempConversationList=null,this._cachedGroupMessageMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this._getTopicPendingMap=new Map,this._isPagingGetCompleted=!1,t.getInnerEmitterInstance().once(Ia,this._initGroupList,this)}return o(e,[{key:"onCheckTimer",value:function(e){e%1==0&&this._cachedGroupMessageMap.size>0&&this._checkCachedGroupMessage()}},{key:"_checkCachedGroupMessage",value:function(){var e=this;this._cachedGroupMessageMap.forEach((function(t,n){var i=e._checkCountMap.get(n),r=e._groupModule.hasLocalGroup(n);He.l("".concat(e._n,"._checkCachedGroupMessage groupID:").concat(n," hasLocalGroup:").concat(r," checkCount:").concat(i)),r?(e._notifyCachedGroupMessage(n),e._checkCountMap.delete(n),e._groupModule.deleteUnjoinedAVChatRoom(n)):i>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupMessage(n),e._checkCountMap.delete(n)):(i++,e._checkCountMap.set(n,i))}))}},{key:"_initGroupList",value:function(){var e=this;He.l("".concat(this._n,"._initGroupList"));var t=new $o("getGroupListInStorage"),n=this._groupModule.getStorageGroupList();if(pt(n)&&n.length>0){n.forEach((function(t){e._groupModule.initGroupMap(t)})),this._groupModule.emitGroupListUpdate(!0,!1);var i=this._groupModule.getLocalGroupList().length;t.setNetworkType(this._groupModule.getNetworkType()).setMessage("group count:".concat(i)).end()}else t.setNetworkType(this._groupModule.getNetworkType()).setMessage("group count:0").end();He.l("".concat(this._n,"._initGroupList ok"))}},{key:"handleUpdateGroupLastMessage",value:function(e){var n="".concat(this._n,".handleUpdateGroupLastMessage");if(He.l("".concat(n," conversation count:").concat(e.length,", local group count:").concat(this._groupModule.getLocalGroupList().length)),0!==this._groupModule.getGroupMap().size){for(var i,r,o,a=!1,s=0,c=e.length;s<c;s++)(i=e[s]).type===b.CONV_GROUP&&(r=i.conversationID.split(/^GROUP/)[1],(o=this._groupModule.getLocalGroupProfile(r))&&(o.lastMessage=t({},i.lastMessage),a=!0));a&&(this._groupModule.sortLocalGroupList(),this._groupModule.emitGroupListUpdate(!0,!1))}else this.tempConversationList=e}},{key:"onNewGroupMessage",value:function(e){He.d("".concat(this._n,".onNewGroupMessage count:").concat(e.dataList.length));var t=this._newGroupMessageStoredAndSummary(e),n=t.conversationOptionsList,i=t.messageList,r=t.AVChatRoomMessageList;r.length>0&&this._groupModule.onAVChatRoomMessage(r),this._groupModule.filterModifiedMessage(i),n.length>0&&(this._groupModule.updateNextMessageSeq(n),this._groupModule.getModule(zn).onNewMessage({conversationOptionsList:n,isInstantMessage:e.isInstantMessage||!0,updateUnreadCount:e.updateUnreadCount||!0}));var o=this._groupModule.filterUnmodifiedMessage(i);o.length>0&&this._groupModule.emitOuterEvent(k.MESSAGE_RECEIVED,o),i.length=0}},{key:"_newGroupMessageStoredAndSummary",value:function(e){var t=this,n=e.dataList,i=e.event,r=e.isInstantMessage,o=null,a=[],s=[],c=[],u={},l=this._groupModule.getModule(Xn),d=this._groupModule.getFileDownloadProxy(),p=n.length;p>1&&n.sort((function(e,t){return e.sequence-t.sequence}));for(var h=function(e){var p=Dt(n[e]),h=p.groupProfile,f=h.groupID,g=h.communityType,m=void 0===g?0:g,v=h.topicID,_=void 0===v?void 0:v,y=h.invisible,I=void 0,M=t._groupModule.isMessageFromTopic(m,_);if(M){I=b.CONV_TOPIC,p.to=_;var T=t._groupModule.getModule(Kn);T.hasLocalTopic(f,_)||t._getTopicPendingMap.has(_)||(t._getTopicPendingMap.set(_,1),T.getTopicList({groupID:f,topicIDList:[_]}).finally((function(){t._getTopicPendingMap.delete(_)})))}var C=t._groupModule.hasLocalGroup(f);if(!C&&t._groupModule.isUnjoinedAVChatRoom(f))return"continue";if(!C&&!M)return t._cacheGroupMessageAndProbe({groupID:f,event:i,item:p}),"continue";if(t._groupModule.isMessageFromOrToAVChatroom(f))return p.event=i,c.push(p),"continue";if(p.currentUser=t._groupModule.getMyUserID(),p.conversationType=b.CONV_GROUP,p.isSystemMessage=!!p.isSystemMessage,o=new da(p),p.elements=l.parseElements(p.elements,p.from),o.setElement(p.elements,d),1===y)return t._qualityStat(r,o),"continue";var S=1===n[e].isModified,E=t._groupModule.getModule(zn);if(E.isMessageSentByCurrentInstance(o)?o.isModified=S:S=!1,1===p.onlineOnlyFlag)o._onlineOnlyFlag=!0,E.isMessageSentByCurrentInstance(o)||s.push(o);else{if(t._groupModule.isMessageFromCommunityOfTopic(m,_))return s.push(o),"continue";if(!E.pushIntoMessageList(s,o,S))return"continue";t._qualityStat(r,o);var k=o,D=k.conversationID,w=k.sequence,A=E.isRemoteRead({conversationID:D,sequence:w});if(ht(u[D])){var R=0;"in"===o.flow&&(o._isExcludedFromUnreadCount||A||(R=1)),u[D]=a.push({conversationID:D,unreadCount:R,type:ht(I)?o.conversationType:I,subType:o.conversationSubType,lastMessage:o._isExcludedFromLastMessage?"":o})-1}else{var L=u[D];a[L].type=ht(I)?o.conversationType:I,a[L].subType=o.conversationSubType,a[L].lastMessage=o._isExcludedFromLastMessage?"":o,"in"===o.flow&&(o._isExcludedFromUnreadCount||A||a[L].unreadCount++)}}},f=0;f<p;f++)h(f);return{conversationOptionsList:a,messageList:s,AVChatRoomMessageList:c}}},{key:"_qualityStat",value:function(e,t){var n=this._groupModule.getModule(si);n.addMessageSequence({key:Bo,message:t}),e&&t.clientTime>0&&n.addMessageDelay(t.clientTime)}},{key:"onGroupMessageRevoked",value:function(e){var t=this._groupModule.getModule(zn),n=[],i=null,r=!0;e.dataList.forEach((function(e){var o=e.elements.revokedInfos;ht(o)||o.forEach((function(e){var o=tn(e.topicID)?"GROUP".concat(e.groupID):"GROUP".concat(e.topicID);i=t.revoke(o,e.sequence,e.random);var a=e.revokerInfo&&e.revokerInfo.revoker;if(i)i.revoker=a,n.push(i);else{var s={conversationID:o,to:e.topicID||"",sequence:e.sequence,time:e.time,revoker:a};t.isLastMessageRevoked(s)&&(n.push(s),r=!1)}}))})),0!==n.length&&(t.onMessageRevoked(n),!0===r&&(He.l("".concat(this._n,".onGroupMessageRevoked count:").concat(n.length)),this._groupModule.emitOuterEvent(k.MESSAGE_REVOKED,n)))}},{key:"_groupListTreeShaking",value:function(e){for(var t=new Map(_(this._groupModule.getGroupMap())),n=0,i=e.length;n<i;n++)t.delete(e[n].groupID);this._groupModule.hasJoinedAVChatRoom()&&this._groupModule.getJoinedAVChatRoom().forEach((function(e){t.delete(e)})),this._groupModule.getGroupMap().forEach((function(e,n){e.isSupportTopic&&t.delete(n)}));for(var r=_(t.keys()),o=0,a=r.length;o<a;o++)this._groupModule.deleteGroup(r[o])}},{key:"getGroupList",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupList"),i=new $o("getGroupList");He.l("".concat(n));var r={introduction:"Introduction",notification:"Notification",createTime:"CreateTime",ownerID:"Owner_Account",lastInfoTime:"LastInfoTime",memberNum:"MemberNum",maxMemberNum:"MaxMemberNum",joinOption:"ApplyJoinOption",inviteOption:"InviteJoinOption",muteAllMembers:"ShutUpAllMember"},o=["Type","Name","FaceUrl","NextMsgSeq","LastMsgTime","AtInfoList","LastRecallTime"],a=[];e&&e.groupProfileFilter&&e.groupProfileFilter.forEach((function(e){r[e]&&o.push(r[e])}));var s=(e||{}).isGroupWithTopicOnly,c=void 0!==s&&s;return this._pagingGetGroupList({limit:50,offset:0,groupBaseInfoFilter:o,groupList:a,isGroupWithTopicOnly:c}).then((function(){He.l("".concat(n," ok. count:").concat(a.length," isGroupWithTopicOnly:").concat(c)),c||t._groupListTreeShaking(a),t._groupModule.updateGroupMap(a);var e=t._groupModule.getLocalGroupList().length;i.setNetworkType(t._groupModule.getNetworkType()).setMessage("remote count:".concat(a.length,", after tree shaking, local count:").concat(e,", isGroupWithTopicOnly:").concat(c)).end(),t.tempConversationList&&(t.handleUpdateGroupLastMessage(t.tempConversationList),t.tempConversationList=null),t._groupModule.patchGroupMessageRemindType(),t._groupModule.recomputeUnreadCount(),t._groupModule.emitGroupListUpdate(!0,!c);var r=t._groupModule.getLocalGroupList();if(c){var o=r.filter((function(e){return!0===e.isSupportTopic}));return pa({groupList:o})}return t._isPagingGetCompleted=!0,pa({groupList:r})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"isPagingGetCompleted",value:function(){return this._isPagingGetCompleted}},{key:"_pagingGetGroupList",value:function(e){var t=this,n="".concat(this._n,".").concat("_pagingGetGroupList"),i=e.isCommunityRelay,r=void 0!==i&&i,o=e.isGroupWithTopicOnly,a=void 0!==o&&o,s=e.limit,c=e.offset,u=e.groupBaseInfoFilter,l=e.groupList;if(a)return this._pagingGetGroupListWithTopic({limit:s,offset:c,groupBaseInfoFilter:u,groupList:l});var d=new $o("_pagingGetGroupList");return this._groupModule.request({protocolName:pr,requestData:{type:r?b.GRP_COMMUNITY:void 0,memberAccount:this._groupModule.getMyUserID(),limit:s,offset:c,responseFilter:{groupBaseInfoFilter:u,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]}}}).then((function(e){var i=e.data,o=i.groups,a=void 0===o?[]:o,p=i.totalCount;l.push.apply(l,_(a)),t._handleGroupAtInfoWithoutTopic(r,a);var h=c+s,f=!(p>h),g="offset:".concat(c," totalCount:").concat(p," isCompleted:").concat(f," ")+"currentCount:".concat(l.length," isCommunityRelay:").concat(r);return d.setNetworkType(t._groupModule.getNetworkType()).setMessage("".concat(g)).end(),r||f?!r&&f?(He.l("".concat(n," start to get community list")),c=0,t._pagingGetGroupList({limit:s,offset:c,groupBaseInfoFilter:u,groupList:l,isCommunityRelay:!0})):r&&!f?(c=h,t._pagingGetGroupList({limit:s,offset:c,groupBaseInfoFilter:u,groupList:l,isCommunityRelay:!0})):(He.l("".concat(n," ok. totalCount:").concat(l.length)),pa({groupList:l})):(c=h,t._pagingGetGroupList({limit:s,offset:c,groupBaseInfoFilter:u,groupList:l}))})).catch((function(e){return 11e3!==e.code&&t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];d.setMessage("isCommunityRelay:".concat(r)).setError(e,i,o).end()})),r?(11e3===e.code&&(d=null,He.l("".concat(n," ok. community unavailable"))),ma({groupList:l})):va(e)}))}},{key:"_pagingGetGroupListWithTopic",value:function(e){var t=this,n="".concat(this._n,"._pagingGetGroupListWithTopic"),i=e.limit,r=e.offset,o=e.groupBaseInfoFilter,a=e.groupList,s=new $o("pagingGetGroupListWithTopic");return this._groupModule.request({protocolName:pr,requestData:{type:b.GRP_COMMUNITY,memberAccount:this._groupModule.getMyUserID(),limit:i,offset:r,responseFilter:{groupBaseInfoFilter:o,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]},isSupportTopic:1}}).then((function(e){var c=e.data,u=c.groups,l=void 0===u?[]:u,d=c.totalCount;a.push.apply(a,_(l));var p=r+i,h=!(d>p),f="offset:".concat(r," totalCount:").concat(d," isCompleted:").concat(h," ")+"currentCount:".concat(a.length);return s.setNetworkType(t._groupModule.getNetworkType()).setMessage("".concat(f)).end(),h?(He.l("".concat(n," ok. totalCount:").concat(a.length)),pa({groupList:a})):(r=p,t._pagingGetGroupListWithTopic({limit:i,offset:r,groupBaseInfoFilter:o,groupList:a}))})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];s.setError(e,i,r).end()})),va(e)}))}},{key:"_cacheGroupMessage",value:function(e,t){this._cachedGroupMessageMap.has(e)||this._cachedGroupMessageMap.set(e,[]),this._cachedGroupMessageMap.get(e).push(t)}},{key:"_deleteCachedGroupMessage",value:function(e){this._cachedGroupMessageMap.has(e)&&this._cachedGroupMessageMap.delete(e)}},{key:"_notifyCachedGroupMessage",value:function(e){var t=this,n=this._cachedGroupMessageMap.get(e)||[];n.forEach((function(e){t.onNewGroupMessage(e)})),this._deleteCachedGroupMessage(e),He.l("".concat(this._n,"._notifyCachedGroupMessage groupID:").concat(e," count:").concat(n.length))}},{key:"_cacheGroupMessageAndProbe",value:function(e){var t=this,n=e.groupID,i=e.event,r=e.item;this._cacheGroupMessage(n,{event:i,dataList:[r]}),this._groupModule.getGroupSimplifiedInfo(n).then((function(e){e.type===b.GRP_AVCHATROOM?t._groupModule.hasLocalGroup(n)?t._notifyCachedGroupMessage(n):t._groupModule.setUnjoinedAVChatRoom(n):(t._groupModule.updateGroupMap([e]),t._notifyCachedGroupMessage(n))})),this._checkCountMap.has(n)||this._checkCountMap.set(n,0),He.l("".concat(this._n,"._cacheGroupMessageAndProbe groupID:").concat(n))}},{key:"_handleGroupAtInfoWithoutTopic",value:function(e,n){var i=this;e&&0!==n.length&&n.forEach((function(e){var n=e.groupID,r=e.groupAtInfoList,o=[];ht(r)||(r.forEach((function(e){o.push(t(t({},e),{},{groupID:n}))})),i._groupModule.getModule(zn).onNewGroupAtTips({dataList:o}))}))}},{key:"reset",value:function(){this._cachedGroupMessageMap.clear(),this._checkCountMap.clear(),this._getTopicPendingMap.clear(),this._isPagingGetCompleted=!1,this._groupModule.getInnerEmitterInstance().once(Ia,this._initGroupList,this)}}]),e}(),Ba=1,Ha=2,ja=3,Ka=4,za=5,Wa=function(){function e(t){i(this,e),this._groupModule=t,this._n="GroupAttributesHandler",this._groupAttributesMap=new Map,this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4,this._groupModule.getInnerEmitterInstance().on(Ma,this._onCloudConfigUpdated,this)}return o(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this._groupModule.getCloudConfig("grp_attr_cache_time");ht(e)||(this.CACHE_EXPIRE_TIME=Number(e))}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesMap.forEach((function(e){e.localMainSequence=0}))}},{key:"isGroupAttributesUpdatedNotice",value:function(e){var t=e.to,n=e.elements.newGroupProfile,i=!ht(n)&&!tn(n.groupAttributeOption);return i&&this._onGroupAttributesUpdated({groupID:t,groupAttributeOption:n.groupAttributeOption}),i}},{key:"_onGroupAttributesUpdated",value:function(e){var t=this,n=e.groupID,i=e.groupAttributeOption,r=i.mainSequence,o=i.isWithChangedAttributeInfo,a=i.groupAttributeList,s=void 0===a?[]:a,c=i.operationType;if(He.l("".concat(this._n,".onGroupAttributesUpdated. ")+"groupID:".concat(n," isWithChangedAttributeInfo:").concat(o," operationType:").concat(c)),!ht(c)){this._groupAttributesCopy=this._getCachedAttributes({groupID:n});var u=this._getLocalGroupAttributes(n).localMainSequence;if(1===o&&r-u==1)return this._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:r,groupAttributeList:s,operationType:c}),void this._emitGroupAttributesUpdated(n);if(this._hasLocalGroupAttributes(n)){var l=this._getLocalGroupAttributes(n).avChatRoomKey;this._getGroupAttributes({groupID:n,avChatRoomKey:l}).then((function(){t._emitGroupAttributesUpdated(n)}))}}}},{key:"initGroupAttributesCache",value:function(e){var t=e.groupID,n=e.avChatRoomKey,i=void 0===n?void 0:n;this._groupAttributesMap.set(t,{lastUpdateTime:0,localMainSequence:0,remoteMainSequence:0,attributes:new Map,avChatRoomKey:i}),He.l("".concat(this._n,".initGroupAttributesCache groupID:").concat(t," avChatRoomKey:").concat(i))}},{key:"initGroupAttributes",value:function(e){var t=this,n=e.groupID,i=e.groupAttributes,r=this._getLocalGroupAttributes(n),o=r.remoteMainSequence,a=r.avChatRoomKey,s=new $o("initGroupAttributes");return s.setMessage("groupID:".concat(n," avChatRoomKey:").concat(a," mainSequence:").concat(o)),this._groupModule.request({protocolName:Vr,requestData:{groupID:n,avChatRoomKey:a,mainSequence:o,groupAttributeList:this._transformGroupAttributes(i)}}).then((function(e){var r=e.data,o=r.mainSequence,a=_(r.groupAttributeList);return a.forEach((function(e){e.value=i[e.key]})),t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:o,groupAttributeList:a,operationType:Ba}),s.setNetworkType(t._groupModule.getNetworkType()).end(),He.l("".concat(t._n,".").concat("initGroupAttributes"," ok. groupID:").concat(n)),pa({groupAttributes:i})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];s.setError(e,i,r).end()})),va(e)}))}},{key:"setGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupAttributes"),i=e.groupID,r=e.groupAttributes,o=this._getLocalGroupAttributes(i),a=o.remoteMainSequence,s=o.avChatRoomKey,c=o.attributes,u=this._transformGroupAttributes(r);u.forEach((function(e){var t=e.key;e.sequence=0,c.has(t)&&(e.sequence=c.get(t).sequence)}));var l=new $o("setGroupAttributes");return l.setMessage("groupID:".concat(i," groupAttributes:").concat(JSON.stringify(r))),He.l("".concat(n,". groupID:").concat(i," mainSequence:").concat(a)),this._groupModule.request({protocolName:qr,requestData:{groupID:i,avChatRoomKey:s,mainSequence:a,groupAttributeList:u}}).then((function(e){var o=e.data,a=o.mainSequence,s=_(o.groupAttributeList);return s.forEach((function(e){e.value=r[e.key]})),t._refreshCachedGroupAttributes({groupID:i,remoteMainSequence:a,groupAttributeList:s,operationType:Ha}),l.setNetworkType(t._groupModule.getNetworkType()).end(),He.l("".concat(n," ok.")),pa({groupAttributes:r})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];l.setError(e,i,r).end()})),va(e)}))}},{key:"deleteGroupAttributes",value:function(e){var t=this,n=e.groupID,i=e.keyList,r=void 0===i?[]:i,o=this._getLocalGroupAttributes(n),a=o.remoteMainSequence,s=o.avChatRoomKey,c=o.attributes,u=_(c.keys()),l=Hr,d=ja,p={groupID:n,avChatRoomKey:s,mainSequence:a},h=[];r.length>0&&(u=[],l=Br,d=Ka,r.forEach((function(e){var t=0;c.has(e)&&(t=c.get(e).sequence,u.push(e)),h.push({key:e,sequence:t})})),p.groupAttributeList=h);var f=new $o("deleteGroupAttributes");return f.setMessage("groupID:".concat(n," mainSequence:").concat(a," keyList:").concat(r," protocolName:").concat(l)),this._groupModule.request({protocolName:l,requestData:p}).then((function(e){var i=e.data.mainSequence;return t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:i,groupAttributeList:h,operationType:d}),f.setNetworkType(t._groupModule.getNetworkType()).end(),He.l("".concat(t._n,".").concat("deleteGroupAttributes"," ok. groupID:").concat(n)),pa({keyList:u})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];f.setError(e,i,r).end()})),va(e)}))}},{key:"getGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupAttributes"),i=e.groupID,r=this._getLocalGroupAttributes(i),o=r.avChatRoomKey,a=r.lastUpdateTime,s=r.localMainSequence,c=r.remoteMainSequence,u=new $o("getGroupAttributes");if(u.setMessage("groupID:".concat(i," localMainSequence:").concat(s," remoteMainSequence:").concat(c," keyList:").concat(e.keyList)),Date.now()-a>=this.CACHE_EXPIRE_TIME||s<c)return this._getGroupAttributes({groupID:i,avChatRoomKey:o}).then((function(r){u.setMoreMessage("get attributes from remote. count:".concat(r.length)).setNetworkType(t._groupModule.getNetworkType()).end(),He.l("".concat(n," from remote. groupID:").concat(i));var o=t._getCachedAttributes(e);return pa({groupAttributes:o})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];u.setError(e,i,r).end()})),va(e)}));u.setMoreMessage("get attributes from cache").setNetworkType(this._groupModule.getNetworkType()).end(),He.l("".concat(n," from cache. groupID:").concat(i));var l=this._getCachedAttributes(e);return ma({groupAttributes:l})}},{key:"_getGroupAttributes",value:function(e){var n=this,i=0;return ht(e.avChatRoomKey)||(i=1),this._groupModule.request({protocolName:jr,requestData:t(t({},e),{},{groupType:i})}).then((function(t){var i=t.data,r=i.mainSequence,o=i.groupAttributeList,a=_(o);return ht(r)||n._refreshCachedGroupAttributes({groupID:e.groupID,remoteMainSequence:r,groupAttributeList:a,operationType:za}),He.l("".concat(n._n,"._getGroupAttributes ok. groupID:").concat(e.groupID)),o})).catch((function(e){return va(e)}))}},{key:"_refreshCachedGroupAttributes",value:function(e){var t=e.groupID,n=e.remoteMainSequence,i=e.groupAttributeList,r=e.operationType;if(this._hasLocalGroupAttributes(t)){var o=this._getLocalGroupAttributes(t),a=o.localMainSequence;if(r===za||n-a==1)o.remoteMainSequence=n,o.localMainSequence=n,o.lastUpdateTime=Date.now(),this._updateCachedAttributes({groupAttributes:o,groupAttributeList:i,operationType:r});else{if(a===n)return;o.remoteMainSequence=n}this._groupAttributesMap.set(t,o);var s="operationType:".concat(r," localMainSequence:").concat(a," remoteMainSequence:").concat(n);He.l("".concat(this._n,"._refreshCachedGroupAttributes. ").concat(s))}}},{key:"_getCachedAttributes",value:function(e){var t=e.groupID,n=e.keyList,i=void 0===n?[]:n,r={};if(this._hasLocalGroupAttributes(t)){var o=this._getLocalGroupAttributes(t).attributes;if(i.length>0)i.forEach((function(e){o.has(e)&&(r[e]=o.get(e).value)}));else{var a,s=E(o.keys());try{for(s.s();!(a=s.n()).done;){var c=a.value;r[c]=o.get(c).value}}catch(u){s.e(u)}finally{s.f()}}}return r}},{key:"_updateCachedAttributes",value:function(e){var t=e.groupAttributes,n=e.groupAttributeList,i=e.operationType;i!==ja?i!==Ka?(i===Ba&&t.attributes.clear(),n.forEach((function(e){var n=e.key,i=e.value,r=e.sequence;t.attributes.set(n,{value:i,sequence:r})}))):n.forEach((function(e){t.attributes.delete(e.key)})):t.attributes.clear()}},{key:"_hasLocalGroupAttributes",value:function(e){return this._groupAttributesMap.has(e)}},{key:"_getLocalGroupAttributes",value:function(e){return this._hasLocalGroupAttributes(e)||this.initGroupAttributesCache({groupID:e}),this._groupAttributesMap.get(e)}},{key:"_transformGroupAttributes",value:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({key:n,value:e[n]})})),t}},{key:"_emitGroupAttributesUpdated",value:function(e){var t=this._getCachedAttributes({groupID:e}),n=this._computeAttrChangedInfo(t),i=n.updatedKeyList,r=n.deletedKeyList;this._groupModule.emitOuterEvent(k.GROUP_ATTRIBUTES_UPDATED,{groupID:e,groupAttributes:t,updatedKeyList:i,deletedKeyList:r})}},{key:"_computeAttrChangedInfo",value:function(e){var t=this,n=[],i=[];return Object.keys(e).forEach((function(i){e[i]!==t._groupAttributesCopy[i]&&n.push(i)})),Object.keys(this._groupAttributesCopy).forEach((function(t){ht(e[t])&&i.push(t)})),this._groupAttributesCopy={},He.l("".concat(this._n,"._computeAttrChangedInfo update count:").concat(n.length,", delete count:").concat(i.length)),{updatedKeyList:n,deletedKeyList:i}}},{key:"deleteLocalGroupAttributes",value:function(e){this._hasLocalGroupAttributes(e)&&this._groupAttributesMap.delete(e)}},{key:"reset",value:function(){this._groupAttributesMap.clear(),this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4}}]),e}(),Ya="Set",$a="Increase",Ja="Decrease",Xa=function(){function e(t){i(this,e),this._groupModule=t,this._n="GroupCountersHandler",this._groupCountersMap=new Map,this.EXPIRE_TIME=3e4,this._groupModule.getInnerEmitterInstance().on(Ma,this._onCloudConfigUpdated,this)}return o(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this._groupModule.getCloudConfig("grp_counter_expire_time");ht(e)||(this.EXPIRE_TIME=Number(e))}},{key:"isGroupCountersNotice",value:function(e){var t=e.to,n=e.elements.groupCounterInfo,i=!1;return tn(n)||(this._onGroupCountersUpdated({groupID:t,groupCounterInfo:n}),i=!0),i}},{key:"_onGroupCountersUpdated",value:function(e){var t=this,n=e.groupID;e.groupCounterInfo.forEach((function(e){var i=e.type,r=e.groupCounterSeq,o=e.counterList,a=void 0===o?[]:o;0!==i&&2!==i||(t._updateLocalGroupCounters({groupID:n,groupCounterSeq:r,counterList:a}),a.forEach((function(e){t._groupModule.emitOuterEvent(k.GROUP_COUNTER_UPDATED,{groupID:n,key:e.key,value:e.value})}))),1===i&&t._deleteLocalGroupCounters({groupID:n,groupCounterSeq:r,counterList:a})})),He.l("".concat(this._n,"._onGroupCountersUpdated groupID:").concat(n))}},{key:"initGroupCountersCache",value:function(e){var t=e.groupID,n=e.avChatRoomKey;this._groupCountersMap.set(t,{lastUpdateTime:0,groupCounterSeq:0,counters:new Map,avChatRoomKey:n}),He.l("".concat(this._n,".initGroupCountersCache groupID:").concat(t," avChatRoomKey:").concat(n))}},{key:"setGroupCounters",value:function(e){var t=this;if(!this._groupModule.canIUse(H.GRP_COUNTER))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".setGroupCounters"),i=e.groupID,r=e.counters,o=this._convertObjectToList(r),a=this._getLocalGroupCounters(i).avChatRoomKey,s="groupID:".concat(i," count:").concat(o.length),c=new $o("setGroupCounters");return c.setMessage("".concat(s)),He.l("".concat(n,". ").concat(s)),this._updateGroupCounters({groupID:i,counterList:o,avChatRoomKey:a,mode:Ya}).then((function(e){return c.end(),He.l("".concat(n," ok.")),pa({counters:e})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"increaseGroupCounter",value:function(e){var t=this;if(!this._groupModule.canIUse(H.GRP_COUNTER))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".increaseGroupCounters"),i=e.groupID,r=e.key,o=e.value,a=this._getLocalGroupCounters(i).avChatRoomKey,s="groupID:".concat(i," key:").concat(r," value:").concat(o),c=new $o("increaseGroupCounter");c.setMessage("".concat(s)),He.l("".concat(n,". ").concat(s));var u=[{key:r,value:o}];return this._updateGroupCounters({groupID:i,counterList:u,avChatRoomKey:a,mode:$a}).then((function(e){return c.end(),He.l("".concat(n," ok.")),pa({counters:e})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"decreaseGroupCounter",value:function(e){var t=this;if(!this._groupModule.canIUse(H.GRP_COUNTER))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".decreaseGroupCounter"),i=e.groupID,r=e.key,o=e.value,a=this._getLocalGroupCounters(i).avChatRoomKey,s="groupID:".concat(i," key:").concat(r," value:").concat(o),c=new $o("decreaseGroupCounter");c.setMessage("".concat(s)),He.l("".concat(n,". ").concat(s));var u=[{key:r,value:o}];return this._updateGroupCounters({groupID:i,counterList:u,avChatRoomKey:a,mode:Ja}).then((function(e){return c.end(),He.l("".concat(n," ok.")),pa({counters:e})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"getGroupCounters",value:function(e){var t=this;if(!this._groupModule.canIUse(H.GRP_COUNTER))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".getGroupCounters"),i=e.groupID,r=e.keyList,o=void 0===r?[]:r,a=this._getLocalGroupCounters(i),s=a.avChatRoomKey,c=a.lastUpdateTime,u=new $o("getGroupCounters");if(u.setMessage("groupID:".concat(i)),Date.now()-c>=this.EXPIRE_TIME)return this._getRemoteGroupCounters({groupID:i,avChatRoomKey:s}).then((function(e){u.setMoreMessage("from remote. count:".concat(e.length)).end(),He.l("".concat(n," from remote. groupID:").concat(i));var r=t._getLocalCounters(i,o);return pa({counters:r})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];u.setError(e,i,r).end()})),va(e)}));u.setMoreMessage("from cache").end(),He.l("".concat(n," from cache. groupID:").concat(i));var l=this._getLocalCounters(i,o);return ma({counters:l})}},{key:"_getRemoteGroupCounters",value:function(e){var n=this;return this._groupModule.request({protocolName:$r,requestData:t({},e)}).then((function(t){var i=t.data,r=i.counterList,o=void 0===r?[]:r,a=i.groupCounterSeq;return n._updateLocalGroupCounters({groupID:e.groupID,counterList:o,groupCounterSeq:a}),He.l("".concat(n._n,"._getRemoteGroupCounters ok. groupID:").concat(e.groupID)),o})).catch((function(e){return va(e)}))}},{key:"_convertObjectToList",value:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({key:n,value:e[n]})})),t}},{key:"_updateGroupCounters",value:function(e){var n="".concat(this._n,"._updateGroupCounters"),i=e.groupID,r=e.avChatRoomKey,o=e.mode;return He.l("".concat(n,". groupID:").concat(i," avChatRoomKey:").concat(r," mode:").concat(o)),this._groupModule.request({protocolName:Yr,requestData:t({},e)}).then((function(e){He.l("".concat(n," ok."));var t=e.data.counterList,i={};return(void 0===t?[]:t).forEach((function(e){var t=e.key,n=e.value;i[t]=n})),i})).catch((function(e){return va(e)}))}},{key:"_hasLocalGroupCounters",value:function(e){return this._groupCountersMap.has(e)}},{key:"_getLocalGroupCounters",value:function(e){return this._hasLocalGroupCounters(e)||this.initGroupCountersCache({groupID:e}),this._groupCountersMap.get(e)}},{key:"_updateLocalGroupCounters",value:function(e){var t=e.groupID,n=e.counterList,i=void 0===n?[]:n,r=e.groupCounterSeq;if(this._hasLocalGroupCounters(t)){var o=this._getLocalGroupCounters(t),a=o.counters,s=o.avChatRoomKey,c=o.groupCounterSeq;if(r>0&&r<c)return;i.forEach((function(e){var t=e.key,n=e.value;a.set(t,n)})),this._groupCountersMap.set(t,{lastUpdateTime:Date.now(),groupCounterSeq:r,counters:a,avChatRoomKey:s})}}},{key:"_deleteLocalGroupCounters",value:function(e){var t=e.groupID,n=e.counterList,i=void 0===n?[]:n,r=e.groupCounterSeq;if(this._hasLocalGroupCounters(t)){var o=this._getLocalGroupCounters(t),a=o.counters,s=o.avChatRoomKey;i.forEach((function(e){a.delete(e.key)})),this._groupCountersMap.set(t,{lastUpdateTime:Date.now(),groupCounterSeq:r,counters:a,avChatRoomKey:s})}}},{key:"_getLocalCounters",value:function(e,t){var n={};if(!this._hasLocalGroupCounters(e))return n;var i=this._getLocalGroupCounters(e).counters;if(t.length>0)t.forEach((function(e){i.has(e)&&(n[e]=i.get(e))}));else{var r,o=E(i.keys());try{for(o.s();!(r=o.n()).done;){var a=r.value;n[a]=i.get(a)}}catch(s){o.e(s)}finally{o.f()}}return n}},{key:"reset",value:function(){this._groupCountersMap.clear(),this.EXPIRE_TIME=3e4}}]),e}(),Za=function(){function e(t){i(this,e);var n=t.manager,r=t.groupID,o=t.onInit,a=t.onSuccess,s=t.onFail;this._n="Polling",this._manager=n,this._groupModule=n._groupModule,this._onInit=o,this._onSuccess=a,this._onFail=s,this._groupID=r,this._timeoutID=-1,this._isRunning=!1,this._protocolName=Pr}return o(e,[{key:"start",value:function(){var e=this._groupModule.isLoggedIn();e||(this._protocolName=Ur),He.l("".concat(this._n,".start pollingInterval:").concat(this._manager.getPollingInterval()," isLoggedIn:").concat(e)),this._isRunning=!0,this._request()}},{key:"isRunning",value:function(){return this._isRunning}},{key:"_request",value:function(){var e=this,t=this._onInit(this._groupID);this._groupModule.request({protocolName:this._protocolName,requestData:t}).then((function(t){e._onSuccess(e._groupID,t),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.getPollingInterval()))})).catch((function(t){e._onFail(e._groupID,t),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.MAX_POLLING_INTERVAL))}))}},{key:"stop",value:function(){He.l("".concat(this._n,".stop")),this._timeoutID>0&&(clearTimeout(this._timeoutID),this._timeoutID=-1),this._isRunning=!1}}]),e}(),Qa={3:!0,4:!0,5:!0,6:!0,17:!0},es=function(){function e(t){i(this,e),this._groupModule=t,this._n="AVChatRoomHandler",this._joinedGroupMap=new Map,this._pollingRequestInfoMap=new Map,this._pollingInstanceMap=new Map,this.sequencesLinkedList=new La(200),this.messageIDLinkedList=new La(100),this.receivedMessageCount=0,this._reportMessageStackedCount=0,this._onlineMemberCountMap=new Map,this.DEFAULT_EXPIRE_TIME=60,this.DEFAULT_POLLING_INTERVAL=300,this.MAX_POLLING_INTERVAL=2e3,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0,this._startBroadcastSeq=1,this._broadcastMessageIDMap=new Map,this.DEFAULT_POLLING_SIMPLIFIED_MSG=0}return o(e,[{key:"hasJoinedAVChatRoom",value:function(){return this._joinedGroupMap.size>0}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._joinedGroupMap.has(e)}},{key:"getJoinedAVChatRoom",value:function(){return this._joinedGroupMap.size>0?_(this._joinedGroupMap.keys()):null}},{key:"_updateRequestData",value:function(e){var n=this._pollingRequestInfoMap.get(e);return e===_(this._pollingInstanceMap.keys())[0]?t(t({},n),{},{startBroadcastSeq:this._startBroadcastSeq,simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG}):t(t({},n),{},{simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG})}},{key:"_handleSuccess",value:function(e,t){var n=t.data,i=n.key,r=n.nextSeq,o=n.rspMsgList,a=n.errorCode,s=n.nextBroadcastSeq,c=n.broadcastMessageList;if(0!==a){var u=this._pollingRequestInfoMap.get(e),l=new $o("longPollingAVError"),d=u?"".concat(u.key,"-").concat(u.startSeq):"requestInfo is undefined";l.setMessage("".concat(e,"-").concat(d,"-").concat(t.errorInfo)).setCode(t.errorCode).setNetworkType(this._groupModule.getNetworkType()).end(!0)}else{if(!this.checkJoinedAVChatRoomByID(e))return;ut(i)&&ct(r)&&this._pollingRequestInfoMap.set(e,{key:i,startSeq:r}),ct(s)&&s>this._startBroadcastSeq&&(this._startBroadcastSeq=s),pt(o)&&o.length>0?(o.forEach((function(e){e.to=e.groupID})),this.onMessage(o)):(this._pollingNoMessageCount+=1,this._pollingNoMessageCount===this.DEFAULT_POLLING_NO_MESSAGE_COUNT&&(this._pollingInterval=this.DEFAULT_POLLING_INTERVAL+this.DEFAULT_POLLING_INTERVAL_PLUS)),this._onBroadcastMessage(c)}}},{key:"_handleFailure",value:function(e,t){}},{key:"onMessage",value:function(e){if(pt(e)&&0!==e.length){0!==this._pollingNoMessageCount&&(this._pollingNoMessageCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL);var t=null,n=[],i=this._getModule(zn),r=this._getModule(si),o=e.length;o>1&&e.sort((function(e,t){return e.sequence-t.sequence}));for(var a=this._getModule(Wn),s=0;s<o;s++){var c=this.restoreMessageFromSimplified(e[s]);if(Qa[c.event]){if(6===c.event){if(this._groupModule.isGroupAttributesUpdatedNotice(c))continue;if(this._groupModule.isGroupCountersNotice(c))continue}this.receivedMessageCount+=1,t=this.packMessage(c,c.event);var u=1===c.isModified,l=1===c.isHistoryMessage;if((a.isUnlimitedAVChatRoom()||!this.sequencesLinkedList.has(t.sequence))&&!this.messageIDLinkedList.has(t.ID)){var d=t.conversationID;if(this.receivedMessageCount%50==0?this._getModule(ii).detectFirstRound(d,this.sequencesLinkedList.data()):this.receivedMessageCount%80==0&&this._getModule(ii).detectSecondRound(d,this.sequencesLinkedList.data()),null!==this.sequencesLinkedList.tail()){var p=this.sequencesLinkedList.tail().value,h=t.sequence-p;h>1&&h<=20?this._getModule(ii).onMessageMaybeLost(d,p+1,h-1):h<-1&&h>=-20&&this._getModule(ii).onMessageMaybeLost(d,t.sequence+1,Math.abs(h)-1)}this.sequencesLinkedList.set(t.sequence),this.messageIDLinkedList.set(t.ID);var f=!1;if(this._isMessageSentByCurrentInstance(t)?u&&(f=!0,t.isModified=u,i.updateMessageIsModifiedProperty(t)):f=!0,f){if(t.conversationType===b.CONV_SYSTEM&&5===t.payload.operationType&&this._onGroupDismissed(t.payload.groupProfile.groupID),!l&&t.conversationType!==b.CONV_SYSTEM){var g=t.conversationID.replace(b.CONV_GROUP,"");this._pollingInstanceMap.has(g)?this._groupModule.isLoggedIn()&&r.addMessageSequence({key:jo,message:t}):(t.type!==b.MSG_GRP_TIP&&t.clientTime>0&&r.addMessageDelay(t.clientTime),r.addMessageSequence({key:Ho,message:t}))}n.push(t)}}}else He.w("".concat(this._n,".onMessage unknown event:").concat(c.event))}if(0!==n.length){this._groupModule.filterModifiedMessage(n);var m=this.packConversationOption(n);m.length>0&&this._getModule(zn).onNewMessage({conversationOptionsList:m,isInstantMessage:!0}),He.d("".concat(this._n,".onMessage count:").concat(n.length)),this._checkMessageStacked(n);var v=this._groupModule.filterUnmodifiedMessage(n);v.length>0&&this._groupModule.emitOuterEvent(k.MESSAGE_RECEIVED,v),n.length=0}}}},{key:"isBroadcastOrNormal",value:function(e){return 3===e||17===e}},{key:"isGroupTip",value:function(e){return 4===e||6===e}},{key:"isGroupSystemNotice",value:function(e){return 5===e}},{key:"restoreGroupTipElements",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.groupJoinType||(e.groupJoinType=1);var t=e.operatorInfo,n=void 0===t?{}:t,i=e.operatorID,r=e.userIDList,o=void 0===r?[]:r,a=n.userID,s=void 0===a?i:a,c=n.avatar,u=void 0===c?"":c,l=n.nick,d=void 0===l?"":l;e.operatorInfo={userID:s,avatar:u,nick:d};var p=o.map((function(e){return{userID:e}}));return e.memberInfoList=e.memberInfoList||p,e}},{key:"restoreMessageFromSimplified",value:function(e){var n=e.event;if(this.isBroadcastOrNormal(n)&&(e.cloudCustomData=e.cloudCustomData||"",e.elements=e.elements.map((function(e){if(e.type===b.MSG_CUSTOM){var n=e.content,i=void 0===n?{}:n;e.content=t({data:"",description:"",extension:""},i)}return e}))),(this.isGroupTip(n)||this.isGroupSystemNotice(n))&&(e.from=e.from||"@TIM#SYSTEM"),this.isGroupTip(n)){e.elements=this.restoreGroupTipElements(e.elements);var i=e.elements,r=void 0===i?{}:i,o=r.operationType,s=r.operatorInfo;if(1===o){var c=[{userID:(void 0===s?{}:s).userID}];r.memberInfoList=r.memberInfoList||c}}if(this.isGroupSystemNotice(n)){var u=e.elements,l=u.memberInfoList,d=u.operatorInfo;l||(l=void 0===d?{}:d),e.elements.memberInfoList=t({userID:e.elements.operatorID,avatar:"",nick:""},l),e.elements=t({authentication:"",remarkInfo:"",messageKey:1e3*e.time},e.elements);var p=Object.keys(e.elements).filter((function(e){return"operatorInfo"!==e})).reduce((function(n,i){return t(t({},n),{},a({},i,e.elements[i]))}),{});e.elements=p}return e}},{key:"_onGroupDismissed",value:function(e){He.l("".concat(this._n,"._onGroupDismissed groupID:").concat(e)),this._groupModule.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"_checkMessageStacked",value:function(e){var t="MessageStacked",n=e.length;n>=100&&(this._groupModule.outputWarning(t),this._reportMessageStackedCount<5&&(new $o(t).setNetworkType(this._groupModule.getNetworkType()).setMessage("count:".concat(n," groupID:").concat(_(this._joinedGroupMap.keys()))).setLevel("warning").end(),this._reportMessageStackedCount+=1))}},{key:"_isMessageSentByCurrentInstance",value:function(e){return!!this._getModule(zn).isMessageSentByCurrentInstance(e)}},{key:"packMessage",value:function(e,t){e.currentUser=this._groupModule.getMyUserID(),e.conversationType=5===t?b.CONV_SYSTEM:b.CONV_GROUP,e.isSystemMessage=!!e.isSystemMessage;var n=new da(e),i=this.packElements(e,t);return n.setElement(i,this._groupModule.getFileDownloadProxy()),n}},{key:"packElements",value:function(e,n){return 4===n||6===n?(this._updateMemberCountByGroupTips(e),{type:b.MSG_GRP_TIP,content:t(t({},e.elements),{},{groupProfile:e.groupProfile})}):5===n?{type:b.MSG_GRP_SYS_NOTICE,content:t(t({},e.elements),{},{groupProfile:t(t({},e.groupProfile),{},{groupID:e.groupID})})}:this._getModule(Xn).parseElements(e.elements,e.from)}},{key:"packConversationOption",value:function(e){for(var t=new Map,n=0;n<e.length;n++){var i=e[n],r=i.conversationID;if(t.has(r)){var o=t.get(r);o.lastMessage=i,"in"===i.flow&&o.unreadCount++}else t.set(r,{conversationID:i.conversationID,unreadCount:"out"===i.flow?0:1,type:i.conversationType,subType:i.conversationSubType,lastMessage:i})}return _(t.values())}},{key:"_updateMemberCountByGroupTips",value:function(e){var t=e.groupProfile.groupID,n=e.elements.onlineMemberInfo,i=void 0===n?void 0:n;if(!tn(i)){var r=i.onlineMemberNum,o=void 0===r?0:r,a=i.expireTime,s=void 0===a?this.DEFAULT_EXPIRE_TIME:a,c=this._onlineMemberCountMap.get(t)||{},u=Date.now();tn(c)?Object.assign(c,{lastReqTime:0,lastSyncTime:0,latestUpdateTime:u,memberCount:o,expireTime:s}):(c.latestUpdateTime=u,c.memberCount=o),He.d("".concat(this._n,"._updateMemberCountByGroupTips info:"),c),this._onlineMemberCountMap.set(t,c)}}},{key:"_onBroadcastMessage",value:function(e){if(!tn(e)){for(var t=[],n=e.length,i=null,r=0;r<n;r++){var o=this.restoreMessageFromSimplified(e[r]);Qa[o.event]?((i=this.packMessage(o,o.event)).isBroadcastMessage=!0,this._broadcastMessageIDMap.has(i.ID)||(t.push(i),this._broadcastMessageIDMap.set(i.ID,1))):He.w("".concat(this._n,"._onBroadcastMessage unknown event:").concat(o.event))}t.length>0&&this._groupModule.emitOuterEvent(k.MESSAGE_RECEIVED,t)}}},{key:"start",value:function(e){if(this._pollingInstanceMap.has(e)){var t=this._pollingInstanceMap.get(e);t.isRunning()||t.start()}else{var n=new Za({manager:this,groupID:e,onInit:this._updateRequestData.bind(this),onSuccess:this._handleSuccess.bind(this),onFail:this._handleFailure.bind(this)});n.start(),this._pollingInstanceMap.set(e,n),He.l("".concat(this._n,".start groupID:").concat(e))}}},{key:"handleJoinResult",value:function(e){var t=this;return this._preCheck().then((function(){var n=e.longPollingKey,i=e.group,r=i.groupID;return t._joinedGroupMap.set(r,i),t._groupModule.updateGroupMap([i]),t._groupModule.deleteUnjoinedAVChatRoom(r),t._groupModule.emitGroupListUpdate(!0,!1),ht(n)?ma({status:et,group:i}):Promise.resolve()}))}},{key:"startRunLoop",value:function(e){var t=this;return this.handleJoinResult(e).then((function(){var n=e.longPollingKey,i=e.group,r=e.startSeq,o=void 0===r?0:r,a=i.groupID;return t._pollingRequestInfoMap.set(a,{key:n,startSeq:o}),t.start(a),t._groupModule.isLoggedIn()?ma({status:et,group:i}):ma({status:et})}))}},{key:"_preCheck",value:function(){if(this._getModule(Wn).isUnlimitedAVChatRoom())return Promise.resolve();if(!this.hasJoinedAVChatRoom())return Promise.resolve();var e=v(this._joinedGroupMap.entries().next().value,2),t=e[0],n=e[1];if(this._groupModule.isLoggedIn()){if(n.selfInfo.role!==b.GRP_MBR_ROLE_OWNER&&n.ownerID!==this._groupModule.getMyUserID())return this._groupModule.quitGroup(t);this._groupModule.deleteLocalGroupAndConversation(t)}else this._groupModule.deleteLocalGroupAndConversation(t);return this.reset(t),Promise.resolve()}},{key:"joinWithoutAuth",value:function(e){var t=this,n=e.groupID,i="".concat(this._n,".").concat("joinWithoutAuth"),r=new $o("joinWithoutAuth");return this._groupModule.request({protocolName:_r,requestData:e}).then((function(e){var o=e.data.longPollingKey;if(t._groupModule.probeNetwork().then((function(e){var t=v(e,2);t[0];var i=t[1];r.setNetworkType(i).setMessage("groupID:".concat(n," longPollingKey:").concat(o)).end(!0)})),ht(o))return va({code:No.CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN});He.l("".concat(i," ok. groupID:").concat(n)),t._getModule(zn).setCompleted("".concat(b.CONV_GROUP).concat(n));var a=new Na({groupID:n});return t.startRunLoop({group:a,longPollingKey:o}),pa({status:et})})).catch((function(e){return He.e("".concat(i," failed. groupID:").concat(n," error:"),e),t._groupModule.probeNetwork().then((function(t){var i=v(t,2),o=i[0],a=i[1];r.setError(e,o,a).setMessage("groupID:".concat(n)).end(!0)})),va(e)})).finally((function(){t._groupModule.getModule($n).reportAtOnce()}))}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this._onlineMemberCountMap.get(e)||{},n=Date.now();return tn(t)||n-t.lastSyncTime>1e3*t.expireTime&&n-t.latestUpdateTime>1e4&&n-t.lastReqTime>3e3?(t.lastReqTime=n,this._onlineMemberCountMap.set(e,t),this._getGroupOnlineMemberCount(e).then((function(e){return pa({memberCount:e.memberCount})})).catch((function(e){return va(e)}))):ma({memberCount:t.memberCount})}},{key:"_getGroupOnlineMemberCount",value:function(e){var t=this,n="".concat(this._n,".").concat("_getGroupOnlineMemberCount");return this._groupModule.request({protocolName:xr,requestData:{groupID:e}}).then((function(i){var r=t._onlineMemberCountMap.get(e)||{},o=i.data,a=o.onlineMemberNum,s=void 0===a?0:a,c=o.expireTime,u=void 0===c?t.DEFAULT_EXPIRE_TIME:c;He.l("".concat(n," ok. groupID:").concat(e," memberCount:").concat(s," expireTime:").concat(u));var l=Date.now();return tn(r)&&(r.lastReqTime=l),t._onlineMemberCountMap.set(e,Object.assign(r,{lastSyncTime:l,latestUpdateTime:l,memberCount:s,expireTime:u})),{memberCount:s}})).catch((function(i){return He.w("".concat(n," failed. error:"),i),new $o("_getGroupOnlineMemberCount").setCode(i.code).setMessage("groupID:".concat(e," error:").concat(JSON.stringify(i))).setNetworkType(t._groupModule.getNetworkType()).end(),Promise.reject(i)}))}},{key:"_getModule",value:function(e){return this._groupModule.getModule(e)}},{key:"setPollingInterval",value:function(e){ht(e)||(ct(e)?this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=e:this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=parseInt(e,10))}},{key:"setPollingIntervalPlus",value:function(e){ht(e)||(ct(e)?this.DEFAULT_POLLING_INTERVAL_PLUS=e:this.DEFAULT_POLLING_INTERVAL_PLUS=parseInt(e,10))}},{key:"setPollingNoMessageCount",value:function(e){ht(e)||(ct(e)?this.DEFAULT_POLLING_NO_MESSAGE_COUNT=e:this.DEFAULT_POLLING_NO_MESSAGE_COUNT=parseInt(e,10))}},{key:"setPollingSimplifiedMessage",value:function(e){ht(e)||"0"!==e&&"1"!==e||(this.DEFAULT_POLLING_SIMPLIFIED_MSG=parseInt(e,10))}},{key:"getPollingInterval",value:function(){return this._pollingInterval}},{key:"onAVChatRoomMemberBanned",value:function(e){var t=e.payload.groupProfile.groupID;He.l("".concat(this._n,".onAVChatRoomMemberBanned groupID:").concat(t)),this._groupModule.deleteLocalGroupAndConversation(t),this.reset(t)}},{key:"restartPolling",value:function(){He.l("".concat(this._n,".restartPolling count:").concat(this._pollingInstanceMap.size));var e,t=E(this._pollingInstanceMap.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.stop(),n.start()}}catch(i){t.e(i)}finally{t.f()}}},{key:"reset",value:function(e){if(e){He.l("".concat(this._n,".reset groupID:").concat(e));var t=this._pollingInstanceMap.get(e);t&&t.stop(),this._pollingInstanceMap.delete(e),this._joinedGroupMap.delete(e),this._pollingRequestInfoMap.delete(e),this._onlineMemberCountMap.delete(e)}else{He.l("".concat(this._n,".reset all"));var n,i=E(this._pollingInstanceMap.values());try{for(i.s();!(n=i.n()).done;)n.value.stop()}catch(r){i.e(r)}finally{i.f()}this._pollingInstanceMap.clear(),this._joinedGroupMap.clear(),this._pollingRequestInfoMap.clear(),this._onlineMemberCountMap.clear(),this._broadcastMessageIDMap.clear()}this.sequencesLinkedList.reset(),this.messageIDLinkedList.reset(),this.receivedMessageCount=0,this._reportMessageStackedCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=300,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0}}]),e}(),ts=1,ns=15,is=function(){function e(t){i(this,e),this._groupModule=t,this._n="GroupSystemNoticeHandler",this.pendencyMap=new Map}return o(e,[{key:"onNewGroupSystemNotice",value:function(e){var t=e.dataList,n=e.isSyncingEnded,i=e.isInstantMessage;He.d("".concat(this._n,".onReceiveSystemNotice count:").concat(t.length));var r=this.newSystemNoticeStoredAndSummary({notifiesList:t,isInstantMessage:i}),o=r.eventDataList,a=r.result;o.length>0&&(this._groupModule.getModule(zn).onNewMessage({conversationOptionsList:o,isInstantMessage:i}),this._onReceivedGroupSystemNotice({result:a,isInstantMessage:i})),i?a.length>0&&this._groupModule.emitOuterEvent(k.MESSAGE_RECEIVED,a):!0===n&&this._clearGroupSystemNotice()}},{key:"newSystemNoticeStoredAndSummary",value:function(e){var n=e.notifiesList,i=e.isInstantMessage,r=null,o=n.length,a=0,s=[],c={conversationID:b.CONV_SYSTEM,unreadCount:0,type:b.CONV_SYSTEM,subType:null,lastMessage:null};for(a=0;a<o;a++){var u=n[a],l=u.groupProfile,d=l.communityType,p=void 0===d?0:d,h=l.topicID,f=void 0===h?void 0:h,g=u.elements,m=g.topicIDList,v=void 0===m?void 0:m,_=g.operationType;if(!(2!==p||tn(f)&&tn(v))){if([17,18,20].includes(_)){this._handleTopicSystemNotice(u);continue}tn(f)||(u.to=f)}u.elements.operationType!==ns&&(u.currentUser=this._groupModule.getMyUserID(),u.conversationType=b.CONV_SYSTEM,u.conversationID=b.CONV_SYSTEM,(r=new da(u)).setElement({type:b.MSG_GRP_SYS_NOTICE,content:t(t({},u.elements),{},{groupProfile:t({},u.groupProfile)})}),r.isSystemMessage=!0,(1===r.sequence&&1===r.random||2===r.sequence&&2===r.random)&&(r.sequence=Tt(),r.random=Tt(),r.generateMessageID(),He.l("".concat(this._n,".newSystemNoticeStoredAndSummary sequence and random maybe duplicated, regenerate. ID:").concat(r.ID))),this._groupModule.getModule(zn).pushIntoNoticeResult(s,r)&&(i?c.unreadCount++:r.setIsRead(!0),c.subType=r.conversationSubType))}return c.lastMessage=s[s.length-1],{eventDataList:s.length>0?[c]:[],result:s}}},{key:"_clearGroupSystemNotice",value:function(){var e=this;this._getPendencyList().then((function(t){t.forEach((function(t){e.pendencyMap.set("".concat(t.from,"_").concat(t.groupID,"_").concat(t.to),t)}));var n=e._groupModule.getModule(zn).getLocalMessageList(b.CONV_SYSTEM),i=[];n.forEach((function(t){var n=t.payload,r=n.operatorID,o=n.operationType,a=n.groupProfile;if(o===ts){var s="".concat(r,"_").concat(a.groupID,"_").concat(a.to),c=e.pendencyMap.get(s);c&&ct(c.handled)&&0!==c.handled&&i.push(t)}})),e.deleteGroupSystemNotice({messageList:i})}))}},{key:"deleteGroupSystemNotice",value:function(e){var t=this,n="".concat(this._n,".deleteGroupSystemNotice");return pt(e.messageList)&&0!==e.messageList.length?(He.l("".concat(n," ")+e.messageList.map((function(e){return e.ID}))),this._groupModule.request({protocolName:Nr,requestData:{messageListToDelete:e.messageList.map((function(e){return{from:b.CONV_SYSTEM,messageSeq:e.clientSequence,messageRandom:e.random}}))}}).then((function(){He.l("".concat(n," ok"));var i=t._groupModule.getModule(zn);return e.messageList.forEach((function(e){i.deleteLocalMessage(e)})),pa()})).catch((function(e){return He.e("".concat(n," error:"),e),va(e)}))):ma()}},{key:"_getPendencyList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.type,i=void 0===n?void 0:n,r=t.startTime,o=void 0===r?0:r,a=t.limit,s=void 0===a?20:a;return this._groupModule.request({protocolName:Or,requestData:{type:i,startTime:o,limit:s,handleAccount:this._groupModule.getMyUserID()}}).then((function(t){var n=t.data.pendencyList;return 0!==t.data.nextStartTime?e._getPendencyList({startTime:t.data.nextStartTime}).then((function(e){return[].concat(_(n),_(e))})):n}))}},{key:"getGroupApplicationList",value:function(){var e=this;return this._getPendencyList().then((function(t){return e._getPendencyList({type:b.GRP_COMMUNITY}).then((function(n){return t.push.apply(t,_(n)),e._handlePendencyResult(t)})).catch((function(n){return e._handlePendencyResult(t)}))}))}},{key:"_handlePendencyResult",value:function(e){var t=this,n=[];return e.forEach((function(e){t.pendencyMap.set("".concat(e.from,"_").concat(e.groupID,"_").concat(e.to),e),0===e.handled&&n.push({applicant:e.from,applicantNick:e.fromUserNickName,groupName:e.groupName,groupID:e.groupID,authentication:e.authentication,messageKey:e.time,applicationType:e.applicationType,userID:e.userID})})),ma({applicationList:n})}},{key:"_onReceivedGroupSystemNotice",value:function(e){var t=this,n=e.result;e.isInstantMessage&&n.forEach((function(e){switch(e.payload.operationType){case 1:case 3:case 6:case 11:case 12:case 15:break;case 2:t._onApplyGroupRequestAgreed(e);break;case 4:t._onMemberKicked(e);break;case 5:t._onGroupDismissed(e);break;case 7:t._onInviteGroup(e);break;case 8:t._onQuitGroup(e);break;case 9:t._onSetManager(e);break;case 10:t._onDeleteManager(e);break;case 20:t._onMessageRemindTypeSynced(e);break;case 21:t._groupModule.onAVChatRoomMemberBanned(e)}}))}},{key:"_onApplyGroupRequestAgreed",value:function(e){var t=this,n=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(n)||this._groupModule.getGroupProfile({groupID:n}).then((function(e){var n=e.data.group;if(n){t._groupModule.updateGroupMap([n]);var i=!n.isSupportTopic;t._groupModule.emitGroupListUpdate(!0,i)}}))}},{key:"_onMemberKicked",value:function(e){var t=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(t)&&this._groupModule.deleteLocalGroupAndConversation(t)}},{key:"_onGroupDismissed",value:function(e){var t=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(t)&&this._groupModule.deleteLocalGroupAndConversation(t);var n=this._groupModule._AVChatRoomHandler;n&&n.checkJoinedAVChatRoomByID(t)&&n.reset(t)}},{key:"_onInviteGroup",value:function(e){var t=this,n=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(n)||this._groupModule.getGroupProfile({groupID:n}).then((function(e){var n=e.data.group;n&&(t._groupModule.updateGroupMap([n]),t._groupModule.emitGroupListUpdate())}))}},{key:"_onQuitGroup",value:function(e){var t=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(t)&&this._groupModule.deleteLocalGroupAndConversation(t)}},{key:"_onSetManager",value:function(e){var t=e.payload.groupProfile,n=t.to,i=t.groupID,r=this._groupModule.getModule(jn).getLocalGroupMemberInfo(i,n);r&&r.updateRole(b.GRP_MBR_ROLE_ADMIN)}},{key:"_onDeleteManager",value:function(e){var t=e.payload.groupProfile,n=t.to,i=t.groupID,r=this._groupModule.getModule(jn).getLocalGroupMemberInfo(i,n);r&&r.updateRole(b.GRP_MBR_ROLE_MEMBER)}},{key:"_onMessageRemindTypeSynced",value:function(e){var t=e.payload.groupProfile.groupID,n=e.payload.messageRemindType;this._groupModule.getModule(zn).onGroupMessageRemindTypeSynced({groupID:t,messageRemindType:n})}},{key:"_handleTopicSystemNotice",value:function(e){var t=e.groupProfile,n=t.groupID,i=t.topicID,r=e.elements,o=r.operationType,a=r.topicIDList,s=r.messageRemindType,c=this._groupModule.getModule(Kn);17===o?c.onTopicCreated({groupID:n,topicID:i}):18===o?c.onTopicDeleted({groupID:n,topicIDList:a}):20===o&&c.onTopicMessageRemindTypeUpdated({groupID:n,topicID:i,messageRemindType:s})}},{key:"reset",value:function(){this.pendencyMap.clear()}}]),e}(),rs=["relayFlag"],os=function(e){s(r,e);var n=m(r);function r(e){var t;return i(this,r),(t=n.call(this,e))._n="GroupModule",t._commonGroupHandler=null,t._AVChatRoomHandler=null,t._groupSystemNoticeHandler=null,t._commonGroupHandler=new qa(f(t)),t._groupAttributesHandler=new Wa(f(t)),t._groupCountersHandler=new Xa(f(t)),t._AVChatRoomHandler=new es(f(t)),t._groupTipsHandler=new Va(f(t)),t._groupSystemNoticeHandler=new is(f(t)),t.groupMap=new Map,t._unjoinedAVChatRoomList=new Map,t._receiptDetailCompleteMap=new Map,t.getInnerEmitterInstance().on(Ma,t._onCloudConfigUpdated,f(t)),t}return o(r,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("polling_interval"),t=this.getCloudConfig("polling_interval_plus"),n=this.getCloudConfig("polling_no_msg_count"),i=this.getCloudConfig("polling_simplified_msg");this._AVChatRoomHandler&&(He.l("".concat(this._n,"._onCloudConfigUpdated pollingInterval:").concat(e)+" pollingIntervalPlus:".concat(t," pollingNoMessageCount:").concat(n)+" pollingSimplifiedMessage:".concat(i)),this._AVChatRoomHandler.setPollingInterval(e),this._AVChatRoomHandler.setPollingIntervalPlus(t),this._AVChatRoomHandler.setPollingNoMessageCount(n),this._AVChatRoomHandler.setPollingSimplifiedMessage(i))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&(this._commonGroupHandler.onCheckTimer(e),this._groupTipsHandler.onCheckTimer(e))}},{key:"guardForAVChatRoom",value:function(e){var t=this;if(e.conversationType===b.CONV_GROUP){var n=Lt(e.to)?Wt(e.to):e.to;return this.hasLocalGroup(n)?ma():this.getGroupProfile({groupID:n}).then((function(i){var r=i.data.group.type;if(He.l("".concat(t._n,".guardForAVChatRoom. groupID:").concat(n," type:").concat(r)),r===b.GRP_AVCHATROOM){var o=No.MESSAGE_SEND_FAIL_NOT_IN_AVCHATROOM;return va(new ha({code:o,message:t.getErrorMessage(o,e.from,n),data:{message:e}}))}return ma()}))}return ma()}},{key:"checkJoinedAVChatRoomByID",value:function(e){return!!this._AVChatRoomHandler&&this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"onNewGroupMessage",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.onNewGroupMessage(e)}},{key:"updateNextMessageSeq",value:function(e){var t=this;if(pt(e)){var n=this.getModule(Kn);e.forEach((function(e){var i=e.conversationID.replace(b.CONV_GROUP,"");Lt(i)&&n.updateLastMessage(i,e.lastMessage),t.groupMap.has(i)&&(t.groupMap.get(i).nextMessageSeq=e.lastMessage.sequence+1)}))}}},{key:"onNewGroupTips",value:function(e){this._groupTipsHandler&&this._groupTipsHandler.onNewGroupTips(e)}},{key:"onGroupMessageRevoked",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.onGroupMessageRevoked(e)}},{key:"onNewGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler&&this._groupSystemNoticeHandler.onNewGroupSystemNotice(e)}},{key:"onGroupMessageReadNotice",value:function(e){var t=this;e.dataList.forEach((function(e){var n=e.elements.groupMessageReadNotice;if(!ht(n)){var i=t.getModule(zn);n.forEach((function(e){var n=e.groupID,r=e.topicID,o=void 0===r?void 0:r,a=e.lastMessageSeq;He.d("".concat(t._n,".onGroupMessageReadNotice groupID:").concat(n," lastMessageSeq:").concat(a));var s="".concat(b.CONV_GROUP).concat(n),c=!0;tn(o)||(s="".concat(b.CONV_GROUP).concat(o),c=!1),i.updateIsReadAfterReadReport({conversationID:s,lastMessageSeq:a}),i.updateUnreadCount(s,c),i.clearGroupAtInfoList(s,c)}))}}))}},{key:"onReadReceiptList",value:function(e){var t=this;He.d("".concat(this._n,".onReadReceiptList options:"),JSON.stringify(e)),e.dataList.forEach((function(e){var n=e.groupProfile,i=e.elements,r=n.groupID,o=t.getModule(zn),a=i.readReceiptList;o.updateReadReceiptInfo({groupID:r,readReceiptList:a})}))}},{key:"onGroupMessageModified",value:function(e){He.d("".concat(this._n,".onGroupMessageModified options:"),JSON.stringify(e));var n=this.getModule(zn);e.dataList.forEach((function(e){n.onMessageModified(t(t({},e),{},{conversationType:b.CONV_GROUP,to:e.topicID?e.topicID:e.groupID}))}))}},{key:"deleteGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler&&this._groupSystemNoticeHandler.deleteGroupSystemNotice(e)}},{key:"initGroupMap",value:function(e){this.groupMap.set(e.groupID,new Na(e))}},{key:"deleteGroup",value:function(e){this.groupMap.delete(e)}},{key:"updateGroupMap",value:function(e){var t,n=this,i=this.getModule(zn);e.forEach((function(e){t=e.groupID,n.groupMap.has(t)?n.groupMap.get(t).updateGroup(e):(n.groupMap.set(t,new Na(e)),i.deleteGroupRomaingMessageInfo(t))}));var r,o=this.getMyUserID(),a=E(this.groupMap);try{for(a.s();!(r=a.n()).done;){var s=v(r.value,2)[1];s.selfInfo.userID=o,"Owner"===s.selfInfo.role&&(s.ownerID=o)}}catch(c){a.e(c)}finally{a.f()}this._setStorageGroupList()}},{key:"getStorageGroupList",value:function(){return this.getModule(Yn).getItem("groupMap")}},{key:"_setStorageGroupList",value:function(){var e=this.getLocalGroupList().filter((function(e){var t=e.type;return!At(t)})).filter((function(e){return!e.isSupportTopic})).slice(0,20).map((function(e){return{groupID:e.groupID,name:e.name,avatar:e.avatar,type:e.type}}));this.getModule(Yn).setItem("groupMap",e)}},{key:"getGroupMap",value:function(){return this.groupMap}},{key:"getLocalGroupList",value:function(){return _(this.groupMap.values())}},{key:"getLocalGroupProfile",value:function(e){return this.groupMap.get(e)}},{key:"sortLocalGroupList",value:function(){var e=_(this.groupMap).filter((function(e){var t=v(e,2);return t[0],!tn(t[1].lastMessage)}));e.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})),this.groupMap=new Map(_(e))}},{key:"updateGroupLastMessage",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.handleUpdateGroupLastMessage(e)}},{key:"emitGroupListUpdate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalGroupList();if(e&&this.emitOuterEvent(k.GROUP_LIST_UPDATED),t){var i=JSON.parse(JSON.stringify(n));this.getModule(zn).updateConversationGroupProfile(i)}}},{key:"patchGroupMessageRemindType",value:function(){var e=this.getLocalGroupList(),t=this.getModule(zn),n=0;e.forEach((function(e){!0===t.patchMessageRemindType({ID:e.groupID,isC2CConversation:!1,messageRemindType:e.selfInfo.messageRemindType})&&(n+=1)})),He.l("".concat(this._n,".patchGroupMessageRemindType count:").concat(n))}},{key:"recomputeUnreadCount",value:function(){var e=this.getLocalGroupList(),t=this.getModule(zn);e.forEach((function(e){var n=e.groupID,i=e.selfInfo,r=i.excludedUnreadSequenceList,o=i.readedSequence;if(pt(r)){var a=0;r.forEach((function(t){t>=o&&t<=e.nextMessageSeq-1&&(a+=1)})),a>=1&&t.recomputeGroupUnreadCount({conversationID:"".concat(b.CONV_GROUP).concat(n),count:a})}}))}},{key:"getMyNameCardByGroupID",value:function(e){var t=this.getLocalGroupProfile(e);return t?t.selfInfo.nameCard:""}},{key:"isPagingGetCompleted",value:function(){return!!this._commonGroupHandler&&this._commonGroupHandler.isPagingGetCompleted()}},{key:"getGroupList",value:function(e){return this._commonGroupHandler?this._commonGroupHandler.getGroupList(e):ma()}},{key:"getGroupProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupProfile"),i=new $o("getGroupProfile"),r=e.groupID,o=e.groupCustomFieldFilter;He.l("".concat(n," groupID:").concat(r));var a={groupIDList:[r],responseFilter:{groupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember","InviteJoinOption"],groupCustomFieldFilter:o,memberInfoFilter:["Role","JoinTime","MsgSeq","MsgFlag","NameCard"]}};return this.getGroupProfileAdvance(a).then((function(e){var o,a=e.data,s=a.successGroupList,c=a.failureGroupList;return He.l("".concat(n," ok")),c.length>0?va(c[0]):(At(s[0].type)&&!t.hasLocalGroup(r)?o=new Na(s[0]):(t.updateGroupMap(s),o=t.getLocalGroupProfile(r)),o.isSupportTopic||t.getModule(zn).updateConversationGroupProfile([o]),i.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(r," type:").concat(o.type," muteAllMembers:").concat(o.muteAllMembers," ownerID:").concat(o.ownerID)).end(),pa({group:o}))})).catch((function(r){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],a=n[1];i.setError(r,o,a).setMessage("groupID:".concat(e.groupID)).end()})),He.e("".concat(n," failed. error:"),r),va(r)}))}},{key:"getGroupProfileAdvance",value:function(e){var n="".concat(this._n,".getGroupProfileAdvance"),i=e.groupIDList;pt(i)&&i.length>50&&(this.outputWarning("GetGroupProfileLimit"),i.length=50);var r=[],o=[];i.forEach((function(e){Rt({groupID:e})?o.push(e):r.push(e)}));var a=[];if(r.length>0){var s=this._getGroupProfileAdvance(t(t({},e),{},{groupIDList:r}));a.push(s)}if(o.length>0){var c=this._getGroupProfileAdvance(t(t({},e),{},{groupIDList:o,relayFlag:r.length>0}));a.push(c)}return Promise.all(a).then((function(e){var t=[],n=[];return e.forEach((function(e){t.push.apply(t,_(e.successGroupList)),n.push.apply(n,_(e.failureGroupList))})),pa({successGroupList:t,failureGroupList:n})})).catch((function(e){return He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"_getGroupProfileAdvance",value:function(e){var t=this,n=e.relayFlag,i=void 0!==n&&n,r=h(e,rs);return this.request({protocolName:hr,requestData:r}).then((function(e){He.l("".concat(t._n,"._getGroupProfileAdvance ok."));var n=e.data.groups;return{successGroupList:n.filter((function(e){return ht(e.errorCode)||0===e.errorCode})),failureGroupList:n.filter((function(e){return e.errorCode&&0!==e.errorCode})).map((function(e){return new ha({code:e.errorCode,message:e.errorInfo,data:{groupID:e.groupID}})}))}})).catch((function(t){return i&&Rt({groupID:e.groupIDList[0]})?{successGroupList:[],failureGroupList:[]}:va(t)}))}},{key:"createGroup",value:function(e){var n=this,i="".concat(this._n,".").concat("createGroup"),r=e.type,o=e.groupID;if(e.name&&!1===this._filterProfanity("name",e))return va({code:No.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return va({code:No.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return va({code:No.PROFANITY_FOUND});if(!["Public","Private","ChatRoom","AVChatRoom","Community"].includes(r))return va({code:No.ILLEGAL_GROUP_TYPE});if(!Rt({type:r})){if(!tn(o)&&Rt({groupID:o}))return va({code:No.ILLEGAL_GROUP_ID});e.isSupportTopic=void 0}if(At(r)&&!ht(e.memberList)&&e.memberList.length>0&&(e.memberList=void 0),this._canIUseJoinOption(r)||ht(e.joinOption)||(e.joinOption=void 0),Rt({type:r})){if(!tn(o)&&!Rt({groupID:o}))return va({code:No.ILLEGAL_GROUP_ID});e.isSupportTopic=!0===e.isSupportTopic?1:0}var a=new $o("createGroup");He.l("".concat(i," options:"),e);var s=null,c=[];return this.request({protocolName:fr,requestData:t(t({},e),{},{ownerID:this.getMyUserID(),webPushFlag:1})}).then((function(r){var o=r.data,u=o.groupID,l=o.overLimitUserIDList,d=void 0===l?[]:l;if(s=u,c=d,a.setNetworkType(n.getNetworkType()).setMessage("groupType:".concat(e.type," groupID:").concat(u," overLimitUserIDList=").concat(d)).end(),He.l("".concat(i," ok groupID:").concat(u," overLimitUserIDList:"),d),e.type===b.GRP_AVCHATROOM)return n.getGroupProfile({groupID:u});if(e.type===b.GRP_COMMUNITY&&1===e.isSupportTopic)return n.getGroupProfile({groupID:u});tn(e.memberList)||tn(d)||(e.memberList=e.memberList.filter((function(e){return-1===d.indexOf(e.userID)}))),n.updateGroupMap([t(t({},e),{},{groupID:u})]);var p=n.getModule(Gn),h=p.createCustomMessage({to:u,conversationType:b.CONV_GROUP,payload:{data:"group_create",extension:n.isIntl()?"".concat(n.getMyUserID()," created a group"):"".concat(n.getMyUserID(),"创建群组")}});return p.sendMessageInstance(h),n.emitGroupListUpdate(),n.getGroupProfile({groupID:u})})).then((function(e){var t=e.data.group,n=t.selfInfo,i=n.nameCard,r=n.joinTime;return t.updateSelfInfo({nameCard:i,joinTime:r,messageRemindType:b.MSG_REMIND_ACPT_AND_NOTE,role:b.GRP_MBR_ROLE_OWNER}),pa({group:t,overLimitUserIDList:c})})).catch((function(r){if(a.setMessage("groupType:".concat(e.type)),n.probeNetwork().then((function(e){var t=v(e,2),n=t[0],i=t[1];a.setError(r,n,i).end()})),10010===r.code||10007===r.code){n.updateGroupMap([t(t({},e),{},{groupID:s})]);var o=n.getLocalGroupProfile(s);return He.l("".concat(i," success, but failed to get group profile.")),pa({group:o,overLimitUserIDList:c})}return He.e("".concat(i," failed. error:"),r),va(r)}))}},{key:"dismissGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("dismissGroup");if(this.hasLocalGroup(e)&&this.getLocalGroupProfile(e).type===b.GRP_WORK)return va(new ha({code:No.CANNOT_DISMISS_WORK}));var i=new $o("dismissGroup");return i.setMessage("groupID:".concat(e)),He.l("".concat(n," groupID:").concat(e)),this.request({protocolName:gr,requestData:{groupID:e}}).then((function(){return i.setNetworkType(t.getNetworkType()).end(),He.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),t.checkJoinedAVChatRoomByID(e)&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),pa({groupID:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"updateGroupProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateGroupProfile");if(this.hasLocalGroup(e.groupID)){var i=this.getLocalGroupProfile(e.groupID).type;this._canIUseJoinOption(i)||ht(e.joinOption)||(He.w("".concat(n," joinOption is unavailable for Work/Meeting/AVChatRoom")),e.joinOption=void 0)}if(ht(e.muteAllMembers)||(e.muteAllMembers?e.muteAllMembers="On":e.muteAllMembers="Off"),e.name&&!1===this._filterProfanity("name",e))return va({code:No.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return va({code:No.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return va({code:No.PROFANITY_FOUND});var r=new $o("updateGroupProfile");return r.setMessage(JSON.stringify(e)),He.l("".concat(n," groupID:").concat(e.groupID)),this.request({protocolName:mr,requestData:e}).then((function(){return r.setNetworkType(t.getNetworkType()).end(),He.l("".concat(n," ok")),t.hasLocalGroup(e.groupID)&&(t.groupMap.get(e.groupID).updateGroup(e),t._setStorageGroupList()),pa({group:t.groupMap.get(e.groupID)})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),He.l("".concat(n," failed. error:"),e),va(e)}))}},{key:"_filterProfanity",value:function(e,t){var n=this.getModule(li);if(!n)return!0;var i=n.filterText(t[e],J),r=i.isAllowedToSend,o=i.modifiedText;return!0===r&&(t[e]=o,!0)}},{key:"joinGroup",value:function(e){var t=this,n=e.groupID,i=e.type,r="".concat(this._n,".joinGroup");if(i===b.GRP_WORK)return va({code:No.CANNOT_JOIN_WORK});if(this.deleteUnjoinedAVChatRoom(n),this.hasLocalGroup(n)){if(!this.isLoggedIn())return ma({status:b.JOIN_STATUS_ALREADY_IN_GROUP});var o=new $o("applyJoinGroup");return this.getGroupProfile({groupID:n}).then((function(){return o.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(n," joinedStatus:").concat(b.JOIN_STATUS_ALREADY_IN_GROUP)).end(),ma({status:b.JOIN_STATUS_ALREADY_IN_GROUP})})).catch((function(i){return o.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(n," unjoined")).end(),He.w("".concat(r," ").concat(n," was unjoined, now join!")),t.groupMap.delete(n),t.applyJoinGroup(e)}))}return He.l("".concat(r," groupID:").concat(n)),this.isLoggedIn()?this.applyJoinGroup(e):this._AVChatRoomHandler.joinWithoutAuth(e)}},{key:"applyJoinGroup",value:function(e){var n=this,i="".concat(this._n,".").concat("applyJoinGroup"),r=e.groupID;if(!tn(e.applyMessage)&&!1===this._filterProfanity("applyMessage",e))return va({code:No.PROFANITY_FOUND});var o=new $o("applyJoinGroup"),a=t({},e),s=this.canIUse(H.AVCHATROOM_HISTORY_MSG);return s&&(a.historyMessageFlag=1),this.getModule(zn).deleteTopicRoamingMessageInfo(r),this.request({protocolName:vr,requestData:a}).then((function(e){var t=e.data,a=t.joinedStatus,c=t.longPollingKey,u=t.startSeq,l=t.avChatRoomFlag,d=t.avChatRoomKey,p=t.messageList,h="groupID:".concat(r," joinedStatus:").concat(a," longPollingKey:").concat(c," startSeq:").concat(u)+" avChatRoomFlag:".concat(l," canGetAVChatRoomHistoryMessage:").concat(s,",")+" history message count:".concat(tn(p)?0:p.length);switch(o.setNetworkType(n.getNetworkType()).setMessage("".concat(h)).end(),He.l("".concat(i," ok. ").concat(h)),a){case nt:return pa({status:nt});case et:return n.getGroupProfile({groupID:r}).then((function(e){var t=e.data.group;return n._handleJoinResult({group:t,avChatRoomFlag:l,longPollingKey:c,startSeq:u,avChatRoomKey:d,messageList:p})})).catch((function(){var e=new Na({groupID:r});return n._handleJoinResult({group:e,avChatRoomFlag:l,longPollingKey:c,startSeq:u,avChatRoomKey:d,messageList:p})}));default:var f=new ha({code:No.JOIN_GROUP_FAIL});return He.e("".concat(i," failed. error:"),f),va(f)}})).catch((function(e){return o.setMessage("groupID:".concat(r)),n.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),He.e("".concat(i," failed. error:"),e),va(e)}))}},{key:"_handleJoinResult",value:function(e){var t,n=this,i=e.group,r=e.avChatRoomFlag,o=e.longPollingKey,a=e.startSeq,s=e.avChatRoomKey,c=e.messageList,u=i.groupID;return 1===r?(this.getModule(zn).setCompleted("".concat(b.CONV_GROUP).concat(u)),this._groupAttributesHandler.initGroupAttributesCache({groupID:u,avChatRoomKey:s}),this._groupCountersHandler.initGroupCountersCache({groupID:u,avChatRoomKey:s}),(t=ht(o)?this._AVChatRoomHandler.handleJoinResult({group:i}):this._AVChatRoomHandler.startRunLoop({group:i,longPollingKey:o,startSeq:a})).then((function(){n._onAVChatRoomHistoryMessage(c)})),t):(this.emitGroupListUpdate(!0,!1),pa({status:et,group:i}))}},{key:"quitGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("quitGroup");He.l("".concat(n," groupID:").concat(e));var i=this.checkJoinedAVChatRoomByID(e);if(!i&&!this.hasLocalGroup(e))return va({code:No.MEMBER_NOT_IN_GROUP});if(i&&!this.isLoggedIn())return He.l("".concat(n," anonymously ok. groupID:").concat(e)),this.deleteLocalGroupAndConversation(e),this._AVChatRoomHandler.reset(e),ma({groupID:e});var r=new $o("quitGroup");return r.setMessage("groupID:".concat(e)),this.request({protocolName:yr,requestData:{groupID:e}}).then((function(){return r.setNetworkType(t.getNetworkType()).end(),He.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),i&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),pa({groupID:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"searchGroupByID",value:function(e){var t=this,n="".concat(this._n,".").concat("searchGroupByID"),i={groupIDList:[e]},r=new $o("searchGroupByID");return r.setMessage("groupID:".concat(e)),He.l("".concat(n," groupID:").concat(e)),this.request({protocolName:Ir,requestData:i}).then((function(e){var i=e.data.groupProfile;if(0!==i[0].errorCode)throw new ha({code:i[0].errorCode,message:i[0].errorInfo});return r.setNetworkType(t.getNetworkType()).end(),He.l("".concat(n," ok")),pa({group:new Na(i[0])})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"changeGroupOwner",value:function(e){var t=this,n="".concat(this._n,".").concat("changeGroupOwner");if(this.hasLocalGroup(e.groupID)&&this.getLocalGroupProfile(e.groupID).type===b.GRP_AVCHATROOM)return va({code:No.CANNOT_CHANGE_OWNER_IN_AVCHATROOM});if(e.newOwnerID===this.getMyUserID())return va({code:No.CANNOT_CHANGE_OWNER_TO_SELF});var i=new $o("changeGroupOwner");return i.setMessage("groupID:".concat(e.groupID," newOwnerID:").concat(e.newOwnerID)),He.l("".concat(n," groupID:").concat(e.groupID)),this.request({protocolName:Mr,requestData:e}).then((function(){i.setNetworkType(t.getNetworkType()).end(),He.l("".concat(n," ok"));var r=e.groupID,o=e.newOwnerID;t.groupMap.get(r).ownerID=o;var a=t.getModule(jn).getLocalGroupMemberList(r);if(a instanceof Map){var s=a.get(t.getMyUserID());ht(s)||(s.updateRole("Member"),t.groupMap.get(r).selfInfo.role="Member");var c=a.get(o);ht(c)||c.updateRole("Owner")}return t.emitGroupListUpdate(!0,!1),pa({group:t.groupMap.get(r)})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"getGroupApplicationList",value:function(){return this._groupSystemNoticeHandler.getGroupApplicationList()}},{key:"handleGroupApplication",value:function(e){var t,n,i,r,o,a=this,s="".concat(this._n,".").concat("handleGroupApplication"),c=e.handleAction,u=e.handleMessage,l=e.message,d=e.application;l?(t=l.payload.operatorID,n=l.payload.groupProfile.groupID,i=l.payload.authentication,r=l.payload.messageKey):d&&(t=d.applicant,n=d.groupID,i=d.authentication,r=d.messageKey);var p=Tr;d&&2===d.applicationType&&(p=Cr,o=d.userID);var h=new $o("handleGroupApplication");return h.setMessage("groupID:".concat(n)),He.l("".concat(s," groupID:").concat(n)),this.request({protocolName:p,requestData:{handleAction:c,handleMessage:u,applicant:t,invitee:o,groupID:n,authentication:i,messageKey:r}}).then((function(){return h.setNetworkType(a.getNetworkType()).end(),He.l("".concat(s," ok")),l&&a._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),pa({group:a.getLocalGroupProfile(n)})})).catch((function(e){return a.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];h.setError(e,i,r).end()})),He.e("".concat(s," failed. error"),e),va(e)}))}},{key:"handleGroupInvitation",value:function(e){var n=this,i="".concat(this._n,".").concat("handleGroupInvitation"),r=e.message.payload,o=r.groupProfile.groupID,a=r.authentication,s=r.messageKey,c=r.operatorID,u=e.handleAction,l=new $o("handleGroupInvitation");return l.setMessage("groupID:".concat(o," inviter:").concat(c," handleAction:").concat(u)),He.l("".concat(i," groupID:").concat(o," inviter:").concat(c," handleAction:").concat(u)),this.request({protocolName:Sr,requestData:t(t({},e),{},{inviter:c,groupID:o,authentication:a,messageKey:s})}).then((function(){return l.setNetworkType(n.getNetworkType()).end(),He.l("".concat(i," ok")),n._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),pa({group:n.getLocalGroupProfile(o)})})).catch((function(e){return n.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];l.setError(e,i,r).end()})),He.e("".concat(i," failed. error"),e),va(e)}))}},{key:"getGroupOnlineMemberCount",value:function(e){return this._AVChatRoomHandler?this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)?this._AVChatRoomHandler.getGroupOnlineMemberCount(e):ma({memberCount:0}):va({code:No.CANNOT_FIND_MODULE})}},{key:"hasLocalGroup",value:function(e){return this.groupMap.has(e)}},{key:"deleteLocalGroupAndConversation",value:function(e){var t=this.checkJoinedAVChatRoomByID(e);if(He.l("".concat(this._n,".deleteLocalGroupAndConversation isJoinedAVChatRoom:").concat(t)),t&&this.getModule(zn).deleteLocalConversation("".concat(b.CONV_GROUP).concat(e)),Rt({groupID:e})){var n=this.getLocalGroupProfile(e);n&&!0===n.isSupportTopic&&this.getModule(Kn).deleteTopicListInCommunity(e)}this._deleteLocalGroup(e),this.emitGroupListUpdate(!0,!1)}},{key:"_deleteLocalGroup",value:function(e){this.groupMap.delete(e),this.getModule(jn).deleteGroupMemberList(e),this._setStorageGroupList()}},{key:"sendMessage",value:function(e,t){if(pt(e._receiverList)&&e._receiverList.length>0&&!this.canIUse(H.MSG_TO_SPECIFIED_GRP_MBR))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var n=this.createGroupMessagePack(e,t);return this.request(n)}},{key:"createGroupMessagePack",value:function(e,t){var n=null;t&&t.offlinePushInfo&&(n=t.offlinePushInfo);var i="";ut(e.cloudCustomData)&&e.cloudCustomData.length>0&&(i=e.cloudCustomData);var r=[];if(dt(t)&&dt(t.messageControlInfo)){var o=t.messageControlInfo,a=o.excludedFromUnreadCount,s=o.excludedFromLastMessage,c=o.excludedFromContentModeration;!0===a&&r.push("NoUnread"),!0===s&&r.push("NoLastMsg"),!0===c&&r.push("NoMsgCheck")}var u=void 0;pt(e._receiverList)&&e._receiverList.length>0&&(u=e._receiverList,e._receiverList.length>50&&(u=e._receiverList.slice(0,50),this.outputWarning("ReceiverListLimit")));var l=this.isOnlineMessage(e,t)?1:0,d=e.getGroupAtInfoList(),p={fromAccount:this.getMyUserID(),groupID:e.to,msgBody:e.getElements(),cloudCustomData:i,random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:e.type!==b.MSG_TEXT||tn(d)?void 0:d,onlineOnlyFlag:l,clientTime:e.clientTime,offlinePushInfo:n?{pushFlag:!0===n.disablePush?1:0,title:n.title||"",desc:n.description||"",ext:n.extension||"",apnsInfo:{badgeMode:!0===n.ignoreIOSBadge?1:0,isVoipPush:this._isVoipPush(n)},androidInfo:{OPPOChannelID:n.androidOPPOChannelID||""}}:void 0,messageControlInfo:0===l?r:void 0,needReadReceipt:!0!==e.needReadReceipt||this.isMessageFromOrToAVChatroom(e.to)?0:1,receiverList:u,isSupportExtension:!0===e.isSupportExtension?1:0};return Lt(e.to)&&(p.groupID=Wt(e.to),p.topicID=e.to),{protocolName:Ti,tjgID:this.generateTjgID(e),requestData:p}}},{key:"_isVoipPush",value:function(e){var t=void 0;return ht(e.disableVoipPush)||(t=!1===e.disableVoipPush?1:0),t}},{key:"revokeMessage",value:function(e){var t={groupID:e.to,msgSeqList:[{msgSeq:e.sequence}]};return Lt(e.to)&&(t.groupID=Wt(e.to),t.topicID=e.to),this.request({protocolName:Er,requestData:t})}},{key:"deleteMessage",value:function(e){var t=e.to,n=e.keyList;He.l("".concat(this._n,".deleteMessage groupID:").concat(t," count:").concat(n.length));var i={groupID:t,deleter:this.getMyUserID(),keyList:n};return Lt(t)&&(i.groupID=Wt(t),i.topicID=t),this.request({protocolName:Gr,requestData:i})}},{key:"modifyRemoteMessage",value:function(e){var t=e.to,n=e.sequence,i=e.payload,r=e.type,o=e.version,a=void 0===o?0:o,s=e.cloudCustomData,c=t,u=void 0;Lt(t)&&(c=Wt(t),u=t);var l=void 0;return $t(r)&&(l=[]).push({type:r,content:i}),this.request({protocolName:Fr,requestData:{groupID:c,topicID:u,sequence:n,version:a,elements:l,cloudCustomData:s}})}},{key:"getRoamingMessage",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessage"),i=e.conversationID,r=e.groupID,o=e.sequence,a=new $o("getGroupRoamingMessages"),s=0,c=void 0;return Lt(r)&&(r=Wt(c=r)),this._computeLastSequence({groupID:r,topicID:c,sequence:o}).then((function(e){return s=e,He.l("".concat(n," groupID:").concat(r," startSequence:").concat(s)),t.request({protocolName:Dr,requestData:{groupID:r,count:21,sequence:s,topicID:c}})})).then((function(e){var o=e.data,u=o.messageList,l=o.complete,d=o.invisibleSequenceList,p=void 0===d?[]:d;ht(u)?He.l("".concat(n," ok. complete:").concat(l," but messageList is undefined!")):He.l("".concat(n," ok. complete:").concat(l," count:").concat(u.length));var h=t._getMinSequence(p,u)-1;a.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(r," topicID:").concat(c," startSequence:").concat(s," complete:").concat(l," nextSequence:").concat(h)).end();var f=t.getModule(zn),g=[];return tn(u)||(f.updateRoamingMessageSequence(i,h),g=f.onRoamingMessage(u,i),f.updateIsRead(i),f.patchConversationLastMessage(i)),(2===l||h<=1)&&(f.setCompleted(i),h=""),He.l("".concat(n," nextReqID:").concat(h,", stored message count:").concat(g.length,", invisible sequence count:").concat(p.length)),{nextReqID:h+"",storedMessageList:g}})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];a.setError(e,i,o).setMessage("groupID:".concat(r," topicID:").concat(c," startSequence:").concat(s)).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"_getGroupIDOfMessage",value:function(e){return e.conversationID.replace(b.CONV_GROUP,"")}},{key:"_getMinSequence",value:function(e,t){var n=0;tn(t)||(n=t[t.length-1].sequence);var i=0;return tn(e)||(i=e[e.length-1]),He.l("".concat(this._n,"._getMinSequence minVisibleSequence:").concat(n," minInvisibleSequence:").concat(i)),i>0&&i<n?i:n}},{key:"getReadReceiptList",value:function(e){var t=this,n="".concat(this._n,".").concat("getReadReceiptList"),i=this._getGroupIDOfMessage(e[0]),r=this.getMyUserID(),o=e.filter((function(e){return e.from===r&&!0===e.needReadReceipt})).map((function(e){return{sequence:e.sequence}}));if(He.l("".concat(n," groupID:").concat(i," sequenceList:").concat(JSON.stringify(o))),0===o.length)return ma({messageList:e});var a=new $o("getReadReceiptList");return a.setMessage("groupID:".concat(i)),this.request({protocolName:wr,requestData:{groupID:i,sequenceList:o}}).then((function(t){a.end(),He.l("".concat(n," ok"));var i=t.data.readReceiptList;return pt(i)&&i.forEach((function(t){e.forEach((function(e){0===t.code&&t.sequence===e.sequence&&(e.readReceiptInfo.readCount=t.readCount,e.readReceiptInfo.unreadCount=t.unreadCount)}))})),pa({messageList:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"sendReadReceipt",value:function(e){var t=this,n="".concat(this._n,".").concat("sendReadReceipt"),i=this._getGroupIDOfMessage(e[0]),r=new $o("sendReadReceipt");r.setMessage("groupID:".concat(i));var o=this.getMyUserID(),a=e.filter((function(e){return e.from!==o&&!0===e.needReadReceipt})).map((function(e){return{sequence:e.sequence}}));return 0===a.length?va({code:No.READ_RECEIPT_MESSAGE_LIST_EMPTY}):(He.l("".concat(n,". sequenceList:").concat(JSON.stringify(a))),this.request({protocolName:Ar,requestData:{groupID:i,sequenceList:a}}).then((function(e){return r.end(),He.l("".concat(n," ok")),pa()})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),He.w("".concat(n," failed. error:"),e),va(e)})))}},{key:"getReadReceiptDetail",value:function(e){var t=this,n=e.message,i=e.filter,r=e.cursor,o=e.count,a=this._getGroupIDOfMessage(n),s=n.ID,c=n.sequence,u="".concat(this._n,".").concat("getReadReceiptDetail"),l=this._receiptDetailCompleteMap.get(s)||!1,d=0!==i&&1!==i?0:i,p=ut(r)?r:"",h=!ct(o)||o<=0||o>=100?100:o,f="groupID:".concat(a," sequence:").concat(c," cursor:").concat(p," filter:").concat(d," completeFlag:").concat(l);He.l("".concat(u," ").concat(f));var g={cursor:"",isCompleted:!1,messageID:s,unreadUserIDList:[],readUserIDList:[]},m=new $o("getReadReceiptDetail");return m.setMessage(f),this.request({protocolName:Lr,requestData:{groupID:a,sequence:c,flag:d,cursor:p,count:h}}).then((function(e){m.end();var n=e.data,i=n.cursor,r=n.isCompleted,o=n.unreadUserIDList,a=n.readUserIDList;return g.cursor=i,1===r&&(g.isCompleted=!0,t._receiptDetailCompleteMap.set(s,!0)),0===d?g.readUserIDList=a.map((function(e){return e.userID})):1===d&&(g.unreadUserIDList=o.map((function(e){return e.userID}))),He.l("".concat(u," ok")),pa(g)})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];m.setError(e,i,r).end()})),He.w("".concat(u," failed. error:"),e),va(e)}))}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessagesHopping"),i=new $o("getGroupRoamingMessagesHopping"),r=e.groupID,o=e.count,a=e.sequence,s=e.direction,c=a;1===s&&(c=a+o-1);var u=void 0;Lt(r)&&(r=Wt(u=r));var l="".concat(u?"topicID:".concat(u):"groupID:".concat(r)," sequence:").concat(a," direction:").concat(s);return He.l("".concat(n," ").concat(l)),this.request({protocolName:Dr,requestData:{groupID:r,topicID:u,count:o,sequence:c}}).then((function(r){var o=r.data,c=o.messageList,u=o.complete,d="complete:".concat(u," count:").concat(c?c.length:0);if(He.l("".concat(n," ok. ").concat(d)),i.setNetworkType(t.getNetworkType()).setMessage("".concat(l," ").concat(d)).end(),2===u||tn(c)){var p=t._computeResult();return pa(p)}var h="".concat(b.CONV_GROUP).concat(e.groupID),f=t.getModule(zn).onRoamingMessage(c,h,!1),g=t._computeResult({direction:s,sequence:a,remoteMessageList:c,processedMessageList:f});return pa(g)})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),s=n[0],c=n[1];i.setError(e,s,c).setMessage("groupID:".concat(r," sequence:").concat(a," count:").concat(o)).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"_computeResult",value:function(e){var t={messageList:[],isCompleted:!1,nextMessageSeq:""};if(ht(e))return t.isCompleted=!0,t;var n=e.direction,i=e.sequence,r=e.remoteMessageList,o=void 0===r?[]:r,a=e.processedMessageList,s=void 0===a?[]:a,c=o.length;return 1===n?(t.nextMessageSeq=o[0].sequence+1,s.forEach((function(e){e.sequence>=i&&t.messageList.push(e)})),0===t.messageList.length&&o[0].sequence<i&&(t.isCompleted=!0,t.nextMessageSeq=""),t):(t.nextMessageSeq=o[c-1].sequence-1,t.messageList=_(s),0===t.nextMessageSeq&&(t.isCompleted=!0,t.nextMessageSeq=""),t)}},{key:"setMessageRead",value:function(e){var t=this,n=e.conversationID,i=e.lastMessageSeq,r="".concat(this._n,".setMessageRead");He.l("".concat(r," conversationID:").concat(n," lastMessageSeq:").concat(i)),ct(i)||this.outputWarning("DoNotModifyLastSeq");var o=new $o("setGroupMessageRead");o.setMessage("".concat(n,"-").concat(i));var a=n.replace(b.CONV_GROUP,""),s=void 0;return Lt(a)&&(a=Wt(s=a)),this.request({protocolName:kr,requestData:{groupID:a,topicID:s,messageReadSeq:i}}).then((function(){o.setNetworkType(t.getNetworkType()).end(),He.l("".concat(r," ok."));var e=t.getModule(zn);e.updateIsReadAfterReadReport({conversationID:n,lastMessageSeq:i});var c=!0;if(!ht(s)){c=!1;var u=t.getModule(Kn).getLocalTopic(a,s);u&&u.updateSelfInfo({readedSequence:i})}return e.updateUnreadCount(n,c),pa()})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),He.l("".concat(r," failed. error:"),e),va(e)}))}},{key:"_computeLastSequence",value:function(e){var t=e.groupID,n=e.topicID,i=void 0===n?void 0:n,r=e.sequence;return r>0?Promise.resolve(r):ht(i)||this.hasLocalGroup(t)?ht(i)?this.getGroupLastSequence(t):this.getTopicLastSequence({groupID:t,topicID:i}):Promise.resolve(0)}},{key:"getGroupLastSequence",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupLastSequence"),i=new $o("getGroupLastSequence"),r=0,o="";if(this.hasLocalGroup(e)){var a=this.getLocalGroupProfile(e),s=a.lastMessage;if(s.lastSequence>0&&!1===s.onlineOnlyFlag)return r=s.lastSequence,o="got lastSequence:".concat(r," from local group profile[lastMessage.lastSequence]. groupID:").concat(e),He.l("".concat(n," ").concat(o)),i.setNetworkType(this.getNetworkType()).setMessage("".concat(o)).end(),Promise.resolve(r);if(a.nextMessageSeq>1)return r=a.nextMessageSeq-1,o="got lastSequence:".concat(r," from local group profile[nextMessageSeq]. groupID:").concat(e),He.l("".concat(n," ").concat(o)),i.setNetworkType(this.getNetworkType()).setMessage("".concat(o)).end(),Promise.resolve(r)}var c="GROUP".concat(e),u=this.getModule(zn).getLocalConversation(c);if(u&&u.lastMessage.lastSequence&&!1===u.lastMessage.onlineOnlyFlag)return r=u.lastMessage.lastSequence,o="got lastSequence:".concat(r," from local conversation profile[lastMessage.lastSequence]. groupID:").concat(e),He.l("".concat(n," ").concat(o)),i.setNetworkType(this.getNetworkType()).setMessage("".concat(o)).end(),Promise.resolve(r);var l={groupIDList:[e],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}};return this.getGroupProfileAdvance(l).then((function(a){var s=a.data.successGroupList;return tn(s)?He.l("".concat(n," successGroupList is empty. groupID:").concat(e)):(r=s[0].nextMessageSeq-1,o="got lastSequence:".concat(r," from getGroupProfileAdvance. groupID:").concat(e),He.l("".concat(n," ").concat(o))),i.setNetworkType(t.getNetworkType()).setMessage("".concat(o)).end(),r})).catch((function(r){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],a=n[1];i.setError(r,o,a).setMessage("get lastSequence failed from getGroupProfileAdvance. groupID:".concat(e)).end()})),He.w("".concat(n," failed. error:"),r),va(r)}))}},{key:"getTopicLastSequence",value:function(e){var t=this,n=e.groupID,i=e.topicID,r="".concat(this._n,".").concat("getTopicLastSequence"),o=new $o("getTopicLastSequence"),a=0,s="",c=this.getModule(Kn);return c.hasLocalTopic(n,i)?(a=c.getLocalTopic(n,i).nextMessageSeq-1,s="get lastSequence:".concat(a," from local topic info[nextMessageSeq]. topicID:").concat(i),He.l("".concat(r," ").concat(s)),o.setNetworkType(this.getNetworkType()).setMessage("".concat(s)).end(),Promise.resolve(a)):c.getTopicList({groupID:n,topicIDList:[i]}).then((function(e){var n=e.data.successTopicList;return tn(n)?He.l("".concat(r," successTopicList is empty. topicID:").concat(i)):(a=n[0].nextMessageSeq-1,s="get lastSequence:".concat(a," from getTopicList. topicID:").concat(i),He.l("".concat(r," ").concat(s))),o.setNetworkType(t.getNetworkType()).setMessage("".concat(s)).end(),a})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),r=n[0],a=n[1];o.setError(e,r,a).setMessage("get lastSequence failed from getTopicList. topicID:".concat(i)).end()})),He.w("".concat(r," failed. error:"),e),va(e)}))}},{key:"isMessageFromOrToAVChatroom",value:function(e){return!!this._AVChatRoomHandler&&this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"hasJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler?this._AVChatRoomHandler.hasJoinedAVChatRoom():0}},{key:"getJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler?this._AVChatRoomHandler.getJoinedAVChatRoom():[]}},{key:"isOnlineMessage",value:function(e,t){return!(!this._canIUseOnlineOnlyFlag(e)||!t||!0!==t.onlineUserOnly)}},{key:"_canIUseOnlineOnlyFlag",value:function(e){var t=this.getJoinedAVChatRoom();return!t||!t.includes(e.to)||e.conversationType!==b.CONV_GROUP}},{key:"_onAVChatRoomHistoryMessage",value:function(e){if(!tn(e)){He.l("".concat(this._n,"._onAVChatRoomHistoryMessage count:").concat(e.length));var n=[];e.forEach((function(e){n.push(t(t({},e),{},{isHistoryMessage:1}))})),this.onAVChatRoomMessage(n)}}},{key:"onAVChatRoomMessage",value:function(e){this._AVChatRoomHandler&&this._AVChatRoomHandler.onMessage(e)}},{key:"onAVChatRoomMemberBanned",value:function(e){this._AVChatRoomHandler&&this._AVChatRoomHandler.onAVChatRoomMemberBanned(e)}},{key:"getGroupSimplifiedInfo",value:function(e){var t=this,n=new $o("getGroupSimplifiedInfo"),i={groupIDList:[e],responseFilter:{groupBaseInfoFilter:["Type","Name"]}};return this.getGroupProfileAdvance(i).then((function(i){var r=i.data.successGroupList;return n.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(e," type:").concat(r[0].type)).end(),r[0]})).catch((function(i){t.probeNetwork().then((function(t){var r=v(t,2),o=r[0],a=r[1];n.setError(i,o,a).setMessage("groupID:".concat(e)).end()}))}))}},{key:"setUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.set(e,1)}},{key:"deleteUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.has(e)&&this._unjoinedAVChatRoomList.delete(e)}},{key:"isUnjoinedAVChatRoom",value:function(e){return this._unjoinedAVChatRoomList.has(e)}},{key:"isGroupAttributesUpdatedNotice",value:function(e){return this._groupAttributesHandler.isGroupAttributesUpdatedNotice(e)}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesHandler.updateLocalMainSequenceOnReconnected()}},{key:"initGroupAttributes",value:function(e){return this._groupAttributesHandler.initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._groupAttributesHandler.setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._groupAttributesHandler.deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._groupAttributesHandler.getGroupAttributes(e)}},{key:"isMessageFromTopic",value:function(e,t){return 2===e&&!tn(t)}},{key:"isMessageFromCommunityOfTopic",value:function(e,t){return 2===e&&tn(t)}},{key:"getMessageExtensions",value:function(e,t){return He.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.request({protocolName:zr,requestData:{groupID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return He.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n)),this.request({protocolName:Kr,requestData:{groupID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"getGroupNotify",value:function(e){var n=this;if(this.hasLocalGroup(e)){var i=this.getLocalGroupProfile(e),r=i.type,o=i.isSupportTopic;if(!At(r)&&!o){var a="".concat(this._n,".getGroupNotify"),s=this._getGroupLastRevokedTime(e),c=1e3*xe();He.l("".concat(a," groupID:").concat(e," type:").concat(r," beginTime:").concat(s," endTime:").concat(c)),this.request({protocolName:Wr,requestData:{type:Rt({type:r,groupID:e})?b.GRP_COMMUNITY:void 0,groupID:e,beginTime:s,endTime:c}}).then((function(i){var r=i.data,o=r.nextRevokedTime,s=r.notifyList;He.l("".concat(a," ok. groupID:").concat(e," nextRevokedTime:").concat(o));var c={dataList:[{elements:{revokedInfos:[]}}]};pt(s)&&s.forEach((function(n){c.dataList[0].elements.revokedInfos.push({groupID:e,sequence:n.sequence,random:n.random,revokerInfo:t({},n.revokerInfo)})})),n.onGroupMessageRevoked(c),0!==o?(n._setGroupLastRevokedTime(e,o),n.getGroupNotify(e)):n._setGroupLastRevokedTime(e,1e3*xe())})).catch((function(e){He.e("".concat(a," failed. error:"),e)}))}}}},{key:"_getGroupLastRevokedTime",value:function(e){return this.hasLocalGroup(e)?this.getLocalGroupProfile(e)._lastRevokedTime:0}},{key:"_setGroupLastRevokedTime",value:function(e,t){this.hasLocalGroup(e)&&(this.getLocalGroupProfile(e)._lastRevokedTime=t)}},{key:"isGroupCountersNotice",value:function(e){return this._groupCountersHandler.isGroupCountersNotice(e)}},{key:"setGroupCounters",value:function(e){return this._groupCountersHandler.setGroupCounters(e)}},{key:"increaseGroupCounter",value:function(e){return this._groupCountersHandler.increaseGroupCounter(e)}},{key:"decreaseGroupCounter",value:function(e){return this._groupCountersHandler.decreaseGroupCounter(e)}},{key:"getGroupCounters",value:function(e){return this._groupCountersHandler.getGroupCounters(e)}},{key:"restartPolling",value:function(){this._AVChatRoomHandler&&this._AVChatRoomHandler.restartPolling()}},{key:"_canIUseJoinOption",value:function(e){return e===b.GRP_PUBLIC||Rt({type:e})}},{key:"reset",value:function(){this.groupMap.clear(),this._unjoinedAVChatRoomList.clear(),this._receiptDetailCompleteMap.clear(),this._commonGroupHandler.reset(),this._groupSystemNoticeHandler.reset(),this._groupTipsHandler.reset(),this._groupAttributesHandler.reset(),this._groupCountersHandler.reset(),this._AVChatRoomHandler&&this._AVChatRoomHandler.reset()}}]),r}(fi),as=function(){function e(t){i(this,e),this.userID="",this.avatar="",this.nick="",this.role="",this.joinTime="",this.lastSendMsgTime="",this.nameCard="",this.muteUntil=0,this.memberCustomField=[],this._initMember(t)}return o(e,[{key:"_initMember",value:function(e){this.updateMember(e)}},{key:"updateMember",value:function(e){var t=[null,void 0,"",0,NaN];e.memberCustomField&&wt(this.memberCustomField,e.memberCustomField),yt(this,e,["memberCustomField","marks"],t)}},{key:"updateRole",value:function(e){["Owner","Admin","Member"].indexOf(e)<0||(this.role=e)}},{key:"updateMuteUntil",value:function(e){ht(e)||(this.muteUntil=Math.floor((Date.now()+1e3*e)/1e3))}},{key:"updateNameCard",value:function(e){ht(e)||(this.nameCard=e)}},{key:"updateMemberCustomField",value:function(e){e&&wt(this.memberCustomField,e)}}]),e}(),ss=function(e){s(r,e);var n=m(r);function r(e){var t;return i(this,r),(t=n.call(this,e))._n="GroupMemberModule",t.groupMemberListMap=new Map,t.getInnerEmitterInstance().on(Ta,t._onProfileUpdated,f(t)),t}return o(r,[{key:"_onProfileUpdated",value:function(e){for(var t=this,n=e.data,i=function(e){var i=n[e];t.groupMemberListMap.forEach((function(e){e.has(i.userID)&&e.get(i.userID).updateMember({nick:i.nick,avatar:i.avatar})}))},r=0;r<n.length;r++)i(r)}},{key:"deleteGroupMemberList",value:function(e){this.groupMemberListMap.delete(e)}},{key:"getGroupMemberList",value:function(e){var t=this,n=e.groupID,i=e.offset,r=void 0===i?0:i,o=e.count,a=void 0===o?15:o,s=e.filter,c=void 0===s?void 0:s,u="".concat(this._n,".").concat("getGroupMemberList"),l=this.getModule(Bn),d=l.hasLocalGroup(n);if(He.l("".concat(u," groupID:").concat(n," offset:").concat(r," count:").concat(a," hasLocalGroup:").concat(d)),!d)return ma({memberList:[],offset:0});if(l.getLocalGroupProfile(n).type===b.GRP_AVCHATROOM){if(this.canIUse(H.AVCHATROOM_MBR_LIST))return this._getAVChatRoomMemberList({groupID:n,offset:r,filter:c});this.outputWarning("LiveOnlineMember")}var p=new $o("getGroupMemberList"),h=0,f={groupID:n,limit:a>100?100:a};Rt({groupID:n})?f.next="".concat(r):(f.offset=r,h=r+a);var g=[];return this.request({protocolName:Jr,requestData:f}).then((function(e){var i=e.data,r=i.members,o=i.memberNum,a=i.next,s=void 0===a?void 0:a;if(ht(s)||(h=tn(s)?0:s),!pt(r)||0===r.length)return h=0,Promise.resolve([]);var c=t.getModule(Bn);return c.hasLocalGroup(n)&&(c.getLocalGroupProfile(n).memberNum=o),g=t._updateLocalGroupMemberMap(n,r),t.getModule(Vn).getUserProfile({userIDList:r.map((function(e){return e.userID})),tagList:[Ke.NICK,Ke.AVATAR]})})).then((function(e){var i=e.data;if(!pt(i)||0===i.length)return ma({memberList:[],offset:h});var o=i.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}}));return t._updateLocalGroupMemberMap(n,o),g.length<a&&(h=0),p.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(n," offset:").concat(r," count:").concat(a)).end(),He.l("".concat(u," ok.")),pa({memberList:g,offset:h})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];p.setError(e,i,r).end()})),He.e("".concat(u," failed. error:"),e),va(e)}))}},{key:"_getAVChatRoomMemberList",value:function(e){var t=this,n=e.groupID,i=e.offset,r=e.filter,o="".concat(this._n,".").concat("_getAVChatRoomMemberList"),a=new $o("_getAVChatRoomMemberList");return a.setMessage("groupID:".concat(n," offset:").concat(i," filter:").concat(r)),this.request({protocolName:Xr,requestData:{groupID:n,offset:i,filter:r}}).then((function(e){var i=e.data,r=i.memberList,s=void 0===r?[]:r,c=i.offset,u=void 0===c?0:c;a.setNetworkType(t.getNetworkType()).end(),He.l("".concat(o," ok. member count:").concat(s.length,", next request timestamp:").concat(u));var l=t._updateLocalGroupMemberMap(n,s);return pa({memberList:l,offset:u})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),He.e("".concat(o," failed. error:"),e),va(e)}))}},{key:"getGroupMemberProfile",value:function(e){var n=this,i="".concat(this._n,".").concat("getGroupMemberProfile"),r=new $o("getGroupMemberProfile");r.setMessage(e.userIDList.length>5?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)),He.l("".concat(i," groupID:").concat(e.groupID," userIDList:").concat(e.userIDList.join(","))),e.userIDList.length>50&&(e.userIDList=e.userIDList.slice(0,50));var o=e.groupID,a=e.userIDList;return this._getGroupMemberProfileAdvance(t(t({},e),{},{userIDList:a})).then((function(e){var t=e.data.members;return pt(t)&&0!==t.length?(n._updateLocalGroupMemberMap(o,t),n.getModule(Vn).getUserProfile({userIDList:t.map((function(e){return e.userID})),tagList:[Ke.NICK,Ke.AVATAR]})):ma([])})).then((function(e){var t=e.data.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}}));n._updateLocalGroupMemberMap(o,t);var i=a.filter((function(e){return n.hasLocalGroupMember(o,e)})).map((function(e){return n.getLocalGroupMemberInfo(o,e)}));return r.setNetworkType(n.getNetworkType()).end(),pa({memberList:i})}))}},{key:"addGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("addGroupMember"),i=e.groupID,r=this.getModule(Bn).getLocalGroupProfile(i),o=r.type,a=new $o("addGroupMember");if(a.setMessage("groupID:".concat(i," groupType:").concat(o)),At(o)){var s=new ha({code:No.CANNOT_ADD_MEMBER_IN_AVCHATROOM});return a.setError(s,!0,this.getNetworkType()).end(),va(s)}return e.userIDList=e.userIDList.map((function(e){return{userID:e}})),He.l("".concat(n," groupID:").concat(i)),this.request({protocolName:Qr,requestData:e}).then((function(i){var o=i.data.members;He.l("".concat(n," ok"));var s=o.filter((function(e){return 1===e.result})).map((function(e){return e.userID})),c=o.filter((function(e){return 0===e.result})).map((function(e){return e.userID})),u=o.filter((function(e){return 2===e.result})).map((function(e){return e.userID})),l=o.filter((function(e){return 4===e.result})).map((function(e){return e.userID})),d="groupID:".concat(e.groupID,", ")+"successUserIDList:".concat(s,", ")+"failureUserIDList:".concat(c,", ")+"existedUserIDList:".concat(u,", ")+"overLimitUserIDList:".concat(l);return a.setNetworkType(t.getNetworkType()).setMoreMessage(d).end(),0===s.length?pa({successUserIDList:s,failureUserIDList:c,existedUserIDList:u,overLimitUserIDList:l}):(r.memberCount+=s.length,t._updateConversationGroupProfile(r),pa({successUserIDList:s,failureUserIDList:c,existedUserIDList:u,overLimitUserIDList:l,group:r}))})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"deleteGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteGroupMember"),i=e.groupID,r=e.userIDList,o=this.getModule(Bn).getLocalGroupProfile(i);if(ht(o))return va({code:No.CANNOT_FIND_GROUP});if(At(o.type))return this.canIUse(H.AVCHATROOM_BAN_MBR)?this._banAVChatRoomMember(e):va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var a=new $o("deleteGroupMember"),s="groupID:".concat(i," ").concat(r.length>5?"userIDList.length:".concat(r.length):"userIDList:".concat(r));return a.setMessage(s),He.l("".concat(n," groupID:").concat(i," userIDList:"),r),this.request({protocolName:eo,requestData:e}).then((function(){return a.setNetworkType(t.getNetworkType()).end(),He.l("".concat(n," ok")),o.memberCount-=1,t._updateConversationGroupProfile(o),t.deleteLocalGroupMembers(i,r),pa({group:o,userIDList:r})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"_updateConversationGroupProfile",value:function(e){this.getModule(zn).updateConversationGroupProfile([e])}},{key:"_banAVChatRoomMember",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteGroupMember"),i=e.groupID,r=e.userIDList,o="groupID:".concat(i," ").concat(r.length>5?"userIDList.length:".concat(r.length):"userIDList:".concat(r)),a=new $o("deleteGroupMember");a.setMessage(o),He.l("".concat(n," groupID:").concat(i," userIDList:"),r);var s=this.getModule(Bn).getLocalGroupProfile(i);return ht(e.duration)||0===e.duration?va({code:No.BAN_DURATION_INVALID}):this.request({protocolName:to,requestData:e}).then((function(){return a.setNetworkType(t.getNetworkType()).end(),He.l("".concat(n," ok")),t.deleteLocalGroupMembers(i,r),pa({group:s,userIDList:r})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"setGroupMemberMuteTime",value:function(e){var t=this,n=e.groupID,i=e.userID,r=e.muteTime,o="".concat(this._n,".").concat("setGroupMemberMuteTime");if(i===this.getMyUserID())return va(new ha({code:No.CANNOT_MUTE_SELF}));He.l("".concat(o," groupID:").concat(n," userID:").concat(i));var a=new $o("setGroupMemberMuteTime");return a.setMessage("groupID:".concat(n," userID:").concat(i," muteTime:").concat(r)),this.modifyGroupMemberInfo({groupID:n,userID:i,muteTime:r}).then((function(e){a.setNetworkType(t.getNetworkType()).end(),He.l("".concat(o," ok"));var i=t.getModule(Bn);return pa({group:i.getLocalGroupProfile(n),member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),He.e("".concat(o," failed. error:"),e),va(e)}))}},{key:"setGroupMemberRole",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupMemberRole"),i=e.groupID,r=e.userID,o=e.role,a=this.getModule(Bn).getLocalGroupProfile(i);if(a.selfInfo.role!==b.GRP_MBR_ROLE_OWNER)return va({code:No.NOT_OWNER});if([b.GRP_WORK,b.GRP_AVCHATROOM].includes(a.type))return va({code:No.CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM});var s=[b.GRP_MBR_ROLE_ADMIN,b.GRP_MBR_ROLE_MEMBER];if(Rt({groupID:i})&&s.push(b.GRP_MBR_ROLE_CUSTOM),s.indexOf(o)<0)return va({code:No.INVALID_MEMBER_ROLE});if(r===this.getMyUserID())return va({code:No.CANNOT_SET_SELF_MEMBER_ROLE});var c=new $o("setGroupMemberRole");return c.setMessage("groupID:".concat(i," userID:").concat(r," role:").concat(o)),He.l("".concat(n," groupID:").concat(i," userID:").concat(r)),this.modifyGroupMemberInfo({groupID:i,userID:r,role:o}).then((function(e){return c.setNetworkType(t.getNetworkType()).end(),He.l("".concat(n," ok")),pa({group:a,member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"_filterProfanity",value:function(e,t){var n=this.getModule(li);if(!n)return!0;var i=n.filterText(t[e],X),r=i.isAllowedToSend,o=i.modifiedText;return!0===r&&(t[e]=o,!0)}},{key:"setGroupMemberNameCard",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupMemberNameCard");if(e.nameCard&&!1===this._filterProfanity("nameCard",e))return va({code:No.PROFANITY_FOUND});var i=e.groupID,r=e.userID,o=void 0===r?this.getMyUserID():r,a=e.nameCard;He.l("".concat(n," groupID:").concat(i," userID:").concat(o));var s=new $o("setGroupMemberNameCard");return s.setMessage("groupID:".concat(i," userID:").concat(o," nameCard:").concat(a)),this.modifyGroupMemberInfo({groupID:i,userID:o,nameCard:a}).then((function(e){He.l("".concat(n," ok")),s.setNetworkType(t.getNetworkType()).end();var r=t.getModule(Bn).getLocalGroupProfile(i);return o===t.getMyUserID()&&r&&r.setSelfNameCard(a),pa({group:r,member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];s.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"setGroupMemberCustomField",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupMemberCustomField"),i=e.groupID,r=e.userID,o=void 0===r?this.getMyUserID():r,a=e.memberCustomField;He.l("".concat(n," groupID:").concat(i," userID:").concat(o));var s=new $o("setGroupMemberCustomField");return s.setMessage("groupID:".concat(i," userID:").concat(o," memberCustomField:").concat(JSON.stringify(a))),this.modifyGroupMemberInfo({groupID:i,userID:o,memberCustomField:a}).then((function(e){s.setNetworkType(t.getNetworkType()).end(),He.l("".concat(n," ok"));var r=t.getModule(Bn).getLocalGroupProfile(i);return pa({group:r,member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];s.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"modifyGroupMemberInfo",value:function(e){var n=this,i=e.groupID,r=e.userID,o=void 0;return Lt(i)&&(i=Wt(o=i)),this.request({protocolName:no,requestData:t(t({},e),{},{groupID:i,topicID:o})}).then((function(){if(n.hasLocalGroupMember(i,r)){var t=n.getLocalGroupMemberInfo(i,r);return ht(e.muteTime)||t.updateMuteUntil(e.muteTime),ht(e.role)||t.updateRole(e.role),ht(e.nameCard)||t.updateNameCard(e.nameCard),ht(e.memberCustomField)||t.updateMemberCustomField(e.memberCustomField),t}return n.getGroupMemberProfile({groupID:i,userIDList:[r]}).then((function(e){return v(e.data.memberList,1)[0]}))}))}},{key:"markGroupMemberList",value:function(e){var t=this,n="".concat(this._n,".").concat("markGroupMemberList"),i=e.groupID,r=e.markType,o=e.enableMark,a=e.userIDList,s=void 0===a?[]:a,c="groupID:".concat(i," markType:").concat(r," enableMark:").concat(o," userIDList count: ").concat(s.length);He.l("".concat(n," ").concat(c));var u=2,l=[];!0===o&&(u=1);var d=_(s);s.length>500&&(d=s.slice(0,500),He.w("".concat(n," ").concat(Zt(500)))),d.forEach((function(e){l.push({userID:e,markType:[r]})})),d=null;var p=new $o("markGroupMemberList");return p.setMessage("".concat(c)),this.request({protocolName:io,requestData:{groupID:i,operationType:u,memberList:l}}).then((function(e){var i=e.data.memberList,r=void 0===i?[]:i,o=[],a=[];r.length===s.length?o.push.apply(o,_(s)):(r.forEach((function(e){o.push(e.userID)})),s.forEach((function(e){o.includes(e)||a.push(e)})));var c="success count:".concat(o.length," fail count:").concat(a.length);return p.setNetworkType(t.getNetworkType()).setMessage(c).end(),He.l("".concat(n," ok. ").concat(c)),pa({successUserIDList:o,failureUserIDList:a})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];p.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"_getGroupMemberProfileAdvance",value:function(e){return this.request({protocolName:Zr,requestData:t(t({},e),{},{memberInfoFilter:e.memberInfoFilter?e.memberInfoFilter:["Role","JoinTime","NameCard","ShutUpUntil"]})})}},{key:"_updateLocalGroupMemberMap",value:function(e,t){var n=this;return pt(t)&&0!==t.length?t.map((function(t){return n.hasLocalGroupMember(e,t.userID)?n.getLocalGroupMemberInfo(e,t.userID).updateMember(t):n.setLocalGroupMember(e,new as(t)),n.getLocalGroupMemberInfo(e,t.userID)})):[]}},{key:"deleteLocalGroupMembers",value:function(e,t){var n=this.groupMemberListMap.get(e);n&&t.forEach((function(e){n.delete(e)}))}},{key:"getLocalGroupMemberInfo",value:function(e,t){return this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).get(t):null}},{key:"setLocalGroupMember",value:function(e,t){if(this.groupMemberListMap.has(e))this.groupMemberListMap.get(e).set(t.userID,t);else{var n=(new Map).set(t.userID,t);this.groupMemberListMap.set(e,n)}}},{key:"getLocalGroupMemberList",value:function(e){return this.groupMemberListMap.get(e)}},{key:"hasLocalGroupMember",value:function(e,t){return this.groupMemberListMap.has(e)&&this.groupMemberListMap.get(e).has(t)}},{key:"hasLocalGroupMemberMap",value:function(e){return this.groupMemberListMap.has(e)}},{key:"reset",value:function(){this.groupMemberListMap.clear()}}]),r}(fi),cs=["topicID","topicName","avatar","introduction","notification","unreadCount","muteAllMembers","customData","groupAtInfoList","nextMessageSeq","selfInfo"],us=function(e,t){return tn(e)?{lastTime:0,lastSequence:0,fromAccount:"",payload:null,type:"",messageForShow:"",nick:"",version:0,cloudCustomData:"",isRevoked:!1,revoker:null}:{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",payload:e.payload||null,type:e.type||"",messageForShow:Yt(e.type,e.payload,t),nick:e.nick||"",version:e.version||0,cloudCustomData:e.cloudCustomData||"",isRevoked:e.isRevoked||!1,revoker:e.revoker||null}},ls=function(){function e(t,n){i(this,e),this.topicID="",this.topicName="",this.avatar="",this.introduction="",this.notification="",this.unreadCount=0,this.muteAllMembers=!1,this.customData="",this.groupAtInfoList=[],this.nextMessageSeq=0,this.lastMessage=us(t.lastMessage,n),this.selfInfo={muteTime:0,readedSequence:0,messageRemindType:"",excludedUnreadSequenceList:void 0},this._initTopic(t)}return o(e,[{key:"_initTopic",value:function(e){for(var t in e)cs.indexOf(t)<0||("selfInfo"===t?this.updateSelfInfo(e[t]):this[t]="muteAllMembers"===t?1===e[t]:e[t])}},{key:"updateUnreadCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.unreadCount=e}},{key:"updateNextMessageSeq",value:function(e){this.nextMessageSeq=e}},{key:"updateLastMessage",value:function(e){this.lastMessage=us(e)}},{key:"updateGroupAtInfoList",value:function(e){this.groupAtInfoList=JSON.parse(JSON.stringify(e))}},{key:"updateTopic",value:function(e){ht(e.selfInfo)||this.updateSelfInfo(e.selfInfo),ht(e.muteAllMembers)||(this.muteAllMembers=1===e.muteAllMembers),yt(this,e,["groupID","lastMessageTime","selfInfo","muteAllMembers","lastMsg"])}},{key:"updateSelfInfo",value:function(e){return 0!==yt(this.selfInfo,e,[],[""])}},{key:"reduceUnreadCount",value:function(){return this.unreadCount>=1&&(this.unreadCount-=1,!0)}},{key:"isLastMessageRevoked",value:function(e){return e.sequence===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}}]),e}(),ds=function(e){s(r,e);var n=m(r);function r(e){var t;return i(this,r),(t=n.call(this,e))._n="TopicModule",t._topicMap=new Map,t._getTopicTimeMap=new Map,t.TOPIC_CACHE_TIME=300,t.TOPIC_LAST_ACTIVE_TIME=3600,t.getInnerEmitterInstance().on(Ma,t._onCloudConfigUpdated,f(t)),t}return o(r,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("topic_cache_time"),t=this.getCloudConfig("topic_last_active_time");ht(e)||(this.TOPIC_CACHE_TIME=Number(e)),ht(t)||(this.TOPIC_LAST_ACTIVE_TIME=Number(t))}},{key:"onTopicCreated",value:function(e){var t=e.groupID;this.resetGetTopicTime(t),this.emitOuterEvent(k.TOPIC_CREATED,e)}},{key:"onTopicDeleted",value:function(e){var t=this,n=e.groupID,i=e.topicIDList;(void 0===i?[]:i).forEach((function(e){t._deleteLocalTopic(n,e)})),this.emitOuterEvent(k.TOPIC_DELETED,e)}},{key:"onTopicMessageRemindTypeUpdated",value:function(e){var t=e.groupID,n=e.topicID,i=e.messageRemindType,r=this.getLocalTopic(t,n);if(r){var o=r.updateSelfInfo({messageRemindType:i});o&&this.emitOuterEvent(k.TOPIC_UPDATED,{groupID:t,topic:r}),He.d("".concat(this._n,".onTopicMessageRemindTypeUpdated topicID:").concat(n)+" messageRemindType:".concat(i," isTopicUpdated:").concat(o))}}},{key:"onTopicProfileUpdated",value:function(e){var t=e.groupID,n=e.topicID,i=this.getLocalTopic(t,n);i&&(i.updateTopic(e),this.emitOuterEvent(k.TOPIC_UPDATED,{groupID:t,topic:i}))}},{key:"onConversationProxy",value:function(e){var t=e.topicID,n=e.unreadCount,i=e.groupAtInfoList,r=Wt(t),o=this.getLocalTopic(r,t),a=!1;o&&(ht(n)||o.unreadCount===n||(o.updateUnreadCount(n),a=!0),ht(i)||(o.updateGroupAtInfoList(i),a=!0)),a&&this.emitOuterEvent(k.TOPIC_UPDATED,{groupID:r,topic:o})}},{key:"onMessageSent",value:function(e){var t=e.groupID,n=e.topicID,i=e.lastMessage,r=this.getLocalTopic(t,n);r&&(r.nextMessageSeq+=1,r.updateLastMessage(i),this.emitOuterEvent(k.TOPIC_UPDATED,{groupID:t,topic:r}))}},{key:"onMessageModified",value:function(e){var t=e.to,n=e.time,i=e.sequence,r=e.elements,o=e.cloudCustomData,a=e.messageVersion,s=Wt(t),c=this.getLocalTopic(s,t);if(c){var u=c.lastMessage;He.d("".concat(this._n,".onMessageModified topicID:").concat(t," lastMessage:"),JSON.stringify(u),"options:",JSON.stringify(e)),u&&(null===u.payload||u.lastTime===n&&u.lastSequence===i&&u.version!==a)&&(u.type=r[0].type,u.payload=r[0].content,u.messageForShow=Yt(u.type,u.payload,this.isIntl()),u.cloudCustomData=o,u.version=a,u.lastSequence=i,u.lastTime=n,this.emitOuterEvent(k.TOPIC_UPDATED,{groupID:s,topic:c}))}}},{key:"onMessageRevoked",value:function(e){var t=this;if(0!==e.length){var n=null,i=null,r=!1;e.forEach((function(e){var o=e.to;i=Wt(o),(n=t.getLocalTopic(i,o))&&(n.reduceUnreadCount()&&(r=!0),n.isLastMessageRevoked(e)&&(n.setLastMessageRevoked(!0),n.setLastMessageRevoker(e.revoker),r=!0))})),r&&this.emitOuterEvent(k.TOPIC_UPDATED,{groupID:i,topic:n})}}},{key:"isLastMessageRevoked",value:function(e){var t=e.topicID,n=e.sequence,i=Wt(t),r=this.getLocalTopic(i,t),o=!1;return r&&(o=r.isLastMessageRevoked({sequence:n})),o}},{key:"getJoinedCommunityList",value:function(){return this.getModule(Bn).getGroupList({isGroupWithTopicOnly:!0}).then((function(e){var t=e.data.groupList;return pa({groupList:void 0===t?[]:t})})).catch((function(e){return va(e)}))}},{key:"createTopicInCommunity",value:function(e){var n=this,i="".concat(this._n,".").concat("createTopicInCommunity"),r=e.topicID;if(!ht(r)&&!Lt(r))return va({code:No.ILLEGAL_TOPIC_ID});if(e.topicName&&!1===this._filterProfanity("topicName",e))return va({code:No.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return va({code:No.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return va({code:No.PROFANITY_FOUND});var o=new $o("createTopicInCommunity");return this.request({protocolName:Mo,requestData:t({},e)}).then((function(r){var a=r.data.topicID;return o.setMessage("topicID:".concat(a)).setNetworkType(n.getNetworkType()).end(),He.l("".concat(i," ok")),n._updateTopicMap([t(t({},e),{},{topicID:a})]),pa({topicID:a})})).catch((function(e){return n.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),He.e("".concat(i," failed. error:"),e),va(e)}))}},{key:"deleteTopicFromCommunity",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteTopicFromCommunity"),i=e.groupID,r=e.topicIDList,o=void 0===r?[]:r,a=new $o("deleteTopicFromCommunity");return a.setMessage("groupID:".concat(i," topicIDList:").concat(o)),this.request({protocolName:To,requestData:{groupID:i,topicIDList:o}}).then((function(e){var n=e.data.resultList,r=[],o=[];(void 0===n?[]:n).forEach((function(e){var t=e.topicID,n=e.errorCode,i=e.errorInfo;0===n?r.push({topicID:t}):o.push({topicID:t,code:n,message:i})}));var s="success count:".concat(r.length,", fail count:").concat(o.length);return a.setMoreMessage("".concat(s)).setNetworkType(t.getNetworkType()).end(),He.l("".concat(s)),r.forEach((function(e){t._deleteLocalTopic(i,e.topicID)})),pa({successTopicList:r,failureTopicList:o})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"updateTopicProfile",value:function(e){var n=this,i="".concat(this._n,".").concat("updateTopicProfile");if(He.l("".concat(i," options:"),e),e.topicName&&!1===this._filterProfanity("topicName",e))return va({code:No.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return va({code:No.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return va({code:No.PROFANITY_FOUND});var r=new $o("updateTopicProfile");return r.setMessage("groupID:".concat(e.groupID," topicID:").concat(e.topicID)),ht(e.muteAllMembers)||(e.muteAllMembers=!0===e.muteAllMembers?"On":"Off"),this.request({protocolName:Co,requestData:t({},e)}).then((function(){return r.setNetworkType(n.getNetworkType()).end(),He.l("".concat(i," ok")),n._updateTopicMap([e]),pa({topic:n.getLocalTopic(e.groupID,e.topicID)})})).catch((function(e){return n.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),He.e("".concat(i," failed. error:"),e),va(e)}))}},{key:"getTopicList",value:function(e){var n=this,i="".concat(this._n,".").concat("getTopicList"),r=e.groupID,o=e.topicIDList,a=void 0===o?[]:o,s=0===a.length,c=new $o("getTopicList");if(c.setMessage("groupID:".concat(r)),this._getTopicTimeMap.has(r)){var u=this._getTopicTimeMap.get(r),l=u.isGetAll,d=u.time;if((l||!l&&!s)&&Date.now()-d<1e3*this.TOPIC_CACHE_TIME){var p=this._getLocalTopicList(r,a);if(s||p.length===a.length)return c.setNetworkType(this.getNetworkType()).setMoreMessage("from cache, topic count:".concat(p.length)).end(),He.l("".concat(i," groupID:").concat(r," from cache, topic count:").concat(p.length)),ma({successTopicList:p,failureTopicList:[]})}}return this.request({protocolName:So,requestData:{groupID:r,topicIDList:a}}).then((function(e){var o=e.data.topicInfoList,a=[],u=[],l=[];(void 0===o?[]:o).forEach((function(e){var n=e.topic,i=e.selfInfo,r=e.errorCode,o=e.errorInfo,s=n.topicID;0===r?(a.push(t(t({},n),{},{selfInfo:i})),u.push(s)):l.push({topicID:s,code:r,message:o})})),n._updateTopicMap(a),n._handleTopicAtInfo(a);var d="success count:".concat(u.length,", fail count:").concat(l.length);c.setNetworkType(n.getNetworkType()).setMoreMessage("".concat(d)).end(),He.l("".concat(i," groupID:").concat(r," from remote, ").concat(d));var p=[];return tn(u)||(n._getTopicTimeMap.set(r,{time:Date.now(),isGetAll:s}),p=n._getLocalTopicList(r,u)),pa({successTopicList:p,failureTopicList:l})})).catch((function(e){return n.probeNetwork(e).then((function(t){var n=v(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),He.e("".concat(i," failed. error:"),e),va(e)}))}},{key:"hasLocalTopic",value:function(e,t){return!!this._topicMap.has(e)&&this._topicMap.get(e).has(t)}},{key:"getLocalTopic",value:function(e,t){var n=null;return this._topicMap.has(e)&&(n=this._topicMap.get(e).get(t)),n}},{key:"_getLocalTopicList",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this._topicMap.get(e),i=[];return n&&(i=_(n.values())),0===t.length?i:i.filter((function(e){return t.includes(e.topicID)}))}},{key:"_deleteLocalTopic",value:function(e,t){this._topicMap.has(e)&&(this._topicMap.get(e).delete(t),He.l("".concat(this._n,"._deleteLocalTopic groupID:").concat(e," topicID:").concat(t)))}},{key:"_updateTopicMap",value:function(e){var t=this,n=[];e.forEach((function(e){var i=e.groupID,r=e.topicID,o=null;t._topicMap.has(i)||t._topicMap.set(i,new Map),t._topicMap.get(i).has(r)?(o=t._topicMap.get(i).get(r)).updateTopic(e):(t._getTopicLastMessage(e),o=new ls(e,t.isIntl()),t._topicMap.get(i).set(r,o));var a=t._computeUnreadCount(o);o.updateUnreadCount(a),n.push({conversationID:"".concat(b.CONV_GROUP).concat(r),type:b.CONV_TOPIC,unreadCount:a})})),n.length>0&&this.getModule(zn).updateTopicConversation(n)}},{key:"resetGetTopicTime",value:function(e){var t=this;ht(e)?_(this._getTopicTimeMap.keys()).forEach((function(e){t._getTopicTimeMap.set(e,0)})):this._getTopicTimeMap.set(e,0)}},{key:"getTopicListOnReconnected",value:function(){var e=this,t=_(this._topicMap.keys()),n=[];t.forEach((function(t){var i=[];e._getLocalTopicList(t).forEach((function(t){var n=t.lastMessage.lastTime,r=void 0===n?0:n;Date.now()-1e3*r<1e3*e.TOPIC_LAST_ACTIVE_TIME&&i.push(t.topicID)})),i.length>0&&n.push({groupID:t,topicIDList:i})})),He.l("".concat(this._n,".getTopicListOnReconnected. active community count:").concat(n.length)),this._relayGetTopicList(n)}},{key:"_relayGetTopicList",value:function(e){var t=this;if(0!==e.length){var n=e.shift(),i=n.topicIDList.length>5?"topicIDList.length:".concat(n.topicIDList.length):"topicIDList:".concat(n.topicIDList),r=new $o("relayGetTopicList");r.setMessage(i),He.l("".concat(this._n,"._relayGetTopicList. ").concat(i)),this.getTopicList(n).then((function(){r.setNetworkType(t.getNetworkType()).end(),t._relayGetTopicList(e)})).catch((function(n){t.probeNetwork().then((function(e){var t=v(e,2),i=t[0],o=t[1];r.setError(n,i,o).end()})),t._relayGetTopicList(e)}))}}},{key:"_handleTopicAtInfo",value:function(e){var n=this;0!==e.length&&e.forEach((function(e){var i=e.groupID,r=e.topicID,o=e.groupAtInfoList,a=[];ht(o)||(o.forEach((function(e){a.push(t(t({},e),{},{groupID:i,topicID:r}))})),n.getModule(zn).onNewGroupAtTips({dataList:a}))}))}},{key:"_getTopicLastMessage",value:function(e){if(!ht(e.lastMsg)){var t={time:e.lastMsg.time,sequence:e.lastMsg.sequence,from:e.lastMsg.from,payload:e.lastMsg.elements[0]?e.lastMsg.elements[0].content:null,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:"",nick:e.lastMsg.nick,version:e.lastMsg.messageVersion,cloudCustomData:e.lastMsg.cloudCustomData,isRevoked:2===e.lastMsg.isPlaceMessage,revoker:tn(e.lastMsg.revokerInfo)?null:e.lastMsg.revokerInfo.revoker};e.lastMessage=t}}},{key:"deleteTopicListInCommunity",value:function(e){var t=this,n=this._getLocalTopicList(e),i=this.getModule(zn);n.forEach((function(n){var r=n.topicID;t._deleteLocalTopic(e,r),t._getTopicTimeMap.delete(e),i.deleteLocalConversation("".concat(b.CONV_GROUP).concat(r))}))}},{key:"_computeUnreadCount",value:function(e){var t=e.selfInfo,n=t.excludedUnreadSequenceList,i=t.readedSequence,r=e.nextMessageSeq-e.selfInfo.readedSequence-1;if(pt(n)){var o=0;n.forEach((function(t){t>=i&&t<=e.nextMessageSeq-1&&(o+=1)})),o>=1&&(r-=o)}return r<0?0:r}},{key:"_filterProfanity",value:function(e,t){var n=this.getModule(li);if(!n)return!0;var i=n.filterText(t[e],J),r=i.isAllowedToSend,o=i.modifiedText;return!0===r&&(t[e]=o,!0)}},{key:"updateLastMessage",value:function(e,t){var n=Wt(e),i=this.getLocalTopic(n,e);if(i){var r=t.sequence+1;i.updateNextMessageSeq(r),i.updateLastMessage(t),this.emitOuterEvent(k.TOPIC_UPDATED,{groupID:n,topic:i})}}},{key:"getMessageExtensions",value:function(e,t){He.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t));var n=Wt(e.to);return this.request({protocolName:zr,requestData:{groupID:n,topicID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;He.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n));var i=Wt(e.to);return this.request({protocolName:Kr,requestData:{groupID:i,topicID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._topicMap.clear(),this._getTopicTimeMap.clear(),this.TOPIC_CACHE_TIME=300,this.TOPIC_LAST_ACTIVE_TIME=3600}}]),r}(fi),ps=function(){function e(t){i(this,e),this._userModule=t,this._n="ProfileHandler",this.TAG="profile",this.accountProfileMap=new Map,this.expirationTime=864e5}return o(e,[{key:"setExpirationTime",value:function(e){this.expirationTime=e}},{key:"getUserProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getUserProfile"),i=e.userIDList;e.fromAccount=this._userModule.getMyAccount(),i.length>100&&(He.w("".concat(n," ").concat(Zt(100))),i.length=100);for(var r,o=[],a=[],s=0,c=i.length;s<c;s++)r=i[s],this._userModule.isMyFriend(r)&&this._contains(r)?a.push(this._getProfileFromMap(r)):o.push(r);if(0===o.length)return ma(a);e.toAccount=o;var u=e.bFromGetMyProfile||!1,l=[];e.toAccount.forEach((function(e){l.push({toAccount:e,standardSequence:0,customSequence:0})})),e.userItem=l;var d=new $o("getUserProfile");return d.setMessage(i.length>5?"userIDList.length:".concat(i.length):"userIDList:".concat(i)),this._userModule.request({protocolName:Ci,requestData:e}).then((function(e){d.setNetworkType(t._userModule.getNetworkType()).end(),He.i("".concat(n," ok"));var i=t._handleResponse(e).concat(a);return pa(u?i[0]:i)})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];d.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"getMyProfile",value:function(){var e=this._userModule.getMyAccount(),t="".concat(this._n,".getMyProfile");if(He.l("".concat(t," myAccount:").concat(e)),this._fill(),this._contains(e)){var n=this._getProfileFromMap(e);return He.d("".concat(t," from cache, myProfile:").concat(JSON.stringify(n))),ma(n)}return this.getUserProfile({fromAccount:e,userIDList:[e],bFromGetMyProfile:!0})}},{key:"_handleResponse",value:function(e){var t=e.data.userProfileItem;if(!pt(t))return[];for(var n=[],i=Date.now(),r=0,o=t.length;r<o;r++){var a=t[r],s=a.to,c=a.profileItem;if("@TLS#NOT_FOUND"!==s&&""!==s){var u=this._update(s,this._getLatestProfileFromResponse(s,c)).latestProfile;n.push(u)}}return He.l("".concat(this._n,"._handleResponse cost ").concat(Date.now()-i," ms")),n}},{key:"_getLatestProfileFromResponse",value:function(e,t){var n={userID:e,profileCustomField:[]};if(!tn(t))for(var i=0,r=t.length;i<r;i++)if(t[i].tag.indexOf("Tag_Profile_Custom")>-1)n.profileCustomField.push({key:t[i].tag,value:t[i].value});else switch(t[i].tag){case Ke.NICK:n.nick=t[i].value;break;case Ke.GENDER:n.gender=t[i].value;break;case Ke.BIRTHDAY:n.birthday=t[i].value;break;case Ke.LOCATION:n.location=t[i].value;break;case Ke.SELFSIGNATURE:n.selfSignature=t[i].value;break;case Ke.ALLOWTYPE:n.allowType=t[i].value;break;case Ke.LANGUAGE:n.language=t[i].value;break;case Ke.AVATAR:n.avatar=t[i].value;break;case Ke.MESSAGESETTINGS:n.messageSettings=t[i].value;break;case Ke.ADMINFORBIDTYPE:n.adminForbidType=t[i].value;break;case Ke.LEVEL:n.level=t[i].value;break;case Ke.ROLE:n.role=t[i].value;break;default:He.w("".concat(this._n,"._getLatestProfileFromResponse unknown tag:"),t[i].tag,t[i].value)}return n}},{key:"updateMyProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateMyProfile");if(e.nick&&!1===this._userModule.filterProfanity("nick",e))return va({code:No.PROFANITY_FOUND});if(e.selfSignature&&!1===this._userModule.filterProfanity("selfSignature",e))return va({code:No.PROFANITY_FOUND});var i=new $o("updateMyProfile");i.setMessage(JSON.stringify(e));var r=(new Aa).validate(e);if(!r.valid)return i.setCode(No.UPDATE_PROFILE_INVALID_PARAM).setMoreMessage("info:".concat(r.tips)).setNetworkType(this._userModule.getNetworkType()).end(),He.e("".concat(n," info:").concat(r.tips)),va({code:No.UPDATE_PROFILE_INVALID_PARAM});var o=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&("profileCustomField"===a?e.profileCustomField.forEach((function(e){o.push({tag:e.key,value:e.value})})):o.push({tag:Ke[a.toUpperCase()],value:e[a]}));if(0===o.length){var s=new ha({code:No.UPDATE_PROFILE_NO_KEY});return i.setError(s,!0,this._userModule.getNetworkType()).end(),He.e("".concat(n," failed. error:"),s),va(s)}var c=this._userModule.getMyAccount();return this._userModule.request({protocolName:Si,requestData:{fromAccount:c,profileItem:o}}).then((function(r){i.setNetworkType(t._userModule.getNetworkType()).end(),He.i("".concat(n," ok"));var o=t._update(c,e),a=o.isProfileUpdated,s=o.latestProfile;return!0===a&&t._userModule.emitOuterEvent(k.PROFILE_UPDATED,[s]),ma(s)})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"onProfileModified",value:function(e){var t=e.dataList;if(!tn(t)){var n,i=t.length;He.d("".concat(this._n,".onProfileModified count:").concat(i," dataList:"),e.dataList);for(var r=[],o=0;o<i;o++){n=t[o].userID;var a=this._update(n,this._getLatestProfileFromResponse(n,t[o].profileList)),s=a.isProfileUpdated,c=a.latestProfile;!0===s&&r.push(c)}r.length>0&&(this._userModule.emitInnerEvent(Ta,r),this._userModule.emitOuterEvent(k.PROFILE_UPDATED,r))}}},{key:"_fill",value:function(){if(0===this.accountProfileMap.size){for(var e=this._getCachedProfiles(),t=Date.now(),n=0,i=e.length;n<i;n++)t-e[n].lastUpdatedTime<this.expirationTime&&this.accountProfileMap.set(e[n].userID,e[n]);He.l("".concat(this._n,"._fill from cache, size:").concat(this.accountProfileMap.size))}}},{key:"_update",value:function(e,t){var n,i=!1,r=Date.now();return this._contains(e)?(n=this._getProfileFromMap(e),t.profileCustomField&&!0===wt(n.profileCustomField,t.profileCustomField)&&(n.lastUpdatedTime=r,i=!0),yt(n,t,["profileCustomField"])>0&&(n.lastUpdatedTime=r,i=!0)):(n=new Aa(t),(this._userModule.isMyFriend(e)||e===this._userModule.getMyAccount())&&(n.lastUpdatedTime=r,i=!0,this.accountProfileMap.set(e,n))),this._flush(e===this._userModule.getMyAccount()),He.l("".concat(this._n,"._update account:").concat(e," isProfileUpdated:").concat(i)),{isProfileUpdated:i,latestProfile:n}}},{key:"_flush",value:function(e){var t=_(this.accountProfileMap.values()),n=this._userModule.getStorageModule();He.d("".concat(this._n,"._flush length:").concat(t.length," flushAtOnce:").concat(e)),n.setItem(this.TAG,t,e)}},{key:"_contains",value:function(e){return this.accountProfileMap.has(e)}},{key:"_getProfileFromMap",value:function(e){return this.accountProfileMap.get(e)}},{key:"_getCachedProfiles",value:function(){var e=this._userModule.getStorageModule().getItem(this.TAG);return tn(e)?[]:e}},{key:"onConversationsProfileUpdated",value:function(e){for(var t,n,i,r=[],o=0,a=e.length;o<a;o++)n=(t=e[o]).userID,this._userModule.isMyFriend(n)||(this._contains(n)?(i=this._getProfileFromMap(n),yt(i,t)>0&&r.push(n)):r.push(t.userID));0!==r.length&&(He.i("".concat(this._n,".onConversationsProfileUpdated toAccountList:").concat(r)),this.getUserProfile({userIDList:r}))}},{key:"getNickAndAvatarByUserID",value:function(e){if(this._contains(e)){var t=this._getProfileFromMap(e);return{nick:t.nick,avatar:t.avatar}}return{nick:"",avatar:""}}},{key:"reset",value:function(){this._flush(!0),this.accountProfileMap.clear()}}]),e}(),hs=o((function e(t){i(this,e),tn||(this.userID=t.userID||"",this.timeStamp=t.timeStamp||0)})),fs=function(){function e(t){i(this,e),this._userModule=t,this._n="BlacklistHandler",this._blacklistMap=new Map,this.startIndex=0,this.maxLimited=100,this.currentSequence=0}return o(e,[{key:"getLocalBlacklist",value:function(){return _(this._blacklistMap.keys())}},{key:"getBlacklist",value:function(){var e=this,t="".concat(this._n,".getBlacklist"),n={fromAccount:this._userModule.getMyAccount(),maxLimited:this.maxLimited,startIndex:0,lastSequence:this.currentSequence},i=new $o("getBlacklist");return this._userModule.request({protocolName:Ei,requestData:n}).then((function(n){var r=n.data,o=r.blackListItem,a=r.currentSequence,s=tn(o)?0:o.length;i.setNetworkType(e._userModule.getNetworkType()).setMessage("count:".concat(s)).end(),He.i("".concat(t," ok")),e.currentSequence=a,e._handleResponse(o,!0),e._userModule.emitOuterEvent(k.BLACKLIST_UPDATED,_(e._blacklistMap.keys()))})).catch((function(n){return e._userModule.probeNetwork().then((function(e){var t=v(e,2),r=t[0],o=t[1];i.setError(n,r,o).end()})),He.e("".concat(t," failed. error:"),n),va(n)}))}},{key:"addBlacklist",value:function(e){var t=this,n=new $o("addToBlacklist"),i="".concat(this._n,".addBlacklist"),r=this._userModule.getMyAccount();if(1===e.userIDList.length&&e.userIDList[0]===r){var o=No.CANNOT_ADD_SELF_TO_BLACKLIST,a=this._userModule.getErrorMessage(o);n.setCode(o).setMessage(a).setNetworkType(this._userModule.getNetworkType()).end();var s=new ha({code:o});return He.e("".concat(i," failed. error:"),s),va(s)}return e.userIDList.includes(r)&&(e.userIDList=e.userIDList.filter((function(e){return e!==r}))),e.fromAccount=this._userModule.getMyAccount(),e.toAccount=e.userIDList,this._userModule.request({protocolName:ki,requestData:e}).then((function(r){return n.setNetworkType(t._userModule.getNetworkType()).setMessage(e.userIDList.length>5?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),He.i("".concat(i," ok")),t._handleResponse(r.resultItem,!0),pa(_(t._blacklistMap.keys()))})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var i=v(t,2),r=i[0],o=i[1];n.setError(e,r,o).end()})),He.e("".concat(i," failed. error:"),e),va(e)}))}},{key:"_handleResponse",value:function(e,t){if(!tn(e))for(var n,i,r,o=0,a=e.length;o<a;o++)i=e[o].to,r=e[o].resultCode,(ht(r)||0===r)&&(t?((n=this._blacklistMap.has(i)?this._blacklistMap.get(i):new hs).userID=i,!tn(e[o].addBlackTimeStamp)&&(n.timeStamp=e[o].addBlackTimeStamp),this._blacklistMap.set(i,n)):this._blacklistMap.has(i)&&(n=this._blacklistMap.get(i),this._blacklistMap.delete(i)));He.l("".concat(this._n,"._handleResponse total:").concat(this._blacklistMap.size," bAdd:").concat(t))}},{key:"deleteBlacklist",value:function(e){var t=this,n="".concat(this._n,".deleteBlacklist"),i=new $o("removeFromBlacklist");return e.fromAccount=this._userModule.getMyAccount(),e.toAccount=e.userIDList,this._userModule.request({protocolName:bi,requestData:e}).then((function(r){return i.setNetworkType(t._userModule.getNetworkType()).setMessage(e.userIDList.length>5?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),He.i("".concat(n," ok")),t._handleResponse(r.data.resultItem,!1),pa(_(t._blacklistMap.keys()))})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"onAccountDeleted",value:function(e){for(var t,n=[],i=0,r=e.length;i<r;i++)t=e[i],this._blacklistMap.has(t)&&(this._blacklistMap.delete(t),n.push(t));n.length>0&&(He.l("".concat(this._n,".onAccountDeleted count:").concat(n.length," userIDList:"),n),this._userModule.emitOuterEvent(k.BLACKLIST_UPDATED,_(this._blacklistMap.keys())))}},{key:"onAccountAdded",value:function(e){for(var t,n=[],i=0,r=e.length;i<r;i++)t=e[i],this._blacklistMap.has(t)||(this._blacklistMap.set(t,new hs({userID:t})),n.push(t));n.length>0&&(He.l("".concat(this._n,".onAccountAdded count:").concat(n.length," userIDList:"),n),this._userModule.emitOuterEvent(k.BLACKLIST_UPDATED,_(this._blacklistMap.keys())))}},{key:"reset",value:function(){this._blacklistMap.clear(),this.startIndex=0,this.maxLimited=100,this.currentSequence=0}}]),e}(),gs=function(e){var t=String(e).replace(/[=]+$/,""),n="";if(t.length%4==1)return"";for(var i,r,o=0,a=0;r=t.charAt(a++);~r&&(i=o%4?64*i+r:r,o++%4)?n+=String.fromCharCode(255&i>>(-2*o&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);try{return decodeURIComponent(escape(n))}catch(s){return""}},ms=function(){function e(t){i(this,e),this._userModule=t,this._n="UserStatusHandler",this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100,this._userModule.getInnerEmitterInstance().on(Ma,this._onCloudConfigUpdated,this)}return o(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this._userModule.getCloudConfig("status_query_count"),t=this._userModule.getCloudConfig("status_sub_count"),n=this._userModule.getCloudConfig("status_unsub_count");He.l("".concat(this._n,"._onCloudConfigUpdated statusQueryCount:").concat(e," statusSubscribeCount:").concat(t)+" statusUnsubscribeCount:".concat(n)),ht(e)||(this.MAX_QUERY_USER_COUNT=parseInt(e,10)),ht(e)||(this.MAX_SUBSCRIBE_USER_COUNT=parseInt(t,10)),ht(e)||(this.MAX_UNSUBSCRIBE_USER_COUNT=parseInt(n,10))}},{key:"onUserStatusUpdated",value:function(e){var t=e.dataList,n=this._userModule.getMyUserID(),i=this._userModule.getModule(Wn),r=t.map((function(e){var t=e.to,r=e.statusType,o=e.customStatus,a=gs(o);return t===n&&i.setCustomStatus(a),{userID:t,statusType:r,customStatus:a}}));this._userModule.emitOuterEvent(k.USER_STATUS_UPDATED,r)}},{key:"setSelfStatus",value:function(e){var t=this,n="".concat(this._n,".setSelfStatus");if(!1===this._userModule.filterProfanity("customStatus",e))return va({code:No.PROFANITY_FOUND});var i=new $o("setSelfStatus"),r=e.customStatus;return this._userModule.request({protocolName:Eo,requestData:{customStatus:r}}).then((function(e){return i.setNetworkType(t._userModule.getNetworkType()).setMessage("customStatus:".concat(r)).end(),He.l("".concat(n," ok. customStatus:").concat(r)),t._userModule.getModule(Wn).setCustomStatus(r),pa({userID:t._userModule.getMyUserID(),statusType:1,customStatus:r})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"getUserStatus",value:function(e){var t=this,n="".concat(this._n,".getUserStatus"),i=e.userIDList,r=void 0===i?[]:i,o=this._userModule.getMyUserID(),a=_(r),s=void 0,c=a.indexOf(o);if(c>-1){a.splice(c,1);var u=this._userModule.getModule(Wn).getCustomStatus();s={userID:o,statusType:1,customStatus:u}}if(0===a.length)return ma({successUserList:[s],failureUserList:[]});if(!this._userModule.canIUse(H.USER_STATUS))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});a.length>this.MAX_QUERY_USER_COUNT&&(He.w("".concat(n," ").concat(Zt(this.MAX_QUERY_USER_COUNT))),a=r.slice(0,this.MAX_QUERY_USER_COUNT));var l=new $o("getUserStatus");return this._userModule.request({protocolName:ko,requestData:{userIDList:a}}).then((function(e){var i=e.data,o=i.successUserList,a=void 0===o?[]:o,c=i.failureUserList,u=void 0===c?[]:c,d=a.map((function(e){var t=e.userID,n=e.statusType,i=e.customStatus;return{userID:t,statusType:n,customStatus:gs(i)}})),p=u.map((function(e){var t=e.userID,n=e.invalidUserID,i=e.errorCode,r=e.errorInfo;return{userID:tn(n)?t:n,code:i,message:r}}));ht(s)||d.unshift(s);var h="userID count:".concat(r.length,", success count:").concat(d.length,", fail count:").concat(p.length);return l.setNetworkType(t._userModule.getNetworkType()).setMessage("".concat(h)).end(),He.l("".concat(n," ok. ").concat(h,".")),pa({successUserList:d,failureUserList:p})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];l.setMessage("userID count:".concat(r.length)).setError(e,i,o).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"subscribeUserStatus",value:function(e){var t=this;if(!this._userModule.canIUse(H.USER_STATUS))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".subscribeUserStatus"),i=e.userIDList,r=void 0===i?[]:i,o=_(r);o.length>this.MAX_SUBSCRIBE_USER_COUNT&&(He.w("".concat(n," ").concat(Zt(this.MAX_SUBSCRIBE_USER_COUNT))),o=r.slice(0,this.MAX_SUBSCRIBE_USER_COUNT));var a=new $o("subscribeUserStatus"),s="userID count:".concat(r.length);return He.l("".concat(n," ").concat(s)),this._userModule.request({protocolName:bo,requestData:{userIDList:o}}).then((function(e){var i=e.data.failureUserList,r=(void 0===i?[]:i).map((function(e){var t=e.userID,n=e.invalidUserID,i=e.errorCode,r=e.errorInfo;return{userID:tn(n)?t:n,code:i,message:r}}));return a.setNetworkType(t._userModule.getNetworkType()).setMessage("".concat(s," fail count:").concat(r.length)).end(),He.l("".concat(n," ok. fail count:").concat(r.length,".")),pa({failureUserList:r})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setMessage("".concat(s)).setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"unsubscribeUserStatus",value:function(e){var t=this;if(!this._userModule.canIUse(H.USER_STATUS))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".unsubscribeUserStatus"),i=(e||{}).userIDList,r=void 0===i?[]:i,o=_(r);r.length>this.MAX_UNSUBSCRIBE_USER_COUNT&&(He.w("".concat(n," ").concat(Zt(this.MAX_UNSUBSCRIBE_USER_COUNT))),o=r.slice(0,this.MAX_UNSUBSCRIBE_USER_COUNT));var a=new $o("unsubscribeUserStatus"),s="userID count:".concat(r.length);He.l("".concat(n," ").concat(s));var c={userIDList:o};return 0===o.length&&(c.userIDList=void 0,c.unsubscribeAll=1),this._userModule.request({protocolName:Do,requestData:c}).then((function(e){var i=e.data.failureUserList,r=(void 0===i?[]:i).map((function(e){var t=e.userID,n=e.invalidUserID,i=e.errorCode,r=e.errorInfo;return{userID:tn(n)?t:n,code:i,message:r}}));return a.setNetworkType(t._userModule.getNetworkType()).setMessage("".concat(s," fail count:").concat(r.length)).end(),He.l("".concat(n," ok. fail count:").concat(r.length,".")),pa({failureUserList:r})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setMessage("".concat(s)).setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"reset",value:function(){this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100}}]),e}(),vs=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="UserModule",r._profileHandler=new ps(f(r)),r._blacklistHandler=new fs(f(r)),r._userStatusHandler=new ms(f(r)),r.getInnerEmitterInstance().on(Ia,r.onContextUpdated,f(r)),r}return o(n,[{key:"onContextUpdated",value:function(e){this._profileHandler.getMyProfile(),this._blacklistHandler.getBlacklist()}},{key:"onProfileModified",value:function(e){this._profileHandler.onProfileModified(e)}},{key:"onRelationChainModified",value:function(e){var t=e.dataList;if(!tn(t)){var n=[];t.forEach((function(e){e.blackListDelAccount&&n.push.apply(n,_(e.blackListDelAccount))})),n.length>0&&this._blacklistHandler.onAccountDeleted(n);var i=[];t.forEach((function(e){e.blackListAddAccount&&i.push.apply(i,_(e.blackListAddAccount))})),i.length>0&&this._blacklistHandler.onAccountAdded(i)}}},{key:"onConversationsProfileUpdated",value:function(e){this._profileHandler.onConversationsProfileUpdated(e)}},{key:"getMyAccount",value:function(){return this.getMyUserID()}},{key:"getMyProfile",value:function(){return this._profileHandler.getMyProfile()}},{key:"getStorageModule",value:function(){return this.getModule(Yn)}},{key:"filterProfanity",value:function(e,t){var n=this.getModule(li);if(!n)return!0;var i=n.filterText(t[e],Y),r=i.isAllowedToSend,o=i.modifiedText;return!0===r&&(t[e]=o,!0)}},{key:"isMyFriend",value:function(e){var t=this.getModule(Hn);return!!t&&t.isMyFriend(e)}},{key:"getUserProfile",value:function(e){return this._profileHandler.getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._profileHandler.updateMyProfile(e)}},{key:"getNickAndAvatarByUserID",value:function(e){return this._profileHandler.getNickAndAvatarByUserID(e)}},{key:"getLocalBlacklist",value:function(){var e=this._blacklistHandler.getLocalBlacklist();return ma(e)}},{key:"addBlacklist",value:function(e){return this._blacklistHandler.addBlacklist(e)}},{key:"deleteBlacklist",value:function(e){return this._blacklistHandler.deleteBlacklist(e)}},{key:"onUserStatusUpdated",value:function(e){this._userStatusHandler.onUserStatusUpdated(e)}},{key:"setSelfStatus",value:function(e){return this._userStatusHandler.setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._userStatusHandler.getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._userStatusHandler.subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._userStatusHandler.unsubscribeUserStatus(e)}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._profileHandler.reset(),this._blacklistHandler.reset(),this._userStatusHandler.reset()}}]),n}(fi),_s=function(){function e(t,n){i(this,e),this._m=t,this._isLoggedIn=!1,this._SDKAppID=n.SDKAppID,this._userID=n.userID||"",this._userSig=n.userSig||"",this._version="2.27.1",this._a2Key="",this._tinyID="",this._customStatus="",this._contentType="json",this._unlimitedAVChatRoom=n.unlimitedAVChatRoom,this._scene=n.scene||"",this._oversea=n.oversea,this._instanceID=n.instanceID,this._statusInstanceID=0,this._isDevMode=n.devMode,this._proxyServer=n.proxyServer,this._fileUploadProxy=n.fileUploadProxy,this._fileDownloadProxy=n.fileDownloadProxy}return o(e,[{key:"isLoggedIn",value:function(){return this._isLoggedIn}},{key:"isOversea",value:function(){return this._oversea}},{key:"isPrivateNetWork",value:function(){return this._proxyServer}},{key:"isDevMode",value:function(){return this._isDevMode}},{key:"isSingaporeSite",value:function(){return this._SDKAppID>=2e7&&this._SDKAppID<3e7||this._SDKAppID>=172e7&&this._SDKAppID<173e7}},{key:"isKoreaSite",value:function(){return this._SDKAppID>=3e7&&this._SDKAppID<4e7||this._SDKAppID>=173e7&&this._SDKAppID<174e7}},{key:"isGermanySite",value:function(){return this._SDKAppID>=4e7&&this._SDKAppID<5e7||this._SDKAppID>=174e7&&this._SDKAppID<175e7}},{key:"isIndiaSite",value:function(){return this._SDKAppID>=5e7&&this._SDKAppID<6e7||this._SDKAppID>=175e7&&this._SDKAppID<176e7}},{key:"isJapanSite",value:function(){return this._SDKAppID>=6e7&&this._SDKAppID<7e7||this._SDKAppID>=176e7&&this._SDKAppID<177e7}},{key:"isUSASite",value:function(){return this._SDKAppID>=7e7&&this._SDKAppID<8e7||this._SDKAppID>=177e7&&this._SDKAppID<178e7}},{key:"isIntl",value:function(){return 0===(e=this._SDKAppID)||e>=2e7&&e<8e7||e>=172e7&&e<178e7;var e}},{key:"isUnlimitedAVChatRoom",value:function(){return this._unlimitedAVChatRoom}},{key:"setUserID",value:function(e){this._userID=e}},{key:"getUserID",value:function(){return this._userID}},{key:"setUserSig",value:function(e){this._userSig=e}},{key:"getUserSig",value:function(){return this._userSig}},{key:"getSDKAppID",value:function(){return this._SDKAppID}},{key:"setTinyID",value:function(e){this._tinyID=e,this._isLoggedIn=!0}},{key:"getTinyID",value:function(){return this._tinyID}},{key:"setCustomStatus",value:function(e){this._customStatus=e}},{key:"getCustomStatus",value:function(){return this._customStatus}},{key:"getScene",value:function(){return Re?window.tencent_cloud_im_csig_flutter_for_web_25F_cy:this._isTUIKit()?"tuikit":this._scene}},{key:"getInstanceID",value:function(){return this._instanceID}},{key:"getStatusInstanceID",value:function(){return this._statusInstanceID}},{key:"setStatusInstanceID",value:function(e){this._statusInstanceID=e}},{key:"getVersion",value:function(){return this._version}},{key:"getA2Key",value:function(){return this._a2Key}},{key:"setA2Key",value:function(e){this._a2Key=e}},{key:"getContentType",value:function(){return this._contentType}},{key:"getProxyServer",value:function(){return this._proxyServer}},{key:"getFileUploadProxy",value:function(){return this._fileUploadProxy}},{key:"getFileDownloadProxy",value:function(){return this._fileDownloadProxy}},{key:"_isTUIKit",value:function(){var e=!1,t=!1,n=!1,i=!1,r=[];ae&&(r=Object.keys(ce)),se&&(r=oe?Object.keys(uni):Object.keys(window));for(var o=0,a=r.length;o<a;o++)if(r[o].toLowerCase().includes("uikit")){e=!0;break}if(r=null,ae&&!gt(ce.createGamePortal)&&gt(getApp)&&!ht(getApp())){var s=getApp().globalData;dt(s)&&!0===s.isTUIKit&&(t=!0)}!0===this._m.getModule(Yn).getStorageSync("TIM_".concat(this._SDKAppID,"_isTUIKit"))&&(n=!0);var c=null;if(Z&&!ee&&"undefined"==typeof uni&&__wxConfig&&(c=__wxConfig.pages),Q&&"undefined"==typeof uni&&__qqConfig&&(c=__qqConfig.pages),pt(c)&&c.length>0){for(var u=0,l=c.length;u<l;u++)if(c[u].toLowerCase().includes("tui")){i=!0;break}c=null}return e||t||n||i}},{key:"reset",value:function(){this._isLoggedIn=!1,this._userSig="",this._a2Key="",this._tinyID="",this._customStatus="",this._statusInstanceID=0}}]),e}(),ys=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="SignModule",r._helloInterval=120,r._lastLoginTs=0,r._lastWsHelloTs=0,r._isWebUniapp=0,Ca.mixin(f(r)),r}return o(n,[{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this._helloInterval==0&&this._hello()}},{key:"login",value:function(e){var t="";if(this.isLoggedIn()){var n=this.getMyUserID();return(t=this.getErrorMessage("RepeatLogin",n))&&He.w(t),ma({actionStatus:"OK",errorCode:0,errorInfo:t,repeatLogin:!0})}if(Date.now()-this._lastLoginTs<=15e3)return this.outputWarning("LoggingIn",e.userID),va({code:No.REPEAT_LOGIN});He.l("".concat(this._n,".login userID:").concat(e.userID));var i=this._checkLoginInfo(e);if(0!==i.code)return va(i);var r=this.getModule(Wn),o=e.userID,a=e.userSig;return r.setUserID(o),r.setUserSig(a),this.getModule(ti).updateProtocolConfig(),this._login()}},{key:"_login",value:function(){var e=this,t=this.getModule(Wn),n=t.getScene(),i=0,r=new $o("login");r.setMessage("".concat(n)).setMoreMessage("identifier:".concat(this.getMyUserID())),oe?"tuikit"===n?r.setUIPlatform(4):r.setUIPlatform(3):ae?"tuikit"===n?r.setUIPlatform(12):r.setUIPlatform(11):se&&(Re?"flutter_web_uikit"===n?r.setUIPlatform(21):r.setUIPlatform(20):this._isReactUIKit()?Ae?r.setUIPlatform(25):r.setUIPlatform(24):Ae?"tuikit"===n?r.setUIPlatform(17):r.setUIPlatform(16):"tuikit"===n?r.setUIPlatform(14):r.setUIPlatform(13));var o=this.getModule(ui);if(o.canIUseOfflinePush()){this._isWebUniapp=o.getUniAppPlatform();var a=this._getStatusInstanceID();t.setStatusInstanceID(a),this.getModule(ti).updateProtocolConfig(),i=o.getDeviceBrand()}var s="".concat(this._n,"._login");return this._lastLoginTs=Date.now(),this.request({protocolName:gi,requestData:{deviceBrand:i,isWebUniapp:this._isWebUniapp}}).then((function(i){e._lastLoginTs=0;var o=Date.now(),a=null,c=i.data,u=c.a2Key,l=c.tinyID,d=c.helloInterval,p=c.instanceID,h=c.timeStamp,f=c.customStatus,g=void 0===f?"":f;He.l("".concat(s," ok. scene:").concat(n," helloInterval:").concat(d," instanceID:").concat(p," timeStamp:").concat(h));var m=1e3*h,v=o-r.getStartTs(),_=m+parseInt(v/2)-o,y=r.getStartTs()+_;if(r.start(y),function(e,t){Ue=t;var n=new Date;n.setTime(e),He.i("baseTime from server:".concat(n," offset:").concat(Ue))}(m,_),!l)throw a=new ha({code:No.NO_TINYID}),r.setError(a,!0,e.getNetworkType()).end(),a;if(!u)throw a=new ha({code:No.NO_A2KEY}),r.setError(a,!0,e.getNetworkType()).end(),a;var I=gs(g);r.setNetworkType(e.getNetworkType()).setMoreMessage("helloInterval:".concat(d," instanceID:").concat(p," offset:").concat(_," customStatus:").concat(I)).end(),t.setA2Key(u),t.setTinyID(l),t.setStatusInstanceID(p),t.setCustomStatus(I),e.getModule(ti).updateProtocolConfig(),e.emitInnerEvent(Ia),e._helloInterval=d,e.triggerReady();var M=e.getModule(ui);return M.canIUseOfflinePush()&&(uni.setStorageSync("timUniAppInstanceID",p),M.init()),e._fetchCloudControlConfig(),e.getModule(li).init(),i})).catch((function(t){return e.probeNetwork().then((function(e){var n=v(e,2),i=n[0],o=n[1];r.setError(t,i,o).end(!0)})),e._m.setNotReadyReason(No.LOGIN_FAILED),He.e("".concat(s," failed. error:"),t),e._lastLoginTs=0,e._m.onLoginFailed(),va(t)}))}},{key:"logout",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this.isLoggedIn())return va({code:No.USER_NOT_LOGGED_IN});new $o("logout").setNetworkType(this.getNetworkType()).setMessage("identifier:".concat(this.getMyUserID())).end(!0);var n="".concat(this._n,".logout");return He.i("".concat(n," type:").concat(t)),0===t&&this._m.setNotReadyReason(No.LOGGED_OUT),this.request({protocolName:mi,requestData:{type:t}}).then((function(){return e.resetReady(),ma({})})).catch((function(t){return He.e("".concat(n," error:"),t),e.resetReady(),ma({})}))}},{key:"_fetchCloudControlConfig",value:function(){this.getModule(ri).fetchConfig()}},{key:"_getStatusInstanceID",value:function(){return uni.getStorageSync("timUniAppInstanceID")}},{key:"_hello",value:function(){var e=this;this._lastWsHelloTs=Date.now(),this.request({protocolName:vi,requestData:{isWebUniapp:this._isWebUniapp}}).catch((function(t){He.w("".concat(e._n,"._hello error:"),t)}))}},{key:"getLastWsHelloTs",value:function(){return this._lastWsHelloTs}},{key:"_checkLoginInfo",value:function(e){var t=0;return tn(this.getModule(Wn).getSDKAppID())?t=No.NO_SDKAPPID:tn(e.userID)?t=No.NO_IDENTIFIER:tn(e.userSig)&&(t=No.NO_USERSIG),{code:t}}},{key:"_isReactUIKit",value:function(){return se&&void 0!==window.tencent_cloud_im_csig_react_uikit_23F_xa}},{key:"onMultipleAccountKickedOut",value:function(e){var t=this;new $o("kickedOut").setNetworkType(this.getNetworkType()).setMessage("type:".concat(b.KICKED_OUT_MULT_ACCOUNT," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),He.w("".concat(this._n,".onMultipleAccountKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then((function(){t.emitOuterEvent(k.KICKED_OUT,{type:b.KICKED_OUT_MULT_ACCOUNT}),t._m.setNotReadyReason(No.KICKED_OUT_MULT_ACCOUNT),t._m.reset()}))}},{key:"onMultipleDeviceKickedOut",value:function(e){var t=this;new $o("kickedOut").setNetworkType(this.getNetworkType()).setMessage("type:".concat(b.KICKED_OUT_MULT_DEVICE," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),He.w("".concat(this._n,".onMultipleDeviceKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then((function(){t.emitOuterEvent(k.KICKED_OUT,{type:b.KICKED_OUT_MULT_DEVICE}),t._m.setNotReadyReason(No.KICKED_OUT_MULT_DEVICE),t._m.reset()}))}},{key:"onUserSigExpired",value:function(){new $o("kickedOut").setNetworkType(this.getNetworkType()).setMessage(b.KICKED_OUT_USERSIG_EXPIRED).end(!0),He.w("".concat(this._n,".onUserSigExpired: userSig expired")),0!==this.getModule(Wn).getStatusInstanceID()&&(this.emitOuterEvent(k.KICKED_OUT,{type:b.KICKED_OUT_USERSIG_EXPIRED}),this._m.setNotReadyReason(No.KICKED_OUT_USERSIG_EXPIRED),this._m.reset())}},{key:"onRestApiKickedOut",value:function(e){new $o("kickedOut").setNetworkType(this.getNetworkType()).setMessage("type:".concat(b.KICKED_OUT_REST_API," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),He.w("".concat(this._n,".onRestApiKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),0!==this.getModule(Wn).getStatusInstanceID()&&(this.emitOuterEvent(k.KICKED_OUT,{type:b.KICKED_OUT_REST_API}),this._m.setNotReadyReason(No.KICKED_OUT_REST_API),this._m.reset(),this.getModule(ni).onRestApiKickedOut())}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this.resetReady(),this._helloInterval=120,this._lastLoginTs=0,this._lastWsHelloTs=0,this._isWebUniapp=0}}]),n}(fi);function Is(){return null}var Ms=function(){function e(t){i(this,e),this._m=t,this._n="StorageModule",this._storageQueue=new Map,this._errorTolerantHandle()}return o(e,[{key:"_errorTolerantHandle",value:function(){ae||!ht(window)&&this._canIUseCookies()||(this.getItem=Is,this.setItem=Is,this.removeItem=Is,this.clear=Is)}},{key:"onCheckTimer",value:function(e){if(e%20==0){if(0===this._storageQueue.size)return;this._doFlush()}}},{key:"_doFlush",value:function(){try{var e,t=E(this._storageQueue);try{for(t.s();!(e=t.n()).done;){var n=v(e.value,2),i=n[0],r=n[1];this._setStorageSync(this._getKey(i),r)}}catch(o){t.e(o)}finally{t.f()}this._storageQueue.clear()}catch(a){He.w("".concat(this._n,"._doFlush error:"),a)}}},{key:"_getPrefix",value:function(){var e=this._m.getModule(Wn);return"TIM_".concat(e.getSDKAppID(),"_").concat(e.getUserID(),"_")}},{key:"_getKey",value:function(e){return"".concat(this._getPrefix()).concat(e)}},{key:"getItem",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;return this.getStorageSync(n)}catch(i){return He.w("".concat(this._n,".getItem error:"),i),{}}}},{key:"setItem",value:function(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]){var n=arguments.length>3&&void 0!==arguments[3]&&!arguments[3]?e:this._getKey(e);this._setStorageSync(n,t)}else this._storageQueue.set(e,t)}},{key:"clear",value:function(){try{ae?ce.clearStorageSync():this._canIUseCookies()&&localStorage.clear()}catch(e){He.w("".concat(this._n,".clear error:"),e)}}},{key:"removeItem",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;this._removeStorageSync(n)}catch(i){He.w("".concat(this._n,".removeItem error:"),i)}}},{key:"getSize",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"b";try{var i={size:0,limitSize:5242880,unit:n};if(Object.defineProperty(i,"leftSize",{enumerable:!0,get:function(){return i.limitSize-i.size}}),ae&&(i.limitSize=1024*ce.getStorageInfoSync().limitSize),e)i.size=JSON.stringify(this.getItem(e)).length+this._getKey(e).length;else if(ae)ce.getStorageInfoSync().keys.forEach((function(e){i.size+=JSON.stringify(t.getStorageSync(e)).length+t._getKey(e).length}));else if(this._canIUseCookies())for(var r in localStorage)localStorage.hasOwnProperty(r)&&(i.size+=localStorage.getItem(r).length+r.length);return this._convertUnit(i)}catch(o){He.w("".concat(this._n," error:"),o)}}},{key:"_convertUnit",value:function(e){var t={},n=e.unit;for(var i in t.unit=n,e)"number"==typeof e[i]&&("kb"===n.toLowerCase()?t[i]=Math.round(e[i]/1024):"mb"===n.toLowerCase()?t[i]=Math.round(e[i]/1024/1024):t[i]=e[i]);return t}},{key:"_setStorageSync",value:function(e,t){ae?ne?my.setStorageSync({key:e,data:t}):ce.setStorageSync(e,t):this._canIUseCookies()&&localStorage.setItem(e,JSON.stringify(t))}},{key:"getStorageSync",value:function(e){return ae?ne?my.getStorageSync({key:e}).data:ce.getStorageSync(e):this._canIUseCookies()?JSON.parse(localStorage.getItem(e)):{}}},{key:"_removeStorageSync",value:function(e){ae?ne?my.removeStorageSync({key:e}):ce.removeStorageSync(e):this._canIUseCookies()&&localStorage.removeItem(e)}},{key:"_canIUseCookies",value:function(){return navigator&&navigator.cookieEnabled&&localStorage}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._doFlush()}}]),e}(),Ts=function(){function e(t){i(this,e),this._n="SSOLogBody",this._report=[]}return o(e,[{key:"pushIn",value:function(e){He.d("".concat(this._n,".pushIn"),this._report.length,e),this._report.push(e)}},{key:"backfill",value:function(e){var t;pt(e)&&0!==e.length&&(He.d("".concat(this._n,".backfill"),this._report.length,e.length),(t=this._report).unshift.apply(t,_(e)))}},{key:"getLogsNumInMemory",value:function(){return this._report.length}},{key:"isEmpty",value:function(){return 0===this._report.length}},{key:"_reset",value:function(){this._report.length=0,this._report=[]}},{key:"getLogsInMemory",value:function(){var e=this._report.slice();return this._reset(),e}}]),e}(),Cs=function(e){var t=e.getModule(Wn);return{SDKType:10,SDKAppID:t.getSDKAppID(),SDKVersion:t.getVersion(),tinyID:Number(t.getTinyID()),userID:t.getUserID(),platform:e.getPlatform(),instanceID:t.getInstanceID(),traceID:xe()}},Ss=function(e){s(r,e);var n=m(r);function r(e){var t;i(this,r),(t=n.call(this,e))._n="EventStatModule",t.TAG="im-ssolog-event",t._reportBody=new Ts,t.MIN_THRESHOLD=20,t.MAX_THRESHOLD=100,t.WAITING_TIME=6e4,t.REPORT_LEVEL=[4,5,6],t.REPORT_SDKAPPID_BLACKLIST=[],t.REPORT_TINYID_WHITELIST=[],t._lastReportTime=Date.now();var o=t.getInnerEmitterInstance();return o.on(Ia,t._onLoginSuccess,f(t)),o.on(Ma,t._onCloudConfigUpdated,f(t)),t}return o(r,[{key:"reportAtOnce",value:function(){He.d("".concat(this._n,".reportAtOnce")),this._report()}},{key:"_onLoginSuccess",value:function(){var e=this,t=this.getModule(Yn),n=t.getItem(this.TAG,!1);!tn(n)&&gt(n.forEach)&&(He.l("".concat(this._n,"._onLoginSuccess get ssolog in storage, count:").concat(n.length)),n.forEach((function(t){e._reportBody.pushIn(t)})),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("evt_rpt_threshold"),t=this.getCloudConfig("evt_rpt_waiting"),n=this.getCloudConfig("evt_rpt_level"),i=this.getCloudConfig("evt_rpt_sdkappid_bl"),r=this.getCloudConfig("evt_rpt_tinyid_wl");ht(e)||(this.MIN_THRESHOLD=Number(e)),ht(t)||(this.WAITING_TIME=Number(t)),ht(n)||(this.REPORT_LEVEL=n.split(",").map((function(e){return Number(e)}))),ht(i)||(this.REPORT_SDKAPPID_BLACKLIST=i.split(",").map((function(e){return Number(e)}))),ht(r)||(this.REPORT_TINYID_WHITELIST=r.split(","))}},{key:"pushIn",value:function(e){e instanceof $o&&(e.updateTimeStamp(),this._reportBody.pushIn(e),this._reportBody.getLogsNumInMemory()>=this.MIN_THRESHOLD&&this._report())}},{key:"onCheckTimer",value:function(){Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()}},{key:"_filterLogs",value:function(e){var t=this,n=this.getModule(Wn),i=n.getSDKAppID(),r=n.getTinyID();return Kt(this.REPORT_SDKAPPID_BLACKLIST,i)&&!zt(this.REPORT_TINYID_WHITELIST,r)?[]:e.filter((function(e){return t.REPORT_LEVEL.includes(e.level)}))}},{key:"_report",value:function(){var e=this;if(!this._reportBody.isEmpty()){var n=this._reportBody.getLogsInMemory(),i=this._filterLogs(n);if(0!==i.length){var r={header:Cs(this),event:i};this.request({protocolName:so,requestData:t({},r)}).then((function(){e._lastReportTime=Date.now()})).catch((function(t){He.w("".concat(e._n,".report failed. networkType:").concat(e.getNetworkType()," error:"),t),e._reportBody.backfill(n),e._reportBody.getLogsNumInMemory()>e.MAX_THRESHOLD&&e._flushAtOnce()}))}else this._lastReportTime=Date.now()}}},{key:"_flushAtOnce",value:function(){var e=this.getModule(Yn),t=e.getItem(this.TAG,!1),n=this._reportBody.getLogsInMemory(),i="".concat(this._n,"._flushAtOnce");if(tn(t))He.l("".concat(i," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1);else{var r=n.concat(t);r.length>this.MAX_THRESHOLD&&(r=r.slice(0,this.MAX_THRESHOLD)),He.l("".concat(i," count:").concat(r.length)),e.setItem(this.TAG,r,!0,!1)}}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._lastReportTime=0,this._report(),this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[]}}]),r}(fi),Es="none",ks="online",bs=[No.OVER_FREQUENCY_LIMIT,No.OPEN_SERVICE_OVERLOAD_ERROR],Ds=function(){function e(t){i(this,e),this._m=t,this._networkType="",this._n="NetMonitorModule",this.MAX_WAIT_TIME=3e3,this._mpNetworkStatusCallback=null,this._webOnlineCallback=null,this._webOfflineCallback=null}return o(e,[{key:"start",value:function(){var e=this;ae?(ce.getNetworkType({success:function(t){e._networkType=t.networkType||t.subtype||"",t.networkType===Es?He.w("".concat(e._n,".start no network, please check!")):He.i("".concat(e._n,".start networkType:").concat(t.networkType))}}),this._mpNetworkStatusCallback=this._onNetworkStatusChange.bind(this),ce.onNetworkStatusChange(this._mpNetworkStatusCallback)):(this._networkType=ks,this._webOnlineCallback=this._onWebOnline.bind(this),this._webOfflineCallback=this._onWebOffline.bind(this),window&&(window.addEventListener("online",this._webOnlineCallback),window.addEventListener("offline",this._webOfflineCallback)))}},{key:"_onWebOnline",value:function(){this._onNetworkStatusChange({isConnected:!0,networkType:ks})}},{key:"_onWebOffline",value:function(){this._onNetworkStatusChange({isConnected:!1,networkType:Es})}},{key:"_onNetworkStatusChange",value:function(e){var t=e.isConnected,n=e.networkType,i="".concat(this._n,"._onNetworkStatusChange"),r=!1;t?(He.i("".concat(i," previous:").concat(this._networkType," current:").concat(n)),this._networkType!==n&&(r=!0,this._m.getModule(ni).reConnect(!0))):this._networkType!==n&&(r=!0,He.w("".concat(i," no network, please check!")),this._m.getModule(ni).offline()),r&&(new $o("networkChange").setMessage("isConnected:".concat(t," previousNetworkType:").concat(this._networkType," networkType:").concat(n)).end(),this._networkType=n)}},{key:"probe",value:function(e){var t=this;if(!ht(e)&&bs.includes(e.code))return Promise.resolve([!0,this._networkType]);var n="".concat(this._n,".probe");return new Promise((function(e,i){ae?ce.getNetworkType({success:function(i){t._networkType=i.networkType,i.networkType===Es?(He.w("".concat(n," no network, please check!")),e([!1,i.networkType])):(He.i("".concat(n," networkType:").concat(i.networkType)),e([!0,i.networkType]))}}):t._networkType===Es?e([!1,Es]):e([!0,ks])}))}},{key:"getNetworkType",value:function(){return this._networkType}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),ae?null!==this._mpNetworkStatusCallback&&(ce.offNetworkStatusChange&&(re||ee?ce.offNetworkStatusChange(this._mpNetworkStatusCallback):ce.offNetworkStatusChange()),this._mpNetworkStatusCallback=null):window&&(null!==this._webOnlineCallback&&(window.removeEventListener("online",this._webOnlineCallback),this._webOnlineCallback=null),null!==this._onWebOffline&&(window.removeEventListener("offline",this._webOfflineCallback),this._webOfflineCallback=null))}}]),e}(),ws=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,i,o,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new r(i,o||e,a),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},s.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,o=i.length,a=new Array(o);r<o;r++)a[r]=i[r].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},s.prototype.emit=function(e,t,i,r,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,r),!0;case 5:return l.fn.call(l.context,t,i,r,o),!0;case 6:return l.fn.call(l.context,t,i,r,o,a),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,h=l.length;for(u=0;u<h;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,i);break;case 4:l[u].fn.call(l[u].context,t,i,r);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,i,r){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||r&&!s.once||i&&s.context!==i||a(this,o);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==t||r&&!s[c].once||i&&s[c].context!==i)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s})),As=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="BigDataChannelModule",r.FILETYPE={SOUND:2106,FILE:2107,VIDEO:2113},r._bdh_download_server="grouptalk.c2c.qq.com",r._BDHBizID=10001,r._authKey="",r._expireTime=0,r.getInnerEmitterInstance().on(Ia,r._getAuthKey,f(r)),r}return o(n,[{key:"_getAuthKey",value:function(){var e=this;this.isIntl()||this.request({protocolName:Ii}).then((function(t){t.data.authKey&&(e._authKey=t.data.authKey,e._expireTime=parseInt(t.data.expireTime))}))}},{key:"_isFromOlderVersion",value:function(e){return!(!e.content||2===e.content.downloadFlag)}},{key:"parseElements",value:function(e,t){if(!pt(e)||!t)return[];for(var n=[],i=null,r=0;r<e.length;r++)i=e[r],this._needParse(i)?n.push(this._parseElement(i,t)):n.push(e[r]);return n}},{key:"_needParse",value:function(e){return!e.cloudCustomData&&!(!this._isFromOlderVersion(e)||e.type!==b.MSG_AUDIO&&e.type!==b.MSG_FILE&&e.type!==b.MSG_VIDEO)}},{key:"_parseElement",value:function(e,t){switch(e.type){case b.MSG_AUDIO:return this._parseAudioElement(e,t);case b.MSG_FILE:return this._parseFileElement(e,t);case b.MSG_VIDEO:return this._parseVideoElement(e,t)}}},{key:"_parseAudioElement",value:function(e,t){return e.content.url=this._genAudioUrl(e.content.uuid,t),e}},{key:"_parseFileElement",value:function(e,t){return e.content.url=this._genFileUrl(e.content.uuid,t,e.content.fileName),e}},{key:"_parseVideoElement",value:function(e,t){return e.content.url=this._genVideoUrl(e.content.uuid,t),e}},{key:"_genAudioUrl",value:function(e,t){if(""===this._authKey)return"";var n=this.getModule(Wn).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(n,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.SOUND,"&openid=").concat(t,"&ver=0")}},{key:"_genFileUrl",value:function(e,t,n){if(""===this._authKey)return"";n||(n="".concat(Math.floor(1e5*Math.random()),"-").concat(Date.now()));var i=this.getModule(Wn).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(i,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.FILE,"&openid=").concat(t,"&ver=0&filename=").concat(encodeURIComponent(n))}},{key:"_genVideoUrl",value:function(e,t){if(""===this._authKey)return"";var n=this.getModule(Wn).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(n,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.VIDEO,"&openid=").concat(t,"&ver=0")}},{key:"reset",value:function(){this._authKey="",this.expireTime=0}}]),n}(fi),Rs=["requestSnapshotUrl"],Ls=function(e){s(r,e);var n=m(r);function r(e){var t;i(this,r),(t=n.call(this,e))._n="UploadModule",t.TIMUploadPlugin=null,t.timUploadPlugin=null,t.COSSDK=null,t._cosUploadMethod=null,t.expiredTimeLimit=600,t.appid=0,t.bucketName="",t.ciUrl="",t.directory="",t.downloadUrl="",t.uploadUrl="",t.region="ap-shanghai",t.cos=null,t.cosOptions={secretId:"",secretKey:"",sessionToken:"",expiredTime:0},t.uploadFileType="",t.duration=900,t.tryCount=0,t.UPLOAD_SIZE_LIMIT={AUDIO:20971520,FILE:104857600,IMAGE:20971520,VIDEO:104857600};var o=t.getInnerEmitterInstance();return o.on(Ia,t._init,f(t)),o.on(Ma,t._onCloudConfigUpdated,f(t)),t}return o(r,[{key:"_init",value:function(){var e=this.getModule(Qn);if(this.TIMUploadPlugin=e.getPlugin("tim-upload-plugin"),this.TIMUploadPlugin)this._initUploaderMethod();else{var t=ae?"cos-wx-sdk":"cos-js-sdk";this.COSSDK=e.getPlugin(t),this.COSSDK?(this._getAuthorizationKey(),this.outputWarning("CosReplacement",t)):this.outputWarning("PluginUndetected")}}},{key:"_onCloudConfigUpdated",value:function(){var e="".concat(this._n,"._onCloudConfigUpdated"),t=this.getCloudConfig("upload_size_limit");if(He.l("".concat(e," uploadSizeLimit:").concat(t)),!ht(t))try{var n=JSON.parse(t);this.UPLOAD_SIZE_LIMIT={AUDIO:n.a?1048576*parseInt(n.a):this.UPLOAD_SIZE_LIMIT.AUDIO,FILE:n.f?1048576*parseInt(n.f):this.UPLOAD_SIZE_LIMIT.FILE,IMAGE:n.i?1048576*parseInt(n.i):this.UPLOAD_SIZE_LIMIT.IMAGE,VIDEO:n.v?1048576*parseInt(n.v):this.UPLOAD_SIZE_LIMIT.VIDEO}}catch(i){He.e("".concat(e," JSON parse error. uploadSizeLimit:"),t)}}},{key:"_getAuthorizationKey",value:function(){var e=this,t="".concat(this._n,".").concat("_getAuthorizationKey"),n=new $o("_getAuthorizationKey"),i=Math.ceil(Date.now()/1e3);this.request({protocolName:ro,requestData:{duration:this.expiredTimeLimit}}).then((function(r){var o=r.data;He.l("".concat(t," ok. data:"),o);var a=o.expiredTime-i;n.setMessage("requestId:".concat(o.requestId," requestTime:").concat(i," expiredTime:").concat(o.expiredTime," diff:").concat(a,"s")).setNetworkType(e.getNetworkType()).end(),!ae&&o.region&&(e.region=o.region),e.appid=o.appid,e.bucketName=o.bucketName,e.ciUrl=o.ciUrl,e.directory=o.directory,e.downloadUrl=o.downloadUrl,e.uploadUrl=o.uploadUrl,e.cosOptions={secretId:o.secretId,secretKey:o.secretKey,sessionToken:o.sessionToken,expiredTime:o.expiredTime},He.l("".concat(t," ok. region:").concat(e.region," bucketName:").concat(e.bucketName)),e._initUploaderMethod()})).catch((function(i){e.probeNetwork().then((function(e){var t=v(e,2),r=t[0],o=t[1];n.setError(i,r,o).end()})),He.w("".concat(t," failed. error:"),i)}))}},{key:"_getCosPreSigUrl",value:function(e){var t=this,n="".concat(this._n,".").concat("_getCosPreSigUrl"),i=Math.ceil(Date.now()/1e3),r=new $o("_getCosPreSigUrl");return this.request({protocolName:oo,requestData:{fileType:e.fileType,fileName:e.fileName,uploadMethod:e.uploadMethod,duration:e.duration}}).then((function(e){t.tryCount=0;var o=e.data||{},a=o.expiredTime-i;return He.l("".concat(n," ok. data:"),o),r.setMessage("requestId:".concat(o.requestId," expiredTime:").concat(o.expiredTime," diff:").concat(a,"s")).setNetworkType(t.getNetworkType()).end(),o})).catch((function(i){return-1===i.code&&(i.code=No.COS_GET_SIG_FAIL),t.probeNetwork().then((function(e){var t=v(e,2),n=t[0],o=t[1];r.setError(i,n,o).end()})),He.w("".concat(n," failed. error:"),i),t.tryCount<1?(t.tryCount++,t._getCosPreSigUrl(e)):(t.tryCount=0,va({code:No.COS_GET_SIG_FAIL}))}))}},{key:"_initUploaderMethod",value:function(){var e=this;if(this.TIMUploadPlugin)return this.timUploadPlugin=new this.TIMUploadPlugin,void(this._cosUploadMethod=function(t,n){e.timUploadPlugin.uploadFile(t,n)});this.appid&&(this.cos=ae?new this.COSSDK({ForcePathStyle:!0,getAuthorization:this._getAuthorization.bind(this)}):new this.COSSDK({getAuthorization:this._getAuthorization.bind(this)}),this._cosUploadMethod=ae?function(t,n){e.cos.postObject(t,n)}:function(t,n){e.cos.uploadFiles(t,n)})}},{key:"onCheckTimer",value:function(e){this.COSSDK&&(this.TIMUploadPlugin||this.isLoggedIn()&&e%60==0&&Math.ceil(Date.now()/1e3)>=this.cosOptions.expiredTime-120&&this._getAuthorizationKey())}},{key:"_getAuthorization",value:function(e,t){t({TmpSecretId:this.cosOptions.secretId,TmpSecretKey:this.cosOptions.secretKey,XCosSecurityToken:this.cosOptions.sessionToken,ExpiredTime:this.cosOptions.expiredTime})}},{key:"upload",value:function(e){if(!0===e.getRelayFlag())return Promise.resolve();var t=this.getModule(si);switch(e.type){case b.MSG_IMAGE:return t.addTotalCount(qo),this._uploadImage(e);case b.MSG_FILE:return t.addTotalCount(qo),this._uploadFile(e);case b.MSG_AUDIO:return t.addTotalCount(qo),this._uploadAudio(e);case b.MSG_VIDEO:return t.addTotalCount(qo),this._uploadVideo(e);default:return Promise.resolve()}}},{key:"_uploadImage",value:function(e){var n=this,i=this.getModule(Gn),r=e.getElements()[0],o=i.getMessageOption(e.clientSequence);return this.doUploadImage({file:o.payload.file,to:o.to,onProgress:function(e){if(r.updatePercent(e),gt(o.onProgress))try{o.onProgress(e)}catch(t){return va({code:No.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(i){var o,a,s=i.location,c=i.fileType,u=i.fileSize,l=i.width,d=i.height,p=i.smallImageUrl,h=i.smallImageWidth,f=i.smallImageHeight,g=i.largeImageUrl,m=i.largeImageWidth,v=i.largeImageHeight,_=n.isPrivateNetWork()?s:bt(s);return r.updateImageFormat(c),p&&g?(o={url:p,width:h,height:f},a={url:g,width:m,height:v}):(o=qt({originUrl:_,originWidth:l,originHeight:d,min:198}),a=qt({originUrl:_,originWidth:l,originHeight:d,min:720})),r.updateImageInfoArray([{size:u,url:_,width:l,height:d},t({},a),t({},o)]),e}))}},{key:"_uploadFile",value:function(e){var t=this,n=this.getModule(Gn),i=e.getElements()[0],r=n.getMessageOption(e.clientSequence);return this.doUploadFile({file:r.payload.file,to:r.to,onProgress:function(e){if(i.updatePercent(e),gt(r.onProgress))try{r.onProgress(e)}catch(t){return va({code:No.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(n){var r=n.location,o=t.isPrivateNetWork()?r:bt(r);return i.updateFileUrl(o),e}))}},{key:"_uploadAudio",value:function(e){var t=this,n=this.getModule(Gn),i=e.getElements()[0],r=n.getMessageOption(e.clientSequence);return this.doUploadAudio({file:r.payload.file,to:r.to,onProgress:function(e){if(i.updatePercent(e),gt(r.onProgress))try{r.onProgress(e)}catch(t){return va({code:No.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(n){var r=n.location,o=t.isPrivateNetWork()?r:bt(r);return i.updateAudioUrl(o),e}))}},{key:"_uploadVideo",value:function(e){var t=this,n=this.getModule(Gn),i=e.getElements()[0],r=n.getMessageOption(e.clientSequence);return this.doUploadVideo({file:r.payload.file,to:r.to,onProgress:function(e){if(i.updatePercent(e),gt(r.onProgress))try{r.onProgress(e)}catch(t){return va({code:No.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(n){var r=n.location,o=n.snapshotInfo,a=t.isPrivateNetWork()?r:bt(r);return i.updateVideoUrl(a),tn(o)||i.updateSnapshotInfo(o),e}))}},{key:"_checkSizeError",value:function(e){return va({code:No["MESSAGE_".concat(e,"_SIZE_LIMIT")],message:this.getErrorMessage("UploadSizeLimit",e.toLowerCase(),"".concat(this.UPLOAD_SIZE_LIMIT[e]/1048576," MB"))})}},{key:"doUploadImage",value:function(e){var t=this;if(!e.file)return va({code:No.MESSAGE_IMAGE_SELECT_FILE_FIRST});var n=this._checkImageType(e.file);if(!0!==n)return n;var i=this._checkImageSize(e.file);if(!0!==i)return i;var r=null;return this._setUploadFileType(ka),this.uploadByCOS(e).then((function(e){return r=e,t.isPrivateNetWork()?xt(e.location):xt("https://".concat(e.location))})).then((function(e){return r.width=e.width,r.height=e.height,Promise.resolve(r)}))}},{key:"_checkImageType",value:function(e){var t="";return t=ae?e.url.slice(e.url.lastIndexOf(".")+1):e.files[0].name.slice(e.files[0].name.lastIndexOf(".")+1),Sa.indexOf(t.toLowerCase())>=0||va({code:No.MESSAGE_IMAGE_TYPES_LIMIT})}},{key:"_checkImageSize",value:function(e){var t=0;return 0===(t=ae?e.size:e.files[0].size)?va({code:No.MESSAGE_FILE_IS_EMPTY}):t<this.UPLOAD_SIZE_LIMIT.IMAGE||this._checkSizeError("IMAGE")}},{key:"doUploadFile",value:function(e){return e.file?e.file.files[0].size>this.UPLOAD_SIZE_LIMIT.FILE?this._checkSizeError("FILE"):0===e.file.files[0].size?va({code:No.MESSAGE_FILE_IS_EMPTY}):(this._setUploadFileType(wa),this.uploadByCOS(e)):va({code:No.MESSAGE_FILE_SELECT_FILE_FIRST})}},{key:"doUploadVideo",value:function(e){return e.file.videoFile.size>this.UPLOAD_SIZE_LIMIT.VIDEO?this._checkSizeError("VIDEO"):0===e.file.videoFile.size?va({code:No.MESSAGE_FILE_IS_EMPTY}):-1===Ea.indexOf(e.file.videoFile.type)?va({code:No.MESSAGE_VIDEO_TYPES_LIMIT}):(this._setUploadFileType(ba),ae?this.handleVideoUpload({file:e.file.videoFile,onProgress:e.onProgress}):se?this.handleVideoUpload(e):void 0)}},{key:"handleVideoUpload",value:function(e){var t=this;return new Promise((function(n,i){t.uploadByCOS(e).then((function(e){n(e)})).catch((function(){t.uploadByCOS(e).then((function(e){n(e)})).catch((function(){i(new ha({code:No.MESSAGE_VIDEO_UPLOAD_FAIL}))}))}))}))}},{key:"doUploadAudio",value:function(e){return e.file?e.file.size>this.UPLOAD_SIZE_LIMIT.AUDIO?this._checkSizeError("AUDIO"):0===e.file.size?va({code:No.MESSAGE_FILE_IS_EMPTY}):(this._setUploadFileType(Da),this.uploadByCOS(e)):va({code:No.MESSAGE_AUDIO_UPLOAD_FAIL})}},{key:"uploadByCOS",value:function(e){var t=this;if(!gt(this._cosUploadMethod))return this.outputWarning("PluginUndetected"),va({code:No.COS_UNDETECTED});if(this.timUploadPlugin)return this._uploadWithPreSigUrl(e);var n=new $o("upload"),i="".concat(this._n,".uploadByCOS"),r=Date.now(),o=this._getFile(e);return new Promise((function(a,s){var c=ae?t._createCosOptionsWXMiniApp(e):t._createCosOptionsWeb(e),u=t;t._cosUploadMethod(c,(function(e,c){var l=Object.create(null);if(c){if(e||pt(c.files)&&c.files[0].error){var d=new ha({code:No.MESSAGE_FILE_UPLOAD_FAIL});return n.setError(d,!0,t.getNetworkType()).end(),He.l("".concat(i," failed. error:"),c.files[0].error),403===c.files[0].error.statusCode&&(He.w("".concat(i," failed. cos AccessKeyId was invalid, regain auth key!")),t._getAuthorizationKey()),void s(d)}l.fileName=o.name,l.fileSize=o.size,l.fileType=o.type.slice(o.type.indexOf("/")+1).toLowerCase(),l.location=ae?c.Location:c.files[0].data.Location;var p=Date.now()-r,h=u._formatFileSize(o.size),f=u._formatSpeed(1e3*o.size/p),g="size:".concat(h," time:").concat(p,"ms speed:").concat(f);He.l("".concat(i," success. name:").concat(o.name," ").concat(g)),a(l);var m=t.getModule(si);return m.addCost(qo,p),m.addFileSize(qo,o.size),void n.setNetworkType(t.getNetworkType()).setMessage(g).end()}var v=new ha({code:No.MESSAGE_FILE_UPLOAD_FAIL});n.setError(v,!0,u.getNetworkType()).end(),He.w("".concat(i," failed. error:"),e),403===e.statusCode&&(He.w("".concat(i," failed. cos AccessKeyId was invalid, regain auth key!")),t._getAuthorizationKey()),s(v)}))}))}},{key:"_uploadWithPreSigUrl",value:function(e){var t=this,n="".concat(this._n,"._uploadWithPreSigUrl"),i=this._getFile(e);return this._createCosOptionsPreSigUrl(e).then((function(e){return new Promise((function(r,o){var a=new $o("upload"),s=e.requestSnapshotUrl,c=void 0===s?void 0:s,u=h(e,Rs),l=Date.now();t._cosUploadMethod(u,(function(e,s){if(e||403===s.statusCode)return a.setError(new ha(e),!0,t.getNetworkType()).end(),He.l("".concat(n," failed, error:"),e),void o(new ha({code:No.MESSAGE_FILE_UPLOAD_FAIL}));var d=Object.create(null),p=s.data.location||"";t.isPrivateNetWork()||0!==p.indexOf("https://")&&0!==p.indexOf("http://")||(p=p.split("//")[1]),d.fileName=i.name,d.fileSize=i.size,d.fileType=i.type.slice(i.type.indexOf("/")+1).toLowerCase(),d.location=p;var h=Date.now()-l,f=t._formatFileSize(i.size),g=t._formatSpeed(1e3*i.size/h),m="size:".concat(f,",time:").concat(h,"ms,speed:").concat(g," res:").concat(JSON.stringify(s.data));He.l("".concat(n," success name:").concat(i.name,",").concat(m)),a.setNetworkType(t.getNetworkType()).setMessage(m).end();var v=t.getModule(si);v.addCost(qo,h),v.addFileSize(qo,i.size);var _=[];if(u.thumbUrl&&u.largeUrl&&(_=[t._getSmallImageInfoByUrl(u.thumbUrl,d),t._getLargeImageInfoByUrl(u.largeUrl,d)]),c&&_.push(t._getSnapshotInfoByUrl(c,d)),_.length>0)return Promise.all(_).then((function(){r(d)}));r(d)}))}))}))}},{key:"_getRawOrUploadProxyUrl",value:function(e){var t=this.getModule(Wn).getFileUploadProxy(),n=e;return t&&(n=e.replace(/^https:\/\/[^/]+/,t)),n}},{key:"_getFile",value:function(e){var t;return pt(e.file.files)||(t=e.file.files,"filelist"===vt(t))?e.file.files[0]:e.file}},{key:"_formatFileSize",value:function(e){return e<1024?e+"B":e<1048576?Math.floor(e/1024)+"KB":Math.floor(e/1048576)+"MB"}},{key:"_formatSpeed",value:function(e){return e<=1048576?jt(e/1024,1)+"KB/s":jt(e/1048576,1)+"MB/s"}},{key:"_createCosOptionsWeb",value:function(e){var t=this._getFile(e),n=t.name,i=n.slice(n.lastIndexOf(".")),r=this._genFileName("".concat(Tt(999999)).concat(i));return{files:[{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(r),Body:t}],SliceSize:1048576,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){He.w("onProgress callback error:",n)}},onFileFinish:function(e,t,n){}}}},{key:"_createCosOptionsWXMiniApp",value:function(e){var t=this._getFile(e),n=this._genFileName(t.name),i=t.url;return{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(n),FilePath:i,onProgress:function(t){if(He.l(JSON.stringify(t)),"function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){He.w("onProgress callback error:",n)}}}}},{key:"_createCosOptionsPreSigUrl",value:function(e){var t=this,n="",i="",r=0,o=this._getFile(e);if(ae)n=this._genFileName(o.name),i=o.url,r=1;else{var a=o.name,s=a.slice(a.lastIndexOf("."));n=this._genFileName("".concat(Tt(999999)).concat(s)),i=o,r=0}return this._getCosPreSigUrl({fileType:this.uploadFileType,fileName:n,uploadMethod:r,duration:this.duration}).then((function(r){var o=r.uploadUrl,a=r.downloadUrl,s=r.requestSnapshotUrl,c=void 0===s?void 0:s,u=r.thumbUrl,l=r.largeUrl;return{url:t._getRawOrUploadProxyUrl(o),fileType:t.uploadFileType,fileName:n,resources:i,downloadUrl:a,requestSnapshotUrl:c,thumbUrl:u,largeUrl:l,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){He.w("onProgress callback error:",n),He.e(n)}}}}))}},{key:"_genFileName",value:function(e){return"".concat(Gt(),"-").concat(e)}},{key:"_setUploadFileType",value:function(e){this.uploadFileType=e}},{key:"_getSnapshotInfoByUrl",value:function(e,t){var n=this,i=new $o("getSnapshotInfo");return this.request({protocolName:ao,requestData:{platform:this.getPlatform(),coverName:this._genFileName(Tt(99999)),requestSnapshotUrl:e}}).then((function(e){var n=(e.data||{}).snapshotUrl;return i.setMessage("snapshotUrl:".concat(n)).end(),tn(n)?{}:xt(n).then((function(e){t.snapshotInfo={snapshotUrl:n,snapshotWidth:e.width,snapshotHeight:e.height}}))})).catch((function(e){return He.w("".concat(n._n,"._getSnapshotInfoByUrl failed. error:"),e),i.setCode(e.errorCode).setMessage(e.errorInfo).end(),{}}))}},{key:"_getSmallImageInfoByUrl",value:function(e,t){return xt(e).then((function(n){t.smallImageUrl=e,t.smallImageWidth=n.width,t.smallImageHeight=n.height}))}},{key:"_getLargeImageInfoByUrl",value:function(e,t){return xt(e).then((function(n){t.largeImageUrl=e,t.largeImageWidth=n.width,t.largeImageHeight=n.height}))}},{key:"reset",value:function(){He.l("".concat(this._n,".reset"))}}]),r}(fi),Os=["downloadKey","pbDownloadKey","messageList"],Ns=function(){function e(t){i(this,e),this._n="MergerMessageHandler",this._messageModule=t}return o(e,[{key:"uploadMergerMessage",value:function(e,t){var n=this,i="".concat(this._n,".").concat("uploadMergerMessage");He.d("".concat(i," message:"),e,"messageBytes:".concat(t));var r=e.payload.messageList,o=r.length,a=new $o("uploadMergerMessage");return this._messageModule.request({protocolName:fo,requestData:{messageList:r}}).then((function(e){He.d("".concat(i," ok. response:"),e.data);var r=e.data,s=r.pbDownloadKey,c=r.downloadKey,u={pbDownloadKey:s,downloadKey:c,messageNumber:o};return a.setNetworkType(n._messageModule.getNetworkType()).setMessage("".concat(o,"-").concat(t,"-").concat(c)).end(),u})).catch((function(e){throw He.w("".concat(i," failed. error:"),e),n._messageModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),e}))}},{key:"downloadMergerMessage",value:function(e){var n=this,i="".concat(this._n,".").concat("downloadMergerMessage");He.d("".concat(i," message:"),e);var r=e.payload.downloadKey,o=this._messageModule.getFileDownloadProxy(),a=new $o("downloadMergerMessage");return a.setMessage("downloadKey:".concat(r)),this._messageModule.request({protocolName:go,requestData:{downloadKey:r}}).then((function(r){if(He.d("".concat(i," ok. response:"),r.data),gt(e.clearElement)){var s=e.payload;s.downloadKey,s.pbDownloadKey,s.messageList;var c=h(s,Os);e.clearElement(),e.setElement({type:e.type,content:t({messageList:r.data.messageList},c)},o)}else{var u=[];r.data.messageList.forEach((function(e){if(!tn(e)){var t=new ca(e,o);u.push(t)}})),e.payload.messageList=u,e.payload.downloadKey="",e.payload.pbDownloadKey=""}return a.setNetworkType(n._messageModule.getNetworkType()).end(),e})).catch((function(e){throw He.w("".concat(i," failed. key:").concat(r," error:"),e),n._messageModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),e}))}},{key:"createMergerMessagePack",value:function(e,t,n){return e.conversationType===b.CONV_C2C?this._createC2CMergerMessagePack(e,t,n):this._createGroupMergerMessagePack(e,t,n)}},{key:"_createC2CMergerMessagePack",value:function(e,t,n){var i=null;t&&(t.offlinePushInfo&&(i=t.offlinePushInfo),!0===t.onlineUserOnly&&(i?i.disablePush=!0:i={disablePush:!0}));var r=[];if(dt(t)&&dt(t.messageControlInfo)){var o=t.messageControlInfo,a=o.excludedFromUnreadCount,s=o.excludedFromLastMessage,c=o.excludedFromContentModeration;!0===a&&r.push("NoUnread"),!0===s&&r.push("NoLastMsg"),!0===c&&r.push("NoMsgCheck")}var u="";ut(e.cloudCustomData)&&e.cloudCustomData.length>0&&(u=e.cloudCustomData);var l=n.pbDownloadKey,d=n.downloadKey,p=n.messageNumber,h=e.payload,f=h.title,g=h.abstractList,m=h.compatibleText,v=this._messageModule.getModule(qn),_=v&&v.isOnlineMessage(e,t)?0:void 0;return{protocolName:Mi,tjgID:this._messageModule.generateTjgID(e),requestData:{fromAccount:this._messageModule.getMyUserID(),toAccount:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:l,downloadKey:d,title:f,abstractList:g,compatibleText:m,messageNumber:p}}],cloudCustomData:u,clientTime:e.clientTime,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:_,offlinePushInfo:i?{pushFlag:!0===i.disablePush?1:0,title:i.title||"",desc:i.description||"",ext:i.extension||"",apnsInfo:{badgeMode:!0===i.ignoreIOSBadge?1:0},androidInfo:{OPPOChannelID:i.androidOPPOChannelID||""}}:void 0,messageControlInfo:0!==_?r:void 0,isSupportExtension:!0===e.isSupportExtension?1:0}}}},{key:"_createGroupMergerMessagePack",value:function(e,t,n){var i=null;t&&t.offlinePushInfo&&(i=t.offlinePushInfo);var r=[];if(dt(t)&&dt(t.messageControlInfo)){var o=t.messageControlInfo,a=o.excludedFromUnreadCount,s=o.excludedFromLastMessage,c=o.excludedFromContentModeration;!0===a&&r.push("NoUnread"),!0===s&&r.push("NoLastMsg"),!0===c&&r.push("NoMsgCheck")}var u="";ut(e.cloudCustomData)&&e.cloudCustomData.length>0&&(u=e.cloudCustomData);var l=n.pbDownloadKey,d=n.downloadKey,p=n.messageNumber,h=e.payload,f=h.title,g=h.abstractList,m=h.compatibleText,v=this._messageModule.getModule(Bn),_=v&&v.isOnlineMessage(e,t)?1:0;return{protocolName:Ti,tjgID:this._messageModule.generateTjgID(e),requestData:{fromAccount:this._messageModule.getMyUserID(),groupID:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:l,downloadKey:d,title:f,abstractList:g,compatibleText:m,messageNumber:p}}],random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:void 0,cloudCustomData:u,onlineOnlyFlag:_,offlinePushInfo:i?{pushFlag:!0===i.disablePush?1:0,title:i.title||"",desc:i.description||"",ext:i.extension||"",apnsInfo:{badgeMode:!0===i.ignoreIOSBadge?1:0},androidInfo:{OPPOChannelID:i.androidOPPOChannelID||""}}:void 0,clientTime:e.clientTime,needReadReceipt:!0!==e.needReadReceipt||v.isMessageFromOrToAVChatroom(e.to)?0:1,messageControlInfo:0===_?r:void 0,isSupportExtension:!0===e.isSupportExtension?1:0}}}}]),e}(),Ps={ERR_SVR_COMM_SENSITIVE_TEXT:80001,ERR_SVR_COMM_BODY_SIZE_LIMIT:80002,OPEN_SERVICE_OVERLOAD_ERROR:60022,ERR_SVR_MSG_PKG_PARSE_FAILED:20001,ERR_SVR_MSG_INTERNAL_AUTH_FAILED:20002,ERR_SVR_MSG_INVALID_ID:20003,ERR_SVR_MSG_PUSH_DENY:20006,ERR_SVR_MSG_IN_PEER_BLACKLIST:20007,ERR_SVR_MSG_BOTH_NOT_FRIEND:20009,ERR_SVR_MSG_NOT_PEER_FRIEND:20010,ERR_SVR_MSG_NOT_SELF_FRIEND:20011,ERR_SVR_MSG_SHUTUP_DENY:20012,ERR_SVR_GROUP_INVALID_PARAMETERS:10004,ERR_SVR_GROUP_PERMISSION_DENY:10007,ERR_SVR_GROUP_NOT_FOUND:10010,ERR_SVR_GROUP_INVALID_GROUPID:10015,ERR_SVR_GROUP_REJECT_FROM_THIRDPARTY:10016,ERR_SVR_GROUP_SHUTUP_DENY:10017,MESSAGE_SEND_FAIL:2100,OVER_FREQUENCY_LIMIT:2996},Us=[No.MESSAGE_ONPROGRESS_FUNCTION_ERROR,No.MESSAGE_IMAGE_SELECT_FILE_FIRST,No.MESSAGE_IMAGE_TYPES_LIMIT,No.MESSAGE_FILE_IS_EMPTY,No.MESSAGE_IMAGE_SIZE_LIMIT,No.MESSAGE_FILE_SELECT_FILE_FIRST,No.MESSAGE_FILE_SIZE_LIMIT,No.MESSAGE_VIDEO_SIZE_LIMIT,No.MESSAGE_VIDEO_TYPES_LIMIT,No.MESSAGE_AUDIO_UPLOAD_FAIL,No.MESSAGE_AUDIO_SIZE_LIMIT,No.COS_UNDETECTED];function xs(e){var t=!1;return Object.values(Ps).includes(e)&&(t=!0),(e>=120001&&e<=13e4||e>=10100&&e<=10200)&&(t=!0),t}var Gs=function(e){s(r,e);var n=m(r);function r(e){var t;return i(this,r),(t=n.call(this,e))._n="MessageModule",t._messageOptionsMap=new Map,t._mergerMessageHandler=new Ns(f(t)),t}return o(r,[{key:"createTextMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new da(e),i="string"==typeof e.payload?e.payload:e.payload.text,r=new Jo({text:i}),o=this._getNickAndAvatarByUserID(t);return n.setElement(r),n.setNickAndAvatar(o),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createImageMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new da(e);if(ae){var i=e.payload.file;if(st(i))return void this.outputWarning("FileUnsupportedInMP","createImageMessage");var r=i.tempFiles[0].path||i.tempFiles[0].tempFilePath,o={url:r,name:r.slice(r.lastIndexOf("/")+1),size:i.tempFiles&&i.tempFiles[0].size||1,type:r.slice(r.lastIndexOf(".")+1).toLowerCase()};e.payload.file=o}else if(se)if(st(e.payload.file)){var a=e.payload.file;e.payload.file={files:[a]}}else if(dt(e.payload.file)&&"undefined"!=typeof uni){var s=e.payload.file.tempFiles[0];e.payload.file={files:[s]}}var c=new Xo({imageFormat:je.UNKNOWN,uuid:this._generateUUID(e.payload.file),file:e.payload.file}),u=this._getNickAndAvatarByUserID(t);return n.setElement(c),n.setNickAndAvatar(u),n.setNameCard(this._getNameCardByGroupID(n)),this._messageOptionsMap.set(n.clientSequence,e),n}},{key:"createAudioMessage",value:function(e){var t=e.payload.file;if(ae){var n={url:t.tempFilePath,name:t.tempFilePath.slice(t.tempFilePath.lastIndexOf("/")+1),size:t.fileSize,second:parseInt(t.duration)/1e3,type:t.tempFilePath.slice(t.tempFilePath.lastIndexOf(".")+1).toLowerCase()};e.payload.file=n}var i=this.getMyUserID();e.currentUser=i,e.senderTinyID=this.getMyTinyID();var r=new da(e),o=new Qo({second:Math.floor(t.duration/1e3),size:t.fileSize||t.size,url:t.tempFilePath,uuid:this._generateUUID(e.payload.file)}),a=this._getNickAndAvatarByUserID(i);return r.setElement(o),r.setNickAndAvatar(a),r.setNameCard(this._getNameCardByGroupID(r)),this._messageOptionsMap.set(r.clientSequence,e),r}},{key:"createVideoMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID(),e.payload.file.thumbUrl="",e.payload.file.thumbSize=0;var n={};if(ae){if(ne)return void this.outputWarning("VideoUnsupportedInAlipay");if(st(e.payload.file))return void this.outputWarning("FileUnsupportedInMP","createVideoMessage");var i=e.payload.file;pt(i.tempFiles)&&(i=i.tempFiles[0]),n.url=i.tempFilePath,n.name=i.tempFilePath.slice(i.tempFilePath.lastIndexOf("/")+1),n.size=i.size||1,n.second=i.duration||0,n.type=i.tempFilePath.slice(i.tempFilePath.lastIndexOf(".")+1).toLowerCase()}else if(se){if(st(e.payload.file)){var r=e.payload.file;e.payload.file.files=[r]}else if(dt(e.payload.file)&&"undefined"!=typeof uni){var o=e.payload.file.tempFile;e.payload.file.files=[o]}var a=e.payload.file;n.url=window.URL.createObjectURL(a.files[0]),n.name=a.files[0].name,n.size=a.files[0].size||1,n.second=a.files[0].duration||0,n.type=a.files[0].type.split("/")[1]}e.payload.file.videoFile=n;var s=new da(e),c=new aa({videoFormat:n.type,videoSecond:jt(n.second,0),videoSize:n.size,remoteVideoUrl:"",videoUrl:n.url,videoUUID:this._generateUUID(e.payload.file.videoFile),thumbUUID:this._generateUUID(e.payload.file.videoFile),thumbWidth:e.payload.file.width||200,thumbHeight:e.payload.file.height||200,thumbUrl:e.payload.file.thumbUrl,thumbSize:e.payload.file.thumbSize,thumbFormat:e.payload.file.thumbUrl.slice(e.payload.file.thumbUrl.lastIndexOf(".")+1).toLowerCase()}),u=this._getNickAndAvatarByUserID(t);return s.setElement(c),s.setNickAndAvatar(u),s.setNameCard(this._getNameCardByGroupID(s)),this._messageOptionsMap.set(s.clientSequence,e),s}},{key:"createCustomMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new da(e),i=new oa({data:e.payload.data,description:e.payload.description,extension:e.payload.extension}),r=this._getNickAndAvatarByUserID(t);return n.setElement(i),n.setNickAndAvatar(r),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createFaceMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new da(e),i=new Zo(e.payload),r=this._getNickAndAvatarByUserID(t);return n.setElement(i),n.setNickAndAvatar(r),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createMergerMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=this._getNickAndAvatarByUserID(t),i=new da(e),r=new ua(e.payload);return i.setElement(r),i.setNickAndAvatar(n),i.setNameCard(this._getNameCardByGroupID(i)),i.setRelayFlag(!0),i}},{key:"createForwardMessage",value:function(e){var t=e.to,n=e.conversationType,i=e.priority,r=e.payload,o=e.needReadReceipt,a=e.receiverList,s=this.getMyUserID(),c=this._getNickAndAvatarByUserID(s);if(r.type===b.MSG_GRP_TIP)return va({code:No.MESSAGE_FORWARD_TYPE_INVALID});var u={to:t,conversationType:n,conversationID:"".concat(n).concat(t),priority:i,isPlaceMessage:0,status:an.UNSEND,currentUser:s,senderTinyID:this.getMyTinyID(),cloudCustomData:e.cloudCustomData||r.cloudCustomData||"",needReadReceipt:o,receiverList:a,isSupportExtension:e.isSupportExtension||!1},l=new da(u);return l.setElement(r.getElements()[0]),l.setNickAndAvatar(c),l.setNameCard(this._getNameCardByGroupID(r)),l.setRelayFlag(!0),l}},{key:"downloadMergerMessage",value:function(e){return this._mergerMessageHandler.downloadMergerMessage(e)}},{key:"createFileMessage",value:function(e){if(ae){if(!Z&&!Q&&!re)return;var n=ce.getSystemInfoSync().SDKVersion;if(Z&&Vt(n,"2.5.0")<0)return void this.outputWarning("WXChooseMessageFile");if(Q&&Vt(n,"1.18.0")<0)return void this.outputWarning("QQChooseMessageFile")}if(se||re){if(st(e.payload.file)){var i=e.payload.file;e.payload.file={files:[i]}}else if(dt(e.payload.file)&&"undefined"!=typeof uni){var r=e.payload.file,o=r.tempFiles,a=r.files,s=null;pt(o)?s=o[0]:pt(a)&&(s=a[0]),e.payload.file={files:[s]}}}else if(Z||Q){var c=e.payload.file.tempFiles,u=t(t({},c[0]),{},{url:c[0].path});e.payload.file={files:[u]}}var l=this.getMyUserID();e.currentUser=l,e.senderTinyID=this.getMyTinyID();var d=new da(e),p=new ra({uuid:this._generateUUID(e.payload.file),file:e.payload.file}),h=this._getNickAndAvatarByUserID(l);return d.setElement(p),d.setNickAndAvatar(h),d.setNameCard(this._getNameCardByGroupID(d)),this._messageOptionsMap.set(d.clientSequence,e),d}},{key:"createLocationMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new da(e),i=new sa(e.payload),r=this._getNickAndAvatarByUserID(t);return n.setElement(i),n.setNickAndAvatar(r),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"_onCannotFindModule",value:function(){return va({code:No.CANNOT_FIND_MODULE})}},{key:"sendMessageInstance",value:function(e,t){var n=this;if(!1===this.getModule(li).filterMessage(e,t))return this._onSendMessageFailed(e,new ha({code:No.PROFANITY_FOUND}));var i,r=null;switch(e.conversationType){case b.CONV_C2C:if(!(r=this.getModule(qn)))return this._onCannotFindModule();break;case b.CONV_GROUP:if(!(r=this.getModule(Bn)))return this._onCannotFindModule();if(Rt({groupID:e.to})){var o=r.getLocalGroupProfile(e.to);if(o&&o.isSupportTopic)return va({code:No.MESSAGE_SEND_GROUP_WITH_TOPIC_FAIL})}break;default:return va({code:No.MESSAGE_SEND_INVALID_CONVERSATION_TYPE})}var a=this.getModule(Zn),s=this.getModule(Bn);return a.upload(e).then((function(){return n._getSendMessageSpecifiedKey(e)===Vo&&n.getModule(si).addSuccessCount(qo),s.guardForAVChatRoom(e).then((function(){if(!e.isSendable())return va({code:No.MESSAGE_FILE_URL_IS_EMPTY});n._addSendMessageTotalCount(e),i=Date.now();var o=function(e){var t="utf-8";se&&document&&(t=document.charset.toLowerCase());var n,i,r=0;if(i=e.length,"utf-8"===t||"utf8"===t)for(var o=0;o<i;o++)(n=e.codePointAt(o))<=127?r+=1:n<=2047?r+=2:n<=65535?r+=3:(r+=4,o++);else if("utf-16"===t||"utf16"===t)for(var a=0;a<i;a++)(n=e.codePointAt(a))<=65535?r+=2:(r+=4,a++);else r=e.replace(/[^\x00-\xff]/g,"aa").length;return r}(JSON.stringify(e));return e.type===b.MSG_MERGER&&o>11264?n._mergerMessageHandler.uploadMergerMessage(e,o).then((function(i){var r=n._mergerMessageHandler.createMergerMessagePack(e,t,i);return n.request(r)})):(n.getModule(zn).setMessageRandom(e),e.conversationType===b.CONV_C2C||e.conversationType===b.CONV_GROUP?r.sendMessage(e,t):void 0)})).then((function(o){var a=o.data,s=a.time,c=a.sequence,u=a.readReceiptCode;ct(u)&&0!==u&&(new $o("sendMessageWithReceipt").setMessage("from:".concat(e.from," to:").concat(e.to," sequence:").concat(c," readReceiptCode:").concat(u)).end(),He.w("".concat(n._n,".sendMessageInstance readReceiptCode:").concat(u," message:").concat(n.getErrorMessage(u)))),n._addSendMessageSuccessCount(e,i),n._messageOptionsMap.delete(e.clientSequence);var l=n.getModule(zn);e.status=an.SUCCESS,e.time=s;var d=!1;if(e.conversationType===b.CONV_GROUP)e.sequence=c;else if(e.conversationType===b.CONV_C2C){var p=l.getLatestMessageSentByMe(e.conversationID);if(p){var h=p.nick,f=p.avatar;h===e.nick&&f===e.avatar||(d=!0)}}if(d&&l.modifyMessageSentByMe({conversationID:e.conversationID,latestNick:e.nick,latestAvatar:e.avatar}),r.isOnlineMessage(e,t))e._onlineOnlyFlag=!0;else{l.appendToMessageList(e);var g=e;dt(t)&&dt(t.messageControlInfo)&&(!0===t.messageControlInfo.excludedFromLastMessage&&(e._isExcludedFromLastMessage=!0,g=""),!0===t.messageControlInfo.excludedFromUnreadCount&&(e._isExcludedFromUnreadCount=!0));var m=e.conversationType;Lt(e.to)&&(m=b.CONV_TOPIC,n.getModule(Kn).onMessageSent({groupID:Wt(e.to),topicID:e.to,lastMessage:g})),l.onMessageSent({conversationOptionsList:[{conversationID:e.conversationID,unreadCount:0,type:m,subType:e.conversationSubType,lastMessage:g}]})}return e.getRelayFlag()||"TIMImageElem"!==e.type||Bt(e.payload.imageInfoArray),pa({message:e})}))})).catch((function(t){return n._onSendMessageFailed(e,t)}))}},{key:"_onSendMessageFailed",value:function(e,t){e.status=an.FAIL,this.getModule(zn).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,t);var n=new $o("sendMessage");return n.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)),this.probeNetwork().then((function(e){var i=v(e,2),r=i[0],o=i[1];n.setError(t,r,o).end()})),He.e("".concat(this._n,"._onSendMessageFailed error:"),t),va(new ha({code:t&&t.code?t.code:No.MESSAGE_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if([b.MSG_IMAGE,b.MSG_AUDIO,b.MSG_VIDEO,b.MSG_FILE].includes(e.type))return Vo;if(e.conversationType===b.CONV_C2C)return xo;if(e.conversationType===b.CONV_GROUP){var t=this.getModule(Bn).getLocalGroupProfile(e.to);if(!t)return;var n=t.type;return At(n)?Fo:Go}}},{key:"_addSendMessageTotalCount",value:function(e){var t=this._getSendMessageSpecifiedKey(e);t&&this.getModule(si).addTotalCount(t)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n=Math.abs(Date.now()-t),i=this._getSendMessageSpecifiedKey(e);if(i){var r=this.getModule(si);r.addSuccessCount(i),r.addCost(i,n)}}},{key:"_addSendMessageFailCountOnUser",value:function(e,t){var n,i,r=t.code,o=void 0===r?-1:r,a=this.getModule(si),s=this._getSendMessageSpecifiedKey(e);s===Vo&&(n=o,i=!1,Us.includes(n)&&(i=!0),i)?a.addFailedCountOfUserSide(qo):xs(o)&&s&&a.addFailedCountOfUserSide(s)}},{key:"resendMessage",value:function(e){return e.isResend=!0,e.status=an.UNSEND,this.sendMessageInstance(e)}},{key:"revokeMessage",value:function(e){var t=this,n=null;if(e.conversationType===b.CONV_C2C?n=this.getModule(qn):e.conversationType===b.CONV_GROUP&&(n=this.getModule(Bn)),!n)return this._onCannotFindModule();var i=new $o("revokeMessage");i.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to));var r="".concat(this._n,".").concat("revokeMessage");return n.revokeMessage(e).then((function(n){var o=n.data.recallRetList;if(!tn(o)&&0!==o[0].retCode){var a=new ha({code:o[0].retCode,data:{message:e}});return i.setCode(a.code).setMoreMessage(a.message).end(),va(a)}return He.i("".concat(r," ok. ID:").concat(e.ID)),e.isRevoked=!0,i.end(),t.getModule(zn).onMessageRevoked([e]),pa({message:e})})).catch((function(n){t.probeNetwork().then((function(e){var t=v(e,2),r=t[0],o=t[1];i.setError(n,r,o).end()}));var o=new ha({code:n&&n.code?n.code:No.MESSAGE_REVOKE_FAIL,message:n&&n.message?n.message:void 0,data:{message:e}});return He.w("".concat(r," failed. error:"),n),va(o)}))}},{key:"deleteMessage",value:function(e){var t=this,n=null,i=e[0],r=i.conversationID,o="",a=[],s=[];if(i.conversationType===b.CONV_C2C)n=this.getModule(qn),o=r.replace(b.CONV_C2C,""),e.forEach((function(e){e&&e.status===an.SUCCESS&&e.conversationID===r&&(e._onlineOnlyFlag||a.push("".concat(e.sequence,"_").concat(e.random,"_").concat(e.time)),s.push(e))}));else if(i.conversationType===b.CONV_GROUP)n=this.getModule(Bn),o=r.replace(b.CONV_GROUP,""),e.forEach((function(e){e&&e.status===an.SUCCESS&&e.conversationID===r&&(e._onlineOnlyFlag||a.push("".concat(e.sequence)),s.push(e))}));else if(i.conversationType===b.CONV_SYSTEM)return va({code:No.CANNOT_DELETE_GROUP_SYSTEM_NOTICE});if(!n)return this._onCannotFindModule();if(0===a.length)return this._onMessageDeleted(s);a.length>30&&(a=a.slice(0,30),s=s.slice(0,30));var c=new $o("deleteMessage");c.setMessage("to:".concat(o," count:").concat(a.length));var u="".concat(this._n,".").concat("deleteMessage");return n.deleteMessage({to:o,keyList:a}).then((function(e){return c.end(),He.i("".concat(u," ok")),t._onMessageDeleted(s)})).catch((function(e){t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),He.w("".concat(u," failed. error:"),e);var n=new ha({code:e&&e.code?e.code:No.MESSAGE_DELETE_FAIL,message:e&&e.message?e.message:void 0});return va(n)}))}},{key:"_onMessageDeleted",value:function(e){return this.getModule(zn).onMessageDeleted(e),ma({messageList:e})}},{key:"translateText",value:function(e){var n="".concat(this._n,".").concat("translateText"),i=e.sourceTextList,r=e.sourceLanguage,o=e.targetLanguage,a=new $o("translateText");return a.setMessage("sourceLanguage:".concat(r," targetLanguage:").concat(o)),this.request({protocolName:Oo,requestData:{sourceTextList:i,source:r||"auto",target:o,from:this.getMyTinyID(),SDKAppID:this.getSDKAppID()}}).then((function(e){var i=e.data,r=i.error,o=i.requestID,s=i.translatedTextList;if(0===r.code)return a.end(),He.i("".concat(n," ok. requestID:").concat(o)),pa({translatedTextList:s});throw t(t({},r),{},{requestID:o})})).catch((function(e){return a.setCode(e.code).setMoreMessage(e.requestID).end(),He.w("".concat(n," failed. error:"),e),va({code:No.TRANSLATE_TEXT_FAIL})}))}},{key:"modifyRemoteMessage",value:function(e){var t=this,n=null,i=e.conversationType,r=e.to;if(this.getModule(Bn).isMessageFromOrToAVChatroom(r))return va({code:No.MESSAGE_MODIFY_DISABLED_IN_AVCHATROOM,data:{message:e}});if(!1===this.getModule(li).filterMessage(e))return va({code:No.PROFANITY_FOUND,data:{message:e}});i===b.CONV_C2C?n=this.getModule(qn):i===b.CONV_GROUP&&(n=this.getModule(Bn));var o=new $o("modifyMessage");o.setMessage("to:".concat(r));var a="".concat(this._n,".modifyRemoteMessage");return n.modifyRemoteMessage(e).then((function(n){o.end(),He.i("".concat(a," ok"));var i=t._onModifyRemoteMessageResp(e,n.data);return pa({message:i})})).catch((function(n){if(o.setCode(n.code).setMoreMessage(n.message).end(),He.w("".concat(a," failed. error:"),n),20027===n.code){var i=t._onModifyRemoteMessageResp(e,n.data);return va({code:No.MESSAGE_MODIFY_CONFLICT,data:{message:i}})}return va({code:n.code,message:n.message,data:{message:e}})}))}},{key:"_onModifyRemoteMessageResp",value:function(e,t){He.d("".concat(this._n,"._onModifyRemoteMessageResp options:"),t);var n=e.conversationType,i=e.from,r=e.to,o=e.random,a=e.sequence,s=e.time,c=t.elements,u=t.messageVersion,l=t.cloudCustomData,d=void 0===l?"":l;return this.getModule(zn).onMessageModified({conversationType:n,from:i,to:r,time:s,random:o,sequence:a,elements:c,cloudCustomData:d,messageVersion:u})}},{key:"_generateUUID",value:function(e){var t=this.getModule(Wn),n="".concat(t.getSDKAppID(),"-").concat(t.getUserID(),"-").concat(function(){for(var e="",t=32;t>0;--t)e+=Ct[Math.floor(Math.random()*St)];return e}()),i=e.name||e.value||e.url||e.tempFilePath,r=i&&i.slice(i.lastIndexOf(".")+1);return r&&(n="".concat(n,".").concat(r)),n}},{key:"getMessageOption",value:function(e){return this._messageOptionsMap.get(e)}},{key:"_getNickAndAvatarByUserID",value:function(e){return this.getModule(Vn).getNickAndAvatarByUserID(e)}},{key:"_getNameCardByGroupID",value:function(e){if(e.conversationType===b.CONV_GROUP){var t=this.getModule(Bn);if(t)return t.getMyNameCardByGroupID(e.to)}return""}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._messageOptionsMap.clear()}}]),r}(fi),Fs=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="MessageExtensionModule",r.messageExtensionMap=new Map,r.globalSeqMap=new Map,r.getMessageExtensionsMap=new Map,r}return o(n,[{key:"onMessageExtensionNotify",value:function(e){var t=this,n=e.dataList,i=n.messageInfo,r=n.operateType,o=n.operateResultList,a=n.tinyID,s=n.globalSequence,c=i.clientTime,u=i.random,l="".concat(a,"-").concat(c,"-").concat(u),d=[],p=[];He.l("".concat(this._n,".onMessageExtensionNotify messageID:").concat(l," operateType:").concat(r," globalSequence:").concat(s)),this._updateGlobalSequence(l,s);var h=!1,f=!1;o.forEach((function(e){var n=e.extensions,i=void 0===n?[]:n,o=e.clearSequence;1===r?(h=!0,i.forEach((function(e){d.push({key:e.key,value:e.value})})),t._updateLocalExtension(l,i)):2===r?(f=!0,i.forEach((function(e){p.push(e.key)})),t._updateLocalExtension(l,i)):3===r&&(f=!0,t._hasLocalExtension(l)&&t._getLocalExtension(l).forEach((function(e,t){e.seq<=o&&!tn(e.value)&&p.push(t)})),t._clearLocalExtension(l,o))})),h&&this.emitOuterEvent(k.MESSAGE_EXTENSIONS_UPDATED,{messageID:l,extensions:d}),f&&this.emitOuterEvent(k.MESSAGE_EXTENSIONS_DELETED,{messageID:l,keyList:p})}},{key:"setMessageExtensions",value:function(e,t){var n=this;if(!this.canIUse(H.MSG_EXT))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var i="".concat(this._n,".").concat("setMessageExtensions"),r=e.ID,o=e.conversationID,a=e.sequence,s=e.time,c=_(t);t.length>20&&(c=t.slice(0,20),He.w("".concat(i,". the length of extensions cannot exceed 20.")));var u="conversationID:".concat(o," messageID:").concat(r," sequence:").concat(a," time:").concat(s," count:").concat(c.length),l=new $o("setMessageExtensions");return l.setMessage(u),He.l("".concat(i," ").concat(u)),this._modifyMessageExtensions(e,c).then((function(e){var t=e.resultList,n=e.successCount,r=e.failureCount,o="success count:".concat(n," fail count:").concat(r);return l.setMoreMessage(o).end(),He.l("".concat(i," ok. ").concat(o)),pa({extensions:t})})).catch((function(e){return n.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];l.setError(e,i,r).end()})),He.e("".concat(i," failed. error:"),e),va(e)}))}},{key:"getMessageExtensions",value:function(e){var t=this;if(!this.canIUse(H.MSG_EXT))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("getMessageExtensions"),i=e.ID,r=e.conversationID,o=e.sequence,a=e.time,s="conversationID:".concat(r," messageID:").concat(i," sequence:").concat(o," time:").concat(a),c=new $o("getMessageExtensions");c.setMessage(s),He.l("".concat(n," ").concat(s));var u=void 0;return this.getMessageExtensionsMap.has(i)&&(u=this._getGlobalSequence(i)),this._getMessageExtensions(e,u).then((function(e){return c.end(),He.l("".concat(n," ok. total count:").concat(e.length)),ht(u)&&e.length>0&&t.getMessageExtensionsMap.set(i,1),pa({extensions:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"deleteMessageExtensions",value:function(e,t){var n=this;if(!this.canIUse(H.MSG_EXT))return va({code:No.CANNOT_USE_COMMERCIAL_ABILITY});var i="".concat(this._n,".").concat("deleteMessageExtensions"),r=[],o=3;tn(t)||(o=2,t.forEach((function(e){r.push({key:e,value:"",seq:0})})));var a=e.ID,s=e.conversationID,c=e.sequence,u=e.time,l="conversationID:".concat(s," messageID:").concat(a," sequence:").concat(c," time:").concat(u," operateType:").concat(o),d=new $o("deleteMessageExtensions");return d.setMessage(l),He.l("".concat(i," ").concat(l)),this._modifyMessageExtensions(e,r,o).then((function(e){var t=e.resultList,n=e.successCount,r=e.failureCount,a="";return 2===o&&(a="success count:".concat(n," fail count:").concat(r)),d.setMoreMessage("".concat(a)).end(),He.l("".concat(i," ok. ").concat(a)),pa({extensions:t})})).catch((function(e){return n.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];d.setError(e,i,r).end()})),He.e("".concat(i," failed. error:"),e),va(e)}))}},{key:"_modifyMessageExtensions",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=Lt(e.to)?b.CONV_TOPIC:e.conversationType,o=void 0;3!==i&&(o=this._getRequestExtensions(e,t));var a=null;switch(r){case b.CONV_C2C:a=this.getModule(qn);break;case b.CONV_GROUP:a=this.getModule(Bn);break;case b.CONV_TOPIC:a=this.getModule(Kn);break;default:return va({code:No.CANNOT_FIND_MODULE})}return a.modifyMessageExtensions(e,o,i).then((function(t){var i=t.data,r=i.extensions,o=i.seq,a=[],s=0,c=0,u=[];return(r=tn(r)?[]:r).forEach((function(e){var t=e.errorCode,n=e.extension,i=n.key,r=n.value,o=n.seq;a.push({code:t,key:i,value:r}),0===t?s++:c++,u.push({key:i,value:r,seq:o})})),n._updateGlobalSequence(e.ID,o),u.length>0&&(n._updateLocalExtension(e.ID,u),u=null),{resultList:a,successCount:s,failureCount:c}})).catch((function(e){return va(e)}))}},{key:"_getRequestExtensions",value:function(e,t){var n=[];if(this._hasLocalExtension(e.ID)){var i=this._getLocalExtension(e.ID);return t.forEach((function(e){var t=e.key,r=e.value,o=0;i.has(t)&&(o=i.get(t).seq),n.push({key:t,value:r,seq:o})})),n}return t.forEach((function(e){var t=e.key,i=e.value;n.push({key:t,value:i,seq:0})})),n}},{key:"_getMessageExtensions",value:function(e,t){var n=this,i="".concat(this._n,"._getMessageExtensions"),r=e.ID,o=e.to,a=null;switch(Lt(o)?b.CONV_TOPIC:e.conversationType){case b.CONV_C2C:a=this.getModule(qn);break;case b.CONV_GROUP:a=this.getModule(Bn);break;case b.CONV_TOPIC:a=this.getModule(Kn);break;default:return va({code:No.CANNOT_FIND_MODULE})}return a.getMessageExtensions(e,t).then((function(t){var o=t.data,a=o.extensions,s=o.completeFlag,c=o.globalSequence,u=o.clearSequence;if(a=tn(a)?[]:a,He.l("".concat(i," ok. completeFlag:").concat(s," globalSequence:").concat(c," clearSequence:").concat(u," count:").concat(a.length)),n._updateLocalExtension(r,a),n._clearLocalExtension(r,u),n._updateGlobalSequence(r,c),1!==s){var l=a.slice(-1)[0].seq+1;return n._getMessageExtensions(e,l)}return n._getLocalExtensions(r)})).catch((function(e){return va(e)}))}},{key:"_hasLocalExtension",value:function(e){return this.messageExtensionMap.has(e)}},{key:"_getLocalExtension",value:function(e){return this.messageExtensionMap.get(e)}},{key:"_updateLocalExtension",value:function(e,t){this._hasLocalExtension(e)||this.messageExtensionMap.set(e,new Map);var n=this._getLocalExtension(e);t.forEach((function(e){var t=e.key,i=e.value,r=void 0===i?"":i,o=e.seq;n.set(t,{value:r,seq:o})}))}},{key:"_clearLocalExtension",value:function(e,t){if(!(t<=0)&&this._hasLocalExtension(e)){var n=this._getLocalExtension(e);n.forEach((function(e,i){e.seq<=t&&n.delete(i)}))}}},{key:"_getLocalExtensions",value:function(e){var t=[];return this._hasLocalExtension(e)&&this._getLocalExtension(e).forEach((function(e,n){var i=e.value;tn(i)||t.push({key:n,value:i})})),t}},{key:"_getGlobalSequence",value:function(e){return this.globalSeqMap.get(e)}},{key:"_updateGlobalSequence",value:function(e,t){this.globalSeqMap.set(e,t)}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this.messageExtensionMap.clear(),this.globalSeqMap.clear(),this.getMessageExtensionsMap.clear()}}]),n}(fi),Vs=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="ComboMessageModule",r}return o(n,[{key:"sendMessage",value:function(e){var t=this,n=this._constructMessageInstance(e);if(null===n)return va({code:No.MESSAGE_SEND_FAIL});this._addSendMessageTotalCount(n);var i=Date.now();return this.getModule(zn).setMessageRandom(n),this._sendComboMessage(n,e).then((function(e){var r=e.data,o=r.time,a=r.sequence,s=r.readReceiptCode;ct(s)&&0!==s&&(new $o("sendMessageWithReceipt").setMessage("from:".concat(n.from," to:").concat(n.to," sequence:").concat(a," readReceiptCode:").concat(s)).end(),He.w("".concat(t._n,".sendMessage readReceiptCode:").concat(s," message:").concat(t.getErrorMessage(s)))),t._addSendMessageSuccessCount(n,i);var c=t.getModule(zn);n.status=an.SUCCESS,n.time=o,n.conversationType===b.CONV_GROUP&&(n.sequence=a),c.appendToMessageList(n);var u=n;return!0===n._isExcludedFromLastMessage&&(u=""),c.onMessageSent({conversationOptionsList:[{conversationID:n.conversationID,unreadCount:0,type:n.conversationType,subType:n.conversationSubType,lastMessage:u}]}),pa({message:n})})).catch((function(e){return t._onSendMessageFailed(n,e)}))}},{key:"_sendComboMessage",value:function(e,t){var n=this._m.getModule(ti),i="";return e.conversationType===b.CONV_C2C&&(i="".concat(B.NAME.OPEN_IM,".").concat(B.CMD.SEND_MESSAGE)),e.conversationType===b.CONV_GROUP&&(i="".concat(B.NAME.GROUP,".").concat(B.CMD.SEND_GROUP_MESSAGE)),n.sendComboMessage({servcmd:i,data:t})}},{key:"_constructMessageInstance",value:function(e){var t="".concat(this._n,"._constructMessageInstance"),n=null;try{var i=this.getMyUserID(),r={};if(r.senderTinyID=this.getMyTinyID(),r.currentUser=i,r.from=e.From_Account||i,e.GroupId?(r.conversationID="".concat(b.CONV_GROUP).concat(e.GroupId),r.conversationType=b.CONV_GROUP,r.to=e.GroupId):e.To_Account&&(r.conversationID="".concat(b.CONV_C2C).concat(e.To_Account),r.conversationType=b.CONV_C2C,r.to=e.To_Account),r.time=e.MsgTimeStamp||0,r.random=e.Random||e.MsgRandom||0,r.priority=e.MsgPriority,ut(e.CloudCustomData)&&e.CloudCustomData.length>0&&(r.cloudCustomData=e.CloudCustomData),pt(e.SendMsgControl)&&(r.messageControlInfo={},e.SendMsgControl.includes("NoUnread")&&(r.messageControlInfo.excludedFromUnreadCount=1),e.SendMsgControl.includes("NoLastMsg")&&(r.messageControlInfo.excludedFromLastMessage=1)),r.conversationType===b.CONV_GROUP&&pt(e.To_Account)&&e.To_Account.length>0){var o=e.To_Account;e.To_Account.length>50&&(o=e.To_Account.slice(0,50),He.w("".concat(t," To_Account must be less than or equal to 50."))),r.receiverList=_(o),e.To_Account=_(o)}1!==e.IsNeedReadReceipt&&1!==e.NeedReadReceipt||(r.needReadReceipt=!0),1===e.SupportMessageExtension&&(r.isSupportExtension=!0),(n=new da(r)).status=an.UNSEND,e.MsgClientTime=n.clientTime,n.conversationType===b.CONV_C2C&&(e.MsgSeq=n.sequence);for(var a,s=e.MsgBody.length,c=0;c<s;c++)"TIMTextElem"===(a=e.MsgBody[c]).MsgType?n.setTextElement(a.MsgContent.Text):"TIMCustomElem"===a.MsgType?n.setCustomElement({data:a.MsgContent.Data||"",description:a.MsgContent.Desc||"",extension:a.MsgContent.Ext||""}):"TIMFaceElem"===a.MsgType&&n.setFaceElement({index:a.MsgContent.Index,data:a.MsgContent.Data});var u=n.getElements();n.payload=u[0].content,n.type=u[0].type}catch(l){n=null,He.e("".concat(t," failed. error:"),l)}return n}},{key:"_onSendMessageFailed",value:function(e,t){e.status=an.FAIL,this.getModule(zn).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,t);var n=new $o("sendMessage");return n.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)),this.probeNetwork().then((function(e){var i=v(e,2),r=i[0],o=i[1];n.setError(t,r,o).end()})),He.e("".concat(this._n,"._onSendMessageFailed error:"),t),va(new ha({code:t&&t.code?t.code:No.MESSAGE_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if(e.conversationType===b.CONV_C2C)return xo;if(e.conversationType===b.CONV_GROUP){var t=this.getModule(Bn).getLocalGroupProfile(e.to);if(!t)return;var n=t.type;return At(n)?Fo:Go}}},{key:"_addSendMessageTotalCount",value:function(e){var t=this._getSendMessageSpecifiedKey(e);t&&this.getModule(si).addTotalCount(t)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n=Math.abs(Date.now()-t),i=this._getSendMessageSpecifiedKey(e);if(i){var r=this.getModule(si);r.addSuccessCount(i),r.addCost(i,n)}}},{key:"_addSendMessageFailCountOnUser",value:function(e,t){var n=t.code,i=void 0===n?-1:n,r=this.getModule(si),o=this._getSendMessageSpecifiedKey(e);xs(i)&&o&&r.addFailedCountOfUserSide(o)}}]),n}(fi),qs=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="PluginModule",r.plugins={},r}return o(n,[{key:"registerPlugin",value:function(e){var t=this;Object.keys(e).forEach((function(n){t.plugins[n]=e[n]})),new $o("registerPlugin").setMessage("".concat(Object.keys(e))).end()}},{key:"getPlugin",value:function(e){return this.plugins[e]}},{key:"reset",value:function(){}}]),n}(fi),Bs=function(e){s(r,e);var n=m(r);function r(e){var t;return i(this,r),(t=n.call(this,e))._n="SyncUnreadMessageModule",t._cookie="",t._onlineSyncFlag=!1,t.getInnerEmitterInstance().on(Ia,t._onLoginSuccess,f(t)),t}return o(r,[{key:"_onLoginSuccess",value:function(e){this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"_startSync",value:function(e){var n=this,i=e.cookie,r=e.syncFlag,o=e.isOnlineSync,a="".concat(this._n,"._startSync");He.l("".concat(a," cookie:").concat(i," syncFlag:").concat(r," isOnlineSync:").concat(o)),this.request({protocolName:yi,requestData:{cookie:i,syncFlag:r,isOnlineSync:o}}).then((function(e){var i=e.data,r=i.cookie,o=i.syncFlag;n._cookie=r,tn(r)||(0===o||1===o?(n._dispatchUnreadMessage(t(t({},e.data),{},{isSyncingEnded:!1})),n._startSync({cookie:r,syncFlag:o,isOnlineSync:0})):2===o&&n._dispatchUnreadMessage(t(t({},e.data),{},{isSyncingEnded:!0})))})).catch((function(e){He.e("".concat(a," failed. error:"),e)}))}},{key:"_dispatchUnreadMessage",value:function(e){e.eventArray&&this.getModule(ti).onMessage({head:{},body:{eventArray:e.eventArray,isInstantMessage:this._onlineSyncFlag,isSyncingEnded:e.isSyncingEnded}}),this.getModule(qn).onNewC2CMessage({dataList:e.messageList,isInstantMessage:!!e.isSyncingEnded&&this._onlineSyncFlag,C2CRemainingUnreadList:e.C2CRemainingUnreadList,C2CPairUnreadList:e.C2CPairUnreadList})}},{key:"startOnlineSync",value:function(){He.l("".concat(this._n,".startOnlineSync")),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:1})}},{key:"startSyncOnReconnected",value:function(){He.l("".concat(this._n,".startSyncOnReconnected.")),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._onlineSyncFlag=!1,this._cookie=""}}]),r}(fi),Hs={request:{toAccount:"To_Account",fromAccount:"From_Account",to:"To_Account",from:"From_Account",groupID:"GroupId",groupAtUserID:"GroupAt_Account",extension:"Ext",data:"Data",description:"Desc",elements:"MsgBody",sizeType:"Type",downloadFlag:"Download_Flag",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",videoUrl:"",imageUrl:"URL",fileUrl:"Url",uuid:"UUID",priority:"MsgPriority",receiverUserID:"To_Account",receiverGroupID:"GroupId",messageSender:"SenderId",messageReceiver:"ReceiverId",nick:"From_AccountNick",avatar:"From_AccountHeadurl",messageNumber:"MsgNum",pbDownloadKey:"PbMsgKey",downloadKey:"JsonMsgKey",applicationType:"PendencyType",userIDList:"To_Account",groupNameList:"GroupName",userID:"To_Account",groupAttributeList:"GroupAttr",mainSequence:"AttrMainSeq",avChatRoomKey:"BytesKey",attributeControl:"AttrControl",sequence:"seq",messageControlInfo:"SendMsgControl",updateSequence:"UpdateSeq",clientTime:"MsgClientTime",sequenceList:"MsgSeqList",topicID:"TopicId",customData:"CustomString",isSupportTopic:"SupportTopic",isWebUniapp:"is_web_uniapp",isSupportExtension:"SupportMessageExtension",messageSequence:"MsgSeq",messageKey:"MsgKey",startSequence:"startSeq",simplifiedMessage:"DownsizeFlag"},response:{MsgPriority:"priority",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",Download_Flag:"downloadFlag",GroupId:"groupID",Member_Account:"userID",MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",MsgSeq:"sequence",MsgRandom:"random",MsgTime:"time",MsgTimeStamp:"time",MsgContent:"content",MsgBody:"elements",From_AccountNick:"nick",From_AccountHeadurl:"avatar",GroupWithdrawInfoArray:"revokedInfos",GroupReadInfoArray:"groupMessageReadNotice",LastReadMsgSeq:"lastMessageSeq",WithdrawC2cMsgNotify:"c2cMessageRevokedNotify",C2cWithdrawInfoArray:"revokedInfos",C2cReadedReceipt:"c2cMessageReadReceipt",ReadC2cMsgNotify:"c2cMessageReadNotice",LastReadTime:"peerReadTime",MsgRand:"random",MsgType:"type",MsgShow:"messageShow",NextMsgSeq:"nextMessageSeq",FaceUrl:"avatar",ProfileDataMod:"profileModify",Profile_Account:"userID",ValueBytes:"value",ValueNum:"value",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgFrom_AccountExtraInfo:"messageFromAccountExtraInformation",Operator_Account:"operatorID",OpType:"operationType",ReportType:"operationType",UserId:"userID",User_Account:"userID",List_Account:"userIDList",MsgOperatorMemberExtraInfo:"operatorInfo",MsgMemberExtraInfo:"memberInfoList",ImageUrl:"avatar",NickName:"nick",MsgGroupNewInfo:"newGroupProfile",MsgAppDefinedData:"groupCustomField",Owner_Account:"ownerID",GroupFaceUrl:"avatar",GroupIntroduction:"introduction",GroupNotification:"notification",GroupApplyJoinOption:"joinOption",MsgKey:"messageKey",GroupInfo:"groupProfile",ShutupTime:"muteTime",Desc:"description",Ext:"extension",GroupAt_Account:"groupAtUserID",MsgNum:"messageNumber",PbMsgKey:"pbDownloadKey",JsonMsgKey:"downloadKey",MsgModifiedFlag:"isModified",PendencyItem:"applicationItem",PendencyType:"applicationType",AddTime:"time",AddSource:"source",AddWording:"wording",ProfileImImage:"avatar",PendencyAdd:"friendApplicationAdded",FrienPencydDel_Account:"friendApplicationDeletedUserIDList",Peer_Account:"userID",GroupAttr:"groupAttributeList",GroupAttrAry:"groupAttributeList",AttrMainSeq:"mainSequence",seq:"sequence",GroupAttrOption:"groupAttributeOption",BytesChangedKeys:"changedKeyList",GroupAttrInfo:"groupAttributeList",GroupAttrSeq:"mainSequence",PushChangedAttrValFlag:"isWithChangedAttributeInfo",SubKeySeq:"sequence",Val:"value",MsgGroupFromCardName:"senderNameCard",MsgGroupFromNickName:"senderNick",C2cNick:"peerNick",C2cImage:"peerAvatar",SendMsgControl:"messageControlInfo",NoLastMsg:"excludedFromLastMessage",NoUnread:"excludedFromUnreadCount",UpdateSeq:"updateSequence",MuteNotifications:"muteFlag",MsgClientTime:"clientTime",TinyId:"tinyID",GroupMsgReceiptList:"readReceiptList",ReadNum:"readCount",UnreadNum:"unreadCount",TopicId:"topicID",MillionGroupFlag:"communityType",SupportTopic:"isSupportTopic",MsgTopicNewInfo:"newTopicInfo",ShutupAll:"muteAllMembers",CustomString:"customData",TopicFaceUrl:"avatar",TopicIntroduction:"introduction",TopicNotification:"notification",TopicIdArray:"topicIDList",MsgVersion:"messageVersion",C2cMsgModNotifys:"c2cMessageModified",GroupMsgModNotifys:"groupMessageModified",ApplyJoinOption:"joinOption",MsgFlag:"messageRemindType",AtInfoList:"groupAtInfoList",AtFlagList:"groupAtType",AtMsgSeq:"sequence",BanDuration:"duration",BanDescription:"reason",NotVisible:"invisible",BytesTag:"tag",BytesValue:"value",RptBytesValue:"value",LatestSeq:"globalSequence",ClearSeq:"clearSequence",SupportMessageExtension:"isSupportExtension",ExtensionList:"extensions",GroupCounter:"counterList",Revoker_Account:"revoker",MsgExtensionNotify:"messageExtensionNotify",ExtensionC2cMsgInfo:"messageInfo",ExtensionGroupMsgInfo:"messageInfo",MsgOptType:"operateType",SetKVInfo:"operateResultList",DeleteKVInfo:"operateResultList",ClearKVInfo:"operateResultList",MsgKeyValue:"extensions",ClearMsgSeq:"clearSequence",MsgLastSeq:"globalSequence",InviteJoinOption:"inviteOption",MemberList_Account:"inviteeList",MsgMemberExtraInfoList:"inviteeInfoList",E:"event",GInf:"groupProfile",MCT:"clientTime",MR:"random",MP:"priority",MTS:"time",GId:"groupID",MS:"sequence",CCD:"cloudCustomData",F_Account:"from",F_Hd:"avatar",F_NN:"nick",GN:"groupName",GT:"groupType",IsSys:"isSystemMessage",OpInf:"operatorInfo",Img:"avatar",NN:"nick",OnlineInf:"onlineMemberInfo",ET:"expireTime",Num:"onlineMemberNum",Opt:"operationType",O_Account:"operatorID",RT:"operationType",UDF:"userDefinedField",L_Account:"userIDList"},ignoreKeyWord:["C2C","ID","USP"]};function js(e,t){if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");var n;return t=Object.assign({pascalCase:!1},t),0===(e=Array.isArray(e)?e.map((function(e){return e.trim()})).filter((function(e){return e.length})).join("-"):e.trim()).length?"":1===e.length?t.pascalCase?e.toUpperCase():e.toLowerCase():(e!==e.toLowerCase()&&(e=Ks(e)),n=e=e.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,(function(e,t){return t.toUpperCase()})).replace(/\d+(\w|$)/g,(function(e){return e.toUpperCase()})),t.pascalCase?n.charAt(0).toUpperCase()+n.slice(1):n)}var Ks=function(e){for(var t=!1,n=!1,i=!1,r=0;r<e.length;r++){var o=e[r];t&&/[a-zA-Z]/.test(o)&&o.toUpperCase()===o?(e=e.slice(0,r)+"-"+e.slice(r),t=!1,i=n,n=!0,r++):n&&i&&/[a-zA-Z]/.test(o)&&o.toLowerCase()===o?(e=e.slice(0,r-1)+"-"+e.slice(r-1),i=n,n=!1,t=!0):(t=o.toLowerCase()===o&&o.toUpperCase()!==o,i=n,n=o.toUpperCase()===o&&o.toLowerCase()!==o)}return e};function zs(e,t){var n=0;return function e(t,i){if(++n>100)return n--,t;if(pt(t)){var r=t.map((function(t){return lt(t)?e(t,i):t}));return n--,r}if(lt(t)){var o=(a=t,s=function(e,t){if(!_t(t))return!1;if((r=t)!==js(r))for(var n=0;n<Hs.ignoreKeyWord.length&&!t.includes(Hs.ignoreKeyWord[n]);n++);var r,o;return ht(i[t])?"OPPOChannelID"===(o=t)?o:o[0].toUpperCase()+js(o).slice(1):i[t]},c=Object.create(null),Object.keys(a).forEach((function(e){var t=s(a[e],e);t&&(c[t]=a[e])})),c);return o=Ut(o,(function(t,n){return pt(t)||lt(t)?e(t,i):t})),n--,o}var a,s,c}(e,t)}function Ws(e,t){if(pt(e))return e.map((function(e){return lt(e)?Ws(e,t):e}));if(lt(e)){var n=(i=e,r=function(e,n){return ht(t[n])?js(n):t[n]},o={},Object.keys(i).forEach((function(e){o[r(i[e],e)]=i[e]})),o);return Ut(n,(function(e){return pt(e)||lt(e)?Ws(e,t):e}))}var i,r,o}var Ys=String.fromCharCode,$s=function(e){var t=0|e.charCodeAt(0);if(55296<=t)if(t<56320){var n=0|e.charCodeAt(1);if(56320<=n&&n<=57343){if((t=(t<<10)+n-56613888|0)>65535)return Ys(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}else t=65533}else t<=57343&&(t=65533);return t<=2047?Ys(192|t>>>6,128|63&t):Ys(224|t>>>12,128|t>>>6&63,128|63&t)},Js=function(e){for(var t=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,$s),n=0|t.length,i=new Uint8Array(n),r=0;r<n;r=r+1|0)i[r]=0|t.charCodeAt(r);return i},Xs=function(e){for(var t=new Uint8Array(e),n="",i=0,r=t.length;i<r;){var o=t[i],a=0,s=0;if(o<=127?(a=0,s=255&o):o<=223?(a=1,s=31&o):o<=239?(a=2,s=15&o):o<=244&&(a=3,s=7&o),r-i-a>0)for(var c=0;c<a;)s=s<<6|63&(o=t[i+c+1]),c+=1;else s=65533,a=r-i;n+=String.fromCodePoint(s),i+=a+1}return n},Zs=function(){function e(t){i(this,e),this._handler=t;var n=t.getURL();if(this._socket=null,this._workerSocket=null,this._id=Tt(),this._handler.getIsWorkerEnabled()){var r=URL.createObjectURL(new Blob([';let _socket = null;onmessage = function(event) {  if (event.data.cmd === "start") {    const url = event.data.url;    _socket = new WebSocket(url);    _socket.binaryType = "arraybuffer";    _socket.onopen = function() {      postMessage({ callback: "onOpen" });    };    _socket.onclose = function(e) {      postMessage({ callback: "onOpen", e: { code: e.code, reason: e.reason } });    };    _socket.onmessage = function(e) {      postMessage({ callback: "onMessage", data: e.data });    };    _socket.onerror = function(e) {      postMessage({ callback: "onError", e: { isTrusted: "true" } });    };  } else if (event.data.cmd === "sendMessage") {    if (_socket !== null) {      _socket.send(event.data.data);    }  } else if (event.data.cmd === "stop") {    if (_socket !== null) {      _socket.close(event.data.code);      _socket = null;    }  }};'],{type:"application/javascript; charset=utf-8"}));this._workerSocket=new Worker(r);var o=this;this._workerSocket.onmessage=function(e){var t=e.data,n=t.callback,i=t.e;"onOpen"===n?o._onOpen():"onClose"===n?o._onClose(i):"onError"===n?o._onError(i):"onMessage"===n&&o._onMessage(e.data)},this._workerSocket.postMessage({cmd:"start",id:this._id,url:n})}else ae?ne?(ce.connectSocket({url:n,header:{"content-type":"application/json"}}),ce.onSocketClose(this._onClose.bind(this)),ce.onSocketOpen(this._onOpen.bind(this)),ce.onSocketMessage(this._onMessage.bind(this)),ce.onSocketError(this._onError.bind(this))):(this._socket=ce.connectSocket({url:n,header:{"content-type":"application/json"},complete:function(){}}),this._socket.onClose(this._onClose.bind(this)),this._socket.onOpen(this._onOpen.bind(this)),this._socket.onMessage(this._onMessage.bind(this)),this._socket.onError(this._onError.bind(this))):se&&(this._socket=new WebSocket(n),this._socket.binaryType="arraybuffer",this._socket.onopen=this._onOpen.bind(this),this._socket.onmessage=this._onMessage.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this));this._canIUseBinaryFrame=t.canIUseBinaryFrame()}return o(e,[{key:"getID",value:function(){return this._id}},{key:"_onOpen",value:function(){this._handler.onOpen({id:this._id})}},{key:"_onClose",value:function(e){this._handler.onClose({id:this._id,e:e})}},{key:"_onMessage",value:function(e){this._handler.onMessage({data:this._canIUseBinaryFrame?Xs(e.data):e.data})}},{key:"_onError",value:function(e){this._handler.onError({id:this._id,e:e})}},{key:"setIsWorkerEnabled",value:function(e){this._isWorkerEnabled=!0}},{key:"close",value:function(e){if(this._workerSocket&&(this._workerSocket.postMessage({cmd:"stop",code:e}),this._workerSocket.terminate(),this._workerSocket=null),ne)return ce.offSocketClose(),ce.offSocketMessage(),ce.offSocketOpen(),ce.offSocketError(),void ce.closeSocket();this._socket&&(ae?(this._socket.onClose((function(){})),this._socket.onOpen((function(){})),this._socket.onMessage((function(){})),this._socket.onError((function(){}))):se&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null),te?this._socket.close({code:e}):this._socket.close(e),this._socket=null)}},{key:"send",value:function(e){if(this._workerSocket)this._workerSocket.postMessage({cmd:"sendMessage",data:this._canIUseBinaryFrame?Js(e.data).buffer:e.data});else{if(ne)return void ce.sendSocketMessage({data:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}});this._socket&&(ae?this._socket.send({data:this._canIUseBinaryFrame?Js(e.data).buffer:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):se&&this._socket.send(this._canIUseBinaryFrame?Js(e.data).buffer:e.data))}}}]),e}(),Qs=4e3,ec=4001,tc=["keyMap"],nc=["keyMap"],ic="connected",rc="connecting",oc="disconnected",ac=function(){function e(t){i(this,e),this._channelModule=t,this._n="SocketHandler",this._promiseMap=new Map,this._readyState=oc,this._simpleRequestMap=new Map,this.MAX_SIZE=100,this._startSequence=Tt(),this._startTs=0,this._reConnectFlag=!1,this._nextPingTs=0,this._reConnectCount=0,this.MAX_RECONNECT_COUNT=3,this._socketID=-1,this._random=0,this._socket=null,this._url="",this._onOpenTs=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0,this._setWebsocketHost(),this._initConnection()}return o(e,[{key:"_setWebsocketHost",value:function(){var e=this._channelModule.getModule(Wn),t=N;this._channelModule.isOversea()&&(t=P),e.isSingaporeSite()?t=U:e.isKoreaSite()?t=x:e.isGermanySite()?t=G:e.isIndiaSite()?t=F:e.isJapanSite()?t=V:e.isUSASite()&&(t=q),B.HOST.setCurrent(t)}},{key:"_initConnection",value:function(){ht(B.HOST.CURRENT.BACKUP)||""===this._url?this._url=B.HOST.CURRENT.DEFAULT:this._url===B.HOST.CURRENT.DEFAULT?this._url=B.HOST.CURRENT.BACKUP:this._url===B.HOST.CURRENT.BACKUP?this._url=this._canIUseAnyCast()?B.HOST.CURRENT.ANYCAST:B.HOST.CURRENT.DEFAULT:this._url===B.HOST.CURRENT.ANYCAST&&(B.HOST.CURRENT.ANYCAST="",this._url=B.HOST.CURRENT.DEFAULT);var e=this._channelModule.getModule(Wn).getProxyServer();tn(e)||(this._url=e),this._connect(),this._nextPingTs=0}},{key:"_canIUseAnyCast",value:function(){return se&&B.HOST.CURRENT.ANYCAST}},{key:"onCheckTimer",value:function(e){e%1==0&&this._checkPromiseMap()}},{key:"_checkPromiseMap",value:function(){var e=this;0!==this._promiseMap.size&&this._promiseMap.forEach((function(t,n){var i=t.reject,r=t.timestamp,o=15e3;-1!==n.indexOf(gi)&&(o=9e4),Date.now()-r>=o&&(He.l("".concat(e._n,"._checkPromiseMap request timeout, delete requestID:").concat(n)),e._promiseMap.delete(n),i(new ha({code:No.NETWORK_TIMEOUT})),e._channelModule.onRequestTimeout(n))}))}},{key:"onOpen",value:function(e){if(""!==this._readyState){this._onOpenTs=Date.now();var t=e.id;this._socketID=t;var n=Date.now()-this._startTs;He.l("".concat(this._n,"._onOpen cost ").concat(n," ms. socketID:").concat(t)),new $o("wsOnOpen").setMessage(n).setCostTime(n).setMoreMessage("socketID:".concat(t)).end(),e.id===this._socketID&&(this._readyState=ic,this._reConnectCount=0,this._resend(),!0===this._reConnectFlag&&(this._channelModule.onReconnected(),this._reConnectFlag=!1),this._channelModule.onOpen())}}},{key:"onClose",value:function(e){var t=new $o("wsOnClose"),n=e.id,i=e.e,r="sourceSocketID:".concat(n," currentSocketID:").concat(this._socketID," code:").concat(i.code," reason:").concat(i.reason),o=0;0!==this._onOpenTs&&(o=Date.now()-this._onOpenTs),t.setMessage(o).setCostTime(o).setMoreMessage(r).setCode(i.code).end(),He.l("".concat(this._n,"._onClose ").concat(r," onlineTime:").concat(o)),n===this._socketID&&(this._readyState=oc,o<1e3?this._channelModule.onReconnectFailed():this._channelModule.onClose())}},{key:"onError",value:function(e){var t=e.id,n=e.e,i="sourceSocketID:".concat(t," currentSocketID:").concat(this._socketID);new $o("wsOnError").setMessage(n.errMsg||It(n)).setMoreMessage(i).setLevel("error").end(),He.w("".concat(this._n,"._onError"),n,i),t===this._socketID&&(this._readyState="",this._channelModule.onError())}},{key:"onMessage",value:function(e){var t;try{t=JSON.parse(e.data)}catch(u){new $o("jsonParseError").setMessage(e.data).end()}if(t&&t.head){var n=this._getRequestIDFromHead(t.head),i=t.body;if(!n.startsWith(B.NAME.TUIROOM_SVR)){var r=Ht(t.head);i=Ws(t.body,this._getResponseKeyMap(r))}if(He.d("".concat(this._n,".onMessage ret:").concat(JSON.stringify(i)," requestID:").concat(n," has:").concat(this._promiseMap.has(n))),this._setNextPingTs(),this._promiseMap.has(n)){var o=this._promiseMap.get(n),a=o.resolve,s=o.reject,c=o.timestamp;return this._promiseMap.delete(n),this._calcRTT(c),void(i.errorCode&&0!==i.errorCode?(this._channelModule.onErrorCodeNotZero(i),s(new ha({code:i.errorCode,message:i.errorInfo||"",data:n.includes($i)||n.includes(Fr)?{elements:i.elements,messageVersion:i.messageVersion,cloudCustomData:i.cloudCustomData}:void 0}))):a(pa(i)))}this._channelModule.onMessage({head:t.head,body:i})}}},{key:"_calcRTT",value:function(e){var t=Date.now()-e;this._channelModule.getModule(si).addRTT(t)}},{key:"_connect",value:function(){this._startTs=Date.now(),this._onOpenTs=0,this._socket=new Zs(this),this._socketID=this._socket.getID(),this._readyState=rc,He.l("".concat(this._n,"._connect isWorkerEnabled:").concat(this.getIsWorkerEnabled()," socketID:").concat(this._socketID," url:").concat(this.getURL())),new $o("wsConnect").setMessage("socketID:".concat(this._socketID," url:").concat(this.getURL())).end()}},{key:"getURL",value:function(){this._channelModule.isDevMode()&&(this._canIUseBinaryFrame=!1);var e=Ft();(ne||Z&&"windows"===e||re)&&(this._canIUseBinaryFrame=!1);var t=-1;"ios"===e?t=Ie||-1:"android"===e&&(t=Te||-1);var n=this._channelModule.getModule(Wn),i=this._channelModule.getPlatform(),r=n.getSDKAppID(),o=n.getInstanceID(),a="sdkappid=".concat(r,"&instanceid=").concat(o,"&random=").concat(this._getRandom(),"&platform=").concat(i,"&host=").concat(e,"&version=").concat(t);return this._canIUseBinaryFrame?"".concat(this._url,"/binfo?").concat(a):"".concat(this._url,"/info?").concat(a)}},{key:"_closeConnection",value:function(e){He.l("".concat(this._n,"._closeConnection socketID:").concat(this._socketID)),this._socket&&(this._socket.close(e),this._socketID=-1,this._socket=null,this._readyState=oc)}},{key:"_resend",value:function(){var e=this;if(He.l("".concat(this._n,"._resend reConnectFlag:").concat(this._reConnectFlag),"promiseMap.size:".concat(this._promiseMap.size," simpleRequestMap.size:").concat(this._simpleRequestMap.size)),this._promiseMap.size>0&&this._promiseMap.forEach((function(t,n){var i=t.uplinkData,r=t.resolve,o=t.reject;e._promiseMap.set(n,{resolve:r,reject:o,timestamp:Date.now(),uplinkData:i}),e._execute(n,i)})),this._simpleRequestMap.size>0){var t,n=E(this._simpleRequestMap);try{for(n.s();!(t=n.n()).done;){var i=v(t.value,2),r=i[0],o=i[1];this._execute(r,o)}}catch(a){n.e(a)}finally{n.f()}this._simpleRequestMap.clear()}}},{key:"send",value:function(e){var t=this;e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap;var n=h(e,tc),i=this._getRequestIDFromHead(e.head),r=JSON.stringify(n);return new Promise((function(e,o){t._promiseMap.set(i,{resolve:e,reject:o,timestamp:Date.now(),uplinkData:r}),He.d("".concat(t._n,".send uplinkData:").concat(JSON.stringify(n)," requestID:").concat(i," readyState:").concat(t._readyState)),t._readyState!==ic?t._reConnect():(t._execute(i,r),t._channelModule.getModule(si).addRequestCount())}))}},{key:"simplySend",value:function(e){e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap;var t=h(e,nc),n=this._getRequestIDFromHead(e.head),i=JSON.stringify(t);this._readyState!==ic?(this._simpleRequestMap.size<this.MAX_SIZE?this._simpleRequestMap.set(n,i):He.l("".concat(this._n,".simplySend. simpleRequestMap is full, drop request!")),this._reConnect()):this._execute(n,i)}},{key:"_execute",value:function(e,t){this._socket.send({data:t,fail:ae?this._onSendFail.bind(this):void 0,requestID:e})}},{key:"_onSendFail",value:function(e){He.l("".concat(this._n,"._onSendFail requestID:").concat(e))}},{key:"_getSequence",value:function(){var e;if(this._startSequence<2415919103)return e=this._startSequence,this._startSequence+=1,2415919103===this._startSequence&&(this._startSequence=Tt()),e}},{key:"_getRequestIDFromHead",value:function(e){return e.servcmd+e.seq}},{key:"_getResponseKeyMap",value:function(e){var n=this._channelModule.getKeyMap(e);return t(t({},Hs.response),n.response)}},{key:"_reConnect",value:function(){this._readyState!==ic&&this._readyState!==rc&&this.forcedReconnect()}},{key:"forcedReconnect",value:function(){var e=this,t="".concat(this._n,".forcedReconnect");He.l("".concat(t," count:").concat(this._reConnectCount," readyState:").concat(this._readyState)),this._reConnectFlag=!0,this._resetRandom(),this._reConnectCount<this.MAX_RECONNECT_COUNT?(this._reConnectCount+=1,this._closeConnection(ec),this._initConnection()):(this._reConnectCount=0,this._channelModule.probeNetwork().then((function(n){var i=v(n,2),r=i[0];i[1],r?(He.w("".concat(t," disconnected from wsserver but network is ok, continue...")),e._closeConnection(ec),e._initConnection()):e._channelModule.onReconnectFailed()})))}},{key:"getReconnectFlag",value:function(){return this._reConnectFlag}},{key:"_setNextPingTs",value:function(){this._nextPingTs=Date.now()+1e4}},{key:"getNextPingTs",value:function(){return this._nextPingTs}},{key:"isConnected",value:function(){return this._readyState===ic}},{key:"canIUseBinaryFrame",value:function(){return this._canIUseBinaryFrame}},{key:"setIsWorkerEnabled",value:function(e){He.l("".concat(this._n,".setIsWorkerEnabled flag:").concat(e)),this._isWorkerEnabled=e}},{key:"getIsWorkerEnabled",value:function(){return this._isWorkerEnabled&&we}},{key:"_getRandom",value:function(){return 0===this._random&&(this._random=Math.random()),this._random}},{key:"_resetRandom",value:function(){this._random=0}},{key:"close",value:function(){He.l("".concat(this._n,".close")),this._closeConnection(Qs),this._promiseMap.clear(),this._startSequence=Tt(),this._readyState=oc,this._simpleRequestMap.clear(),this._reConnectFlag=!1,this._reConnectCount=0,this._onOpenTs=0,this._url="",this._random=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0}}]),e}(),sc=function(e){s(n,e);var t=m(n);function n(e){var r;if(i(this,n),(r=t.call(this,e))._n="ChannelModule",r._socketHandler=new ac(f(r)),r._probing=!1,r._isAppShowing=!0,r._previousState=b.NET_STATE_CONNECTED,ae&&"function"==typeof ce.onAppShow&&"function"==typeof ce.onAppHide){var o=r._onAppHide.bind(f(r)),a=r._onAppShow.bind(f(r));"function"==typeof ce.offAppHide&&ce.offAppHide(o),"function"==typeof ce.offAppShow&&ce.offAppShow(a),ce.onAppHide(o),ce.onAppShow(a)}return r._timerForNotLoggedIn=-1,r._timerForNotLoggedIn=setInterval(r.onCheckTimer.bind(f(r)),1e3),r._fatalErrorFlag=!1,r}return o(n,[{key:"onCheckTimer",value:function(e){this._socketHandler&&(this.isLoggedIn()?(this._timerForNotLoggedIn>0&&(clearInterval(this._timerForNotLoggedIn),this._timerForNotLoggedIn=-1),this._socketHandler.onCheckTimer(e)):this._socketHandler.onCheckTimer(1),this._checkNextPing())}},{key:"onErrorCodeNotZero",value:function(e){this.getModule(ti).onErrorCodeNotZero(e)}},{key:"onMessage",value:function(e){this.getModule(ti).onMessage(e)}},{key:"send",value:function(e){return this._socketHandler?this._previousState!==b.NET_STATE_CONNECTED&&e.head.servcmd.includes(so)?(this.reConnect(),this._sendLogViaHTTP(e)):this._socketHandler.send(e):Promise.reject()}},{key:"_sendLogViaHTTP",value:function(e){var t=B.HOST.CURRENT.STAT;return new Promise((function(n,i){var r="".concat(t,"/v4/imopenstat/tim_web_report_v2?sdkappid=").concat(e.head.sdkappid,"&reqtime=").concat(Date.now()),o=JSON.stringify(e.body),a="application/x-www-form-urlencoded;charset=UTF-8";if(ae)ce.request({url:r,data:o,method:"POST",timeout:3e3,header:{"content-type":a},success:function(){n()},fail:function(){i(new ha({code:No.NETWORK_ERROR}))}});else{var s=new XMLHttpRequest,c=setTimeout((function(){s.abort(),i(new ha({code:No.NETWORK_TIMEOUT}))}),3e3);s.onreadystatechange=function(){4===s.readyState&&(clearTimeout(c),200===s.status||304===s.status?n():i(new ha({code:No.NETWORK_ERROR})))},s.open("POST",r,!0),s.setRequestHeader("Content-type",a),s.send(o)}}))}},{key:"simplySend",value:function(e){return this._socketHandler?this._socketHandler.simplySend(e):Promise.reject()}},{key:"onOpen",value:function(){this._ping()}},{key:"onClose",value:function(){this._socketHandler&&this._socketHandler.getReconnectFlag()&&this._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED),this.reConnect()}},{key:"onError",value:function(){ae&&!re&&this.outputWarning("DomainNameInMP"),this._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED)}},{key:"getKeyMap",value:function(e){return this.getModule(ti).getKeyMap(e)}},{key:"_onAppHide",value:function(){this._isAppShowing=!1}},{key:"_onAppShow",value:function(){this._isAppShowing=!0}},{key:"onRequestTimeout",value:function(e){}},{key:"onReconnected",value:function(){He.l("".concat(this._n,".onReconnected")),this._m.restartTimer(),this.getModule(ti).onReconnected(),this._emitNetStateChangeEvent(b.NET_STATE_CONNECTED)}},{key:"onReconnectFailed",value:function(){He.l("".concat(this._n,".onReconnectFailed")),this._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED)}},{key:"setIsWorkerEnabled",value:function(e){this._socketHandler&&this._socketHandler.setIsWorkerEnabled(!1)}},{key:"offline",value:function(){this._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED)}},{key:"reConnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!1;this._socketHandler&&(t=this._socketHandler.getReconnectFlag());var n="forcedFlag:".concat(e," fatalErrorFlag:").concat(this._fatalErrorFlag," previousState:").concat(this._previousState," reconnectFlag:").concat(t);if(He.l("".concat(this._n,".reConnect ").concat(n)),!this._fatalErrorFlag&&this._socketHandler){if(!0===e)this._socketHandler.forcedReconnect();else{if(this._previousState===b.NET_STATE_CONNECTING&&t)return;this._socketHandler.forcedReconnect()}this._emitNetStateChangeEvent(b.NET_STATE_CONNECTING)}}},{key:"_emitNetStateChangeEvent",value:function(e){this._previousState!==e&&(He.l("".concat(this._n,"._emitNetStateChangeEvent from ").concat(this._previousState," to ").concat(e)),this._previousState=e,this.emitOuterEvent(k.NET_STATE_CHANGE,{state:e}))}},{key:"_ping",value:function(){var e=this;if(!0!==this._probing){this._probing=!0;var t=this.getModule(ti).getProtocolData({protocolName:co});this.send(t).then((function(){e._probing=!1})).catch((function(t){if(He.w("".concat(e._n,"._ping failed. error:"),t),e._probing=!1,t&&60002===t.code)return new $o("error").setMessage("code:".concat(t.code," message:").concat(t.message)).setNetworkType(e.getModule(Jn).getNetworkType()).end(),e._fatalErrorFlag=!0,void e._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED);e.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];He.l("".concat(e._n,"._ping failed. probe network, isAppShowing:").concat(e._isAppShowing," online:").concat(i," networkType:").concat(r)),i?e.reConnect():e._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED)}))}))}}},{key:"_checkNextPing",value:function(){this._socketHandler&&this._socketHandler.isConnected()&&Date.now()>=this._socketHandler.getNextPingTs()&&this._ping()}},{key:"dealloc",value:function(){this._socketHandler&&(this._socketHandler.close(),this._socketHandler=null),this._timerForNotLoggedIn>-1&&clearInterval(this._timerForNotLoggedIn)}},{key:"onRestApiKickedOut",value:function(){this._socketHandler&&(this._socketHandler.close(),this.reConnect(!0))}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._previousState=b.NET_STATE_CONNECTED,this._probing=!1,this._fatalErrorFlag=!1,this._timerForNotLoggedIn=setInterval(this.onCheckTimer.bind(this),1e3)}}]),n}(fi),cc=["a2","tinyid"],uc=["a2","tinyid"],lc=function(){function e(t){i(this,e),this._n="ProtocolHandler",this._sessionModule=t,this._configMap=new Map,this._fillConfigMap()}return o(e,[{key:"_fillConfigMap",value:function(){this._configMap.clear();var e=this._sessionModule.genCommonHead(),n=this._sessionModule.genCosSpecifiedHead(),i=this._sessionModule.genSSOReportHead(),r=this._sessionModule.isIntl();this._configMap.set(gi,{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.LOGIN)}),body:{state:"Online",isWebUniapp:0,deviceBrand:0},keyMap:{request:{deviceBrand:"InstType"},response:{InstId:"instanceID",HelloInterval:"helloInterval"}}}),this._configMap.set(mi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.LOGOUT)}),body:{type:0},keyMap:{request:{type:"wslogout_type"}}}}(e)),this._configMap.set(vi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.HELLO)}),body:{isWebUniapp:0},keyMap:{response:{NewInstInfo:"newInstanceInfo"}}}}(e)),this._configMap.set(_i,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.STAT_SERVICE,".").concat(B.CMD.KICK_OTHER)}),body:{}}}(e)),this._configMap.set(ro,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_COS_SIGN,".").concat(B.CMD.COS_SIGN)}),body:{cmd:"open_im_cos_svc",subCmd:"get_cos_token",duration:300,version:2},keyMap:{request:{userSig:"usersig",subCmd:"sub_cmd",cmd:"cmd",duration:"duration",version:"version"},response:{expired_time:"expiredTime",bucket_name:"bucketName",session_token:"sessionToken",tmp_secret_id:"secretId",tmp_secret_key:"secretKey"}}}}(n)),this._configMap.set(oo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.CUSTOM_UPLOAD,".").concat(B.CMD.COS_PRE_SIG)}),body:{fileType:void 0,fileName:void 0,uploadMethod:0,duration:900},keyMap:{request:{userSig:"usersig",fileType:"file_type",fileName:"file_name",uploadMethod:"upload_method"},response:{expired_time:"expiredTime",request_id:"requestId",head_url:"headUrl",upload_url:"uploadUrl",download_url:"downloadUrl",ci_url:"ciUrl",snapshot_url:"requestSnapshotUrl"}}}}(n)),this._configMap.set(ao,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.CUSTOM_UPLOAD,".").concat(B.CMD.VIDEO_COVER)}),body:{version:1,platform:void 0,coverName:void 0,requestSnapshotUrl:void 0},keyMap:{request:{version:"version",platform:"platform",coverName:"cover_name",requestSnapshotUrl:"snapshot_url"},response:{error_code:"errorCode",error_msg:"errorInfo",download_url:"snapshotUrl"}}}}(n)),this._configMap.set(_o,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_CONFIG_MANAGER,".").concat(B.CMD.FETCH_COMMERCIAL_CONFIG)}),body:{SDKAppID:0},keyMap:{request:{SDKAppID:"uint32_sdkappid"},response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}}(e)),this._configMap.set(yo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_CONFIG_MANAGER,".").concat(B.CMD.PUSHED_COMMERCIAL_CONFIG)}),body:{},keyMap:{response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}}(e)),this._configMap.set(mo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_CONFIG_MANAGER,".").concat(B.CMD.FETCH_CLOUD_CONTROL_CONFIG)}),body:{SDKAppID:0,version:0},keyMap:{request:{SDKAppID:"uint32_sdkappid",version:"uint64_version"},response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}}(e)),this._configMap.set(vo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_CONFIG_MANAGER,".").concat(B.CMD.PUSHED_CLOUD_CONTROL_CONFIG)}),body:{},keyMap:{response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}}(e)),this._configMap.set(Io,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OVERLOAD_PUSH,".").concat(B.CMD.OVERLOAD_NOTIFY)}),body:{},keyMap:{response:{OverLoadServCmd:"overloadCommand",DelaySecs:"waitingTime"}}}}(e)),this._configMap.set(yi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.GET_MESSAGES)}),body:{cookie:"",syncFlag:0,needAbstract:1,isOnlineSync:0,needSignaling:1},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",from:"From_Account",to:"To_Account",time:"MsgTimeStamp",sequence:"MsgSeq",random:"MsgRandom",elements:"MsgBody"},response:{MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",ClientSeq:"clientSequence",MsgSeq:"sequence",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgRandom:"random",MsgTimeStamp:"time",MsgContent:"content",ToGroupId:"to",MsgKey:"messageKey",GroupTips:"groupTips",MsgBody:"elements",MsgType:"type",C2CRemainingUnreadCount:"C2CRemainingUnreadList",C2CPairUnreadCount:"C2CPairUnreadList"}}}}(e)),r||(this._configMap.set(Ii,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.BIG_DATA_HALLWAY_AUTH_KEY)}),body:{}}}(e)),this._configMap.set(Lo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_MSG_AUDIT_MGR,".").concat(B.CMD.GET_RPOFANITY_LIST)}),body:{version:0,deviceID:"",startIndex:void 0},keyMap:{request:{version:"uint64_version",deviceID:"str_device_id",startIndex:"uint64_start_index"},response:{msg_cmd_error_code:"errorInfo",str_err_msg:"errorMessage",uint32_code:"errorCode",msg_scene_ctl_config:"filterConfig",uint64_c2c_custom_msg_flag:"c2c_custom_message",uint64_c2c_text_msg_flag:"c2c_text_message",uint64_group_custom_msg_flag:"group_custom_message",uint64_group_text_msg_flag:"group_text_message",uint64_group_info_flag:"group_profile",uint64_group_member_info_flag:"group_member_profile",uint64_relation_chain_flag:"sns",uint64_user_info_flag:"user_profile",rpt_msg_dirty_word:"lexicon",str_dirty_word:"profanity",str_replaced_content:"replacement",uint64_filter_type:"filterType",uint64_id:"id",uint64_word_type:"profanityType",uint64_complete_flag:"completeFlag",uint64_next_start_index:"nextStartIndex",uint64_version:"version",uint64_expired_time:"expiredTime"}}}}(e))),this._configMap.set(Mi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.SEND_MESSAGE)}),body:{fromAccount:"",toAccount:"",msgSeq:0,msgRandom:0,msgBody:[],cloudCustomData:void 0,nick:"",avatar:"",msgLifeTime:void 0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{badgeMode:0,isVoipPush:void 0},androidInfo:{OPPOChannelID:""}},messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,isSupportExtension:0},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",count:"MaxCnt",lastMessageTime:"LastMsgTime",messageKey:"MsgKey",peerAccount:"Peer_Account",data:"Data",description:"Desc",extension:"Ext",type:"MsgType",content:"MsgContent",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",nick:"From_AccountNick",avatar:"From_AccountHeadurl",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"IsNeedReadReceipt"}}}}(e)),this._configMap.set(Ti,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.SEND_GROUP_MESSAGE)}),body:{fromAccount:"",groupID:"",random:0,clientSequence:0,priority:"",msgBody:[],cloudCustomData:void 0,onlineOnlyFlag:0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{badgeMode:0,isVoipPush:void 0},androidInfo:{OPPOChannelID:""}},groupAtInfo:[],messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,topicID:void 0,receiverList:void 0,isSupportExtension:0},keyMap:{request:{to:"GroupId",extension:"Ext",data:"Data",description:"Desc",random:"Random",sequence:"ReqMsgSeq",count:"ReqMsgNumber",type:"MsgType",priority:"MsgPriority",content:"MsgContent",elements:"MsgBody",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",clientSequence:"ClientSeq",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"NeedReadReceipt",receiverList:"To_Account"},response:{MsgTime:"time",MsgSeq:"sequence"}}}}(e)),this._configMap.set(Bi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.REVOKE_C2C_MESSAGE)}),body:{msgInfo:{fromAccount:"",toAccount:"",msgTimeStamp:0,msgSeq:0,msgRandom:0}},keyMap:{request:{msgInfo:"MsgInfo",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom"}}}}(e)),this._configMap.set(Er,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.REVOKE_GROUP_MESSAGE)}),body:{groupID:"",msgSeqList:void 0,topicID:""},keyMap:{request:{msgSeqList:"MsgSeqList",msgSeq:"MsgSeq"}}}}(e)),this._configMap.set(zi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.GET_C2C_ROAM_MESSAGES)}),body:{peerAccount:"",count:15,lastMessageTime:0,messageKey:"",withRecalledMessage:1,direction:0},keyMap:{request:{messageKey:"MsgKey",peerAccount:"Peer_Account",count:"MaxCnt",lastMessageTime:"LastMsgTime",withRecalledMessage:"WithRecalledMsg",direction:"GetDirection"},response:{LastMsgTime:"lastMessageTime",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer"}}}}(e)),this._configMap.set($i,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.MODIFY_C2C_MESSAGE)}),body:{from:"",to:"",sequence:0,random:0,time:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{request:{sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}}(e)),this._configMap.set(Dr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_GROUP_ROAM_MESSAGES)}),body:{withRecalledMsg:1,groupID:"",count:15,sequence:"",topicID:void 0},keyMap:{request:{sequence:"ReqMsgSeq",count:"ReqMsgNumber",withRecalledMessage:"WithRecalledMsg"},response:{Random:"random",MsgTime:"time",MsgSeq:"sequence",ReqMsgSeq:"sequence",RspMsgList:"messageList",IsPlaceMsg:"isPlaceMessage",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgPriority:"priority",MsgBody:"elements",MsgType:"type",MsgContent:"content",IsFinished:"complete",Download_Flag:"downloadFlag",ClientSeq:"clientSequence",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList"}}}}(e)),this._configMap.set(Hi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.SET_C2C_MESSAGE_READ)}),body:{C2CMsgReaded:void 0},keyMap:{request:{lastMessageTime:"LastedMsgTime"}}}}(e)),this._configMap.set(ji,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.SET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{userIDList:void 0,muteFlag:0},keyMap:{request:{userIDList:"Peer_Account",muteFlag:"Mute_Notifications"}}}}(e)),this._configMap.set(Ki,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.GET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{updateSequence:0},keyMap:{response:{MuteNotificationsList:"muteFlagList"}}}}(e)),this._configMap.set(kr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.SET_GROUP_MESSAGE_READ)}),body:{groupID:void 0,messageReadSeq:void 0,topicID:void 0},keyMap:{request:{messageReadSeq:"MsgReadedSeq"}}}}(e)),this._configMap.set(br,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.SET_ALL_MESSAGE_READ)}),body:{readAllC2CMessage:0,groupMessageReadInfoList:[]},keyMap:{request:{readAllC2CMessage:"C2CReadAllMsg",groupMessageReadInfoList:"GroupReadInfo",messageSequence:"MsgSeq"},response:{C2CReadAllMsg:"readAllC2CMessage",GroupReadInfoArray:"groupMessageReadInfoList"}}}}(e)),this._configMap.set(Yi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.DELETE_C2C_MESSAGE)}),body:{fromAccount:"",to:"",keyList:void 0},keyMap:{request:{keyList:"MsgKeyList"}}}}(e)),this._configMap.set(Gr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.DELETE_GROUP_MESSAGE)}),body:{groupID:"",deleter:"",keyList:void 0,topicID:void 0},keyMap:{request:{deleter:"Deleter_Account",keyList:"Seqs"}}}}(e)),this._configMap.set(Oo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_TRANSLATE,".").concat(B.CMD.TRANSLATE_TEXT)}),body:{sourceTextList:void 0,SDKAppID:0,from:0,source:"",target:""},keyMap:{request:{sourceTextList:"SourceText",SDKAppID:"SdkAppId",from:"FromAccount"},response:{TargetText:"translatedTextList",RequestId:"requestID",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}}(e)),this._configMap.set(Fr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.MODIFY_GROUP_MESSAGE)}),body:{groupID:"",topicID:void 0,sequence:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{request:{sequence:"MsgSeq",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}}(e)),this._configMap.set(wr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{request:{sequence:"MsgSeq"}}}}(e)),this._configMap.set(Rr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.SEND_C2C_READ_RECEIPT)}),body:{peerAccount:"",messageInfoList:void 0},keyMap:{request:{peerAccount:"Peer_Account",messageInfoList:"C2CMsgInfo",fromAccount:"From_Account",toAccount:"To_Account",sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",clientTime:"MsgClientTime"}}}}(e)),this._configMap.set(Ar,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.SEND_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{request:{sequenceList:"MsgSeqList",sequence:"MsgSeq"}}}}(e)),this._configMap.set(Lr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_READ_RECEIPT_DETAIL)}),body:{groupID:"",sequence:void 0,flag:0,cursor:0,count:0},keyMap:{request:{sequence:"MsgSeq",count:"Num"},response:{ReadList:"readUserIDList",Read_Account:"userID",UnreadList:"unreadUserIDList",Unread_Account:"userID",IsFinish:"isCompleted"}}}}(e)),this._configMap.set(Ji,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM_MSG_EXT,".").concat(B.CMD.MODIFY_C2C_MESSAGE_EXTENSIONS)}),body:{from:void 0,to:void 0,messageKey:void 0,operateType:void 0,extensionList:void 0}}}(e)),this._configMap.set(Xi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM_MSG_EXT,".").concat(B.CMD.GET_C2C_MESSAGE_EXTENSIONS)}),body:{from:void 0,to:void 0,messageKey:void 0,startSequence:void 0}}}(e)),this._configMap.set(Kr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM_MSG_EXT,".").concat(B.CMD.MODIFY_GROUP_MESSAGE_EXTENSIONS)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,operateType:void 0,extensionList:void 0}}}(e)),this._configMap.set(zr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM_MSG_EXT,".").concat(B.CMD.GET_GROUP_MESSAGE_EXTENSIONS)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,startSequence:void 0}}}(e)),this._configMap.set(Wi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.GET_PEER_READ_TIME)}),body:{userIDList:void 0},keyMap:{request:{userIDList:"To_Account"},response:{ReadTime:"peerReadTimeList"}}}}(e)),this._configMap.set(Qi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.GET_CONVERSATION_LIST)}),body:{fromAccount:void 0,count:0},keyMap:{request:{},response:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime"}}}}(e)),this._configMap.set(Zi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.PAGING_GET_CONVERSATION_LIST)}),body:{fromAccount:void 0,timeStamp:void 0,startIndex:void 0,pinnedTimeStamp:void 0,pinnedStartIndex:void 0,orderType:void 0,messageAssistFlag:4,assistFlag:15},keyMap:{request:{messageAssistFlag:"MsgAssistFlags",assistFlag:"AssistFlags",pinnedTimeStamp:"TopTimeStamp",pinnedStartIndex:"TopStartIndex"},response:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime",LastMsgFlags:"lastMessageFlag",TopFlags:"isPinned",TopTimeStamp:"pinnedTimeStamp",TopStartIndex:"pinnedStartIndex",GroupId:"convGroupID"}}}}(e)),this._configMap.set(er,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.DELETE_CONVERSATION)}),body:{fromAccount:"",conversationList:void 0,clearHistoryMessage:void 0},keyMap:{request:{toGroupID:"ToGroupid",clearHistoryMessage:"ClearRamble",conversationList:"ContactItem"},response:{ResultItem:"resultList",ToGroupid:"toGroupID",ResultCode:"code",ResultInfo:"info"}}}}(e)),this._configMap.set(tr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.CLEAR_HISTORY_MESSAGE)}),body:{fromAccount:"",toAccount:void 0,type:1,toGroupID:void 0},keyMap:{request:{toGroupID:"ToGroupid"}}}}(e)),this._configMap.set(nr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.PIN_CONVERSATION)}),body:{fromAccount:"",operationType:1,itemList:void 0},keyMap:{request:{itemList:"RecentContactItem"}}}}(e)),this._configMap.set(ir,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.DELETE_GROUP_AT_TIPS)}),body:{messageListToDelete:void 0},keyMap:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}}(e)),this._configMap.set(rr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.MARK_CONVERSATION)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},response:{ToGroupId:"groupID",OptType:"operationType"}}}}(e)),this._configMap.set(or,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.MARK_CONVERSATION)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},response:{ToGroupId:"groupID",OptType:"operationType"}}}}(e)),this._configMap.set(ar,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.CREATE_CONVERSATION_GROUP)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"GroupContactItem",groupID:"ToGroupId"},response:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType"}}}}(e)),this._configMap.set(sr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.DELETE_CONVERSATION_GROUP)}),body:{fromAccount:"",groupName:void 0},keyMap:{request:{},response:{GroupId:"convGroupID"}}}}(e)),this._configMap.set(cr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.UPDATE_CONVERSATION_GROUP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{request:{oldName:"OldGroupName",newName:"NewGroupName",groupID:"ToGroupId",operationType:"ContactOptType",groupName:"OldGroupName",updateItem:"ContactUpdateItem"},response:{ContactOptType:"operationType",ToGroupId:"groupID",GroupId:"convGroupID"}}}}(e)),this._configMap.set(ur,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.UPDATE_CONVERSATION_GROUP)}),body:{fromAccount:"",updateType:void 0,updateGroup:{groupName:void 0,updateGroupType:void 0,updateItem:void 0}},keyMap:{request:{},response:{}}}}(e)),this._configMap.set(lr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.UPDATE_CONVERSATION_GROUP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{request:{},response:{}}}}(e)),this._configMap.set(dr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.GET_CONVERSATION_GROUP_LIST)}),body:{fromAccount:"",startTime:void 0,startIndex:void 0},keyMap:{request:{},response:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList"}}}}(e)),this._configMap.set(Ci,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.PROFILE,".").concat(B.CMD.PORTRAIT_GET)}),body:{fromAccount:"",userItem:[]},keyMap:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}}(e)),this._configMap.set(Si,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.PROFILE,".").concat(B.CMD.PORTRAIT_SET)}),body:{fromAccount:"",profileItem:[{tag:Ke.NICK,value:""},{tag:Ke.GENDER,value:""},{tag:Ke.ALLOWTYPE,value:""},{tag:Ke.AVATAR,value:""}]},keyMap:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}}(e)),this._configMap.set(Ei,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.GET_BLACKLIST)}),body:{fromAccount:"",startIndex:0,maxLimited:30,lastSequence:0},keyMap:{response:{CurruentSequence:"currentSequence"}}}}(e)),this._configMap.set(ki,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.ADD_BLACKLIST)}),body:{fromAccount:"",toAccount:[]}}}(e)),this._configMap.set(bi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.DELETE_BLACKLIST)}),body:{fromAccount:"",toAccount:[]}}}(e)),this._configMap.set(Eo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.SET_SELF_STATUS)}),body:{customStatus:""},keyMap:{}}}(e)),this._configMap.set(ko,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.GET_USER_STATUS)}),body:{userIDList:void 0},keyMap:{response:{UserStatusList:"successUserList",ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID",Status:"statusType"}}}}(e)),this._configMap.set(bo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.SUBSCRIBE_USER_STATUS)}),body:{userIDList:void 0},keyMap:{response:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}}(e)),this._configMap.set(Do,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.UNSUBSCRIBE_USER_STATUS)}),body:{userIDList:void 0,unsubscribeAll:void 0},keyMap:{response:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}}(e)),this._configMap.set(Di,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.GET_FRIEND_LIST)}),body:{fromAccount:"",startIndex:0,standardSequence:0,customSequence:0},keyMap:{response:{FriendNum:"friendCount",UserDataItem:"resultList",ValueItem:"tagValueList"}}}}(e)),this._configMap.set(Li,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.ADD_FRIEND)}),body:{fromAccount:"",addFriendItem:[],type:""},keyMap:{request:{source:"AddSource",wording:"AddWording",type:"AddType"},response:{ResultItem:"resultList"}}}}(e)),this._configMap.set(Oi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.UPDATE_FRIEND)}),body:{fromAccount:"",updateItem:void 0},keyMap:{request:{snsItem:"SnsItem"},response:{ResultItem:"resultList"}}}}(e)),this._configMap.set(Ri,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.DELETE_FRIEND)}),body:{fromAccount:"",userIDList:[],type:""},keyMap:{request:{type:"DeleteType"},response:{ResultItem:"resultList"}}}}(e)),this._configMap.set(wi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.GET_FRIEND_PROFILE)}),body:{fromAccount:"",userIDList:void 0},keyMap:{response:{InfoItem:"resultList",SnsProfileItem:"tagValueList"}}}}(e)),this._configMap.set(Ai,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.CHECK_FRIEND)}),body:{fromAccount:"",userIDList:[],type:""},keyMap:{request:{type:"CheckType"},response:{InfoItem:"resultList"}}}}(e)),this._configMap.set(Pi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.GET_FRIEND_APPLICATION_LIST)}),body:{fromAccount:"",applicationType:"",startTime:0,maxLimited:0,lastSequence:0},keyMap:{response:{PendencyItem:"resultList",AddSource:"source",AddTime:"time",AddWording:"wording",Image:"avatar",UnreadPendencyCount:"unreadCount",To_Account:"userID",PendencyType:"type"}}}}(e)),this._configMap.set(Ni,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.RESPOND_FRIEND_APPLICATION)}),body:{fromAccount:"",responseFriendItem:[]},keyMap:{request:{tag:"TagName",action:"ResponseAction"},response:{ResultItem:"resultList"}}}}(e)),this._configMap.set(Ui,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.DELETE_FRIEND_APPLICATION)}),body:{fromAccount:"",type:"",userIDList:void 0},keyMap:{request:{type:"PendencyType",userIDList:"To_Account"},response:{ResultItem:"resultList"}}}}(e)),this._configMap.set(xi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.REPORT_FRIEND_APPLICATION)}),body:{fromAccount:"",latestTimeStamp:""},keyMap:{request:{latestTimeStamp:"LatestPendencyTimeStamp"}}}}(e)),this._configMap.set(Fi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.CREATE_FRIEND_GROUP)}),body:{fromAccount:"",groupName:void 0,userIDList:void 0},keyMap:{request:{groupName:"GroupName",userIDList:"To_Account"},response:{ResultItem:"resultList"}}}}(e)),this._configMap.set(Vi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.DELETE_FRIEND_GROUP)}),body:{fromAccount:"",nameList:void 0},keyMap:{request:{nameList:"GroupName"}}}}(e)),this._configMap.set(Gi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.GET_FRIEND_GROUP_LIST)}),body:{fromAccount:"",lastSequence:0,needFriend:"Need_Friend_Type_Yes"},keyMap:{response:{ResultItem:"resultList",GroupName:"name",FriendNumber:"friendCount",To_Account:"userIDList"}}}}(e)),this._configMap.set(qi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.UPDATE_FRIEND_GROUP)}),body:{fromAccount:"",oldName:"",newName:void 0,updateGroupItem:void 0},keyMap:{request:{oldName:"GroupOldName",newName:"GroupNewName"},response:{UpdateType:"type",ResultItem:"resultList"}}}}(e)),this._configMap.set(pr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_JOINED_GROUPS)}),body:{memberAccount:"",limit:void 0,offset:void 0,groupType:void 0,responseFilter:{groupBaseInfoFilter:void 0,selfInfoFilter:void 0},isSupportTopic:0},keyMap:{request:{memberAccount:"Member_Account"},response:{GroupIdList:"groups",NoUnreadSeqList:"excludedUnreadSequenceList",MsgSeq:"readedSequence",LastRecallTime:"_lastRevokedTime"}}}}(e)),this._configMap.set(hr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_GROUP_INFO)}),body:{groupIDList:void 0,responseFilter:{groupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember"],groupCustomFieldFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0}},keyMap:{request:{groupIDList:"GroupIdList",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",groupCustomFieldFilter:"AppDefinedDataFilter_Group",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{GroupIdList:"groups",AppDefinedData:"groupCustomField",AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_Group:"groupCustomFieldFilter",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",InfoSeq:"infoSequence",MemberList:"members",GroupInfo:"groups",ShutUpUntil:"muteUntil",ShutUpAllMember:"muteAllMembers"}}}}(e)),this._configMap.set(fr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.CREATE_GROUP)}),body:{type:void 0,name:void 0,groupID:void 0,ownerID:void 0,introduction:void 0,notification:void 0,maxMemberNum:void 0,joinOption:void 0,memberList:void 0,groupCustomField:void 0,memberCustomField:void 0,webPushFlag:1,avatar:"",isSupportTopic:void 0,inviteOption:void 0},keyMap:{request:{ownerID:"Owner_Account",userID:"Member_Account",avatar:"FaceUrl",maxMemberNum:"MaxMemberCount",joinOption:"ApplyJoinOption",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",inviteOption:"InviteJoinOption"},response:{HugeGroupFlag:"avChatRoomFlag",OverJoinedGroupLimit_Account:"overLimitUserIDList"}}}}(e)),this._configMap.set(gr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.DESTROY_GROUP)}),body:{groupID:void 0}}}(e)),this._configMap.set(mr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.MODIFY_GROUP_INFO)}),body:{groupID:void 0,name:void 0,introduction:void 0,notification:void 0,avatar:void 0,joinOption:void 0,groupCustomField:void 0,muteAllMembers:void 0,inviteOption:void 0},keyMap:{request:{groupCustomField:"AppDefinedData",muteAllMembers:"ShutUpAllMember",joinOption:"ApplyJoinOption",avatar:"FaceUrl",inviteOption:"InviteJoinOption"},response:{AppDefinedData:"groupCustomField",ShutUpAllMember:"muteAllMembers"}}}}(e)),this._configMap.set(vr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.APPLY_JOIN_GROUP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1,historyMessageFlag:void 0},keyMap:{request:{applyMessage:"ApplyMsg",historyMessageFlag:"HugeGroupHistoryMsgFlag"},response:{HugeGroupFlag:"avChatRoomFlag",AVChatRoomKey:"avChatRoomKey",RspMsgList:"messageList",ToGroupId:"to"}}}}(e)),this._configMap.set(_r,function(e){return e.a2,e.tinyid,{head:t(t({},h(e,cc)),{},{servcmd:"".concat(B.NAME.BIG_GROUP_NO_AUTH,".").concat(B.CMD.APPLY_JOIN_GROUP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1},keyMap:{request:{applyMessage:"ApplyMsg"},response:{HugeGroupFlag:"avChatRoomFlag"}}}}(e)),this._configMap.set(yr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.QUIT_GROUP)}),body:{groupID:void 0}}}(e)),this._configMap.set(Ir,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.SEARCH_GROUP_BY_ID)}),body:{groupIDList:void 0,responseFilter:{groupBasePublicInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption","InviteJoinOption"]}},keyMap:{response:{}}}}(e)),this._configMap.set(Mr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.CHANGE_GROUP_OWNER)}),body:{groupID:void 0,newOwnerID:void 0},keyMap:{request:{newOwnerID:"NewOwner_Account"}}}}(e)),this._configMap.set(Tr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.HANDLE_APPLY_JOIN_GROUP)}),body:{groupID:void 0,applicant:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{request:{applicant:"Applicant_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}}(e)),this._configMap.set(Cr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.HANDLE_INVITE_JOIN_GROUP)}),body:{groupID:void 0,applicant:void 0,invitee:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,userDefinedField:void 0},keyMap:{request:{applicant:"Applicant_Account",invitee:"Invited_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg"}}}}(e)),this._configMap.set(Sr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.HANDLE_GROUP_INVITATION)}),body:{groupID:void 0,inviter:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{request:{inviter:"Inviter_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}}(e)),this._configMap.set(Or,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_GROUP_APPLICATION)}),body:{startTime:void 0,limit:void 0,handleAccount:void 0},keyMap:{request:{handleAccount:"Handle_Account"},response:{To_Account:"userID"}}}}(e)),this._configMap.set(Nr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.DELETE_GROUP_SYSTEM_MESSAGE)}),body:{messageListToDelete:void 0},keyMap:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}}(e)),this._configMap.set(Pr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.BIG_GROUP_LONG_POLLING,".").concat(B.CMD.AVCHATROOM_LONG_POLL)}),body:{USP:1,startSeq:1,startBroadcastSeq:void 0,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{request:{USP:"USP"},response:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}}(e)),this._configMap.set(Ur,function(e){return e.a2,e.tinyid,{head:t(t({},h(e,uc)),{},{servcmd:"".concat(B.NAME.BIG_GROUP_LONG_POLLING_NO_AUTH,".").concat(B.CMD.AVCHATROOM_LONG_POLL)}),body:{USP:1,startSeq:1,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{request:{USP:"USP"},response:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}}(e)),this._configMap.set(xr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_ONLINE_MEMBER_NUM)}),body:{groupID:void 0}}}(e)),this._configMap.set(Vr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.SET_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key",value:"value"}}}}(e)),this._configMap.set(qr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.MODIFY_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key",value:"value"}}}}(e)),this._configMap.set(Br,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.DELETE_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key"}}}}(e)),this._configMap.set(Hr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.CLEAR_GROUP_ATTRIBUTES)}),body:{groupID:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]}}}(e)),this._configMap.set(jr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP_ATTR,".").concat(B.CMD.GET_GROUP_ATTRIBUTES)}),body:{groupID:void 0,avChatRoomKey:void 0,groupType:1},keyMap:{request:{avChatRoomKey:"Key",groupType:"GroupType"}}}}(e)),this._configMap.set(Wr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_GROUP_NOTIFY)}),body:{notifyType:1,groupID:"",beginTime:0,endTime:0,limit:20},keyMap:{request:{},response:{NextMsgTime:"nextRevokedTime",NotifyMsgList:"notifyList"}}}}(e)),this._configMap.set(Yr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.UPDATE_GROUP_COUNTER)}),body:{groupID:void 0,counterList:void 0,avChatRoomKey:void 0,mode:void 0},keyMap:{request:{counterList:"GroupCounter"}}}}(e)),this._configMap.set($r,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_GROUP_COUNTER)}),body:{groupID:void 0,keyList:[],avChatRoomKey:void 0},keyMap:{request:{keyList:"GroupCounterKeys"}}}}(e)),this._configMap.set(Mo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP_COMMUNITY,".").concat(B.CMD.CREATE_TOPIC)}),body:{groupID:void 0,topicName:void 0,avatar:void 0,customData:void 0,topicID:void 0,notification:void 0,introduction:void 0},keyMap:{request:{avatar:"FaceUrl"}}}}(e)),this._configMap.set(To,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP_COMMUNITY,".").concat(B.CMD.DELETE_TOPIC)}),body:{groupID:void 0,topicIDList:void 0},keyMap:{request:{topicIDList:"TopicIdList"},response:{DestroyResultItem:"resultList"}}}}(e)),this._configMap.set(Co,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP_COMMUNITY,".").concat(B.CMD.UPDATE_TOPIC_PROFILE)}),body:{groupID:void 0,topicID:void 0,avatar:void 0,customData:void 0,notification:void 0,introduction:void 0,muteAllMembers:void 0,topicName:void 0},keyMap:{request:{avatar:"FaceUrl",muteAllMembers:"ShutUpAllMember"}}}}(e)),this._configMap.set(So,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP_COMMUNITY,".").concat(B.CMD.GET_TOPIC_LIST)}),body:{groupID:void 0,topicIDList:void 0,MemberInfoFilter:["NoUnreadSeqList"]},keyMap:{request:{topicIDList:"TopicIdList"},response:{TopicAndSelfInfo:"topicInfoList",TopicInfo:"topic",GroupID:"groupID",ShutUpTime:"muteTime",ShutUpAllFlag:"muteAllMembers",LastMsgTime:"lastMessageTime",MsgSeq:"readedSequence",LastMsgSeq:"sequence",NoUnreadSeqList:"excludedUnreadSequenceList"}}}}(e)),this._configMap.set(Jr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_GROUP_MEMBER_LIST)}),body:{groupID:void 0,limit:0,offset:void 0,next:void 0,memberRoleFilter:void 0,memberInfoFilter:["Role","NameCard","ShutUpUntil","JoinTime"],memberCustomFieldFilter:void 0},keyMap:{request:{memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",MemberList:"members",ShutUpUntil:"muteUntil"}}}}(e)),this._configMap.set(Xr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP_AVCHATROOM,".").concat(B.CMD.GET_AVCHATROOM_MEMBER_LIST)}),body:{groupID:void 0,offset:void 0,filter:void 0},keyMap:{request:{offset:"Timestamp",filter:"Mark"},response:{NextTimestamp:"offset"}}}}(e)),this._configMap.set(Zr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_GROUP_MEMBER_INFO)}),body:{groupID:void 0,userIDList:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{request:{userIDList:"Member_List_Account",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{MemberList:"members",ShutUpUntil:"muteUntil",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",AppMemberDefinedData:"memberCustomField"}}}}(e)),this._configMap.set(Qr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.ADD_GROUP_MEMBER)}),body:{groupID:void 0,silence:void 0,userIDList:void 0},keyMap:{request:{userID:"Member_Account",userIDList:"MemberList"},response:{MemberList:"members"}}}}(e)),this._configMap.set(eo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.DELETE_GROUP_MEMBER)}),body:{groupID:void 0,userIDList:void 0,reason:void 0},keyMap:{request:{userIDList:"MemberToDel_Account"}}}}(e)),this._configMap.set(to,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.BAN_AVCHATROOM_MEMBER)}),body:{groupID:void 0,userIDList:void 0,duration:void 0,reason:""},keyMap:{request:{userIDList:"Members_Account",duration:"Duration",reason:"Description"}}}}(e)),this._configMap.set(no,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.MODIFY_GROUP_MEMBER_INFO)}),body:{groupID:void 0,topicID:void 0,userID:void 0,messageRemindType:void 0,nameCard:void 0,role:void 0,memberCustomField:void 0,muteTime:void 0},keyMap:{request:{userID:"Member_Account",memberCustomField:"AppMemberDefinedData",muteTime:"ShutUpTime",messageRemindType:"MsgFlag"}}}}(e)),this._configMap.set(io,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP_AVCHATROOM,".").concat(B.CMD.MARK_AVCHATROOM_MEMBER_INFO)}),body:{groupID:void 0,operationType:1,memberList:[]},keyMap:{request:{operationType:"CommandType",memberList:"MemberList",markType:"Marks",userID:"Member_Account"},response:{CommandType:"operationType",Marks:"markType",Member_Account:"userID"}}}}(e)),this._configMap.set(so,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STAT,".").concat(B.CMD.TIM_WEB_REPORT_V2)}),body:{header:{},event:[],quality:[]},keyMap:{request:{SDKType:"sdk_type",SDKVersion:"sdk_version",deviceType:"device_type",platform:"platform",instanceID:"instance_id",traceID:"trace_id",SDKAppID:"sdk_app_id",userID:"user_id",tinyID:"tiny_id",extension:"extension",timestamp:"timestamp",networkType:"network_type",eventType:"event_type",code:"error_code",message:"error_message",moreMessage:"more_message",duplicate:"duplicate",costTime:"cost_time",level:"level",qualityType:"quality_type",reportIndex:"report_index",wholePeriod:"whole_period",totalCount:"total_count",rttCount:"success_count_business",successRateOfRequest:"percent_business",countLessThan1Second:"success_count_business",percentOfCountLessThan1Second:"percent_business",countLessThan3Second:"success_count_platform",percentOfCountLessThan3Second:"percent_platform",successCountOfBusiness:"success_count_business",successRateOfBusiness:"percent_business",successCountOfPlatform:"success_count_platform",successRateOfPlatform:"percent_platform",successCountOfMessageReceived:"success_count_business",successRateOfMessageReceived:"percent_business",avgRTT:"average_value",avgDelay:"average_value",avgValue:"average_value",uiPlatform:"ui_platform"}}}}(i)),this._configMap.set(co,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.HEARTBEAT,".").concat(B.CMD.ALIVE)}),body:{}}}(e)),this._configMap.set(uo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_PUSH,".").concat(B.CMD.MESSAGE_PUSH)}),body:{},keyMap:{response:{C2cMsgArray:"C2CMessageArray",GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",C2cNotifyMsgArray:"C2CNotifyMessageArray",C2cMsgInfo:"C2CReadReceiptArray",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyAdd_Account:"userID",ProfileImNick:"nick",PendencyType:"applicationType",C2CReadAllMsg:"readAllC2CMessage",IsNeedReadReceipt:"needReadReceipt",Status:"statusType"}}}}(e)),this._configMap.set(lo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_PUSH,".").concat(B.CMD.MULTI_MESSAGE_PUSH)}),body:{},keyMap:{response:{GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyType:"applicationType"}}}}(e)),this._configMap.set(po,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.MESSAGE_PUSH_ACK)}),body:{sessionData:void 0},keyMap:{request:{sessionData:"SessionData"}}}}(e)),this._configMap.set(ho,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.STATUS_FORCE_OFFLINE)}),body:{},keyMap:{response:{C2cNotifyMsgArray:"C2CNotifyMessageArray",NoticeSeq:"noticeSequence",KickoutMsgNotify:"kickoutMsgNotify",NewInstInfo:"newInstanceInfo"}}}}(e)),this._configMap.set(go,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_LONG_MESSAGE,".").concat(B.CMD.DOWNLOAD_MERGER_MESSAGE)}),body:{downloadKey:""},keyMap:{response:{Data:"data",Desc:"description",Ext:"extension",Download_Flag:"downloadFlag",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID"}}}}(e)),this._configMap.set(fo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_LONG_MESSAGE,".").concat(B.CMD.UPLOAD_MERGER_MESSAGE)}),body:{messageList:[]},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",type:"MsgType",content:"MsgContent",data:"Data",description:"Desc",extension:"Ext",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody"}}}}(e)),this._configMap.set(Ro,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.SET_TOKEN)}),body:{tokenID:"",pushMsg:0,sdkAppID:0,businessID:"",deviceBrand:"",deviceToken:"",isTpns:0,isWebUniapp:0},keyMap:{request:{tokenID:"TokenID",pushMsg:"PushMsg",sdkAppID:"EnterVersion",businessID:"BusiID",deviceBrand:"InstType",deviceToken:"VarToken",isTpns:"IsTpns"}}}}(e)),this._configMap.set(Ao,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.STAT_FOREGROUND)}),body:{isWebUniapp:0}}}(e)),this._configMap.set(wo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.STAT_BACKGROUND)}),body:{C2CUnread:0,GroupUnread:0,isWebUniapp:0},keyMap:{request:{c2cUnreadCount:"C2cUnread",groupUnreadCount:"GrpUnread"}}}}(e))}},{key:"has",value:function(e){return this._configMap.has(e)}},{key:"get",value:function(e){return this._configMap.get(e)}},{key:"update",value:function(){this._fillConfigMap()}},{key:"getKeyMap",value:function(e){return this.has(e)?this.get(e).keyMap||{}:(He.w("".concat(this._n,".getKeyMap unknown protocolName:").concat(e)),{})}},{key:"getProtocolData",value:function(e){var t=e.protocolName,n=e.requestData,i=this.get(t),r=null;if(n){var o=this._simpleDeepCopy(i),a=this._updateService(n,o),s=a.body,c=Object.create(null);for(var u in s)if(Object.prototype.hasOwnProperty.call(s,u)){if(c[u]=s[u],void 0===n[u])continue;c[u]=n[u]}a.body=c,r=this._getUplinkData(a)}else r=this._getUplinkData(i);return r}},{key:"_getUplinkData",value:function(e){var t=this._requestDataCleaner(e),n=Ht(t.head),i=zs(t.body,this._getRequestKeyMap(n));return t.body=i,t}},{key:"_updateService",value:function(e,t){var n=Ht(t.head);if(this._isFromGroupRequest(t)){var i=e.type,r=e.groupID,o=void 0===r?void 0:r,a=e.groupIDList,s=void 0===a?[]:a;ht(o)&&(o=s[0]||""),Rt({type:i,groupID:o})&&(t.head.servcmd="".concat(B.NAME.GROUP_COMMUNITY,".").concat(n))}return t}},{key:"_isFromGroupRequest",value:function(e){return e.head.servcmd.includes(B.NAME.GROUP)||e.head.servcmd.includes(B.NAME.GROUP_ATTR)}},{key:"_getRequestKeyMap",value:function(e){var n=this.getKeyMap(e);return t(t({},Hs.request),n.request)}},{key:"_requestDataCleaner",value:function(e){var t=Array.isArray(e)?[]:Object.create(null);for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&_t(i)&&null!==e[i]&&void 0!==e[i]&&("object"!==n(e[i])?t[i]=e[i]:t[i]=this._requestDataCleaner.bind(this)(e[i]));return t}},{key:"_simpleDeepCopy",value:function(e){for(var t,n=Object.keys(e),i={},r=0,o=n.length;r<o;r++)t=n[r],pt(e[t])?i[t]=Array.from(e[t]):lt(e[t])?i[t]=this._simpleDeepCopy(e[t]):i[t]=e[t];return i}}]),e}(),dc=[po],pc=function(){function e(t){i(this,e),this._sessionModule=t,this._n="DownlinkHandler",this._eventHandlerMap=new Map,this._eventHandlerMap.set("C2CMessageArray",this._c2cMessageArrayHandler.bind(this)),this._eventHandlerMap.set("groupMessageArray",this._groupMessageArrayHandler.bind(this)),this._eventHandlerMap.set("groupTips",this._groupTipsHandler.bind(this)),this._eventHandlerMap.set("C2CNotifyMessageArray",this._C2CNotifyMessageArrayHandler.bind(this)),this._eventHandlerMap.set("C2CReadReceiptArray",this._C2CReadReceiptArrayHandler.bind(this)),this._eventHandlerMap.set("profileModify",this._profileHandler.bind(this)),this._eventHandlerMap.set("friendListMod",this._relationChainHandler.bind(this)),this._eventHandlerMap.set("recentContactMod",this._recentContactHandler.bind(this)),this._eventHandlerMap.set("readAllC2CMessage",this._allMessageReadHandler.bind(this)),this._eventHandlerMap.set("c2cMessageModified",this._c2cMessageModifiedHandler.bind(this)),this._eventHandlerMap.set("groupMessageModified",this._groupMessageModifiedHandler.bind(this)),this._eventHandlerMap.set("userStatusList",this._userStatusListHandler.bind(this)),this._eventHandlerMap.set("messageExtensionNotify",this._messageExtensionNotifyHandler.bind(this)),this._keys=_(this._eventHandlerMap.keys())}return o(e,[{key:"_c2cMessageArrayHandler",value:function(e){var t=this._sessionModule.getModule(qn);t&&(e.dataList.forEach((function(e){if(1===e.isSyncMessage){var t=e.from;e.from=e.to,e.to=t}})),1===e.needSync&&this._sessionModule.getModule(ei).startOnlineSync(),t.onNewC2CMessage({dataList:e.dataList,isInstantMessage:!0}))}},{key:"_c2cMessageModifiedHandler",value:function(e){var t=this._sessionModule.getModule(qn);t&&t.onC2CMessageModified(e)}},{key:"_groupMessageArrayHandler",value:function(e){var t=this._sessionModule.getModule(Bn);t&&t.onNewGroupMessage({event:e.event,dataList:e.dataList,isInstantMessage:!0})}},{key:"_groupMessageModifiedHandler",value:function(e){var t=this._sessionModule.getModule(Bn);t&&t.onGroupMessageModified(e)}},{key:"_groupTipsHandler",value:function(e){var t=this._sessionModule.getModule(Bn);if(t){var n=e.event,i=e.dataList,r=e.isInstantMessage,o=void 0===r||r,a=e.isSyncingEnded;switch(n){case 4:case 6:t.onNewGroupTips({event:n,dataList:i});break;case 5:for(var s=0;s<i.length;s++)if(pt(i[s].elements.revokedInfos))t.onGroupMessageRevoked({dataList:i});else if(pt(i[s].elements.groupMessageReadNotice))t.onGroupMessageReadNotice({dataList:i});else{if(!pt(i[s].elements.readReceiptList)){t.onNewGroupSystemNotice({dataList:i,isInstantMessage:o,isSyncingEnded:a});break}t.onReadReceiptList({dataList:i})}break;case 12:this._sessionModule.getModule(zn).onNewGroupAtTips({dataList:i});break;default:He.l("".concat(this._n,"._groupTipsHandler unknown event:").concat(n," dataList:"),i)}}}},{key:"_C2CNotifyMessageArrayHandler",value:function(e){var t=this,n=e.dataList;if(pt(n)){var i=this._sessionModule.getModule(qn);n.forEach((function(e){if(dt(e))if(e.hasOwnProperty("kickoutMsgNotify")){var r=e.kickoutMsgNotify,o=r.kickType,a=r.newInstanceInfo,s=void 0===a?{}:a;1===o?t._sessionModule.onMultipleAccountKickedOut(s):2===o?t._sessionModule.onMultipleDeviceKickedOut(s):3===o&&t._sessionModule.onRestApiKickedOut(s)}else e.hasOwnProperty("c2cMessageRevokedNotify")?i&&i.onC2CMessageRevoked({dataList:n}):e.hasOwnProperty("c2cMessageReadReceipt")?i&&i.onC2CMessageReadReceipt({dataList:n}):e.hasOwnProperty("c2cMessageReadNotice")?i&&i.onC2CMessageReadNotice({dataList:n}):e.hasOwnProperty("muteNotificationsSync")&&t._sessionModule.getModule(zn).onC2CMessageRemindTypeSynced({dataList:n})}))}}},{key:"_C2CReadReceiptArrayHandler",value:function(e){this._sessionModule.getModule(qn).onReadReceiptList(e)}},{key:"_profileHandler",value:function(e){this._sessionModule.getModule(Vn).onProfileModified({dataList:e.dataList});var t=this._sessionModule.getModule(Hn);t&&t.onFriendProfileModified({dataList:e.dataList})}},{key:"_relationChainHandler",value:function(e){this._sessionModule.getModule(Vn).onRelationChainModified({dataList:e.dataList});var t=this._sessionModule.getModule(Hn);t&&t.onRelationChainModified({dataList:e.dataList})}},{key:"_recentContactHandler",value:function(e){var t=e.dataList;if(pt(t)){var n=this._sessionModule.getModule(zn);n&&t.forEach((function(e){var t=e.pushType;if(1===t){var i=e.recentContactDeleteItem;n.onConversationDeleted(i.recentContactList)}else if(2===t){var r=e.recentContactTopItem;n.onConversationPinned(r.recentContactList)}else if(3===t){var o=e.recentContactTopItem;n.onConversationUnpinned(o.recentContactList)}else if(4===t){var a=e.recentContactMarkContact;n.onConversationMarkUpdated(a.recentContactMarkContactItem)}else if(5===t){var s=e.recentContactCreateContactGroup;n.onConversationGroupCreated(s.msgContactGroupContactItem)}else if(6===t){var c=e.recentContactDelContactGroup;n.onConversationGroupDeleted(c.msgGroupItem)}else if(7===t){var u=e.recentContactUpdateContactGroup,l=u.updateType,d=u.msgUpdateGroup,p=u.msgUpdateContact;if(1===l){var h=d.updateGroupType;1===h?n.onConversationGroupNameUpdated(d):2===h&&n.onConversationInGroupUpdated(d)}else 2===l&&n.onConversationAddedToOrDeletedFromGroup(p)}}))}}},{key:"_allMessageReadHandler",value:function(e){var t=e.dataList,n=this._sessionModule.getModule(zn);n&&n.onPushedAllMessageRead(t)}},{key:"_userStatusListHandler",value:function(e){this._sessionModule.getModule(Vn).onUserStatusUpdated(e)}},{key:"_messageExtensionNotifyHandler",value:function(e){this._sessionModule.getModule(Fn).onMessageExtensionNotify(e)}},{key:"onMessage",value:function(e){var t=this,n=e.body;if(this._filterMessageFromIMOpenPush(e)){var i=n.eventArray,r=n.isInstantMessage,o=n.isSyncingEnded,a=n.needSync;if(pt(i))for(var s=null,c=null,u=0,l=0,d=i.length;l<d;l++){u=(s=i[l]).event;var p=Object.keys(s).find((function(e){return-1!==t._keys.indexOf(e)}));p?(c=14===u?{readAllC2CMessage:s[p],groupMessageReadInfoList:s.groupMessageReadNotice||[]}:16===u?{userID:s.userID,readReceiptList:s[p]}:s[p],this._eventHandlerMap.get(p)({event:u,dataList:c,isInstantMessage:r,isSyncingEnded:o,needSync:a})):He.l("".concat(this._n,".onMessage unknown eventItem:").concat(s))}}}},{key:"_filterMessageFromIMOpenPush",value:function(e){var t=e.head,n=e.body,i=t.servcmd,r=!1;if(ht(i)||(r=i.includes(B.NAME.IM_CONFIG_MANAGER)||i.includes(B.NAME.OVERLOAD_PUSH)||i.includes(B.NAME.STAT_SERVICE)),!r)return!0;if(i.includes(B.CMD.PUSHED_CLOUD_CONTROL_CONFIG))this._sessionModule.getModule(ri).onPushedCloudControlConfig(n);else if(i.includes(B.CMD.PUSHED_COMMERCIAL_CONFIG))this._sessionModule.getModule(ci).onPushedConfig(n);else if(i.includes(B.CMD.OVERLOAD_NOTIFY))this._sessionModule.onPushedServerOverload(n);else if(i.includes(B.CMD.KICK_OTHER)){var o=Date.now();this._sessionModule.reLoginOnKickOther();var a=new $o("kickOther"),s=this._sessionModule.getModule(xn).getLastWsHelloTs(),c=o-s;a.setMessage("last wshello time:".concat(s," diff:").concat(c,"ms")).setNetworkType(this._sessionModule.getNetworkType()).end()}return!1}}]),e}(),hc=[{cmd:B.CMD.GET_GROUP_INFO,interval:1,count:20},{cmd:B.CMD.GET_AVCHATROOM_MEMBER_LIST,interval:3,count:1},{cmd:B.CMD.GET_GROUP_APPLICATION,interval:1,count:15},{cmd:B.CMD.GET_TOPIC_LIST,interval:1,count:10},{cmd:B.CMD.SET_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:B.CMD.MODIFY_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:B.CMD.DELETE_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:B.CMD.CLEAR_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:B.CMD.GET_GROUP_ATTRIBUTES,interval:5,count:20},{cmd:B.CMD.UPDATE_GROUP_COUNTER,interval:5,count:20},{cmd:B.CMD.GET_GROUP_COUNTER,interval:5,count:20},{cmd:B.CMD.SET_ALL_MESSAGE_READ,interval:1,count:1},{cmd:B.CMD.GET_USER_STATUS,interval:5,count:20},{cmd:B.CMD.SUBSCRIBE_USER_STATUS,interval:5,count:20},{cmd:B.CMD.UNSUBSCRIBE_USER_STATUS,interval:5,count:20}],fc=function(e){s(r,e);var n=m(r);function r(e){var t;return i(this,r),(t=n.call(this,e))._n="SessionModule",t._platform=t.getPlatform(),t._protocolHandler=new lc(f(t)),t._messageDispatcher=new pc(f(t)),t._commandFrequencyLimitMap=new Map,t._commandRequestInfoMap=new Map,t._serverOverloadInfoMap=new Map,t._init(),t.getInnerEmitterInstance().on(Ma,t._onCloudConfigUpdated,f(t)),t}return o(r,[{key:"_init",value:function(){this._updateCommandFrequencyLimitMap(hc)}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("cmd_frequency_limit");ht(e)||(e=JSON.parse(e),this._updateCommandFrequencyLimitMap(e))}},{key:"_updateCommandFrequencyLimitMap",value:function(e){var t=this;e.forEach((function(e){t._commandFrequencyLimitMap.set(e.cmd,{interval:e.interval,count:e.count})}))}},{key:"updateProtocolConfig",value:function(){this._protocolHandler.update()}},{key:"request",value:function(e){He.d("".concat(this._n,".request options:"),e);var t=e.protocolName,n=e.tjgID;if(!this._protocolHandler.has(t))return He.w("".concat(this._n,".request unknown protocol:").concat(t)),va({code:No.CANNOT_FIND_PROTOCOL});var i=this.getProtocolData(e),r=i.head.servcmd;if(this._isFrequencyOverLimit(r))return va({code:No.OVER_FREQUENCY_LIMIT});if(this._isServerOverload(r))return va({code:No.OPEN_SERVICE_OVERLOAD_ERROR});tn(n)||(i.head.tjgID=n);var o=this.getModule(ni);return dc.includes(t)?o.simplySend(i):o.send(i)}},{key:"getKeyMap",value:function(e){return this._protocolHandler.getKeyMap(e)}},{key:"genCommonHead",value:function(){var e=this.getModule(Wn);return{ver:"v4",platform:this._platform,websdkappid:O,websdkversion:L,a2:e.getA2Key()||void 0,tinyid:e.getTinyID()||void 0,status_instid:e.getStatusInstanceID(),sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getA2Key()?void 0:e.getUserID(),usersig:e.getA2Key()?void 0:e.getUserSig(),sdkability:192371,tjgID:""}}},{key:"genCosSpecifiedHead",value:function(){var e=this.getModule(Wn);return{ver:"v4",platform:this._platform,websdkappid:O,websdkversion:L,sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getUserID(),usersig:e.getUserSig(),status_instid:e.getStatusInstanceID(),sdkability:192371}}},{key:"genSSOReportHead",value:function(){var e=this.getModule(Wn);return{ver:"v4",platform:this._platform,websdkappid:O,websdkversion:L,sdkappid:e.getSDKAppID(),contenttype:"",reqtime:0,identifier:"",usersig:"",status_instid:e.getStatusInstanceID(),sdkability:192371}}},{key:"getProtocolData",value:function(e){return this._protocolHandler.getProtocolData(e)}},{key:"trans",value:function(e){var n=e.servcmd,i=e.data,r={head:t(t({},this.genCommonHead()),{},{servcmd:n}),body:i};return this.getModule(ni).send(r)}},{key:"sendComboMessage",value:function(e){var n=e.servcmd,i=e.data,r={head:t(t({},this.genCommonHead()),{},{servcmd:n}),body:i};return this.getModule(ni).send(r)}},{key:"onErrorCodeNotZero",value:function(e){var t=e.errorCode;if(t===No.HELLO_ANSWER_KICKED_OUT){var n=e.kickType,i=e.newInstanceInfo,r=void 0===i?{}:i;1===n?this.onMultipleAccountKickedOut(r):2===n?this.onMultipleDeviceKickedOut(r):3===n&&this.onRestApiKickedOut(r)}t!==No.MESSAGE_A2KEY_EXPIRED&&t!==No.ACCOUNT_A2KEY_EXPIRED||(this._onUserSigExpired(),this.getModule(ni).reConnect())}},{key:"onMessage",value:function(e){var t=e.body,n=t.needAck,i=void 0===n?0:n,r=t.sessionData;1===i&&this._sendACK(r),this._messageDispatcher.onMessage(e)}},{key:"onReconnected",value:function(){this._reLoginOnReconnected()}},{key:"reLoginOnKickOther",value:function(){He.l("".concat(this._n,".reLoginOnKickOther")),this._reLogin()}},{key:"_reLoginOnReconnected",value:function(){He.l("".concat(this._n,"._reLoginOnReconnected")),this._reLogin()}},{key:"_reLogin",value:function(){var e=this;if(this.isLoggedIn()){var t=0,n=this.getModule(ui);n.canIUseOfflinePush()&&(t=n.getUniAppPlatform()),this.request({protocolName:gi,requestData:{isWebUniapp:t}}).then((function(t){var n=t.data.instanceID;e.getModule(Wn).setStatusInstanceID(n),He.l("".concat(e._n,"._reLogin ok.")),e.getModule(zn).syncConversationList().then((function(){He.l("".concat(e._n,"._reLogin, sync conversation list ok.")),e.getModule(ai).start()})),e.getModule(Bn).updateLocalMainSequenceOnReconnected();var i=e.getModule(Kn);i.resetGetTopicTime(),i.getTopicListOnReconnected()}))}}},{key:"onMultipleAccountKickedOut",value:function(e){this.getModule(xn).onMultipleAccountKickedOut(e)}},{key:"onMultipleDeviceKickedOut",value:function(e){this.getModule(xn).onMultipleDeviceKickedOut(e)}},{key:"_onUserSigExpired",value:function(){this.getModule(xn).onUserSigExpired()}},{key:"onRestApiKickedOut",value:function(e){this.getModule(xn).onRestApiKickedOut(e)}},{key:"_sendACK",value:function(e){this.request({protocolName:po,requestData:{sessionData:e}})}},{key:"_isFrequencyOverLimit",value:function(e){var t=e.split(".")[1];if(!this._commandFrequencyLimitMap.has(t))return!1;if(!this._commandRequestInfoMap.has(t))return this._commandRequestInfoMap.set(t,{startTime:Date.now(),requestCount:1}),!1;var n=this._commandFrequencyLimitMap.get(t),i=n.count,r=n.interval,o=this._commandRequestInfoMap.get(t),a=o.startTime,s=o.requestCount;if(Date.now()-a>1e3*r)return this._commandRequestInfoMap.set(t,{startTime:Date.now(),requestCount:1}),!1;s+=1,this._commandRequestInfoMap.set(t,{startTime:a,requestCount:s});var c=!1;return s>i&&(c=!0),c}},{key:"_isServerOverload",value:function(e){if(!this._serverOverloadInfoMap.has(e))return!1;var t=this._serverOverloadInfoMap.get(e),n=t.overloadTime,i=t.waitingTime,r=!1;return Date.now()-n<=1e3*i?r=!0:(this._serverOverloadInfoMap.delete(e),r=!1),r}},{key:"onPushedServerOverload",value:function(e){var t=e.overloadCommand,n=e.waitingTime;this._serverOverloadInfoMap.set(t,{overloadTime:Date.now(),waitingTime:n}),He.w("".concat(this._n,".onPushedServerOverload waitingTime:").concat(n,"s"))}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._updateCommandFrequencyLimitMap(hc),this._commandRequestInfoMap.clear(),this._serverOverloadInfoMap.clear()}}]),r}(fi),gc=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="MessageLossDetectionModule",r._maybeLostSequencesMap=new Map,r._firstRoundRet=[],r}return o(n,[{key:"onMessageMaybeLost",value:function(e,t,n){this._maybeLostSequencesMap.has(e)||this._maybeLostSequencesMap.set(e,[]);for(var i=this._maybeLostSequencesMap.get(e),r=0;r<n;r++)-1===i.indexOf(t+r)&&i.push(t+r)}},{key:"detectFirstRound",value:function(e,t){var n=this._maybeLostSequencesMap.get(e);if(!tn(n)&&!tn(t)){var i=n.filter((function(e){return-1===t.indexOf(e)}));0===i.length?He.i("".concat(this._n,".detectFirstRound no message loss. conversationID:").concat(e)):this._firstRoundRet=this._firstRoundRet.concat(i),n.length=0}}},{key:"detectSecondRound",value:function(e,t){if(!tn(this._firstRoundRet)&&!tn(t)){var n=this._firstRoundRet.filter((function(e){return-1===t.indexOf(e)}));this._firstRoundRet.length=0;var i,r=n.length;0!==r&&(r<=5?i=e+"-"+n.join("-"):(n.sort((function(e,t){return e-t})),i=e+" start:"+n[0]+" end:"+n[r-1]+" count:"+r),new $o("messageLoss").setMessage(i).setNetworkType(this.getNetworkType()).setLevel("warning").end(),He.i("".concat(this._n,".detectSecondRound message loss detected. conversationID:").concat(e," lostSequences:").concat(n)))}}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._maybeLostSequencesMap.clear(),this._firstRoundRet.length=0}}]),n}(fi),mc=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="CloudControlModule",r._cloudConfig=new Map,r._expiredTime=0,r._version=0,r._isFetching=!1,r}return o(n,[{key:"getCloudConfig",value:function(e){return ht(e)?this._cloudConfig:this._cloudConfig.has(e)?this._cloudConfig.get(e):void 0}},{key:"_canFetchConfig",value:function(){return this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime}},{key:"fetchConfig",value:function(){var e=this,t=this._canFetchConfig();if(He.l("".concat(this._n,".fetchConfig canFetchConfig:").concat(t)),t){var n=new $o("fetchCloudControlConfig"),i=this.getModule(Wn).getSDKAppID();this._isFetching=!0,this.request({protocolName:mo,requestData:{SDKAppID:i,version:this._version}}).then((function(t){e._isFetching=!1,n.setMessage("version:".concat(e._version," newVersion:").concat(t.data.version," config:").concat(t.data.cloudControlConfig)).setNetworkType(e.getNetworkType()).end(),He.l("".concat(e._n,".fetchConfig ok")),e._parseCloudControlConfig(t.data)})).catch((function(t){e._isFetching=!1,e.probeNetwork().then((function(e){var i=v(e,2),r=i[0],o=i[1];n.setError(t,r,o).end()})),He.l("".concat(e._n,".fetchConfig failed. error:"),t),e._setExpiredTimeOnResponseError(12e4)}))}}},{key:"onPushedCloudControlConfig",value:function(e){He.l("".concat(this._n,".onPushedCloudControlConfig")),new $o("pushedCloudControlConfig").setNetworkType(this.getNetworkType()).setMessage("newVersion:".concat(e.version," config:").concat(e.cloudControlConfig)).end(),this._parseCloudControlConfig(e)}},{key:"onCheckTimer",value:function(e){this._canFetchConfig()&&this.fetchConfig()}},{key:"_parseCloudControlConfig",value:function(e){var t=this,n="".concat(this._n,"._parseCloudControlConfig"),i=e.errorCode,r=e.errorMessage,o=e.cloudControlConfig,a=e.version,s=e.expiredTime;if(0===i){if(this._version!==a){var c=null;try{c=JSON.parse(o)}catch(u){this.isPrivateNetWork()||He.e("".concat(n," JSON parse error. cloudControlConfig:"),o)}c&&(this._cloudConfig.clear(),Object.keys(c).forEach((function(e){t._cloudConfig.set(e,c[e])})),this._version=a,this.emitInnerEvent(Ma))}this._expiredTime=Date.now()+1e3*s}else ht(i)?(He.l("".concat(n," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(He.e("".concat(n," errorCode:").concat(i," errorMessage:").concat(r)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._cloudConfig.clear(),this._expiredTime=0,this._version=0,this._isFetching=!1}}]),n}(fi),vc=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="RecoverMessageModule",r.PULL_LIMIT_COUNT=15,r}return o(n,[{key:"start",value:function(){this._recoverGroupChat(),this._recoverC2CChat()}},{key:"_recoverGroupChat",value:function(){var e,t,n=this,i=this._getLocalConversationList().filter((function(e){return e.type===b.CONV_GROUP&&e.groupProfile.type!==b.GRP_AVCHATROOM})),r=this.getModule(zn),o=0,a=0,s=0;i.forEach((function(i){var c=i.conversationID,u=i.lastMessage;t=c.replace(b.CONV_GROUP,""),e=r.getLocalLastMessage(c),u&&0!==u.lastSequence&&e?(a=u.lastSequence,o=e.sequence,s=a-o,o>0&&s>=1&&s<300?n._recoverGroupMessage({groupID:t,localLastMessageSequence:o,remoteLastMessageSequence:a}):n._getGroupNotify(t)):n._getGroupNotify(t)}))}},{key:"_recoverC2CChat",value:function(){var e,t=this,n=this._getLocalConversationList().filter((function(e){return e.type===b.CONV_C2C})),i=this.getModule(zn),r=0,o=0,a=0,s=[Promise.resolve()];n.forEach((function(n){var c=n.conversationID,u=n.lastMessage;e=i.getLocalLastMessage(c),u&&0!==u.lastTime&&e&&(o=u.lastTime,r=e.time,a=o-r,r>0&&a>=1&&a<=600&&s.push(t._recoverC2CMessage({conversationID:c,localLastMessageTime:r,remoteLastMessageTime:o})))})),Promise.all(s).then((function(){He.l("".concat(t._n,"._recoverC2CChat all promise fulfilled, start to sync unread messages")),t.getModule(ei).startSyncOnReconnected()}))}},{key:"_getLocalConversationList",value:function(){return this.getModule(zn).getLocalConversationList()}},{key:"_recoverGroupMessage",value:function(e){var t=this,n="".concat(this._n,"._recoverGroupMessage");He.l("".concat(n," options:"),e);var i=e.groupID,r=e.localLastMessageSequence,o=e.remoteLastMessageSequence;this._getGroupRomaingMessage({groupID:i,sequence:r}).then((function(e){var r=e.data,a=r.complete,s=r.messageList;if(!ht(s)){var c=s[0].sequence;He.l("".concat(n," pkgLastMessageSequence:").concat(c," complete:").concat(a)),c<o&&2!==a&&t._recoverGroupMessage({groupID:i,localLastMessageSequence:c,remoteLastMessageSequence:o}),new $o("recoverMessage").setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(i," complete:").concat(a," messageList length:").concat(s.length)).end(),t.getModule(Bn).onNewGroupMessage({dataList:s,isInstantMessage:!1,updateUnreadCount:!1}),t._getGroupNotify(i)}}))}},{key:"_getGroupNotify",value:function(e){this.getModule(Bn).getGroupNotify(e)}},{key:"_getGroupRomaingMessage",value:function(e){var t=e.groupID,n=e.sequence;return this.request({protocolName:Dr,requestData:{groupID:t,count:this.PULL_LIMIT_COUNT,sequence:n+this.PULL_LIMIT_COUNT-1}})}},{key:"_recoverC2CMessage",value:function(e){var t=this,n="".concat(this._n,"._recoverC2CMessage");He.l("".concat(this._n,"._recoverC2CMessage options:"),e);var i=e.conversationID,r=e.localLastMessageTime,o=e.remoteLastMessageTime;return this._getC2CRoamingMessage({conversationID:i,time:r}).then((function(e){var r=e.data,a=r.complete,s=r.messageList;if(!ht(s)){var c=s.length;new $o("recoverMessage").setNetworkType(t.getNetworkType()).setMessage("".concat(i," complete:").concat(a," messageList length:").concat(c)).end(),t.getModule(qn).onNewC2CMessage({dataList:s,isInstantMessage:!0});var u=s[c-1].time;if(He.l("".concat(n," pkgLastMessageTime:").concat(u," complete:").concat(a)),u<o&&1!==a)return t._recoverC2CMessage({conversationID:i,localLastMessageTime:u,remoteLastMessageTime:o})}}))}},{key:"_getC2CRoamingMessage",value:function(e){var t=e.conversationID,n=e.time;return this.request({protocolName:zi,requestData:{peerAccount:t.replace(b.CONV_C2C,""),count:this.PULL_LIMIT_COUNT+1,lastMessageTime:n,direction:1}})}},{key:"reset",value:function(){He.l("".concat(this._n,".reset"))}}]),n}(fi),_c=function(){function e(){i(this,e),this._n="AvgE2EDelay",this._e2eDelayArray=[]}return o(e,[{key:"addMessageDelay",value:function(e){var t=Fe()-e;t>=0&&this._e2eDelayArray.push(t)}},{key:"_calcAvg",value:function(e,t){if(0===t)return 0;var n=0;return e.forEach((function(e){n+=e})),jt(n/t,1)}},{key:"_calcCountWithLimit",value:function(e){var t=e.e2eDelayArray,n=e.min,i=e.max;return t.filter((function(e){return n<=e&&e<i})).length}},{key:"_calcPercent",value:function(e,t){var n=jt(e/t*100,2);return n>100&&(n=100),n}},{key:"_checkE2EDelayException",value:function(e,t){var n=e.filter((function(e){return e>t}));if(n.length>0){var i=n.length,r=Math.min.apply(Math,_(n)),o=Math.max.apply(Math,_(n)),a=this._calcAvg(n,i),s=jt(i/e.length*100,2);s>50&&new $o("messageE2EDelayException").setMessage("count:".concat(i," min:").concat(r," max:").concat(o," avg:").concat(a," percent:").concat(s)).setLevel("warning").end()}}},{key:"getStatResult",value:function(){var e=this._e2eDelayArray.length;if(0===e)return null;var t=_(this._e2eDelayArray),n=this._calcCountWithLimit({e2eDelayArray:t,min:0,max:1}),i=this._calcCountWithLimit({e2eDelayArray:t,min:1,max:3}),r=this._calcPercent(n,e),o=this._calcPercent(i,e),a=this._calcAvg(t,e);return this._checkE2EDelayException(t,3),t.length=0,this.reset(),{totalCount:e,countLessThan1Second:n,percentOfCountLessThan1Second:r,countLessThan3Second:i,percentOfCountLessThan3Second:o,avgDelay:a}}},{key:"reset",value:function(){this._e2eDelayArray.length=0}}]),e}(),yc=function(){function e(){i(this,e),this._n="AvgRTT",this._requestCount=0,this._rttArray=[]}return o(e,[{key:"addRequestCount",value:function(){this._requestCount+=1}},{key:"addRTT",value:function(e){this._rttArray.push(e)}},{key:"_calcTotalCount",value:function(){return this._requestCount}},{key:"_calcRTTCount",value:function(e){return e.length}},{key:"_calcSuccessRateOfRequest",value:function(e,t){if(0===t)return 0;var n=jt(e/t*100,2);return n>100&&(n=100),n}},{key:"_calcAvg",value:function(e,t){if(0===t)return 0;var n=0;return e.forEach((function(e){n+=e})),parseInt(n/t)}},{key:"_calcMax",value:function(){return Math.max.apply(Math,_(this._rttArray))}},{key:"_calcMin",value:function(){return Math.min.apply(Math,_(this._rttArray))}},{key:"getStatResult",value:function(){var e=this._calcTotalCount(),t=_(this._rttArray);if(0===e)return null;var n=this._calcRTTCount(t),i=this._calcSuccessRateOfRequest(n,e),r=this._calcAvg(t,n);return He.l("".concat(this._n,".getStatResult max:").concat(this._calcMax()," min:").concat(this._calcMin()," avg:").concat(r)),this.reset(),{totalCount:e,rttCount:n,successRateOfRequest:i,avgRTT:r}}},{key:"reset",value:function(){this._requestCount=0,this._rttArray.length=0}}]),e}(),Ic=function(){function e(){i(this,e),this._map=new Map}return o(e,[{key:"initMap",value:function(e){var t=this;e.forEach((function(e){t._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}))}},{key:"addTotalCount",value:function(e){return!(ht(e)||!this._map.has(e)||(this._map.get(e).totalCount+=1,0))}},{key:"addSuccessCount",value:function(e){return!(ht(e)||!this._map.has(e)||(this._map.get(e).successCount+=1,0))}},{key:"addFailedCountOfUserSide",value:function(e){return!(ht(e)||!this._map.has(e)||(this._map.get(e).failedCountOfUserSide+=1,0))}},{key:"addCost",value:function(e,t){return!(ht(e)||!this._map.has(e)||(this._map.get(e).costArray.push(t),0))}},{key:"addFileSize",value:function(e,t){return!(ht(e)||!this._map.has(e)||(this._map.get(e).fileSizeArray.push(t),0))}},{key:"_calcSuccessRateOfBusiness",value:function(e){if(ht(e)||!this._map.has(e))return-1;var t=this._map.get(e),n=jt(t.successCount/t.totalCount*100,2);return n>100&&(n=100),n}},{key:"_calcSuccessRateOfPlatform",value:function(e){if(ht(e)||!this._map.has(e))return-1;var t=this._map.get(e),n=this._calcSuccessCountOfPlatform(e)/t.totalCount*100;return(n=jt(n,2))>100&&(n=100),n}},{key:"_calcTotalCount",value:function(e){return ht(e)||!this._map.has(e)?-1:this._map.get(e).totalCount}},{key:"_calcSuccessCountOfBusiness",value:function(e){return ht(e)||!this._map.has(e)?-1:this._map.get(e).successCount}},{key:"_calcSuccessCountOfPlatform",value:function(e){if(ht(e)||!this._map.has(e))return-1;var t=this._map.get(e);return t.successCount+t.failedCountOfUserSide}},{key:"_calcAvg",value:function(e){return ht(e)||!this._map.has(e)?-1:e===qo?this._calcAvgSpeed(e):this._calcAvgCost(e)}},{key:"_calcAvgCost",value:function(e){var t=this._map.get(e).costArray.length;if(0===t)return 0;var n=0;return this._map.get(e).costArray.forEach((function(e){n+=e})),parseInt(n/t)}},{key:"_calcAvgSpeed",value:function(e){var t=0,n=0;return this._map.get(e).costArray.forEach((function(e){t+=e})),this._map.get(e).fileSizeArray.forEach((function(e){n+=e})),parseInt(1e3*n/t)}},{key:"getStatResult",value:function(e){var t=this._calcTotalCount(e);if(0===t)return null;var n=this._calcSuccessCountOfBusiness(e),i=this._calcSuccessRateOfBusiness(e),r=this._calcSuccessCountOfPlatform(e),o=this._calcSuccessRateOfPlatform(e),a=this._calcAvg(e);return this.reset(e),{totalCount:t,successCountOfBusiness:n,successRateOfBusiness:i,successCountOfPlatform:r,successRateOfPlatform:o,avgValue:a}}},{key:"reset",value:function(e){ht(e)?this._map.clear():this._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}}]),e}(),Mc=function(){function e(){i(this,e),this._lastMap=new Map,this._currentMap=new Map}return o(e,[{key:"initMap",value:function(e){var t=this;e.forEach((function(e){t._lastMap.set(e,new Map),t._currentMap.set(e,new Map)}))}},{key:"addMessageSequence",value:function(e){var t=e.key,n=e.message;if(ht(t)||!this._lastMap.has(t)||!this._currentMap.has(t))return!1;var i=n.conversationID,r=n.sequence,o=i.replace(b.CONV_GROUP,"");if(0===this._lastMap.get(t).size)this._addCurrentMap(e);else if(this._lastMap.get(t).has(o)){var a=this._lastMap.get(t).get(o),s=a.length-1;r>a[0]&&r<a[s]?(a.push(r),a.sort(),this._lastMap.get(t).set(o,a)):this._addCurrentMap(e)}else this._addCurrentMap(e);return!0}},{key:"_addCurrentMap",value:function(e){var t=e.key,n=e.message,i=n.conversationID,r=n.sequence,o=i.replace(b.CONV_GROUP,"");this._currentMap.get(t).has(o)||this._currentMap.get(t).set(o,[]),this._currentMap.get(t).get(o).push(r)}},{key:"_copyData",value:function(e){if(!ht(e)){this._lastMap.set(e,new Map);var t,n=this._lastMap.get(e),i=E(this._currentMap.get(e));try{for(i.s();!(t=i.n()).done;){var r=v(t.value,2),o=r[0],a=r[1];n.set(o,a)}}catch(s){i.e(s)}finally{i.f()}n=null,this._currentMap.set(e,new Map)}}},{key:"getStatResult",value:function(e){if(ht(this._currentMap.get(e))||ht(this._lastMap.get(e)))return null;if(0===this._lastMap.get(e).size)return this._copyData(e),null;var t=0,n=0;if(this._lastMap.get(e).forEach((function(e,i){var r=_(e.values()),o=r.length,a=r[o-1]-r[0]+1;t+=a,n+=o})),0===t)return null;var i=jt(n/t*100,2);return i>100&&(i=100),this._copyData(e),{totalCount:t,successCountOfMessageReceived:n,successRateOfMessageReceived:i}}},{key:"reset",value:function(){this._currentMap.clear(),this._lastMap.clear()}}]),e}(),Tc=function(e){s(r,e);var n=m(r);function r(e){var t;i(this,r),(t=n.call(this,e))._n="QualityStatModule",t.TAG="im-ssolog-quality-stat",t.reportIndex=0,t.wholePeriod=!1,t._qualityItems=[Po,Uo,xo,Go,Fo,Vo,qo,Bo,Ho,jo],t._messageSentItems=[xo,Go,Fo,Vo,qo],t._messageReceivedItems=[Bo,Ho,jo],t.REPORT_INTERVAL=120,t.REPORT_SDKAPPID_BLACKLIST=[],t.REPORT_TINYID_WHITELIST=[],t._statInfoArr=[],t._avgRTT=new yc,t._avgE2EDelay=new _c,t._rateMessageSent=new Ic,t._rateMessageReceived=new Mc;var o=t.getInnerEmitterInstance();return o.on(Ia,t._onLoginSuccess,f(t)),o.on(Ma,t._onCloudConfigUpdated,f(t)),t}return o(r,[{key:"_onLoginSuccess",value:function(){var e=this;this._rateMessageSent.initMap(this._messageSentItems),this._rateMessageReceived.initMap(this._messageReceivedItems);var t=this.getModule(Yn),n=t.getItem(this.TAG,!1);!tn(n)&&gt(n.forEach)&&(He.l("".concat(this._n,"._onLoginSuccess get quality stat logs from local storage, count:").concat(n.length)),n.forEach((function(t){e._statInfoArr.push(t)})),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("q_rpt_interval"),t=this.getCloudConfig("q_rpt_sdkappid_bl"),n=this.getCloudConfig("q_rpt_tinyid_wl");ht(e)||(this.REPORT_INTERVAL=Number(e)),ht(t)||(this.REPORT_SDKAPPID_BLACKLIST=t.split(",").map((function(e){return Number(e)}))),ht(n)||(this.REPORT_TINYID_WHITELIST=n.split(","))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this.REPORT_INTERVAL==0&&(this.wholePeriod=!0,this._report())}},{key:"addRequestCount",value:function(){this._avgRTT.addRequestCount()}},{key:"addRTT",value:function(e){this._avgRTT.addRTT(e)}},{key:"addMessageDelay",value:function(e){this._avgE2EDelay.addMessageDelay(e)}},{key:"addTotalCount",value:function(e){this._rateMessageSent.addTotalCount(e)||He.w("".concat(this._n,".addTotalCount invalid key:"),e)}},{key:"addSuccessCount",value:function(e){this._rateMessageSent.addSuccessCount(e)||He.w("".concat(this._n,".addSuccessCount invalid key:"),e)}},{key:"addFailedCountOfUserSide",value:function(e){this._rateMessageSent.addFailedCountOfUserSide(e)||He.w("".concat(this._n,".addFailedCountOfUserSide invalid key:"),e)}},{key:"addCost",value:function(e,t){this._rateMessageSent.addCost(e,t)||He.w("".concat(this._n,".addCost invalid key or cost:"),e,t)}},{key:"addFileSize",value:function(e,t){this._rateMessageSent.addFileSize(e,t)||He.w("".concat(this._n,".addFileSize invalid key or size:"),e,t)}},{key:"addMessageSequence",value:function(e){this._rateMessageReceived.addMessageSequence(e)||He.w("".concat(this._n,".addMessageSequence invalid key:"),e.key)}},{key:"_getQualityItem",value:function(e){var n={},i=Wo[this.getNetworkType()];ht(i)&&(i=8);var r={qualityType:Ko[e],timestamp:xe(),networkType:i,extension:""};switch(e){case Po:n=this._avgRTT.getStatResult();break;case Uo:n=this._avgE2EDelay.getStatResult();break;case xo:case Go:case Fo:case Vo:case qo:n=this._rateMessageSent.getStatResult(e);break;case Bo:case Ho:case jo:n=this._rateMessageReceived.getStatResult(e)}return null===n?null:t(t({},r),n)}},{key:"_report",value:function(e){var t=this,n=[],i=null;ht(e)?this._qualityItems.forEach((function(e){null!==(i=t._getQualityItem(e))&&(i.reportIndex=t.reportIndex,i.wholePeriod=t.wholePeriod,n.push(i))})):null!==(i=this._getQualityItem(e))&&(i.reportIndex=this.reportIndex,i.wholePeriod=this.wholePeriod,n.push(i)),He.d("".concat(this._n,"._report"),n),this._statInfoArr.length>0&&(n=n.concat(this._statInfoArr),this._statInfoArr=[]);var r=this.getModule(Wn),o=r.getSDKAppID(),a=r.getTinyID();Kt(this.REPORT_SDKAPPID_BLACKLIST,o)&&!zt(this.REPORT_TINYID_WHITELIST,a)&&(n=[]),n.length>0&&this._doReport(n)}},{key:"_doReport",value:function(e){var n=this,i={header:Cs(this),quality:e};this.request({protocolName:so,requestData:t({},i)}).then((function(){n.reportIndex++,n.wholePeriod=!1})).catch((function(t){He.w("".concat(n._n,"._doReport, online:").concat(n.getNetworkType()," error:"),t),n._statInfoArr=n._statInfoArr.concat(e),n._flushAtOnce()}))}},{key:"_flushAtOnce",value:function(){var e=this.getModule(Yn),t=e.getItem(this.TAG,!1),n=this._statInfoArr,i="".concat(this._n,"._flushAtOnce");if(tn(t))He.l("".concat(i," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1);else{var r=n.concat(t);r.length>10&&(r=r.slice(0,10)),He.l("".concat(i," count:").concat(r.length)),e.setItem(this.TAG,r,!0,!1)}this._statInfoArr=[]}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._report(),this.reportIndex=0,this.wholePeriod=!1,this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[],this._avgRTT.reset(),this._avgE2EDelay.reset(),this._rateMessageSent.reset(),this._rateMessageReceived.reset()}}]),r}(fi),Cc=o((function e(t){i(this,e),tn(t)||(this.userID=t.userID||"",this.nick=t.nick||"",this.avatar=t.avatar||"",this.time=t.time||0,this.source=t.source||"",this.wording=t.wording||"",this.type=t.type||"")})),Sc=function(){function e(t){i(this,e),this._snsModule=t,this._n="FriendApplicationHandler",this._startTime=0,this._maxLimited=100,this._currentSequence=0,this._friendApplicationMap=new Map,this._unreadCount=0}return o(e,[{key:"getLocalFriendApplicationList",value:function(){return{friendApplicationList:_(this._friendApplicationMap.values()),unreadCount:this._unreadCount}}},{key:"_onFriendApplicationListUpdated",value:function(){this._snsModule.emitOuterEvent(k.FRIEND_APPLICATION_LIST_UPDATED,{friendApplicationList:_(this._friendApplicationMap.values()),unreadCount:this._unreadCount})}},{key:"onFriendApplicationRead",value:function(){this._unreadCount=0,this._onFriendApplicationListUpdated()}},{key:"onFriendApplicationAdded",value:function(e,n){var i=this;if(!tn(e)){var r="";r=n===this._snsModule.getMyUserID()?b.SNS_APPLICATION_SENT_BY_ME:b.SNS_APPLICATION_SENT_TO_ME;var o=!1;e.forEach((function(e){var n="".concat(e.userID,"_").concat(r);r!==b.SNS_APPLICATION_SENT_TO_ME||i._friendApplicationMap.has(n)||(i._unreadCount+=1),i._friendApplicationMap.set(n,new Cc(t(t({},e),{},{type:r}))),o=!0})),o&&this._onFriendApplicationListUpdated()}}},{key:"onFriendApplicationDeleted",value:function(e){tn(e)||this.getFriendApplicationList()}},{key:"getFriendApplicationList",value:function(){var e=this,t="".concat(this._n,".").concat("getFriendApplicationList"),n=new $o("getFriendApplicationList");return this._snsModule.request({protocolName:Pi,requestData:{applicationType:b.SNS_APPLICATION_TYPE_BOTH,fromAccount:this._snsModule.getMyUserID(),maxLimited:this._maxLimited,startTime:this._startTime,lastSequence:this._currentSequence}}).then((function(i){var r=i.data,o=r.resultList,a=r.unreadCount,s=r.startTime,c=r.currentSequence;e._startTime=s,e._currentSequence=c,e._unreadCount=a;var u=pt(o)?o.length:0;n.setNetworkType(e._snsModule.getNetworkType()).setMessage("applicationCount:".concat(u," unreadCount:").concat(a)).end(),He.i("".concat(t," ok. applicationCount:").concat(u," unreadCount:").concat(a)),e._friendApplicationMap.clear(),pt(o)&&o.forEach((function(t){var n=t.userID,i=t.type,r=new Cc(t);e._friendApplicationMap.set("".concat(n,"_").concat(i),r)})),e._onFriendApplicationListUpdated()})).catch((function(i){return e._snsModule.probeNetwork().then((function(e){var t=v(e,2),r=t[0],o=t[1];n.setError(i,r,o).end()})),He.w("".concat(t," failed. error:"),i),va(i)}))}},{key:"deleteFriendApplication",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteFriendApplication"),i=e.userID,r=e.type;if((!r||r!==b.SNS_APPLICATION_SENT_BY_ME&&r!==b.SNS_APPLICATION_SENT_TO_ME)&&(r=b.SNS_APPLICATION_SENT_TO_ME),!this._friendApplicationMap.has("".concat(i,"_").concat(r)))return va({code:No.FRIEND_APPLICATION_NOT_EXIST});var o=new $o("deleteFriendApplication");return o.setMessage("userID:".concat(i," type:").concat(r)),this._snsModule.request({protocolName:Ui,requestData:{fromAccount:this._snsModule.getMyUserID(),userIDList:[i],type:r}}).then((function(e){var a=e.data.resultList,s=a[0],c=s.to,u=s.resultCode,l=s.resultInfo;return o.setNetworkType(t._snsModule.getNetworkType()).setMoreMessage("resultList:".concat(JSON.stringify(a))).end(),He.i("".concat(n," ok. userID:").concat(i," type:").concat(r)),0===u?pa():va({userID:c,code:u,message:l})})).catch((function(e){return t._snsModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"acceptFriendApplication",value:function(e){var t=this,n="".concat(this._n,".").concat("acceptFriendApplication"),i=e.userID,r=e.remark,o=e.tag,a=e.type;(!a||a!==b.SNS_APPLICATION_AGREE&&a!==b.SNS_APPLICATION_AGREE_AND_ADD)&&(a=b.SNS_APPLICATION_AGREE_AND_ADD);var s=new $o("acceptFriendApplication");return s.setMessage("userID:".concat(i," type:").concat(a)),this._snsModule.request({protocolName:Ni,requestData:{fromAccount:this._snsModule.getMyUserID(),responseFriendItem:[{userID:i,remark:r,tag:o,action:a}]}}).then((function(e){s.setNetworkType(t._snsModule.getNetworkType()).end();var r=e.data.resultList[0],o=r.resultCode,c=r.resultInfo;if(0!==o)return va({code:o,message:c});He.i("".concat(n," ok. userID:").concat(i," type:").concat(a))})).catch((function(e){return t._snsModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];s.setError(e,i,r).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"refuseFriendApplication",value:function(e){var t=this,n="".concat(this._n,".").concat("refuseFriendApplication"),i=e.userID,r=new $o("refuseFriendApplication");return r.setMessage("userID:".concat(i)),this._snsModule.request({protocolName:Ni,requestData:{fromAccount:this._snsModule.getMyUserID(),responseFriendItem:[{userID:i,action:"Response_Action_Reject"}]}}).then((function(e){r.setNetworkType(t._snsModule.getNetworkType()).end();var o=e.data.resultList[0],a=o.resultCode,s=o.resultInfo;if(0!==a)return va({code:a,message:s});He.i("".concat(n," ok. userID:").concat(i))})).catch((function(e){return t._snsModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"_onFriendApplicationProcessed",value:function(e){var t=this;if(0!==e.length){var n=!1;e.forEach((function(e){var i="".concat(e.to,"_").concat(b.SNS_APPLICATION_SENT_TO_ME);t._friendApplicationMap.has(i)&&(t._friendApplicationMap.delete(i),t._unreadCount-=1,n=!0)})),this._unreadCount<0&&(this._unreadCount=0),n&&this._onFriendApplicationListUpdated()}}},{key:"setFriendApplicationRead",value:function(){var e=this,t="".concat(this._n,".").concat("setFriendApplicationRead"),n=new $o("setFriendApplicationRead");return this._snsModule.request({protocolName:xi,requestData:{fromAccount:this._snsModule.getMyUserID(),latestTimeStamp:jt(xe()/1e3,0)}}).then((function(i){n.setNetworkType(e._snsModule.getNetworkType()).end(),He.i("".concat(t," ok")),e._unreadCount=0})).catch((function(i){return e._snsModule.probeNetwork().then((function(e){var t=v(e,2),r=t[0],o=t[1];n.setError(i,r,o).end()})),He.w("".concat(t," failed. error:"),i),va(i)}))}},{key:"reset",value:function(){this._startIndex=0,this._maxLimited=100,this._currentSequence=0,this._unreadCount=0,this._friendApplicationMap.clear()}}]),e}(),Ec=function(){function e(n,r){i(this,e),this.userID=n,this.remark="",this.groupList=[],this.source="",this.addTime=0,this.friendCustomField=[],this.timestamp=0;var o={},a=[];if(o.userID=n,!tn(r))for(var s="",c="",u=0,l=r.length;u<l;u++)if(s=r[u].tag,c=r[u].value,s.indexOf("Tag_SNS_Custom")>-1)this.friendCustomField.push({key:s,value:c});else if(s.indexOf("Tag_Profile_Custom")>-1)a.push({key:s,value:c});else switch(s){case Ke.NICK:o.nick=c;break;case Ke.GENDER:o.gender=c;break;case Ke.BIRTHDAY:o.birthday=c;break;case Ke.LOCATION:o.location=c;break;case Ke.SELFSIGNATURE:o.selfSignature=c;break;case Ke.ALLOWTYPE:o.allowType=c;break;case Ke.LANGUAGE:o.language=c;break;case Ke.AVATAR:o.avatar=c;break;case Ke.MESSAGESETTINGS:o.messageSettings=c;break;case Ke.ADMINFORBIDTYPE:o.adminForbidType=c;break;case Ke.LEVEL:o.level=c;break;case Ke.ROLE:o.role=c;break;case We:this.remark=c;break;case Je:this.addTime=c;break;case ze:this.groupList=JSON.parse(JSON.stringify(c));break;case Ye:this.source=c;break;case $e:break;default:He.l("snsProfileItem unknown tag->",r[u].tag)}this.profile=new Aa(t(t({},o),{},{profileCustomField:a}))}return o(e,[{key:"validate",value:function(e){var t=!0,n="";if(tn(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var i=e.profileCustomField.length,r=null,o=0;o<i;o++){if(r=e.profileCustomField[o],!ut(r.key)||-1===r.key.indexOf("Tag_Profile_Custom"))return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!ut(r.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if("profileCustomField"===a)continue;if(tn(e[a])&&!ut(e[a])&&!ct(e[a])){n="key:"+a+", invalid value:"+e[a],t=!1;continue}switch(a){case"nick":ut(e[a])||(n="nick must be a string",t=!1),Mt(e[a])>500&&(n="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(Mt(e[a])," bytes"),t=!1);break;case"gender":Et(Xe,e.gender)||(n="key:gender, invalid value:"+e.gender,t=!1);break;case"birthday":ct(e.birthday)||(n="birthday must be a number",t=!1);break;case"location":ut(e.location)||(n="location must be a string",t=!1);break;case"selfSignature":ut(e.selfSignature)||(n="selfSignature must be a string",t=!1);break;case"allowType":Et(Qe,e.allowType)||(n="key:allowType, invalid value:"+e.allowType,t=!1);break;case"language":ct(e.language)||(n="language must be a number",t=!1);break;case"avatar":ut(e.avatar)||(n="avatar must be a string",t=!1);break;case"messageSettings":0!==e.messageSettings&&1!==e.messageSettings&&(n="messageSettings must be 0 or 1",t=!1);break;case"adminForbidType":Et(Ze,e.adminForbidType)||(n="key:adminForbidType, invalid value:"+e.adminForbidType,t=!1);break;case"level":ct(e.level)||(n="level must be a number",t=!1);break;case"role":ct(e.role)||(n="role must be a number",t=!1);break;default:n="unknown key:"+a+"  "+e[a],t=!1}}return{valid:t,tips:n}}},{key:"update",value:function(e){var t="",n="",i=[];this.friendCustomField.forEach((function(e){i.push(e.key)}));for(var r=0,o=e.length;r<o;r++)if(t=e[r].tag,n=e[r].value,t.indexOf("Tag_SNS_Custom")>-1)i.indexOf(t)>-1?this.friendCustomField.forEach((function(e){e.key===t&&(e.value=n)})):this.friendCustomField.push({key:t,value:n});else if(t.indexOf("Tag_Profile_Custom")>-1){var a=!1;this.profile.profileCustomField.forEach((function(e){e.key===t&&(e.value=n,a=!0)})),a||this.profile.profileCustomField.push({key:t,value:n})}else switch(t){case Ke.NICK:this.profile.nick=n;break;case Ke.GENDER:this.profile.gender=n;break;case Ke.BIRTHDAY:this.profile.birthday=n;break;case Ke.LOCATION:this.profile.location=n;break;case Ke.SELFSIGNATURE:this.profile.selfSignature=n;break;case Ke.ALLOWTYPE:this.profile.allowType=n;break;case Ke.LANGUAGE:this.profile.language=n;break;case Ke.AVATAR:this.profile.avatar=n;break;case Ke.MESSAGESETTINGS:this.profile.messageSettings=n;break;case Ke.ADMINFORBIDTYPE:this.profile.adminForbidType=n;break;case Ke.LEVEL:this.profile.level=n;break;case Ke.ROLE:this.profile.role=n;break;case We:this.remark=n;break;case Je:this.addTime=n;break;case ze:this.groupList=JSON.parse(JSON.stringify(n));break;case Ye:this.source=n;break;case $e:break;default:He.d("snsProfileItem unkown tag->",e[r].tag)}this.timestamp=Date.now(),i.length=0}},{key:"updateProfile",value:function(e){this.profile=JSON.parse(JSON.stringify(e)),this.timestamp=Date.now()}},{key:"addToGroupList",value:function(e){-1===this.groupList.indexOf(e)&&(this.groupList.push(e),this.count=this.groupList.length)}},{key:"removeFromGroupList",value:function(e){var t=this.groupList.indexOf(e);t>-1&&(this.groupList.splice(t,1),this.count=this.groupList.length)}}]),e}(),kc=function(){function e(t){i(this,e),this._snsModule=t,this._n="FriendHandler",this._friendMap=new Map,this._startIndex=0,this._standardSequence=0,this._customSequence=0,this._expirationTime=18e4}return o(e,[{key:"getLocalFriendList",value:function(){return _(this._friendMap.values())}},{key:"getFriendRemark",value:function(e){return this._friendMap.has(e)?this._friendMap.get(e).remark:""}},{key:"onFriendProfileModified",value:function(e){var t=this,n=e.dataList;if(!tn(n)){var i=this._snsModule.getModule(zn);n.forEach((function(e){var n=e.userID,r=e.profileList;if(t.isMyFriend(n)){He.l("".concat(t._n,".onFriendProfileModified. friend account:").concat(n,", profileList:").concat(JSON.stringify(r)));var o=t._friendMap.get(n);o.update(r),i.modifyMessageSentByPeer({conversationID:"".concat(b.CONV_C2C).concat(n),latestNick:o.profile.nick,latestAvatar:o.profile.avatar})}})),this._onFriendListUpdated()}}},{key:"onFriendAdded",value:function(e){var t=this;0!==e.length&&(He.l("".concat(this._n,".onFriendAdded userIDList:").concat(e)),e.forEach((function(e){t._friendMap.set(e,new Ec(e))})),this.getFriendProfile({userIDList:e}).then((function(n){e.forEach((function(e){var n=t._friendMap.get(e);n.groupList.length>0&&t._snsModule.updateWhenFriendAdded({nameList:n.groupList,userID:e})})),t._onFriendListUpdated()})))}},{key:"onFriendDeleted",value:function(e){var t=this;0!==e.length&&(He.l("".concat(this._n,".onFriendDeleted userIDList:").concat(e)),e.forEach((function(e){var n=t._friendMap.get(e);n.groupList.length>0&&t._snsModule.updateWhenFriendDeleted({nameList:n.groupList,userID:e}),t._friendMap.delete(e)})),this._onFriendListUpdated())}},{key:"_onFriendListUpdated",value:function(){this._snsModule.emitOuterEvent(k.FRIEND_LIST_UPDATED),this._snsModule.getModule(zn).checkAndPatchRemark()}},{key:"getFriendProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getFriendProfile"),i=e.userIDList,r=[],o=[],a=[];if(i.forEach((function(e){if(t._friendMap.has(e)){var n=t._friendMap.get(e);Date.now()-n.timestamp<t._expirationTime?o.push(n):a.push(e)}else r.push({userID:e,code:No.NOT_MY_FRIEND,message:t._snsModule.getErrorMessage(No.NOT_MY_FRIEND)})})),0===a.length)return He.i("".concat(n," newUserIDList is empty")),ma({friendList:o,failureUserIDList:r});var s=new $o("getFriendProfile");return s.setMessage("userIDList:".concat(a)),He.i("".concat(n," userIDList:").concat(a)),this._snsModule.request({protocolName:wi,requestData:{fromAccount:this._snsModule.getMyUserID(),userIDList:a}}).then((function(e){return s.setNetworkType(t._snsModule.getNetworkType()).end(),He.i("".concat(n," ok")),e.data.resultList.forEach((function(e){var n,i=e.to,a=e.resultCode,s=e.resultInfo,c=e.tagValueList;ht(a)||0===a?(t._friendMap.has(i)?(n=t._friendMap.get(i)).update(c):(n=new Ec(i,c),t._friendMap.set(i,n)),o.push(n)):r.push({userID:i,code:a,message:s})})),pa({friendList:o,failureUserIDList:r})})).catch((function(e){return t._snsModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];s.setError(e,i,r).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"isMyFriend",value:function(e){return this._friendMap.has(e)}},{key:"pagingGetFriendList",value:function(){var e=this,t="".concat(this._n,".").concat("getFriendList"),n=new $o("getFriendList"),i=Date.now();this._snsModule.request({protocolName:Di,requestData:{fromAccount:this._snsModule.getMyUserID(),startIndex:this._startIndex,standardSequence:this._standardSequence,customSequence:this._customSequence}}).then((function(r){var o=r.data,a=o.friendCount,s=o.resultList,c=o.nextStartIndex,u=o.standardSequence,l=o.customSequence,d=o.completeFlag;e._startIndex=c,e._standardSequence=u,e._customSequence=l;var p=Date.now()-i,h="friendCount:".concat(a," nextStartIndex:").concat(c," standardSequence:").concat(u," ")+"customSequence:".concat(l," completeFlag:").concat(d," cost ").concat(p," ms");n.setNetworkType(e._snsModule.getNetworkType()).setMessage(h).end(),He.i("".concat(t," ok."),h),tn(s)||s.forEach((function(t){var n=t.to,i=t.tagValueList;e._friendMap.set(n,new Ec(n,i))})),0===d?e.pagingGetFriendList():(e._snsModule.emitOuterEvent(k.FRIEND_LIST_UPDATED),e._pagingGetFriendProfile())})).catch((function(i){return e._snsModule.probeNetwork().then((function(e){var t=v(e,2),r=t[0],o=t[1];n.setError(i,r,o).end()})),He.w("".concat(t," failed. error:"),i),va(i)}))}},{key:"_pagingGetFriendProfile",value:function(){var e=this,t=_(this._friendMap.keys()),n=this._snsModule.getModule(Vn),i=t.length,r=i<=100?1:Math.ceil(i/100);He.l("".concat(this._n,"._pagingGetFriendProfile friendCount:").concat(i," pageCount:").concat(r));for(var o=0;o<r;o++)n.getUserProfile({userIDList:t.slice(100*o,100*(o+1))}).then((function(t){t.data.forEach((function(t){var n=e._friendMap.get(t.userID);n&&n.updateProfile(t)})),e._onFriendListUpdated()}))}},{key:"addFriend",value:function(e){var t=this,n="".concat(this._n,".").concat("addFriend");if(this._friendMap.has(e.to))return va({code:No.ALREADY_MY_FRIEND});if(e.wording&&!1===this._snsModule.filterProfanity("wording",e))return va({code:No.PROFANITY_FOUND});var i=e.to,r=e.source,o=e.type,a=e.wording,s=e.remark,c=e.groupName,u=o;(!u||u!==b.SNS_ADD_TYPE_SINGLE&&u!==b.SNS_ADD_TYPE_BOTH)&&(u=b.SNS_ADD_TYPE_BOTH);var l=new $o("addFriend");return l.setMessage("to:".concat(i," source:").concat(r," type:").concat(u)),this._snsModule.request({protocolName:Li,requestData:{fromAccount:this._snsModule.getMyUserID(),addFriendItem:[{to:i,source:r,wording:a,remark:s,groupName:c}],type:u}}).then((function(e){var i=e.data.resultList;l.setNetworkType(t._snsModule.getNetworkType()).setMoreMessage("resultList:".concat(JSON.stringify(i))).end();var r=i[0],o=r.to,a=r.resultCode,s=r.resultInfo;return He.i("".concat(n," ok. to:").concat(o," type:").concat(u," code:").concat(a)),ht(a)||0===a?pa({userID:o,code:0}):30539===a?pa({userID:o,code:a,message:t._snsModule.getErrorMessage(a)}):va({userID:o,code:a,message:t._snsModule.getErrorMessage(a)||s})})).catch((function(e){return t._snsModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];l.setError(e,i,r).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"deleteFriend",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteFriend"),i=e.userIDList,r=e.type;i.length>1e3&&(He.w("".concat(n," ").concat(Zt(1e3))),i.length=1e3);var o=[],a=[],s=[];if(i.forEach((function(e){t._friendMap.has(e)?s.push(e):o.push({userID:e,code:No.NOT_MY_FRIEND,message:t._snsModule.getErrorMessage(No.NOT_MY_FRIEND)})})),0===s.length)return ma({successUserIDList:a,failureUserIDList:o});var c=r;(!c||c!==b.SNS_DELETE_TYPE_SINGLE&&c!==b.SNS_DELETE_TYPE_BOTH)&&(c=b.SNS_DELETE_TYPE_BOTH);var u=new $o("deleteFriend");return u.setMessage("userIDList:".concat(s," type:").concat(c)),this._snsModule.request({protocolName:Ri,requestData:{fromAccount:this._snsModule.getMyUserID(),userIDList:s,type:c}}).then((function(e){u.setNetworkType(t._snsModule.getNetworkType()).end(),He.i("".concat(n," ok"));var i=e.data.resultList;return tn(i)||i.forEach((function(e){var t=e.to,n=e.resultCode,i=e.resultInfo;ht(n)||0===n?a.push({userID:t}):o.push({userID:t,code:n,message:i})})),pa({successUserIDList:a,failureUserIDList:o})})).catch((function(e){return t._snsModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];u.setError(e,i,r).end()})),He.w("".concat(n," error:"),e),va(e)}))}},{key:"updateFriend",value:function(e){var t=this,n=e.userID,i=e.remark,r=e.friendCustomField;if(!this._friendMap.has(n))return va({code:No.NOT_MY_FRIEND});var o="".concat(this._n,".").concat("updateFriend"),a=new $o("updateFriend");a.setMessage("userID:".concat(n," remark:").concat(i," friendCustomField:").concat(r));var s=[];return ht(i)||s.push({tag:We,value:i}),pt(r)&&r.length>0&&r.forEach((function(e){s.push({tag:e.key,value:e.value})})),this._snsModule.request({protocolName:Oi,requestData:{fromAccount:this._snsModule.getMyUserID(),updateItem:[{to:n,snsItem:s}]}}).then((function(e){a.setNetworkType(t._snsModule.getNetworkType()).end(),He.i("".concat(o," ok"));var n=e.data.resultList[0],s=n.to,c=n.resultCode,u=n.resultInfo;if(ht(c)||0===c){var l=t._friendMap.get(s);return l&&(ht(i)||(l.remark=i),pt(r)&&r.length>0&&wt(l.friendCustomField,r),t._onFriendListUpdated()),pa(l)}return va({code:c,message:u})})).catch((function(e){return t._snsModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),He.w("".concat(o," failed. error:"),e),va(e)}))}},{key:"checkFriend",value:function(e){var t=this,n="".concat(this._n,".").concat("checkFriend"),i=e.userIDList,r=e.type;(!r||r!==b.SNS_CHECK_TYPE_SINGLE&&r!==b.SNS_CHECK_TYPE_BOTH)&&(r=b.SNS_CHECK_TYPE_BOTH);var o=new $o("checkFriend");return o.setMessage("userIDList:".concat(i," type:").concat(r)),this._snsModule.request({protocolName:Ai,requestData:{fromAccount:this._snsModule.getMyUserID(),userIDList:i,type:r}}).then((function(e){o.setNetworkType(t._snsModule.getNetworkType()).end(),He.i("".concat(n," ok. userIDList:").concat(i," type:").concat(r));var a=[],s=[],c=e.data.resultList;return pt(c)&&c.forEach((function(e){var t=e.to,n=e.relation,i=e.resultCode,r=e.resultInfo;ht(i)||0===i?a.push({userID:t,code:0,relation:n}):s.push({userID:t,code:i,message:r})})),pa({successUserIDList:a,failureUserIDList:s})})).catch((function(e){return t._snsModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"updateWhenAddedToFriendGroup",value:function(e){var t=this,n=e.name,i=e.userIDList;He.l("".concat(this._n,".updateWhenAddedToFriendGroup groupName:").concat(n," userIDList:").concat(i)),n&&!tn(i)&&i.forEach((function(e){t._friendMap.has(e)&&t._friendMap.get(e).addToGroupList(n)}))}},{key:"updateWhenRemovedFromFriendGroup",value:function(e){var t=this,n=e.name,i=e.userIDList;He.l("".concat(this._n,".updateWhenRemovedFromFriendGroup groupName:").concat(n," userIDList:").concat(i)),n&&!tn(i)&&i.forEach((function(e){t._friendMap.has(e)&&t._friendMap.get(e).removeFromGroupList(n)}))}},{key:"reset",value:function(){this._friendMap.clear(),this._startIndex=0,this._standardSequence=0,this._customSequence=0}}]),e}(),bc=function(){function e(t){i(this,e),tn(t)||(this.name=t.name||"",this.userIDList=t.userIDList||[],this.count=this.userIDList.length||0)}return o(e,[{key:"addToUserIDList",value:function(e){-1===this.userIDList.indexOf(e)&&(this.userIDList.push(e),this.count=this.userIDList.length)}},{key:"removeFromUserIDList",value:function(e){var t=this.userIDList.indexOf(e);t>-1&&(this.userIDList.splice(t,1),this.count=this.userIDList.length)}}]),e}(),Dc=function(){function e(t){i(this,e),this._snsModule=t,this._n="FriendGroupHandler",this._friendGroupMap=new Map}return o(e,[{key:"getLocalFriendGroupList",value:function(){return _(this._friendGroupMap.values())}},{key:"_emitFriendGroupListUpdated",value:function(){var e=_(this._friendGroupMap.values());this._snsModule.emitOuterEvent(k.FRIEND_GROUP_LIST_UPDATED,e)}},{key:"getFriendGroupList",value:function(){var e=this,t="".concat(this._n,".").concat("getFriendGroupList"),n=new $o("getFriendGroupList");return this._snsModule.request({protocolName:Gi,requestData:{fromAccount:this._snsModule.getMyUserID()}}).then((function(i){n.setNetworkType(e._snsModule.getNetworkType()).end();var r=i.data.resultList;tn(r)?He.i("".concat(t," ok. friend group count:0")):(He.i("".concat(t," ok. friend group count:").concat(r.length)),e._friendGroupMap.clear(),r.forEach((function(t){var n=new bc(t);e._friendGroupMap.set(t.name,n)})),e._emitFriendGroupListUpdated())})).catch((function(i){return e._snsModule.probeNetwork().then((function(e){var t=v(e,2),r=t[0],o=t[1];n.setError(i,r,o).end()})),He.w("".concat(t," error:"),i),va(i)}))}},{key:"createFriendGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("createFriendGroup"),i=e.name,r=e.userIDList;if(this._friendGroupMap.has(i))return va({code:No.FRIEND_GROUP_EXISTED});var o=new $o("createFriendGroup");return o.setMessage("name:".concat(i," userIDList:").concat(r)),this._snsModule.request({protocolName:Fi,requestData:{fromAccount:this._snsModule.getMyUserID(),groupName:[i],userIDList:pt(r)?r:void 0}}).then((function(e){o.setNetworkType(t._snsModule.getNetworkType()).end(),He.l("".concat(n," ok. name:").concat(i," userIDList:").concat(r));var a=e.data.resultList,s=[],c=[];a&&a.forEach((function(e){var t=e.to,n=e.resultCode,i=e.resultInfo;if(ht(n)||0===n)s.push(t);else{var r={userID:e.to,code:n,message:i};c.push(r)}}));var u=new bc({name:i,userIDList:s});return t._friendGroupMap.set(i,u),t._snsModule.updateWhenAddedToFriendGroup({name:i,userIDList:s}),t._emitFriendGroupListUpdated(),pa({friendGroup:u,failureUserIDList:c})})).catch((function(e){return t._snsModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"deleteFriendGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteFriendGroup"),i=e.name;if(!this._friendGroupMap.has(i))return va({code:No.FRIEND_GROUP_NOT_EXIST});var r=new $o("deleteFriendGroup");return r.setMessage("name:".concat(i)),this._snsModule.request({protocolName:Vi,requestData:{fromAccount:this._snsModule.getMyUserID(),nameList:[i]}}).then((function(e){r.setNetworkType(t._snsModule.getNetworkType()).end(),He.l("".concat(n," ok. name:").concat(i));var o=t._friendGroupMap.get(i);return o&&(t._snsModule.updateWhenRemovedFromFriendGroup({name:i,userIDList:o.userIDList}),t._friendGroupMap.delete(i),o.userIDList.length=0),t._emitFriendGroupListUpdated(),pa(o)})).catch((function(e){return t._snsModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"renameFriendGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("renameFriendGroup"),i=e.oldName,r=e.newName;if(!this._friendGroupMap.has(i))return va({code:No.FRIEND_GROUP_NOT_EXIST});var o=new $o("renameFriendGroup");return o.setMessage("oldName:".concat(i," newName:").concat(r)),this._snsModule.request({protocolName:qi,requestData:{fromAccount:this._snsModule.getMyUserID(),oldName:i,newName:r}}).then((function(){if(o.setNetworkType(t._snsModule.getNetworkType()).end(),He.l("".concat(n," ok. oldName:").concat(i," newName:").concat(r)),t._friendGroupMap.has(i)){var e=t._friendGroupMap.get(i);return e.name=r,t._friendGroupMap.delete(i),t._friendGroupMap.set(r,e),t._snsModule.updateWhenRemovedFromFriendGroup({name:i,userIDList:e.userIDList}),t._snsModule.updateWhenAddedToFriendGroup({name:r,userIDList:e.userIDList}),t._emitFriendGroupListUpdated(),pa(e)}return pa()})).catch((function(e){return t._snsModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"addToFriendGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("addToFriendGroup"),i=e.name,r=e.userIDList;if(!this._friendGroupMap.has(i))return this._onFriendGroupNotExist(i);var o=new $o("addToFriendGroup");return o.setMessage("name:".concat(i," userIDList:").concat(r)),He.l("".concat(n," name:").concat(i," userIDList:").concat(r)),this._snsModule.request({protocolName:qi,requestData:{fromAccount:this._snsModule.getMyUserID(),oldName:i,updateGroupItem:r.filter((function(e){return t._snsModule.isMyFriend(e)})).map((function(e){return{to:e,updateType:"Update_Type_Add"}}))}}).then((function(e){return o.setNetworkType(t._snsModule.getNetworkType()).end(),t._onFriendGroupUpdated(i,e)})).catch((function(e){return t._snsModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"removeFromFriendGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("removeFromFriendGroup"),i=e.name,r=e.userIDList;if(!this._friendGroupMap.has(i))return this._onFriendGroupNotExist(i);var o=new $o("removeFromFriendGroup");return o.setMessage("name:".concat(i," userIDList:").concat(r)),He.l("".concat(n," name:").concat(i," userIDList:").concat(r)),this._snsModule.request({protocolName:qi,requestData:{fromAccount:this._snsModule.getMyUserID(),oldName:i,updateGroupItem:r.filter((function(e){return t._snsModule.isMyFriend(e)})).map((function(e){return{to:e,updateType:"Update_Type_Delete"}}))}}).then((function(e){return o.setNetworkType(t._snsModule.getNetworkType()).end(),t._onFriendGroupUpdated(i,e)})).catch((function(e){return t._snsModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),He.w("".concat(n," failed. error:"),e),va(e)}))}},{key:"_onFriendGroupUpdated",value:function(e,t){var n=t.data.resultList,i=this._friendGroupMap.get(e),r=[],o=[],a=[];return pt(n)&&n.forEach((function(e){var t=e.to,n=e.resultCode,s=e.resultInfo,c=e.type;0===n?"Update_Type_Add"===c?i&&(i.addToUserIDList(t),o.push(t)):"Update_Type_Delete"===c&&i&&(i.removeFromUserIDList(t),a.push(t)):r.push({to:e.to,code:n,message:s})})),He.l("".concat(this._n,"._onFriendGroupUpdated name:").concat(e," userIDList:").concat(i.userIDList)),o.length>0&&this._snsModule.updateWhenAddedToFriendGroup({name:e,userIDList:o}),a.length>0&&this._snsModule.updateWhenRemovedFromFriendGroup({name:e,userIDList:a}),pa({friendGroup:i,failureUserIDList:r})}},{key:"updateWhenFriendAdded",value:function(e){var t=this,n=e.nameList,i=e.userID;He.l("".concat(this._n,".updateWhenFriendAdded userID:").concat(i," nameList:").concat(n)),tn(n)||n.forEach((function(e){t._friendGroupMap.has(e)&&t._friendGroupMap.get(e).addToUserIDList(i)}))}},{key:"updateWhenFriendDeleted",value:function(e){var t=this,n=e.nameList,i=e.userID;He.l("".concat(this._n,".updateWhenFriendDeleted userID:").concat(i," nameList:").concat(n)),tn(n)||n.forEach((function(e){t._friendGroupMap.has(e)&&t._friendGroupMap.get(e).removeFromUserIDList(i)}))}},{key:"reset",value:function(){this._friendGroupMap.clear()}}]),e}(),wc=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="SnsModule",r._friendHandler=new kc(f(r)),r._friendApplicationHandler=new Sc(f(r)),r._friendGroupHandler=new Dc(f(r)),r.getInnerEmitterInstance().on(Ia,r.onContextUpdated,f(r)),r}return o(n,[{key:"onContextUpdated",value:function(e){this._friendHandler.pagingGetFriendList(),this._friendGroupHandler.getFriendGroupList(),this._friendApplicationHandler.getFriendApplicationList()}},{key:"onRelationChainModified",value:function(e){var t=this,n=e.dataList;if(!tn(n)){var i=[],r=[],o=[],a=[],s=!1,c="";n.forEach((function(e){if(3!==e.pushType&&4!==e.pushType||!e.from||(c=e.from),e.friendAddAccount&&(i.push.apply(i,_(e.friendAddAccount)),a.push.apply(a,_(e.friendAddAccount))),e.friendDelAccount&&r.push.apply(r,_(e.friendDelAccount)),e.friendApplicationAdded&&o.push.apply(o,_(e.friendApplicationAdded)),e.friendApplicationDeletedUserIDList&&a.push.apply(a,_(e.friendApplicationDeletedUserIDList)),e.reportTime&&7===e.pushType&&(s=!0),e.friendUpInfo){var n={dataList:[]};e.friendUpInfo.forEach((function(e){n.dataList.push({userID:e.friendAccount,profileList:_(e.sns)})})),t.onFriendProfileModified(n)}})),s&&this._friendApplicationHandler.onFriendApplicationRead(),this._friendApplicationHandler.onFriendApplicationAdded(o,c),this._friendApplicationHandler.onFriendApplicationDeleted(a),this._friendHandler.onFriendAdded(i),this._friendHandler.onFriendDeleted(r)}}},{key:"isMyFriend",value:function(e){return this._friendHandler.isMyFriend(e)}},{key:"filterProfanity",value:function(e,t){var n=this.getModule(li);if(!n)return!0;var i=n.filterText(t[e],$),r=i.isAllowedToSend,o=i.modifiedText;return!0===r&&(t[e]=o,!0)}},{key:"onFriendProfileModified",value:function(e){this._friendHandler.onFriendProfileModified(e)}},{key:"getLocalFriendList",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this._friendHandler.getLocalFriendList();return e?ma(t):t}},{key:"getFriendRemark",value:function(e){return this._friendHandler.getFriendRemark(e)}},{key:"getFriendList",value:function(){return this._friendHandler.pagingGetFriendList()}},{key:"addFriend",value:function(e){return this._friendHandler.addFriend(e)}},{key:"deleteFriend",value:function(e){return this._friendHandler.deleteFriend(e)}},{key:"checkFriend",value:function(e){return this._friendHandler.checkFriend(e)}},{key:"getFriendProfile",value:function(e){return this._friendHandler.getFriendProfile(e)}},{key:"updateFriend",value:function(e){return this._friendHandler.updateFriend(e)}},{key:"updateWhenAddedToFriendGroup",value:function(e){this._friendHandler.updateWhenAddedToFriendGroup(e)}},{key:"updateWhenRemovedFromFriendGroup",value:function(e){this._friendHandler.updateWhenRemovedFromFriendGroup(e)}},{key:"getLocalFriendApplicationList",value:function(){var e=this._friendApplicationHandler.getLocalFriendApplicationList();return ma(e)}},{key:"deleteFriendApplication",value:function(e){return this._friendApplicationHandler.deleteFriendApplication(e)}},{key:"refuseFriendApplication",value:function(e){return this._friendApplicationHandler.refuseFriendApplication(e)}},{key:"acceptFriendApplication",value:function(e){return this._friendApplicationHandler.acceptFriendApplication(e)}},{key:"setFriendApplicationRead",value:function(e){return this._friendApplicationHandler.setFriendApplicationRead(e)}},{key:"getLocalFriendGroupList",value:function(){var e=this._friendGroupHandler.getLocalFriendGroupList();return ma(e)}},{key:"createFriendGroup",value:function(e){return this._friendGroupHandler.createFriendGroup(e)}},{key:"deleteFriendGroup",value:function(e){return this._friendGroupHandler.deleteFriendGroup(e)}},{key:"addToFriendGroup",value:function(e){return this._friendGroupHandler.addToFriendGroup(e)}},{key:"removeFromFriendGroup",value:function(e){return this._friendGroupHandler.removeFromFriendGroup(e)}},{key:"renameFriendGroup",value:function(e){return this._friendGroupHandler.renameFriendGroup(e)}},{key:"onAddToFriendGroup",value:function(e){return this._friendGroupHandler.onAddToFriendGroup(e)}},{key:"updateWhenFriendAdded",value:function(e){this._friendGroupHandler.updateWhenFriendAdded(e)}},{key:"updateWhenFriendDeleted",value:function(e){this._friendGroupHandler.updateWhenFriendDeleted(e)}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._friendHandler.reset(),this._friendGroupHandler.reset(),this._friendApplicationHandler.reset()}}]),n}(fi),Ac=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="WorkerTimerModule",r._isWorkerEnabled=!0,r._workerTimer=null,r._timerID=-1,r._init(),r.getInnerEmitterInstance().on(Ma,r._onCloudConfigUpdated,f(r)),r}return o(n,[{key:"isWorkerEnabled",value:function(){return this._isWorkerEnabled&&we}},{key:"startWorkerTimer",value:function(){He.l("".concat(this._n,".startWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("start")}},{key:"stopWorkerTimer",value:function(){He.l("".concat(this._n,".stopWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("stop")}},{key:"_init",value:function(){if(we){var e=URL.createObjectURL(new Blob(['let interval = -1;onmessage = function(event) {  if (event.data === "start") {    if (interval > 0) {      clearInterval(interval);    }    interval = setInterval(() => {      postMessage("");    }, 1000);    postMessage(interval);  } else if (event.data === "stop") {    clearInterval(interval);    interval = -1;  }};'],{type:"application/javascript; charset=utf-8"}));this._workerTimer=new Worker(e);var t=this;this._workerTimer.onmessage=function(e){e.data?(t._timerID=e.data,He.l("".concat(t._n,"._init seed:").concat(t._timerID))):t._m.onCheckTimer()}}}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("enable_worker");He.l("".concat(this._n,"._onCloudConfigUpdated enableWorker:").concat(e)),ht(e)||"1"===e?!this._isWorkerEnabled&&we&&(this._isWorkerEnabled=!0,this.startWorkerTimer(),this._m.onWorkerTimerEnabled()):this._isWorkerEnabled&&we&&(this._isWorkerEnabled=!1,this.stopWorkerTimer(),this._m.onWorkerTimerDisabled())}},{key:"terminate",value:function(){He.l("".concat(this._n,".terminate")),this._workerTimer&&(this._workerTimer.terminate(),this._workerTimer=null,this._timerID=-1)}},{key:"getTimerID",value:function(){return this._timerID}},{key:"reset",value:function(){He.l("".concat(this._n,".reset"))}}]),n}(fi),Rc=function(){function e(){i(this,e),this._n="PurchasedFeatureHandler",this._purchasedFeatureMap=new Map}return o(e,[{key:"isValidPurchaseBits",value:function(e){return e&&"string"==typeof e&&e.length>=1&&e.length<=64&&/[01]{1,64}/.test(e)}},{key:"parsePurchaseBits",value:function(e){var t="".concat(this._n,".parsePurchaseBits");if(this.isValidPurchaseBits(e)){this._purchasedFeatureMap.clear();for(var n=null,i=e.length-1,r=0;i>=0;i--,r++)n=r<32?new w(0,Math.pow(2,r)).toString():new w(Math.pow(2,r-32),0).toString(),"1"===e[i]?this._purchasedFeatureMap.set(n,!0):this._purchasedFeatureMap.set(n,!1)}else He.w("".concat(t," invalid purchase bits:").concat(e))}},{key:"hasPurchasedFeature",value:function(e){return!!this._purchasedFeatureMap.get(e)}},{key:"isFeatureEnabled",value:function(e){for(var t=parseInt(e).toString(2),n=void 0,i=!0,r=t.length-1,o=0;r>=0;r--,o++)if("1"===t.charAt(r)&&(n=o<32?new w(0,Math.pow(2,o)).toString():new w(Math.pow(2,o-32),0).toString(),!this._purchasedFeatureMap.get(n))){i=!1;break}return He.l("".concat(this._n,".isFeatureEnabled decimalNumber:").concat(e," binaryString:").concat(t," ret:").concat(i)),ma({enabled:i})}},{key:"clear",value:function(){this._purchasedFeatureMap.clear()}}]),e}(),Lc=function(){function e(t){i(this,e),this._m=t,this._n="CommercialConfigModule",this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler=new Rc}return o(e,[{key:"_canFetch",value:function(){return this._getModule(Wn).isLoggedIn()?!this._isFetching&&Date.now()>=this._expiredTime:(this._expiredTime=Date.now()+2e3,!1)}},{key:"onCheckTimer",value:function(e){this._canFetch()&&this.fetchConfig()}},{key:"fetchConfig",value:function(){var e=this,t=this._canFetch(),n="".concat(this._n,".fetchConfig");if(He.l("".concat(n," canFetch:").concat(t)),t){var i=this._getModule(Jn),r=new $o("fetchCommercialConfig");r.setNetworkType(i.getNetworkType());var o=this._getModule(Wn).getSDKAppID(),a=this._getModule(ti);this._isFetching=!0,a.request({protocolName:_o,requestData:{SDKAppID:o}}).then((function(t){r.setMessage("purchaseBits:".concat(t.data.purchaseBits)).end(),He.l("".concat(n," ok.")),e._parseConfig(t.data),e._isFetching=!1})).catch((function(t){i.probe().then((function(e){var n=v(e,2),i=n[0],o=n[1];r.setError(t,i,o).end()})),e._isFetching=!1}))}}},{key:"onPushedConfig",value:function(e){var t="".concat(this._n,".onPushedConfig");He.l("".concat(t)),new $o("pushedCommercialConfig").setNetworkType(this._getModule(Jn).getNetworkType()).setMessage("purchaseBits:".concat(e.purchaseBits)).end(),this._parseConfig(e)}},{key:"_parseConfig",value:function(e){var t="".concat(this._n,"._parseConfig"),n=e.errorCode,i=e.errorMessage,r=e.purchaseBits,o=e.expiredTime;0===n?(this._purchasedFeatureHandler.parsePurchaseBits(r),this._expiredTime=Date.now()+1e3*o):ht(n)?(He.l("".concat(t," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(He.e("".concat(t," errorCode:").concat(n," errorMessage:").concat(i)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"canIUse",value:function(e){return this._purchasedFeatureHandler.hasPurchasedFeature(e)}},{key:"isFeatureEnabled",value:function(e){return this._purchasedFeatureHandler.isFeatureEnabled(e)}},{key:"_getModule",value:function(e){return this._m.getModule(e)}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler.clear()}}]),e}(),Oc=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._m=e,r._n="OfflinePushModule",r._offlinePushPlugin=void 0,r._androidPushConfig={huaweiPushBussinessId:"",xiaomiPushBussinessId:"",xiaomiPushAppId:"",xiaomiPushAppKey:"",meizuPushBussinessId:"",meizuPushAppId:"",meizuPushAppKey:"",vivoPushBussinessId:"",fcmPushBussinessId:"",oppoPushBussinessId:"",oppoPushAppKey:"",oppoPushAppSecret:"",honorPushBussinessId:""},r._deviceToken="",r._businessID=0,r._iosBusinessID=0,r._c2cUnreadCount=0,r._groupUnreadCount=0,r._isWebUniapp=0,r}return o(n,[{key:"registerPlugin",value:function(e){if(re){this._offlinePushPlugin=e["tim-offline-push-plugin"];var t=e.offlinePushConfig||{},n=t.huaweiBusinessID,i=t.xiaomiBusinessID,r=t.xiaomiAppID,o=t.xiaomiAppKey,a=t.meizuBusinessID,s=t.meizuAppID,c=t.meizuAppKey,u=t.vivoBusinessID,l=t.oppoBusinessID,d=t.oppoAppKey,p=t.oppoAppSecret,h=t.honorBusinessID,f=t.iosBusinessID;this._androidPushConfig.huaweiPushBussinessId=n,this._androidPushConfig.xiaomiPushBussinessId=i,this._androidPushConfig.xiaomiPushAppId=r,this._androidPushConfig.xiaomiPushAppKey=o,this._androidPushConfig.meizuPushBussinessId=a,this._androidPushConfig.meizuPushAppId=s,this._androidPushConfig.meizuPushAppKey=c,this._androidPushConfig.vivoPushBussinessId=u,this._androidPushConfig.oppoPushBussinessId=l,this._androidPushConfig.oppoPushAppKey=d,this._androidPushConfig.oppoPushAppSecret=p,this._androidPushConfig.honorPushBussinessId=h,new $o("registerPlugin").setMessage("tim-offline-push-plugin").setMoreMessage("isExist:".concat(!ht(this._offlinePushPlugin))).end(!0),He.l("".concat(this._n,".").concat("registerPlugin"," ok. offlinePushConfig:").concat(JSON.stringify(e.offlinePushConfig))),this._iosBusinessID=f,this._setAppShowListener()}else this.outputWarning("OfflinePushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._getDeviceToken()}},{key:"_getDeviceToken",value:function(){var e=this,t="".concat(this._n,".").concat("_getDeviceToken");if(gt(this._offlinePushPlugin.getDeviceToken)){var n="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig),", iosBusinessID:").concat(this._iosBusinessID);He.l("".concat(t," start. ").concat(n)),new $o("_getDeviceToken").setMessage("".concat(n)).end(!0),this._offlinePushPlugin.getDeviceToken(this._androidPushConfig,(function(i){var r=new $o("getDeviceTokenRes"),o=i.code,a=i.msg;if(0===o){var s=i.data,c=s.deviceToken,u=s.deviceBrand,l=s.deviceType,d=s.bussinessId;e._deviceToken=c,e._businessID=d||e._iosBusinessID,n="deviceToken:".concat(c,", deviceBrand:").concat(u||l,", businessID:").concat(e._businessID),He.l("".concat(t," ok. ").concat(n)),r.setMessage(n).end(!0),e._setToken()}else r.setMessage("code:".concat(o,", msg:").concat(a)).end(!0),He.e("".concat(t," failed. error:"),i)}))}else He.e("".concat(t," getDeviceToken is not a function"))}},{key:"canIUseOfflinePush",value:function(){return re&&!ht(this._offlinePushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setAppShowListener");ht(this._offlinePushPlugin)?He.e("".concat(t," offlinePushPlugin is undefined")):gt(this._offlinePushPlugin.setAppShowListener)?(new $o("_setAppShowListener").end(!0),He.l("".concat(t," start")),this._offlinePushPlugin.setAppShowListener((function(n){var i=(n||{}).appShow;new $o("setAppShowListenerRes").setMessage("appShow:".concat(i)).end(!0),He.l("".concat(t," ok. appShow:").concat(i)),e._m.isReady()&&(0===i?(e._getConvUnreadCount(),e._onBackground()):1===i&&e._onForeground())}))):He.e("".concat(t," setAppShowListener is not a function"))}},{key:"getDeviceBrand",value:function(){if(!ht(this._offlinePushPlugin)&&gt(this._offlinePushPlugin.getDeviceType)){var e=(this._offlinePushPlugin.getDeviceType()||{}).deviceType;return He.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}}},{key:"_setToken",value:function(){var e,t=this,n="".concat(this._n,"._setToken"),i=this.getModule(Wn),r=1,o="",a="";tn(this._deviceToken)&&(r=0);var s=this.getUniAppPlatform(),c=this.getDeviceBrand();s===R.IOS||s===R.IPAD||s===R.MAC?a=this._deviceToken:s===R.ANDROID&&(o=this._deviceToken);var u=new $o("offlinePushSetToken");return e="deviceToken:".concat(a||o,", businessID:").concat(this._businessID,", ")+"deviceBrand:".concat(c,", isWebUniapp:").concat(this._isWebUniapp,", pushMsg:").concat(r,", platform:").concat(s),u.setMessage("".concat(e)),He.l("".concat(n," ").concat(e)),this.request({protocolName:Ro,requestData:{tokenID:o,pushMsg:r,sdkAppID:i.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:c,deviceToken:a,isWebUniapp:this._isWebUniapp}}).then((function(e){return u.end(),He.l("".concat(n," ok")),e})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];u.setError(e,i,r).end()})),He.e("".concat(n," failed. error:"),e),va(e)}))}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.getModule(zn).getLocalConversationList().forEach((function(t){t.type===b.CONV_C2C&&(e._c2cUnreadCount+=t.unreadCount),t.type===b.CONV_GROUP&&(e._groupUnreadCount+=t.unreadCount)}))}},{key:"_onBackground",value:function(){var e=this,t="".concat(this._n,".").concat("_onBackground"),n=new $o("_onBackground");this.request({protocolName:wo,requestData:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then((function(i){return n.setMessage("c2cUnreadCount: ".concat(e._c2cUnreadCount,", groupUnreadCount: ").concat(e._groupUnreadCount)).end(),He.l("".concat(t," ok")),i})).catch((function(i){e.probeNetwork().then((function(e){var t=v(e,2),r=t[0],o=t[1];n.setError(i,r,o).end()})),He.e("".concat(t," failed. error:"),i)}))}},{key:"_onForeground",value:function(){var e=this,t="".concat(this._n,".").concat("_onForeground"),n=new $o("_onForeground");this.request({protocolName:Ao,requestData:{isWebUniapp:this._isWebUniapp}}).then((function(e){return n.end(),He.l("".concat(t," ok")),e})).catch((function(i){e.probeNetwork().then((function(e){var t=v(e,2),r=t[0],o=t[1];n.setError(i,r,o).end()})),He.e("".concat(t," failed. error:"),i)}))}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,t=this.getDeviceBrand();return"ios"===e?R.IOS:"android"===e?R.ANDROID:1002===t?R.IPAD:1001===t?R.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,He.l("".concat(this._n,".reset"))}}]),n}(fi),Nc=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="ProfanityFilterModule",r._plugin=null,r._filterConfigMap=new Map,r._startIndex=0,r._version=0,r._canIUseLexicon=!1,r._isFetching=!1,r._expiredTime=0,r}return o(n,[{key:"init",value:function(){var e=this.getModule(Qn).getPlugin("tim-profanity-filter-plugin");e?(this._plugin=new e({logger:He,isArray:pt,isMap:at,isDevMode:this.isDevMode()}),this._getLexicon()):this.outputWarning("ProfanityPluginNotFound")}},{key:"onCheckTimer",value:function(){this._plugin&&this._canIUseLexicon&&this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime&&this._getLexicon()}},{key:"filterMessage",value:function(e,t){var n=!0;if(!this._plugin||!this._canIUseLexicon)return n;if(t&&t.messageControlInfo&&!0===t.messageControlInfo.excludedFromContentModeration)return n;var i=e.type,r=e.conversationType;if(i!==b.MSG_TEXT&&i!==b.MSG_CUSTOM)return n;var o,a="".concat(this._n,".filterMessage");if(He.l("".concat(a)),i===b.MSG_TEXT){if(r===b.CONV_C2C?o=j:r===b.CONV_GROUP&&(o=z),!this._isConfigOn(o))return n;var s=this._plugin.filter(e.payload.text),c=s.type,u=s.modifiedText;1===c?n=!1:2===c&&(e.payload.text=u)}else if(i===b.MSG_CUSTOM){if(r===b.CONV_C2C?o=K:r===b.CONV_GROUP&&(o=W),!this._isConfigOn(o))return n;var l=this._plugin.filter(e.payload.data),d=this._plugin.filter(e.payload.description),p=this._plugin.filter(e.payload.extension);1===l.type||1===d.type||1===p.type?n=!1:(2===l.type&&(e.payload.data=l.modifiedText),2===d.type&&(e.payload.description=d.modifiedText),2===p.type&&(e.payload.extension=p.modifiedText))}return He.l("".concat(a," done. isAllowedToSend:").concat(n)),n}},{key:"filterText",value:function(e,t){var n="".concat(this._n,".filterText"),i={isAllowedToSend:!0,modifiedText:e};if(!this._plugin||!this._canIUseLexicon)return i;if(!this._isConfigOn(t))return i;He.l("".concat(n));var r=this._plugin.filter(e),o=r.type,a=r.modifiedText;return 1===o?i.isAllowedToSend=!1:2===o&&(i.modifiedText=a),He.l("".concat(n," done. ret:"),i),i}},{key:"_getLexicon",value:function(){var e=this,t=new $o("profanityFilter"),n="".concat(this._n,"._getLexicon");this._isFetching=!0,this.request({protocolName:Lo,requestData:{startIndex:this._startIndex,version:this._version}}).then((function(i){var r=i.data,o=r.errorInfo,a=r.filterConfig,s=r.lexicon,c=r.strToken,u=r.completeFlag,l=r.nextStartIndex,d=r.version,p=r.expiredTime,h=o.errorCode,f=o.errorMessage;return 0!==h?(e._isFetching=!1,He.w("".concat(n," failed. error:"),o),void t.setCode(h).setMessage(f).end()):(e._onFilterConfig(a),e._getToken(c),1===u?(He.l("".concat(n," done. version:").concat(d," expiredTime:").concat(p)),e._version=d,e._canIUseLexicon=!0,e._isFetching=!1,e._expiredTime=Date.now()+1e3*p,void e._plugin.onLexiconCompleted(s)):(e._startIndex=l,e._plugin.onLexiconSliced(s),void e._getLexicon()))})).catch((function(i){e.probeNetwork().then((function(e){var n=v(e,2),r=n[0],o=n[1];t.setError(i,r,o).end()})),e._isFetching=!1,He.l("".concat(n," failed. error:"),i)}))}},{key:"_onFilterConfig",value:function(e){var t=this;tn(e)||(this._filterConfigMap.clear(),Object.keys(e).forEach((function(n){t._filterConfigMap.set(n,e[n])})),He.l("".concat(this._n,"._onFilterConfig. keys:").concat(Array.from(this._filterConfigMap.keys())," values:").concat(Array.from(this._filterConfigMap.values()))))}},{key:"_isConfigOn",value:function(e){return 1===this._filterConfigMap.get(e)}},{key:"_getToken",value:function(e){if(ut(e)){var t=e.length,n="";if(t%2==0)for(var i=0;i<=t-1;i+=2)n+=e[i+1],n+=e[i];else{for(var r=0;r<t-1;r+=2)n+=e[r+1],n+=e[r];n+=e[t-1]}this._plugin.onToken(n)}}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),this._plugin&&(this._plugin.reset(),this._plugin=null),this._filterConfigMap.clear(),this._startIndex=0,this._version=0,this._canIUseLexicon=!1,this._isFetching=!1,this._expiredTime=0}}]),n}(fi),Pc=function(){function e(t){i(this,e),this._m=t,this._n="TransCmdModule"}return o(e,[{key:"sendTRTCCustomData",value:function(e){return this._trans(t({serv:B.NAME.TUIROOM_SVR},e))}},{key:"_trans",value:function(e){He.d("".concat(this._n,"._trans. options:").concat(JSON.stringify(e)));var t=e.serv,n=e.data;return this._m.getModule(ti).trans({servcmd:"".concat(t,".*"),data:ut(n)?JSON.parse(n):n})}},{key:"reset",value:function(){He.l("".concat(this._n,".reset"))}}]),e}(),Uc=function(){function e(t){i(this,e),this._m=t,this._n="ErrorMessageModule",this.TIM_ERROR_ASSISTANCE="tim_error_assistance",this.STORAGE_EXPIRES_TIME=6048e5,this._map=new Map,this._init()}return o(e,[{key:"_init",value:function(){var e=this._getStorageModule().getItem(this.TIM_ERROR_ASSISTANCE,!1);if(e){var t=JSON.parse(e);this._needToUpdate(t)?this._fetch():this._fillMap(t.message)}else this._fetch()}},{key:"_needToUpdate",value:function(e){var t=e.localSavedTime,n=e.localSavedVersion,i=t&&(new Date).getTime()-t>=this.STORAGE_EXPIRES_TIME,r=!n||"2.27.1"!==n;return He.l("".concat(this._n,"._needToUpdate isTimeout:").concat(i," isDifferentVersion:").concat(r)),i||r}},{key:"_fetch",value:function(){if(!this._m.getModule(Wn).isPrivateNetWork()){var e="https://web.sdk.qcloud.com/im/download/error-message/0.0.1/tim-error-message.txt",t="application/x-www-form-urlencoded;charset=UTF-8",n="".concat(this._n,"._fetch ok in"),i=this;if(ae)ce.request({url:e,method:"GET",timeout:3e3,header:{"content-type":t},dataType:"text",success:function(e){i._fillAndSave(e.data),He.l("".concat(n," mini program"))},fail:function(){}});else{var r=new XMLHttpRequest,o=setTimeout((function(){r.abort()}),3e3);r.onreadystatechange=function(){4===r.readyState&&(clearTimeout(o),200!==r.status&&304!==r.status||(He.l("".concat(n," browser")),i._fillAndSave(r.responseText)))},r.open("GET",e,!0),r.setRequestHeader("Content-type",t),r.send()}}}},{key:"_fillAndSave",value:function(e){this._fillMap(e),this._getStorageModule().setItem(this.TIM_ERROR_ASSISTANCE,JSON.stringify({message:e,localSavedTime:(new Date).getTime(),localSavedVersion:"2.27.1"}),!0,!1)}},{key:"_getStorageModule",value:function(){return this._m.getModule(Yn)}},{key:"_fillMap",value:function(e){this._map.clear();for(var t,n,i,r=e.split(";\n"),o=r.length,a=new RegExp(/'/g),s=0;s<o;s++)if(t=r[s].indexOf(":"),n=r[s].slice(0,t),i=r[s].slice(t+1,r[s].length),!n.startsWith("//")){if(ht(i))continue;this._map.set(n,i.replace(a,""))}}},{key:"get",value:function(e){var t=e.isIntl,n=e.key,i=e.replacement1,r=e.replacement2,o="".concat(n,t?"_en":"_cn");!this._map.has(o)&&this._map.has(n)&&(o=n);var a="";return this._map.has(o)?(a=this._map.get(o),ht(i)||(a=a.replace("$replacement1",i)),ht(r)||(a=a.replace("$replacement2",r)),a):a}},{key:"reset",value:function(){He.l("".concat(this._n,".reset"))}}]),e}(),xc=function(){function e(t){i(this,e);var n=new $o("sdkConstruct");this._n="ModuleManager",this._isReady=!1,this._reason=No.USER_NOT_LOGGED_IN,this._startLoginTs=0,this._moduleMap=new Map,this._innerEmitter=null,this._outerEmitter=null,this._checkCount=0,this._checkTimer=-1,this._moduleMap.set(Wn,new _s(this,t)),this._moduleMap.set(ci,new Lc(this)),this._moduleMap.set(ri,new mc(this)),this._moduleMap.set(oi,new Ac(this)),this._moduleMap.set(si,new Tc(this)),this._moduleMap.set(ni,new sc(this)),this._moduleMap.set(ti,new fc(this)),this._moduleMap.set(xn,new ys(this)),this._moduleMap.set(Gn,new Gs(this)),this._moduleMap.set(Fn,new Fs(this)),this._moduleMap.set(pi,new Vs(this)),this._moduleMap.set(Vn,new vs(this)),this._moduleMap.set(qn,new _a(this)),this._moduleMap.set(zn,new Fa(this)),this._moduleMap.set(Bn,new os(this)),this._moduleMap.set(jn,new ss(this)),this._moduleMap.set(Kn,new ds(this)),this._moduleMap.set(Yn,new Ms(this)),this._moduleMap.set(hi,new Uc(this)),this._moduleMap.set($n,new Ss(this)),this._moduleMap.set(Jn,new Ds(this)),this._moduleMap.set(Xn,new As(this)),this._moduleMap.set(Zn,new Ls(this)),this._moduleMap.set(Qn,new qs(this)),this._moduleMap.set(ei,new Bs(this)),this._moduleMap.set(ii,new gc(this)),this._moduleMap.set(ai,new vc(this)),this._moduleMap.set(Hn,new wc(this)),this._moduleMap.set(ui,new Oc(this)),this._moduleMap.set(li,new Nc(this)),this._moduleMap.set(di,new Pc(this)),this._eventThrottleMap=new Map;var r=t.instanceID,o=t.oversea,a=t.SDKAppID,s="instanceID:".concat(r," SDKAppID:").concat(a," host:").concat(Ft()," oversea:").concat(o," inBrowser:").concat(se," inMiniApp:").concat(ae)+" workerAvailable:".concat(we," UserAgent:").concat(ue);$o.bindEventStatModule(this._moduleMap.get($n)),n.setMessage("".concat(s," ").concat(function(){var e="";if(ae)try{var t=ce.getSystemInfoSync(),n=t.model,i=t.version,r=t.system,o=t.platform,a=t.SDKVersion;e="model:".concat(n," version:").concat(i," system:").concat(r," platform:").concat(o," SDKVersion:").concat(a)}catch(s){e=""}return e}())).end(),He.i("SDK ".concat(s)),ha.prototype._getErrorMessage=this.getErrorMessage.bind(this),this._readyList=void 0,this._ssoLogForReady=null,this._initReadyList()}return o(e,[{key:"_startTimer",value:function(){var e=this._moduleMap.get(oi),t=e.isWorkerEnabled();He.l("".concat(this._n,".startTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.startWorkerTimer():this._startMainThreadTimer()}},{key:"_startMainThreadTimer",value:function(){this._checkTimer<0&&(this._checkTimer=setInterval(this.onCheckTimer.bind(this),1e3)),He.l("".concat(this._n,"._startMainThreadTimer seed:").concat(this._checkTimer))}},{key:"stopTimer",value:function(){var e=this._moduleMap.get(oi),t=e.isWorkerEnabled();He.l("".concat(this._n,".stopTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.stopWorkerTimer():this._stopMainThreadTimer()}},{key:"_stopMainThreadTimer",value:function(){He.l("".concat(this._n,"._stopMainThreadTimer")),this._checkTimer>0&&(clearInterval(this._checkTimer),this._checkTimer=-1,this._checkCount=0)}},{key:"_stopMainThreadSocket",value:function(){He.l("".concat(this._n,"._stopMainThreadSocket"));var e=this._moduleMap.get(ni);e.setIsWorkerEnabled(!0),e.reConnect()}},{key:"_startMainThreadSocket",value:function(){He.l("".concat(this._n,"._startMainThreadSocket"));var e=this._moduleMap.get(ni);e.setIsWorkerEnabled(!1),e.reConnect()}},{key:"onWorkerTimerEnabled",value:function(){He.l("".concat(this._n,".onWorkerTimerEnabled, disable main thread timer and socket")),this._stopMainThreadTimer(),this._stopMainThreadSocket()}},{key:"onWorkerTimerDisabled",value:function(){He.l("".concat(this._n,".onWorkerTimerDisabled, enable main thread timer and socket")),this._startMainThreadTimer(),this._startMainThreadSocket()}},{key:"onCheckTimer",value:function(){this._checkCount+=1;var e,t=E(this._moduleMap);try{for(t.s();!(e=t.n()).done;){var n=v(e.value,2)[1];n.onCheckTimer&&n.onCheckTimer(this._checkCount)}}catch(i){t.e(i)}finally{t.f()}}},{key:"_initReadyList",value:function(){var e=this;this._readyList=[this._moduleMap.get(xn),this._moduleMap.get(zn)],this._readyList.forEach((function(t){t.ready((function(){return e._onModuleReady()}))}))}},{key:"_onModuleReady",value:function(){var e=!0;if(this._readyList.forEach((function(t){t.isReady()||(e=!1)})),e&&!this._isReady){this._isReady=!0,this._outerEmitter.emit(k.SDK_READY);var t=Date.now()-this._startLoginTs;He.w("SDK is ready. cost ".concat(t," ms")),this._startLoginTs=Date.now();var n=this._moduleMap.get(Jn).getNetworkType(),i=this._ssoLogForReady.getStartTs()+Ue;this._ssoLogForReady.setNetworkType(n).setMessage(t).start(i).end()}}},{key:"login",value:function(){0===this._startLoginTs&&(Ge(),this._startLoginTs=Date.now(),this._startTimer(),this._moduleMap.get(Jn).start(),this._ssoLogForReady=new $o("sdkReady"),this._reason=No.LOGGING_IN)}},{key:"onLoginFailed",value:function(){this._startLoginTs=0}},{key:"getOuterEmitterInstance",value:function(){return null===this._outerEmitter&&(this._outerEmitter=new ws,ga(this._outerEmitter),this._outerEmitter._emit=this._outerEmitter.emit,this._outerEmitter.emit=function(e,t){var n=this;if(e===k.CONVERSATION_LIST_UPDATED||e===k.FRIEND_LIST_UPDATED||e===k.GROUP_LIST_UPDATED||e===k.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED)if(this._eventThrottleMap.has(e)){var i=Date.now(),r=this._eventThrottleMap.get(e);i-r.last<=1e3?(r.timeoutID&&clearTimeout(r.timeoutID),r.timeoutID=setTimeout((function(){r.last=Date.now(),n._outerEmitter._emit.apply(n._outerEmitter,[e,{name:e,data:n._getEventData(e)}])}),1e3)):(r.last=i,this._outerEmitter._emit.apply(this._outerEmitter,[e,{name:e,data:this._getEventData(e)}]))}else this._eventThrottleMap.set(e,{last:Date.now(),timeoutID:-1}),this._outerEmitter._emit.apply(this._outerEmitter,[e,{name:e,data:this._getEventData(e)}]);else this._outerEmitter._emit.apply(this._outerEmitter,[e,{name:e,data:arguments[1]}])}.bind(this)),this._outerEmitter}},{key:"_getEventData",value:function(e){return e===k.CONVERSATION_LIST_UPDATED?this._moduleMap.get(zn).getLocalConversationList():e===k.FRIEND_LIST_UPDATED?this._moduleMap.get(Hn).getLocalFriendList(!1):e===k.GROUP_LIST_UPDATED?this._moduleMap.get(Bn).getLocalGroupList():e===k.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?this._moduleMap.get(zn).getTotalUnreadMessageCount():void 0}},{key:"getInnerEmitterInstance",value:function(){return null===this._innerEmitter&&(this._innerEmitter=new ws,this._innerEmitter._emit=this._innerEmitter.emit,this._innerEmitter.emit=function(e,t){var n;n=dt(arguments[1])&&arguments[1].data?[e,{name:arguments[0],data:arguments[1].data}]:[e,{name:arguments[0],data:arguments[1]}],this._innerEmitter._emit.apply(this._innerEmitter,n)}.bind(this)),this._innerEmitter}},{key:"hasModule",value:function(e){return this._moduleMap.has(e)}},{key:"getModule",value:function(e){return this._moduleMap.get(e)}},{key:"isReady",value:function(){return this._isReady}},{key:"isIntl",value:function(){return this.getModule(Wn).isIntl()}},{key:"getNotReadyReason",value:function(){return this._reason}},{key:"setNotReadyReason",value:function(e){this._reason=e}},{key:"getErrorMessage",value:function(e,t,n){return this._moduleMap.get(hi).get({key:e,replacement1:t,replacement2:n,isIntl:this.isIntl()})}},{key:"outputWarning",value:function(e,t,n){var i=this.getErrorMessage(e,t,n);i&&He.w(i)}},{key:"onError",value:function(e){var t="code:".concat(e.code," message:").concat(e.message);He.w("Oops! ".concat(t)),new $o("error").setMessage(t).setNetworkType(this.getModule(Jn).getNetworkType()).setLevel("error").end(),this.getOuterEmitterInstance().emit(k.ERROR,e)}},{key:"restartTimer",value:function(){He.l("".concat(this._n,".restartTimer")),this.stopTimer(),this._startTimer(),this.getModule(Bn).restartPolling()}},{key:"getTimerID",value:function(){var e=this._moduleMap.get(oi);return e.isWorkerEnabled()?e.getTimerID():this._checkTimer}},{key:"reset",value:function(){He.l("".concat(this._n,".reset")),Ge();var e,t=E(this._moduleMap);try{for(t.s();!(e=t.n()).done;){var n=v(e.value,2)[1];n.reset&&n.reset()}}catch(a){t.e(a)}finally{t.f()}this._startLoginTs=0,this._initReadyList(),this._isReady=!1,this.stopTimer(),this._outerEmitter.emit(k.SDK_NOT_READY);var i,r=E(this._eventThrottleMap);try{for(r.s();!(i=r.n()).done;){var o=v(i.value,2)[1];o.timeoutID&&clearTimeout(o.timeoutID)}}catch(a){r.e(a)}finally{r.f()}this._eventThrottleMap.clear()}}]),e}(),Gc=function(){function e(t){i(this,e),this._funcMap=new Map,this._m=t}return o(e,[{key:"defense",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if("string"!=typeof e)return null;if(0===e.length)return null;if("function"!=typeof t)return null;if(this._funcMap.has(e)&&this._funcMap.get(e).has(t))return this._funcMap.get(e).get(t);this._funcMap.has(e)||this._funcMap.set(e,new Map);var i=null;return this._funcMap.get(e).has(t)?i=this._funcMap.get(e).get(t):(i=this._pack(e,t,n),this._funcMap.get(e).set(t,i)),i}},{key:"defenseOnce",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return"function"!=typeof t?null:this._pack(e,t,n)}},{key:"find",value:function(e,t){return"string"!=typeof e||0===e.length||"function"!=typeof t?null:this._funcMap.has(e)&&this._funcMap.get(e).has(t)?this._funcMap.get(e).get(t):(this._m.outputWarning("ListenerFnNotFound",e),null)}},{key:"delete",value:function(e,t){return"function"==typeof t&&!!this._funcMap.has(e)&&!!this._funcMap.get(e).has(t)&&(this._funcMap.get(e).delete(t),0===this._funcMap.get(e).size&&this._funcMap.delete(e),!0)}},{key:"_pack",value:function(e,t,n){var i=this;return function(){try{t.apply(n,Array.from(arguments))}catch(s){var r=Object.values(k).indexOf(e),o="CallbackError";if(-1!==r){var a=Object.keys(k)[r];i._m.outputWarning(o,a,s)}new $o(o).setMessage("eventName:".concat(e)).setMoreMessage(s.message).end()}}}}]),e}(),Fc=function(){function e(t){i(this,e);var n={SDKAppID:t.SDKAppID,unlimitedAVChatRoom:t.unlimitedAVChatRoom||!1,scene:t.scene||"",oversea:t.oversea||!1,instanceID:Gt(),devMode:t.devMode||!1,proxyServer:t.proxyServer||void 0,fileUploadProxy:t.fileUploadProxy||void 0,fileDownloadProxy:t.fileDownloadProxy||t.fileUploadProxy||void 0};this._m=new xc(n),this._safetyCallbackFactory=new Gc(this._m)}return o(e,[{key:"onError",value:function(e){this._m.onError(e)}},{key:"login",value:function(e){return this._m.login(),this._getModule(xn).login(e)}},{key:"logout",value:function(){var e=this;return this._getModule(xn).logout().then((function(t){return e._m.reset(),t}))}},{key:"isReady",value:function(){return this._m.isReady()}},{key:"isIntl",value:function(){return this._m.isIntl()}},{key:"getNotReadyReason",value:function(){return this._m.getNotReadyReason()}},{key:"getErrorMessage",value:function(e,t,n){return this._m.getErrorMessage(e,t,n)}},{key:"_getModule",value:function(e){return this._m.getModule(e)}},{key:"destroy",value:function(){var e=this;return this.logout().finally((function(){e._m.stopTimer(),e._getModule(oi).terminate(),e._getModule(ni).dealloc();var t=e._m.getOuterEmitterInstance(),n=e._getModule(Wn);t.emit(k.SDK_DESTROY,{SDKAppID:n.getSDKAppID()})}))}},{key:"on",value:function(e,t,n){He.d("on","eventName:".concat(e)),this._m.getOuterEmitterInstance().on(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"once",value:function(e,t,n){He.d("once","eventName:".concat(e)),this._m.getOuterEmitterInstance().once(e,this._safetyCallbackFactory.defenseOnce(e,t,n),n||this)}},{key:"off",value:function(e,t,n,i){He.d("off","eventName:".concat(e));var r=this._safetyCallbackFactory.find(e,t);null!==r&&(this._m.getOuterEmitterInstance().off(e,r,n,i),this._safetyCallbackFactory.delete(e,t))}},{key:"registerPlugin",value:function(e){ht(e["tim-offline-push-plugin"])?this._getModule(Qn).registerPlugin(e):this._getModule(ui).registerPlugin(e)}},{key:"setLogLevel",value:function(e){e<=0&&(this.getErrorMessage("TIM_ASCII_ART"),this.getErrorMessage("API_REFER")&&Xt(),this.getErrorMessage("DOCS_GUIDE")),He.setLevel(e)}},{key:"createTextMessage",value:function(e){return this._getModule(Gn).createTextMessage(e)}},{key:"createTextAtMessage",value:function(e){return this._getModule(Gn).createTextMessage(e)}},{key:"createImageMessage",value:function(e){return this._getModule(Gn).createImageMessage(e)}},{key:"createAudioMessage",value:function(e){return this._getModule(Gn).createAudioMessage(e)}},{key:"createVideoMessage",value:function(e){return this._getModule(Gn).createVideoMessage(e)}},{key:"createCustomMessage",value:function(e){return this._getModule(Gn).createCustomMessage(e)}},{key:"createFaceMessage",value:function(e){return this._getModule(Gn).createFaceMessage(e)}},{key:"createFileMessage",value:function(e){return this._getModule(Gn).createFileMessage(e)}},{key:"createLocationMessage",value:function(e){return this._getModule(Gn).createLocationMessage(e)}},{key:"createMergerMessage",value:function(e){return this._getModule(Gn).createMergerMessage(e)}},{key:"downloadMergerMessage",value:function(e){return e.type!==b.MSG_MERGER?va({code:No.MESSAGE_MERGER_TYPE_INVALID}):tn(e.payload.downloadKey)?va({code:No.MESSAGE_MERGER_KEY_INVALID}):this._getModule(Gn).downloadMergerMessage(e).catch((function(e){return va({code:No.MESSAGE_MERGER_DOWNLOAD_FAIL})}))}},{key:"createForwardMessage",value:function(e){return this._getModule(Gn).createForwardMessage(e)}},{key:"sendMessage",value:function(e,t){return e instanceof da?this._getModule(Gn).sendMessageInstance(e,t):va({code:No.MESSAGE_SEND_NEED_MESSAGE_INSTANCE})}},{key:"callExperimentalAPI",value:function(e,t){return"sendComboMessage"===e?this._getModule(pi).sendMessage(t):"handleGroupInvitation"===e?this._getModule(Bn).handleGroupInvitation(t):"isCommercialAbilityEnabled"===e?this._getModule(ci).isFeatureEnabled(t):"isIntl"===e?this.isIntl():"sendTRTCCustomData"===e?this._getModule(di).sendTRTCCustomData(t):"getTimerID"===e?this._m.getTimerID():va({code:No.INVALID_OPERATION})}},{key:"revokeMessage",value:function(e){return this._getModule(Gn).revokeMessage(e)}},{key:"resendMessage",value:function(e){return this._getModule(Gn).resendMessage(e)}},{key:"deleteMessage",value:function(e){return this._getModule(Gn).deleteMessage(e)}},{key:"translateText",value:function(e){return this._getModule(Gn).translateText(e)}},{key:"setMessageExtensions",value:function(e,t){return this._getModule(Fn).setMessageExtensions(e,t)}},{key:"getMessageExtensions",value:function(e){return this._getModule(Fn).getMessageExtensions(e)}},{key:"deleteMessageExtensions",value:function(e,t){return this._getModule(Fn).deleteMessageExtensions(e,t)}},{key:"modifyMessage",value:function(e){return this._getModule(Gn).modifyRemoteMessage(e)}},{key:"getMessageList",value:function(e){return this._getModule(zn).getMessageList(e)}},{key:"getMessageListHopping",value:function(e){return this._getModule(zn).getMessageListHopping(e)}},{key:"sendMessageReadReceipt",value:function(e){return this._getModule(zn).sendReadReceipt(e)}},{key:"getMessageReadReceiptList",value:function(e){return this._getModule(zn).getReadReceiptList(e)}},{key:"getGroupMessageReadMemberList",value:function(e){return this._getModule(Bn).getReadReceiptDetail(e)}},{key:"findMessage",value:function(e){return this._getModule(zn).findMessage(e)}},{key:"setMessageRead",value:function(e){return this._getModule(zn).setMessageRead(e)}},{key:"getConversationList",value:function(e){return this._getModule(zn).getConversationList(e)}},{key:"getConversationProfile",value:function(e){return this._getModule(zn).getConversationProfile(e)}},{key:"deleteConversation",value:function(e){return this._getModule(zn).deleteConversation(e)}},{key:"clearHistoryMessage",value:function(e){return this._getModule(zn).clearHistoryMessage(e)}},{key:"pinConversation",value:function(e){return this._getModule(zn).pinConversation(e)}},{key:"setAllMessageRead",value:function(e){return this._getModule(zn).setAllMessageRead(e)}},{key:"setMessageRemindType",value:function(e){return this._getModule(zn).setMessageRemindType(e)}},{key:"getTotalUnreadMessageCount",value:function(){return this._getModule(zn).getTotalUnreadMessageCount()}},{key:"setConversationCustomData",value:function(e){return this._getModule(zn).setConversationCustomData(e)}},{key:"markConversation",value:function(e){return this._getModule(zn).markConversation(e)}},{key:"getConversationGroupList",value:function(){return this._getModule(zn).getConversationGroupList()}},{key:"createConversationGroup",value:function(e){return this._getModule(zn).createConversationGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._getModule(zn).deleteConversationGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._getModule(zn).renameConversationGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._getModule(zn).addConversationsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._getModule(zn).deleteConversationsFromGroup(e)}},{key:"getMyProfile",value:function(){return this._getModule(Vn).getMyProfile()}},{key:"getUserProfile",value:function(e){return this._getModule(Vn).getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._getModule(Vn).updateMyProfile(e)}},{key:"getBlacklist",value:function(){return this._getModule(Vn).getLocalBlacklist()}},{key:"addToBlacklist",value:function(e){return this._getModule(Vn).addBlacklist(e)}},{key:"removeFromBlacklist",value:function(e){return this._getModule(Vn).deleteBlacklist(e)}},{key:"setSelfStatus",value:function(e){return this._getModule(Vn).setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._getModule(Vn).getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._getModule(Vn).subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._getModule(Vn).unsubscribeUserStatus(e)}},{key:"getFriendList",value:function(){var e=this._getModule(Hn);return e?e.getLocalFriendList():va({code:No.CANNOT_FIND_MODULE})}},{key:"addFriend",value:function(e){var t=this._getModule(Hn);return t?t.addFriend(e):va({code:No.CANNOT_FIND_MODULE})}},{key:"deleteFriend",value:function(e){var t=this._getModule(Hn);return t?t.deleteFriend(e):va({code:No.CANNOT_FIND_MODULE})}},{key:"checkFriend",value:function(e){var t=this._getModule(Hn);return t?t.checkFriend(e):va({code:No.CANNOT_FIND_MODULE})}},{key:"getFriendProfile",value:function(e){var t=this._getModule(Hn);return t?t.getFriendProfile(e):va({code:No.CANNOT_FIND_MODULE})}},{key:"updateFriend",value:function(e){var t=this._getModule(Hn);return t?t.updateFriend(e):va({code:No.CANNOT_FIND_MODULE})}},{key:"getFriendApplicationList",value:function(){var e=this._getModule(Hn);return e?e.getLocalFriendApplicationList():va({code:No.CANNOT_FIND_MODULE})}},{key:"acceptFriendApplication",value:function(e){var t=this._getModule(Hn);return t?t.acceptFriendApplication(e):va({code:No.CANNOT_FIND_MODULE})}},{key:"refuseFriendApplication",value:function(e){var t=this._getModule(Hn);return t?t.refuseFriendApplication(e):va({code:No.CANNOT_FIND_MODULE})}},{key:"deleteFriendApplication",value:function(e){var t=this._getModule(Hn);return t?t.deleteFriendApplication(e):va({code:No.CANNOT_FIND_MODULE})}},{key:"setFriendApplicationRead",value:function(){var e=this._getModule(Hn);return e?e.setFriendApplicationRead():va({code:No.CANNOT_FIND_MODULE})}},{key:"getFriendGroupList",value:function(){var e=this._getModule(Hn);return e?e.getLocalFriendGroupList():va({code:No.CANNOT_FIND_MODULE})}},{key:"createFriendGroup",value:function(e){var t=this._getModule(Hn);return t?t.createFriendGroup(e):va({code:No.CANNOT_FIND_MODULE})}},{key:"deleteFriendGroup",value:function(e){var t=this._getModule(Hn);return t?t.deleteFriendGroup(e):va({code:No.CANNOT_FIND_MODULE})}},{key:"addToFriendGroup",value:function(e){var t=this._getModule(Hn);return t?t.addToFriendGroup(e):va({code:No.CANNOT_FIND_MODULE})}},{key:"removeFromFriendGroup",value:function(e){var t=this._getModule(Hn);return t?t.removeFromFriendGroup(e):va({code:No.CANNOT_FIND_MODULE})}},{key:"renameFriendGroup",value:function(e){var t=this._getModule(Hn);return t?t.renameFriendGroup(e):va({code:No.CANNOT_FIND_MODULE})}},{key:"getGroupList",value:function(e){return this._getModule(Bn).getGroupList(e)}},{key:"getGroupProfile",value:function(e){return this._getModule(Bn).getGroupProfile(e)}},{key:"createGroup",value:function(e){return this._getModule(Bn).createGroup(e)}},{key:"dismissGroup",value:function(e){return this._getModule(Bn).dismissGroup(e)}},{key:"updateGroupProfile",value:function(e){return this._getModule(Bn).updateGroupProfile(e)}},{key:"joinGroup",value:function(e){return this._getModule(Bn).joinGroup(e)}},{key:"quitGroup",value:function(e){return this._getModule(Bn).quitGroup(e)}},{key:"searchGroupByID",value:function(e){return this._getModule(Bn).searchGroupByID(e)}},{key:"getGroupOnlineMemberCount",value:function(e){return this._getModule(Bn).getGroupOnlineMemberCount(e)}},{key:"changeGroupOwner",value:function(e){return this._getModule(Bn).changeGroupOwner(e)}},{key:"getGroupApplicationList",value:function(){return this._getModule(Bn).getGroupApplicationList()}},{key:"handleGroupApplication",value:function(e){return this._getModule(Bn).handleGroupApplication(e)}},{key:"initGroupAttributes",value:function(e){return this._getModule(Bn).initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._getModule(Bn).setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._getModule(Bn).deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._getModule(Bn).getGroupAttributes(e)}},{key:"setGroupCounters",value:function(e){return this._getModule(Bn).setGroupCounters(e)}},{key:"increaseGroupCounter",value:function(e){return this._getModule(Bn).increaseGroupCounter(e)}},{key:"decreaseGroupCounter",value:function(e){return this._getModule(Bn).decreaseGroupCounter(e)}},{key:"getGroupCounters",value:function(e){return this._getModule(Bn).getGroupCounters(e)}},{key:"getGroupMemberList",value:function(e){return this._getModule(jn).getGroupMemberList(e)}},{key:"getGroupMemberProfile",value:function(e){return this._getModule(jn).getGroupMemberProfile(e)}},{key:"addGroupMember",value:function(e){return this._getModule(jn).addGroupMember(e)}},{key:"deleteGroupMember",value:function(e){return this._getModule(jn).deleteGroupMember(e)}},{key:"setGroupMemberMuteTime",value:function(e){return this._getModule(jn).setGroupMemberMuteTime(e)}},{key:"setGroupMemberRole",value:function(e){return this._getModule(jn).setGroupMemberRole(e)}},{key:"setGroupMemberNameCard",value:function(e){return this._getModule(jn).setGroupMemberNameCard(e)}},{key:"setGroupMemberCustomField",value:function(e){return this._getModule(jn).setGroupMemberCustomField(e)}},{key:"markGroupMemberList",value:function(e){return this._getModule(jn).markGroupMemberList(e)}},{key:"getJoinedCommunityList",value:function(){return this._getModule(Kn).getJoinedCommunityList()}},{key:"createTopicInCommunity",value:function(e){return this._getModule(Kn).createTopicInCommunity(e)}},{key:"deleteTopicFromCommunity",value:function(e){return this._getModule(Kn).deleteTopicFromCommunity(e)}},{key:"updateTopicProfile",value:function(e){return this._getModule(Kn).updateTopicProfile(e)}},{key:"getTopicList",value:function(e){return this._getModule(Kn).getTopicList(e)}}]),e}(),Vc={login:1,logout:1,destroy:1,on:1,off:1,ready:1,setLogLevel:1,joinGroup:1,quitGroup:1,registerPlugin:1,getGroupOnlineMemberCount:1};function qc(e,t){if(e.isReady()||1===Vc[t])return!0;var n=e.getNotReadyReason(),i={code:n,message:"".concat(e.getErrorMessage(n)," | ").concat(t," | ").concat(e.getErrorMessage(No.SDK_IS_NOT_READY))};return e.onError(i),i}var Bc={},Hc={create:function(e){var n=0,i=e.SDKAppID;if(ct(i))n=i;else if(n=parseInt(i),isNaN(i))return He.e("".concat("TIM.create"," failed. Failed to parse the SDKAppID, please check the arguments")),null;if(n&&Bc[n])return Bc[n];He.l("".concat("TIM.create"));var r=new Fc(t(t({},e),{},{SDKAppID:n}));r.on(k.SDK_DESTROY,(function(e){Bc[e.data.SDKAppID]=null,delete Bc[e.data.SDKAppID]}));var o,a,s=(o=r,a=Object.create(null),Object.keys(Un).forEach((function(e){if(o[e]){var t=new D;a[e]=function(){var n=Array.from(arguments);return t.use((function(t,n){var i=qc(o,e);return!0===i?n():va(i)})).use((function(t,n){if(!0===nn(t,Pn[e],e))return n()})).use((function(t,n){return o[e].apply(o,t)})),t.run(n)}}})),a);return Bc[n]=s,Pn.hookGetAPITips(r.getErrorMessage.bind(r)),He.l("".concat("TIM.create"," ok")),s}};return Hc.TYPES=b,Hc.EVENT=k,Hc.VERSION="2.27.1",He.l("TIM.VERSION:".concat(Hc.VERSION)),Hc}();const er={typeC2C:"isC2C",typeGroup:"isGroup",cancel:"cancel",group:"GROUP",handleMessage:{revoke:"revoke",copy:"copy",delete:"delete",forward:"forward",reply:"reply",reference:"reference"},at:"@",all:"所有人",typeText:1,typeCustom:2,typeImage:3,typeAudio:4,typeVideo:5,typeFile:6,typeFace:8,typeForward:"forward",typeMute:"mute",typeOrder:"order",typeService:"consultion",typeReply:"quick_reply",typeEvaluate:"evaluation",typeTextLink:"text_link",typeAndroid:"android",typeIphone:"iphone",typeMini:"miniprogram",typeUserTyping:"user_typing_status",typeInputStatusIng:"EIMAMSG_InputStatus_Ing",typeInputStatusEnd:"EIMAMSG_InputStatus_End",scrollType:{toBottom:"bottom",toTarget:"target"},inViewType:{page:"page",scroll:"scroll"},TYPE_CALL_MESSAGE:1,CALL_ACTION_TYPE:{INVITE:1,CANCEL_INVITE:2,ACCEPT_INVITE:3,REJECT_INVITE:4,INVITE_TIMEOUT:5}};function tr(e){var t,n,i,r,o,a;let s="";switch(e.type){case Qi.TYPES.CONV_C2C:s=mr(null==(t=null==e?void 0:e.userProfile)?void 0:t.avatar)?null==(n=null==e?void 0:e.userProfile)?void 0:n.avatar:"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png";break;case Qi.TYPES.CONV_GROUP:s=mr(null==(i=null==e?void 0:e.groupProfile)?void 0:i.avatar)?null==(r=null==e?void 0:e.groupProfile)?void 0:r.avatar:"https://web.sdk.qcloud.com/im/demo/TUIkit/web/img/constomer.svg";break;case Qi.TYPES.CONV_SYSTEM:s=mr(null==(o=null==e?void 0:e.groupProfile)?void 0:o.avatar)?null==(a=null==e?void 0:e.groupProfile)?void 0:a.avatar:"https://web.sdk.qcloud.com/component/TUIKit/assets/group_avatar.png"}return s}function nr(e){var t,n;const{t:i}=window.TUIKitTUICore.config.i18n.useI18n();let r="";switch(e.type){case Qi.TYPES.CONV_C2C:r=(null==e?void 0:e.userProfile.nick)||(null==(t=null==e?void 0:e.userProfile)?void 0:t.userID)||"";break;case Qi.TYPES.CONV_GROUP:r=e.groupProfile.name||(null==(n=null==e?void 0:e.groupProfile)?void 0:n.groupID)||"";break;case Qi.TYPES.CONV_SYSTEM:r=i("系统通知")}return r}function ir(e){var t,n,i,r,o,a,s,c,u;const{t:l}=window.TUIKitTUICore.config.i18n.useI18n(),d={message:e,text:""};let p=(null==e?void 0:e.nick)||(null==(n=null==(t=null==e?void 0:e.payload)?void 0:t.userIDList)?void 0:n.join(","));if((null==(r=null==(i=null==e?void 0:e.payload)?void 0:i.memberList)?void 0:r.length)>0&&(p="",null==(a=null==(o=null==e?void 0:e.payload)?void 0:o.memberList)||a.map((e=>{p+=`${(null==e?void 0:e.nick)||(null==e?void 0:e.userID)},`})),p=null==p?void 0:p.slice(0,-1)),(null==e?void 0:e.type)===(null==(s=null==Qi?void 0:Qi.TYPES)?void 0:s.MSG_GRP_TIP))switch(e.payload.operationType){case Qi.TYPES.GRP_TIP_MBR_JOIN:d.text=`${p} ${l("message.tip.加入群组")}`;break;case Qi.TYPES.GRP_TIP_MBR_QUIT:d.text=`${l("message.tip.群成员")}：${p} ${l("message.tip.退出群组")}`;break;case Qi.TYPES.GRP_TIP_MBR_KICKED_OUT:d.text=`${l("message.tip.群成员")}：${p} ${l("message.tip.被")}${e.payload.operatorID}${l("message.tip.踢出群组")}`;break;case Qi.TYPES.GRP_TIP_MBR_SET_ADMIN:d.text=`${l("message.tip.群成员")}：${p} ${l("message.tip.成为管理员")}`;break;case Qi.TYPES.GRP_TIP_MBR_CANCELED_ADMIN:d.text=`${l("message.tip.群成员")}：${p} ${l("message.tip.被撤销管理员")}`;break;case Qi.TYPES.GRP_TIP_GRP_PROFILE_UPDATED:d.text=function(e){const{t:t}=window.TUIKitTUICore.config.i18n.useI18n(),{payload:n}=e,{newGroupProfile:i}=n,{operatorID:r}=n;let o="";const a=Object.keys(i)[0];switch(a){case"muteAllMembers":o=i[a]?`${t("message.tip.管理员")} ${r} ${t("message.tip.开启全员禁言")}`:`${t("message.tip.管理员")} ${r} ${t("message.tip.取消全员禁言")}`;break;case"ownerID":o=`${i[a]} ${t("message.tip.成为新的群主")}`;break;case"groupName":o=`${r} ${t("message.tip.修改群名为")} ${i[a]}`;break;case"notification":o=`${r} ${t("message.tip.发布新公告")}`}return o}(e);break;case Qi.TYPES.GRP_TIP_MBR_PROFILE_UPDATED:for(const t of e.payload.memberList)t.muteTime>0?d.text=`${l("message.tip.群成员")}：${t.userID}${l("message.tip.被禁言")}`:d.text=`${l("message.tip.群成员")}：${t.userID}${l("message.tip.被取消禁言")}`;break;default:d.text=`[${l("message.tip.群提示消息")}]`}else"group_create"===(null==(c=null==e?void 0:e.payload)?void 0:c.data)?d.text=null==(u=null==e?void 0:e.payload)?void 0:u.extension:d.text=pr(e);return d}function rr(e){return{text:Zi(e.payload)}}function or(e){const t={message:e,name:"",url:""};return t.name=e.payload.data,e.payload.data.indexOf("@2x")<0&&(t.name=`${t.name}@2x`),t.url=`https://web.sdk.qcloud.com/im/assets/face-elem/${t.name}.png`,t}function ar(e){const t={lon:"",lat:"",href:"",url:"",description:"",message:e};return t.lon=e.payload.longitude.toFixed(6),t.lat=e.payload.latitude.toFixed(6),t.href=`https://map.qq.com/?type=marker&isopeninfowin=1&markertype=1&pointx=${t.lon}&pointy=${t.lat}&name=${e.payload.description}`,t.url=`https://apis.map.qq.com/ws/staticmap/v2/?center=${t.lat},${t.lon}&zoom=10&size=300*150&maptype=roadmap&markers=size:large|color:0xFFCCFF|label:k|${t.lat},${t.lon}&key=UBNBZ-PTP3P-TE7DB-LHRTI-Y4YLE-VWBBD`,t.description=e.payload.description,t}function sr(e){return{progress:"unSend"===(null==e?void 0:e.status)&&e.progress,url:e.payload.imageInfoArray[1].url,width:e.payload.imageInfoArray[0].width,height:e.payload.imageInfoArray[0].height,message:e}}function cr(e){var t,n,i,r;return{progress:"unSend"===(null==e?void 0:e.status)&&(null==e?void 0:e.progress),url:null==(t=null==e?void 0:e.payload)?void 0:t.videoUrl,snapshotUrl:null==(n=null==e?void 0:e.payload)?void 0:n.snapshotUrl,snapshotWidth:null==(i=null==e?void 0:e.payload)?void 0:i.snapshotWidth,snapshotHeight:null==(r=null==e?void 0:e.payload)?void 0:r.snapshotHeight,message:e}}function ur(e){return{progress:"unSend"===(null==e?void 0:e.status)&&e.progress,url:e.payload.url,message:e,second:e.payload.second}}function lr(e){let t="";return t=e.payload.fileSize>=1048576?`${(e.payload.fileSize/1048576).toFixed(2)} Mb`:e.payload.fileSize>=1024?`${(e.payload.fileSize/1024).toFixed(2)} Kb`:`${e.payload.fileSize.toFixed(2)}B`,{progress:"unSend"===(null==e?void 0:e.status)&&e.progress,url:e.payload.fileUrl,message:e,name:e.payload.fileName,size:t}}function dr(e){return{message:e,...e.payload}}function pr(e){var t,n;const{t:i}=window.TUIKitTUICore.config.i18n.useI18n();let r={},o={};try{r=vr(null==(t=null==e?void 0:e.payload)?void 0:t.data)}catch(c){r={}}if(1!==r.businessID)return"";try{o=vr(r.data)}catch(c){o={}}let a="";null==(n=null==r?void 0:r.inviteeList)||n.forEach(((e,t)=>{var n;t<(null==(n=null==r?void 0:r.inviteeList)?void 0:n.length)-1?a+=`"${e}"、`:a+=`"${e}" `}));const s=`"${null==r?void 0:r.inviter}" `;switch(r.actionType){case 1:return o.call_end>=0&&!r.groupID?`${i("message.custom.通话时长")}：${function(e){const t=e;let n,i,r,o;return t>=3600?(i=parseInt(""+t/3600,10)<10?`0${parseInt(""+t/3600,10)}`:parseInt(""+t/3600,10),r=parseInt(""+t%60/60,10)<10?`0${parseInt(""+t%60/60,10)}`:parseInt(""+t%60/60,10),o=t%3600<10?"0"+t%3600:t%3600,o>60&&(r=parseInt(""+o/60,10)<10?`0${parseInt(""+o/60,10)}`:parseInt(""+o/60,10),o=o%60<10?"0"+o%60:o%60),n=`${i}:${r}:${o}`):t>=60&&t<3600?(r=parseInt(""+t/60,10)<10?`0${parseInt(""+t/60,10)}`:parseInt(""+t/60,10),o=t%60<10?"0"+t%60:t%60,n=`00:${r}:${o}`):t<60&&(o=t<10?`0${t}`:t,n=`00:00:${o}`),n}(o.call_end)}`:r.groupID&&r.timeout>0?`${s}${i("message.custom.发起通话")}`:r.groupID?`${i("message.custom.结束群聊")}`:o.data&&"switchToAudio"===o.data.cmd?`${i("message.custom.切换语音通话")}`:o.data&&"switchToVideo"===o.data.cmd?`${i("message.custom.切换视频通话")}`:`${i("message.custom.发起通话")}`;case 2:return`${r.groupID?s:""}${i("message.custom.取消通话")}`;case 3:return o.data&&"switchToAudio"===o.data.cmd?`${i("message.custom.切换语音通话")}`:o.data&&"switchToVideo"===o.data.cmd?`${i("message.custom.切换视频通话")}`:`${r.groupID?a:""}${i("message.custom.已接听")}`;case 4:return`${r.groupID?a:""}${i("message.custom.拒绝通话")}`;case 5:return o.data&&"switchToAudio"===o.data.cmd?`${i("message.custom.切换语音通话")}`:o.data&&"switchToVideo"===o.data.cmd?`${i("message.custom.切换视频通话")}`:`${r.groupID?a:""}${i("message.custom.无应答")}`;default:return""}}function hr(e){const{t:t}=window.TUIKitTUICore.config.i18n.useI18n();return{message:e,custom:pr(e)||`[${t("message.custom.自定义消息")}]`}}function fr(e){const{t:t}=window.TUIKitTUICore.config.i18n.useI18n(),n=e.payload.groupProfile.name||e.payload.groupProfile.groupID;switch(e.payload.operationType){case 1:return`${e.payload.operatorID} ${t("message.tip.申请加入群组")}：${n}`;case 2:return`${t("message.tip.成功加入群组")}：${n}`;case 3:return`${t("message.tip.申请加入群组")}：${n} ${t("message.tip.被拒绝")}`;case 4:return`${t("message.tip.你被管理员")}${e.payload.operatorID} ${t("message.tip.踢出群组")}：${n}`;case 5:return`${t("message.tip.群")}：${n} ${t("message.tip.被")} ${e.payload.operatorID} ${t("message.tip.解散")}`;case 6:return`${e.payload.operatorID} ${t("message.tip.创建群")}：${n}`;case 7:case 12:return`${e.payload.operatorID} ${t("message.tip.邀请你加群")}：${n}`;case 8:return`${t("message.tip.你退出群组")}：${n}`;case 9:return`${t("message.tip.你被")}${e.payload.operatorID} ${t("message.tip.设置为群")}：${n} ${t("message.tip.的管理员")}`;case 10:return`${t("message.tip.你被")}${e.payload.operatorID} ${t("message.tip.撤销群")}：${n} ${t("message.tip.的管理员身份")}`;case 13:return`${e.payload.operatorID} ${t("message.tip.同意加群")}：${n}`;case 14:return`${e.payload.operatorID} ${t("message.tip.拒接加群")}：${n}`;case 255:return`${t("message.tip.自定义群系统通知")}: ${e.payload.userDefinedField}`}}function gr(e,t,n){const i=(null==e?void 0:e.querySelectorAll(`.${t}`))||[],r=Array.prototype.slice.call(i).map((e=>new Promise(((t,n)=>{e.onload=()=>{t(e)},e.onloadeddata=()=>{t(e)},e.onprogress=()=>{t(e)},e.complete&&t(e)}))));return Promise.all(r).then((()=>{n&&n()})).catch((e=>{}))}function mr(e){return/^(https?:\/\/(([a-zA-Z0-9]+-?)+[a-zA-Z0-9]+\.)+[a-zA-Z]+)(:\d+)?(\/.*)?(\?.*)?(#.*)?$/.test(e)}function vr(e){return e&&function(e){if("string"==typeof e)try{return!!JSON.parse(e)}catch(t){return!1}return!1}(e)?JSON.parse(e):e}function _r(e){var t;if(!e)return!1;try{const{businessID:n}=vr(null==(t=null==e?void 0:e.payload)?void 0:t.data);if(n===er.typeUserTyping)return!0}catch{return!1}return!1}function yr(e,t=new WeakMap){if("object"!=typeof e||null===e)throw new TypeError("传入参数不是对象");if(t.has(e))return t.get(e);const n=Object.create(Object.getPrototypeOf(e));return Object.keys(e).forEach((i=>{const r=e[i];"object"!=typeof r||null===r?n[i]=r:Array.isArray(r)?n[i]=[...r]:r instanceof Set?n[i]=new Set([...r]):r instanceof Map?n[i]=new Map([...r]):(t.set(e,e),n[i]=yr(r,t))})),n}const Ir=e=>{var t,n,i,r,o,a;return!!((null==e?void 0:e.type)===(null==(t=null==Qi?void 0:Qi.TYPES)?void 0:t.MSG_GRP_TIP)||(null==e?void 0:e.type)===(null==(n=null==Qi?void 0:Qi.TYPES)?void 0:n.MSG_CUSTOM)&&(null==e?void 0:e.conversationType)===(null==(i=null==Qi?void 0:Qi.TYPES)?void 0:i.CONV_GROUP)&&(null==er?void 0:er.TYPE_CALL_MESSAGE)||(null==e?void 0:e.type)===(null==(r=null==Qi?void 0:Qi.TYPES)?void 0:r.MSG_CUSTOM)&&(null==e?void 0:e.conversationType)===(null==(o=null==Qi?void 0:Qi.TYPES)?void 0:o.CONV_GROUP)&&"group_create"===(null==(a=null==e?void 0:e.payload)?void 0:a.data))},Mr=(e,t,n,i)=>e<=n&&t<=i?{width:e,height:t}:e<=n&&t>i||e>n&&t>i&&e/t<=n/i?{width:e*(i/t),height:i}:{width:n,height:t*(n/e)};class Tr{constructor(e){this.allowNotifications=!0,this.showPreviews=!0,this.notificationTitle="腾讯云 IM ",this.notificationIcon="https://web.sdk.qcloud.com/im/demo/latest/faviconnew.png",e&&(void 0!==(null==e?void 0:e.allowNotifications)&&(this.allowNotifications=e.allowNotifications),void 0!==(null==e?void 0:e.showPreviews)&&(this.showPreviews=e.showPreviews),void 0!==(null==e?void 0:e.notificationTitle)&&(this.notificationTitle=e.notificationTitle),void 0!==(null==e?void 0:e.notificationIcon)&&(this.notificationIcon=e.notificationIcon))}static getInstance(e){return Tr.instance||(Tr.instance=new Tr(e)),Tr.instance}static plugin(e,t){e.config.notification=this.getInstance(t),this.TUICore=e}static install(e){e.use(this.getInstance())}setNotificationConfiguration(e){e&&(void 0!==(null==e?void 0:e.allowNotifications)&&(this.allowNotifications=e.allowNotifications),void 0!==(null==e?void 0:e.showPreviews)&&(this.showPreviews=e.showPreviews),void 0!==(null==e?void 0:e.notificationTitle)&&(this.notificationTitle=e.notificationTitle),void 0!==(null==e?void 0:e.notificationIcon)&&(this.notificationIcon=e.notificationIcon))}async notify(e){this.allowNotifications&&this.checkNotificationAbility()&&await this.requestNotificationPermission()&&await this.handleNotification(e)}checkNotificationAbility(){return"Notification"in window&&"denied"!==window.Notification.permission}requestNotificationPermission(){return new Promise(((e,t)=>{(null==window?void 0:window.Notification)||t(!1),"granted"===window.Notification.permission&&e(!0),window.Notification.requestPermission().then((t=>{"granted"===t&&e(!0)})).catch((()=>{t(!1)}))}))}async handleNotification(e){if(!this._isMessageNeedNotification(e))return;const t=this._handleNotificationType(e);let n,i={badge:this.notificationIcon,icon:this.notificationIcon,body:"",requireInteraction:!1};switch(t){case"call":if(n=this._handleCallNotificationContent(e),!(null==n?void 0:n.content))return;i.body=n.content,i.requireInteraction=!n.callEnd;break;case"chat":i.body=await this._handleChatNotificationContent(e),i.requireInteraction=!1}const r=new Notification(this.notificationTitle,i);r.onclick=()=>{var t,n;if(window.focus(),!e||!(null==e?void 0:e.conversationID))return;const i=null==(n=null==(t=null==Tr?void 0:Tr.TUICore)?void 0:t.TUIServer)?void 0:n.TUIConversation;(null==e?void 0:e.conversationType)!==Qi.TYPES.CONV_C2C&&(null==e?void 0:e.conversationType)!==Qi.TYPES.CONV_GROUP||null==i||i.getConversationProfile(null==e?void 0:e.conversationID).then((e=>{var t,n;(null==(t=null==e?void 0:e.data)?void 0:t.conversation)&&i.handleCurrentConversation(null==(n=null==e?void 0:e.data)?void 0:n.conversation)})),r.close()}}_isMessageNeedNotification(e){var t,n,i,r;if(!e||!(null==e?void 0:e.ID)||!(null==e?void 0:e.type)||(null==e?void 0:e.isRevoked)||(null==e?void 0:e.isDeleted)||_r&&_r(e))return!1;if((null==e?void 0:e.type)===Qi.TYPES.MSG_GRP_TIP||(null==e?void 0:e.type)===Qi.TYPES.MSG_GRP_SYS_NOTICE)return!1;const o=null==(r=null==(i=null==(n=null==(t=null==Tr?void 0:Tr.TUICore)?void 0:t.TUIServer)?void 0:n.TUIConversation)?void 0:i.currentStore)?void 0:r.currentConversationID;return!this.checkPageFocus()||(null==e?void 0:e.conversationID)!==o}_handleNotificationType(e){var t;if(e.type===Qi.TYPES.MSG_CUSTOM){const n=vr(null==(t=null==e?void 0:e.payload)?void 0:t.data);if(1===(null==n?void 0:n.businessID)||"av_call"===(null==n?void 0:n.businessID))return"call"}return"chat"}async _handleChatNotificationContent(e){var t,n;let i="";if(!e||!(null==e?void 0:e.ID)||!(null==e?void 0:e.type))return i;switch(this.showPreviews){case!0:i=await this._handleChatNotificationContentTitle(e),i+=this._handleChatNotificationContentText(e);break;case!1:i="您有"+await(null==(n=null==(t=null==Tr?void 0:Tr.TUICore)?void 0:t.tim)?void 0:n.getTotalUnreadMessageCount())+"条新消息"}return i}async _handleChatNotificationContentTitle(e){var t,n,i;let r="";switch(null==e?void 0:e.conversationType){case Qi.TYPES.CONV_C2C:r=((null==e?void 0:e.nick)||(null==e?void 0:e.from))+": ";break;case Qi.TYPES.CONV_GROUP:r=(null==e?void 0:e.conversationID)+": ",await(null==(i=null==(n=null==(t=null==Tr?void 0:Tr.TUICore)?void 0:t.tim)?void 0:n.getConversationProfile(null==e?void 0:e.conversationID))?void 0:i.then((t=>{var n,i,o;r=((null==(o=null==(i=null==(n=null==t?void 0:t.data)?void 0:n.conversation)?void 0:i.groupProfile)?void 0:o.name)||(null==e?void 0:e.conversationID))+": "})).catch((()=>{r=(null==e?void 0:e.conversationID)+": "})));break;case Qi.TYPES.CONV_SYSTEM:r="系统消息: "}return r}_handleChatNotificationContentText(e){var t;let n="";switch(e.type){case Qi.TYPES.MSG_TEXT:n+=null==(t=null==e?void 0:e.payload)?void 0:t.text;break;case Qi.TYPES.MSG_CUSTOM:n+="[自定义消息]";break;case Qi.TYPES.MSG_IMAGE:n+="[图片]";break;case Qi.TYPES.MSG_AUDIO:n+="[语音]";break;case Qi.TYPES.MSG_VIDEO:n+="[视频]";break;case Qi.TYPES.MSG_FILE:n+="[文件]";break;case Qi.TYPES.MSG_FACE:n+="[表情]";break;case Qi.TYPES.MSG_MERGER:n+="[聊天记录]";break;case Qi.TYPES.MSG_LOCATION:n+="[位置]"}return n}_handleCallNotificationContent(e){var t;let n="",i=!1;try{if(e.type===Qi.TYPES.MSG_CUSTOM){const r=vr(null==(t=null==e?void 0:e.payload)?void 0:t.data),o=vr(r.data);1===(null==r?void 0:r.businessID)&&(1===r.actionType&&(r.groupID&&r.timeout>0||!r.call_end&&0!==r.call_end&&!r.groupID&&(!(null==o?void 0:o.data)||"switchToAudio"!==(null==o?void 0:o.data.cmd)&&"switchToVideo"!==(null==o?void 0:o.data.cmd)))?(n=this.showPreviews?`${r.inviter} 发起通话`:"您有一个通话请求",i=!1):2===r.actionType&&(n=this.showPreviews?`${r.inviter} 取消通话`:"通话取消",i=!0))}}catch(r){}return{content:n,callEnd:i}}checkPageFocus(){return document.hasFocus()}}class Cr{destroyed(){}updateStore(e,t){}}class Sr extends Cr{constructor(e){super(),this.currentStore={},this.TUICore=e,this.bindTIMEvent(),this.store=e.setComponentStore("TUIChat",{},this.updateStore.bind(this))}destroyed(){this.unbindTIMEvent()}updateStore(e,t){Object.assign(this.currentStore,e),e.conversation.conversationID?e.conversation.conversationID&&e.conversation.conversationID!==t.conversation.conversationID&&this.render(e.conversation):this.currentStore.messageList=[]}render(e){var t,n,i;if(this.currentStore.isFirstRender=!0,this.currentStore.messageList=[],this.currentStore.readSet.clear(),this.getMessageList({conversationID:e.conversationID,count:15}),e.type===this.TUICore.TIM.TYPES.CONV_GROUP){this.currentStore.userInfo.isGroup=!0;const r={groupID:e.groupProfile.groupID,userIDList:[e.groupProfile.selfInfo.userID]};this.getGroupProfile({groupID:e.groupProfile.groupID}),this.getGroupMemberProfile(r).then((e=>{const{memberList:t}=e.data,[n]=t;this.currentStore.selfInfo=n})),null==(i=null==(n=null==(t=null==this?void 0:this.TUICore)?void 0:t.TUIServer)?void 0:n.TUIGroup)||i.getGroupMemberList({groupID:e.groupProfile.groupID,count:100,offset:0}).then((e=>{var t;this.currentStore.allMemberList=null==(t=e.data)?void 0:t.memberList}))}else this.currentStore.userInfo.isGroup=!1,this.currentStore.userInfo.list=[null==e?void 0:e.userProfile]}bindTIMEvent(){this.TUICore.tim.on(this.TUICore.TIM.EVENT.MESSAGE_RECEIVED,this.handleMessageReceived,this),this.TUICore.tim.on(this.TUICore.TIM.EVENT.MESSAGE_MODIFIED,this.handleMessageModified,this),this.TUICore.tim.on(this.TUICore.TIM.EVENT.MESSAGE_REVOKED,this.handleMessageRevoked,this),this.TUICore.tim.on(this.TUICore.TIM.EVENT.MESSAGE_READ_BY_PEER,this.handleMessageReadByPeer,this),this.TUICore.tim.on(this.TUICore.TIM.EVENT.GROUP_LIST_UPDATED,this.handleGroupListUpdated,this),this.TUICore.tim.on(this.TUICore.TIM.EVENT.MESSAGE_READ_RECEIPT_RECEIVED,this.handleMessageReadReceiptReceived,this)}unbindTIMEvent(){this.TUICore.tim.off(this.TUICore.TIM.EVENT.MESSAGE_RECEIVED,this.handleMessageReceived),this.TUICore.tim.off(this.TUICore.TIM.EVENT.MESSAGE_MODIFIED,this.handleMessageModified),this.TUICore.tim.off(this.TUICore.TIM.EVENT.MESSAGE_REVOKED,this.handleMessageRevoked),this.TUICore.tim.off(this.TUICore.TIM.EVENT.MESSAGE_READ_BY_PEER,this.handleMessageReadByPeer),this.TUICore.tim.off(this.TUICore.TIM.EVENT.GROUP_LIST_UPDATED,this.handleGroupListUpdated),this.TUICore.tim.off(this.TUICore.TIM.EVENT.MESSAGE_READ_RECEIPT_RECEIVED,this.handleMessageReadReceiptReceived)}handleMessageReceived(e){var t;null==(t=null==e?void 0:e.data)||t.forEach((e=>{var t,n;(null==e?void 0:e.conversationID)===(null==(n=null==(t=null==this?void 0:this.store)?void 0:t.conversation)?void 0:n.conversationID)&&(this.currentStore.messageList=[...this.currentStore.messageList,e]),Tr.getInstance().notify(e)}))}handleMessageModified(e){const t=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=t}handleMessageRevoked(e){const t=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=t}handleMessageReadByPeer(e){const t=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=t}handleGroupListUpdated(e){null==e||e.data.map((e=>{var t,n,i;return(null==e?void 0:e.groupID)===(null==(i=null==(n=null==(t=null==this?void 0:this.store)?void 0:t.conversation)?void 0:n.groupProfile)?void 0:i.groupID)&&(this.store.conversation.groupProfile=e,this.currentStore.conversation={},this.currentStore.conversation=this.store.conversation),e}))}handleMessageReadReceiptReceived(e){const t=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=t}handleMessageOptions(e,t,n,i){var r,o,a,s,c,u;const l={to:"",conversationType:(null==i?void 0:i.type)||this.store.conversation.type,payload:e,needReadReceipt:this.currentStore.needReadReceipt};switch(this.currentStore.needTyping&&(l.cloudCustomData={messageFeature:{needTyping:1,version:1}},l.cloudCustomData=JSON.stringify(l.cloudCustomData)),"file"===t&&n&&(l.onProgress=n),l.conversationType){case this.TUICore.TIM.TYPES.CONV_C2C:l.to=(null==(r=null==i?void 0:i.userProfile)?void 0:r.userID)||(null==(a=null==(o=this.store.conversation)?void 0:o.userProfile)?void 0:a.userID)||"";break;case this.TUICore.TIM.TYPES.CONV_GROUP:l.to=(null==(s=null==i?void 0:i.groupProfile)?void 0:s.groupID)||(null==(u=null==(c=this.store.conversation)?void 0:c.groupProfile)?void 0:u.groupID)||""}return l}handlePromiseCallback(e){return new Promise(((t,n)=>{const i="TUIChat",r=()=>{e&&e(t,n)};this.TUICore.setAwaitFunc(i,r)}))}handlePromiseCallbackRetry(e,t=[],n=function(){return!1}){return new Promise(((i,r)=>{let o=0;!function a(){o++,e().then(i).catch((e=>{o>t.length||n&&n(e)?r(e):setTimeout(a,t[o-1])}))}()}))}handleUploadProgress(e,t){this.currentStore.messageList.map((n=>(n.ID===t.ID&&(n.progress=e),n)))}sendFaceMessage(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=this.handleMessageOptions(e,"face"),i=this.TUICore.tim.createFaceMessage(n);this.currentStore.messageList.push(i);const r=await this.TUICore.tim.sendMessage(i);this.currentStore.messageList=this.currentStore.messageList.map((e=>e.ID===r.data.message.ID?r.data.message:e)),t(r)}catch(i){n(i);const e=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=e}}))}sendImageMessage(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=this.handleMessageOptions({file:e},"file",(e=>{this.handleUploadProgress(e,i)})),i=this.TUICore.tim.createImageMessage(n);i.progress=.01,this.currentStore.messageList.push(i);const r=await this.TUICore.tim.sendMessage(i);this.currentStore.messageList=this.currentStore.messageList.map((e=>e.ID===r.data.message.ID?r.data.message:e)),t(r)}catch(i){n(i);const e=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=e}}))}sendVideoMessage(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=this.handleMessageOptions({file:e},"file",(e=>{this.handleUploadProgress(e,i)})),i=this.TUICore.tim.createVideoMessage(n);i.progress=.01,this.currentStore.messageList.push(i);const r=await this.TUICore.tim.sendMessage(i);this.currentStore.messageList=this.currentStore.messageList.map((e=>e.ID===r.data.message.ID?r.data.message:e)),t(r)}catch(i){n(i);const e=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=e}}))}sendFileMessage(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=this.handleMessageOptions({file:e},"file",(e=>{this.handleUploadProgress(e,i)})),i=this.TUICore.tim.createFileMessage(n);i.progress=.01,this.currentStore.messageList.push(i);const r=await this.TUICore.tim.sendMessage(i);this.currentStore.messageList=this.currentStore.messageList.map((e=>e.ID===r.data.message.ID?r.data.message:e)),t(r)}catch(i){n(i);const e=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=e}}))}sendCustomMessage(e){return this.handlePromiseCallback((async(t,n)=>{try{e.data=JSON.stringify(e.data);const n=this.handleMessageOptions(e,"custom"),i=this.TUICore.tim.createCustomMessage(n);this.currentStore.messageList.push(i);const r=await this.TUICore.tim.sendMessage(i);this.currentStore.messageList=this.currentStore.messageList.map((e=>e.ID===r.data.message.ID?r.data.message:e)),t(r)}catch(i){n(i);const e=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=e}}))}sendLocationMessage(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=this.handleMessageOptions(e,"location"),i=this.TUICore.tim.createLocationMessage(n);this.currentStore.messageList.push(i);t(await this.TUICore.tim.sendMessage(i))}catch(i){n(i);const e=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=e}}))}forwardMessage(e,t){return this.handlePromiseCallback((async(n,i)=>{try{const i=this.handleMessageOptions(e,"forward",{},t),r=this.TUICore.tim.createForwardMessage(i),o=await this.TUICore.tim.sendMessage(r);this.store.conversation.conversationID===o.data.message.conversationID&&this.currentStore.messageList.push(o.data.message),n(o)}catch(r){i(r);const e=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=e}}))}async sendMessageReadReceipt(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.sendMessageReadReceipt(e))}catch(i){n(i)}}))}async getMessageReadReceiptList(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.getMessageReadReceiptList(e))}catch(i){n(i)}}))}async getMessageList(e,t){return this.handlePromiseCallback((async(n,i)=>{try{const i=await this.TUICore.tim.getMessageList(e);i.data.messageList.length&&await this.getMessageReadReceiptList(i.data.messageList),this.currentStore.messageList=t?[...i.data.messageList,...this.currentStore.messageList]:i.data.messageList,this.currentStore.nextReqMessageID=i.data.nextReqMessageID,this.currentStore.isCompleted=i.data.isCompleted,n(i)}catch(r){i(r)}}))}async getHistoryMessageList(){const e={conversationID:this.currentStore.conversation.conversationID,nextReqMessageID:this.currentStore.nextReqMessageID,count:15};this.currentStore.isCompleted||this.getMessageList(e,!0)}sendTextMessage(e,t){return this.handlePromiseCallback((async(n,i)=>{try{const i=this.handleMessageOptions({text:e},"text");let r={};if(i.cloudCustomData)try{r=vr(i.cloudCustomData)}catch{r={}}const o=JSON.stringify(t),a=Object.assign(i,{cloudCustomData:o,...r}),s=this.TUICore.tim.createTextMessage(a);this.currentStore.messageList.push(s);const c=await this.TUICore.tim.sendMessage(s);this.currentStore.messageList=this.currentStore.messageList.map((e=>e.ID===c.data.message.ID?c.data.message:e)),n(c)}catch(r){i(r);const e=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=e}}))}sendTypingMessage(e){return this.handlePromiseCallback((async(t,n)=>{try{e.data=JSON.stringify(e.data);const n=this.handleMessageOptions(e,"custom"),i=this.TUICore.tim.createCustomMessage(n);t(await this.TUICore.tim.sendMessage(i,{onlineUserOnly:!0}))}catch(i){n(i);const e=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=e}}))}sendTextAtMessage(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=this.handleMessageOptions(e,"text"),i=this.TUICore.tim.createTextAtMessage(n);this.currentStore.messageList.push(i);const r=await this.TUICore.tim.sendMessage(i);this.currentStore.messageList=this.currentStore.messageList.map((e=>e.ID===r.data.message.ID?r.data.message:e)),t(r)}catch(i){n(i);const e=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=e}}))}sendMergerMessage(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=this.handleMessageOptions(e,"merger"),i=this.TUICore.tim.createMergerMessage(n);this.currentStore.messageList.push(i);const r=await this.TUICore.tim.sendMessage(i);this.currentStore.messageList=this.currentStore.messageList.map((e=>e.ID===r.data.message.ID?r.data.message:e)),t(r)}catch(i){n(i);const e=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=e}}))}revokeMessage(e){return this.handlePromiseCallback((async(t,n)=>{var i;try{const n=await this.TUICore.tim.revokeMessage(e),r=vr(null==e?void 0:e.cloudCustomData);(null==(i=null==r?void 0:r.messageReply)?void 0:i.messageRootID)&&await this.revokeReplyMessage(e),t(n)}catch(r){n(r);const e=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=e}}))}resendMessage(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=await this.TUICore.tim.resendMessage(e);this.currentStore.messageList=this.currentStore.messageList.filter((t=>t.ID!==e.ID)),this.currentStore.messageList.push(n.data.message),t(n)}catch(i){n(i)}}))}deleteMessage(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.deleteMessage(e));const n=this.currentStore.messageList;this.currentStore.messageList=[],this.currentStore.messageList=n}catch(i){n(i)}}))}modifyMessage(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.modifyMessage(e))}catch(i){null==i||i.code,null==i||i.data;n(i)}}))}replyMessage(e,t){return this.handlePromiseCallbackRetry((()=>this.handlePromiseCallback((async(n,i)=>{var r,o,a,s,c,u;try{const i={messageAbstract:null==(r=null==e?void 0:e.payload)?void 0:r.text,messageSender:null==e?void 0:e.from,messageID:null==e?void 0:e.ID,messageType:null==e?void 0:e.type,messageTime:null==e?void 0:e.time,messageSequence:null==e?void 0:e.sequence,version:1};if(!t){const n=vr(null==e?void 0:e.cloudCustomData),i=null==(o=null==n?void 0:n.messageReply)?void 0:o.messageRootID;t=await(null==(s=null==(a=null==this?void 0:this.currentStore)?void 0:a.messageList)?void 0:s.find((e=>(null==e?void 0:e.ID)===i)))||this.findMessage(i)}const l=(null==t?void 0:t.cloudCustomData)?vr(null==t?void 0:t.cloudCustomData):{messageReplies:{}};(null==(c=null==l?void 0:l.messageReplies)?void 0:c.replies)?l.messageReplies.replies=[...null==(u=null==l?void 0:l.messageReplies)?void 0:u.replies,i]:l.messageReplies={replies:[i],version:1},t.cloudCustomData=JSON.stringify(l);n(this.modifyMessage(t))}catch(l){i(l)}}))),[500,1e3,3e3],(function(e){return!e||2480!==(null==e?void 0:e.code)}))}revokeReplyMessage(e,t){return this.handlePromiseCallbackRetry((()=>this.handlePromiseCallback((async(n,i)=>{var r,o,a,s,c,u;try{if(!t){const n=vr(null==e?void 0:e.cloudCustomData),i=null==(r=null==n?void 0:n.messageReply)?void 0:r.messageRootID;t=await(null==(a=null==(o=null==this?void 0:this.currentStore)?void 0:o.messageList)?void 0:a.find((e=>(null==e?void 0:e.ID)===i)))||this.findMessage(i)}const i=(null==t?void 0:t.cloudCustomData)?vr(null==t?void 0:t.cloudCustomData):{messageReplies:{}};if(null==(s=null==i?void 0:i.messageReplies)?void 0:s.replies){const t=i.messageReplies.replies.findIndex((t=>(null==t?void 0:t.messageID)===(null==e?void 0:e.ID)));null==(u=null==(c=null==i?void 0:i.messageReplies)?void 0:c.replies)||u.splice(t,1)}t.cloudCustomData=JSON.stringify(i);n(this.modifyMessage(t))}catch(l){i(l)}}))),[500,1e3,3e3],(function(e){return!e||2480!==(null==e?void 0:e.code)}))}emojiReact(e,t){return this.handlePromiseCallbackRetry((()=>this.handlePromiseCallback((async(n,i)=>{var r,o,a,s,c,u,l,d,p,h,f,g,m,v,_,y,I,M;try{e&&(null==e?void 0:e.ID)&&t||i();const T=null==(c=null==(s=null==(a=null==(o=null==(r=this.TUICore)?void 0:r.TUIServer)?void 0:o.TUIProfile)?void 0:a.store)?void 0:s.profile)?void 0:c.userID,C=(null==(e=await(null==(l=null==(u=null==this?void 0:this.currentStore)?void 0:u.messageList)?void 0:l.find((t=>(null==t?void 0:t.ID)===(null==e?void 0:e.ID))))||this.findMessage(null==e?void 0:e.ID))?void 0:e.cloudCustomData)?vr(null==e?void 0:e.cloudCustomData):{messageReact:{}};if(null==(d=null==C?void 0:C.messageReact)?void 0:d.reacts)if(null==(p=null==C?void 0:C.messageReact)?void 0:p.reacts[t]){const e=null==(f=null==(h=null==C?void 0:C.messageReact)?void 0:h.reacts[t])?void 0:f.indexOf(T);-1===e?null==(m=null==(g=null==C?void 0:C.messageReact)?void 0:g.reacts[t])||m.push(T):(null==(_=null==(v=null==C?void 0:C.messageReact)?void 0:v.reacts[t])||_.splice(e,1),0===(null==(I=null==(y=null==C?void 0:C.messageReact)?void 0:y.reacts[t])?void 0:I.length)&&(null==(M=null==C?void 0:C.messageReact)||delete M.reacts[t]))}else C.messageReact.reacts[t]=[T];else C.messageReact={reacts:{},version:1},C.messageReact.reacts[t]=[T];e.cloudCustomData=JSON.stringify(C);n(this.modifyMessage(e))}catch(T){i(T)}}))),[500,1e3,3e3],(function(e){return!e||2480!==(null==e?void 0:e.code)}))}findMessage(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.findMessage(e))}catch(i){n(i)}}))}getGroupProfile(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=await this.TUICore.tim.getGroupProfile(e);this.currentStore.conversation.groupProfile=n.data.group,t(n)}catch(i){n(i)}}))}getGroupMemberProfile(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.getGroupMemberProfile(e))}catch(i){n(i)}}))}handleGroupApplication(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.handleGroupApplication(e))}catch(i){n(i)}}))}async getUserProfile(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.getUserProfile({userIDList:e}))}catch(i){n(i)}}))}async getFriendList(){return this.handlePromiseCallback((async(e,t)=>{try{e(await this.TUICore.tim.getFriendList())}catch(n){t(n)}}))}async checkFriend(e,t){return this.handlePromiseCallback((async(n,i)=>{var r,o;try{const i=await this.TUICore.tim.checkFriend({userIDList:[e],type:t});n(null==(o=null==(r=null==i?void 0:i.data)?void 0:r.successUserIDList[0])?void 0:o.relation)}catch(a){i(a)}}))}async getGroupReadMemberList(e,t="",n=15){return this.handlePromiseCallback((async(i,r)=>{try{i(await this.TUICore.tim.getGroupMessageReadMemberList({message:e,filter:0,cursor:t,count:n}))}catch(o){r(o)}}))}async getGroupUnreadMemberList(e,t="",n=15){return this.handlePromiseCallback((async(i,r)=>{try{i(await this.TUICore.tim.getGroupMessageReadMemberList({message:e,filter:1,cursor:t,count:n}))}catch(o){r(o)}}))}async handleMessageSentByMeToView(e){var t,n;(null==e?void 0:e.conversationID)===(null==(n=null==(t=null==this?void 0:this.store)?void 0:t.conversation)?void 0:n.conversationID)&&this.currentStore.messageList.push(e)}bind(e){return this.currentStore=e}}const Er=S({props:{data:{type:Object,default:()=>({})}},setup(e,t){const n=E({data:{}});return k((()=>{n.data=e.data})),{...b(n)}}}),kr={key:0,class:"text-box"},br=["src"];const Dr=D(Er,[["render",function(e,t,n,i,r,o){return w(!0),A(_,null,R(e.data.text,((e,t)=>(w(),A(_,{key:t},["text"===e.name?(w(),A("span",kr,L(e.text),1)):"img"===e.name?(w(),A("img",{key:1,class:"text-img",src:e.src},null,8,br)):O("",!0)],64)))),128)}],["__scopeId","data-v-e2db9b37"]]),wr=S({props:{data:{type:Object,default:()=>({})},isH5:{type:Boolean,default:!1}},emits:["uploading","previewImage"],setup(e,t){const n=E({data:{progress:0},show:!1}),i=f(),r=g((()=>{var e,t,i;const{width:r=0,height:o=0}=null==(i=null==(t=null==(e=n.data)?void 0:e.message)?void 0:t.payload)?void 0:i.imageInfoArray[0];return r>=o}));k((()=>{n.data=e.data,n.data&&N((()=>{var r,o,a;if(n.data.progress)t.emit("uploading");else{const{width:t=0,height:s=0}=n.data;if(0===t||0===s)return;const c=(null==(r=document.getElementById("app"))?void 0:r.clientWidth)||0,u=e.isH5?Math.min(c-180,300):300,l=Mr(t,s,u,u);(null==(o=null==i?void 0:i.value)?void 0:o.style)&&(i.value.style.width=`${l.width}px`),(null==(a=null==i?void 0:i.value)?void 0:a.style)&&(i.value.style.height=`${l.height}px`)}}))}));const o=e=>{const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");null==n||n.drawImage(e,0,0,e.width,e.height);const i=e.src.substring(e.src.lastIndexOf(".")+1).toLowerCase();return t.toDataURL(`image/${i}`,1)};return{...b(n),toggleShow:()=>{n.data.progress||t.emit("previewImage",n.data.message)},skeleton:i,isWidth:r,downloadImage:e=>{const t=document.createElement("a"),n=e.payload.imageInfoArray[0].instanceID;t.setAttribute("download",n);const i=new Image;i.src=e.payload.imageInfoArray[0].url,i.setAttribute("crossOrigin","Anonymous"),i.onload=()=>{t.href=o(i),t.click()}}}}}),Ar=e=>(F("data-v-ed4b993f"),e=e(),V(),e),Rr=["src","width","height"],Lr={key:0,class:"progress"},Or=["value"],Nr={key:0},Pr=["src"],Ur={key:0,class:"dialog-box-h5-footer"},xr=[Ar((()=>P("img",{src:"/assets/close-image-15985c26.png"},null,-1)))],Gr=[Ar((()=>P("img",{src:"/assets/downaload-image-285429cc.png"},null,-1)))];const Fr=D(wr,[["render",function(e,t,n,i,r,o){return w(),A("div",{class:"message-image",onClick:t[6]||(t[6]=x(((...t)=>e.toggleShow&&e.toggleShow(...t)),["self"])),ref:"skeleton"},[P("img",{class:"message-img",src:e.data.url,width:e.data.width,height:e.data.height,style:U(e.isH5?{maxWidth:e.data.width?e.data.width+"px":"calc(100vw - 180px)",maxHeight:e.data.height?e.data.height+"px":"calc(100vw - 180px)"}:{})},null,12,Rr),e.data.progress?(w(),A("div",Lr,[P("progress",{value:e.data.progress,max:"1"},null,8,Or)])):O("",!0),e.show?(w(),A("div",{key:1,class:"dialog",onClick:t[5]||(t[5]=x(((...t)=>e.toggleShow&&e.toggleShow(...t)),["self"]))},[e.isH5?O("",!0):(w(),A("header",Nr,[P("i",{class:"icon icon-close",onClick:t[0]||(t[0]=x(((...t)=>e.toggleShow&&e.toggleShow(...t)),["stop"]))})])),P("div",{class:G(["dialog-box",[e.isH5?"dialog-box-h5":""]]),onClick:t[4]||(t[4]=x(((...t)=>e.toggleShow&&e.toggleShow(...t)),["self"]))},[P("img",{class:G([e.isWidth?"isWidth":"isHeight"]),src:e.data.message.payload.imageInfoArray[0].url,onClick:t[1]||(t[1]=x(((...t)=>e.toggleShow&&e.toggleShow(...t)),["self"]))},null,10,Pr),e.isH5?(w(),A("div",Ur,[P("p",{onClick:t[2]||(t[2]=(...t)=>e.toggleShow&&e.toggleShow(...t))},xr),P("p",{onClick:t[3]||(t[3]=x((t=>e.downloadImage(e.data.message)),["stop"]))},Gr)])):O("",!0)],2)])):O("",!0)],512)}],["__scopeId","data-v-ed4b993f"]]),Vr=S({props:{data:{type:Object,default:()=>({})},isH5:{type:Boolean,default:!1}},setup(e,t){const n=E({data:{},show:!1,poster:"",posterWidth:0,posterHeight:0}),i=f(),r=f(),o=g((()=>{var e,t;const{snapshotWidth:i=0,snapshotHeight:r=0}=null==(t=null==(e=n.data)?void 0:e.message)?void 0:t.payload;return i>=r})),a="https://web.sdk.qcloud.com/im/assets/images/transparent.png",s=e=>new Promise((function(t,i){let r="",o=document.createElement("video");o.setAttribute("crossOrigin","anonymous"),o.setAttribute("src",e),o.setAttribute("preload","auto"),o.addEventListener("loadeddata",(function(){let e=document.createElement("canvas"),i=o.videoWidth,a=o.videoHeight;e.width=i,e.height=a,e.getContext("2d").drawImage(o,0,0,i,a),r=e.toDataURL("image/jpeg"),n.posterWidth=i,n.posterHeight=a,t(r)}),{once:!0})})),c=async e=>{var t,n,i,r,o,c,u,l;return e?e.progress?await s(e.url):e.snapshotUrl!==a&&e.snapshotUrl||(null==(n=null==(t=null==e?void 0:e.message)?void 0:t.payload)?void 0:n.snapshotUrl)!==a&&(null==(r=null==(i=null==e?void 0:e.message)?void 0:i.payload)?void 0:r.snapshotUrl)||(null==(c=null==(o=null==e?void 0:e.message)?void 0:o.payload)?void 0:c.thumbUrl)!==a&&(null==(l=null==(u=null==e?void 0:e.message)?void 0:u.payload)?void 0:l.thumbUrl)||await s(e.url):""};return k((async()=>{n.data=e.data,n.data&&(n.poster=await c(n.data),N((async()=>{var o,s,c,u,l;const d=(null==(o=document.getElementById("messageEle"))?void 0:o.clientWidth)||0,p=e.isH5?Math.min(d-172,300):300;let h;if(n.data.progress)t.emit("uploading");else{let{snapshotWidth:t=0,snapshotHeight:o=0,snapshotUrl:d}=n.data;if(0===t||0===o)return;d===a&&(t=n.posterWidth,o=n.posterHeight),h=Mr(t,o,p,p),(null==(s=null==i?void 0:i.value)?void 0:s.style)&&(i.value.style.width=`${h.width}px`),(null==(c=null==i?void 0:i.value)?void 0:c.style)&&(i.value.style.height=`${h.height}px`),e.isH5||((null==(u=null==r?void 0:r.value)?void 0:u.style)&&(r.value.style.width=`${h.width}px`),(null==(l=null==r?void 0:r.value)?void 0:l.style)&&(r.value.style.height=`${h.height}px`))}})))})),v((()=>{var e;return null==(e=n.data)?void 0:e.progress}),((e,n)=>{!e&&n&&t.emit("uploading")})),{...b(n),toggleShow:()=>{n.data.progress||(n.show=!n.show)},isWidth:o,getVideoBase64:s,handlePosterUrl:c,skeleton:i,video:r}}}),qr={class:"message-video"},Br=["src"],Hr=["src","poster"],jr=["src","poster"],Kr={key:3,class:"progress"},zr=["value"],Wr=["src"];const Yr=D(Vr,[["render",function(e,t,n,i,r,o){return w(),A("div",qr,[P("div",{class:G(["message-video-box",[!e.data.progress&&"success"===e.data.message.status&&e.isH5&&"message-video-cover"]]),onClick:t[0]||(t[0]=(...t)=>e.toggleShow&&e.toggleShow(...t)),ref:"skeleton"},[e.data.progress&&e.poster||e.isH5&&e.poster?(w(),A("img",{key:0,class:G(["message-img",[e.isWidth?"isWidth":"isHeight"]]),src:e.poster},null,10,Br)):e.isH5?(w(),A("video",{key:1,class:"message-img video-h5-uploading",src:e.data.url+"#t=0.1",poster:e.data.url,preload:"auto",muted:"",ref:"video"},null,8,Hr)):e.data.progress||e.isH5?O("",!0):(w(),A("video",{key:2,class:"message-img video-web",src:e.data.url,controls:"",preload:"metadata",poster:e.poster,ref:"video"},null,8,jr)),e.data.progress?(w(),A("div",Kr,[P("progress",{value:e.data.progress,max:"1"},null,8,zr)])):O("",!0)],2),e.show&&e.isH5?(w(),A("div",{key:0,class:"dialog-video",onClick:t[3]||(t[3]=x(((...t)=>e.toggleShow&&e.toggleShow(...t)),["self"]))},[P("header",null,[P("i",{class:"icon icon-close",onClick:t[1]||(t[1]=x(((...t)=>e.toggleShow&&e.toggleShow(...t)),["stop"]))})]),P("div",{class:G(["dialog-video-box",[e.isH5?"dialog-video-h5":""]]),onClick:t[2]||(t[2]=x(((...t)=>e.toggleShow&&e.toggleShow(...t)),["self"]))},[P("video",{class:G([e.isWidth?"isWidth":"isHeight"]),src:e.data.url,controls:"",autoplay:""},null,10,Wr)],2)])):O("",!0)])}],["__scopeId","data-v-6b46735d"]]),$r=S({props:{data:{type:Object,default:()=>({})}},setup(e,t){const n=E({data:{},show:!1}),i=f(null);v((()=>e.data),(()=>{n.data=e.data}),{deep:!0,immediate:!0});return{...b(n),audio:i,play:()=>{const e=document.getElementsByTagName("audio");for(const n of e)n.paused||(n.pause(),n.load());const t=i.value;t.paused?(t.play(),n.show=!0):(t.pause(),t.load(),n.show=!1)}}}}),Jr=["src"];const Xr=D($r,[["render",function(e,t,n,i,r,o){var a;return w(),A("div",{class:G(["message-audio",["out"===e.data.message.flow&&"reserve"]]),onClick:t[0]||(t[0]=x(((...t)=>e.play&&e.play(...t)),["stop"])),style:U(`width: ${10*(null==(a=e.data)?void 0:a.second)+40}px`)},[P("i",{class:G(["icon icon-voice",["out"===e.data.message.flow&&"icon-reserve"]])},null,2),P("label",null,L(e.data.second)+"s",1),P("audio",{ref:"audio",src:e.data.url},null,8,Jr)],6)}],["__scopeId","data-v-019780a5"]]),Zr=S({props:{data:{type:Object,default:()=>({})}},setup(e,t){const n=E({data:{}});k((()=>{n.data=e.data}));return{...b(n),download:()=>{const e=n.data,t={mode:"cors",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"})};if(window.fetch)fetch(e.url,t).then((e=>e.blob())).then((t=>{const n=document.createElement("a"),i=window.URL.createObjectURL(t);n.href=i,n.download=e.name,n.click()}));else{const t=document.createElement("a");t.href=e.url,t.target="_blank",t.download=e.name,t.click()}}}}}),Qr={class:"message-file"},eo=["title"],to=(e=>(F("data-v-4d978c64"),e=e(),V(),e))((()=>P("i",{class:"icon icon-files"},null,-1))),no={class:"message-file-content"},io=["value"];const ro=D(Zr,[["render",function(e,t,n,i,r,o){return w(),A("div",Qr,[P("div",{class:"box",onClick:t[0]||(t[0]=(...t)=>e.download&&e.download(...t)),title:e.$t("TUIChat.单击下载")},[to,P("div",no,[P("label",null,L(e.data.name),1),P("span",null,L(e.data.size),1)])],8,eo),e.data.progress?(w(),A("progress",{key:0,value:e.data.progress,max:"1"},null,8,io)):O("",!0)])}],["__scopeId","data-v-4d978c64"]]),oo=S({props:{data:{type:Object,default:()=>({})},isH5:{type:Boolean,default:!1}},setup(e,t){const n=E({data:{}}),i=f();return k((()=>{n.data=e.data,n.data&&N((()=>{var t,n,r;const o=(null==(t=document.getElementById("messageEle"))?void 0:t.clientWidth)||0,a=e.isH5?Math.min(o-172,300):300,s=Mr(240,240,a,a);(null==(n=null==i?void 0:i.value)?void 0:n.style)&&(i.value.style.width=`${s.width}px`),(null==(r=null==i?void 0:i.value)?void 0:r.style)&&(i.value.style.height=`${s.height}px`)}))})),{...b(n),skeleton:i}}}),ao={class:"message-image",ref:"skeleton"},so=["src"];const co=D(oo,[["render",function(e,t,n,i,r,o){return w(),A("div",ao,[P("img",{class:"message-img",src:e.data.url,style:U(e.isH5?{maxWidth:e.data.width?e.data.width+"px":"calc(100vw - 180px)",maxHeight:e.data.height?e.data.height+"px":"calc(100vw - 180px)"}:{})},null,12,so)],512)}],["__scopeId","data-v-5bd830b2"]]),uo=S({props:{data:{type:Object,default:()=>({})}},setup(e,t){const n=E({data:{}});return k((()=>{n.data=e.data})),{...b(n)}}}),lo=["href"],po={class:"el-icon-location-outline"},ho=["src"];const fo=D(uo,[["render",function(e,t,n,i,r,o){return w(),A("a",{class:"message-location",href:e.data.href,target:"_blank",title:"点击查看详情"},[P("span",po,L(e.data.description),1),P("img",{src:e.data.url},null,8,ho)],8,lo)}],["__scopeId","data-v-593d36f3"]]),go=S({props:{data:{type:Object,default:()=>({})}},setup(e,t){const n=E({data:{}});return k((()=>{n.data=e.data})),{...b(n)}}}),mo={class:"message-merger"},vo=["data-value"],_o={class:"merger-title"},yo=(e=>(F("data-v-901a540f"),e=e(),V(),e))((()=>P("span",{class:"merger-label"}," 聊天记录",-1)));const Io=D(go,[["render",function(e,t,n,i,r,o){return w(),A("div",mo,[P("div",{class:"merger-box","data-value":e.data.message},[P("p",_o,L(e.data.title),1),(w(!0),A(_,null,R(e.data.abstractList,((e,t)=>(w(),A("p",{class:"merger-text",key:t},L(e),1)))),128))],8,vo),yo])}],["__scopeId","data-v-901a540f"]]);class Mo{constructor(e){this.options={},this.aegisOptions=[],e?this.aegis=e:this.init((()=>{this.aegis=new window.Aegis({id:"iHWefAYqTgxNuvtAjr",uin:"",reportApiSpeed:!0,reportAssetSpeed:!0,spa:!0}),this.aegisOptions.length>0&&(this.aegisOptions.map((e=>(this.reportEvent(e),e))),this.aegisOptions=[])}))}install(e){e.config.globalProperties.$TUIAegis=Mo.getInstance()}static getInstance(){return Mo.instance||(Mo.instance=new Mo(window.$Aegis)),Mo.instance}setAegisOptions(e){this.options=e}reportEvent(e){var t;if(this.aegis){if(!(null==e?void 0:e.ext3)&&!(null==(t=this.options)?void 0:t.ext3))return;this.aegis.reportEvent({...e,...this.options})}else this.aegisOptions=[...this.aegisOptions,e]}init(e){if(!Mo.instance){const t=document.createElement("script");t.type="text/javascript",t.src="https://tam.cdn-go.cn/aegis-sdk/latest/aegis.min.js",document.getElementsByTagName("head")[0].appendChild(t),t.onload=e}}}
/*!
 * vuex v4.0.2
 * (c) 2021 Evan You
 * @license MIT
 */var To="store";function Co(e){return void 0===e&&(e=null),l(null!==e?e:To)}function So(e,t){if(void 0===t&&(t=[]),null===e||"object"!=typeof e)return e;var n,i=(n=function(t){return t.original===e},t.filter(n)[0]);if(i)return i.copy;var r=Array.isArray(e)?[]:{};return t.push({original:e,copy:r}),Object.keys(e).forEach((function(n){r[n]=So(e[n],t)})),r}function Eo(e,t){Object.keys(e).forEach((function(n){return t(e[n],n)}))}function ko(e){return null!==e&&"object"==typeof e}function bo(e,t,n){return t.indexOf(e)<0&&(n&&n.prepend?t.unshift(e):t.push(e)),function(){var n=t.indexOf(e);n>-1&&t.splice(n,1)}}function Do(e,t){e._actions=Object.create(null),e._mutations=Object.create(null),e._wrappedGetters=Object.create(null),e._modulesNamespaceMap=Object.create(null);var n=e.state;Ao(e,n,[],e._modules.root,!0),wo(e,n,t)}function wo(e,t,n){var i=e._state;e.getters={},e._makeLocalGettersCache=Object.create(null);var r=e._wrappedGetters,o={};Eo(r,(function(t,n){o[n]=function(e,t){return function(){return e(t)}}(t,e),Object.defineProperty(e.getters,n,{get:function(){return o[n]()},enumerable:!0})})),e._state=E({data:t}),e.strict&&function(e){v((function(){return e._state.data}),(function(){}),{deep:!0,flush:"sync"})}(e),i&&n&&e._withCommit((function(){i.data=null}))}function Ao(e,t,n,i,r){var o=!n.length,a=e._modules.getNamespace(n);if(i.namespaced&&(e._modulesNamespaceMap[a],e._modulesNamespaceMap[a]=i),!o&&!r){var s=Lo(t,n.slice(0,-1)),c=n[n.length-1];e._withCommit((function(){s[c]=i.state}))}var u=i.context=function(e,t,n){var i=""===t,r={dispatch:i?e.dispatch:function(n,i,r){var o=Oo(n,i,r),a=o.payload,s=o.options,c=o.type;return s&&s.root||(c=t+c),e.dispatch(c,a)},commit:i?e.commit:function(n,i,r){var o=Oo(n,i,r),a=o.payload,s=o.options,c=o.type;s&&s.root||(c=t+c),e.commit(c,a,s)}};return Object.defineProperties(r,{getters:{get:i?function(){return e.getters}:function(){return Ro(e,t)}},state:{get:function(){return Lo(e.state,n)}}}),r}(e,a,n);i.forEachMutation((function(t,n){!function(e,t,n,i){var r=e._mutations[t]||(e._mutations[t]=[]);r.push((function(t){n.call(e,i.state,t)}))}(e,a+n,t,u)})),i.forEachAction((function(t,n){var i=t.root?n:a+n,r=t.handler||t;!function(e,t,n,i){var r=e._actions[t]||(e._actions[t]=[]);r.push((function(t){var r,o=n.call(e,{dispatch:i.dispatch,commit:i.commit,getters:i.getters,state:i.state,rootGetters:e.getters,rootState:e.state},t);return(r=o)&&"function"==typeof r.then||(o=Promise.resolve(o)),e._devtoolHook?o.catch((function(t){throw e._devtoolHook.emit("vuex:error",t),t})):o}))}(e,i,r,u)})),i.forEachGetter((function(t,n){!function(e,t,n,i){if(e._wrappedGetters[t])return;e._wrappedGetters[t]=function(e){return n(i.state,i.getters,e.state,e.getters)}}(e,a+n,t,u)})),i.forEachChild((function(i,o){Ao(e,t,n.concat(o),i,r)}))}function Ro(e,t){if(!e._makeLocalGettersCache[t]){var n={},i=t.length;Object.keys(e.getters).forEach((function(r){if(r.slice(0,i)===t){var o=r.slice(i);Object.defineProperty(n,o,{get:function(){return e.getters[r]},enumerable:!0})}})),e._makeLocalGettersCache[t]=n}return e._makeLocalGettersCache[t]}function Lo(e,t){return t.reduce((function(e,t){return e[t]}),e)}function Oo(e,t,n){return ko(e)&&e.type&&(n=t,t=e,e=e.type),{type:e,payload:t,options:n}}var No="vuex:mutations",Po="vuex:actions",Uo="vuex",xo=0;function Go(e,t){nt({id:"org.vuejs.vuex",app:e,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:["vuex bindings"]},(function(n){n.addTimelineLayer({id:No,label:"Vuex Mutations",color:Fo}),n.addTimelineLayer({id:Po,label:"Vuex Actions",color:Fo}),n.addInspector({id:Uo,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),n.on.getInspectorTree((function(n){if(n.app===e&&n.inspectorId===Uo)if(n.filter){var i=[];Ho(i,t._modules.root,n.filter,""),n.rootNodes=i}else n.rootNodes=[Bo(t._modules.root,"")]})),n.on.getInspectorState((function(n){if(n.app===e&&n.inspectorId===Uo){var i=n.nodeId;Ro(t,i),n.state=function(e,t,n){t="root"===n?t:t[n];var i=Object.keys(t),r={state:Object.keys(e.state).map((function(t){return{key:t,editable:!0,value:e.state[t]}}))};if(i.length){var o=function(e){var t={};return Object.keys(e).forEach((function(n){var i=n.split("/");if(i.length>1){var r=t,o=i.pop();i.forEach((function(e){r[e]||(r[e]={_custom:{value:{},display:e,tooltip:"Module",abstract:!0}}),r=r[e]._custom.value})),r[o]=jo((function(){return e[n]}))}else t[n]=jo((function(){return e[n]}))})),t}(t);r.getters=Object.keys(o).map((function(e){return{key:e.endsWith("/")?qo(e):e,editable:!1,value:jo((function(){return o[e]}))}}))}return r}((r=t._modules,(a=(o=i).split("/").filter((function(e){return e}))).reduce((function(e,t,n){var i=e[t];if(!i)throw new Error('Missing module "'+t+'" for path "'+o+'".');return n===a.length-1?i:i._children}),"root"===o?r:r.root._children)),"root"===i?t.getters:t._makeLocalGettersCache,i)}var r,o,a})),n.on.editInspectorState((function(n){if(n.app===e&&n.inspectorId===Uo){var i=n.nodeId,r=n.path;"root"!==i&&(r=i.split("/").filter(Boolean).concat(r)),t._withCommit((function(){n.set(t._state.data,r,n.state.value)}))}})),t.subscribe((function(e,t){var i={};e.payload&&(i.payload=e.payload),i.state=t,n.notifyComponentUpdate(),n.sendInspectorTree(Uo),n.sendInspectorState(Uo),n.addTimelineEvent({layerId:No,event:{time:Date.now(),title:e.type,data:i}})})),t.subscribeAction({before:function(e,t){var i={};e.payload&&(i.payload=e.payload),e._id=xo++,e._time=Date.now(),i.state=t,n.addTimelineEvent({layerId:Po,event:{time:e._time,title:e.type,groupId:e._id,subtitle:"start",data:i}})},after:function(e,t){var i={},r=Date.now()-e._time;i.duration={_custom:{type:"duration",display:r+"ms",tooltip:"Action duration",value:r}},e.payload&&(i.payload=e.payload),i.state=t,n.addTimelineEvent({layerId:Po,event:{time:Date.now(),title:e.type,groupId:e._id,subtitle:"end",data:i}})}})}))}var Fo=8702998,Vo={label:"namespaced",textColor:16777215,backgroundColor:6710886};function qo(e){return e&&"root"!==e?e.split("/").slice(-2,-1)[0]:"Root"}function Bo(e,t){return{id:t||"root",label:qo(t),tags:e.namespaced?[Vo]:[],children:Object.keys(e._children).map((function(n){return Bo(e._children[n],t+n+"/")}))}}function Ho(e,t,n,i){i.includes(n)&&e.push({id:i||"root",label:i.endsWith("/")?i.slice(0,i.length-1):i||"Root",tags:t.namespaced?[Vo]:[]}),Object.keys(t._children).forEach((function(r){Ho(e,t._children[r],n,i+r+"/")}))}function jo(e){try{return e()}catch(ok){return ok}}var Ko=function(e,t){this.runtime=t,this._children=Object.create(null),this._rawModule=e;var n=e.state;this.state=("function"==typeof n?n():n)||{}},zo={namespaced:{configurable:!0}};zo.namespaced.get=function(){return!!this._rawModule.namespaced},Ko.prototype.addChild=function(e,t){this._children[e]=t},Ko.prototype.removeChild=function(e){delete this._children[e]},Ko.prototype.getChild=function(e){return this._children[e]},Ko.prototype.hasChild=function(e){return e in this._children},Ko.prototype.update=function(e){this._rawModule.namespaced=e.namespaced,e.actions&&(this._rawModule.actions=e.actions),e.mutations&&(this._rawModule.mutations=e.mutations),e.getters&&(this._rawModule.getters=e.getters)},Ko.prototype.forEachChild=function(e){Eo(this._children,e)},Ko.prototype.forEachGetter=function(e){this._rawModule.getters&&Eo(this._rawModule.getters,e)},Ko.prototype.forEachAction=function(e){this._rawModule.actions&&Eo(this._rawModule.actions,e)},Ko.prototype.forEachMutation=function(e){this._rawModule.mutations&&Eo(this._rawModule.mutations,e)},Object.defineProperties(Ko.prototype,zo);var Wo=function(e){this.register([],e,!1)};function Yo(e,t,n){if(t.update(n),n.modules)for(var i in n.modules){if(!t.getChild(i))return;Yo(e.concat(i),t.getChild(i),n.modules[i])}}Wo.prototype.get=function(e){return e.reduce((function(e,t){return e.getChild(t)}),this.root)},Wo.prototype.getNamespace=function(e){var t=this.root;return e.reduce((function(e,n){return e+((t=t.getChild(n)).namespaced?n+"/":"")}),"")},Wo.prototype.update=function(e){Yo([],this.root,e)},Wo.prototype.register=function(e,t,n){var i=this;void 0===n&&(n=!0);var r=new Ko(t,n);0===e.length?this.root=r:this.get(e.slice(0,-1)).addChild(e[e.length-1],r);t.modules&&Eo(t.modules,(function(t,r){i.register(e.concat(r),t,n)}))},Wo.prototype.unregister=function(e){var t=this.get(e.slice(0,-1)),n=e[e.length-1],i=t.getChild(n);i&&i.runtime&&t.removeChild(n)},Wo.prototype.isRegistered=function(e){var t=this.get(e.slice(0,-1)),n=e[e.length-1];return!!t&&t.hasChild(n)};var $o=function(e){var t=this;void 0===e&&(e={});var n=e.plugins;void 0===n&&(n=[]);var i=e.strict;void 0===i&&(i=!1);var r=e.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new Wo(e),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._devtools=r;var o=this,a=this.dispatch,s=this.commit;this.dispatch=function(e,t){return a.call(o,e,t)},this.commit=function(e,t,n){return s.call(o,e,t,n)},this.strict=i;var c=this._modules.root.state;Ao(this,c,[],this._modules.root),wo(this,c),n.forEach((function(e){return e(t)}))},Jo={state:{configurable:!0}};$o.prototype.install=function(e,t){e.provide(t||To,this),e.config.globalProperties.$store=this,void 0!==this._devtools&&this._devtools&&Go(e,this)},Jo.state.get=function(){return this._state.data},Jo.state.set=function(e){},$o.prototype.commit=function(e,t,n){var i=this,r=Oo(e,t,n),o=r.type,a=r.payload,s={type:o,payload:a},c=this._mutations[o];c&&(this._withCommit((function(){c.forEach((function(e){e(a)}))})),this._subscribers.slice().forEach((function(e){return e(s,i.state)})))},$o.prototype.dispatch=function(e,t){var n=this,i=Oo(e,t),r=i.type,o=i.payload,a={type:r,payload:o},s=this._actions[r];if(s){try{this._actionSubscribers.slice().filter((function(e){return e.before})).forEach((function(e){return e.before(a,n.state)}))}catch(ok){}var c=s.length>1?Promise.all(s.map((function(e){return e(o)}))):s[0](o);return new Promise((function(e,t){c.then((function(t){try{n._actionSubscribers.filter((function(e){return e.after})).forEach((function(e){return e.after(a,n.state)}))}catch(ok){}e(t)}),(function(e){try{n._actionSubscribers.filter((function(e){return e.error})).forEach((function(t){return t.error(a,n.state,e)}))}catch(ok){}t(e)}))}))}},$o.prototype.subscribe=function(e,t){return bo(e,this._subscribers,t)},$o.prototype.subscribeAction=function(e,t){return bo("function"==typeof e?{before:e}:e,this._actionSubscribers,t)},$o.prototype.watch=function(e,t,n){var i=this;return v((function(){return e(i.state,i.getters)}),t,Object.assign({},n))},$o.prototype.replaceState=function(e){var t=this;this._withCommit((function(){t._state.data=e}))},$o.prototype.registerModule=function(e,t,n){void 0===n&&(n={}),"string"==typeof e&&(e=[e]),this._modules.register(e,t),Ao(this,this.state,e,this._modules.get(e),n.preserveState),wo(this,this.state)},$o.prototype.unregisterModule=function(e){var t=this;"string"==typeof e&&(e=[e]),this._modules.unregister(e),this._withCommit((function(){delete Lo(t.state,e.slice(0,-1))[e[e.length-1]]})),Do(this)},$o.prototype.hasModule=function(e){return"string"==typeof e&&(e=[e]),this._modules.isRegistered(e)},$o.prototype.hotUpdate=function(e){this._modules.update(e),Do(this,!0)},$o.prototype._withCommit=function(e){var t=this._committing;this._committing=!0,e(),this._committing=t},Object.defineProperties($o.prototype,Jo);var Xo=na((function(e,t){var n={};return ta(t).forEach((function(t){var i=t.key,r=t.val;n[i]=function(){var t=this.$store.state,n=this.$store.getters;if(e){var i=ia(this.$store,"mapState",e);if(!i)return;t=i.context.state,n=i.context.getters}return"function"==typeof r?r.call(this,t,n):t[r]},n[i].vuex=!0})),n})),Zo=na((function(e,t){var n={};return ta(t).forEach((function(t){var i=t.key,r=t.val;n[i]=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var i=this.$store.commit;if(e){var o=ia(this.$store,"mapMutations",e);if(!o)return;i=o.context.commit}return"function"==typeof r?r.apply(this,[i].concat(t)):i.apply(this.$store,[r].concat(t))}})),n})),Qo=na((function(e,t){var n={};return ta(t).forEach((function(t){var i=t.key,r=t.val;r=e+r,n[i]=function(){if(!e||ia(this.$store,"mapGetters",e))return this.$store.getters[r]},n[i].vuex=!0})),n})),ea=na((function(e,t){var n={};return ta(t).forEach((function(t){var i=t.key,r=t.val;n[i]=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var i=this.$store.dispatch;if(e){var o=ia(this.$store,"mapActions",e);if(!o)return;i=o.context.dispatch}return"function"==typeof r?r.apply(this,[i].concat(t)):i.apply(this.$store,[r].concat(t))}})),n}));function ta(e){return function(e){return Array.isArray(e)||ko(e)}(e)?Array.isArray(e)?e.map((function(e){return{key:e,val:e}})):Object.keys(e).map((function(t){return{key:t,val:e[t]}})):[]}function na(e){return function(t,n){return"string"!=typeof t?(n=t,t=""):"/"!==t.charAt(t.length-1)&&(t+="/"),e(t,n)}}function ia(e,t,n){return e._modulesNamespaceMap[n]}function ra(e,t,n){var i=n?e.groupCollapsed:e.group;try{i.call(e,t)}catch(ok){e.log(t)}}function oa(e){try{e.groupEnd()}catch(ok){e.log("—— log end ——")}}function aa(){var e=new Date;return" @ "+sa(e.getHours(),2)+":"+sa(e.getMinutes(),2)+":"+sa(e.getSeconds(),2)+"."+sa(e.getMilliseconds(),3)}function sa(e,t){return n="0",i=t-e.toString().length,new Array(i+1).join(n)+e;var n,i}const ca={version:"4.0.2",Store:$o,storeKey:To,createStore:function(e){return new $o(e)},useStore:Co,mapState:Xo,mapMutations:Zo,mapGetters:Qo,mapActions:ea,createNamespacedHelpers:function(e){return{mapState:Xo.bind(null,e),mapGetters:Qo.bind(null,e),mapMutations:Zo.bind(null,e),mapActions:ea.bind(null,e)}},createLogger:function(e){void 0===e&&(e={});var t=e.collapsed;void 0===t&&(t=!0);var n=e.filter;void 0===n&&(n=function(e,t,n){return!0});var i=e.transformer;void 0===i&&(i=function(e){return e});var r=e.mutationTransformer;void 0===r&&(r=function(e){return e});var o=e.actionFilter;void 0===o&&(o=function(e,t){return!0});var a=e.actionTransformer;void 0===a&&(a=function(e){return e});var s=e.logMutations;void 0===s&&(s=!0);var c=e.logActions;void 0===c&&(c=!0);var u=e.logger;return void 0===u&&(u=console),function(e){var l=So(e.state);void 0!==u&&(s&&e.subscribe((function(e,o){var a=So(o);if(n(e,l,a)){var s=aa(),c=r(e),d="mutation "+e.type+s;ra(u,d,t),u.log("%c prev state","color: #9E9E9E; font-weight: bold",i(l)),u.log("%c mutation","color: #03A9F4; font-weight: bold",c),u.log("%c next state","color: #4CAF50; font-weight: bold",i(a)),oa(u)}l=a})),c&&e.subscribeAction((function(e,n){if(o(e,n)){var i=aa(),r=a(e),s="action "+e.type+i;ra(u,s,t),u.log("%c action","color: #03A9F4; font-weight: bold",r),oa(u)}})))}}},ua=S({props:{data:{type:Object,default:()=>({})}},setup(e,t){var n;const i=(null==(n=null==window?void 0:window.TUIKitTUICore)?void 0:n.isOfficial)&&Co&&Co()||{},r=E({data:{},extension:{},isCustom:"",constant:er});k((()=>{r.data=e.data;const{message:{payload:t}}=e.data;r.isCustom=t.data||" ",r.isCustom=vr(t.data),t.data===er.typeService&&(r.extension=vr(t.extension))}));return{...b(r),isUrl:mr,openLink:e=>{window.open(e)},handleCallMessageIcon:()=>{var e,t,n,i,o;let a="";switch(null==(o=JSON.parse(null==(i=JSON.parse(null==(n=null==(t=null==(e=null==r?void 0:r.data)?void 0:e.message)?void 0:t.payload)?void 0:n.data))?void 0:i.data))?void 0:o.call_type){case 1:a="icon-call-voice";break;case 2:a="icon-call-video"}return a},handleCallAgain:async()=>{var t,n,o,a,s,c,u,l,d,p,h,f,g,m;const v=null==(s=JSON.parse(null==(a=JSON.parse(null==(o=null==(n=null==(t=null==e?void 0:e.data)?void 0:t.message)?void 0:n.payload)?void 0:o.data))?void 0:a.data))?void 0:s.call_type;switch(Mo.getInstance().reportEvent({name:"callOptions",ext1:"clickCall"}),null==(u=null==(c=null==r?void 0:r.data)?void 0:c.message)?void 0:u.conversationType){case window.TUIKitTUICore.TIM.TYPES.CONV_C2C:const{flow:e,to:t,from:n}=null==(l=null==r?void 0:r.data)?void 0:l.message;if(t===n)break;try{await(null==(h=null==(p=null==(d=null==window?void 0:window.TUIKitTUICore)?void 0:d.TUIServer)?void 0:p.TUICallKit)?void 0:h.call({userID:"out"===e?t:n,type:v})),(null==(f=null==window?void 0:window.TUIKitTUICore)?void 0:f.isOfficial)&&(null==i?void 0:i.commit)&&(null==i||i.commit("handleTask",6))}catch(_){}(null==(m=null==(g=null==window?void 0:window.TUIKitTUICore)?void 0:g.TUIServer)?void 0:m.TUICallKit)&&(Mo.getInstance().reportEvent({name:"callOptions",ext1:"clickCall-success"}),Mo.getInstance().reportEvent({name:"callOptions",ext1:"call-c2c"}));case window.TUIKitTUICore.TIM.TYPES.CONV_GROUP:}}}}}),la={class:"custom"},da={key:0},pa=["href"],ha={key:0},fa=["href"],ga={key:1},ma={key:1,class:"evaluate"},va=[(e=>(F("data-v-b86f1378"),e=e(),V(),e))((()=>P("i",{class:"icon icon-star-light"},null,-1)))],_a=["src"],ya={key:3,class:"textLink"},Ia=["href"],Ma=["innerHTML"];const Ta=D(ua,[["render",function(e,t,n,i,r,o){var a,s;return w(),A("div",la,[e.isCustom===e.constant.typeService?(w(),A("div",da,[P("h1",null,[P("label",null,L(e.extension.title),1),e.extension.hyperlinks_text?(w(),A("a",{key:0,href:e.extension.hyperlinks_text.value,target:"view_window"},L(e.extension.hyperlinks_text.key),9,pa)):O("",!0)]),e.extension.item&&e.extension.item.length>0?(w(),A("ul",ha,[(w(!0),A(_,null,R(e.extension.item,((t,n)=>(w(),A("li",{key:n},[e.isUrl(t.value)?(w(),A("a",{key:0,href:t.value,target:"view_window"},L(t.key),9,fa)):(w(),A("p",ga,L(t.key),1))])))),128))])):O("",!0),P("article",null,L(e.extension.description),1)])):e.isCustom.businessID===e.constant.typeEvaluate?(w(),A("div",ma,[P("h1",null,L(e.$t("message.custom.对本次服务评价")),1),P("ul",null,[(w(!0),A(_,null,R(~~e.isCustom.score,((e,t)=>(w(),A("li",{class:"evaluate-list-item",key:t},va)))),128))]),P("article",null,L(e.isCustom.comment),1)])):e.isCustom.businessID===e.constant.typeOrder?(w(),A("div",{key:2,class:"order",onClick:t[0]||(t[0]=t=>e.openLink(e.isCustom.link))},[P("img",{src:e.isCustom.imageUrl,alt:""},null,8,_a),P("main",null,[P("h1",null,L(e.isCustom.title),1),P("p",null,L(e.isCustom.description),1),P("span",null,L(e.isCustom.price),1)])])):e.isCustom.businessID===e.constant.typeTextLink?(w(),A("div",ya,[P("p",null,L(e.isCustom.text),1),P("a",{href:e.isCustom.link,target:"view_window"},L(e.$t("message.custom.查看详情>>")),9,Ia)])):e.isCustom.businessID===e.constant.TYPE_CALL_MESSAGE?(w(),A("div",{key:4,class:G(["call",`call-${null==(s=null==(a=e.data)?void 0:a.message)?void 0:s.conversationType}`]),onClick:t[1]||(t[1]=(...t)=>e.handleCallAgain&&e.handleCallAgain(...t))},[P("i",{class:G(["icon",e.handleCallMessageIcon()])},null,2),P("span",null,L(e.data.custom),1)],2)):(w(),A("span",{key:5,innerHTML:e.data.custom},null,8,Ma))])}],["__scopeId","data-v-b86f1378"]]),Ca=S({props:{data:{type:Object,default:()=>({})}},setup(e,t){const n=E({message:{}});return k((()=>{n.message=e.data})),{...b(n)}}}),Sa={class:"message-tip"};const Ea=D(Ca,[["render",function(e,t,n,i,r,o){var a;return w(),A("div",Sa,[P("span",null,L(null==(a=e.message)?void 0:a.text),1)])}],["__scopeId","data-v-68ebf671"]]);var ka;const ba="undefined"!=typeof window,Da=e=>"number"==typeof e,wa=e=>"string"==typeof e,Aa=()=>{};function Ra(e){return!!q()&&(B(e),!0)}function La(e){var t;const n=H(e);return null!=(t=null==n?void 0:n.$el)?t:n}ba&&(null==(ka=null==window?void 0:window.navigator)?void 0:ka.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);const Oa=ba?window:void 0;function Na(...e){let t,n,i,r;if(wa(e[0])?([n,i,r]=e,t=Oa):[t,n,i,r]=e,!t)return Aa;let o=Aa;const a=v((()=>La(t)),(e=>{o(),e&&(e.addEventListener(n,i,r),o=()=>{e.removeEventListener(n,i,r),o=Aa})}),{immediate:!0,flush:"post"}),s=()=>{a(),o()};return Ra(s),s}function Pa(e,t,n={}){const{window:i=Oa,ignore:r,capture:o=!0,detectIframe:a=!1}=n;if(!i)return;const s=f(!0);let c;const u=n=>{i.clearTimeout(c);const o=La(e),a=n.composedPath();o&&o!==n.target&&!a.includes(o)&&s.value&&(r&&r.length>0&&r.some((e=>{const t=La(e);return t&&(n.target===t||a.includes(t))}))||t(n))},l=[Na(i,"click",u,{passive:!0,capture:o}),Na(i,"pointerdown",(t=>{const n=La(e);s.value=!!n&&!t.composedPath().includes(n)}),{passive:!0}),Na(i,"pointerup",(e=>{if(0===e.button){const t=e.composedPath();e.composedPath=()=>t,c=i.setTimeout((()=>u(e)),50)}}),{passive:!0}),a&&Na(i,"blur",(n=>{var i;const r=La(e);"IFRAME"!==(null==(i=document.activeElement)?void 0:i.tagName)||(null==r?void 0:r.contains(document.activeElement))||t(n)}))].filter(Boolean);return()=>l.forEach((e=>e()))}const Ua="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},xa="__vueuse_ssr_handlers__";Ua[xa]=Ua[xa]||{},Ua[xa];var Ga,Fa,Va=Object.getOwnPropertySymbols,qa=Object.prototype.hasOwnProperty,Ba=Object.prototype.propertyIsEnumerable,Ha=(e,t)=>{var n={};for(var i in e)qa.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&Va)for(var i of Va(e))t.indexOf(i)<0&&Ba.call(e,i)&&(n[i]=e[i]);return n};function ja(e,t={}){const{reset:n=!0,windowResize:i=!0,windowScroll:r=!0,immediate:o=!0}=t,a=f(0),s=f(0),c=f(0),u=f(0),l=f(0),p=f(0),h=f(0),g=f(0);function m(){const t=La(e);if(!t)return void(n&&(a.value=0,s.value=0,c.value=0,u.value=0,l.value=0,p.value=0,h.value=0,g.value=0));const i=t.getBoundingClientRect();a.value=i.height,s.value=i.bottom,c.value=i.left,u.value=i.right,l.value=i.top,p.value=i.width,h.value=i.x,g.value=i.y}return function(e,t,n={}){const i=n,{window:r=Oa}=i,o=Ha(i,["window"]);let a;const s=r&&"ResizeObserver"in r,c=()=>{a&&(a.disconnect(),a=void 0)},u=v((()=>La(e)),(e=>{c(),s&&r&&e&&(a=new ResizeObserver(t),a.observe(e,o))}),{immediate:!0,flush:"post"}),l=()=>{c(),u()};Ra(l)}(e,m),v((()=>La(e)),(e=>!e&&m())),r&&Na("scroll",m,{passive:!0}),i&&Na("resize",m,{passive:!0}),function(e,t=!0){y()?d(e):t?e():N(e)}((()=>{o&&m()})),{height:a,bottom:s,left:c,right:u,top:l,width:p,x:h,y:g,update:m}}(Fa=Ga||(Ga={})).UP="UP",Fa.RIGHT="RIGHT",Fa.DOWN="DOWN",Fa.LEFT="LEFT",Fa.NONE="NONE";const Ka=S({name:"TUIMessage",props:{message:{type:String,default:""},duration:{type:Number,default:3e3},repeatNum:{type:Number,default:1},id:{type:String,default:""},onClose:{type:Function,required:!1},offset:{type:Number,default:20},zIndex:{type:Number,default:0},isH5:{type:Boolean,default:!1},type:{type:String,default:""}},setup(e){const t=f(!1);let n;function i(){e.duration>0&&({stop:n}=function(e,t,n={}){const{immediate:i=!0}=n,r=f(!1);let o=null;function a(){o&&(clearTimeout(o),o=null)}function s(){r.value=!1,a()}function c(...n){a(),r.value=!0,o=setTimeout((()=>{r.value=!1,o=null,e(...n)}),H(t))}return i&&(r.value=!0,ba&&c()),Ra(s),{isPending:r,start:c,stop:s}}((()=>{t.value&&(t.value=!1)}),e.duration))}v((()=>e.repeatNum),(()=>{null==n||n(),i()}));const r=g((()=>({top:`${e.offset}px`,zIndex:e.zIndex})));d((()=>{i(),t.value=!0}));return{visible:t,customStyle:r,handleStyle:e=>!e||"error"!==e&&"success"!==e&&"warning"!==e?"normal":e}}}),za={key:0},Wa={key:1};const Ya=D(Ka,[["render",function(e,t,n,i,r,o){return w(),j(Y,{name:"fade",onBeforeLeave:e.onClose,onAfterLeave:t[0]||(t[0]=t=>e.$emit("destroy"))},{default:K((()=>[z(P("div",{class:G(["message",[e.handleStyle(e.type),e.isH5&&"message-h5"]]),style:U(e.customStyle)},[e.isH5?O("",!0):(w(),A("p",za,L(e.message),1)),e.isH5?(w(),A("span",Wa,L(e.message),1)):O("",!0)],6),[[W,e.visible]])])),_:1},8,["onBeforeLeave"])}],["__scopeId","data-v-8f503ecd"]]),$a=[];let Ja=1;const Xa=document.body,Za=function(e){const t=$a.find((t=>{var n;return`${(null==(n=t.vm.props)?void 0:n.message)??""}`==`${e.message??""}`}));if(t)return t.vm.component.props.repeatNum+=1,{close:()=>a.component.proxy.visible=!1};let n=e.offset||20;$a.forEach((({vm:e})=>{var t;n+=((null==(t=e.el)?void 0:t.offsetHeight)||0)+20})),n+=20;const i=`message_${Ja+=1}`,r=e.onClose,o={zIndex:20+Ja,offset:n,id:i,...e,onClose:()=>{!function(e,t){const n=$a.findIndex((({vm:t})=>e===t.component.props.id));if(-1===n)return;const{vm:i}=$a[n];if(!i)return;null==t||t(i);const r=i.el.offsetHeight;$a.splice(n,1);const o=$a.length;if(o<1)return;for(let a=n;a<o;a++){const e=Number.parseInt($a[a].vm.el.style.top,10)-r-16;$a[a].vm.component.props.offset=e}}(i,r)}},a=M(Ya,o),s=document.createElement("div");return a.props.onDestroy=()=>{$(null,s)},$(a,s),$a.push({vm:a}),Xa.appendChild(s.firstElementChild),{close:()=>a.component.proxy.visible=!1}};const Qa={80001:"您发送的消息可能包含违规内容，请停止发送此类内容",80002:"您发送的消息超过最大长度限制（>8KB）"};function es(e){const{t:t}=window.TUIKitTUICore.config.i18n.useI18n(),n=6e4,i=36e5,r=24*i,o=(new Date).getTime()-e;let a="";if(o<0)return;const s=o/n,c=o/i,u=o/r,l=o/6048e5;if(l>=1&&l<=4)a=` ${parseInt(`${l}`,10)} ${t("time.周")}${t("time.前")}`;else if(u>=1&&u<=6)a=` ${parseInt(`${u}`,10)} ${t("time.天")}${t("time.前")}`;else if(c>=1&&c<=23)a=` ${parseInt(`${c}`,10)} ${t("time.小时")}${t("time.前")}`;else if(s>=1&&s<=59)a=` ${parseInt(`${s}`,10)} ${t("time.分钟")}${t("time.前")}`;else if(o>=0&&o<=n)a=`${t("time.刚刚")}`;else{const t=new Date;t.setTime(e);a=`${t.getFullYear()}-${t.getMonth()+1<10?`0${t.getMonth()+1}`:t.getMonth()+1}-${t.getDate()<10?`0${t.getDate()}`:t.getDate()}`}return a}function ts(e){const{t:t}=window.TUIKitTUICore.config.i18n.useI18n(),n=e.payload.groupProfile.name||e.payload.groupProfile.groupID;switch(e.payload.operationType){case 1:return`${e.payload.operatorID} ${t("message.tip.申请加入群组")}：${n}`;case 2:return`${t("message.tip.成功加入群组")}：${n}`;case 3:return`${t("message.tip.申请加入群组")}：${n} ${t("message.tip.被拒绝")}`;case 4:return`${t("message.tip.你被管理员")}${e.payload.operatorID} ${t("message.tip.踢出群组")}：${n}`;case 5:return`${t("message.tip.群")}：${n} ${t("message.tip.被")} ${e.payload.operatorID} ${t("message.tip.解散")}`;case 6:return`${e.payload.operatorID} ${t("message.tip.创建群")}：${n}`;case 7:case 12:return`${e.payload.operatorID} ${t("message.tip.邀请你加群")}：${n}`;case 8:return`${t("message.tip.你退出群组")}：${n}`;case 9:return`${t("message.tip.你被")}${e.payload.operatorID} ${t("message.tip.设置为群")}：${n} ${t("message.tip.的管理员")}`;case 10:return`${t("message.tip.你被")}${e.payload.operatorID} ${t("message.tip.撤销群")}：${n} ${t("message.tip.的管理员身份")}`;case 13:return`${e.payload.operatorID} ${t("message.tip.同意加群")}：${n}`;case 14:return`${e.payload.operatorID} ${t("message.tip.拒接加群")}：${n}`;case 255:return`${t("message.tip.自定义群系统通知")}: ${e.payload.userDefinedField}`}}function ns(e,t){(null==e?void 0:e.type)&&(null==e?void 0:e.message)?Za({message:`${e.type} : ${e.message}`||e,isH5:!!(null==t?void 0:t.isH5),type:"error"}):Za({message:Qa[e.code]||e,isH5:!!(null==t?void 0:t.isH5),type:"error"})}function is(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(-1===t.indexOf(e[n]))return!1;return!0}const rs=S({props:{message:{type:Object,default:{}},referenceMessage:{type:Object,default:()=>({})},referenceForShow:{type:Object,default:()=>({})},face:{type:Array,default:()=>[]},url:{type:String,default:""},allMessageID:{type:String,default:""},type:{type:String,deafault:""}},setup(e,t){const n=E({message:{},referenceMessage:{},referenceForShow:{},allMessageID:"",face:[],url:"",type:""});return k((()=>{n.message=e.message,n.referenceMessage=e.referenceMessage,n.referenceForShow=e.referenceForShow,n.face=e.face,n.url=e.url,n.allMessageID=e.allMessageID,n.type=e.type})),v((()=>e.referenceForShow),(()=>{n.referenceForShow=e.referenceForShow}),{deep:!0}),{...b(n),constant:er}}}),as={class:"message-reference-user"},ss={class:"nick"},cs={class:"colon"},us={key:0,class:"face-box"},ls={key:0,class:"text-box"},ds=["src"],ps={key:1},hs=["src"],fs={key:3,class:"message-video-cover"},gs=["src"],ms=["src"],vs={key:5};const _s=D(rs,[["render",function(e,t,n,i,r,o){var a,s,c,u,l,d,p,h;return(null==(a=e.referenceMessage)?void 0:a.messageID)&&-1!==e.allMessageID.indexOf(e.referenceMessage.messageID)?(w(),A("div",{key:0,class:G(`${e.type} ${"in"===e.message.flow&&e.type+"-reverse"}`)},[P("p",as,[P("span",ss,L(e.referenceForShow.nick||e.referenceForShow.from),1),P("span",cs,L("reference"===e.type?":":""),1)]),e.referenceMessage.messageType===e.constant.typeText?(w(),A("div",us,[(w(!0),A(_,null,R(e.face,((e,t)=>(w(),A("div",{key:t},["text"===e.name?(w(),A("span",ls,L(e.text),1)):"img"===e.name?(w(),A("img",{key:1,class:"text-img",src:e.src},null,8,ds)):O("",!0)])))),128))])):O("",!0),e.referenceMessage.messageType===e.constant.typeCustom?(w(),A("span",ps,L(e.referenceMessage.messageAbstract),1)):O("",!0),e.referenceMessage.messageType===e.constant.typeImage?(w(),A("img",{key:2,class:"message-img",src:e.referenceForShow.payload.imageInfoArray[1].url},null,8,hs)):O("",!0),e.referenceMessage.messageType===e.constant.typeVideo?(w(),A("div",fs,[P("img",{class:"message-videoimg",src:(null==(c=null==(s=e.referenceForShow)?void 0:s.payload)?void 0:c.snapshotUrl)||(null==(l=null==(u=e.referenceForShow)?void 0:u.payload)?void 0:l.thumbUrl)},null,8,gs)])):O("",!0),e.referenceMessage.messageType===e.constant.typeFace?(w(),A("img",{key:4,class:"message-img",src:e.url},null,8,ms)):O("",!0),e.referenceMessage.messageType===e.constant.typeFile||e.referenceMessage.messageType===e.constant.typeAudio?(w(),A("span",vs,L(null==(d=e.referenceMessage)?void 0:d.messageAbstract),1)):O("",!0)],2)):(w(),A("div",{key:1,class:G(`${e.type} ${"in"===e.message.flow&&e.type+"-reverse"}`)},[P("p",null,L(null==(p=e.referenceMessage)?void 0:p.messageSender),1),P("span",null,L(null==(h=e.referenceMessage)?void 0:h.messageAbstract),1)],2))}],["__scopeId","data-v-09725657"]]),ys=S({props:{message:{type:Object,default:()=>({})},emojiList:{type:Array,default:()=>[]},type:{type:String,default:""}},emits:["handleCollapse"],setup(e,t){const{TUIServer:n}=LI,i=E({message:{},emojiUrl:Yi,emojiMap:$i,emojiName:Ji,isCollapse:!0,types:Qi.TYPES,env:n.TUICore.TUIEnv,type:e.type,emojiReacts:{},allMemberList:[]}),r=f({}),o=g((()=>i.emojiName.slice(0,6))),a=g((()=>i.emojiName.slice(6)));return v((()=>e.message),((t,r)=>{i.message=e.message,(null==t?void 0:t.conversationID)!==(null==r?void 0:r.conversationID)&&(e=>{var t,r,o,a,s,c,u;const l=null==n?void 0:n.currentStore;switch(null==e?void 0:e.conversationType){case Qi.TYPES.CONV_C2C:i.allMemberList=[{userID:null==(r=null==(t=null==l?void 0:l.conversation)?void 0:t.userProfile)?void 0:r.userID,nick:null==(a=null==(o=null==l?void 0:l.conversation)?void 0:o.userProfile)?void 0:a.nick},{userID:null==(s=null==l?void 0:l.selfInfo)?void 0:s.userID,nick:null==(c=null==l?void 0:l.selfInfo)?void 0:c.nick}];break;case Qi.TYPES.CONV_GROUP:i.allMemberList=null==(u=null==l?void 0:l.allMemberList)?void 0:u.memberList}})(t)}),{deep:!0,immediate:!0}),v((()=>i.isCollapse),((e,n)=>{var r;e!==n&&(null==(r=null==i?void 0:i.env)?void 0:r.isH5)&&t.emit("handleCollapse",e)})),{...b(i),emojiCollapseList:o,emojiExpandList:a,select:e=>{n.emojiReact(i.message,e)},handleEmojiReact:e=>{var t,n;try{if(!(null==e?void 0:e.cloudCustomData))return;const r=null==(n=null==(t=vr(null==e?void 0:e.cloudCustomData))?void 0:t.messageReact)?void 0:n.reacts;if(!r)return;return i.emojiReacts=r,r}catch(r){}},handleEmojiReactItem:e=>{let t="";return null==e||e.forEach(((e,n)=>{var r;const o=null==(r=i.allMemberList)?void 0:r.find((t=>t.userID===e));t=t+(o?null==o?void 0:o.nick:e)+", "})),t.length&&(t=t.substring(0,t.lastIndexOf(","))),t},container:r}}}),Is={class:"face-list collapse"},Ms={class:"face-list-collapse"},Ts=["onClick"],Cs=["src"],Ss={class:"face-list face-list-expand"},Es=["onClick"],ks=["src"],bs={key:1,class:"emoji-content"},Ds={class:"emoji-react",ref:"container"},ws=["onClick"],As=["src"],Rs={class:"emoji-react-item-content"};const Ls=D(ys,[["render",function(e,t,n,i,r,o){var a;return w(),A(_,null,["dropdown"===e.type?(w(),A("div",{key:0,class:G(["dialog-emoji",(null==(a=e.env)?void 0:a.isH5)?"dialog-emoji-h5":""])},[P("div",Is,[P("ul",Ms,[(w(!0),A(_,null,R(e.emojiCollapseList,((t,n)=>(w(),A("li",{class:"face-list-item",key:n,onClick:x((n=>e.select(t)),["stop"])},[P("img",{src:e.emojiUrl+e.emojiMap[t]},null,8,Cs)],8,Ts)))),128))]),P("div",{class:"face-list-button",onClick:t[0]||(t[0]=x((t=>e.isCollapse=!e.isCollapse),["stop"]))},[P("i",{class:G(["icon",[e.isCollapse?"icon-expand":"icon-collapse"]])},null,2)])]),z(P("ul",Ss,[(w(!0),A(_,null,R(e.emojiExpandList,((t,n)=>(w(),A("li",{class:"face-list-item",key:n,onClick:x((n=>e.select(t)),["stop"])},[P("img",{src:e.emojiUrl+e.emojiMap[t]},null,8,ks)],8,Es)))),128))],512),[[W,!e.isCollapse]])],2)):O("",!0),"content"===e.type?(w(),A("div",bs,[P("ul",Ds,[(w(!0),A(_,null,R(e.handleEmojiReact(e.message),((t,n)=>z((w(),A("li",{class:"emoji-react-item",key:n,onClick:x((t=>e.select(n)),["stop"])},[P("img",{src:e.emojiUrl+e.emojiMap[n]},null,8,As),P("div",Rs,[P("span",null,L(e.handleEmojiReactItem(t)),1)])],8,ws)),[[W,t&&(null==t?void 0:t.length)]]))),128))],512)])):O("",!0)],64)}],["__scopeId","data-v-68bff8c4"]]),Os=S({props:{data:{type:Object,default:()=>({})},messagesList:{type:Array,default:()=>[]},isH5:{type:Boolean,default:!1},needGroupReceipt:{type:Boolean,default:!1},needReplies:{type:Boolean,default:!0},flow:{type:String,default:""},needEmojiReact:{type:Boolean,default:!1}},emits:["jumpID","resendMessage","showReadReceiptDialog","showRepliesDialog","dropDownOpen"],components:{MessageReference:_s,MessageEmojiReact:Ls},setup(e,t){const{t:n}=window.TUIKitTUICore.config.i18n.useI18n(),{TUIServer:i}=LI,r=E({env:zi(),message:{},messagesList:[],show:!1,type:{},referenceMessage:{},referenceForShow:{},allMessageID:"",needGroupReceipt:!1,needReplies:!0,replies:[],face:[],url:"",needEmojiReact:!1});k((()=>{var t,n,i;if(r.type=er,r.messagesList=e.messagesList,r.needEmojiReact=e.needEmojiReact,r.message=yr((null==(t=r.messagesList)?void 0:t.find((t=>{var n;return(null==t?void 0:t.ID)===(null==(n=e.message)?void 0:n.ID)})))||e.data),r.needGroupReceipt=e.needGroupReceipt,r.needReplies=e.needReplies,r.message.cloudCustomData){const e=[],t=vr(r.message.cloudCustomData);r.replies=(null==(n=null==t?void 0:t.messageReplies)?void 0:n.replies)||[],r.referenceMessage=t.messageReply?t.messageReply:"";for(let n=0;n<r.messagesList.length;n++)e.push(r.messagesList[n].ID),r.allMessageID=JSON.stringify(e),r.messagesList[n].ID===(null==(i=r.referenceMessage)?void 0:i.messageID)&&(r.referenceForShow=r.messagesList[n],r.referenceMessage.messageType===er.typeText&&(r.face=Zi(r.referenceForShow.payload)),r.referenceMessage.messageType===er.typeFace&&(r.url=`https://web.sdk.qcloud.com/im/assets/face-elem/${r.referenceForShow.payload.data}@2x.png`))}else r.replies=[]}));const o=f(null),a=f(!1),s=f(null),c=e=>{a.value=!a.value,a.value&&(t.emit("dropDownOpen",s),N((()=>{var t,n,i,o,a,c,u,l,d,p,h,f,g,m,v;const _=null==(t=null==s?void 0:s.value)?void 0:t.children[0],y=document.getElementsByClassName("dialog-item")[0],I=null==(n=null==s?void 0:s.value)?void 0:n.offsetParent,M=ja(I),T=document.getElementById("messageEle"),C=ja(T),S=null==(i=null==C?void 0:C.left)?void 0:i.value,E=(null==(o=null==C?void 0:C.left)?void 0:o.value)+T.clientWidth-_.clientWidth+76,k=null==(a=null==C?void 0:C.top)?void 0:a.value,b=(null==(c=null==C?void 0:C.top)?void 0:c.value)+T.clientHeight-_.clientHeight,{clientX:D,clientY:w}=e;if(null==(u=null==r?void 0:r.env)?void 0:u.isH5){(null==(l=null==M?void 0:M.top)?void 0:l.value)<=(null==y?void 0:y.clientHeight)?_.style.bottom=`-${null==y?void 0:y.clientHeight}px`:"in"===(null==(d=null==r?void 0:r.message)?void 0:d.flow)?_.style.top=`-${(null==y?void 0:y.clientHeight)-20}px`:_.style.top=`-${null==y?void 0:y.clientHeight}px`;const e=(null==(p=null==M?void 0:M.left)?void 0:p.value)+(null==(h=null==M?void 0:M.width)?void 0:h.value)/2;e>y.clientWidth/2&&e<(null==T?void 0:T.clientWidth)-y.clientWidth/2?_.style.left="calc(50% - 135px)":e<=y.clientWidth/2?_.style.left="-20px":_.style.left=`-${y.clientWidth/2+10}px`}else{switch(!0){case D>S&&D<E:_.style.left=`${Math.max(e.clientX-(null==(f=null==M?void 0:M.left)?void 0:f.value)-76,-40)}px`;break;case D<=S:_.style.left="20px";break;case D>=E:_.style.right=`${Math.max((null==(g=null==M?void 0:M.left)?void 0:g.value)+(null==I?void 0:I.clientWidth)-e.clientX-256,-10)}px`}switch(!0){case w>k&&w<b:_.style.top=e.clientY-(null==(m=null==M?void 0:M.top)?void 0:m.value)+"px",_.style.cssText=_.style.cssText.replace("align-items:end;","");break;case w<=k:_.style.top="0px",_.style.cssText=_.style.cssText.replace("align-items:end;","");break;case w>=b:_.style.bottom=(null==(v=null==M?void 0:M.top)?void 0:v.value)+(null==I?void 0:I.clientHeight)-e.clientY+"px",_.style.cssText+="align-items:end;"}}})))};Pa(s,(()=>{a.value=!1}));!function(e,t,n){var i,r;const o=g((()=>La(e)));let a=null;function s(){null!=a&&(clearTimeout(a),a=null)}const c={capture:null==(i=null==n?void 0:n.modifiers)?void 0:i.capture,once:null==(r=null==n?void 0:n.modifiers)?void 0:r.once};Na(o,"pointerdown",(function(e){var i,r,c,u;(null==(i=null==n?void 0:n.modifiers)?void 0:i.self)&&e.target!==o.value||(s(),(null==(r=null==n?void 0:n.modifiers)?void 0:r.prevent)&&e.preventDefault(),(null==(c=null==n?void 0:n.modifiers)?void 0:c.stop)&&e.stopPropagation(),a=setTimeout((()=>t(e)),null!=(u=null==n?void 0:n.delay)?u:500))}),c),Na(o,"pointerup",s,c),Na(o,"pointerleave",s,c)}(o,(e=>{var t;(null==(t=null==r?void 0:r.env)?void 0:t.isH5)&&c(e)}));const u=e=>{var t,n;try{if(!(null==e?void 0:e.cloudCustomData))return;const i=null==(n=null==(t=vr(null==e?void 0:e.cloudCustomData))?void 0:t.messageReact)?void 0:n.reacts;return!(!i||0===Object.keys(i).length)}catch(i){return!1}};return{...b(r),toggleDialog:c,htmlRefHook:o,jumpToAim:i=>{var o,a;if((null==(o=r.referenceMessage)?void 0:o.messageID)&&r.allMessageID.includes(null==(a=r.referenceMessage)?void 0:a.messageID))t.emit("jumpID",r.referenceMessage.messageID);else{ns(n("TUIChat.无法定位到原消息"),e)}},dropdown:a,dropdownRef:s,resendMessage:e=>{t.emit("resendMessage",e)},showReadReceiptTag:e=>!("out"!==e.flow||"success"!==e.status||!e.needReadReceipt),readReceiptStyle:e=>{var t,n,i;return(null==(t=null==e?void 0:e.readReceiptInfo)?void 0:t.isPeerRead)||void 0===(null==(n=null==e?void 0:e.readReceiptInfo)?void 0:n.isPeerRead)&&(null==e?void 0:e.isPeerRead)||0===(null==(i=null==e?void 0:e.readReceiptInfo)?void 0:i.unreadCount)?"":"unRead"},readReceiptCont:e=>{var t,r;switch(e.conversationType){case i.TUICore.TIM.TYPES.CONV_C2C:return(null==(t=null==e?void 0:e.readReceiptInfo)?void 0:t.isPeerRead)||void 0===(null==(r=null==e?void 0:e.readReceiptInfo)?void 0:r.isPeerRead)&&(null==e?void 0:e.isPeerRead)?n("TUIChat.已读"):n("TUIChat.未读");case i.TUICore.TIM.TYPES.CONV_GROUP:return 0===e.readReceiptInfo.unreadCount?n("TUIChat.全部已读"):0===e.readReceiptInfo.readCount||void 0===e.readReceiptInfo.unreadCount&&void 0===e.readReceiptInfo.readCount?n("TUIChat.未读"):`${e.readReceiptInfo.readCount+n("TUIChat.人已读")}`;default:return""}},showReadReceiptDialog:e=>{t.emit("showReadReceiptDialog",e,"receipt")},showRepliesDialog:(i,o)=>{var a,s;if(o)t.emit("showRepliesDialog",i,"replies");else if(null==(a=r.referenceMessage)?void 0:a.messageRootID){const i=null==(s=r.messagesList)?void 0:s.find((e=>{var t;return e.ID===(null==(t=r.referenceMessage)?void 0:t.messageRootID)}));if(i)return void t.emit("showRepliesDialog",i,"replies");ns(n("TUIChat.无法定位到原消息"),e)}},handleImageOrVideoBubbleStyle:e=>{const t=["content"];return e?(t.push(`content-${r.message.flow}`),r.message.type!==Qi.TYPES.MSG_IMAGE||u(e)||t.push("content-image"),r.message.type!==Qi.TYPES.MSG_VIDEO||u(e)||t.push("content-video"),t):t},isEmojiReactionInMessage:u,TIM:Qi}}}),Ns=["src"],Ps={class:"message-area"},Us={key:0,class:"name"},xs={key:1,ref:"dropdownRef",class:"dropdown-inner"},Gs=(e=>(F("data-v-a6f28069"),e=e(),V(),e))((()=>P("i",{class:"icon icon-msg-replies"},null,-1)));const Fs=D(Os,[["render",function(e,t,n,i,r,o){var a,s,c,u,l,d,p,h;const f=J("MessageReference"),g=J("MessageEmojiReact");return w(),A(_,null,[P("div",{class:G(["message-bubble",["in"===e.message.flow?"":"reverse"]]),ref:"htmlRefHook"},[P("img",{class:"avatar",src:(null==(a=e.message)?void 0:a.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,Ns),P("main",Ps,["in"===e.message.flow&&"GROUP"===e.message.conversationType?(w(),A("label",Us,L(e.message.nameCard||e.message.nick||e.message.from),1)):O("",!0),P("div",{class:G(e.handleImageOrVideoBubbleStyle(e.message)),onContextmenu:t[2]||(t[2]=x(((...t)=>e.toggleDialog&&e.toggleDialog(...t)),["prevent","right"]))},[(null==(s=e.message)?void 0:s.cloudCustomData)&&e.referenceMessage&&(null==(c=e.referenceMessage)?void 0:c.messageRootID)?(w(),A("div",{key:0,class:G(["message-replie-area",["in"===(null==(u=e.message)?void 0:u.flow)?"":"message-replies-area-reverse"]]),onClick:t[0]||(t[0]=t=>e.showRepliesDialog(e.message,!1))},[M(f,{message:e.message,referenceMessage:e.referenceMessage,referenceForShow:e.referenceForShow,url:e.url,face:e.face,allMessageID:e.allMessageID,type:"reply"},null,8,["message","referenceMessage","referenceForShow","url","face","allMessageID"])],2)):O("",!0),X(e.$slots,"default",{},void 0,!0),e.dropdown?(w(),A("div",xs,[P("div",{class:G(["dialog",["in"===e.message.flow?"":"dialog-right"]]),onClick:t[1]||(t[1]=t=>e.dropdown=!1)},[X(e.$slots,"dialog",{},void 0,!0)],2)],512)):O("",!0),e.needEmojiReact&&e.isEmojiReactionInMessage(e.message)?(w(),j(g,{key:2,message:e.message,type:"content"},null,8,["message"])):O("",!0)],34)]),"fail"===e.message.status?(w(),A("label",{key:0,class:"message-label fail",onClick:t[3]||(t[3]=t=>e.resendMessage(e.message))},"!")):O("",!0),e.showReadReceiptTag(e.message)?(w(),A("label",{key:1,class:G(["message-label",e.readReceiptStyle(e.message)]),onClick:t[4]||(t[4]=t=>e.showReadReceiptDialog(e.message))},[P("span",null,L(e.readReceiptCont(e.message)),1)],2)):O("",!0)],2),(null==(l=e.message)?void 0:l.cloudCustomData)&&e.referenceMessage&&!(null==(d=e.referenceMessage)?void 0:d.messageRootID)?(w(),A("div",{key:0,class:G(["message-reference-area",["in"===e.message.flow?"":"message-reference-area-reverse"]]),onClick:t[5]||(t[5]=t=>e.jumpToAim(e.referenceMessage))},[M(f,{message:e.message,referenceMessage:e.referenceMessage,referenceForShow:e.referenceForShow,url:e.url,face:e.face,allMessageID:e.allMessageID,type:"reference"},null,8,["message","referenceMessage","referenceForShow","url","face","allMessageID"])],2)):O("",!0),(null==(p=e.replies)?void 0:p.length)?(w(),A("label",{key:1,class:G(["message-replies",["in"===e.message.flow?"":"message-replies-reverse"]]),onClick:t[6]||(t[6]=t=>e.showRepliesDialog(e.message,!0))},[Gs,P("span",null,L((null==(h=e.replies)?void 0:h.length)+e.$t("TUIChat.条回复")),1)],2)):O("",!0)],64)}],["__scopeId","data-v-a6f28069"]]),Vs=S({props:{data:{type:Object,default:()=>({})},isEdit:{type:Boolean,default:()=>!1}},setup(e,t){const n=E({message:{},isEdit:!1});k((()=>{n.message=e.data,n.isEdit=e.isEdit}));return{...b(n),edit:()=>{t.emit("edit",n.message)}}}}),qs={class:"revoke"},Bs={key:0},Hs={key:1};const js=D(Vs,[["render",function(e,t,n,i,r,o){return w(),A("div",qs,["in"===e.message.flow?(w(),A("label",Bs,L(e.message.nick||e.message.from),1)):(w(),A("label",Hs,L(e.$t("TUIChat.您")),1)),P("span",null,L(e.$t("TUIChat.撤回了一条消息")),1),"out"===e.message.flow&&e.isEdit?(w(),A("span",{key:2,class:"edit",onClick:t[0]||(t[0]=(...t)=>e.edit&&e.edit(...t))},L(e.$t("TUIChat.重新编辑")),1)):O("",!0)])}],["__scopeId","data-v-cc256c49"]]),Ks=S({props:{data:{type:Array,default:()=>[]},types:{type:Object,default:()=>({})}},setup(e,t){const n=E({messageList:[],types:{}});k((()=>{n.messageList=e.data,n.types=e.types}));return{...b(n),translateGroupSystemNotice:fr,handleApplication:(e,n)=>{const i={handleAction:e,message:n};t.emit("application",i)}}}}),zs={class:"message-system"},Ws={class:"list"},Ys=(e=>(F("data-v-00c62489"),e=e(),V(),e))((()=>P("i",{class:"icon icon-system"},null,-1))),$s={key:0,class:"btn-box"},Js=["onClick"],Xs=["onClick"];const Zs=D(Ks,[["render",function(e,t,n,i,r,o){return w(),A("div",zs,[P("ul",Ws,[(w(!0),A(_,null,R(e.messageList,((t,n)=>{var i;return w(),A("li",{key:n},[t.type===e.types.MSG_GRP_TIP||t.type===e.types.MSG_GRP_SYS_NOTICE?(w(),A(_,{key:0},[Ys,P("span",null,L(e.translateGroupSystemNotice(t)),1),1===(null==(i=null==t?void 0:t.payload)?void 0:i.operationType)?(w(),A("div",$s,[P("button",{class:"btn btn-default",onClick:n=>e.handleApplication("Agree",t)},"接受",8,Js),P("button",{class:"btn btn-cancel",onClick:n=>e.handleApplication("Reject",t)},"拒绝",8,Xs)])):O("",!0)],64)):O("",!0)])})),128))])])}],["__scopeId","data-v-00c62489"]]);var Qs,ec={};Qs=function(){return function(){var e={686:function(e,t,n){n.d(t,{default:function(){return T}});var i=n(279),r=n.n(i),o=n(370),a=n.n(o),s=n(817),c=n.n(s);function u(e){try{return document.execCommand(e)}catch(t){return!1}}var l=function(e){var t=c()(e);return u("cut"),t},d=function(e,t){var n=function(e){var t="rtl"===document.documentElement.getAttribute("dir"),n=document.createElement("textarea");n.style.fontSize="12pt",n.style.border="0",n.style.padding="0",n.style.margin="0",n.style.position="absolute",n.style[t?"right":"left"]="-9999px";var i=window.pageYOffset||document.documentElement.scrollTop;return n.style.top="".concat(i,"px"),n.setAttribute("readonly",""),n.value=e,n}(e);t.container.appendChild(n);var i=c()(n);return u("copy"),n.remove(),i},p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{container:document.body},n="";return"string"==typeof e?n=d(e,t):e instanceof HTMLInputElement&&!["text","search","url","tel","password"].includes(null==e?void 0:e.type)?n=d(e.value,t):(n=c()(e),u("copy")),n};function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.action,n=void 0===t?"copy":t,i=e.container,r=e.target,o=e.text;if("copy"!==n&&"cut"!==n)throw new Error('Invalid "action" value, use either "copy" or "cut"');if(void 0!==r){if(!r||"object"!==h(r)||1!==r.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===n&&r.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===n&&(r.hasAttribute("readonly")||r.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes')}return o?p(o,{container:i}):r?"cut"===n?l(r):p(r,{container:i}):void 0};function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(ok){return!1}}();return function(){var n,i,r,o=y(e);if(t){var a=y(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return i=this,!(r=n)||"object"!==g(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i):r}}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e,t){var n="data-clipboard-".concat(e);if(t.hasAttribute(n))return t.getAttribute(n)}var M=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(o,e);var t,n,i,r=_(o);function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=r.call(this)).resolveOptions(t),n.listenClick(e),n}return t=o,n=[{key:"resolveOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText,this.container="object"===g(e.container)?e.container:document.body}},{key:"listenClick",value:function(e){var t=this;this.listener=a()(e,"click",(function(e){return t.onClick(e)}))}},{key:"onClick",value:function(e){var t=e.delegateTarget||e.currentTarget,n=this.action(t)||"copy",i=f({action:n,container:this.container,target:this.target(t),text:this.text(t)});this.emit(i?"success":"error",{action:n,text:i,trigger:t,clearSelection:function(){t&&t.focus(),window.getSelection().removeAllRanges()}})}},{key:"defaultAction",value:function(e){return I("action",e)}},{key:"defaultTarget",value:function(e){var t=I("target",e);if(t)return document.querySelector(t)}},{key:"defaultText",value:function(e){return I("text",e)}},{key:"destroy",value:function(){this.listener.destroy()}}],i=[{key:"copy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{container:document.body};return p(e,t)}},{key:"cut",value:function(e){return l(e)}},{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["copy","cut"],t="string"==typeof e?[e]:e,n=!!document.queryCommandSupported;return t.forEach((function(e){n=n&&!!document.queryCommandSupported(e)})),n}}],n&&m(t.prototype,n),i&&m(t,i),o}(r()),T=M},828:function(e){if("undefined"!=typeof Element&&!Element.prototype.matches){var t=Element.prototype;t.matches=t.matchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector||t.webkitMatchesSelector}e.exports=function(e,t){for(;e&&9!==e.nodeType;){if("function"==typeof e.matches&&e.matches(t))return e;e=e.parentNode}}},438:function(e,t,n){var i=n(828);function r(e,t,n,i,r){var a=o.apply(this,arguments);return e.addEventListener(n,a,r),{destroy:function(){e.removeEventListener(n,a,r)}}}function o(e,t,n,r){return function(n){n.delegateTarget=i(n.target,t),n.delegateTarget&&r.call(e,n)}}e.exports=function(e,t,n,i,o){return"function"==typeof e.addEventListener?r.apply(null,arguments):"function"==typeof n?r.bind(null,document).apply(null,arguments):("string"==typeof e&&(e=document.querySelectorAll(e)),Array.prototype.map.call(e,(function(e){return r(e,t,n,i,o)})))}},879:function(e,t){t.node=function(e){return void 0!==e&&e instanceof HTMLElement&&1===e.nodeType},t.nodeList=function(e){var n=Object.prototype.toString.call(e);return void 0!==e&&("[object NodeList]"===n||"[object HTMLCollection]"===n)&&"length"in e&&(0===e.length||t.node(e[0]))},t.string=function(e){return"string"==typeof e||e instanceof String},t.fn=function(e){return"[object Function]"===Object.prototype.toString.call(e)}},370:function(e,t,n){var i=n(879),r=n(438);e.exports=function(e,t,n){if(!e&&!t&&!n)throw new Error("Missing required arguments");if(!i.string(t))throw new TypeError("Second argument must be a String");if(!i.fn(n))throw new TypeError("Third argument must be a Function");if(i.node(e))return function(e,t,n){return e.addEventListener(t,n),{destroy:function(){e.removeEventListener(t,n)}}}(e,t,n);if(i.nodeList(e))return function(e,t,n){return Array.prototype.forEach.call(e,(function(e){e.addEventListener(t,n)})),{destroy:function(){Array.prototype.forEach.call(e,(function(e){e.removeEventListener(t,n)}))}}}(e,t,n);if(i.string(e))return function(e,t,n){return r(document.body,e,t,n)}(e,t,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}},817:function(e){e.exports=function(e){var t;if("SELECT"===e.nodeName)e.focus(),t=e.value;else if("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName){var n=e.hasAttribute("readonly");n||e.setAttribute("readonly",""),e.select(),e.setSelectionRange(0,e.value.length),n||e.removeAttribute("readonly"),t=e.value}else{e.hasAttribute("contenteditable")&&e.focus();var i=window.getSelection(),r=document.createRange();r.selectNodeContents(e),i.removeAllRanges(),i.addRange(r),t=i.toString()}return t}},279:function(e){function t(){}t.prototype={on:function(e,t,n){var i=this.e||(this.e={});return(i[e]||(i[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var i=this;function r(){i.off(e,r),t.apply(n,arguments)}return r._=t,this.on(e,r,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),i=0,r=n.length;i<r;i++)n[i].fn.apply(n[i].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),i=n[e],r=[];if(i&&t)for(var o=0,a=i.length;o<a;o++)i[o].fn!==t&&i[o].fn._!==t&&r.push(i[o]);return r.length?n[e]=r:delete n[e],this}},e.exports=t,e.exports.TinyEmitter=t}},t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}return n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n(686)}().default},{get exports(){return ec},set exports(e){ec=e}}.exports=Qs();const tc=Z(ec),nc=e=>{const t=void 0===(null==e?void 0:e.appendToBody)||e.appendToBody;return{toClipboard:(e,n)=>new Promise(((i,r)=>{const o=document.createElement("button"),a=new tc(o,{text:()=>e,action:()=>"copy",container:void 0!==n?n:document.body});a.on("success",(e=>{a.destroy(),i(e)})),a.on("error",(e=>{a.destroy(),r(e)})),t&&document.body.appendChild(o),o.click(),t&&document.body.removeChild(o)}))}},ic=S({props:{message:{type:Object,default:()=>({})},needEmojiReact:{type:Boolean,default:!1}},components:{MessageEmojiReact:Ls},setup(e,t){var n,i,r;const o=null==(i=null==(n=null==window?void 0:window.TUIKitTUICore)?void 0:n.TUIServer)?void 0:i.TUIChat,a=(null==(r=null==window?void 0:window.TUIKitTUICore)?void 0:r.isOfficial)&&Co&&Co()||{},s=E({message:{},show:!1,types:Qi.TYPES,env:o.TUICore.TUIEnv,showToolList:!0,needEmojiReact:!1});k((()=>{s.needEmojiReact=e.needEmojiReact})),v((()=>e.message),(()=>{s.message=e.message}),{deep:!0,immediate:!0});return{...b(s),openMessage:e=>{let t="";switch(e.type){case s.types.MSG_FILE:t=e.payload.fileUrl;break;case s.types.MSG_VIDEO:t=e.payload.remoteVideoUrl;break;case s.types.MSG_IMAGE:t=e.payload.imageInfoArray[0].url}window.open(t,"_blank")},handleMessage:async(e,n)=>{var i,r,c;switch(n){case er.handleMessage.revoke:try{await o.revokeMessage(e),Mo.getInstance().reportEvent({name:"messageOptions",ext1:"messageRevoke"}),(null==(i=null==window?void 0:window.TUIKitTUICore)?void 0:i.isOfficial)&&(null==a?void 0:a.commit)&&(null==a||a.commit("handleTask",1))}catch(u){ns(u,s.env)}break;case er.handleMessage.copy:try{if((null==e?void 0:e.type)===s.types.MSG_TEXT&&(null==(r=null==e?void 0:e.payload)?void 0:r.text)){const{toClipboard:t}=nc();await t(null==(c=null==e?void 0:e.payload)?void 0:c.text)}}catch(u){ns(u,s.env)}break;case er.handleMessage.delete:await o.deleteMessage([e]),Mo.getInstance().reportEvent({name:"messageOptions",ext1:"messageDelete"});break;case er.handleMessage.forward:Mo.getInstance().reportEvent({name:"messageOptions",ext1:"messageForward"}),t.emit("handleMessage",e,er.handleMessage.forward);break;case er.handleMessage.reference:t.emit("handleMessage",e,er.handleMessage.reference);break;case er.handleMessage.reply:t.emit("handleMessage",e,er.handleMessage.reply)}},constant:er,handleCollapse:e=>{var t;(null==(t=null==s?void 0:s.env)?void 0:t.isH5)&&(s.showToolList=e)}}}}),rc=e=>(F("data-v-c2fd4b39"),e=e(),V(),e),oc=rc((()=>P("i",{class:"icon icon-msg-copy"},null,-1))),ac=rc((()=>P("i",{class:"icon icon-msg-copy"},null,-1))),sc=rc((()=>P("i",{class:"icon icon-msg-forward"},null,-1))),cc=rc((()=>P("i",{class:"icon icon-msg-quote"},null,-1))),uc=rc((()=>P("i",{class:"icon icon-msg-reply"},null,-1))),lc=rc((()=>P("i",{class:"icon icon-msg-revoke"},null,-1))),dc=rc((()=>P("i",{class:"icon icon-msg-del"},null,-1)));const pc=D(ic,[["render",function(e,t,n,i,r,o){var a,s,c;const u=J("MessageEmojiReact");return w(),A("div",{class:G(["dialog-item",(null==(a=e.env)?void 0:a.isH5)?"dialog-item-h5":"dialog-item-web"])},[(null==(s=e.env)?void 0:s.isH5)&&e.needEmojiReact?(w(),j(u,{key:0,message:e.message,type:"dropdown",onHandleCollapse:e.handleCollapse},null,8,["message","onHandleCollapse"])):O("",!0),z(P("ul",{class:G(["dialog-item-list",(null==(c=e.env)?void 0:c.isH5)?"dialog-item-list-h5":"dialog-item-list-web"])},[e.message.type!==e.types.MSG_FILE&&e.message.type!==e.types.MSG_VIDEO&&e.message.type!==e.types.MSG_IMAGE||e.env.isH5?O("",!0):(w(),A("li",{key:0,onClick:t[0]||(t[0]=t=>e.openMessage(e.message))},[oc,P("span",null,L(e.$t("TUIChat.打开")),1)])),e.message.type===e.types.MSG_TEXT?(w(),A("li",{key:1,onClick:t[1]||(t[1]=t=>e.handleMessage(e.message,e.constant.handleMessage.copy))},[ac,P("span",null,L(e.$t("TUIChat.复制")),1)])):O("",!0),"success"===e.message.status?(w(),A("li",{key:2,onClick:t[2]||(t[2]=t=>e.handleMessage(e.message,e.constant.handleMessage.forward))},[sc,P("span",null,L(e.$t("TUIChat.转发")),1)])):O("",!0),"success"===e.message.status?(w(),A("li",{key:3,onClick:t[3]||(t[3]=t=>e.handleMessage(e.message,e.constant.handleMessage.reference))},[cc,P("span",null,L(e.$t("TUIChat.引用")),1)])):O("",!0),"success"===e.message.status?(w(),A("li",{key:4,onClick:t[4]||(t[4]=t=>e.handleMessage(e.message,e.constant.handleMessage.reply))},[uc,P("span",null,L(e.$t("TUIChat.回复")),1)])):O("",!0),"out"===e.message.flow&&"success"===e.message.status&&e.message.type!==e.types.MSG_CUSTOM?(w(),A("li",{key:5,onClick:t[5]||(t[5]=t=>e.handleMessage(e.message,e.constant.handleMessage.revoke))},[lc,P("span",null,L(e.$t("TUIChat.撤回")),1)])):O("",!0),"success"===e.message.status?(w(),A("li",{key:6,onClick:t[6]||(t[6]=t=>e.handleMessage(e.message,e.constant.handleMessage.delete))},[dc,P("span",null,L(e.$t("TUIChat.删除")),1)])):O("",!0)],2),[[W,e.showToolList]])],2)}],["__scopeId","data-v-c2fd4b39"]]),hc={class:"message-item"},fc=D(S({__name:"index",props:{message:{type:Object,default:()=>({})},beforeMessage:{type:Object,default:()=>({})},types:{type:Object,default:()=>({})},env:{type:Object,default:()=>({})},messageList:{type:Array,default:()=>[]},displayGroupMessageReadReceipt:{type:Boolean,default:!0},displayEmojiReactions:{type:Boolean,default:!0}},emits:["handleEditor","showDialog","uploading","jumpID","resendMessage"],setup(e,{emit:t}){const n=e,{message:i,types:r,env:o,messageList:a,displayGroupMessageReadReceipt:s,displayEmojiReactions:c}=b(n),u=(e,n)=>{if(e&&n)switch(n){case er.handleMessage.forward:t("showDialog",e,er.handleMessage.forward);break;case er.handleMessage.reference:t("handleEditor",e,er.handleMessage.reference);break;case er.handleMessage.reply:t("handleEditor",e,er.handleMessage.reply)}},l=e=>{e&&t("showDialog",e,"previewImage")},d=e=>{e&&t("showDialog",e,"receipt")},p=e=>{e&&t("showDialog",e,"replies")},h=e=>{e&&t("jumpID",e)},f=()=>{t("uploading")},g=e=>{e&&t("resendMessage",e)};return(e,n)=>(w(),A("div",hc,[H(Ir)(H(i))?(w(),j(Ea,{key:0,data:H(ir)(H(i))},null,8,["data"])):H(i).isRevoked?(w(),j(js,{key:2,isEdit:H(i).type===H(r).MSG_TEXT,data:H(i),onEdit:n[0]||(n[0]=e=>{return n=H(i),void t("handleEditor",n,"reedit");var n})},null,8,["isEdit","data"])):(w(),j(Fs,{key:1,data:H(i),isH5:H(o).isH5,messagesList:H(a),needGroupReceipt:H(s),needReplies:!0,needEmojiReact:H(c),onJumpID:h,onResendMessage:g,onShowReadReceiptDialog:d,onShowRepliesDialog:p},{dialog:K((()=>{var e;return[M(pc,{message:H(i),needEmojiReact:H(c),onHandleMessage:u},null,8,["message","needEmojiReact"]),!(null==(e=H(o))?void 0:e.isH5)&&H(c)?(w(),j(Ls,{key:0,message:H(i),type:"dropdown"},null,8,["message"])):O("",!0)]})),default:K((()=>[H(i).type===H(r).MSG_TEXT?(w(),j(Dr,{key:0,data:H(rr)(H(i))},null,8,["data"])):O("",!0),H(i).type===H(r).MSG_IMAGE?(w(),j(Fr,{key:1,isH5:H(o).isH5,data:H(sr)(H(i)),onUploading:f,onPreviewImage:l},null,8,["isH5","data"])):O("",!0),H(i).type===H(r).MSG_VIDEO?(w(),j(Yr,{key:2,isH5:H(o).isH5,data:H(cr)(H(i)),onUploading:f},null,8,["isH5","data"])):O("",!0),H(i).type===H(r).MSG_AUDIO?(w(),j(Xr,{key:3,data:H(ur)(H(i))},null,8,["data"])):O("",!0),H(i).type===H(r).MSG_FILE?(w(),j(ro,{key:4,data:H(lr)(H(i))},null,8,["data"])):O("",!0),H(i).type===H(r).MSG_FACE?(w(),j(co,{key:5,data:H(or)(H(i)),isH5:H(o).isH5},null,8,["data","isH5"])):O("",!0),H(i).type===H(r).MSG_LOCATION?(w(),j(fo,{key:6,data:H(ar)(H(i))},null,8,["data"])):O("",!0),H(i).type===H(r).MSG_CUSTOM?(w(),j(Ta,{key:7,data:H(hr)(H(i))},null,8,["data"])):O("",!0),H(i).type===H(r).MSG_MERGER?(w(),j(Io,{key:8,data:H(dr)(H(i))},null,8,["data"])):O("",!0)])),_:1},8,["data","isH5","messagesList","needGroupReceipt","needEmojiReact"]))]))}}),[["__scopeId","data-v-f338a00b"]]),gc=D(S({__name:"message-timestamp",props:{currTime:{type:Number,default:0},prevTime:{type:Number,default:0}},setup(e){var t,n,i;const r=e,{t:o}=null==(i=null==(n=null==(t=null==window?void 0:window.TUIKitTUICore)?void 0:t.config)?void 0:n.i18n)?void 0:i.useI18n(),{currTime:a,prevTime:s}=b(r),c=f(!1),u=f("");function l(e){const t=(new Date).setHours(0,0,0,0),n=new Date((new Date).getFullYear(),0,1,0,0,0,0).getTime(),i=new Date(e),r=864e5,a=t-i.getTime();function s(e){return e<10?"0"+e:e.toString()}if(a<=0)return`${s(i.getHours())}:${s(i.getMinutes())}`;if(a<=r)return`${o("time.昨天")} ${s(i.getHours())}:${s(i.getMinutes())}`;if(a<=5184e5){const e=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][i.getDay()];return`${o("time."+e)} ${s(i.getHours())}:${s(i.getMinutes())}`}return i.getTime()>=n?`${i.getMonth()+1}/${i.getDate()} ${s(i.getHours())}:${s(i.getMinutes())}`:`${i.getFullYear()}/${i.getMonth()+1}/${i.getDate()} ${s(i.getHours())}:${s(i.getMinutes())}`}return v((()=>[a.value,s.value]),((e,t)=>{var n,i;(null==e?void 0:e.toString())!==(null==t?void 0:t.toString())&&(u.value=(n=a.value,i=s.value,c.value=!1,n<=0?"":!i||i<=0||n-i>=600?(c.value=!0,l(1e3*n)):""))}),{immediate:!0}),(e,t)=>z((w(),A("div",{class:"message-timestamp"},L(u.value),513)),[[W,c.value]])}}),[["__scopeId","data-v-5dd228c0"]]);const mc=D(S({props:{show:{type:Boolean,default:()=>!1}},setup(e,t){const n=E({show:!1});k((()=>{n.show=e.show}));return{...b(n),toggleView:()=>{n.show=!n.show,t.emit("update:show",n.show)}}}}),[["render",function(e,t,n,i,r,o){return e.show?(w(),A("div",{key:0,class:"mask",onClick:t[0]||(t[0]=x(((...t)=>e.toggleView&&e.toggleView(...t)),["self"]))},[X(e.$slots,"default",{},void 0,!0)])):O("",!0)}],["__scopeId","data-v-9d5616d4"]]),vc=S({props:{list:{type:Array,default:()=>[]},selectedList:{type:Array,default:()=>[]},isSearch:{type:Boolean,default:()=>!0},isRadio:{type:Boolean,default:()=>!1},isCustomItem:{type:Boolean,default:()=>!1},title:{type:String,default:()=>""},type:{type:String,default:()=>""},isH5:{type:Boolean,default:()=>!1},resultShow:{type:Boolean,default:()=>!0}},setup(e,t){const n=E({type:"",list:[],selectedList:[],isSearch:!0,isCustomItem:!1,title:""});k((()=>{if(e.isCustomItem)for(let t=0;t<e.list.length;t++)e.list[t].conversationID.indexOf("@TIM#SYSTEM")>-1&&e.list.splice(t,1),n.list=e.list;else n.list=e.list;n.selectedList=e.selectedList,n.isSearch=e.isSearch,n.isCustomItem=e.isCustomItem,n.title=e.title,n.type=e.type}));const i=g((()=>n.list.filter((e=>!e.isDisabled))));return{...b(n),optional:i,handleInput:e=>{t.emit("search",e.target.value)},selected:t=>{if(t.isDisabled)return;let i=n.selectedList;const r=i.indexOf(t);if(r>-1)return n.selectedList.splice(r,1);e.isRadio&&(i=[]),i.push(t),n.selectedList=i},selectedAll:()=>{n.selectedList.length===i.value.length?n.selectedList=[]:n.selectedList=[...i.value]},submit:()=>{t.emit("submit",n.selectedList)},cancel:()=>{t.emit("cancel")}}}}),_c={key:0,class:"transfer-h5-header"},yc={class:"title"},Ic={class:"main"},Mc={class:"left"},Tc={key:0},Cc=["placeholder"],Sc={class:"list"},Ec={class:"all"},kc=["onClick"],bc=["src"],Dc={class:"name"},wc={key:0},Ac={class:"right"},Rc={key:0},Lc={class:"list"},Oc={key:0},Nc=["src"],Pc={key:0},Uc=["onClick"];const xc=D(vc,[["render",function(e,t,n,i,r,o){return w(),A("div",{class:G(["transfer",[e.isH5?"transfer-h5":""]])},[e.isH5?(w(),A("header",_c,[P("i",{class:"icon icon-back",onClick:t[0]||(t[0]=(...t)=>e.cancel&&e.cancel(...t))}),P("span",yc,L(e.title),1)])):O("",!0),P("main",Ic,[P("div",Mc,[e.isSearch?(w(),A("header",Tc,[P("input",{type:"text",onKeyup:t[1]||(t[1]=Q(((...t)=>e.handleInput&&e.handleInput(...t)),["enter"])),placeholder:e.$t("component.请输入userID"),enterkeyhint:"search"},null,40,Cc)])):O("",!0),P("main",null,[P("ul",Sc,[e.optional.length>1&&!e.isRadio?(w(),A("li",{key:0,class:"list-item",onClick:t[2]||(t[2]=(...t)=>e.selectedAll&&e.selectedAll(...t))},[P("i",{class:G(["icon",[e.selectedList.length===e.optional.length?"icon-selected":"icon-unselected"]])},null,2),P("span",Ec,L(e.$t("component.全选")),1)])):O("",!0),(w(!0),A(_,null,R(e.list,((t,n)=>(w(),A("li",{class:"list-item",key:n,onClick:n=>e.selected(t)},[P("i",{class:G(["icon",[(null==t?void 0:t.isDisabled)&&"disabled",e.selectedList.indexOf(t)>-1?"icon-selected":"icon-unselected"]])},null,2),e.isCustomItem?X(e.$slots,"left",{key:1,data:t},void 0,!0):(w(),A(_,{key:0},[P("img",{class:"avatar",src:(null==t?void 0:t.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,bc),P("span",Dc,L((null==t?void 0:t.nick)||(null==t?void 0:t.userID)),1),(null==t?void 0:t.isDisabled)?(w(),A("span",wc,"（"+L(e.$t("component.已在群聊中"))+"）",1)):O("",!0)],64))],8,kc)))),128))])])]),P("div",Ac,[e.isH5?O("",!0):(w(),A("header",Rc,L(e.title),1)),z(P("ul",Lc,[e.selectedList.length>0&&!e.isH5?(w(),A("p",Oc,L(e.$t("component.已选中"))+L(e.selectedList.length)+L(e.$t("component.人")),1)):O("",!0),(w(!0),A(_,null,R(e.selectedList,((t,n)=>(w(),A("li",{class:"list-item space-between",key:n},[P("aside",null,[e.isCustomItem?X(e.$slots,"right",{key:1,data:t},void 0,!0):(w(),A(_,{key:0},[P("img",{class:"avatar",src:(null==t?void 0:t.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,Nc),e.isH5?O("",!0):(w(),A("span",Pc,L(t.nick||t.userID),1))],64))]),e.isH5?O("",!0):(w(),A("i",{key:0,class:"icon icon-cancel",onClick:n=>e.selected(t)},null,8,Uc))])))),128))],512),[[W,e.resultShow]]),P("footer",null,[P("button",{class:"btn btn-cancel",onClick:t[3]||(t[3]=(...t)=>e.cancel&&e.cancel(...t))},L(e.$t("component.取消")),1),e.selectedList.length>0?(w(),A("button",{key:0,class:"btn",onClick:t[4]||(t[4]=(...t)=>e.submit&&e.submit(...t))},L(e.$t("component.完成")),1)):(w(),A("button",{key:1,class:"btn btn-no",onClick:t[5]||(t[5]=(...t)=>e.submit&&e.submit(...t))},L(e.$t("component.完成")),1))])])])],2)}],["__scopeId","data-v-710f4032"]]),Gc=S({props:{open:{type:Boolean,default:()=>!1}},setup(e,t){const n=E({open:!1});k((()=>{n.open=e.open}));return{...b(n),toggle:()=>{n.open=!n.open,t.emit("change",n.open)}}}}),Fc=[(e=>(F("data-v-cecd13df"),e=e(),V(),e))((()=>P("span",{class:"slider-block"},null,-1)))];const Vc=D(Gc,[["render",function(e,t,n,i,r,o){return w(),A("div",{class:G(["slider-box",[e.open&&"slider-open"]]),onClick:t[0]||(t[0]=(...t)=>e.toggle&&e.toggle(...t))},Fc,2)}],["__scopeId","data-v-cecd13df"]]),qc=S({props:{data:{type:Object,default:()=>({})},isAuth:{type:Boolean,default:!1},isH5:{type:Boolean,default:!1}},setup(e,t){const n=E({groupProfile:{},input:"",isEdit:!1});k((()=>{n.groupProfile=e.data}));const i=f();Pa(i,(()=>{n.isEdit=!1}));const r=async()=>{e.isAuth&&(n.isEdit=!n.isEdit),n.isEdit&&(n.input=n.groupProfile.name)};return{...b(n),updateProfile:async()=>{n.input&&n.input!==n.groupProfile.name&&(t.emit("update",{key:"name",value:n.input}),n.groupProfile.name=n.input,n.input=""),r()},toggleEdit:r,dialog:i}}}),Bc={class:"name"},Hc={key:0,class:"edit-h5-header"},jc={class:"left"},Kc={class:"input-box"},zc={key:1},Wc={key:1,class:"edit-h5-footer"},Yc=["disabled"],$c={key:0,class:"icon icon-edit"};const Jc=D(qc,[["render",function(e,t,n,i,r,o){return w(),A("div",Bc,[P("label",null,L(e.$t("TUIChat.manage.群名称")),1),e.isEdit?(w(),A("div",{key:0,class:G([e.isH5?"edit-h5":""]),ref:"dialog"},[P("main",null,[e.isH5?(w(),A("header",Hc,[P("aside",jc,[P("h1",null,L(e.$t("TUIChat.manage.修改群聊名称")),1),P("span",null,L(e.$t("TUIChat.manage.修改群聊名称后，将在群内通知其他成员")),1)]),P("span",{class:"close",onClick:t[0]||(t[0]=(...t)=>e.toggleEdit&&e.toggleEdit(...t))},L(e.$t("关闭")),1)])):O("",!0),P("div",Kc,[e.isEdit?z((w(),A("input",{key:0,class:"input","onUpdate:modelValue":t[1]||(t[1]=t=>e.input=t),type:"text",onKeyup:t[2]||(t[2]=Q(((...t)=>e.updateProfile&&e.updateProfile(...t)),["enter"]))},null,544)),[[ee,e.input]]):O("",!0),e.isH5?(w(),A("span",zc,L(e.$t("TUIChat.manage.仅限中文、字母、数字和下划线，2-20个字")),1)):O("",!0)]),e.isH5?(w(),A("footer",Wc,[P("button",{class:"btn",disabled:!e.input,onClick:t[3]||(t[3]=(...t)=>e.updateProfile&&e.updateProfile(...t))},L(e.$t("确认")),9,Yc)])):O("",!0)])],2)):O("",!0),!e.isEdit||e.isH5?(w(),A("p",{key:1,onClick:t[4]||(t[4]=(...t)=>e.toggleEdit&&e.toggleEdit(...t))},[P("span",null,L(e.groupProfile.name),1),e.isAuth?(w(),A("i",$c)):O("",!0)])):O("",!0)])}],["__scopeId","data-v-f87f7ae9"]]),Xc=S({props:{data:{type:Object,default:()=>({})},isAuth:{type:Boolean,default:!1}},setup(e,t){const n=E({groupProfile:{},input:"",isEdit:!1});k((()=>{n.groupProfile=e.data,n.input=n.groupProfile.notification}));return{...b(n),updateProfile:async()=>{n.input&&n.input!==n.groupProfile.notification&&(t.emit("update",{key:"notification",value:n.input}),n.groupProfile.notification=n.input,n.input=""),n.isEdit=!n.isEdit}}}}),Zc={class:"notification"},Qc={key:1},eu={key:0},tu={key:1},nu={key:2};const iu=D(Xc,[["render",function(e,t,n,i,r,o){return w(),A("main",Zc,[e.isEdit?z((w(),A("textarea",{key:0,"onUpdate:modelValue":t[0]||(t[0]=t=>e.input=t),onKeyup:t[1]||(t[1]=Q(((...t)=>e.updateProfile&&e.updateProfile(...t)),["enter"]))},null,544)),[[ee,e.input]]):(w(),A("section",Qc,[e.groupProfile.notification?(w(),A("article",tu,L(e.groupProfile.notification),1)):(w(),A("p",eu,L(e.$t("TUIChat.manage.暂无公告")),1))])),e.isAuth?(w(),A("footer",nu,[e.isEdit?(w(),A("button",{key:0,class:"btn",onClick:t[2]||(t[2]=(...t)=>e.updateProfile&&e.updateProfile(...t))},L(e.$t("TUIChat.manage.发布")),1)):(w(),A("button",{key:1,class:"btn",onClick:t[3]||(t[3]=t=>e.isEdit=!e.isEdit)},L(e.$t("TUIChat.manage.编辑")),1))])):O("",!0)])}],["__scopeId","data-v-ae6db71e"]]);var ru,ou={},au={get exports(){return ou},set exports(e){ou=e}};function su(){return ru||(ru=1,au.exports=function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){a(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(he){return!1}}function d(e,t,n){return(d=l()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&u(r,n.prototype),r}).apply(null,arguments)}function p(e){var t="function"==typeof Map?new Map:void 0;return(p=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return d(e,arguments,c(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),u(i,e)})(e)}function h(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}function m(e){var t=l();return function(){var n,i=c(e);if(t){var r=c(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}function v(e,t){return y(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);a=!0);}catch(c){s=!0,r=c}finally{try{a||null==n.return||n.return()}finally{if(s)throw r}}return o}}(e,t)||M(e,t)||S()}function _(e){return function(e){if(Array.isArray(e))return T(e)}(e)||I(e)||M(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e){if(Array.isArray(e))return e}function I(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function M(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function S(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function E(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=M(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}var k={SDK_READY:"sdkStateReady",SDK_NOT_READY:"sdkStateNotReady",SDK_DESTROY:"sdkDestroy",MESSAGE_RECEIVED:"onMessageReceived",MESSAGE_MODIFIED:"onMessageModified",MESSAGE_REVOKED:"onMessageRevoked",MESSAGE_READ_BY_PEER:"onMessageReadByPeer",MESSAGE_READ_RECEIPT_RECEIVED:"onMessageReadReceiptReceived",MESSAGE_EXTENSIONS_UPDATED:"onMessageExtensionsUpdated",MESSAGE_EXTENSIONS_DELETED:"onMessageExtensionsDeleted",CONVERSATION_LIST_UPDATED:"onConversationListUpdated",TOTAL_UNREAD_MESSAGE_COUNT_UPDATED:"onTotalUnreadMessageCountUpdated",CONVERSATION_GROUP_LIST_UPDATED:"onConversationGroupListUpdated",CONVERSATION_IN_GROUP_UPDATED:"onConversationInGroupUpdated",GROUP_LIST_UPDATED:"onGroupListUpdated",GROUP_SYSTEM_NOTICE_RECEIVED:"receiveGroupSystemNotice",GROUP_ATTRIBUTES_UPDATED:"groupAttributesUpdated",GROUP_COUNTER_UPDATED:"onGroupCounterUpdated",TOPIC_CREATED:"onTopicCreated",TOPIC_DELETED:"onTopicDeleted",TOPIC_UPDATED:"onTopicUpdated",PROFILE_UPDATED:"onProfileUpdated",USER_STATUS_UPDATED:"onUserStatusUpdated",BLACKLIST_UPDATED:"blacklistUpdated",FRIEND_LIST_UPDATED:"onFriendListUpdated",FRIEND_GROUP_LIST_UPDATED:"onFriendGroupListUpdated",FRIEND_APPLICATION_LIST_UPDATED:"onFriendApplicationListUpdated",KICKED_OUT:"kickedOut",ERROR:"error",NET_STATE_CHANGE:"netStateChange",SDK_RELOAD:"sdkReload"},b={MSG_TEXT:"TIMTextElem",MSG_IMAGE:"TIMImageElem",MSG_SOUND:"TIMSoundElem",MSG_AUDIO:"TIMSoundElem",MSG_FILE:"TIMFileElem",MSG_FACE:"TIMFaceElem",MSG_VIDEO:"TIMVideoFileElem",MSG_GEO:"TIMLocationElem",MSG_LOCATION:"TIMLocationElem",MSG_GRP_TIP:"TIMGroupTipElem",MSG_GRP_SYS_NOTICE:"TIMGroupSystemNoticeElem",MSG_CUSTOM:"TIMCustomElem",MSG_MERGER:"TIMRelayElem",MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",CONV_C2C:"C2C",CONV_GROUP:"GROUP",CONV_TOPIC:"TOPIC",CONV_SYSTEM:"@TIM#SYSTEM",CONV_AT_ME:1,CONV_AT_ALL:2,CONV_AT_ALL_AT_ME:3,CONV_MARK_TYPE_STAR:1,CONV_MARK_TYPE_UNREAD:2,CONV_MARK_TYPE_FOLD:4,CONV_MARK_TYPE_HIDE:8,GRP_PRIVATE:"Private",GRP_WORK:"Private",GRP_PUBLIC:"Public",GRP_CHATROOM:"ChatRoom",GRP_MEETING:"ChatRoom",GRP_AVCHATROOM:"AVChatRoom",GRP_COMMUNITY:"Community",GRP_MBR_ROLE_OWNER:"Owner",GRP_MBR_ROLE_ADMIN:"Admin",GRP_MBR_ROLE_MEMBER:"Member",GRP_MBR_ROLE_CUSTOM:"Custom",GRP_TIP_MBR_JOIN:1,GRP_TIP_MBR_QUIT:2,GRP_TIP_MBR_KICKED_OUT:3,GRP_TIP_MBR_SET_ADMIN:4,GRP_TIP_MBR_CANCELED_ADMIN:5,GRP_TIP_GRP_PROFILE_UPDATED:6,GRP_TIP_MBR_PROFILE_UPDATED:7,GRP_TIP_BAN_AVCHATROOM_MEMBER:10,GRP_TIP_UNBAN_AVCHATROOM_MEMBER:11,MSG_REMIND_ACPT_AND_NOTE:"AcceptAndNotify",MSG_REMIND_ACPT_NOT_NOTE:"AcceptNotNotify",MSG_REMIND_DISCARD:"Discard",GENDER_UNKNOWN:"Gender_Type_Unknown",GENDER_FEMALE:"Gender_Type_Female",GENDER_MALE:"Gender_Type_Male",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",KICKED_OUT_REST_API:"REST_API_Kick",ALLOW_TYPE_ALLOW_ANY:"AllowType_Type_AllowAny",ALLOW_TYPE_NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_TYPE_DENY_ANY:"AllowType_Type_DenyAny",FORBID_TYPE_NONE:"AdminForbid_Type_None",FORBID_TYPE_SEND_OUT:"AdminForbid_Type_SendOut",JOIN_OPTIONS_FREE_ACCESS:"FreeAccess",JOIN_OPTIONS_NEED_PERMISSION:"NeedPermission",JOIN_OPTIONS_DISABLE_APPLY:"DisableApply",JOIN_STATUS_SUCCESS:"JoinedSuccess",JOIN_STATUS_ALREADY_IN_GROUP:"AlreadyInGroup",JOIN_STATUS_WAIT_APPROVAL:"WaitAdminApproval",INVITE_OPTIONS_DISABLE_INVITE:"DisableInvite",INVITE_OPTIONS_NEED_PERMISSION:"NeedPermission",INVITE_OPTIONS_FREE_ACCESS:"FreeAccess",GRP_PROFILE_OWNER_ID:"ownerID",GRP_PROFILE_CREATE_TIME:"createTime",GRP_PROFILE_LAST_INFO_TIME:"lastInfoTime",GRP_PROFILE_MEMBER_NUM:"memberNum",GRP_PROFILE_MAX_MEMBER_NUM:"maxMemberNum",GRP_PROFILE_JOIN_OPTION:"joinOption",GRP_PROFILE_INVITE_OPTION:"inviteOption",GRP_PROFILE_INTRODUCTION:"introduction",GRP_PROFILE_NOTIFICATION:"notification",GRP_PROFILE_MUTE_ALL_MBRS:"muteAllMembers",SNS_ADD_TYPE_SINGLE:"Add_Type_Single",SNS_ADD_TYPE_BOTH:"Add_Type_Both",SNS_DELETE_TYPE_SINGLE:"Delete_Type_Single",SNS_DELETE_TYPE_BOTH:"Delete_Type_Both",SNS_APPLICATION_TYPE_BOTH:"Pendency_Type_Both",SNS_APPLICATION_SENT_TO_ME:"Pendency_Type_ComeIn",SNS_APPLICATION_SENT_BY_ME:"Pendency_Type_SendOut",SNS_APPLICATION_AGREE:"Response_Action_Agree",SNS_APPLICATION_AGREE_AND_ADD:"Response_Action_AgreeAndAdd",SNS_CHECK_TYPE_BOTH:"CheckResult_Type_Both",SNS_CHECK_TYPE_SINGLE:"CheckResult_Type_Single",SNS_TYPE_NO_RELATION:"CheckResult_Type_NoRelation",SNS_TYPE_A_WITH_B:"CheckResult_Type_AWithB",SNS_TYPE_B_WITH_A:"CheckResult_Type_BWithA",SNS_TYPE_BOTH_WAY:"CheckResult_Type_BothWay",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",MSG_AT_ALL:"__kImSDK_MesssageAtALL__",READ_ALL_C2C_MSG:"readAllC2CMessage",READ_ALL_GROUP_MSG:"readAllGroupMessage",READ_ALL_MSG:"readAllMessage",USER_STATUS_UNKNOWN:0,USER_STATUS_ONLINE:1,USER_STATUS_OFFLINE:2,USER_STATUS_UNLOGINED:3},D=function(){function e(){i(this,e),this.cache=[],this.options=null}return o(e,[{key:"use",value:function(e){if("function"!=typeof e)throw"middleware must be a function";return this.cache.push(e),this}},{key:"next",value:function(e){if(this.middlewares&&this.middlewares.length>0)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}},{key:"run",value:function(e){return this.middlewares=this.cache.map((function(e){return e})),this.options=e,this.next()}}]),e}(),w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i(this,e),this.high=t,this.low=n}return o(e,[{key:"equal",value:function(e){return null!==e&&this.low===e.low&&this.high===e.high}},{key:"toString",value:function(){var e=Number(this.high).toString(16),t=Number(this.low).toString(16);if(t.length<8)for(var n=8-t.length;n;)t="0"+t,n--;return e+t}}]),e}(),A={TEST:{CHINA:{DEFAULT:"wss://wss-dev.tim.qq.com"},OVERSEA:{DEFAULT:"wss://wss-dev.tim.qq.com"},SINGAPORE:{DEFAULT:"wss://wsssgp-dev.im.qcloud.com"},KOREA:{DEFAULT:"wss://wsskr-dev.im.qcloud.com"},GERMANY:{DEFAULT:"wss://wssger-dev.im.qcloud.com"},IND:{DEFAULT:"wss://wssind-dev.im.qcloud.com"},JPN:{DEFAULT:"wss://wssjpn-dev.im.qcloud.com"},USA:{DEFAULT:"wss://wssusa-dev.im.qcloud.com"}},PRODUCTION:{CHINA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.tim.qq.com",STAT:"https://events.im.qcloud.com",ANYCAST:"wss://162.14.13.203"},OVERSEA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.my-imcloud.com",STAT:"https://api.my-imcloud.com"},SINGAPORE:{DEFAULT:"wss://wsssgp.im.qcloud.com",BACKUP:"wss://wsssgp.my-imcloud.com",STAT:"https://apisgp.my-imcloud.com"},KOREA:{DEFAULT:"wss://wsskr.im.qcloud.com",BACKUP:"wss://wsskr.my-imcloud.com",STAT:"https://apikr.my-imcloud.com"},GERMANY:{DEFAULT:"wss://wssger.im.qcloud.com",BACKUP:"wss://wssger.my-imcloud.com",STAT:"https://apiger.my-imcloud.com"},IND:{DEFAULT:"wss://wssind.my-imcloud.com",BACKUP:"wss://wssind.im.qcloud.com",STAT:"https://apiind.my-imcloud.com"},JPN:{DEFAULT:"wss://wssjpn.im.qcloud.com",BACKUP:"wss://wssjpn.my-imcloud.com",STAT:"https://apijpn.my-imcloud.com"},USA:{DEFAULT:"wss://wssusa.im.qcloud.com",BACKUP:"wss://wssusa.my-imcloud.com",STAT:"https://apiusa.my-imcloud.com"}}},R={ANDROID:2,IOS:3,MAC:4,WEB:7,WX_MP:8,QQ_MP:9,TT_MP:10,BAIDU_MP:11,ALI_MP:12,IPAD:13,UNI_NATIVE_APP:15},L="1.7.3",O=537048168,N="CHINA",P="OVERSEA",U="SINGAPORE",x="KOREA",G="GERMANY",F="IND",V="JPN",q="USA",B={HOST:{CURRENT:{DEFAULT:"wss://wss.im.qcloud.com",STAT:"https://events.im.qcloud.com"},setCurrent:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N;this.CURRENT=A.PRODUCTION[e]}},NAME:{OPEN_IM:"openim",OPEN_IM_MSG_EXT:"openim_msg_ext_http_svc",GROUP:"group_open_http_svc",GROUP_AVCHATROOM:"group_open_avchatroom_http_svc",GROUP_COMMUNITY:"million_group_open_http_svc",GROUP_ATTR:"group_open_attr_http_svc",FRIEND:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GROUP_NO_AUTH:"group_open_http_noauth_svc",BIG_GROUP_LONG_POLLING:"group_open_long_polling_http_svc",BIG_GROUP_LONG_POLLING_NO_AUTH:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",WEB_IM:"webim",IM_COS_SIGN:"im_cos_sign_svr",CUSTOM_UPLOAD:"im_cos_msg",HEARTBEAT:"heartbeat",IM_OPEN_PUSH:"im_open_push",IM_OPEN_STATUS:"im_open_status",IM_LONG_MESSAGE:"im_long_msg",IM_CONFIG_MANAGER:"im_sdk_config_mgr",STAT_SERVICE:"StatSvc",OVERLOAD_PUSH:"OverLoadPush",IM_MSG_AUDIT_MGR:"im_msg_audit_mgr",TUIROOM_SVR:"tui_room_svr",IM_OPEN_TRANSLATE:"im_open_translate"},CMD:{LOGIN:"wslogin",LOGOUT_LONG_POLL:"longpollinglogout",LOGOUT:"wslogout",HELLO:"wshello",STAT_BACKGROUND:"ws_stat_background",STAT_FOREGROUND:"ws_stat_foreground",SET_TOKEN:"ws_stat_settoken",PORTRAIT_GET:"portrait_get_all",PORTRAIT_SET:"portrait_set",GET_LONG_POLL_ID:"getlongpollingid",LONG_POLL:"longpolling",AVCHATROOM_LONG_POLL:"get_msg",ADD_FRIEND:"friend_add",UPDATE_FRIEND:"friend_update",GET_FRIEND_LIST:"friend_get",GET_FRIEND_PROFILE:"friend_get_specified",DELETE_FRIEND:"friend_delete",CHECK_FRIEND:"friend_check",GET_FRIEND_GROUP_LIST:"group_get",RESPOND_FRIEND_APPLICATION:"friend_response",GET_FRIEND_APPLICATION_LIST:"pendency_get",DELETE_FRIEND_APPLICATION:"pendency_delete",REPORT_FRIEND_APPLICATION:"pendency_report",GET_GROUP_APPLICATION:"get_pendency",CREATE_FRIEND_GROUP:"group_add",DELETE_FRIEND_GROUP:"group_delete",UPDATE_FRIEND_GROUP:"group_update",GET_BLACKLIST:"black_list_get",ADD_BLACKLIST:"black_list_add",DELETE_BLACKLIST:"black_list_delete",CREATE_GROUP:"create_group",GET_JOINED_GROUPS:"get_joined_group_list",SET_GROUP_ATTRIBUTES:"set_group_attr",MODIFY_GROUP_ATTRIBUTES:"modify_group_attr",DELETE_GROUP_ATTRIBUTES:"delete_group_attr",CLEAR_GROUP_ATTRIBUTES:"clear_group_attr",GET_GROUP_ATTRIBUTES:"get_group_attr",SEND_MESSAGE:"sendmsg",REVOKE_C2C_MESSAGE:"msgwithdraw",DELETE_C2C_MESSAGE:"delete_c2c_msg_ramble",MODIFY_C2C_MESSAGE:"modify_c2c_msg",MODIFY_C2C_MESSAGE_EXTENSIONS:"set_key_values",GET_C2C_MESSAGE_EXTENSIONS:"get_key_values",SEND_GROUP_MESSAGE:"send_group_msg",REVOKE_GROUP_MESSAGE:"group_msg_recall",DELETE_GROUP_MESSAGE:"delete_group_ramble_msg_by_seq",MODIFY_GROUP_MESSAGE:"modify_group_msg",MODIFY_GROUP_MESSAGE_EXTENSIONS:"group_set_key_values",GET_GROUP_MESSAGE_EXTENSIONS:"group_get_key_values",GET_GROUP_INFO:"get_group_self_member_info",GET_GROUP_MEMBER_INFO:"get_specified_group_member_info",GET_GROUP_MEMBER_LIST:"get_group_member_info",GET_AVCHATROOM_MEMBER_LIST:"get_members",MARK_AVCHATROOM_MEMBER_INFO:"modify_user_info",QUIT_GROUP:"quit_group",CHANGE_GROUP_OWNER:"change_group_owner",DESTROY_GROUP:"destroy_group",ADD_GROUP_MEMBER:"add_group_member",DELETE_GROUP_MEMBER:"delete_group_member",BAN_AVCHATROOM_MEMBER:"ban_group_member",SEARCH_GROUP_BY_ID:"get_group_public_info",APPLY_JOIN_GROUP:"apply_join_group",HANDLE_APPLY_JOIN_GROUP:"handle_apply_join_group",HANDLE_INVITE_JOIN_GROUP:"handle_invite_join_permission_group",HANDLE_GROUP_INVITATION:"handle_invite_join_group",MODIFY_GROUP_INFO:"modify_group_base_info",MODIFY_GROUP_MEMBER_INFO:"modify_group_member_info",DELETE_GROUP_SYSTEM_MESSAGE:"deletemsg",DELETE_GROUP_AT_TIPS:"deletemsg",GET_GROUP_NOTIFY:"get_group_notify",GET_CONVERSATION_LIST:"get",PAGING_GET_CONVERSATION_LIST:"page_get",DELETE_CONVERSATION:"batch_delete",CLEAR_HISTORY_MESSAGE:"clear_msg",PIN_CONVERSATION:"top",SET_CONVERSATION_CUSTOM_DATA:"mark_contact",MARK_CONVERSATION:"mark_contact",CREATE_CONVERSATION_GROUP:"create_contact_group",DELETE_CONVERSATION_GROUP:"del_contact_group",UPDATE_CONVERSATION_GROUP:"update_contact_group",GET_CONVERSATION_GROUP_LIST:"get_contact_group",GET_MESSAGES:"getmsg",GET_C2C_ROAM_MESSAGES:"getroammsg",SET_C2C_PEER_MUTE_NOTIFICATIONS:"set_c2c_peer_mute_notifications",GET_C2C_PEER_MUTE_NOTIFICATIONS:"get_c2c_peer_mute_notifications",GET_GROUP_ROAM_MESSAGES:"group_msg_get",GET_READ_RECEIPT:"get_group_msg_receipt",GET_READ_RECEIPT_DETAIL:"get_group_msg_receipt_detail",SEND_READ_RECEIPT:"group_msg_receipt",SEND_C2C_READ_RECEIPT:"c2c_msg_read_receipt",SET_C2C_MESSAGE_READ:"msgreaded",GET_PEER_READ_TIME:"get_peer_read_time",SET_GROUP_MESSAGE_READ:"msg_read_report",FILE_READ_AND_WRITE_AUTHKEY:"authkey",FILE_UPLOAD:"pic_up",COS_SIGN:"cos",COS_PRE_SIG:"pre_sig",VIDEO_COVER:"video_cover",TIM_WEB_REPORT_V2:"tim_web_report_v2",BIG_DATA_HALLWAY_AUTH_KEY:"authkey",GET_ONLINE_MEMBER_NUM:"get_online_member_num",ALIVE:"alive",MESSAGE_PUSH:"msg_push",MULTI_MESSAGE_PUSH:"multi_msg_push_ws",MESSAGE_PUSH_ACK:"ws_msg_push_ack",STATUS_FORCE_OFFLINE:"stat_forceoffline",DOWNLOAD_MERGER_MESSAGE:"get_relay_json_msg",UPLOAD_MERGER_MESSAGE:"save_relay_json_msg",FETCH_CLOUD_CONTROL_CONFIG:"fetch_config",PUSHED_CLOUD_CONTROL_CONFIG:"push_configv2",FETCH_COMMERCIAL_CONFIG:"fetch_imsdk_purchase_bitsv2",PUSHED_COMMERCIAL_CONFIG:"push_imsdk_purchase_bitsv2",KICK_OTHER:"KickOther",OVERLOAD_NOTIFY:"notify2",SET_ALL_MESSAGE_READ:"read_all_unread_msg",CREATE_TOPIC:"create_topic",DELETE_TOPIC:"destroy_topic",UPDATE_TOPIC_PROFILE:"modify_topic",GET_TOPIC_LIST:"get_topic",SET_SELF_STATUS:"ws_set_custom_status",GET_USER_STATUS:"ws_get_user_status",SUBSCRIBE_USER_STATUS:"ws_status_subscribe",UNSUBSCRIBE_USER_STATUS:"ws_status_unsubscribe",GET_RPOFANITY_LIST:"get_local_words",TRANSLATE_TEXT:"ws_batch_trans_text",UPDATE_GROUP_COUNTER:"update_group_counter",GET_GROUP_COUNTER:"get_group_counter"},CHANNEL:{SOCKET:1,XHR:2,AUTO:0},NAME_VERSION:{openim:"v4",group_open_http_svc:"v4",sns:"v4",profile:"v4",recentcontact:"v4",openpic:"v4",group_open_http_noauth_svc:"v4",group_open_long_polling_http_svc:"v4",group_open_long_polling_http_noauth_svc:"v4",imopenstat:"v4",im_cos_sign_svr:"v4",im_cos_msg:"v4",webim:"v4",im_open_push:"v4",im_open_status:"v4"}},H={SEARCH_MSG:new w(0,Math.pow(2,0)).toString(),SEARCH_GRP_SNS:new w(0,Math.pow(2,1)).toString(),AVCHATROOM_HISTORY_MSG:new w(0,Math.pow(2,2)).toString(),GRP_COMMUNITY:new w(0,Math.pow(2,3)).toString(),MSG_TO_SPECIFIED_GRP_MBR:new w(0,Math.pow(2,4)).toString(),AVCHATROOM_MBR_LIST:new w(0,Math.pow(2,6)).toString(),USER_STATUS:new w(0,Math.pow(2,7)).toString(),CONV_MARK:new w(0,Math.pow(2,9)).toString(),CONV_GROUP:new w(0,Math.pow(2,10)).toString(),AVCHATROOM_BAN_MBR:new w(0,Math.pow(2,11)).toString(),MSG_EXT:new w(0,Math.pow(2,13)).toString(),GRP_COUNTER:new w(0,Math.pow(2,15)).toString()},j="c2c_text_message",K="c2c_custom_message",z="group_text_message",W="group_custom_message",Y="user_profile",$="group_profile",J="group_member_profile";B.HOST.setCurrent(N);var X="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),Z="undefined"!=typeof qq&&"function"==typeof qq.getSystemInfoSync&&Boolean(qq.getSystemInfoSync().fontSizeSetting),Q="undefined"!=typeof tt&&"function"==typeof tt.getSystemInfoSync&&Boolean(tt.getSystemInfoSync().fontSizeSetting),ee="undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync&&Boolean(swan.getSystemInfoSync().fontSizeSetting),te="undefined"!=typeof my&&"function"==typeof my.getSystemInfoSync&&Boolean(my.getSystemInfoSync().fontSizeSetting),ne="undefined"!=typeof jd&&"function"==typeof jd.getSystemInfoSync,ie="undefined"!=typeof uni&&"undefined"==typeof window&&"function"==typeof uni.requireNativePlugin,re="undefined"!=typeof uni,oe=X||Z||Q||ee||te||ie||ne,ae=("undefined"!=typeof uni||"undefined"!=typeof window)&&!oe,se=Z?qq:Q?tt:ee?swan:te?my:X?wx:ie?uni:ne?jd:{},ce=ae&&window&&window.navigator&&window.navigator.userAgent||"",ue=/(micromessenger|webbrowser)/i.test(ce),le=/AppleWebKit\/([\d.]+)/i.exec(ce);le&&parseFloat(le.pop());var de,pe,he,fe=(de="WEB",ue?de="WEB":Z?de="QQ_MP":Q?de="TT_MP":ee?de="BAIDU_MP":te?de="ALI_MP":X?de="WX_MP":ie&&(de="UNI_NATIVE_APP"),R[de]),ge=/iPad/i.test(ce),me=/iPhone/i.test(ce)&&!ge,ve=/iPod/i.test(ce),_e=me||ge||ve,ye=(pe=ce.match(/OS (\d+)_/i))&&pe[1]?pe[1]:null,Ie=/Android/i.test(ce),Me=function(){var e=ce.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+"."+e[2]):t||null}();(he=ce.match(/Chrome\/(\d+)/))&&he[1]&&parseFloat(he[1]);var Te=/MSIE/.test(ce)||ce.indexOf("Trident")>-1&&ce.indexOf("rv:11.0")>-1,Ce=function(){var e=/MSIE\s(\d+)\.\d/.exec(ce),t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(ce)&&/rv:11.0/.test(ce)&&(t=11),t}();!function(){var e=ce.match(/TBS\/(\d+)/i);e&&e[1]&&e[1]}();var Se,Ee,ke=/Windows/i.test(ce),be=/MAC OS X/i.test(ce),De=ae&&"undefined"!=typeof Worker&&!Te,we=Ie||_e,Ae=ae&&void 0!==window.tencent_cloud_im_csig_flutter_for_web_25F_cy;Se="undefined"!=typeof console?console:void 0!==C&&C.console?C.console:"undefined"!=typeof window&&window.console?window.console:{};for(var Re=function(){},Le=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],Oe=Le.length;Oe--;)Ee=Le[Oe],console[Ee]||(Se[Ee]=Re);var Ne=Se,Pe=0,Ue=function(){return(new Date).getTime()+Pe},xe=function(){Pe=0},Ge=function(){return Math.floor(Ue()/1e3)},Fe=0;function Ve(){return Kt()?"%c TIM %c":"TIM"}function qe(){var e,t=((e=new Date).setTime(Ue()),e);return t.toLocaleTimeString("en-US",{hour12:!1})+"."+function(e){var t;switch(e.toString().length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}return t}(t.getMilliseconds())}var Be={arguments2String:function(e){var t="";if(1===e.length)t=e[0];else for(var n=0,i=e.length;n<i;n++)ct(e[n])?lt(e[n])?t+=ft(e[n]):t+=JSON.stringify(e[n]):t+=e[n],t+=" ";return t},_exec:function(e,t){Kt()?Ne[e](Ve(),"background:#0abf5b; padding:1px; border-radius:3px; color: #fff","background:transparent",qe(),t):Ne[e]("".concat(Ve()," ").concat(qe()," ").concat(t))},d:function(){if(Fe<=-1){var e=this.arguments2String(arguments);this._exec("debug",e)}},l:function(){if(Fe<=0){var e=this.arguments2String(arguments);this._exec("log",e)}},log:function(){if(Fe<=0){var e=this.arguments2String(arguments);this._exec("log",e)}},i:function(){if(Fe<=1){var e=this.arguments2String(arguments);this._exec("info",e)}},w:function(){if(Fe<=2){var e=this.arguments2String(arguments);this._exec("warn",e)}},e:function(){if(Fe<=3){var e=this.arguments2String(arguments);this._exec("error",e)}},setLevel:function(e){e<4&&this._exec("log","set level from "+Fe+" to "+e),Fe=e},getLevel:function(){return Fe}},He={JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255},je={NICK:"Tag_Profile_IM_Nick",GENDER:"Tag_Profile_IM_Gender",BIRTHDAY:"Tag_Profile_IM_BirthDay",LOCATION:"Tag_Profile_IM_Location",SELFSIGNATURE:"Tag_Profile_IM_SelfSignature",ALLOWTYPE:"Tag_Profile_IM_AllowType",LANGUAGE:"Tag_Profile_IM_Language",AVATAR:"Tag_Profile_IM_Image",MESSAGESETTINGS:"Tag_Profile_IM_MsgSettings",ADMINFORBIDTYPE:"Tag_Profile_IM_AdminForbidType",LEVEL:"Tag_Profile_IM_Level",ROLE:"Tag_Profile_IM_Role"},Ke={UNKNOWN:"Gender_Type_Unknown",FEMALE:"Gender_Type_Female",MALE:"Gender_Type_Male"},ze={NONE:"AdminForbid_Type_None",SEND_OUT:"AdminForbid_Type_SendOut"},We={NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_ANY:"AllowType_Type_AllowAny",DENY_ANY:"AllowType_Type_DenyAny"},Ye="JoinedSuccess",$e="WaitAdminApproval",Je="@TGS#_",Xe="@TOPIC#_",Ze=["url"],Qe=function(e){return"map"===dt(e)},et=function(e){return"file"===dt(e)},nt=function(e){return null!==e&&("number"==typeof e&&!isNaN(e-0)||"object"===n(e)&&e.constructor===Number)},it=function(e){return"string"==typeof e},rt=function(e){return null!==e&&"object"===n(e)},ot=function(e){if("object"!==n(e)||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var i=t;null!==Object.getPrototypeOf(i);)i=Object.getPrototypeOf(i);return t===i},at=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"array"===dt(e)},st=function(e){return void 0===e},ct=function(e){return at(e)||rt(e)},ut=function(e){return"function"==typeof e},lt=function(e){return e instanceof Error},dt=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()},pt=function(e){if("string"!=typeof e)return!1;var t=e[0];return!/[^a-zA-Z0-9]/.test(t)};Date.now||(Date.now=function(){return(new Date).getTime()});var ht=function e(t,n,i,r){if(!ct(t)||!ct(n))return 0;for(var o,a=0,s=Object.keys(n),c=0,u=s.length;c<u;c++)if(o=s[c],!(st(n[o])||i&&i.includes(o)))if(ct(t[o])&&ct(n[o]))a+=e(t[o],n[o],i,r);else{if(r&&r.includes(n[o]))continue;t[o]!==n[o]&&(t[o]=n[o],a+=1)}return a},ft=function(e){return JSON.stringify(e,["message","code"])},gt=function(e){if(0===e.length)return 0;for(var t=0,n=0,i="undefined"!=typeof document&&void 0!==document.characterSet?document.characterSet:"UTF-8";void 0!==e[t];)n+=e[t++].charCodeAt[t]<=255?1:!1===i?3:2;return n},mt=function(e){var t=e||99999999;return Math.round(Math.random()*t)},vt="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",_t=vt.length,yt=function(e,t){for(var n in e)if(e[n]===t)return!0;return!1},It={},Mt=function(e){return-1===e.indexOf("http://")||-1===e.indexOf("https://")?"https://"+e:e.replace(/https|http/,"https")},Tt=function e(t){if(0===Object.getOwnPropertyNames(t).length)return Object.create(null);var i=Array.isArray(t)?[]:Object.create(null),r="";for(var o in t)null!==t[o]?void 0!==t[o]?(r=n(t[o]),["string","number","function","boolean"].indexOf(r)>=0?i[o]=t[o]:i[o]=e(t[o])):i[o]=void 0:i[o]=null;return i};function Ct(e,t){if(!at(e)||!at(t))return!1;var n=!1;return t.forEach((function(t){var i=t.key,r=t.value,o=e.find((function(e){return e.key===i}));o?o.value!==r&&(o.value=r,n=!0):(e.push({key:i,value:r}),n=!0)})),n}var St=function(e){return e===b.GRP_AVCHATROOM},Et=function(e){var t=e.type,n=e.groupID;return t===b.GRP_COMMUNITY||"".concat(n).startsWith(Je)&&!"".concat(n).includes(Xe)},kt=function(e){return"".concat(e).startsWith(Je)&&"".concat(e).includes(Xe)},bt=function(e){return it(e)&&e.slice(0,3)===b.CONV_C2C},Dt=function(e){return it(e)&&e.slice(0,5)===b.CONV_GROUP},wt=function(e){return it(e)&&e===b.CONV_SYSTEM};function At(e,t){var n={};return Object.keys(e).forEach((function(i){n[i]=t(e[i],i)})),n}function Rt(e){return oe?new Promise((function(t,n){se.getImageInfo({src:e,success:function(e){t({width:e.width,height:e.height})},fail:function(){t({width:0,height:0})}})})):Te&&9===Ce?Promise.resolve({width:0,height:0}):new Promise((function(t,n){var i=new Image;i.onload=function(){t({width:this.width,height:this.height}),i=null},i.onerror=function(){t({width:0,height:0}),i=null},i.src=e}))}function Lt(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"".concat(e()+e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e())}function Ot(){var e="unknown";if(be&&(e="mac"),ke&&(e="windows"),_e&&(e="ios"),Ie&&(e="android"),oe)try{var t=se.getSystemInfoSync().platform;void 0!==t&&(e=t)}catch(n){}return e}function Nt(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length);e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(var i=0;i<n;i++){var r=parseInt(e[i]),o=parseInt(t[i]);if(r>o)return 1;if(r<o)return-1}return 0}function Pt(e){var t=e.originUrl,n=void 0===t?void 0:t,i=e.originWidth,r=e.originHeight,o=e.min,a=void 0===o?198:o,s=parseInt(i),c=parseInt(r),u={url:void 0,width:0,height:0};if((s<=c?s:c)<=a)u.url=n,u.width=s,u.height=c;else{c<=s?(u.width=Math.ceil(s*a/c),u.height=a):(u.width=a,u.height=Math.ceil(c*a/s));var l=n&&n.indexOf("?")>-1?"".concat(n,"&"):"".concat(n,"?");u.url="".concat(l,198===a?"imageView2/3/w/198/h/198":"imageView2/3/w/720/h/720")}return st(n)?(u.url,h(u,Ze)):u}function Ut(e){var t=e[2];e[2]=e[1],e[1]=t;for(var n=0;n<e.length;n++)e[n].setType(n)}function xt(e){var t=e.servcmd;return t.slice(t.indexOf(".")+1)}function Gt(e,t){return Math.round(Number(e)*Math.pow(10,t))/Math.pow(10,t)}function Ft(e,t){return e.includes(t)}function Vt(e,t){return e.includes(t)}function qt(e){return e.split(Xe)[0]}var Bt=function(e,t,n){if(st(t))return"";switch(e){case b.MSG_TEXT:return t.text;case b.MSG_IMAGE:return n?"[Image]":"[图片]";case b.MSG_LOCATION:return n?"[Location]":"[位置]";case b.MSG_AUDIO:return n?"[Voice]":"[语音]";case b.MSG_VIDEO:return n?"[Video]":"[视频]";case b.MSG_FILE:return n?"[File]":"[文件]";case b.MSG_CUSTOM:return n?"[Custom Messages]":"[自定义消息]";case b.MSG_GRP_TIP:return n?"[Group Notification]":"[群提示消息]";case b.MSG_GRP_SYS_NOTICE:return n?"[Group System Message]":"[群系统通知]";case b.MSG_FACE:return n?"[Animated Sticker]":"[动画表情]";case b.MSG_MERGER:return n?"[Chat Record]":"[聊天记录]";default:return""}};function Ht(e){return e===b.MSG_TEXT||e===b.MSG_CUSTOM||e===b.MSG_LOCATION||e===b.MSG_FACE}function jt(e){var t=[];if(!it(e))return t;var n=e.length;if(0===n)return t;for(var i=n-1;i>=0;i--)"1"===e[i]&&t.push(Math.pow(2,n-i-1));return t}function Kt(){return!Te&&!oe}function zt(e){return"the length of userIDList cannot exceed ".concat(e)}function Wt(e,t){if(e){var n=e;return t&&(e.startsWith("http://")?n=e.replace(/^http:\/\/[^/]+/,t):e.startsWith("https://")&&(n=e.replace(/^https:\/\/[^/]+/,t))),n}}var Yt=Object.prototype.hasOwnProperty;function $t(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(ot(e)){for(var t in e)if(Yt.call(e,t))return!1;return!0}return!(!Qe(e)&&(n=e,"set"!==dt(n))&&!et(e))&&0===e.size;var n}function Jt(e,t,n){if(void 0===t)return!0;var i=!0;if(ot(t))Object.keys(t).forEach((function(r){var o=1===e.length?e[0][r]:void 0;i=!!Xt(o,t[r],n,r)&&i}));else if(at(t))for(var r=0;r<t.length;r++)i=!!Xt(e[r],t[r],n,t[r].name)&&i;if(i)return i;throw new Error("Params validate failed.")}function Xt(e,t,n,i){if(void 0===t)return!0;var r=!0;if(t.required&&$t(e)&&(Be.e("[".concat(n,'] Missing required params: "').concat(i,'".')),r=!1),!$t(e)){var o=dt(e),a=t.type.toLowerCase();o!==a&&("asyncfunction"===o&&"function"===a||(Be.e("[".concat(n,'] Invalid params: type check failed for "').concat(i,'".Expected ').concat(t.type,".")),r=!1))}return t.validator&&!t.validator(e)&&(Be.e("[".concat(n,"] Invalid params: custom validator check failed for params.")),r=!1),r}var Zt,Qt={UNSEND:"unSend",SUCCESS:"success",FAIL:"fail"},en={NOT_START:"notStart",PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"},tn=function(e){if(!e)return!1;if(bt(e)||Dt(e)||wt(e))return!0;var t=Dn("InvalidConversationID",e);return t&&Be.w(t),!1},nn=function(e){""!==e.desc&&""!==Dn("API_REFER")&&Be.w("[".concat(e.api,"] | ").concat(e.param," | ").concat(e.desc,", ").concat(Dn("API_REFER")).concat(e.api))},rn=function(){return Dn("StringRequiredLog")},on=function(e){return Dn("NonEmptyStringRequiredLog",e)},an=function(){return Dn("NumberRequiredLog")},sn=function(){return Dn("UndefinedNotAllowedLog")},cn=function(){return Dn("FileRequiredLog")},un=function(){return Dn("FunctionRequiredLog")},ln=function(){return Dn("ArrayRequiredLog")},dn=function(){return Dn("NonEmptyArrayLog")},pn=function(){return Dn("CallbackMissingLog")},hn=function(){return Dn("PositiveIntegerRequiredLog")},fn=function(e,t){return Dn("StringNotLongerThanLog",e,t)},gn=function(e,t){return Dn("NumberLessThanLog",e,t)},mn=function(e){return Dn("KeyValueStringRequiredLog",e)},vn=function(){return Dn("PlainObjectRequiredLog")},_n=function(){return Dn("NonEmptyContentRequiredLog")},yn=function(){return Dn("FileNotSelectedLog")},In=function(){return Dn("MessageInstanceRequiredLog")},Mn=function(){return Dn("NonAnonymousFunctionLog")},Tn=function(){return Dn("MessageExtensionNotAvailableLog")},Cn={type:"String",required:!0},Sn={type:"Array",required:!0},En={type:"Object",required:!0},kn={type:"Boolean",required:!0},bn={type:"number",required:!0},Dn=null,wn={hookGetAPITips:function(e){Dn=e},login:{userID:Cn,userSig:Cn},addToBlacklist:{userIDList:Sn},removeFromBlacklist:{userIDList:Sn},on:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(nn({api:"on",param:"eventName",desc:on("eventName")}),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(nn({api:"on",param:"handler",desc:un()}),!1):(""===e.name&&nn({api:"on",param:"handler",desc:Mn()}),!0)}}],once:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(nn({api:"once",param:"eventName",desc:on("eventName")}),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(nn({api:"once",param:"handler",desc:un()}),!1):(""===e.name&&nn({api:"once",param:"handler",desc:Mn()}),!0)}}],off:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(nn({api:"off",param:"eventName",desc:on("eventName")}),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(nn({api:"off",param:"handler",desc:un()}),!1):(""===e.name&&nn({api:"off",param:"handler",desc:Mn()}),!0)}}],sendMessage:[t({name:"message"},En)],setMessageExtensions:[t(t({name:"message"},En),{},{validator:function(e){return e.status===Qt.SUCCESS&&!0===e.isSupportExtension||(nn({api:"setMessageExtensions",param:"message",desc:Tn()}),!1)}}),t({name:"extensions"},Sn)],getMessageExtensions:[t(t({name:"message"},En),{},{validator:function(e){return e.status===Qt.SUCCESS&&!0===e.isSupportExtension||(nn({api:"getMessageExtensions",param:"message",desc:Tn()}),!1)}})],deleteMessageExtensions:[t(t({name:"message"},En),{},{validator:function(e){return e.status===Qt.SUCCESS&&!0===e.isSupportExtension||(nn({api:"deleteMessageExtensions",param:"message",desc:Tn()}),!1)}})],getMessageList:{conversationID:t(t({},Cn),{},{validator:function(e){return tn(e)}}),nextReqMessageID:{type:"String"},count:{type:"Number",validator:function(e){return!(!st(e)&&!/^[1-9][0-9]*$/.test(e)&&(nn({api:"getMessageList",param:"count",desc:hn()}),1))}}},getMessageListHopping:{conversationID:t(t({},Cn),{},{validator:function(e){return tn(e)}}),sequence:{type:"Number"},time:{type:"Number"},direction:{type:"Number",validator:function(e){return!(!st(e)&&0!==e&&1!==e&&(nn({api:"getMessageListHopping",param:"direction",desc:Dn("0Or1RequiredLog")}),1))}},count:{type:"Number",validator:function(e){return!(!st(e)&&!/^[1-9][0-9]*$/.test(e)&&(nn({api:"getMessageListHopping",param:"count",desc:hn}),1))}}},setMessageRead:{conversationID:t(t({},Cn),{},{validator:function(e){return tn(e)}})},setAllMessageRead:{scope:{type:"String",required:!1,validator:function(e){return!e||-1!==[b.READ_ALL_C2C_MSG,b.READ_ALL_GROUP_MSG,b.READ_ALL_MSG].indexOf(e)||(nn({api:"setAllMessageRead",param:"scope",desc:"TIM.TYPES.READ_ALL_C2C_MSG or TIM.TYPES.READ_ALL_GROUP_MSG or TIM.TYPES.READ_ALL_MSG required"}),!1)}}},getConversationProfile:[t(t({name:"conversationID"},Cn),{},{validator:function(e){return tn(e)}})],clearHistoryMessage:[t(t({name:"conversationID"},Cn),{},{validator:function(e){return tn(e)}})],pinConversation:{conversationID:t(t({},Cn),{},{validator:function(e){return tn(e)}}),isPinned:t({},kn)},setConversationCustomData:{conversationIDList:t({},Sn),customData:{type:"String",validator:function(e){return it(e)?!(e.length>256&&(nn({api:"setConversationCustomData",param:"customData",desc:fn("customData",256)}),1)):(nn({api:"setConversationCustomData",param:"customData",desc:rn()}),!1)}}},markConversation:{conversationIDList:t({},Sn),markType:{type:"number",validator:function(e){return nt(e)?e<=0?(nn({api:"markConversation",param:"markType",desc:(t="markType",n=0,Dn("NumberGreaterThanLog",t,n))}),!1):!(e>=Math.pow(2,64)&&(nn({api:"markConversation",param:"markType",desc:gn("markType","Math.pow(2,64)")}),1)):(nn({api:"markConversation",param:"markType",desc:an()}),!1);var t,n}},enableMark:t({},kn)},createConversationGroup:{conversationIDList:t({},Sn),groupName:t(t({},Cn),{},{validator:function(e){return!(!e||e.length>32&&(nn({api:"createConversationGroup",param:"groupName",desc:fn("groupName",32)}),1))}})},deleteConversationGroup:[t({name:"groupName"},Cn)],renameConversationGroup:{oldName:t({},Cn),newName:t(t({},Cn),{},{validator:function(e){return!(!e||e.length>32&&(nn({api:"renameConversationGroup",param:"newName",desc:fn("newName",32)}),1))}})},addConversationsToGroup:{conversationIDList:t({},Sn),groupName:t({},Cn)},deleteConversationsFromGroup:{conversationIDList:t({},Sn),groupName:t({},Cn)},getGroupList:{groupProfileFilter:{type:"Array"}},getGroupProfile:{groupID:Cn,groupCustomFieldFilter:{type:"Array"},memberCustomFieldFilter:{type:"Array"}},getGroupProfileAdvance:{groupIDList:Sn},createGroup:{name:Cn},joinGroup:{groupID:Cn,type:{type:"String"},applyMessage:{type:"String"}},quitGroup:[t({name:"groupID"},Cn)],handleApplication:{message:En,handleAction:Cn,handleMessage:{type:"String"}},changeGroupOwner:{groupID:Cn,newOwnerID:Cn},updateGroupProfile:{groupID:Cn,muteAllMembers:{type:"Boolean"}},dismissGroup:[t({name:"groupID"},Cn)],searchGroupByID:[t({name:"groupID"},Cn)],initGroupAttributes:{groupID:Cn,groupAttributes:t(t({},En),{},{validator:function(e){var t=!0;return Object.keys(e).forEach((function(n){if(!it(e[n]))return nn({api:"initGroupAttributes",param:"groupAttributes",desc:mn("value")}),t=!1})),t}})},setGroupAttributes:{groupID:Cn,groupAttributes:t(t({},En),{},{validator:function(e){var t=!0;return Object.keys(e).forEach((function(n){if(!it(e[n]))return nn({api:"setGroupAttributes",param:"groupAttributes",desc:mn("value")}),t=!1})),t}})},deleteGroupAttributes:{groupID:Cn,keyList:{type:"Array",validator:function(e){if(st(e)||!at(e))return nn({api:"deleteGroupAttributes",param:"keyList",desc:ln()}),!1;if(!$t(e)){var t=!0;return e.forEach((function(e){if(!it(e))return nn({api:"deleteGroupAttributes",param:"keyList",desc:Dn("StringArrayRequiredLog")}),t=!1})),t}return!0}}},getGroupAttributes:{groupID:Cn,keyList:{type:"Array",validator:function(e){if(st(e)||!at(e))return nn({api:"getGroupAttributes",param:"keyList",desc:ln()}),!1;if(!$t(e)){var t=!0;return e.forEach((function(e){if(!it(e))return nn({api:"getGroupAttributes",param:"keyList",desc:mn("key")}),t=!1})),t}return!0}}},setGroupCounters:{groupID:Cn,counters:En},increaseGroupCounter:{groupID:Cn,key:Cn,value:bn},decreaseGroupCounter:{groupID:Cn,key:Cn,value:bn},getGroupCounters:{groupID:Cn},getGroupMemberList:{groupID:Cn,count:{type:"Number"}},getGroupMemberProfile:{groupID:Cn,userIDList:Sn,memberCustomFieldFilter:{type:"Array"}},addGroupMember:{groupID:Cn,userIDList:Sn},setGroupMemberRole:{groupID:Cn,userID:Cn,role:Cn},setGroupMemberMuteTime:{groupID:Cn,userID:Cn,muteTime:{type:"Number",validator:function(e){return e>=0}}},setGroupMemberNameCard:{groupID:Cn,userID:{type:"String"},nameCard:{type:"String",validator:function(e){return it(e)?(e.length,!0):(nn({api:"setGroupMemberNameCard",param:"nameCard",desc:rn()}),!1)}}},setGroupMemberCustomField:{groupID:Cn,userID:{type:"String"},memberCustomField:Sn},deleteGroupMember:{groupID:Cn},markGroupMemberList:{groupID:Cn,markType:{type:"number",validator:function(e){return nt(e)?!(e<1e3&&(nn({api:"markGroupMemberList",param:"markType",desc:(t="markType",n=1e3,Dn("NumberGreaterOrEqualLog",t,n))}),1)):(nn({api:"markGroupMemberList",param:"markType",desc:an()}),!1);var t,n}},userIDList:t({},Sn),enableMark:t({},kn)},createTextMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){return ot(e)?it(e.text)?0!==e.text.length||(nn({api:"createTextMessage",param:"payload.text",desc:_n()}),!1):(nn({api:"createTextMessage",param:"payload.text",desc:rn()}),!1):(nn({api:"createTextMessage",param:"payload",desc:vn()}),!1)}})},createTextAtMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){return ot(e)?it(e.text)?0===e.text.length?(nn({api:"createTextAtMessage",param:"payload.text",desc:_n()}),!1):!(e.atUserList&&!at(e.atUserList)&&(nn({api:"createTextAtMessage",param:"payload.atUserList",desc:ln()}),1)):(nn({api:"createTextAtMessage",param:"payload.text",desc:rn()}),!1):(nn({api:"createTextAtMessage",param:"payload",desc:vn()}),!1)}})},createCustomMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){return ot(e)?e.data&&!it(e.data)?(nn({api:"createCustomMessage",param:"payload.data",desc:rn()}),!1):e.description&&!it(e.description)?(nn({api:"createCustomMessage",param:"payload.description",desc:rn()}),!1):!(e.extension&&!it(e.extension)&&(nn({api:"createCustomMessage",param:"payload.extension",desc:rn()}),1)):(nn({api:"createCustomMessage",param:"payload",desc:vn()}),!1)}})},createImageMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){if(!ot(e))return nn({api:"createImageMessage",param:"payload",desc:vn()}),!1;if(st(e.file))return nn({api:"createImageMessage",param:"payload.file",desc:sn()}),!1;if(ae){if(!(e.file instanceof HTMLInputElement||et(e.file)))return ot(e.file)&&"undefined"!=typeof uni?0!==e.file.tempFilePaths.length&&0!==e.file.tempFiles.length||(nn({api:"createImageMessage",param:"payload.file",desc:yn()}),!1):(nn({api:"createImageMessage",param:"payload.file",desc:cn()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return nn({api:"createImageMessage",param:"payload.file",desc:yn()}),!1}return!0},onProgress:{type:"Function",required:!1,validator:function(e){return st(e)&&nn({api:"createImageMessage",param:"onProgress",desc:pn()}),!0}}})},createAudioMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){return!!ot(e)||(nn({api:"createAudioMessage",param:"payload",desc:vn()}),!1)}}),onProgress:{type:"Function",required:!1,validator:function(e){return st(e)&&nn({api:"createAudioMessage",param:"onProgress",desc:pn()}),!0}}},createVideoMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){if(!ot(e))return nn({api:"createVideoMessage",param:"payload",desc:vn()}),!1;if(st(e.file))return nn({api:"createVideoMessage",param:"payload.file",desc:sn()}),!1;if(ae){if(!(e.file instanceof HTMLInputElement||et(e.file)))return ot(e.file)&&"undefined"!=typeof uni?!!et(e.file.tempFile)||(nn({api:"createVideoMessage",param:"payload.file",desc:yn()}),!1):(nn({api:"createVideoMessage",param:"payload.file",desc:cn()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return nn({api:"createVideoMessage",param:"payload.file",desc:yn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e){return st(e)&&nn({api:"createVideoMessage",param:"onProgress",desc:pn()}),!0}}},createFaceMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){return ot(e)?nt(e.index)?!!it(e.data)||(nn({api:"createFaceMessage",param:"payload.data",desc:rn()}),!1):(nn({api:"createFaceMessage",param:"payload.index",desc:an()}),!1):(nn({api:"createFaceMessage",param:"payload",desc:vn()}),!1)}})},createFileMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){if(!ot(e))return nn({api:"createFileMessage",param:"payload",desc:vn()}),!1;if(st(e.file))return nn({api:"createFileMessage",param:"payload.file",desc:sn()}),!1;if(ae){if(!(e.file instanceof HTMLInputElement||et(e.file)))return ot(e.file)&&"undefined"!=typeof uni?0!==e.file.tempFilePaths.length&&0!==e.file.tempFiles.length||(nn({api:"createFileMessage",param:"payload.file",desc:yn()}),!1):(nn({api:"createFileMessage",param:"payload.file",desc:cn()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return nn({api:"createFileMessage",param:"payload.file",desc:yn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e){return st(e)&&nn({api:"createFileMessage",param:"onProgress",desc:pn()}),!0}}},createLocationMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){return ot(e)?it(e.description)?nt(e.longitude)?!!nt(e.latitude)||(nn({api:"createLocationMessage",param:"payload.latitude",desc:an()}),!1):(nn({api:"createLocationMessage",param:"payload.longitude",desc:an()}),!1):(nn({api:"createLocationMessage",param:"payload.description",desc:rn()}),!1):(nn({api:"createLocationMessage",param:"payload",desc:vn()}),!1)}})},createMergerMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){if($t(e.messageList))return nn({api:"createMergerMessage",param:"payload.messageList",desc:dn()}),!1;if($t(e.compatibleText))return nn({api:"createMergerMessage",param:"payload.compatibleText",desc:on("compatibleText")}),!1;var t=!1;return e.messageList.forEach((function(e){e.status===Qt.FAIL&&(t=!0)})),!t||(nn({api:"createMergerMessage",param:"payload.messageList",desc:Dn("MergeFailedMessageLog")}),!1)}})},revokeMessage:[t(t({name:"message"},En),{},{validator:function(e){return $t(e)?(nn({api:"revokeMessage",param:"message",desc:In()}),!1):e.conversationType===b.CONV_SYSTEM?(nn({api:"revokeMessage",param:"message",desc:Dn("MessageCanBeRevokedDesc")}),!1):!0!==e.isRevoked||(nn({api:"revokeMessage",param:"message",desc:Dn("MessageRevokedLog")}),!1)}})],deleteMessage:[t(t({name:"messageList"},Sn),{},{validator:function(e){return!$t(e)||(nn({api:"deleteMessage",param:"messageList",desc:dn()}),!1)}})],translateText:{sourceTextList:Sn,sourceLanguage:Cn,targetLanguage:Cn},modifyMessage:[t(t({name:"message"},En),{},{validator:function(e){return $t(e)?(nn({api:"modifyMessage",param:"message",desc:In()}),!1):e.conversationType===b.CONV_SYSTEM?(nn({api:"modifyMessage",param:"message",desc:Dn("MessageCanBeModifiedLog")}),!1):!0!==e._onlineOnlyFlag||(nn({api:"modifyMessage",param:"message",desc:Dn("OnlineMessageNotSupportLog")}),!1)}})],getUserProfile:{userIDList:{type:"Array",validator:function(e){return at(e)?(0===e.length&&nn({api:"getUserProfile",param:"userIDList",desc:dn()}),!0):(nn({api:"getUserProfile",param:"userIDList",desc:ln()}),!1)}}},updateMyProfile:{profileCustomField:{type:"Array",validator:function(e){return!!st(e)||!!at(e)||(nn({api:"updateMyProfile",param:"profileCustomField",desc:ln()}),!1)}}},setSelfStatus:{customStatus:{type:"String",validator:function(e){return!!it(e)||(nn({api:"setSelfStatus",param:"customStatus",desc:rn()}),!1)}}},getUserStatus:{userIDList:{type:"Array",validator:function(e){return at(e)?0!==e.length||(nn({api:"getUserStatus",param:"userIDList",desc:dn()}),!1):(nn({api:"getUserStatus",param:"userIDList",desc:ln()}),!1)}}},subscribeUserStatus:{userIDList:{type:"Array",validator:function(e){return at(e)?0!==e.length||(nn({api:"subscribeUserStatus",param:"userIDList",desc:dn()}),!1):(nn({api:"subscribeUserStatus",param:"userIDList",desc:ln()}),!1)}}},unsubscribeUserStatus:{userIDList:{type:"Array",validator:function(e){return!e||!!at(e)||(nn({api:"subscribeUserStatus",param:"userIDList",desc:ln()}),!1)}}},addFriend:{to:Cn,source:{type:"String",required:!0,validator:function(e){return!(!e||(e.startsWith("AddSource_Type_")?e.replace("AddSource_Type_","").length>8&&(nn({api:"addFriend",param:"source",desc:fn("keyword",8)}),1):(nn({api:"addFriend",param:"source",desc:Dn("SourcePrefixLog")}),1)))}},remark:{type:"String",required:!1,validator:function(e){return!(it(e)&&e.length>96&&(nn({api:"addFriend",param:"remark",desc:fn("remark",96)}),1))}}},deleteFriend:{userIDList:Sn},checkFriend:{userIDList:Sn},getFriendProfile:{userIDList:Sn},updateFriend:{userID:Cn,remark:{type:"String",required:!1,validator:function(e){return!(it(e)&&e.length>96&&(nn({api:"updateFriend",param:"remark",desc:fn("remark",96)}),1))}},friendCustomField:{type:"Array",required:!1,validator:function(e){if(e){if(!at(e))return nn({api:"updateFriend",param:"friendCustomField",desc:ln()}),!1;var t=!0;return e.forEach((function(e){return it(e.key)&&-1!==e.key.indexOf("Tag_SNS_Custom")?it(e.value)?e.key.replace("Tag_SNS_Custom_","").length>8?(nn({api:"updateFriend",param:"friendCustomField",desc:fn("keyword",8)}),t=!1):void 0:(nn({api:"updateFriend",param:"friendCustomField",desc:mn("value")}),t=!1):(nn({api:"updateFriend",param:"friendCustomField",desc:Dn("FriendCustomFieldPrefixLog")}),t=!1)})),t}return!0}}},acceptFriendApplication:{userID:Cn},refuseFriendApplication:{userID:Cn},deleteFriendApplication:{userID:Cn},createFriendGroup:{name:Cn},deleteFriendGroup:{name:Cn},addToFriendGroup:{name:Cn,userIDList:Sn},removeFromFriendGroup:{name:Cn,userIDList:Sn},renameFriendGroup:{oldName:Cn,newName:Cn},sendMessageReadReceipt:[{name:"messageList",type:"Array",validator:function(e){return at(e)?0!==e.length||(nn({api:"sendMessageReadReceipt",param:"messageList",desc:dn()}),!1):(nn({api:"sendMessageReadReceipt",param:"messageList",desc:ln()}),!1)}}],getMessageReadReceiptList:[{name:"messageList",type:"Array",validator:function(e){return at(e)?0!==e.length||(nn({api:"getMessageReadReceiptList",param:"messageList",desc:dn()}),!1):(nn({api:"getMessageReadReceiptList",param:"messageList",desc:ln()}),!1)}}],createTopicInCommunity:{groupID:Cn,topicName:Cn},deleteTopicFromCommunity:{groupID:Cn,topicIDList:{type:"Array",validator:function(e){return!e||!!at(e)||(nn({api:"deleteTopicFromCommunity",param:"topicIDList",desc:ln()}),!1)}}},updateTopicProfile:{groupID:Cn,topicID:Cn},getTopicList:{groupID:Cn,topicIDList:{type:"Array",validator:function(e){return!e||!!at(e)||(nn({api:"getTopicList",param:"topicIDList",desc:ln()}),!1)}}}},An={login:1,logout:1,on:1,once:1,off:1,setLogLevel:1,registerPlugin:1,destroy:1,createTextMessage:1,createTextAtMessage:1,createImageMessage:1,createAudioMessage:1,createVideoMessage:1,createCustomMessage:1,createFaceMessage:1,createFileMessage:1,createLocationMessage:1,createMergerMessage:1,downloadMergerMessage:1,createForwardMessage:1,sendMessage:1,resendMessage:1,revokeMessage:1,deleteMessage:1,translateText:1,modifyMessage:1,sendMessageReadReceipt:1,getGroupMessageReadMemberList:1,getMessageReadReceiptList:1,setMessageExtensions:1,getMessageExtensions:1,deleteMessageExtensions:1,getMessageList:1,findMessage:1,getMessageListHopping:1,setMessageRead:1,setAllMessageRead:1,getConversationList:1,getConversationProfile:1,deleteConversation:1,pinConversation:1,getTotalUnreadMessageCount:1,setConversationCustomData:1,markConversation:1,createConversationGroup:1,getConversationGroupList:1,deleteConversationGroup:1,renameConversationGroup:1,addConversationsToGroup:1,deleteConversationsFromGroup:1,clearHistoryMessage:1,getGroupList:1,getGroupProfile:1,createGroup:1,joinGroup:1,updateGroupProfile:1,quitGroup:1,dismissGroup:1,changeGroupOwner:1,searchGroupByID:1,setMessageRemindType:1,getGroupApplicationList:1,handleGroupApplication:1,initGroupAttributes:1,setGroupAttributes:1,deleteGroupAttributes:1,getGroupAttributes:1,setGroupCounters:1,increaseGroupCounter:1,decreaseGroupCounter:1,getGroupCounters:1,getJoinedCommunityList:1,createTopicInCommunity:1,deleteTopicFromCommunity:1,updateTopicProfile:1,getTopicList:1,getGroupMemberProfile:1,getGroupMemberList:1,addGroupMember:1,deleteGroupMember:1,setGroupMemberNameCard:1,setGroupMemberMuteTime:1,setGroupMemberRole:1,setGroupMemberCustomField:1,getGroupOnlineMemberCount:1,markGroupMemberList:1,getMyProfile:1,getUserProfile:1,updateMyProfile:1,setSelfStatus:1,getUserStatus:1,subscribeUserStatus:1,unsubscribeUserStatus:1,getBlacklist:1,addToBlacklist:1,removeFromBlacklist:1,getFriendList:1,addFriend:1,deleteFriend:1,checkFriend:1,updateFriend:1,getFriendProfile:1,getFriendApplicationList:1,refuseFriendApplication:1,deleteFriendApplication:1,acceptFriendApplication:1,setFriendApplicationRead:1,getFriendGroupList:1,createFriendGroup:1,renameFriendGroup:1,deleteFriendGroup:1,addToFriendGroup:1,removeFromFriendGroup:1,callExperimentalAPI:1},Rn=1,Ln=2,On=3,Nn=4,Pn=6,Un=7,xn=8,Gn=9,Fn=10,Vn=11,qn=12,Bn=13,Hn=14,jn=15,Kn=16,zn=17,Wn=18,Yn=19,$n=20,Jn=21,Xn=22,Zn=23,Qn=24,ei=25,ti=26,ni=27,ii=28,ri=29,oi=30,ai=31,si=32,ci=function(){function e(t){i(this,e),this._m=t,this._n=""}return o(e,[{key:"isLoggedIn",value:function(){return this._m.getModule(qn).isLoggedIn()}},{key:"isOversea",value:function(){return this._m.getModule(qn).isOversea()}},{key:"isPrivateNetWork",value:function(){return this._m.getModule(qn).isPrivateNetWork()}},{key:"getFileDownloadProxy",value:function(){return this._m.getModule(qn).getFileDownloadProxy()}},{key:"getMyUserID",value:function(){return this._m.getModule(qn).getUserID()}},{key:"getMyTinyID",value:function(){return this._m.getModule(qn).getTinyID()}},{key:"getSDKAppID",value:function(){return this._m.getModule(qn).getSDKAppID()}},{key:"isIntl",value:function(){return this._m.getModule(qn).isIntl()}},{key:"isDevMode",value:function(){return this._m.getModule(qn).isDevMode()}},{key:"getModule",value:function(e){return this._m.getModule(e)}},{key:"getPlatform",value:function(){return fe}},{key:"getNetworkType",value:function(){return this._m.getModule(jn).getNetworkType()}},{key:"probeNetwork",value:function(e){return this._m.getModule(jn).probe(e)}},{key:"getCloudConfig",value:function(e){return this._m.getModule(Zn).getCloudConfig(e)}},{key:"emitOuterEvent",value:function(e,t){this._m.getOuterEmitterInstance().emit(e,t)}},{key:"emitInnerEvent",value:function(e,t){this._m.getInnerEmitterInstance().emit(e,t)}},{key:"getInnerEmitterInstance",value:function(){return this._m.getInnerEmitterInstance()}},{key:"generateTjgID",value:function(e){return this._m.getModule(qn).getTinyID()+"-"+e.random}},{key:"filterModifiedMessage",value:function(e){if(!$t(e)){var t=e.filter((function(e){return!0===e.isModified}));t.length>0&&this.emitOuterEvent(k.MESSAGE_MODIFIED,t)}}},{key:"filterUnmodifiedMessage",value:function(e){return $t(e)?[]:e.filter((function(e){return!1===e.isModified}))}},{key:"request",value:function(e){return this._m.getModule($n).request(e)}},{key:"canIUse",value:function(e){return this._m.getModule(ni).canIUse(e)}},{key:"getErrorMessage",value:function(e,t,n){return this._m.getErrorMessage(e,t,n)}},{key:"outputWarning",value:function(e,t,n){var i=this.getErrorMessage(e,t,n);i&&Be.w(i)}}]),e}(),ui="wslogin",li="wslogout",di="wshello",pi="KickOther",hi="getmsg",fi="authkey",gi="sendmsg",mi="send_group_msg",vi="portrait_get_all",_i="portrait_set",yi="black_list_get",Ii="black_list_add",Mi="black_list_delete",Ti="msgwithdraw",Ci="msgreaded",Si="set_c2c_peer_mute_notifications",Ei="get_c2c_peer_mute_notifications",ki="getroammsg",bi="get_peer_read_time",Di="delete_c2c_msg_ramble",wi="modify_c2c_msg",Ai="set_key_values",Ri="get_key_values",Li="page_get",Oi="get",Ni="batch_delete",Pi="clear_msg",Ui="top",xi="deletemsg",Gi="set_conv_custom_data",Fi="mark_contact",Vi="create_contact_group",qi="del_contact_group",Bi="update_contact_group",Hi="add_conv_to_group",ji="del_conv_from_group",Ki="get_contact_group",zi="get_joined_group_list",Wi="get_group_self_member_info",Yi="create_group",$i="destroy_group",Ji="modify_group_base_info",Xi="apply_join_group",Zi="apply_join_group_noauth",Qi="quit_group",er="get_group_public_info",tr="change_group_owner",nr="handle_apply_join_group",ir="handle_invite_join_permission_group",rr="handle_invite_join_group",or="group_msg_recall",ar="msg_read_report",sr="read_all_unread_msg",cr="group_msg_get",ur="get_group_msg_receipt",lr="group_msg_receipt",dr="c2c_msg_read_receipt",pr="get_group_msg_receipt_detail",hr="get_pendency",fr="deletemsg",gr="get_msg",mr="get_msg_noauth",vr="get_online_member_num",_r="delete_group_ramble_msg_by_seq",yr="modify_group_msg",Ir="set_group_attr",Mr="modify_group_attr",Tr="delete_group_attr",Cr="clear_group_attr",Sr="get_group_attr",Er="group_set_key_values",kr="group_get_key_values",br="get_group_notify",Dr="update_group_counter",wr="get_group_counter",Ar="get_group_member_info",Rr="get_members",Lr="get_specified_group_member_info",Or="add_group_member",Nr="delete_group_member",Pr="ban_group_member",Ur="modify_group_member_info",xr="modify_user_info",Gr="cos",Fr="pre_sig",Vr="video_cover",qr="tim_web_report_v2",Br="alive",Hr="msg_push",jr="multi_msg_push_ws",Kr="ws_msg_push_ack",zr="stat_forceoffline",Wr="save_relay_json_msg",Yr="get_relay_json_msg",$r="fetch_config",Jr="push_configv2",Xr="fetch_imsdk_purchase_bitsv2",Zr="push_imsdk_purchase_bitsv2",Qr="notify2",eo="create_topic",to="destroy_topic",no="modify_topic",io="get_topic",ro="ws_set_custom_status",oo="ws_get_user_status",ao="ws_status_subscribe",so="ws_status_unsubscribe",co="ws_stat_background",uo="ws_stat_foreground",lo="ws_stat_settoken",po="get_local_words",ho="ws_batch_trans_text",fo={NO_SDKAPPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USERSIG:2003,NO_TINYID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,REPEAT_LOGIN:2025,COS_UNDETECTED:2040,COS_GET_SIG_FAIL:2041,MESSAGE_SEND_FAIL:2100,MESSAGE_SEND_FAIL_NOT_IN_AVCHATROOM:2101,MESSAGE_SEND_NEED_MESSAGE_INSTANCE:2105,MESSAGE_SEND_INVALID_CONVERSATION_TYPE:2106,MESSAGE_FILE_IS_EMPTY:2108,MESSAGE_ONPROGRESS_FUNCTION_ERROR:2109,MESSAGE_REVOKE_FAIL:2110,MESSAGE_DELETE_FAIL:2111,MESSAGE_UNREAD_ALL_FAIL:2112,READ_RECEIPT_MESSAGE_LIST_EMPTY:2114,MESSAGE_SEND_GROUP_WITH_TOPIC_FAIL:2115,CANNOT_DELETE_GROUP_SYSTEM_NOTICE:2116,TRANSLATE_TEXT_FAIL:2117,MESSAGE_IMAGE_SELECT_FILE_FIRST:2251,MESSAGE_IMAGE_TYPES_LIMIT:2252,MESSAGE_IMAGE_SIZE_LIMIT:2253,MESSAGE_AUDIO_UPLOAD_FAIL:2300,MESSAGE_AUDIO_SIZE_LIMIT:2301,MESSAGE_VIDEO_UPLOAD_FAIL:2350,MESSAGE_VIDEO_SIZE_LIMIT:2351,MESSAGE_VIDEO_TYPES_LIMIT:2352,MESSAGE_FILE_UPLOAD_FAIL:2400,MESSAGE_FILE_SELECT_FILE_FIRST:2401,MESSAGE_FILE_SIZE_LIMIT:2402,MESSAGE_FILE_URL_IS_EMPTY:2403,MESSAGE_MERGER_TYPE_INVALID:2450,MESSAGE_MERGER_KEY_INVALID:2451,MESSAGE_MERGER_DOWNLOAD_FAIL:2452,MESSAGE_FORWARD_TYPE_INVALID:2453,MESSAGE_MODIFY_CONFLICT:2480,MESSAGE_MODIFY_DISABLED_IN_AVCHATROOM:2481,CONVERSATION_NOT_FOUND:2500,USER_OR_GROUP_NOT_FOUND:2501,CONVERSATION_UN_RECORDED_TYPE:2502,INVALID_CONVERSATION_ID:2503,ILLEGAL_GROUP_TYPE:2600,CANNOT_JOIN_WORK:2601,ILLEGAL_GROUP_ID:2602,CANNOT_FIND_GROUP:2603,CANNOT_CHANGE_OWNER_IN_AVCHATROOM:2620,CANNOT_CHANGE_OWNER_TO_SELF:2621,CANNOT_DISMISS_WORK:2622,MEMBER_NOT_IN_GROUP:2623,JOIN_GROUP_FAIL:2660,CANNOT_ADD_MEMBER_IN_AVCHATROOM:2661,CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN:2662,NOT_OWNER:2681,CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM:2682,INVALID_MEMBER_ROLE:2683,CANNOT_SET_SELF_MEMBER_ROLE:2684,CANNOT_MUTE_SELF:2685,BAN_DURATION_INVALID:2686,NOT_MY_FRIEND:2700,ALREADY_MY_FRIEND:2701,FRIEND_GROUP_EXISTED:2710,FRIEND_GROUP_NOT_EXIST:2711,FRIEND_APPLICATION_NOT_EXIST:2716,UPDATE_PROFILE_INVALID_PARAM:2721,UPDATE_PROFILE_NO_KEY:2722,CANNOT_ADD_SELF_TO_BLACKLIST:2742,NETWORK_ERROR:2800,NETWORK_TIMEOUT:2801,NO_NETWORK:2805,UNCAUGHT_ERROR:2903,INVALID_OPERATION:2905,OVER_FREQUENCY_LIMIT:2996,CANNOT_FIND_PROTOCOL:2997,CANNOT_FIND_MODULE:2998,SDK_IS_NOT_READY:2999,LOGGING_IN:3e3,LOGIN_FAILED:3001,KICKED_OUT_MULT_DEVICE:3002,KICKED_OUT_MULT_ACCOUNT:3003,KICKED_OUT_USERSIG_EXPIRED:3004,LOGGED_OUT:3005,KICKED_OUT_REST_API:3006,ILLEGAL_TOPIC_ID:3021,CANNOT_USE_COMMERCIAL_ABILITY:3122,PROFANITY_FOUND:3123,MESSAGE_A2KEY_EXPIRED:20002,ACCOUNT_A2KEY_EXPIRED:70001,HELLO_ANSWER_KICKED_OUT:1002,OPEN_SERVICE_OVERLOAD_ERROR:60022},go="networkRTT",mo="messageE2EDelay",vo="sendMessageC2C",_o="sendMessageGroup",yo="sendMessageGroupAV",Io="sendMessageRichMedia",Mo="cosUpload",To="messageReceivedGroup",Co="messageReceivedGroupAVPush",So="messageReceivedGroupAVPull",Eo=(a(Zt={},go,2),a(Zt,mo,3),a(Zt,vo,4),a(Zt,_o,5),a(Zt,yo,6),a(Zt,Io,7),a(Zt,To,8),a(Zt,Co,9),a(Zt,So,10),a(Zt,Mo,11),Zt),ko={info:4,warning:5,error:6},bo={wifi:1,"2g":2,"3g":3,"4g":4,"5g":5,unknown:6,none:7,online:8},Do={login:4},wo=function(){function e(t){i(this,e),this._n="SSOLogData",this.eventType=Do[t]||0,this.timestamp=0,this.networkType=8,this.code=0,this.message="",this.moreMessage="",this.extension=t,this.costTime=0,this.duplicate=!1,this.level=4,this.uiPlatform=void 0,this._sentFlag=!1,this._startts=Ue()}return o(e,[{key:"updateTimeStamp",value:function(){this.timestamp=Ue()}},{key:"start",value:function(e){return this._startts=e,this}},{key:"end",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._sentFlag){var n=Ue();0===this.costTime&&(this.costTime=n-this._startts),this.setMoreMessage("startts:".concat(this._startts," endts:").concat(n)),t?(this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)):setTimeout((function(){e._sentFlag=!0,e._eventStatModule&&e._eventStatModule.pushIn(e)}),0)}}},{key:"setError",value:function(e,t,n){if(!(e instanceof Error))return Be.w("".concat(this._n,".setError value not instanceof Error, please check!")),this;if(this._sentFlag)return this;if(this.setNetworkType(n),t)e.code&&this.setCode(e.code),e.message&&this.setMoreMessage(e.message);else{var i=fo.NO_NETWORK;this.setCode(i)}return this.setLevel("error"),this}},{key:"setCode",value:function(e){return st(e)||this._sentFlag||("ECONNABORTED"===e&&(this.code=103),nt(e)?this.code=e:Be.w("".concat(this._n,".setCode value not a number, please check!"),e,n(e))),this}},{key:"setMessage",value:function(e){return st(e)||this._sentFlag||(nt(e)&&(this.message=e.toString()),it(e)&&(this.message=e)),this}},{key:"setCostTime",value:function(e){return this.costTime=e,this}},{key:"setLevel",value:function(e){return st(e)||this._sentFlag||(this.level=ko[e]),this}},{key:"setMoreMessage",value:function(e){return $t(this.moreMessage)?this.moreMessage="".concat(e):this.moreMessage+=" ".concat(e),this}},{key:"setNetworkType",value:function(e){if(st(e))Be.w("".concat(this._n,".setNetworkType value is undefined, please check!"));else{var t=bo[e.toLowerCase()];st(t)||(this.networkType=t)}return this}},{key:"getStartTs",value:function(){return this._startts}},{key:"setUIPlatform",value:function(e){this.uiPlatform=e}}],[{key:"bindEventStatModule",value:function(t){e.prototype._eventStatModule=t}}]),e}(),Ao=function(){function e(t){i(this,e),this.type=b.MSG_TEXT,this.content={text:t.text||""}}return o(e,[{key:"setText",value:function(e){this.content.text=e}},{key:"sendable",value:function(){return 0!==this.content.text.length}}]),e}(),Ro=function(){function e(t,n){i(this,e),this._imageMemoryURL="",this._fileDownloadProxy=n,oe?this.createImageDataASURLInWXMiniApp(t.file):this.createImageDataASURLInWeb(t.file),this._initImageInfoModel(),this.type=b.MSG_IMAGE,this._percent=0,this.content={imageFormat:t.imageFormat||He.UNKNOWN,uuid:t.uuid,imageInfoArray:[]},this.initImageInfoArray(t.imageInfoArray),this._autoFixUrl()}return o(e,[{key:"_initImageInfoModel",value:function(){var e=this;this._ImageInfoModel=function(t){this.instanceID=mt(9999999),this.sizeType=t.type||0,this.type=0,this.size=t.size||0,this.width=t.width||0,this.height=t.height||0,this.imageUrl=t.url||"",this.url=Wt(t.url||e._imageMemoryURL,e._fileDownloadProxy)},this._ImageInfoModel.prototype={setSizeType:function(e){this.sizeType=e},setType:function(e){this.type=e},setImageUrl:function(e){e&&(this.imageUrl=e)},getImageUrl:function(){return this.imageUrl}}}},{key:"initImageInfoArray",value:function(e){for(var t=0,n=null,i=null;t<=2;)i=st(e)||st(e[t])?{type:0,size:0,width:0,height:0,url:""}:e[t],(n=new this._ImageInfoModel(i)).setSizeType(t+1),n.setType(t),this.addImageInfo(n),t++;this.updateAccessSideImageInfoArray()}},{key:"updateImageInfoArray",value:function(e){for(var t,n=this.content.imageInfoArray.length,i=0;i<n;i++)t=this.content.imageInfoArray[i],e[i].size&&(t.size=e[i].size),e[i].url&&t.setImageUrl(e[i].url),e[i].width&&(t.width=e[i].width),e[i].height&&(t.height=e[i].height)}},{key:"_autoFixUrl",value:function(){for(var e=this.content.imageInfoArray.length,t="",n="",i=["http","https"],r=null,o=0;o<e;o++)this.content.imageInfoArray[o].url&&""!==(r=this.content.imageInfoArray[o]).imageUrl&&(n=r.imageUrl.slice(0,r.imageUrl.indexOf("://")+1),t=r.imageUrl.slice(r.imageUrl.indexOf("://")+1),i.indexOf(n)<0&&(n="https:"),this.content.imageInfoArray[o].setImageUrl([n,t].join("")))}},{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateImageFormat",value:function(e){this.content.imageFormat=He[e.toUpperCase()]||He.UNKNOWN}},{key:"createImageDataASURLInWeb",value:function(e){void 0!==e&&e.files.length>0&&(this._imageMemoryURL=window.URL.createObjectURL(e.files[0]))}},{key:"createImageDataASURLInWXMiniApp",value:function(e){e&&e.url&&(this._imageMemoryURL=e.url)}},{key:"replaceImageInfo",value:function(e,t){this.content.imageInfoArray[t]instanceof this._ImageInfoModel||(this.content.imageInfoArray[t]=e)}},{key:"addImageInfo",value:function(e){this.content.imageInfoArray.length>=3||this.content.imageInfoArray.push(e)}},{key:"updateAccessSideImageInfoArray",value:function(){var e=this.content.imageInfoArray,t=e[0],n=t.width,i=void 0===n?0:n,r=t.height,o=void 0===r?0:r;0!==i&&0!==o&&(Ut(e),Object.assign(e[2],Pt({originWidth:i,originHeight:o,min:720})))}},{key:"sendable",value:function(){return 0!==this.content.imageInfoArray.length&&""!==this.content.imageInfoArray[0].imageUrl&&0!==this.content.imageInfoArray[0].size}}]),e}(),Lo=function(){function e(t){i(this,e),this.type=b.MSG_FACE,this.content=t||null}return o(e,[{key:"sendable",value:function(){return null!==this.content}}]),e}(),Oo=function(){function e(t,n){i(this,e),this.type=b.MSG_AUDIO,this._percent=0,this.content={downloadFlag:2,second:t.second,size:t.size,url:Wt(t.url,n),remoteAudioUrl:t.url||"",uuid:t.uuid}}return o(e,[{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateAudioUrl",value:function(e){this.content.remoteAudioUrl=e}},{key:"sendable",value:function(){return""!==this.content.remoteAudioUrl}}]),e}(),No={from:!0,groupID:!0,groupName:!0,to:!0},Po=function(){function e(t){i(this,e),this.type=b.MSG_GRP_TIP,this.content={},this._initContent(t)}return o(e,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"remarkInfo":case"operatorInfo":case"memberExtraInfo":case"onlineMemberInfo":break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;case"memberInfoList":case"msgMemberInfo":t._updateMemberList(e[n]);break;case"memberNum":t.content[n]=e[n],t.content.memberCount=e[n];break;case"newGroupProfile":t.content.newGroupProfile={},t._initNewGroupProfile(e[n]);break;default:t.content[n]=e[n]}})),this.content.userIDList||(this.content.userIDList=[this.content.operatorID])}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];No[i]&&(this.content.groupProfile[i]=e[i])}}},{key:"_updateMemberList",value:function(e){$t(this.content.memberList)?this.content.memberList=e:this.content.memberList.forEach((function(t){e.forEach((function(e){t.userID===e.userID&&Object.assign(t,e)}))}))}},{key:"_initNewGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];this.content.newGroupProfile[i]="muteAllMembers"!==i?e[i]:1===e[i]}}}]),e}(),Uo={from:!0,groupID:!0,groupName:!0,to:!0},xo=function(){function e(t){i(this,e),this.type=b.MSG_GRP_SYS_NOTICE,this.content={},this._initContent(t)}return o(e,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"memberInfoList":break;case"remarkInfo":t.content.handleMessage=e[n];break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;default:t.content[n]=e[n]}}))}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];Uo[i]&&("groupName"===i?this.content.groupProfile.name=e[i]:this.content.groupProfile[i]=e[i])}}}]),e}(),Go=function(){function e(t,n){i(this,e),this.type=b.MSG_FILE,this._percent=0;var r=this._getFileInfo(t);this.content={downloadFlag:2,fileUrl:Wt(t.url,n)||"",uuid:t.uuid,fileName:r.name||"",fileSize:r.size||0}}return o(e,[{key:"_getFileInfo",value:function(e){if(!st(e.fileName)&&!st(e.fileSize))return{size:e.fileSize,name:e.fileName};var t=e.file.files[0];if(ie){if(t.path&&-1!==t.path.indexOf(".")){var n=t.path.slice(t.path.lastIndexOf(".")+1).toLowerCase();t.type=n,t.name||(t.name="".concat(mt(999999),".").concat(n))}t.name||(t.type="",t.name=t.path.slice(t.path.lastIndexOf("/")+1).toLowerCase()),t.suffix&&(t.type=t.suffix),t.url||(t.url=t.path)}return{size:t.size,name:t.name}}},{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateFileUrl",value:function(e){this.content.fileUrl=e}},{key:"sendable",value:function(){return""!==this.content.fileUrl&&""!==this.content.fileName&&0!==this.content.fileSize}}]),e}(),Fo=function(){function e(t){i(this,e),this.type=b.MSG_CUSTOM,this.content={data:t.data||"",description:t.description||"",extension:t.extension||""}}return o(e,[{key:"setData",value:function(e){return this.content.data=e,this}},{key:"setDescription",value:function(e){return this.content.description=e,this}},{key:"setExtension",value:function(e){return this.content.extension=e,this}},{key:"sendable",value:function(){return 0!==this.content.data.length||0!==this.content.description.length||0!==this.content.extension.length}}]),e}(),Vo=function(){function e(t,n){i(this,e),this.type=b.MSG_VIDEO,this._percent=0,this.content={remoteVideoUrl:t.remoteVideoUrl||t.videoUrl||"",videoFormat:t.videoFormat,videoSecond:parseInt(t.videoSecond,10),videoSize:t.videoSize,videoUrl:Wt(t.videoUrl,n),videoDownloadFlag:2,videoUUID:t.videoUUID,thumbUUID:t.thumbUUID,thumbFormat:t.thumbFormat,thumbWidth:t.thumbWidth,snapshotWidth:t.thumbWidth,thumbHeight:t.thumbHeight,snapshotHeight:t.thumbHeight,thumbSize:t.thumbSize,snapshotSize:t.thumbSize,thumbDownloadFlag:2,thumbUrl:Wt(t.thumbUrl,n),snapshotUrl:Wt(t.thumbUrl,n)}}return o(e,[{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateVideoUrl",value:function(e){e&&(this.content.remoteVideoUrl=e)}},{key:"updateSnapshotInfo",value:function(e){var t=e.snapshotUrl,n=e.snapshotWidth,i=e.snapshotHeight;$t(t)||(this.content.thumbUrl=this.content.snapshotUrl=t),$t(n)||(this.content.thumbWidth=this.content.snapshotWidth=Number(n)),$t(i)||(this.content.thumbHeight=this.content.snapshotHeight=Number(i))}},{key:"sendable",value:function(){return""!==this.content.remoteVideoUrl}}]),e}(),qo=function(){function e(t){i(this,e),this.type=b.MSG_LOCATION;var n=t.description,r=t.longitude,o=t.latitude;this.content={description:n,longitude:r,latitude:o}}return o(e,[{key:"sendable",value:function(){return!0}}]),e}(),Bo=function(){function e(t,n){if(i(this,e),this.from=t.from,this.messageSender=t.from,this.time=t.time,this.messageSequence=t.sequence,this.clientSequence=t.clientSequence||t.sequence,this.messageRandom=t.random,this.cloudCustomData=t.cloudCustomData||"",this.clientTime=t.clientTime||void 0,t.ID)this.ID=t.ID||"",this.nick=t.nick||"",this.avatar=t.avatar||"",this.messageBody=[{type:t.type,payload:t.payload}],t.conversationType.startsWith(b.CONV_C2C)?this.receiverUserID=t.to:t.conversationType.startsWith(b.CONV_GROUP)&&(this.receiverGroupID=t.to),this.messageReceiver=t.to;else{this.nick=t.nick||"",this.avatar=t.avatar||"",this.messageBody=[];var r=t.elements[0].type,o=t.elements[0].content;this._patchRichMediaPayload(r,o),this._updateRichMediaDownloadUrl(r,o,n),r===b.MSG_MERGER?this.messageBody.push({type:r,payload:new Ho(o).content}):this.messageBody.push({type:r,payload:o}),t.groupID&&(this.receiverGroupID=t.groupID,this.messageReceiver=t.groupID),t.to&&(this.receiverUserID=t.to,this.messageReceiver=t.to),this.ID="".concat(t.tinyID,"-").concat(t.clientTime,"-").concat(t.random)}}return o(e,[{key:"_patchRichMediaPayload",value:function(e,t){e===b.MSG_IMAGE?t.imageInfoArray.forEach((function(e){!e.imageUrl&&e.url&&(e.imageUrl=e.url,e.sizeType=e.type,1===e.type?e.type=0:3===e.type&&(e.type=1))})):e===b.MSG_VIDEO?!t.remoteVideoUrl&&t.videoUrl&&(t.remoteVideoUrl=t.videoUrl):e===b.MSG_AUDIO?!t.remoteAudioUrl&&t.url&&(t.remoteAudioUrl=t.url):e===b.MSG_FILE&&!t.fileUrl&&t.url&&(t.fileUrl=t.url,t.url=void 0)}},{key:"_updateRichMediaDownloadUrl",value:function(e,t,n){n&&(e===b.MSG_IMAGE?t.imageInfoArray.forEach((function(e){e.url=Wt(e.url,n)})):e===b.MSG_VIDEO?(t.videoUrl=Wt(t.videoUrl,n),t.snapshotUrl=Wt(t.thumbUrl,n),t.snapshotHeight=t.thumbHeight,t.snapshotWidth=t.thumbWidth):e===b.MSG_AUDIO?t.url=Wt(t.url,n):e===b.MSG_FILE&&(t.fileUrl=Wt(t.fileUrl,n)))}}]),e}(),Ho=function(){function e(t,n){if(i(this,e),this.type=b.MSG_MERGER,this.content={downloadKey:"",pbDownloadKey:"",messageList:[],title:"",abstractList:[],compatibleText:"",version:0,layersOverLimit:!1},t.downloadKey){var r=t.downloadKey,o=t.pbDownloadKey,a=t.title,s=t.abstractList,c=t.compatibleText,u=t.version;this.content.downloadKey=r,this.content.pbDownloadKey=o,this.content.title=a,this.content.abstractList=s,this.content.compatibleText=c,this.content.version=u||0}else if($t(t.messageList))1===t.layersOverLimit&&(this.content.layersOverLimit=!0);else{var l=t.messageList,d=t.title,p=t.abstractList,h=t.compatibleText,f=t.version,g=[];l.forEach((function(e){if(!$t(e)){var t=new Bo(e,n);g.push(t)}})),this.content.messageList=g,this.content.title=d,this.content.abstractList=p,this.content.compatibleText=h,this.content.version=f||0}}return o(e,[{key:"sendable",value:function(){return!$t(this.content.messageList)||!$t(this.content.downloadKey)}}]),e}(),jo={1:b.MSG_PRIORITY_HIGH,2:b.MSG_PRIORITY_NORMAL,3:b.MSG_PRIORITY_LOW,4:b.MSG_PRIORITY_LOWEST},Ko=function(){function e(t){i(this,e),this.ID="",this.conversationID=t.conversationID||null,this.conversationType=t.conversationType||b.CONV_C2C,this.conversationSubType=t.conversationSubType,this.time=t.time||Math.ceil(Date.now()/1e3),this.sequence=t.sequence||0,this.clientSequence=t.clientSequence||t.sequence||0,this.random=t.random||0===t.random?t.random:mt(),this.priority=this._computePriority(t.priority),this.nick=t.nick||"",this.avatar=t.avatar||"",this.isPeerRead=!1,this.nameCard="",this._elements=[],this.isPlaceMessage=t.isPlaceMessage||0,this.isRevoked=2===t.isPlaceMessage||8===t.msgFlagBits,this.from=t.from||null,this.to=t.to||null,this.flow="",this.isSystemMessage=t.isSystemMessage||!1,this.protocol=t.protocol||"JSON",this.isResend=!1,this.isRead=!1,this.status=t.status||Qt.SUCCESS,this._onlineOnlyFlag=!1,this._groupAtInfoList=[],this._relayFlag=!1,this.atUserList=[],this.cloudCustomData=t.cloudCustomData||"",this.isDeleted=!1,this.isModified=!1,this._isExcludedFromUnreadCount=!(!t.messageControlInfo||1!==t.messageControlInfo.excludedFromUnreadCount),this._isExcludedFromLastMessage=!(!t.messageControlInfo||1!==t.messageControlInfo.excludedFromLastMessage),this.clientTime=t.clientTime||Ge()||0,this.senderTinyID=t.senderTinyID||t.tinyID||"",this.readReceiptInfo=t.readReceiptInfo||{readCount:void 0,unreadCount:void 0,isPeerRead:void 0},this.needReadReceipt=!0===t.needReadReceipt||1===t.needReadReceipt,this.version=t.messageVersion||0,this.isBroadcastMessage=t.isBroadcastMessage||!1,this._receiverList=t.receiverList||void 0,this.isSupportExtension=!0===t.isSupportExtension||1===t.isSupportExtension,this.revoker=t.revokerInfo&&t.revokerInfo.revoker||null,this.reInitialize(t.currentUser),this.extractGroupInfo(t.groupProfile||null),this.handleGroupAtInfo(t),this.initC2CReadReceiptInfo(t.readReceiptSentByPeer)}return o(e,[{key:"elements",get:function(){return this._elements}},{key:"getElements",value:function(){return this._elements}},{key:"extractGroupInfo",value:function(e){if(null!==e){it(e.nick)&&(this.nick=e.nick),it(e.avatar)&&(this.avatar=e.avatar);var t=e.messageFromAccountExtraInformation;ot(t)&&it(t.nameCard)&&(this.nameCard=t.nameCard)}}},{key:"handleGroupAtInfo",value:function(e){var t=this;e.payload&&e.payload.atUserList&&e.payload.atUserList.forEach((function(e){e!==b.MSG_AT_ALL?(t._groupAtInfoList.push({groupAtAllFlag:0,groupAtUserID:e}),t.atUserList.push(e)):(t._groupAtInfoList.push({groupAtAllFlag:1}),t.atUserList.push(b.MSG_AT_ALL))})),at(e.groupAtInfo)&&e.groupAtInfo.forEach((function(e){0===e.groupAtAllFlag?t.atUserList.push(e.groupAtUserID):1===e.groupAtAllFlag&&t.atUserList.push(b.MSG_AT_ALL)}))}},{key:"getGroupAtInfoList",value:function(){return this._groupAtInfoList}},{key:"_initProxy",value:function(){this._elements[0]&&(this.payload=this._elements[0].content,this.type=this._elements[0].type)}},{key:"reInitialize",value:function(e){e&&(this.status=this.from?Qt.SUCCESS:Qt.UNSEND,!this.from&&(this.from=e)),this._initFlow(e),this._initSequence(e),this._concatConversationID(e),this.generateMessageID()}},{key:"isSendable",value:function(){return 0!==this._elements.length&&"function"==typeof this._elements[0].sendable&&this._elements[0].sendable()}},{key:"_initTo",value:function(e){this.conversationType===b.CONV_GROUP&&(this.to=e.groupID)}},{key:"_initSequence",value:function(e){0===this.clientSequence&&e&&(this.clientSequence=function(e){if(!e)return!1;if(void 0===It[e]){var t=new Date,n="3".concat(t.getHours()).slice(-2),i="0".concat(t.getMinutes()).slice(-2),r="0".concat(t.getSeconds()).slice(-2);It[e]=parseInt([n,i,r,"0001"].join("")),n=null,i=null,r=null,Be.l("autoIncrementIndex start index:".concat(It[e]))}return It[e]++}(e)),0===this.sequence&&this.conversationType===b.CONV_C2C&&(this.sequence=this.clientSequence)}},{key:"generateMessageID",value:function(){this.from===b.CONV_SYSTEM&&(this.senderTinyID="144115198244471703"),this.ID="".concat(this.senderTinyID,"-").concat(this.clientTime,"-").concat(this.random)}},{key:"_initFlow",value:function(e){""!==e&&(e===this.from?(this.flow="out",this.isRead=!0):this.flow="in")}},{key:"_concatConversationID",value:function(e){var t=this.to,n="",i=this.conversationType;i!==b.CONV_SYSTEM?(n=i===b.CONV_C2C?e===this.from?t:this.from:this.to,this.conversationID=n?"".concat(i).concat(n):null):this.conversationID=b.CONV_SYSTEM}},{key:"isElement",value:function(e){return e instanceof Ao||e instanceof Ro||e instanceof Lo||e instanceof Oo||e instanceof Go||e instanceof Vo||e instanceof Po||e instanceof xo||e instanceof Fo||e instanceof qo||e instanceof Ho}},{key:"setElement",value:function(e,t){var n=this;if(this.isElement(e))return this._elements=[e],void this._initProxy();var i=function(e){if(e.type&&e.content)switch(e.type){case b.MSG_TEXT:n.setTextElement(e.content);break;case b.MSG_IMAGE:n.setImageElement(e.content,t);break;case b.MSG_AUDIO:n.setAudioElement(e.content,t);break;case b.MSG_FILE:n.setFileElement(e.content,t);break;case b.MSG_VIDEO:n.setVideoElement(e.content,t);break;case b.MSG_CUSTOM:n.setCustomElement(e.content);break;case b.MSG_LOCATION:n.setLocationElement(e.content);break;case b.MSG_GRP_TIP:n.setGroupTipElement(e.content);break;case b.MSG_GRP_SYS_NOTICE:n.setGroupSystemNoticeElement(e.content);break;case b.MSG_FACE:n.setFaceElement(e.content);break;case b.MSG_MERGER:n.setMergerElement(e.content,t)}};if(at(e))for(var r=0;r<e.length;r++)i(e[r]);else i(e);this._initProxy()}},{key:"clearElement",value:function(){this._elements.length=0}},{key:"setTextElement",value:function(e){var t="string"==typeof e?e:e.text,n=new Ao({text:t});this._elements.push(n)}},{key:"setImageElement",value:function(e,t){var n=new Ro(e,t);this._elements.push(n)}},{key:"setAudioElement",value:function(e,t){var n=new Oo(e,t);this._elements.push(n)}},{key:"setFileElement",value:function(e,t){var n=new Go(e,t);this._elements.push(n)}},{key:"setVideoElement",value:function(e,t){var n=new Vo(e,t);this._elements.push(n)}},{key:"setLocationElement",value:function(e){var t=new qo(e);this._elements.push(t)}},{key:"setCustomElement",value:function(e){var t=new Fo(e);this._elements.push(t)}},{key:"setGroupTipElement",value:function(e){var t={},n=e.operationType;if($t(e.memberInfoList)?e.operatorInfo&&(t=e.operatorInfo):n!==b.GRP_TIP_MBR_JOIN&&n!==b.GRP_TIP_MBR_KICKED_OUT&&n!==b.GRP_TIP_MBR_SET_ADMIN&&n!==b.GRP_TIP_MBR_CANCELED_ADMIN||(t=e.memberInfoList[0]),!$t(e.memberExtraInfo)){var i=e.memberExtraInfo.reason;e.msgMemberInfo.forEach((function(e){e.reason=i}))}var r=t,o=r.nick,a=r.avatar;it(o)&&(this.nick=o),it(a)&&(this.avatar=a);var s=new Po(e);this._elements.push(s)}},{key:"setGroupSystemNoticeElement",value:function(e){var t=new xo(e);this._elements.push(t)}},{key:"setFaceElement",value:function(e){var t=new Lo(e);this._elements.push(t)}},{key:"setMergerElement",value:function(e,t){var n=new Ho(e,t);this._elements.push(n)}},{key:"setIsRead",value:function(e){this.isRead=e}},{key:"setRelayFlag",value:function(e){this._relayFlag=e}},{key:"getRelayFlag",value:function(){return this._relayFlag}},{key:"_computePriority",value:function(e){if(st(e))return b.MSG_PRIORITY_NORMAL;if(it(e)&&-1!==Object.values(jo).indexOf(e))return e;if(nt(e)){var t=""+e;if(-1!==Object.keys(jo).indexOf(t))return jo[t]}return b.MSG_PRIORITY_NORMAL}},{key:"setNickAndAvatar",value:function(e){var t=e.nick,n=e.avatar;it(t)&&(this.nick=t),it(n)&&(this.avatar=n)}},{key:"setNameCard",value:function(e){it(e)&&(this.nameCard=e)}},{key:"initC2CReadReceiptInfo",value:function(e){this.conversationType===b.CONV_C2C&&!0===this.needReadReceipt&&(this.readReceiptInfo.isPeerRead=1===e)}}]),e}(),zo=function(e){return{code:0,data:e||{}}},Wo=function(e){s(n,e);var t=m(n);function n(e){var r;i(this,n),r=t.call(this);var o=e.code,a=e.message,s=e.data;return r.code=o,r.message=a||r._getErrorMessage(r.code),r.data=s||{},r}return o(n)}(p(Error)),Yo=null,$o=function(e){Yo=e},Jo=function(e){return Promise.resolve(zo(e))},Xo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e instanceof Wo)return t&&null!==Yo&&Yo.emit(k.ERROR,e),Promise.reject(e);if(e instanceof Error){var n=new Wo({code:fo.UNCAUGHT_ERROR});return t&&null!==Yo&&Yo.emit(k.ERROR,n),Promise.reject(n)}if(!st(e)&&!st(e.code)){var i=new Wo(e);return t&&null!==Yo&&Yo.emit(k.ERROR,i),Promise.reject(i)}},Zo=function(e){s(r,e);var n=m(r);function r(e){var t;return i(this,r),(t=n.call(this,e))._n="C2CModule",t._messageFromUnreadDBMap=new Map,t._signalingFromUnreadDBList=[],t}return o(r,[{key:"onNewC2CMessage",value:function(e){var t=e.dataList,n=e.isInstantMessage,i=e.C2CRemainingUnreadList,r=e.C2CPairUnreadList;Be.d("".concat(this._n,".onNewC2CMessage count:").concat(t.length," isInstantMessage:").concat(n));var o=this._newC2CMessageStoredAndSummary({dataList:t,C2CRemainingUnreadList:i,C2CPairUnreadList:r,isInstantMessage:n}),a=o.conversationOptionsList,s=o.messageList,c=o.isUnreadC2CMessage;this.filterModifiedMessage(s),a.length>0&&this.getModule(Vn).onNewMessage({conversationOptionsList:a,isInstantMessage:n,isUnreadC2CMessage:c});var u=this.filterUnmodifiedMessage(s);n&&u.length>0&&this.emitOuterEvent(k.MESSAGE_RECEIVED,u),s.length=0}},{key:"_newC2CMessageStoredAndSummary",value:function(e){for(var t=e.dataList,n=e.C2CRemainingUnreadList,i=e.C2CPairUnreadList,r=e.isInstantMessage,o=null,a=[],s=[],c={},u=this.getModule(Kn),l=this.getModule(ti),d=!1,p=this.getModule(Vn),h=this.getFileDownloadProxy(),f=0,g=t.length;f<g;f++)if(this._isSignaling(t[f]))this._signalingFromUnreadDBList.push(t[f].eventArray[0].c2CNotifyMsgArray[0]);else{var m=t[f];m.currentUser=this.getMyUserID(),m.conversationType=b.CONV_C2C,m.isSystemMessage=!!m.isSystemMessage,(st(m.nick)||st(m.avatar))&&(d=!0,Be.d("".concat(this._n,"._newC2CMessageStoredAndSummary nick or avatar missing!"))),o=new Ko(m),m.elements=u.parseElements(m.elements,m.from),o.setElement(m.elements,h),o.setNickAndAvatar({nick:m.nick,avatar:m.avatar});var v=o.conversationID;if(r){if(1===this._messageFromUnreadDBMap.get(o.ID))continue;var _=!1;if(o.from!==this.getMyUserID()){var y=p.getLatestMessageSentByPeer(v);if(y){var I=y.nick,M=y.avatar;d?o.setNickAndAvatar({nick:I,avatar:M}):I===o.nick&&M===o.avatar||(_=!0)}}else{var T=p.getLatestMessageSentByMe(v);if(T){var C=T.nick,S=T.avatar;C===o.nick&&S===o.avatar||p.modifyMessageSentByMe({conversationID:v,latestNick:o.nick,latestAvatar:o.avatar})}}var E=1===t[f].isModified;if(p.isMessageSentByCurrentInstance(o)?o.isModified=E:E=!1,0===m.msgLifeTime)o._onlineOnlyFlag=!0,p.isMessageSentByCurrentInstance(o)||s.push(o);else{if(!p.pushIntoMessageList(s,o,E))continue;_&&(p.modifyMessageSentByPeer({conversationID:v,latestNick:o.nick,latestAvatar:o.avatar}),p.updateUserProfileSpecifiedKey({conversationID:v,nick:o.nick,avatar:o.avatar}))}r&&o.clientTime>0&&l.addMessageDelay(o.clientTime)}else this._messageFromUnreadDBMap.set(o.ID,1);if(0!==m.msgLifeTime){if(!1===o._onlineOnlyFlag){var k=p.getLastMessageTime(v);if(nt(k)&&o.time<k)continue;if(st(c[v])){var D=0;"in"===o.flow&&(o._isExcludedFromUnreadCount||(D=1)),c[v]=a.push({conversationID:v,unreadCount:D,type:o.conversationType,subType:o.conversationSubType,lastMessage:o._isExcludedFromLastMessage?"":o})-1}else{var w=c[v];a[w].type=o.conversationType,a[w].subType=o.conversationSubType,a[w].lastMessage=o._isExcludedFromLastMessage?"":o,"in"===o.flow&&(o._isExcludedFromUnreadCount||a[w].unreadCount++)}}}else o._onlineOnlyFlag=!0}this._handleSignalingFromUnreadDB();var A=!1;if(at(i))for(var R=function(e,t){if(i[e].unreadCount>0){A=!0;var n=a.find((function(t){return t.conversationID==="C2C".concat(i[e].from)}));n?n.unreadCount=i[e].unreadCount:a.push({conversationID:"C2C".concat(i[e].from),unreadCount:i[e].unreadCount,type:b.CONV_C2C})}},L=0,O=i.length;L<O;L++)R(L);if(at(n))for(var N=function(e,t){a.find((function(t){return t.conversationID==="C2C".concat(n[e].from)}))||a.push({conversationID:"C2C".concat(n[e].from),type:b.CONV_C2C,lastMsgTime:n[e].lastMsgTime})},P=0,U=n.length;P<U;P++)N(P);return{conversationOptionsList:a,messageList:s,isUnreadC2CMessage:A}}},{key:"_isSignaling",value:function(e){var t=e.eventArray;return!(!at(t)||10!==t[0].event)}},{key:"_handleSignalingFromUnreadDB",value:function(){var e=this._signalingFromUnreadDBList.length;if(Be.l("".concat(this._n,"._handleSignalingFromUnreadDB signalingCount:").concat(e)),0!==e){var t=[];this._signalingFromUnreadDBList.forEach((function(e){e.hasOwnProperty("c2cMessageRevokedNotify")&&t.push(e)})),this.onC2CMessageRevoked({dataList:t}),this._signalingFromUnreadDBList.length=0,t.length=0}}},{key:"onC2CMessageRevoked",value:function(e){var t=this,n=this.getModule(Vn),i=[],r=null,o=!0;e.dataList.forEach((function(e){if(e.c2cMessageRevokedNotify){var a=e.c2cMessageRevokedNotify.revokedInfos;st(a)||a.forEach((function(e){var a=t.getMyUserID()===e.from?"".concat(b.CONV_C2C).concat(e.to):"".concat(b.CONV_C2C).concat(e.from);r=n.revoke(a,e.sequence,e.random);var s=e.revokerInfo&&e.revokerInfo.revoker;if(r)r.revoker||(r.revoker=s,i.push(r));else{var c={conversationID:a,sequence:e.sequence,time:e.time,revoker:s};n.isLastMessageRevoked(c)&&(i.push(c),o=!1)}}))}})),0!==i.length&&(n.onMessageRevoked(i),!0===o&&(Be.l("".concat(this._n,".onC2CMessageRevoked count:").concat(i.length)),this.emitOuterEvent(k.MESSAGE_REVOKED,i)))}},{key:"onC2CMessageReadReceipt",value:function(e){var t=this;e.dataList.forEach((function(e){if(!$t(e.c2cMessageReadReceipt)){var n=e.c2cMessageReadReceipt.to;e.c2cMessageReadReceipt.uinPairReadArray.forEach((function(e){var i=e.peerReadTime;Be.d("".concat(t._n,"._onC2CMessageReadReceipt to:").concat(n," peerReadTime:").concat(i));var r="".concat(b.CONV_C2C).concat(n),o=t.getModule(Vn);o.recordPeerReadTime(r,i),o.updateMessageIsPeerReadProperty(r,i)}))}}))}},{key:"onC2CMessageReadNotice",value:function(e){var t=this;e.dataList.forEach((function(e){if(!$t(e.c2cMessageReadNotice)){var n=t.getModule(Vn);e.c2cMessageReadNotice.uinPairReadArray.forEach((function(e){var i=e.from,r=e.peerReadTime;Be.d("".concat(t._n,".onC2CMessageReadNotice from:").concat(i," lastReadTime:").concat(r));var o="".concat(b.CONV_C2C).concat(i);n.updateIsReadAfterReadReport({conversationID:o,lastMessageTime:r}),n.updateUnreadCount(o)}))}}))}},{key:"onC2CMessageModified",value:function(e){Be.d("".concat(this._n,".onC2CMessageModified options:"),JSON.stringify(e));var n=this.getModule(Vn);e.dataList.forEach((function(e){n.onMessageModified(t(t({},e),{},{conversationType:b.CONV_C2C}))}))}},{key:"onReadReceiptList",value:function(e){Be.d("".concat(this._n,".onReadReceiptList options:"),JSON.stringify(e));var t=e.dataList,n=t.userID,i=t.readReceiptList;this.getModule(Vn).updateReadReceiptInfo({userID:n,readReceiptList:i})}},{key:"sendMessage",value:function(e,t){var n=this._createC2CMessagePack(e,t);return this.request(n)}},{key:"_createC2CMessagePack",value:function(e,t){var n=null;t&&(t.offlinePushInfo&&(n=t.offlinePushInfo),!0===t.onlineUserOnly&&(n?n.disablePush=!0:n={disablePush:!0}));var i="";it(e.cloudCustomData)&&e.cloudCustomData.length>0&&(i=e.cloudCustomData);var r=[];if(ot(t)&&ot(t.messageControlInfo)){var o=t.messageControlInfo,a=o.excludedFromUnreadCount,s=o.excludedFromLastMessage,c=o.excludedFromContentModeration;!0===a&&r.push("NoUnread"),!0===s&&r.push("NoLastMsg"),!0===c&&r.push("NoMsgCheck")}var u=this.isOnlineMessage(e,t)?0:void 0;return{protocolName:gi,tjgID:this.generateTjgID(e),requestData:{fromAccount:this.getMyUserID(),toAccount:e.to,msgBody:e.getElements(),cloudCustomData:i,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:u,nick:e.nick,avatar:e.avatar,offlinePushInfo:n?{pushFlag:!0===n.disablePush?1:0,title:n.title||"",desc:n.description||"",ext:n.extension||"",apnsInfo:{badgeMode:!0===n.ignoreIOSBadge?1:0,isVoipPush:this._isVoipPush(n)},androidInfo:{OPPOChannelID:n.androidOPPOChannelID||""}}:void 0,messageControlInfo:0!==u?r:void 0,clientTime:e.clientTime,needReadReceipt:!0===e.needReadReceipt?1:0,isSupportExtension:!0===e.isSupportExtension?1:0}}}},{key:"_isVoipPush",value:function(e){var t=void 0;return st(e.disableVoipPush)||(t=!1===e.disableVoipPush?1:0),t}},{key:"isOnlineMessage",value:function(e,t){return!(!t||!0!==t.onlineUserOnly)}},{key:"revokeMessage",value:function(e){return this.request({protocolName:Ti,requestData:{msgInfo:{fromAccount:e.from,toAccount:e.to,msgSeq:e.sequence,msgRandom:e.random,msgTimeStamp:e.time}}})}},{key:"deleteMessage",value:function(e){var t=e.to,n=e.keyList;return Be.l("".concat(this._n,".deleteMessage toAccount:").concat(t," count:").concat(n.length)),this.request({protocolName:Di,requestData:{fromAccount:this.getMyUserID(),to:t,keyList:n}})}},{key:"modifyRemoteMessage",value:function(e){var t=e.from,n=e.to,i=e.version,r=void 0===i?0:i,o=e.sequence,a=e.random,s=e.time,c=e.payload,u=e.type,l=e.cloudCustomData,d=void 0;return Ht(u)&&(d=[]).push({type:u,content:c}),this.request({protocolName:wi,requestData:{from:t,to:n,version:r,sequence:o,random:a,time:s,elements:d,cloudCustomData:l}})}},{key:"setMessageRead",value:function(e){var t=this,n=e.conversationID,i=e.lastMessageTime,r="".concat(this._n,".setMessageRead");Be.l("".concat(r," conversationID:").concat(n," lastMessageTime:").concat(i)),nt(i)||this.outputWarning("DoNotModifyLastTime");var o=new wo("setC2CMessageRead");return o.setMessage("conversationID:".concat(n," lastMessageTime:").concat(i)),this.request({protocolName:Ci,requestData:{C2CMsgReaded:{cookie:"",C2CMsgReadedItem:[{toAccount:n.replace("C2C",""),lastMessageTime:i,receipt:1}]}}}).then((function(){o.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(r," ok"));var e=t.getModule(Vn);return e.updateIsReadAfterReadReport({conversationID:n,lastMessageTime:i}),e.updateUnreadCount(n),zo()})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),Be.l("".concat(r," failed. error:"),e),Xo(e)}))}},{key:"getRoamingMessage",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessage"),i=e.peerAccount,r=e.conversationID,o=e.count,a=e.lastMessageTime,s=e.messageKey,c="peerAccount:".concat(i," count:").concat(o||15," lastMessageTime:").concat(a||0," messageKey:").concat(s);Be.l("".concat(n," ").concat(c));var u=new wo("getC2CRoamingMessages");return this.request({protocolName:ki,requestData:{peerAccount:i,count:o||15,lastMessageTime:a||0,messageKey:s}}).then((function(e){var i=e.data,o=i.complete,a=i.messageList,s=i.messageKey,l=i.lastMessageTime;st(a)?Be.l("".concat(n," ok. complete:").concat(o," but messageList is undefined!")):Be.l("".concat(n," ok. complete:").concat(o," count:").concat(a.length)),u.setNetworkType(t.getNetworkType()).setMessage("".concat(c," complete:").concat(o," length:").concat(a.length)).end();var d=t.getModule(Vn);1===o&&d.setCompleted(r);var p=d.onRoamingMessage(a,r);d.modifyMessageList(r),d.updateIsRead(r),d.updateRoamingMessageKeyAndTime(r,s,l);var h=d.getPeerReadTime(r);if(Be.l("".concat(n," update isPeerRead property. conversationID:").concat(r," peerReadTime:").concat(h)),h)d.updateMessageIsPeerReadProperty(r,h);else{var f=r.replace(b.CONV_C2C,"");t.getRemotePeerReadTime([f]).then((function(){d.updateMessageIsPeerReadProperty(r,d.getPeerReadTime(r))}))}var g="";if(p.length>0)g=p[0].ID;else{var m=d.getLocalOldestMessage(r);m&&(g=m.ID)}return Be.l("".concat(n," nextReqID:").concat(g," stored message count:").concat(p.length)),{nextReqID:g,storedMessageList:p}})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];u.setMessage(c).setError(e,i,r).end()})),Be.w("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessagesHopping"),i=e.peerAccount,r=e.time,o=void 0===r?0:r,a=e.count,s=e.direction,c="".concat(b.CONV_C2C).concat(i),u="peerAccount:".concat(i," count:").concat(a," time:").concat(o," direction:").concat(s);Be.l("".concat(n," ").concat(u));var l=new wo("getC2CRoamingMessagesHopping");return this.request({protocolName:ki,requestData:{peerAccount:i,count:a+1,lastMessageTime:o,direction:s}}).then((function(e){var i=e.data,r=i.complete,o=i.messageList,a=void 0===o?[]:o,d=i.lastMessageTime;Be.l("".concat(n," ok. complete:").concat(r," count:").concat(a.length)),l.setNetworkType(t.getNetworkType()).setMessage("".concat(u," complete:").concat(r," length:").concat(a.length)).end(),1!==r&&(1===s?a.pop():a.shift());var p=t.getModule(Vn).onRoamingMessage(a,c,!1);t._modifyMessageList(c,p);var h=t._computeResult({complete:r,lastMessageTime:d,resultList:p});return zo(h)})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];l.setMessage(u).setError(e,i,r).end()})),Be.w("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"_computeResult",value:function(e){var t=e.complete,n=void 0===t?0:t,i=e.lastMessageTime,r=e.resultList,o={messageList:_(void 0===r?[]:r),isCompleted:!1,nextMessageTime:""};return 1===n?(o.isCompleted=!0,o):(o.nextMessageTime=i,o)}},{key:"_modifyMessageList",value:function(e,t){var n=this.getModule(Vn).getLocalConversation(e);if(n)for(var i=n.userProfile.nick,r=n.userProfile.avatar,o=this.getModule(Nn).getNickAndAvatarByUserID(this.getMyUserID()),a=o.nick,s=o.avatar,c=t.length-1;c>=0;c--){var u=t[c];"in"===u.flow&&(u.nick!==i&&u.setNickAndAvatar({nick:i}),u.avatar!==r&&u.setNickAndAvatar({avatar:r})),"out"===u.flow&&(u.nick!==a&&u.setNickAndAvatar({nick:a}),u.avatar!==s&&u.setNickAndAvatar({avatar:s}))}}},{key:"getRemotePeerReadTime",value:function(e){var t=this,n="".concat(this._n,".getRemotePeerReadTime");if($t(e))return Be.w("".concat(n," userIDList is empty!")),Promise.resolve();var i=new wo("getPeerReadTime");return Be.l("".concat(n," userIDList:").concat(e)),this.request({protocolName:bi,requestData:{userIDList:e}}).then((function(r){var o=r.data.peerReadTimeList;Be.l("".concat(n," ok. peerReadTimeList:").concat(o));for(var a="",s=t.getModule(Vn),c=0;c<e.length;c++)a+="".concat(e[c],"-").concat(o[c]," "),o[c]>0&&s.recordPeerReadTime("C2C".concat(e[c]),o[c]);i.setNetworkType(t.getNetworkType()).setMessage(a).end()})).catch((function(e){t.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.w("".concat(n," failed. error:"),e)}))}},{key:"sendReadReceipt",value:function(e){var t=this,n=e[0].conversationID.replace(b.CONV_C2C,""),i=new wo("sendC2CReadReceipt");i.setMessage("peerAccount:".concat(n));var r=this.getMyUserID(),o=e.filter((function(e){return e.from!==r&&!0===e.needReadReceipt})).map((function(e){return{fromAccount:e.from,toAccount:e.to,sequence:e.sequence,random:e.random,time:e.time,clientTime:e.clientTime}}));if(0===o.length)return Xo({code:fo.READ_RECEIPT_MESSAGE_LIST_EMPTY});var a="".concat(this._n,".sendReadReceipt");return Be.l("".concat(a,". peerAccount:").concat(n," messageInfoList length:").concat(o.length)),this.request({protocolName:dr,requestData:{peerAccount:n,messageInfoList:o}}).then((function(e){return i.end(),Be.l("".concat(a," ok")),zo()})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.w("".concat(a," failed. error:"),e),Xo(e)}))}},{key:"getReadReceiptList",value:function(e){var t="".concat(this._n,".getReadReceiptList"),n=this.getMyUserID(),i=e.filter((function(e){return e.from===n&&!0===e.needReadReceipt}));return Be.l("".concat(t," userID:").concat(n," messageList length:").concat(i.length)),Jo({messageList:i})}},{key:"getMessageExtensions",value:function(e,t){return Be.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.request({protocolName:Ri,requestData:{from:e.from,to:e.to,messageKey:this._getMessageKey(e),startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Be.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n)),this.request({protocolName:Ai,requestData:{from:e.from,to:e.to,messageKey:this._getMessageKey(e),extensionList:t,operateType:n}})}},{key:"_getMessageKey",value:function(e){var t=e.clientSequence,n=e.random,i=e.time;return"".concat(t,"_").concat(n,"_").concat(i)}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._messageFromUnreadDBMap.clear(),this._signalingFromUnreadDBList.length=0}}]),r}(ci),Qo=function(){function e(){i(this,e),this.list=new Map,this._n="MessageListHandler",this._latestMessageSentByPeerMap=new Map,this._latestMessageSentByMeMap=new Map}return o(e,[{key:"getLocalOldestMessageByConversationID",value:function(e){if(!e)return null;if(!this.list.has(e))return null;var t=this.list.get(e).values();return t?t.next().value:null}},{key:"pushIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.conversationID,i=!0;this.list.has(n)||this.list.set(n,new Map);var r=this._getUniqueIDOfMessage(e);if(this.list.get(n).has(r)){var o=this.list.get(n).get(r);if(!t||!0===o.isModified)return!1}return this.list.get(n).set(r,e),this._setLatestMessageSentByPeer(n,e),this._setLatestMessageSentByMe(n,e),i}},{key:"unshift",value:function(e,t){var n;if(at(e)?e.length>0&&(n=e[0].conversationID,this._unshiftMultipleMessages(e,t)):(n=e.conversationID,this._unshiftSingleMessage(e,t)),n&&n.startsWith(b.CONV_C2C)){var i=Array.from(this.list.get(n).values()),r=i.length;if(0===r)return;for(var o=r-1;o>=0;o--)if("out"===i[o].flow){this._setLatestMessageSentByMe(n,i[o]);break}for(var a=r-1;a>=0;a--)if("in"===i[a].flow){this._setLatestMessageSentByPeer(n,i[a]);break}}}},{key:"_unshiftSingleMessage",value:function(e,t){var n=e.conversationID,i=this._getUniqueIDOfMessage(e);if(!this.list.has(n))return this.list.set(n,new Map),this.list.get(n).set(i,e),void t.push(e);var r=this.list.get(n),o=Array.from(r);r.has(i)||(o.unshift([i,e]),this.list.set(n,new Map(o)),t.push(e))}},{key:"_unshiftMultipleMessages",value:function(e,t){for(var n=e.length,i=[],r=e[0].conversationID,o=this.list.get(r),a=this.list.has(r)?Array.from(o):[],s=0;s<n;s++){var c=this._getUniqueIDOfMessage(e[s]);o&&o.has(c)||(i.push([c,e[s]]),t.push(e[s]))}this.list.set(r,new Map(i.concat(a)))}},{key:"remove",value:function(e){var t=e.conversationID,n=this._getUniqueIDOfMessage(e);this.list.has(t)&&this.list.get(t).delete(n)}},{key:"revoke",value:function(e,t,n){if(Be.d("revoke message",e,t,n),this.list.has(e)){var i,r=E(this.list.get(e));try{for(r.s();!(i=r.n()).done;){var o=v(i.value,2)[1];if(o.sequence===t&&(st(n)||o.random===n))return o.isRevoked||(o.isRevoked=!0),o}}catch(a){r.e(a)}finally{r.f()}}return null}},{key:"removeByConversationID",value:function(e){this.list.has(e)&&(this.list.delete(e),this._latestMessageSentByPeerMap.delete(e),this._latestMessageSentByMeMap.delete(e))}},{key:"findMessage",value:function(e){var t,n=null,i=E(this.list);try{for(i.s();!(t=i.n()).done;)for(var r=_(v(t.value,2)[1].values()),o=r.length,a=0;a<o;a++)if(r[a].ID===e){n=r[a];break}}catch(s){i.e(s)}finally{i.f()}return n}},{key:"updateMessageIsPeerReadProperty",value:function(e,t){var n=[];if(this.list.has(e)){var i,r=E(this.list.get(e));try{for(r.s();!(i=r.n()).done;){var o=v(i.value,2)[1];o.time<=t&&!o.isPeerRead&&"out"===o.flow&&(o.isPeerRead=!0,n.push(o))}}catch(a){r.e(a)}finally{r.f()}Be.l("".concat(this._n,".updateMessageIsPeerReadProperty conversationID:").concat(e," peerReadTime:").concat(t," count:").concat(n.length))}return n}},{key:"updateMessageIsModifiedProperty",value:function(e){var t=e.conversationID;if(this.list.has(t)){var n=this._getUniqueIDOfMessage(e),i=this.list.get(t).get(n);i&&(i.isModified=!0)}}},{key:"hasLocalMessageList",value:function(e){return this.list.has(e)}},{key:"getLocalMessageList",value:function(e){return this.hasLocalMessageList(e)?_(this.list.get(e).values()):[]}},{key:"hasLocalMessage",value:function(e,t){for(var n=!1,i=this.getLocalMessageList(e),r=i.length,o=0;o<r;o++)i[o].ID===t&&(n=!0);return n}},{key:"getLocalMessage",value:function(e,t){for(var n=null,i=this.getLocalMessageList(e),r=i.length,o=0;o<r;o++)if(i[o].ID===t){n=i[o];break}return n}},{key:"getLocalLastMessage",value:function(e){var t=this.getLocalMessageList(e);return t[t.length-1]}},{key:"getLocalOldestMessage",value:function(e){return this.getLocalMessageList(e)[0]}},{key:"_setLatestMessageSentByPeer",value:function(e,t){e.startsWith(b.CONV_C2C)&&"in"===t.flow&&this._latestMessageSentByPeerMap.set(e,t)}},{key:"_setLatestMessageSentByMe",value:function(e,t){e.startsWith(b.CONV_C2C)&&"out"===t.flow&&this._latestMessageSentByMeMap.set(e,t)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._latestMessageSentByPeerMap.get(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._latestMessageSentByMeMap.get(e)}},{key:"modifyMessageSentByPeer",value:function(e){var t=e.conversationID,n=e.latestNick,i=e.latestAvatar,r=this.list.get(t);if(!$t(r)){var o=Array.from(r.values()),a=o.length;if(0!==a){for(var s=null,c=0,u=!1,l=a-1;l>=0;l--)"in"===o[l].flow&&((s=o[l]).nick!==n&&(s.setNickAndAvatar({nick:n}),u=!0),s.avatar!==i&&(s.setNickAndAvatar({avatar:i}),u=!0),u&&(c+=1));Be.l("".concat(this._n,".modifyMessageSentByPeer conversationID:").concat(t," count:").concat(c))}}}},{key:"modifyMessageSentByMe",value:function(e){var t=e.conversationID,n=e.latestNick,i=e.latestAvatar,r=this.list.get(t);if(!$t(r)){var o=Array.from(r.values()),a=o.length;if(0!==a){for(var s=null,c=0,u=!1,l=a-1;l>=0;l--)"out"===o[l].flow&&((s=o[l]).nick!==n&&(s.setNickAndAvatar({nick:n}),u=!0),s.avatar!==i&&(s.setNickAndAvatar({avatar:i}),u=!0),u&&(c+=1));Be.l("".concat(this._n,".modifyMessageSentByMe conversationID:").concat(t," count:").concat(c))}}}},{key:"getTopicConversationIDList",value:function(e){return _(this.list.keys()).filter((function(t){return t.startsWith("".concat(b.CONV_GROUP).concat(e))}))}},{key:"traversal",value:function(){if(0!==this.list.size&&-1===Be.getLevel()){var e,t=E(this.list);try{for(t.s();!(e=t.n()).done;){var n=v(e.value,2);n[0],n[1]}}catch(i){t.e(i)}finally{t.f()}}}},{key:"onMessageModified",value:function(e,t){if(!this.list.has(e))return{isUpdated:!1,message:null};var n=this._getUniqueIDOfMessage(t),i=this.list.get(e).has(n);if(Be.d("".concat(this._n,".onMessageModified conversationID:").concat(e," uniqueID:").concat(n," has:").concat(i)),i){var r=this.list.get(e).get(n),o=t.messageVersion,a=t.elements,s=t.cloudCustomData;return r.version<o?(r.version=o,r._elements=JSON.parse(JSON.stringify(a)),r.payload=JSON.parse(JSON.stringify(a[0].content)),r.type=a[0].type,r.cloudCustomData=s,r.isModified=!0,{isUpdated:!0,message:r}):{isUpdated:!1,message:r}}return{isUpdated:!1,message:null}}},{key:"_getUniqueIDOfMessage",value:function(e){var t=e.from,n=e.to,i=e.random,r=e.sequence,o=e.time;return"".concat(t,"-").concat(n,"-").concat(i,"-").concat(r,"-").concat(o)}},{key:"reset",value:function(){this.list.clear(),this._latestMessageSentByPeerMap.clear(),this._latestMessageSentByMeMap.clear()}}]),e}(),ea="_a2KeyAndTinyIDUpdated",ta="_cloudConfigUpdated",na="_profileUpdated";function ia(e){this.mixin(e)}ia.mixin=function(e){var t=e.prototype||e;t._isReady=!1,t.ready=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)return this._isReady?void(t?e.call(this):setTimeout(e,1)):(this._readyQueue=this._readyQueue||[],void this._readyQueue.push(e))},t.triggerReady=function(){var e=this;this._isReady=!0,setTimeout((function(){var t=e._readyQueue;e._readyQueue=[],t&&t.length>0&&t.forEach((function(e){e.call(this)}),e)}),1)},t.resetReady=function(){this._isReady=!1,this._readyQueue=[]},t.isReady=function(){return this._isReady}};var ra=["jpg","jpeg","gif","png","bmp","image","webp"],oa=["mp4","quicktime","mov"],aa=1,sa=2,ca=3,ua=255,la=function(){function e(t){var n=this;i(this,e),$t(t)||(this.userID=t.userID||"",this.nick=t.nick||"",this.gender=t.gender||"",this.birthday=t.birthday||0,this.location=t.location||"",this.selfSignature=t.selfSignature||"",this.allowType=t.allowType||b.ALLOW_TYPE_ALLOW_ANY,this.language=t.language||0,this.avatar=t.avatar||"",this.messageSettings=t.messageSettings||0,this.adminForbidType=t.adminForbidType||b.FORBID_TYPE_NONE,this.level=t.level||0,this.role=t.role||0,this.lastUpdatedTime=0,this.profileCustomField=[],$t(t.profileCustomField)||t.profileCustomField.forEach((function(e){n.profileCustomField.push({key:e.key,value:e.value})})))}return o(e,[{key:"validate",value:function(e){var t=!0,n="";if($t(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var i=e.profileCustomField.length,r=null,o=0;o<i;o++){if(r=e.profileCustomField[o],!it(r.key)||-1===r.key.indexOf("Tag_Profile_Custom"))return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!it(r.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if("profileCustomField"===a)continue;if($t(e[a])&&!it(e[a])&&!nt(e[a])){n="key:"+a+", invalid value:"+e[a],t=!1;continue}switch(a){case"nick":it(e[a])||(n="nick must be a string",t=!1),gt(e[a])>500&&(n="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(gt(e[a])," bytes"),t=!1);break;case"gender":yt(Ke,e.gender)||(n="key:gender, invalid value:"+e.gender,t=!1);break;case"birthday":nt(e.birthday)||(n="birthday must be a number",t=!1);break;case"location":it(e.location)||(n="location must be a string",t=!1);break;case"selfSignature":it(e.selfSignature)||(n="selfSignature must be a string",t=!1);break;case"allowType":yt(We,e.allowType)||(n="key:allowType, invalid value:"+e.allowType,t=!1);break;case"language":nt(e.language)||(n="language must be a number",t=!1);break;case"avatar":it(e.avatar)||(n="avatar must be a string",t=!1);break;case"messageSettings":0!==e.messageSettings&&1!==e.messageSettings&&(n="messageSettings must be 0 or 1",t=!1);break;case"adminForbidType":yt(ze,e.adminForbidType)||(n="key:adminForbidType, invalid value:"+e.adminForbidType,t=!1);break;case"level":nt(e.level)||(n="level must be a number",t=!1);break;case"role":nt(e.role)||(n="role must be a number",t=!1);break;default:n="unknown key:"+a+"  "+e[a],t=!1}}return{valid:t,tips:n}}}]),e}(),da=o((function e(t){i(this,e),this.value=t,this.next=null})),pa=function(){function e(t){i(this,e),this.MAX_LENGTH=t,this.pTail=null,this.pNodeToDel=null,this.map=new Map}return o(e,[{key:"set",value:function(e){var t=new da(e);if(this.map.size<this.MAX_LENGTH)null===this.pTail?(this.pTail=t,this.pNodeToDel=t):(this.pTail.next=t,this.pTail=t),this.map.set(e,1);else{var n=this.pNodeToDel;this.pNodeToDel=this.pNodeToDel.next,this.map.delete(n.value),n.next=null,n=null,this.pTail.next=t,this.pTail=t,this.map.set(e,1)}}},{key:"has",value:function(e){return this.map.has(e)}},{key:"delete",value:function(e){this.has(e)&&this.map.delete(e)}},{key:"tail",value:function(){return this.pTail}},{key:"size",value:function(){return this.map.size}},{key:"data",value:function(){return Array.from(this.map.keys())}},{key:"reset",value:function(){for(var e;null!==this.pNodeToDel;)e=this.pNodeToDel,this.pNodeToDel=this.pNodeToDel.next,e.next=null,e=null;this.pTail=null,this.map.clear()}}]),e}(),ha=["groupID","name","avatar","type","introduction","notification","ownerID","selfInfo","createTime","infoSequence","lastInfoTime","lastMessage","nextMessageSeq","memberNum","maxMemberNum","memberList","joinOption","groupCustomField","muteAllMembers","isSupportTopic","inviteOption","_lastRevokedTime"],fa=function(){function e(t){i(this,e),this.groupID="",this.name="",this.avatar="",this.type="",this.introduction="",this.notification="",this.ownerID="",this.createTime="",this.infoSequence="",this.lastInfoTime="",this.selfInfo={messageRemindType:"",joinTime:"",nameCard:"",role:"",userID:"",memberCustomField:void 0,readedSequence:0,excludedUnreadSequenceList:void 0},this.lastMessage={lastTime:"",lastSequence:"",fromAccount:"",messageForShow:""},this.nextMessageSeq="",this.memberNum="",this.memberCount="",this.maxMemberNum="",this.maxMemberCount="",this.joinOption="",this.inviteOption="",this.groupCustomField=[],this.muteAllMembers=!1,this.isSupportTopic=!1,this._lastRevokedTime=0,this._initGroup(t)}return o(e,[{key:"memberNum",get:function(){return this.memberCount},set:function(e){}},{key:"maxMemberNum",get:function(){return this.maxMemberCount},set:function(e){}},{key:"_initGroup",value:function(e){for(var t in e)ha.indexOf(t)<0||("selfInfo"!==t?("memberNum"===t&&(this.memberCount=e[t]),"maxMemberNum"===t&&(this.maxMemberCount=e[t]),"isSupportTopic"!==t?this[t]=e[t]:this.isSupportTopic=1===e[t]):this.updateSelfInfo(e[t]))}},{key:"updateGroup",value:function(e){var t=this;e.appid=void 0,e.grossTopicNextMsgSeq=void 0,e.selfInfo&&(e.selfInfo.grossTopicReadSeq=void 0);var n=JSON.parse(JSON.stringify(e));n.lastMsgTime&&(this.lastMessage.lastTime=n.lastMsgTime),st(n.muteAllMembers)||("On"===n.muteAllMembers?n.muteAllMembers=!0:n.muteAllMembers=!1),n.groupCustomField&&Ct(this.groupCustomField,n.groupCustomField),st(n.memberNum)||(this.memberCount=n.memberNum),st(n.maxMemberNum)||(this.maxMemberCount=n.maxMemberNum),st(n.isSupportTopic)||(this.isSupportTopic=nt(n.isSupportTopic)?1===n.isSupportTopic:n.isSupportTopic),ht(this,n,["members","errorCode","lastMsgTime","groupCustomField","memberNum","maxMemberNum","isSupportTopic"]),at(n.members)&&n.members.length>0&&n.members.forEach((function(e){e.userID===t.selfInfo.userID&&ht(t.selfInfo,e,["sequence"])}))}},{key:"updateSelfInfo",value:function(e){var n={nameCard:e.nameCard,joinTime:e.joinTime,role:e.role,messageRemindType:e.messageRemindType,readedSequence:e.readedSequence,excludedUnreadSequenceList:e.excludedUnreadSequenceList};ht(this.selfInfo,t({},n),[],["",null,void 0,0,NaN])}},{key:"setSelfNameCard",value:function(e){this.selfInfo.nameCard=e}}]),e}(),ga=function(e,n){return st(e)?{lastTime:0,lastSequence:0,fromAccount:0,messageForShow:"",payload:null,type:"",isRevoked:!1,cloudCustomData:"",onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:!1,revoker:null}:e instanceof Ko?{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",messageForShow:Bt(e.type,e.payload,n),payload:e.payload||null,type:e.type||null,isRevoked:e.isRevoked||!1,cloudCustomData:e.cloudCustomData||"",onlineOnlyFlag:e._onlineOnlyFlag||!1,nick:e.nick||"",nameCard:e.nameCard||"",version:e.version||0,isPeerRead:e.isPeerRead||!1,revoker:e.revoker||null}:t(t({},e),{},{messageForShow:Bt(e.type,e.payload,n)})},ma=function(){function e(t,n){i(this,e),this.conversationID=t.conversationID||"",this.unreadCount=t.unreadCount||0,this.type=t.type||"",this.lastMessage=ga(t.lastMessage,n),t.lastMsgTime&&(this.lastMessage.lastTime=t.lastMsgTime),this._isInfoCompleted=!1,this.peerReadTime=t.peerReadTime||0,this.groupAtInfoList=[],this.remark="",this.isPinned=t.isPinned||!1,this.messageRemindType="",this.markList=t.markList||[],this.customData=t.customData||"",this.conversationGroupList=t.conversationGroupList||[],this._initProfile(t)}return o(e,[{key:"toAccount",get:function(){return this.conversationID.startsWith(b.CONV_C2C)?this.conversationID.replace(b.CONV_C2C,""):this.conversationID.startsWith(b.CONV_GROUP)?this.conversationID.replace(b.CONV_GROUP,""):""}},{key:"subType",get:function(){return this.groupProfile?this.groupProfile.type:""}},{key:"_initProfile",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"userProfile":t.userProfile=e.userProfile;break;case"groupProfile":t.groupProfile=e.groupProfile}})),st(this.userProfile)&&this.type===b.CONV_C2C?this.userProfile=new la({userID:e.conversationID.replace("C2C","")}):st(this.groupProfile)&&this.type===b.CONV_GROUP&&(this.groupProfile=new fa({groupID:e.conversationID.replace("GROUP","")}))}},{key:"updateUnreadCount",value:function(e){var t=e.nextUnreadCount,n=e.isFromGetConversations,i=e.isUnreadC2CMessage;st(t)||(St(this.subType)?this.unreadCount=0:n&&this.type===b.CONV_GROUP||n&&this.type===b.CONV_TOPIC||i&&this.type===b.CONV_C2C?this.unreadCount=t:this.unreadCount=this.unreadCount+t)}},{key:"updateLastMessage",value:function(e){this.lastMessage=ga(e)}},{key:"updateGroupAtInfoList",value:function(e){if(!this._isNeedMergeGroupAtInfo(e)){var t,n=(y(t=e.groupAtType)||I(t)||M(t)||S()).slice(0);-1!==n.indexOf(b.CONV_AT_ME)&&-1!==n.indexOf(b.CONV_AT_ALL)&&(n=[b.CONV_AT_ALL_AT_ME]);var i={from:e.from,groupID:e.groupID,topicID:e.topicID,messageSequence:e.sequence,atTypeArray:n,__random:e.__random,__sequence:e.__sequence};this.groupAtInfoList.push(i)}}},{key:"_isNeedMergeGroupAtInfo",value:function(e){var t=e.groupID,n=e.sequence;if(!Et({groupID:t}))return!1;var i=!1;return this.groupAtInfoList.forEach((function(t){t.messageSequence===n&&(t.atTypeArray.indexOf(b.CONV_AT_ME)>-1&&e.groupAtType.indexOf(b.CONV_AT_ALL)>-1&&(t.atTypeArray=[b.CONV_AT_ALL_AT_ME]),t.atTypeArray.indexOf(b.CONV_AT_ALL)>-1&&e.groupAtType.indexOf(b.CONV_AT_ME)>-1&&(t.atTypeArray=[b.CONV_AT_ALL_AT_ME],t.__random=e.__random,t.__sequence=e.__sequence),i=!0)})),i}},{key:"clearGroupAtInfoList",value:function(){this.groupAtInfoList.length=0}},{key:"reduceUnreadCount",value:function(){return this.unreadCount>=1&&(this.unreadCount-=1,!0)}},{key:"isLastMessageRevoked",value:function(e){var t=e.sequence,n=e.time;return this.type===b.CONV_C2C&&t===this.lastMessage.lastSequence&&n===this.lastMessage.lastTime||this.type===b.CONV_GROUP&&t===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}}]),e}(),va=function(){function e(t){i(this,e),this._conversationModule=t,this._n="MessageRemindHandler",this._updateSequence=0}return o(e,[{key:"getC2CMessageRemindType",value:function(){var e=this,t="".concat(this._n,".getC2CMessageRemindType");return this._conversationModule.request({protocolName:Ei,updateSequence:this._updateSequence}).then((function(n){Be.l("".concat(t," ok"));var i=n.data,r=i.updateSequence,o=i.muteFlagList;e._updateSequence=r,e._patchC2CMessageRemindType(o)})).catch((function(e){Be.e("".concat(t," failed. error:"),e)}))}},{key:"_patchC2CMessageRemindType",value:function(e){var t=this,n=0,i="";at(e)&&e.length>0&&e.forEach((function(e){var r=e.userID,o=e.muteFlag;0===o?i=b.MSG_REMIND_ACPT_AND_NOTE:1===o?i=b.MSG_REMIND_DISCARD:2===o&&(i=b.MSG_REMIND_ACPT_NOT_NOTE),!0===t._conversationModule.patchMessageRemindType({ID:r,isC2CConversation:!0,messageRemindType:i})&&(n+=1)})),Be.l("".concat(this._n,"._patchC2CMessageRemindType count:").concat(n))}},{key:"set",value:function(e){return e.groupID?this._setGroupMessageRemindType(e):at(e.userIDList)?this._setC2CMessageRemindType(e):void 0}},{key:"_setGroupMessageRemindType",value:function(e){var t=this,n="".concat(this._n,"._setGroupMessageRemindType"),i=e.groupID,r=e.messageRemindType,o="groupID:".concat(i," messageRemindType:").concat(r),a=new wo("setMessageRemindType");return a.setMessage(o),this._getModule(Gn).modifyGroupMemberInfo({groupID:i,messageRemindType:r,userID:this._conversationModule.getMyUserID()}).then((function(){a.setNetworkType(t._conversationModule.getNetworkType()).end(),Be.l("".concat(n," ok. ").concat(o));var i=t.onGroupMessageRemindTypeUpdated(e);return t._conversationModule.emitTotalUnreadMessageCountUpdate(),zo(i)})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"onGroupMessageRemindTypeUpdated",value:function(e){var t=e.groupID,n=e.messageRemindType,i=this._getModule(Un).getLocalGroupProfile(t);if(i&&(i.selfInfo.messageRemindType=n),kt(t)){var r=t,o=qt(r),a=this._getModule(Fn).getLocalTopic(o,r);return a&&(a.updateSelfInfo({messageRemindType:n}),this._conversationModule.emitOuterEvent(k.TOPIC_UPDATED,{groupID:o,topic:a})),{topic:a}}return this._conversationModule.patchMessageRemindType({ID:t,isC2CConversation:!1,messageRemindType:n})&&this._emitConversationUpdate(),{group:i}}},{key:"_setC2CMessageRemindType",value:function(e){var t=this,n="".concat(this._n,"._setC2CMessageRemindType"),i=e.userIDList,r=e.messageRemindType,o=i.slice(0,30),a=0;r===b.MSG_REMIND_DISCARD?a=1:r===b.MSG_REMIND_ACPT_NOT_NOTE&&(a=2);var s="userIDList:".concat(o," messageRemindType:").concat(r),c=new wo("setMessageRemindType");return c.setMessage(s),this._conversationModule.request({protocolName:Si,requestData:{userIDList:o,muteFlag:a}}).then((function(e){c.setNetworkType(t._conversationModule.getNetworkType()).end();var i=e.data,a=i.updateSequence,s=i.errorList;t._updateSequence=a;var u=[],l=[];at(s)&&s.forEach((function(e){u.push(e.userID),l.push({userID:e.userID,code:e.errorCode})}));var d=o.filter((function(e){return-1===u.indexOf(e)}));Be.l("".concat(n," ok. successUserIDList:").concat(d," failureUserIDList:").concat(JSON.stringify(l)));var p=0;return d.forEach((function(e){t._conversationModule.patchMessageRemindType({ID:e,isC2CConversation:!0,messageRemindType:r})&&(p+=1)})),p>=1&&t._emitConversationUpdate(),o.length=u.length=0,t._conversationModule.emitTotalUnreadMessageCountUpdate(),Jo({successUserIDList:d.map((function(e){return{userID:e}})),failureUserIDList:l})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"_getModule",value:function(e){return this._conversationModule.getModule(e)}},{key:"_emitConversationUpdate",value:function(){this._conversationModule.emitConversationUpdate(!0,!1)}},{key:"setUpdateSequence",value:function(e){this._updateSequence=e}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._updateSequence=0}}]),e}(),_a=function(){function e(t){i(this,e),this._conversationModule=t,this._n="ConvGroupHandler",this._convGroupMap=new Map,this._startIndex=0,this._pagingStatus=en.NOT_START}return o(e,[{key:"setConvCustomData",value:function(e){var t=this,n="".concat(this._n,".").concat("setConvCustomData"),i=e.conversationIDList,r=e.customData;Be.l("".concat(n," options:"),e);var o=new wo("setConvCustomData");o.setMessage(JSON.stringify(e));var a={fromAccount:this._getMyUserID(),itemList:[]},s=[],c=[];return i.forEach((function(e){if(!t._hasLocalConversation(e))return t._onConversationNotFound(c,e),!0;if(!bt(e)&&!Dt(e))return t._onConversationIDInvalid(c,e),!0;var n={operationType:2,contactItem:void 0,customMark:r};bt(e)?n.contactItem={type:1,toAccount:e.replace(b.CONV_C2C,"")}:Dt(e)&&(n.contactItem={type:2,groupID:e.replace(b.CONV_GROUP,"")}),a.itemList.push(n)})),c.length===i.length?Jo({successConversationIDList:s,failureConversationIDList:c}):this._conversationModule.request({protocolName:Gi,requestData:a}).then((function(e){o.setNetworkType(t._conversationModule.getNetworkType()).end(),Be.l("".concat(n," ok"));var i=e.data.resultItem;if(at(i)){var a,u,l=!1;i.forEach((function(e){a=t._concatConversationID(e.contactItem),0===e.resultCode?(s.push(a),(u=t._getLocalConversation(a))&&u.customData!==r&&(u.customData=r,l=!0)):c.push({conversationID:a,code:e.resultCode,message:e.resultInfo})})),!0===l&&t._emitConversationUpdate()}return zo({successConversationIDList:s,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"markConversation",value:function(e){var t=this;if(!this._conversationModule.canIUse(H.CONV_MARK))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("markConversation"),i=e.conversationIDList,r=e.markType,o=e.enableMark;Be.l("".concat(n," options:"),e);var a=new wo("markConversation");a.setMessage(JSON.stringify(e));var s=void 0,c=void 0,u=this._getFlagBit(r);!0===o?c=[u]:s=[u];var l={fromAccount:this._getMyUserID(),itemList:[]},d=[],p=[];return i.forEach((function(e){if(!t._hasLocalConversation(e))return t._onConversationNotFound(p,e),!0;if(!bt(e)&&!Dt(e))return t._onConversationIDInvalid(p,e),!0;var n={operationType:1,contactItem:void 0,clearMark:s,setMark:c};bt(e)?n.contactItem={type:1,toAccount:e.replace(b.CONV_C2C,"")}:Dt(e)&&(n.contactItem={type:2,groupID:e.replace(b.CONV_GROUP,"")}),l.itemList.push(n)})),p.length===i.length?Jo({successConversationIDList:d,failureConversationIDList:p}):this._conversationModule.request({protocolName:Fi,requestData:l}).then((function(e){a.setNetworkType(t._conversationModule.getNetworkType()).end(),Be.l("".concat(n," ok"));var i=e.data.resultItem;if(at(i)){var s,c,u=!1;i.forEach((function(e){if(s=t._concatConversationID(e.contactItem),0===e.resultCode){if(d.push(s),c=t._getLocalConversation(s)){var n=c.markList.indexOf(r);!0===o?-1===n&&(c.markList.push(r),u=!0):-1!==n&&(c.markList.splice(n,1),u=!0)}}else p.push({conversationID:s,code:e.resultCode,message:e.resultInfo})})),!0===u&&t._emitConversationUpdate()}return zo({successConversationIDList:d,failureConversationIDList:p})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"getLocalConvGroupList",value:function(){var e=this;return Be.l("".concat(this._n,".getLocalConvGroupList pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===en.REJECTED?this.getRemoteConvGroupList().then((function(){return zo(_(e._convGroupMap.values()))})):Jo(_(this._convGroupMap.values()))}},{key:"getRemoteConvGroupList",value:function(){var e=this,t="".concat(this._n,".getRemoteConvGroupList");return this._pagingStatus=en.PENDING,this._conversationModule.request({protocolName:Ki,requestData:{fromAccount:this._getMyUserID(),startIndex:this._startIndex,startTime:Ge()}}).then((function(n){var i,r,o=n.data,a=o.completeFlag,s=o.contactItem,c=o.nextStartIndex,u=void 0===c?0:c,l=o.groupItem;if(e._startIndex=u,Be.l("".concat(t," completeFlag:").concat(a," nextStartIndex:").concat(u)),at(l)&&l.forEach((function(t){var n=t.convGroupID,i=t.groupName;e._convGroupMap.set(n,i)})),at(s)&&s.forEach((function(t){var n=t.standardMark,o=t.customData,a=t.convGroupIDList;if(i=e._concatConversationID(t),(r=e._getLocalConversation(i))&&(r.markList=jt(n),r.customData=o||"",at(a))){var s=[];a.forEach((function(t){e._convGroupMap.has(t)&&s.push(e._convGroupMap.get(t))})),r.conversationGroupList=[].concat(s),s.length=0}})),0===a)return e.getRemoteConvGroupList();1===a&&(e._pagingStatus=en.RESOLVED,e._emitConversationUpdate(),e._emitConvGroupListUpdate())})).catch((function(n){e._pagingStatus=en.REJECTED,Be.w("".concat(t," failed. error:"),n)}))}},{key:"createConvGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(H.CONV_GROUP))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("createConvGroup");Be.l("".concat(n," options:"),e);var i=new wo("createConvGroup");i.setMessage(JSON.stringify(e));var r=e.groupName,o=e.conversationIDList,a={fromAccount:this._getMyUserID(),itemList:[{groupName:r,contactItem:[]}]},s=[],c=[];return o.forEach((function(e){return t._hasLocalConversation(e)?bt(e)||Dt(e)?void(bt(e)?a.itemList[0].contactItem.push({type:1,toAccount:e.replace(b.CONV_C2C,"")}):Dt(e)&&a.itemList[0].contactItem.push({type:2,groupID:e.replace(b.CONV_GROUP,"")})):(t._onConversationIDInvalid(c,e),!0):(t._onConversationNotFound(c,e),!0)})),c.length===o.length?Jo({successConversationIDList:s,failureConversationIDList:c}):this._conversationModule.request({protocolName:Vi,requestData:a}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),Be.l("".concat(n," ok"));var o=e.data.groupResultItem[0],a=o.groupItem,u=o.resultItem;if(ot(a)&&(t._convGroupMap.set(a.convGroupID,a.groupName),t._emitConvGroupListUpdate()),at(u)){var l,d,p=!1;u.forEach((function(e){l=t._concatConversationID(e.contactItem),0===e.resultCode?(s.push(l),(d=t._getLocalConversation(l))&&-1===d.conversationGroupList.indexOf(r)&&(d.conversationGroupList.push(r),p=!0)):c.push({conversationID:l,code:e.resultCode,message:e.resultInfo})})),!0===p&&(t._emitConversationUpdate(),t._emitConvGroupListUpdate())}return zo({successConversationIDList:s,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"deleteConvGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(H.CONV_GROUP))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("deleteConvGroup");Be.l("".concat(n," groupName:").concat(e));var i=new wo("deleteConvGroup");return i.setMessage(e),this._conversationModule.request({protocolName:qi,requestData:{fromAccount:this._getMyUserID(),groupName:[e]}}).then((function(r){i.setNetworkType(t._conversationModule.getNetworkType()).end(),Be.l("".concat(n," ok"));var o=r.data.groupItem;if(at(o)){var a=!1;o.forEach((function(e){t._convGroupMap.has(e.convGroupID)&&(t._convGroupMap.delete(e.convGroupID),a=!0)})),!0===a&&t._emitConvGroupListUpdate()}t._eraseFromConversationGroupList([e])})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"renameConvGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(H.CONV_GROUP))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("renameConvGroup");Be.l("".concat(n," options:"),e);var i=new wo("renameConvGroup");i.setMessage(JSON.stringify(e));var r=e.oldName,o=e.newName;return this._conversationModule.request({protocolName:Bi,requestData:{fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:1,oldName:r,newName:o}}}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),Be.l("".concat(n," ok"));var a=e.data.updateGroupResult.convGroupID;t._convGroupMap.set(a,o),t._emitConvGroupListUpdate();var s,c,u=t._conversationModule.getLocalConversationList(),l=!1;u.forEach((function(e){s=e.conversationGroupList,-1!==(c=s.indexOf(r))&&(s.splice(c,1,o),l=!0)})),!0===l&&t._emitConversationUpdate()})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"addConvsToGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(H.CONV_GROUP))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("addConvsToGroup");Be.l("".concat(n," options:"),e);var i=new wo("addConvsToGroup");i.setMessage(JSON.stringify(e));var r=e.conversationIDList,o=e.groupName,a={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:o,updateItem:[]}},s=[],c=[];return r.forEach((function(e){return t._hasLocalConversation(e)?bt(e)||Dt(e)?void(bt(e)?a.updateGroup.updateItem.push({operationType:1,contactItem:{type:1,toAccount:e.replace(b.CONV_C2C,"")}}):Dt(e)&&a.updateGroup.updateItem.push({operationType:1,contactItem:{type:2,groupID:e.replace(b.CONV_GROUP,"")}})):(t._onConversationIDInvalid(c,e),!0):(t._onConversationNotFound(c,e),!0)})),c.length===r.length?Jo({successConversationIDList:s,failureConversationIDList:c}):this._conversationModule.request({protocolName:Hi,requestData:a}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),Be.l("".concat(n," ok"));var r=e.data.updateGroupResult.contactResultItem;if(at(r)){var a,u,l=!1;r.forEach((function(e){a=t._concatConversationID(e.contactItem),0===e.resultCode?(u=t._getLocalConversation(a))&&-1===u.conversationGroupList.indexOf(o)&&(u.conversationGroupList.push(o),s.push(a),l=!0):c.push({conversationID:a,code:e.resultCode,message:e.resultInfo})})),!0===l&&(t._emitConversationUpdate(),t._emitConvInGroupUpdate(o))}return zo({successConversationIDList:s,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"deleteConvsFromGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(H.CONV_GROUP))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("deleteConvsFromGroup");Be.l("".concat(n," options:"),e);var i=new wo("deleteConvsFromGroup");i.setMessage(JSON.stringify(e));var r=e.conversationIDList,o=e.groupName,a={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:o,updateItem:[]}},s=[],c=[];return r.forEach((function(e){return t._hasLocalConversation(e)?bt(e)||Dt(e)?void(bt(e)?a.updateGroup.updateItem.push({operationType:2,contactItem:{type:1,toAccount:e.replace(b.CONV_C2C,"")}}):Dt(e)&&a.updateGroup.updateItem.push({operationType:2,contactItem:{type:2,groupID:e.replace(b.CONV_GROUP,"")}})):(t._onConversationIDInvalid(c,e),!0):(t._onConversationNotFound(c,e),!0)})),c.length===r.length?Jo({successConversationIDList:s,failureConversationIDList:c}):this._conversationModule.request({protocolName:ji,requestData:a}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),Be.l("".concat(n," ok"));var r=e.data.updateGroupResult.contactResultItem;if(at(r)){var a,u,l=!1;r.forEach((function(e){if(a=t._concatConversationID(e.contactItem),0===e.resultCode){if(u=t._getLocalConversation(a)){var n=u.conversationGroupList.indexOf(o);-1!==n&&(u.conversationGroupList.splice(n,1),s.push(a),l=!0)}}else c.push({conversationID:a,code:e.resultCode,message:e.resultInfo})})),!0===l&&(t._emitConversationUpdate(),t._emitConvInGroupUpdate(o))}return zo({successConversationIDList:s,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"onConvMarkUpdated",value:function(e){var t=this;if(!$t(e)){var n,i;Be.d("".concat(this._n,".onConvMarkUpdated markItemList:"),e);var r=!1;e.forEach((function(e){var o=e.recentContactItem,a=e.optType,s=e.standardMark,c=e.customMark;if(n=t._concatConversationID(o),i=t._getLocalConversation(n))if(1===a){var u=jt(s);!0!==function(e,t){if(e===t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}(i.markList,u)&&(i.markList=u,r=!0)}else 2===a&&i.customData!==c&&void 0!==c&&(i.customData=c,r=!0)})),!0===r&&this._emitConversationUpdate()}}},{key:"onConvGroupCreated",value:function(e){var t=this;Be.d("".concat(this._n,".onConvGroupCreated resultList:"),e);var n=!1,i=!1;at(e)&&(e.forEach((function(e){var r=e.msgGroupItem,o=r.groupID,a=r.groupName;t._convGroupMap.get(o)!==a&&(t._convGroupMap.set(o,a),i=!0);var s,c,u=e.msgRecentContactItem;at(u)&&u.forEach((function(e){s=t._concatConversationID(e),(c=t._getLocalConversation(s))&&-1===c.conversationGroupList.indexOf(a)&&(c.conversationGroupList.push(a),n=!0)}))})),!0===n&&this._emitConversationUpdate(),!0===i&&this._emitConvGroupListUpdate())}},{key:"onConvGroupDeleted",value:function(e){var t=this;Be.d("".concat(this._n,".onConvGroupDeleted groupItemList:"),e);var n=[];if(at(e)){var i=!1;e.forEach((function(e){var r=e.groupID,o=e.groupName;t._convGroupMap.has(r)&&(t._convGroupMap.delete(r),i=!0,n.push(o))})),!0===i&&this._emitConvGroupListUpdate()}this._eraseFromConversationGroupList(n)}},{key:"_eraseFromConversationGroupList",value:function(e){$t(e)||(this._conversationModule.getLocalConversationList().forEach((function(t){t.conversationGroupList=t.conversationGroupList.filter((function(t){return!e.includes(t)}))})),this._emitConversationUpdate())}},{key:"onConvGroupNameUpdated",value:function(e){Be.d("".concat(this._n,".onConvGroupNameUpdated options:"),e);var t=e.groupID,n=e.groupName,i=e.oldGroupName;if(this._convGroupMap.get(t)!==n){this._convGroupMap.set(t,n),this._emitConvGroupListUpdate();var r,o,a=this._conversationModule.getLocalConversationList(),s=!1;a.forEach((function(e){r=e.conversationGroupList,-1!==(o=r.indexOf(i))&&(r.splice(o,1,n),s=!0)})),!0===s&&this._emitConversationUpdate()}}},{key:"onConvInGroupUpdated",value:function(e){var t=this;Be.d("".concat(this._n,".onConvInGroupUpdated options:"),e);var n=e.oldGroupName,i=e.recentContactUpdateGroupItem;if(at(i)){var r,o,a,s=!1;i.forEach((function(e){var i=e.contactOptType,c=e.recentContactItem;r=t._concatConversationID(c),(o=t._getLocalConversation(r))&&(a=o.conversationGroupList.indexOf(n),1===i?-1===a&&(o.conversationGroupList.push(n),s=!0):2===i&&-1!==a&&(o.conversationGroupList.splice(a,1),s=!0))})),!0===s&&(this._emitConversationUpdate(),this._emitConvInGroupUpdate(n))}}},{key:"onConvAddedToOrDeletedFromGroup",value:function(e){var t=this;Be.d("".concat(this._n,".onConvAddedToOrDeletedFromGroup options:"),e);var n=e.msgRecentContactItem,i=e.msgRecentContactUpdateContactItem,r=this._concatConversationID(n),o=this._getLocalConversation(r);if(o&&at(i)){var a,s=!1;i.forEach((function(e){var n=e.groupOptType,i=e.recentContactGroupItem.groupName;a=o.conversationGroupList.indexOf(i),1===n?-1===a&&(o.conversationGroupList.push(i),s=!0):2===n&&-1!==a&&(o.conversationGroupList.splice(a,1),s=!0),!0===s&&t._emitConvInGroupUpdate(i)})),!0===s&&this._emitConversationUpdate()}}},{key:"onConvGroupListSynced",value:function(e){var t=this;at(e)&&0!==e.length&&(Be.l("".concat(this._n,".onConvGroupListSynced groupItemList:"),e),e.forEach((function(e){t._convGroupMap.set(e.convGroupID,e.groupName)})))}},{key:"getConvGroupListByID",value:function(e){var t=this;if(!$t(e)){var n=[];return e.forEach((function(e){t._convGroupMap.has(e)&&n.push(t._convGroupMap.get(e))})),n}}},{key:"_onConversationNotFound",value:function(e,t){e.push({conversationID:t,code:fo.CONVERSATION_NOT_FOUND,message:this._conversationModule.getErrorMessage(fo.CONVERSATION_NOT_FOUND)})}},{key:"_onConversationIDInvalid",value:function(e,t){e.push({conversationID:t,code:fo.INVALID_CONVERSATION_ID,message:this._conversationModule.getErrorMessage(fo.INVALID_CONVERSATION_ID)})}},{key:"_getFlagBit",value:function(e){for(var t=e.toString(2),n=t.length,i=n-1;i>=0;i--)if("1"===t[i])return n-i-1}},{key:"_concatConversationID",value:function(e){var t,n=e.type,i=e.to,r=e.groupID,o=e.userID;return 1===n?st(o)?st(i)||(t="".concat(b.CONV_C2C).concat(i)):t="".concat(b.CONV_C2C).concat(o):2===n&&(t="".concat(b.CONV_GROUP).concat(r)),t}},{key:"_getMyUserID",value:function(){return this._conversationModule.getMyUserID()}},{key:"_insertConversationGroup",value:function(e,t){var n=this._getLocalConversation(e);if(n){var i=n.conversationGroupList;-1===i.indexOf(t)&&i.push(t)}}},{key:"_getLocalConversation",value:function(e){return this._conversationModule.getLocalConversation(e)}},{key:"_hasLocalConversation",value:function(e){return this._conversationModule.hasLocalConversation(e)}},{key:"_emitConversationUpdate",value:function(){this._conversationModule.emitConversationUpdate(!0,!1)}},{key:"_emitConvGroupListUpdate",value:function(){this._conversationModule.emitOuterEvent(k.CONVERSATION_GROUP_LIST_UPDATED,_(this._convGroupMap.values()))}},{key:"_emitConvInGroupUpdate",value:function(e){var t={groupName:e,conversationList:[]},n=this._conversationModule.getLocalConversationList();t.conversationList=n.filter((function(t){return t.conversationGroupList.includes(e)})),this._conversationModule.emitOuterEvent(k.CONVERSATION_IN_GROUP_UPDATED,t)}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._convGroupMap.clear(),this._startIndex=0,this._pagingStatus=en.NOT_START}}]),e}(),ya=function(e){s(r,e);var n=m(r);function r(e){var t;return i(this,r),(t=n.call(this,e))._n="ConversationModule",ia.mixin(f(t)),t._messageListHandler=new Qo,t._messageRemindHandler=new va(f(t)),t._convGroupHandler=new _a(f(t)),t.singlyLinkedList=new pa(100),t._pagingStatus=en.NOT_START,t._pagingTimeStamp=0,t._pagingStartIndex=0,t._pagingPinnedTimeStamp=0,t._pagingPinnedStartIndex=0,t._pagingConvIDMap=new Map,t._convIDFromUnreadDBMap=new Map,t._conversationMap=new Map,t._tmpGroupList=[],t._tmpGroupAtTipsList=[],t._peerReadTimeMap=new Map,t._completedMap=new Map,t._roamingMessageKeyAndTimeMap=new Map,t._roamingMessageSequenceMap=new Map,t._remoteGroupReadSequenceMap=new Map,t._convTotalUnreadCount=0,t._initListeners(),t}return o(r,[{key:"_initListeners",value:function(){var e=this.getInnerEmitterInstance();e.on(ea,this._initLocalConversationList,this),e.on(na,this._onProfileUpdated,this)}},{key:"onCheckTimer",value:function(e){e%60==0&&this._messageListHandler.traversal()}},{key:"_initLocalConversationList",value:function(){var e=this,t=new wo("_initLocalConversationList");Be.l("".concat(this._n,".").concat("_initLocalConversationList"));var n="",i=this._getStorageConversationList(),r=this.isIntl();if(i){for(var o=i.length,a=0;a<o;a++){var s=i[a];if(s){if(s.conversationID==="".concat(b.CONV_C2C,"@TLS#ERROR")||s.conversationID==="".concat(b.CONV_C2C,"@TLS#NOT_FOUND"))continue;if(s.groupProfile){var c=s.groupProfile.type;if(St(c))continue}}this._conversationMap.set(i[a].conversationID,new ma(i[a],r))}this.emitConversationUpdate(!0,!1),n="count:".concat(o)}else n="count:0";t.setNetworkType(this.getNetworkType()).setMessage(n).end(),this.getModule(Pn)||this.triggerReady(),this.ready((function(){e._tmpGroupList.length>0&&(e.updateConversationGroupProfile(e._tmpGroupList),e._tmpGroupList.length=0)})),this.syncConversationList()}},{key:"onMessageSent",value:function(e){this._onSendOrReceiveMessage({conversationOptionsList:e.conversationOptionsList,isInstantMessage:!0})}},{key:"onNewMessage",value:function(e){this._onSendOrReceiveMessage(e)}},{key:"_onSendOrReceiveMessage",value:function(e){var t=this,n=e.conversationOptionsList,i=e.isInstantMessage,r=void 0===i||i,o=e.isUnreadC2CMessage,a=void 0!==o&&o,s=e.updateUnreadCount,c=void 0===s||s;this._isReady?0!==n.length&&(this._getC2CPeerReadTime(n),this._updateLocalConversationList({conversationOptionsList:n,isInstantMessage:r,isUnreadC2CMessage:a,isFromGetConversations:!1,updateUnreadCount:c}),r||(this._convIDFromUnreadDBMap=new Map([].concat(_(this._convIDFromUnreadDBMap),_(n.map((function(e){return[e.conversationID,1]}))))),this._diffAndDeleteConversation()),this._setStorageConversationList(),n.filter((function(e){return e.type===b.CONV_TOPIC})).length>0||this.emitConversationUpdate()):this.ready((function(){t._onSendOrReceiveMessage(e)}))}},{key:"updateConversationGroupProfile",value:function(e){var t=this;if(!at(e)||0!==e.length)if(0!==this._conversationMap.size){var n=!1;e.forEach((function(e){var i="GROUP".concat(e.groupID);if(t._conversationMap.has(i)){n=!0;var r=t._conversationMap.get(i);r.groupProfile=JSON.parse(JSON.stringify(e)),r.lastMessage.lastSequence<e.nextMessageSeq&&(r.lastMessage.lastSequence=e.nextMessageSeq-1),r.subType||(r.subType=e.type)}})),n&&this.emitConversationUpdate(!0,!1)}else this._tmpGroupList=e}},{key:"_updateConversationUserProfile",value:function(e){var t=this;e.data.forEach((function(e){var n="C2C".concat(e.userID);t._conversationMap.has(n)&&(t._conversationMap.get(n).userProfile=e)})),this.emitConversationUpdate(!0,!1)}},{key:"onMessageRevoked",value:function(e){var t=this;if(0!==e.length){var n=null,i=!1,r=[];e.forEach((function(e){(n=t._conversationMap.get(e.conversationID))&&(n.type===b.CONV_TOPIC?r.push(e):(n.reduceUnreadCount()&&(i=!0),n.isLastMessageRevoked({sequence:e.sequence,time:e.time})&&(n.setLastMessageRevoked(!0),n.setLastMessageRevoker(e.revoker),i=!0)))})),this.getModule(Fn).onMessageRevoked(r),i&&(this.emitConversationUpdate(!0,!1),this.emitTotalUnreadMessageCountUpdate())}}},{key:"isLastMessageRevoked",value:function(e){var t=!1,n=e.conversationID,i=e.sequence,r=e.time,o=this._conversationMap.get(n);return o&&(t=o.type===b.CONV_TOPIC?this.getModule(Fn).isLastMessageRevoked({topicID:n.replace(b.CONV_GROUP,""),sequence:i}):o.isLastMessageRevoked({sequence:i,time:r})),Be.l("".concat(this._n,".isLastMessageRevoked options:").concat(JSON.stringify(e)," ret:").concat(t)),t}},{key:"onMessageDeleted",value:function(e){var t=this;if(0!==e.length){var n=null;e.forEach((function(e){(n=t._messageListHandler.getLocalMessage(e.conversationID,e.ID))&&(n.isDeleted=!0),e!==n&&(e.isDeleted=!0)}));for(var i=e[0].conversationID,r=this._messageListHandler.getLocalMessageList(i),o={},a=r.length-1;a>=0;a--)if(!r[a].isDeleted){o=r[a];break}var s=this._conversationMap.get(i);if(s){var c=!1;s.lastMessage.lastSequence===o.sequence&&s.lastMessage.lastTime===o.time||($t(o)&&(o=void 0),s.updateLastMessage(o),s.type!==b.CONV_TOPIC&&(c=!0),Be.l("".concat(this._n,".onMessageDeleted. update conversationID:").concat(i," with lastMessage:"),s.lastMessage)),i.startsWith(b.CONV_C2C)&&this.updateUnreadCount(i),c&&this.emitConversationUpdate(!0,!1)}}}},{key:"onMessageModified",value:function(e){var t=e.conversationType,n=e.from,i=e.to,r=e.time,o=e.sequence,a=e.elements,s=e.cloudCustomData,c=e.messageVersion,u=this.getMyUserID(),l="".concat(t).concat(i);i===u&&t===b.CONV_C2C&&(l="".concat(t).concat(n));var d=this._messageListHandler.onMessageModified(l,e),p=d.isUpdated,h=d.message;!0===p&&this.emitOuterEvent(k.MESSAGE_MODIFIED,[h]);var f=this._isTopicConversation(l);if(Be.l("".concat(this._n,".onMessageModified isUpdated:").concat(p," isTopicMessage:").concat(f," from:").concat(n," to:").concat(i)),f)this.getModule(Fn).onMessageModified(e);else{var g=this._conversationMap.get(l);if(g){var m=g.lastMessage;Be.d("".concat(this._n.onMessageModified," lastMessage:"),JSON.stringify(m),"options:",JSON.stringify(e)),m&&m.lastTime===r&&m.lastSequence===o&&m.version!==c&&(m.type=a[0].type,m.payload=a[0].content,m.messageForShow=Bt(m.type,m.payload,this.isIntl()),m.cloudCustomData=s,m.version=c,this.emitConversationUpdate(!0,!1))}}return h}},{key:"onNewGroupAtTips",value:function(e){var n=this,i=e.dataList,r=null;i.forEach((function(e){e.groupAtTips?r=e.groupAtTips:e.elements?r=t(t({},e.elements),{},{sync:!0}):e.groupAtType&&(r=t(t({},e),{},{sync:!0})),r.__random=e.random,r.__sequence=e.clientSequence,n._tmpGroupAtTipsList.push(r)})),Be.d("".concat(this._n,".onNewGroupAtTips isReady:").concat(this._isReady),this._tmpGroupAtTipsList),this._isReady&&this._handleGroupAtTipsList()}},{key:"_handleGroupAtTipsList",value:function(){var e=this;if(0!==this._tmpGroupAtTipsList.length){var t=!1;this._tmpGroupAtTipsList.forEach((function(n){var i=n.groupID,r=n.from,o=n.topicID,a=void 0===o?void 0:o,s=n.sync,c=void 0!==s&&s;if(r!==e.getMyUserID())if(st(a)){var u=e._conversationMap.get("".concat(b.CONV_GROUP).concat(i));u&&(u.updateGroupAtInfoList(n),t=!0)}else{var l=e._conversationMap.get("".concat(b.CONV_GROUP).concat(a));if(l){l.updateGroupAtInfoList(n);var d=e.getModule(Fn),p=l.groupAtInfoList;d.onConversationProxy({topicID:a,groupAtInfoList:p})}$t(l)&&c&&(e.updateTopicConversation([{conversationID:"".concat(b.CONV_GROUP).concat(a),type:b.CONV_TOPIC}]),e._conversationMap.get("".concat(b.CONV_GROUP).concat(a)).updateGroupAtInfoList(n))}})),t&&this.emitConversationUpdate(!0,!1),this._tmpGroupAtTipsList.length=0}}},{key:"_getC2CPeerReadTime",value:function(e){var t=this,n=[];if(e.forEach((function(e){t._conversationMap.has(e.conversationID)||e.type!==b.CONV_C2C||n.push(e.conversationID.replace(b.CONV_C2C,""))})),n.length>0){Be.d("".concat(this._n,"._getC2CPeerReadTime userIDList:").concat(n));var i=this.getModule(Pn);i&&i.getRemotePeerReadTime(n)}}},{key:"_getStorageConversationList",value:function(){return this.getModule(Bn).getItem("conversationMap")}},{key:"_setStorageConversationList",value:function(){var e=this.getLocalConversationList().filter((function(e){return e.type===b.CONV_C2C||e.type===b.CONV_GROUP&&e.lastMessage.type!==b.MSG_GRP_TIP})).slice(0,20).map((function(e){return{conversationID:e.conversationID,type:e.type,subType:e.subType,lastMessage:e.lastMessage,groupProfile:e.groupProfile,userProfile:e.userProfile}}));this.getModule(Bn).setItem("conversationMap",e)}},{key:"emitConversationUpdate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalConversationList();if(t){var i=this.getModule(Un);i&&i.updateGroupLastMessage(n)}e&&this.emitOuterEvent(k.CONVERSATION_LIST_UPDATED)}},{key:"getLocalConversationList",value:function(){return _(this._conversationMap.values()).filter((function(e){return e.type!==b.CONV_TOPIC}))}},{key:"getLocalConversation",value:function(e){return this._conversationMap.get(e)}},{key:"hasLocalConversation",value:function(e){return this._conversationMap.has(e)}},{key:"getLocalOldestMessage",value:function(e){return this._messageListHandler.getLocalOldestMessage(e)}},{key:"syncConversationList",value:function(){var e=this,t=new wo("syncConversationList");return this._pagingStatus===en.NOT_START&&this._conversationMap.clear(),this._pagingGetConversationList().then((function(n){return e._pagingStatus=en.RESOLVED,e._diffAndDeleteConversation(),e.emitConversationUpdate(!0,!1),e._setStorageConversationList(),e._handleC2CPeerReadTime(),e._patchConversationProperties(),t.setMessage(e._conversationMap.size).setNetworkType(e.getNetworkType()).end(),n})).catch((function(n){return e._pagingStatus=en.REJECTED,t.setMessage(e._pagingTimeStamp),e.probeNetwork().then((function(e){var i=v(e,2),r=i[0],o=i[1];t.setError(n,r,o).end()})),Xo(n)}))}},{key:"_diffAndDeleteConversation",value:function(){var e=this;if(this._isSyncCompleted()){var t=[];this._conversationMap.forEach((function(n,i){!e._pagingConvIDMap.has(i)&&e._convIDFromUnreadDBMap.has(i)&&(e._conversationMap.delete(i),t.push(i))})),Be.l("".concat(this._n,"._diffAndDeleteConversation list:").concat(t))}}},{key:"_patchConversationProperties",value:function(){var e=this,t=Date.now(),n=this.checkAndPatchRemark(),i=this._messageRemindHandler.getC2CMessageRemindType(),r=this.getModule(Un).getGroupList();Promise.all([n,i,r]).then((function(){var n=Date.now()-t;Be.l("".concat(e._n,"._patchConversationProperties ok. cost ").concat(n," ms")),e.emitConversationUpdate(!0,!1),e.emitTotalUnreadMessageCountUpdate()}))}},{key:"_pagingGetConversationList",value:function(){var e=this,t="".concat(this._n,"._pagingGetConversationList");return Be.l("".concat(t," timeStamp:").concat(this._pagingTimeStamp," startIndex:").concat(this._pagingStartIndex)+" pinnedTimeStamp:".concat(this._pagingPinnedTimeStamp," pinnedStartIndex:").concat(this._pagingPinnedStartIndex)),this._pagingStatus=en.PENDING,this.request({protocolName:Li,requestData:{fromAccount:this.getMyUserID(),timeStamp:this._pagingTimeStamp,startIndex:this._pagingStartIndex,pinnedTimeStamp:this._pagingPinnedTimeStamp,pinnedStartIndex:this._pagingPinnedStartIndex,orderType:1}}).then((function(n){var i=n.data,r=i.completeFlag,o=i.conversations,a=void 0===o?[]:o,s=i.timeStamp,c=i.startIndex,u=i.pinnedTimeStamp,l=i.pinnedStartIndex,d=i.groupItem;if(Be.l("".concat(t," ok. completeFlag:").concat(r," count:").concat(a.length," isReady:").concat(e._isReady)),e._convGroupHandler.onConvGroupListSynced(d),a.length>0){var p=e._getConversationOptions(a);e._pagingConvIDMap=new Map([].concat(_(e._pagingConvIDMap),_(p.map((function(e){return[e.conversationID,1]}))))),e._updateLocalConversationList({conversationOptionsList:p,isFromGetConversations:!0}),e.isLoggedIn()&&e.emitConversationUpdate()}if(!e._isReady){if(!e.isLoggedIn())return Jo();e.triggerReady()}return e._pagingTimeStamp=s,e._pagingStartIndex=c,e._pagingPinnedTimeStamp=u,e._pagingPinnedStartIndex=l,1!==r?e._pagingGetConversationList():(e._handleGroupAtTipsList(),e._convGroupHandler.getRemoteConvGroupList(),Jo())})).catch((function(n){throw e.isLoggedIn()&&(e._isReady||(Be.w("".concat(t," failed. error:"),n),e.triggerReady())),n}))}},{key:"_updateLocalConversationList",value:function(e){var t,n=e.isFromGetConversations,i=e.isInstantMessage,r=Date.now();t=this._getTmpConversationListMapping(e),this._conversationMap=new Map(this._sortConversationList([].concat(_(t.toBeUpdatedConversationList),_(this._conversationMap)))),n||(this._updateUserOrGroupProfile(t.newConversationList),i&&this.emitTotalUnreadMessageCountUpdate()),Be.d("".concat(this._n,"._updateLocalConversationList cost ").concat(Date.now()-r," ms"))}},{key:"_getTmpConversationListMapping",value:function(e){for(var t=e.conversationOptionsList,n=e.isFromGetConversations,i=e.isInstantMessage,r=e.isUnreadC2CMessage,o=void 0!==r&&r,a=e.updateUnreadCount,s=[],c=[],u=this.getModule(Un),l=this.getModule(xn),d=this.isIntl(),p=0,h=t.length;p<h;p++){var f=new ma(t[p],d),g=f.conversationID;if(g!=="".concat(b.CONV_C2C,"@TLS#ERROR")&&g!=="".concat(b.CONV_C2C,"@TLS#NOT_FOUND"))if(this._conversationMap.has(g)){var m=this._conversationMap.get(g),v=["unreadCount","allowType","adminForbidType","payload","isPinned"];!1===i&&v.push("lastMessage");var _=t[p].lastMessage,y=!st(_);y||t[p].type===b.CONV_TOPIC||this._onLastMessageNotExist(t[p]),st(i)&&y&&null===m.lastMessage.payload&&(m.lastMessage.payload=_.payload),$t(m.lastMessage.revoker)||(m.lastMessage.revoker=null),ht(m,f,v,[null,void 0,"",0,NaN]),!0===a&&m.updateUnreadCount({nextUnreadCount:f.unreadCount,isFromGetConversations:n,isUnreadC2CMessage:o}),i&&y&&(_.payload&&(m.lastMessage.payload=_.payload),m.type===b.CONV_GROUP&&(m.lastMessage.nameCard=_.nameCard,m.lastMessage.nick=_.nick)),y&&m.lastMessage.cloudCustomData!==_.cloudCustomData&&(m.lastMessage.cloudCustomData=_.cloudCustomData||""),this._conversationMap.delete(g),s.push([g,m])}else{if(f.type===b.CONV_GROUP&&u){var I=f.groupProfile.groupID,M=u.getLocalGroupProfile(I);M&&(f.groupProfile=M,!0===a&&f.updateUnreadCount({nextUnreadCount:0}))}else if(f.type===b.CONV_C2C){var T=g.replace(b.CONV_C2C,"");l&&l.isMyFriend(T)&&(f.remark=l.getFriendRemark(T))}c.push(f),s.push([g,f])}}var C=this.getModule(Fn);return s.forEach((function(e){if(e[1].type===b.CONV_TOPIC){var t=e[1],n=t.conversationID,i=t.unreadCount,r=t.groupAtInfoList;C.onConversationProxy({topicID:n.replace(b.CONV_GROUP,""),unreadCount:i,groupAtInfoList:$t(r)?void 0:r})}})),{toBeUpdatedConversationList:s,newConversationList:c}}},{key:"_onLastMessageNotExist",value:function(e){new wo("lastMessageNotExist").setMessage("".concat(JSON.stringify(e))).setNetworkType(this.getNetworkType()).end()}},{key:"_sortConversationList",value:function(e){var t=[],n=[],i=[],r=[];return e.forEach((function(e){!0===e[1].isPinned?$t(e[1].lastMessage.lastTime)?n.push(e):t.push(e):$t(e[1].lastMessage.lastTime)?r.push(e):i.push(e)})),t.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})).concat(n).concat(i.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime}))).concat(r)}},{key:"_sortConversationListAndEmitEvent",value:function(){this._conversationMap=new Map(this._sortConversationList(_(this._conversationMap))),this.emitConversationUpdate(!0,!1)}},{key:"_updateUserOrGroupProfile",value:function(e){var t=this;if(0!==e.length){var n=[],i=[],r=this.getModule(Nn),o=this.getModule(Un);e.forEach((function(e){if(e.type===b.CONV_C2C)n.push(e.toAccount);else if(e.type===b.CONV_GROUP){var t=e.toAccount;o.hasLocalGroup(t)?e.groupProfile=o.getLocalGroupProfile(t):i.push(t)}})),Be.l("".concat(this._n,"._updateUserOrGroupProfile c2cUserIDList:").concat(n," groupIDList:").concat(i)),n.length>0&&r.getUserProfile({userIDList:n}).then((function(e){var n=e.data;at(n)?n.forEach((function(e){t._doUpdateUserProfile("C2C".concat(e.userID),e)})):t._doUpdateUserProfile("C2C".concat(n.userID),n)})),i.length>0&&o.getGroupProfileAdvance({groupIDList:i,responseFilter:{groupBaseInfoFilter:["Type","Name","FaceUrl"]}}).then((function(e){e.data.successGroupList.forEach((function(e){var n="GROUP".concat(e.groupID);if(t._conversationMap.has(n)){var i=t._conversationMap.get(n);ht(i.groupProfile,e,[],[null,void 0,"",0,NaN]),!i.subType&&e.type&&(i.subType=e.type)}}))}))}}},{key:"_doUpdateUserProfile",value:function(e,t){this.hasLocalConversation(e)&&(this.getLocalConversation(e).userProfile=t)}},{key:"_getConversationOptions",value:function(e){var n=this,i=[],r=e.filter((function(e){var t=e.type,n=e.userID;return 1===t&&"@TLS#NOT_FOUND"!==n&&"@TLS#ERROR"!==n||2===t})),o=this.getMyUserID(),a=r.map((function(e){if(st(e.lastMsg)&&(e.lastMsg={elements:[]}),1===e.type){var r={userID:e.userID,nick:e.peerNick,avatar:e.peerAvatar};return i.push(r),{conversationID:"C2C".concat(e.userID),type:"C2C",lastMessage:{lastTime:e.time,lastSequence:e.sequence,fromAccount:e.lastC2CMsgFromAccount,messageForShow:e.messageShow,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:null,payload:e.lastMsg.elements[0]?n._amendLayersOverLimitProperty(e.lastMsg.elements[0].content):null,cloudCustomData:e.lastMsg.cloudCustomData||"",isRevoked:8===e.lastMessageFlag,onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:e.lastC2CMsgFromAccount===o&&e.time<=e.c2cPeerReadTime,revoker:e.lastMsg.revokerInfo?e.lastMsg.revokerInfo.revoker:null},userProfile:new la(r),peerReadTime:e.c2cPeerReadTime,isPinned:1===e.isPinned,messageRemindType:"",customData:e.customMark||"",markList:jt(e.standardMark),conversationGroupList:n._convGroupHandler.getConvGroupListByID(e.contactGroupId)}}return{conversationID:"GROUP".concat(e.groupID),type:"GROUP",lastMessage:t(t({lastTime:e.time,lastSequence:e.sequence,fromAccount:e.msgGroupFromAccount,messageForShow:e.messageShow},n._patchTypeAndPayload(e)),{},{cloudCustomData:e.lastMsg.cloudCustomData||"",isRevoked:2===e.lastMessageFlag,onlineOnlyFlag:!1,nick:e.senderNick||"",nameCard:e.senderNameCard||"",revoker:e.lastMsg.revokerInfo?e.lastMsg.revokerInfo.revoker:null}),groupProfile:new fa({groupID:e.groupID,name:e.groupNick,avatar:e.groupImage}),unreadCount:e.unreadCount,peerReadTime:0,isPinned:1===e.isPinned,messageRemindType:"",version:0,customData:e.customMark||"",markList:jt(e.standardMark),conversationGroupList:n._convGroupHandler.getConvGroupListByID(e.contactGroupId)}}));return i.length>0&&this.getModule(Nn).onConversationsProfileUpdated(i),a}},{key:"_patchTypeAndPayload",value:function(e){var n=e.lastMsg,i=n.event,r=void 0===i?void 0:i,o=n.elements,a=void 0===o?[]:o,s=n.groupTips,c=void 0===s?{}:s;if(!st(r)&&!$t(c)){var u=new Ko(c);u.setElement({type:b.MSG_GRP_TIP,content:t(t({},c.elements),{},{groupProfile:c.groupProfile})});var l=JSON.parse(JSON.stringify(u.payload));return u=null,{type:b.MSG_GRP_TIP,payload:l}}return{type:a[0]?a[0].type:null,payload:a[0]?this._amendLayersOverLimitProperty(a[0].content):null}}},{key:"_amendLayersOverLimitProperty",value:function(e){var t=e.layersOverLimit;return 0===t?e.layersOverLimit=!1:1===t&&(e.layersOverLimit=!0),e}},{key:"getLocalMessageList",value:function(e){return this._messageListHandler.getLocalMessageList(e)}},{key:"deleteLocalMessage",value:function(e){e instanceof Ko&&this._messageListHandler.remove(e)}},{key:"onConversationDeleted",value:function(e){if(at(e)){var t=e.map((function(e){var t=e.type,n=e.userID,i=e.groupID;return 1===t?"".concat(b.CONV_C2C).concat(n):2===t?"".concat(b.CONV_GROUP).concat(i):void 0}));Be.l("".concat(this._n,".onConversationDeleted conversationIDList:").concat(t)),this.deleteLocalConversationList(t)}}},{key:"onConversationPinned",value:function(e){var t=this;if(at(e)){var n=!1;e.forEach((function(e){var i,r=e.type,o=e.userID,a=e.groupID;1===r?i=t.getLocalConversation("".concat(b.CONV_C2C).concat(o)):2===r&&(i=t.getLocalConversation("".concat(b.CONV_GROUP).concat(a))),i&&(Be.l("".concat(t._n,".onConversationPinned conversationID:").concat(i.conversationID," isPinned:").concat(i.isPinned)),i.isPinned||(i.isPinned=!0,n=!0))})),n&&this._sortConversationListAndEmitEvent()}}},{key:"onConversationUnpinned",value:function(e){var t=this;if(at(e)){var n=!1;e.forEach((function(e){var i,r=e.type,o=e.userID,a=e.groupID;1===r?i=t.getLocalConversation("".concat(b.CONV_C2C).concat(o)):2===r&&(i=t.getLocalConversation("".concat(b.CONV_GROUP).concat(a))),i&&(Be.l("".concat(t._n,".onConversationUnpinned conversationID:").concat(i.conversationID," isPinned:").concat(i.isPinned)),i.isPinned&&(i.isPinned=!1,n=!0))})),n&&this._sortConversationListAndEmitEvent()}}},{key:"getMessageList",value:function(e){var t=this,n=e.conversationID,i=e.nextReqMessageID,r=e.count,o="".concat(this._n,".getMessageList"),a=this.getLocalConversation(n),s="";if(a&&a.groupProfile&&(s=a.groupProfile.type),St(s))return Be.l("".concat(o," not available in avchatroom. conversationID:").concat(n)),Jo({messageList:[],nextReqMessageID:"",isCompleted:!0});(st(r)||r>15)&&(r=15),!i&&this._isNotInCommunity(n)&&(this._messageListHandler.removeByConversationID(n),this._completedMap.delete(n),this._roamingMessageSequenceMap.delete(n));var c=this._computeRemainingCount({conversationID:n,nextReqMessageID:i}),u=this._completedMap.has(n);if(Be.l("".concat(o," conversationID:").concat(n," nextReqMessageID:").concat(i)+" remainingCount:".concat(c," count:").concat(r," isCompleted:").concat(u)),this._needGetHistory({conversationID:n,remainingCount:c,count:r}))return this.getHistoryMessages({conversationID:n,nextReqMessageID:i,count:20}).then((function(e){var i=e.nextReqID,r=e.storedMessageList,a=t._completedMap.has(n),s=r;c>0&&(s=t._messageListHandler.getLocalMessageList(n).slice(0,r.length+c));var u={nextReqMessageID:a?"":i,messageList:s,isCompleted:a};return Be.l("".concat(o," ret.nextReqMessageID:").concat(u.nextReqMessageID," ret.isCompleted:").concat(u.isCompleted," ret.length:").concat(s.length)),zo(u)}));this.modifyMessageList(n);var l=this._getMessageListFromMemory({conversationID:n,nextReqMessageID:i,count:r});return Jo(l)}},{key:"_getMessageListFromMemory",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,i=e.count,r="".concat(this._n,"._getMessageListFromMemory"),o=this._messageListHandler.getLocalMessageList(t),a=o.length,s=0,c={isCompleted:!1,nextReqMessageID:"",messageList:[]};return n?(s=o.findIndex((function(e){return e.ID===n})))>i?(c.messageList=o.slice(s-i,s),c.nextReqMessageID=o[s-i].ID):(c.messageList=o.slice(0,s),c.isCompleted=!0):a>i?(s=a-i,c.messageList=o.slice(s,a),c.nextReqMessageID=o[s].ID):(c.messageList=o.slice(0,a),c.isCompleted=!0),Be.l("".concat(r," conversationID:").concat(t)+" ret.nextReqMessageID:".concat(c.nextReqMessageID," ret.isCompleted:").concat(c.isCompleted," ret.length:").concat(c.messageList.length)),c}},{key:"getMessageListHopping",value:function(e){var t=e.conversationID,n=e.sequence,i=e.time,r=e.count,o=e.direction,a=void 0===o?0:o;if((st(r)||r>15)&&(r=15),t.startsWith(b.CONV_C2C)){var s=this.getModule(Pn),c=t.replace(b.CONV_C2C,"");return s.getRoamingMessagesHopping({peerAccount:c,time:i,count:r,direction:a})}if(t.startsWith(b.CONV_GROUP)){var u=this.getModule(Un),l=t.replace(b.CONV_GROUP,"");return u.getRoamingMessagesHopping({groupID:l,sequence:n,count:r,direction:a})}}},{key:"_computeRemainingCount",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,i=this._messageListHandler.getLocalMessageList(t),r=i.length;if(!n)return r;var o=0;return bt(t)?o=i.findIndex((function(e){return e.ID===n})):Dt(t)&&(o=-1!==n.indexOf("-")?i.findIndex((function(e){return e.ID===n})):i.findIndex((function(e){return e.sequence===n}))),-1===o&&(o=0),o}},{key:"_getMessageListSize",value:function(e){return this._messageListHandler.getLocalMessageList(e).length}},{key:"_needGetHistory",value:function(e){var t=e.conversationID,n=e.remainingCount,i=e.count,r=this.getLocalConversation(t),o="";return r&&r.groupProfile&&(o=r.groupProfile.type),!wt(t)&&!St(o)&&!(Dt(t)&&this._isPagingGetGroupListCompleted()&&this._getLocalGroupCount()<=4e3&&!this._hasLocalGroup(t)&&!this._isTopicConversation(t))&&n<=i&&!this._completedMap.has(t)}},{key:"_isTopicConversation",value:function(e){var t=e.replace(b.CONV_GROUP,"");return kt(t)}},{key:"getHistoryMessages",value:function(e){var t=e.conversationID,n=e.count;if(t===b.CONV_SYSTEM)return Jo();var i=15;n>20&&(i=20);var r=null;if(bt(t)){var o=this._roamingMessageKeyAndTimeMap.has(t);return(r=this.getModule(Pn))?r.getRoamingMessage({conversationID:t,peerAccount:t.replace(b.CONV_C2C,""),count:i,lastMessageTime:o?this._roamingMessageKeyAndTimeMap.get(t).lastMessageTime:0,messageKey:o?this._roamingMessageKeyAndTimeMap.get(t).messageKey:""}):Xo({code:fo.CANNOT_FIND_MODULE})}if(Dt(t)){if(!(r=this.getModule(Un)))return Xo({code:fo.CANNOT_FIND_MODULE});var a=null;this._conversationMap.has(t)&&(a=this._conversationMap.get(t).lastMessage);var s=0;a&&(s=a.lastSequence);var c=this._roamingMessageSequenceMap.get(t);return r.getRoamingMessage({conversationID:t,groupID:t.replace(b.CONV_GROUP,""),count:i,sequence:c||s})}return Jo()}},{key:"patchConversationLastMessage",value:function(e){var t=this.getLocalConversation(e);if(t){var n=t.lastMessage,i=n.messageForShow,r=n.payload;if($t(i)||$t(r)){var o=this._messageListHandler.getLocalMessageList(e);if(0===o.length)return;var a=o[o.length-1];Be.l("".concat(this._n,".patchConversationLastMessage conversationID:").concat(e," payload:"),a.payload),t.updateLastMessage(a)}}}},{key:"onRoamingMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=n.startsWith(b.CONV_C2C)?b.CONV_C2C:b.CONV_GROUP,o=null,a=[],s=[],c=0,u=e.length,l=null,d=r===b.CONV_GROUP,p=this.getModule(Kn),h=this.getFileDownloadProxy(),f=function(){c=d?e.length-1:0,u=d?0:e.length},g=function(){d?--c:++c},m=function(){return d?c>=u:c<u};for(f();m();g())if(d&&1===e[c].sequence&&i&&this.setCompleted(n),1!==e[c].isPlaceMessage)if((o=new Ko(e[c])).to=e[c].to,r!==b.CONV_GROUP||st(e[c].topicID)||(o.to=e[c].topicID),o.isSystemMessage=!!e[c].isSystemMessage,o.conversationType=r,4===e[c].event?l={type:b.MSG_GRP_TIP,content:t(t({},e[c].elements),{},{groupProfile:e[c].groupProfile})}:(e[c].elements=p.parseElements(e[c].elements,e[c].from),l=e[c].elements),d||o.setNickAndAvatar({nick:e[c].nick,avatar:e[c].avatar}),$t(l)){var v=new wo("emptyMessageBody");v.setMessage("from:".concat(o.from," to:").concat(o.to," sequence:").concat(o.sequence," event:").concat(e[c].event)),v.setNetworkType(this.getNetworkType()).setLevel("warning").end()}else o.setElement(l,h),o.reInitialize(this.getMyUserID()),a.push(o);return f=g=m=null,i?(this._messageListHandler.unshift(a,s),a=null,s):(s=null,a)}},{key:"findMessage",value:function(e){return this._messageListHandler.findMessage(e)}},{key:"_isNotInCommunity",value:function(e){var t=!1;if(e.startsWith(b.CONV_GROUP)&&this._isTopicConversation(e)){var n=qt(e.replace(b.CONV_GROUP,""));this.getModule(Un).hasLocalGroup(n)||(t=!0)}return t}},{key:"deleteTopicRoamingMessageInfo",value:function(e){var t=this;Et({groupID:e})&&this._messageListHandler.getTopicConversationIDList(e).forEach((function(e){t._messageListHandler.removeByConversationID(e),t._completedMap.delete(e),t._roamingMessageSequenceMap.delete(e)}))}},{key:"deleteGroupRomaingMessageInfo",value:function(e){var t="".concat(b.CONV_GROUP).concat(e);this._messageListHandler.removeByConversationID(t),this._completedMap.delete(t),this._roamingMessageSequenceMap.delete(t)}},{key:"setMessageRead",value:function(e){var t=e.conversationID,n=this.getLocalConversation(t);if(Be.l("".concat(this._n,".setMessageRead conversationID:").concat(t," unreadCount:").concat(n?n.unreadCount:0)),!n)return Jo();if(n.type!==b.CONV_GROUP&&n.type!==b.CONV_TOPIC||$t(n.groupAtInfoList)||this.deleteGroupAtTips(t),0===n.unreadCount)return Jo();if(n.type===b.CONV_GROUP&&!this._hasLocalGroup(t))return 0!==n.unreadCount&&(n.unreadCount=0,this.emitConversationUpdate(!0,!1)),Jo();var i=this._messageListHandler.getLocalLastMessage(t),r=n.lastMessage.lastTime;i&&r<i.time&&(r=i.time);var o=n.lastMessage.lastSequence;if(i&&o<i.sequence&&(o=i.sequence),n.type===b.CONV_TOPIC&&st(i)){var a=this.getModule(Fn),s=t.replace(b.CONV_GROUP,""),c=qt(s),u=a.getLocalTopic(c,s);u&&(o=u.nextMessageSeq-1)}var l=null;switch(n.type){case b.CONV_C2C:return(l=this.getModule(Pn))?l.setMessageRead({conversationID:t,lastMessageTime:r}):Xo({code:fo.CANNOT_FIND_MODULE});case b.CONV_GROUP:case b.CONV_TOPIC:return(l=this.getModule(Un))?l.setMessageRead({conversationID:t,lastMessageSeq:o}):Xo({code:fo.CANNOT_FIND_MODULE});case b.CONV_SYSTEM:return n.unreadCount=0,this.emitConversationUpdate(!0,!1),Jo();default:return Jo()}}},{key:"setAllMessageRead",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="setAllMessageRead",i="".concat(this._n,".").concat(n);t.scope||(t.scope=b.READ_ALL_MSG),Be.l("".concat(i," options:"),t);var r=this._createSetAllMessageReadPack(t);if(0===r.readAllC2CMessage&&0===r.groupMessageReadInfoList.length)return Jo();var o=new wo(n);return this.request({protocolName:sr,requestData:r}).then((function(n){var i=n.data,r=e._handleAllMessageRead(i);return o.setMessage("scope:".concat(t.scope," failureGroups:").concat(JSON.stringify(r))).setNetworkType(e.getNetworkType()).end(),Jo()})).catch((function(t){return e.probeNetwork().then((function(e){var n=v(e,2),i=n[0],r=n[1];o.setError(t,i,r).end()})),Be.w("".concat(i," failed. error:"),t),Xo({code:t&&t.code?t.code:fo.MESSAGE_UNREAD_ALL_FAIL,message:t&&t.message?t.message:void 0})}))}},{key:"setConversationCustomData",value:function(e){return this._convGroupHandler.setConvCustomData(e)}},{key:"markConversation",value:function(e){return this._convGroupHandler.markConversation(e)}},{key:"getConversationGroupList",value:function(){return this._convGroupHandler.getLocalConvGroupList()}},{key:"createConversationGroup",value:function(e){return this._convGroupHandler.createConvGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._convGroupHandler.deleteConvGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._convGroupHandler.renameConvGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._convGroupHandler.addConvsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._convGroupHandler.deleteConvsFromGroup(e)}},{key:"onConversationMarkUpdated",value:function(e){this._convGroupHandler.onConvMarkUpdated(e)}},{key:"onConversationGroupCreated",value:function(e){this._convGroupHandler.onConvGroupCreated(e)}},{key:"onConversationGroupDeleted",value:function(e){this._convGroupHandler.onConvGroupDeleted(e)}},{key:"onConversationGroupNameUpdated",value:function(e){this._convGroupHandler.onConvGroupNameUpdated(e)}},{key:"onConversationInGroupUpdated",value:function(e){this._convGroupHandler.onConvInGroupUpdated(e)}},{key:"onConversationAddedToOrDeletedFromGroup",value:function(e){this._convGroupHandler.onConvAddedToOrDeletedFromGroup(e)}},{key:"_getConversationLastMessageSequence",value:function(e){var t=this._messageListHandler.getLocalLastMessage(e.conversationID),n=e.lastMessage.lastSequence;return t&&n<t.sequence&&(n=t.sequence),n}},{key:"_getConversationLastMessageTime",value:function(e){var t=this._messageListHandler.getLocalLastMessage(e.conversationID),n=e.lastMessage.lastTime;return t&&n<t.time&&(n=t.time),n}},{key:"_createSetAllMessageReadPack",value:function(e){var t,n={readAllC2CMessage:0,groupMessageReadInfoList:[]},i=e.scope,r=E(this._conversationMap);try{for(r.s();!(t=r.n()).done;){var o=v(t.value,2)[1];if(o.unreadCount>0)if(o.type===b.CONV_C2C&&0===n.readAllC2CMessage){if(i===b.READ_ALL_MSG)n.readAllC2CMessage=1;else if(i===b.READ_ALL_C2C_MSG){n.readAllC2CMessage=1;break}}else if(o.type===b.CONV_GROUP&&(i===b.READ_ALL_GROUP_MSG||i===b.READ_ALL_MSG)){var a=this._getConversationLastMessageSequence(o);n.groupMessageReadInfoList.push({groupID:o.groupProfile.groupID,messageSequence:a})}}}catch(s){r.e(s)}finally{r.f()}return n}},{key:"onPushedAllMessageRead",value:function(e){this._handleAllMessageRead(e)}},{key:"_handleAllMessageRead",value:function(e){var t=e.groupMessageReadInfoList,n=e.readAllC2CMessage,i=this._parseGroupReadInfo(t);return this._updateAllConversationUnreadCount({readAllC2CMessage:n})>=1&&(this.emitConversationUpdate(!0,!1),this.emitTotalUnreadMessageCountUpdate()),i}},{key:"_parseGroupReadInfo",value:function(e){var t=[];if(e&&e.length)for(var n=0,i=e.length;n<i;n++){var r=e[n],o=r.groupID,a=r.sequence,s=r.retCode,c=r.lastMessageSeq;st(s)?this._remoteGroupReadSequenceMap.set(o,c):(this._remoteGroupReadSequenceMap.set(o,a),0!==s&&t.push("".concat(o,"-").concat(a,"-").concat(s)))}return t}},{key:"_updateAllConversationUnreadCount",value:function(e){var t,n=e.readAllC2CMessage,i=0,r=E(this._conversationMap);try{for(r.s();!(t=r.n()).done;){var o=v(t.value,2),a=o[0],s=o[1];if(s.unreadCount>=1){if(1===n&&s.type===b.CONV_C2C){var c=this._getConversationLastMessageTime(s);this.updateIsReadAfterReadReport({conversationID:a,lastMessageTime:c})}else if(s.type===b.CONV_GROUP){var u=a.replace(b.CONV_GROUP,"");if(this._remoteGroupReadSequenceMap.has(u)){var l=this._remoteGroupReadSequenceMap.get(u),d=this._getConversationLastMessageSequence(s);this.updateIsReadAfterReadReport({conversationID:a,remoteReadSequence:l}),d>=l&&this._remoteGroupReadSequenceMap.delete(u)}}this.updateUnreadCount(a,!1)&&(i+=1)}}}catch(p){r.e(p)}finally{r.f()}return i}},{key:"isRemoteRead",value:function(e){var t=e.conversationID,n=e.sequence,i=t.replace(b.CONV_GROUP,""),r=!1;if(this._remoteGroupReadSequenceMap.has(i)){var o=this._remoteGroupReadSequenceMap.get(i);n<=o&&(r=!0,Be.l("".concat(this._n,".isRemoteRead conversationID:").concat(t," messageSequence:").concat(n," remoteReadSequence:").concat(o))),n>=o+10&&this._remoteGroupReadSequenceMap.delete(i)}return r}},{key:"updateIsReadAfterReadReport",value:function(e){var t=e.conversationID,n=e.lastMessageSeq,i=e.lastMessageTime,r=this._messageListHandler.getLocalMessageList(t);if(0!==r.length)for(var o,a=r.length-1;a>=0;a--)if(o=r[a],!(i&&o.time>i||n&&o.sequence>n)){if("in"===o.flow&&o.isRead)break;o.setIsRead(!0)}}},{key:"updateUnreadCount",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!1,i=this.getLocalConversation(e),r=this._messageListHandler.getLocalMessageList(e);if(i){var o=i.unreadCount,a=r.filter((function(e){return!e.isRead&&!e._onlineOnlyFlag&&!e.isDeleted})).length;if(o!==a&&(i.unreadCount=a,n=!0,Be.l("".concat(this._n,".updateUnreadCount from ").concat(o," to ").concat(a,", conversationID:").concat(e)),!0===t&&(this.emitConversationUpdate(!0,!1),this.emitTotalUnreadMessageCountUpdate())),n&&i.type===b.CONV_TOPIC){var s=i.unreadCount,c=this.getModule(Fn),u=e.replace(b.CONV_GROUP,"");c.onConversationProxy({topicID:u,unreadCount:s})}return n}}},{key:"clearGroupAtInfoList",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalConversation(e);if(n&&n.groupAtInfoList.length>0){if(n.clearGroupAtInfoList(),Be.l("".concat(this._n,".clearGroupAtInfoList conversationID:").concat(e)),n.type===b.CONV_TOPIC){var i=n.groupAtInfoList,r=this.getModule(Fn),o=e.replace(b.CONV_GROUP,"");r.onConversationProxy({topicID:o,groupAtInfoList:i})}!0===t&&this.emitConversationUpdate(!0,!1)}}},{key:"updateReadReceiptInfo",value:function(e){var t=this,n=e.userID,i=void 0===n?void 0:n,r=e.groupID,o=void 0===r?void 0:r,a=e.readReceiptList;if(!$t(a)){var s=[];if(st(i)){if(!st(o)){var c="".concat(b.CONV_GROUP).concat(o);a.forEach((function(e){var n=e.tinyID,i=e.clientTime,r=e.random,a=e.readCount,u=e.unreadCount,l="".concat(n,"-").concat(i,"-").concat(r),d=t._messageListHandler.getLocalMessage(c,l),p={groupID:o,messageID:l,readCount:0,unreadCount:0};d&&(nt(a)&&(d.readReceiptInfo.readCount=a,p.readCount=a),nt(u)&&(d.readReceiptInfo.unreadCount=u,p.unreadCount=u),s.push(p))}))}}else{var u="".concat(b.CONV_C2C).concat(i);a.forEach((function(e){var n=e.tinyID,r=e.clientTime,o=e.random,a="".concat(n,"-").concat(r,"-").concat(o),c=t._messageListHandler.getLocalMessage(u,a);if(c){c.readReceiptInfo.isPeerRead=!0;var l={userID:i,messageID:a,isPeerRead:!0};s.push(l)}}))}s.length>0&&this.emitOuterEvent(k.MESSAGE_READ_RECEIPT_RECEIVED,s)}}},{key:"recomputeGroupUnreadCount",value:function(e){var t=e.conversationID,n=e.count,i=this.getLocalConversation(t);if(i){var r=i.unreadCount,o=r-n;o<0&&(o=0),i.unreadCount=o,Be.l("".concat(this._n,".recomputeGroupUnreadCount from ").concat(r," to ").concat(o,", conversationID:").concat(t))}}},{key:"updateIsRead",value:function(e){var t=this.getLocalConversation(e),n=this.getLocalMessageList(e);if(t&&0!==n.length&&!wt(t.type)){for(var i=[],r=0,o=n.length;r<o;r++)"in"!==n[r].flow?"out"!==n[r].flow||n[r].isRead||n[r].setIsRead(!0):i.push(n[r]);var a=0;if(t.type===b.CONV_C2C){var s=i.slice(-t.unreadCount).filter((function(e){return e.isRevoked})).length;a=i.length-t.unreadCount-s}else a=i.length-t.unreadCount;for(var c=0;c<a&&!i[c].isRead;c++)i[c].setIsRead(!0)}}},{key:"deleteGroupAtTips",value:function(e){var t=this,n="".concat(this._n,".deleteGroupAtTips");Be.l("".concat(n));var i=this._conversationMap.get(e);if(!i)return Promise.resolve();var r=i.groupAtInfoList;if(0===r.length)return Promise.resolve();var o=void 0;e.startsWith(b.CONV_GROUP)&&(o=e.replace(b.CONV_GROUP,""));var a=_(r);if((Et({groupID:o})||kt(o))&&0===(a=r.filter((function(e){return!e.atTypeArray.includes(b.CONV_AT_ALL)}))).length)return this.clearGroupAtInfoList(e,!1),Promise.resolve();var s=this.getMyUserID();return this.request({protocolName:xi,requestData:{messageListToDelete:a.map((function(e){return{from:e.from,to:s,messageSeq:e.__sequence,messageRandom:e.__random,groupID:st(e.topicID)?e.groupID:e.topicID}}))}}).then((function(){return Be.l("".concat(n," ok. count:").concat(r.length)),t.clearGroupAtInfoList(e,!1),Promise.resolve()})).catch((function(e){return Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"appendToMessageList",value:function(e){this._messageListHandler.pushIn(e)}},{key:"setMessageRandom",value:function(e){this.singlyLinkedList.set(e.random)}},{key:"deleteMessageRandom",value:function(e){this.singlyLinkedList.delete(e.random)}},{key:"pushIntoMessageList",value:function(e,t,n){return!(!this._messageListHandler.pushIn(t,n)||this._isMessageFromCurrentInstance(t)&&!n||(e.push(t),0))}},{key:"_isMessageFromCurrentInstance",value:function(e){return this.singlyLinkedList.has(e.random)}},{key:"revoke",value:function(e,t,n){return this._messageListHandler.revoke(e,t,n)}},{key:"getPeerReadTime",value:function(e){return this._peerReadTimeMap.get(e)}},{key:"recordPeerReadTime",value:function(e,t){this._peerReadTimeMap.has(e)?this._peerReadTimeMap.get(e)<t&&this._peerReadTimeMap.set(e,t):this._peerReadTimeMap.set(e,t)}},{key:"updateMessageIsPeerReadProperty",value:function(e,t){if(e.startsWith(b.CONV_C2C)&&t>0){var n=this._messageListHandler.updateMessageIsPeerReadProperty(e,t);if(n.length>0&&this.emitOuterEvent(k.MESSAGE_READ_BY_PEER,n),this._conversationMap.has(e)){var i=this._conversationMap.get(e).lastMessage;$t(i)||i.fromAccount===this.getMyUserID()&&i.lastTime<=t&&!i.isPeerRead&&(i.isPeerRead=!0,this.emitConversationUpdate(!0,!1))}}}},{key:"updateMessageIsModifiedProperty",value:function(e){this._messageListHandler.updateMessageIsModifiedProperty(e)}},{key:"setCompleted",value:function(e){Be.l("".concat(this._n,".setCompleted. conversationID:").concat(e)),this._completedMap.set(e,!0)}},{key:"updateRoamingMessageKeyAndTime",value:function(e,t,n){this._roamingMessageKeyAndTimeMap.set(e,{messageKey:t,lastMessageTime:n})}},{key:"updateRoamingMessageSequence",value:function(e,t){this._roamingMessageSequenceMap.set(e,t)}},{key:"getConversationList",value:function(e){var t=this,n="getConversationList",i="".concat(this._n,".").concat(n),r="pagingStatus:".concat(this._pagingStatus,", local conversation count:").concat(this._conversationMap.size,", options:").concat(e);if(Be.l("".concat(i,". ").concat(r)),this._pagingStatus===en.REJECTED){var o=new wo(n);return o.setMessage(r),this.syncConversationList().then((function(){o.setNetworkType(t.getNetworkType()).end();var n=t._getConversationList(e);return zo({conversationList:n,isSyncCompleted:t._isSyncCompleted()})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),Be.e("".concat(i," failed. error:"),e),Xo(e)}))}if(0===this._conversationMap.size){var a=new wo(n);return a.setMessage(r),this.syncConversationList().then((function(){a.setNetworkType(t.getNetworkType()).end();var n=t._getConversationList(e);return zo({conversationList:n,isSyncCompleted:t._isSyncCompleted()})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(i," failed. error:"),e),Xo(e)}))}var s=this._getConversationList(e);return Be.l("".concat(i,". returned conversation count:").concat(s.length)),Jo({conversationList:s,isSyncCompleted:this._isSyncCompleted()})}},{key:"_getConversationList",value:function(e){if(st(e))return this.getLocalConversationList();if(at(e))return 0===e.length?[]:this.getLocalConversationList().filter((function(t){return e.includes(t.conversationID)}));if(ot(e)){var t=e.type,n=e.markType,i=e.groupName;return this.getLocalConversationList().filter((function(e){return(t!==b.CONV_C2C&&t!==b.CONV_GROUP||e.type===t)&&(!it(i)||e.conversationGroupList.includes(i))&&(!nt(n)||e.markList.includes(n))}))}return[]}},{key:"_handleC2CPeerReadTime",value:function(){var e,t=E(this._conversationMap);try{for(t.s();!(e=t.n()).done;){var n=v(e.value,2),i=n[0],r=n[1];r.type===b.CONV_C2C&&(Be.d("".concat(this._n,"._handleC2CPeerReadTime conversationID:").concat(i," peerReadTime:").concat(r.peerReadTime)),this.recordPeerReadTime(i,r.peerReadTime))}}catch(o){t.e(o)}finally{t.f()}}},{key:"_isPagingGetGroupListCompleted",value:function(){return this.getModule(Un).isPagingGetCompleted()}},{key:"_getLocalGroupCount",value:function(){return this.getModule(Un).getLocalGroupList().length}},{key:"_hasLocalGroup",value:function(e){return this.getModule(Un).hasLocalGroup(e.replace(b.CONV_GROUP,""))}},{key:"getConversationProfile",value:function(e){var t,n=this;if((t=this._conversationMap.has(e)?this._conversationMap.get(e):new ma({conversationID:e,type:e.slice(0,3)===b.CONV_C2C?b.CONV_C2C:b.CONV_GROUP},this.isIntl()))._isInfoCompleted||t.type===b.CONV_SYSTEM)return Jo({conversation:t});if(Dt(e)&&!this._hasLocalGroup(e))return Jo({conversation:t});var i="".concat(this._n,".").concat("getConversationProfile"),r=new wo("getConversationProfile");return Be.l("".concat(i,". conversationID:").concat(e," remark:").concat(t.remark," lastMessage:"),t.lastMessage),this._updateUserOrGroupProfileCompletely(t).then((function(o){r.setNetworkType(n.getNetworkType()).setMessage("conversationID:".concat(e," unreadCount:").concat(o.data.conversation.unreadCount)).end();var a=n.getModule(xn);if(a&&t.type===b.CONV_C2C){var s=e.replace(b.CONV_C2C,"");if(a.isMyFriend(s)){var c=a.getFriendRemark(s);t.remark!==c&&(t.remark=c,Be.l("".concat(i,". conversationID:").concat(e," patch remark:").concat(t.remark)))}}return Be.l("".concat(i," ok. conversationID:").concat(e)),o})).catch((function(t){return n.probeNetwork().then((function(n){var i=v(n,2),o=i[0],a=i[1];r.setError(t,o,a).setMessage("conversationID:".concat(e)).end()})),Be.e("".concat(i," failed. error:"),t),Xo(t)}))}},{key:"_updateUserOrGroupProfileCompletely",value:function(e){var t=this;return e.type===b.CONV_C2C?this.getModule(Nn).getUserProfile({userIDList:[e.toAccount]}).then((function(n){var i=n.data;return 0===i.length?Xo(new Wo({code:fo.USER_OR_GROUP_NOT_FOUND})):(e.userProfile=i[0],e._isInfoCompleted=!0,t._unshiftConversation(e),Jo({conversation:e}))})):this.getModule(Un).getGroupProfile({groupID:e.toAccount}).then((function(n){return e.groupProfile=n.data.group,e._isInfoCompleted=!0,t._unshiftConversation(e),Jo({conversation:e})}))}},{key:"_unshiftConversation",value:function(e){e instanceof ma&&!this._conversationMap.has(e.conversationID)&&(this._conversationMap=new Map([[e.conversationID,e]].concat(_(this._conversationMap))),this._setStorageConversationList(),this.emitConversationUpdate(!0,!1))}},{key:"_onProfileUpdated",value:function(e){var t=this;e.data.forEach((function(e){var n=e.userID;if(n===t.getMyUserID())t._onMyProfileModified({latestNick:e.nick,latestAvatar:e.avatar});else{var i=t._conversationMap.get("".concat(b.CONV_C2C).concat(n));i&&(i.userProfile=e)}}))}},{key:"_isSyncCompleted",value:function(){return this._pagingStatus===en.RESOLVED}},{key:"_errorLog",value:function(e,t,n,i){var r=new Error("Params validate failed."),o="".concat(this.getErrorMessage("API_REFER")).concat(e);throw Be.w("[".concat(e,"] | ").concat(t," | ").concat(this.getErrorMessage(n,i),", ").concat(o)),Be.e("[".concat(e,"] Invalid ").concat(t,": type check failed for ").concat(t,".")),r}},{key:"_isValidConversationID",value:function(e){return bt(e)||Dt(e)||wt(e)}},{key:"deleteConversation",value:function(e){var t=this,n="deleteConversation";return it(e)||rt(e)||this._errorLog(n,"options","StringOrObjectRequiredLog"),it(e)?(this._isValidConversationID(e)||this._errorLog(n,"options","InvalidConversationID",e),Be.l("".concat(this._n,".").concat(n," conversationID:").concat(e)),this.deleteConversationList({conversationIDList:[e],flag:1})):(at(e.conversationIDList)||this._errorLog(n,"conversationIDList","ArrayRequiredLog"),0===e.conversationIDList.length&&this._errorLog(n,"conversationIDList","NonEmptyArrayLog"),e.conversationIDList.forEach((function(e){t._isValidConversationID(e)||t._errorLog(n,"conversationIDList","InvalidConversationID",e)})),"clearHistoryMessage"in e&&"boolean"!=typeof e.clearHistoryMessage&&this._errorLog(n,"clearHistoryMessage","BooleanRequiredLog"),e.conversationIDList.length>100&&(e.conversationIDList=e.conversationIDList.slice(0,100)),this.deleteConversationList(e))}},{key:"deleteConversationList",value:function(e){var t=this,n=e.conversationIDList,i=void 0===n?[]:n,r=e.clearHistoryMessage,o=void 0===r||r,a=e.flag,s=void 0===a?0:a,c="".concat(this._n,".").concat("deleteConversationList");Be.l("".concat(c," conversationIDList.length:").concat(i.length," clearHistoryMessage:").concat(o));var u=new wo("deleteConversationList");return u.setMessage("conversationIDList:".concat(i)),Promise.all([this.rmLocalOnlyConversationList(i),this.rmLocalAndRemoteConversationList(i,o)]).then((function(e){u.setNetworkType(t.getNetworkType()).end();var n=[].concat(_(e[0]),_(e[1]));return 0===n.length?Xo(new Wo({code:fo.CONVERSATION_NOT_FOUND})):(Be.l("".concat(c," ok")),Jo(1===s?{conversationID:n[0]}:{conversationIDList:n}))})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];u.setError(e,i,r).end()})),Be.e("".concat(c," failed. error:"),e),Xo(e)}))}},{key:"rmLocalOnlyConversationList",value:function(e){var t=this;return e.filter((function(e){if(!t._conversationMap.has(e))return!1;var n=t.getLocalConversation(e).type;return n!==b.CONV_GROUP||t._hasLocalGroup(e)?n===b.CONV_SYSTEM&&(t.getModule(Un).deleteGroupSystemNotice({messageList:t._messageListHandler.getLocalMessageList(e)}),t.deleteLocalConversation(e),!0):(t.deleteLocalConversation(e),!0)}))}},{key:"rmLocalAndRemoteConversationList",value:function(e,t){var n=this,i={fromAccount:this.getMyUserID(),conversationList:[],clearHistoryMessage:t?1:0};return e.forEach((function(e){if(n._conversationMap.has(e)){var t=n.getLocalConversation(e).type;t===b.CONV_C2C?i.conversationList.push({toAccount:e.replace(t,""),type:1}):t===b.CONV_GROUP&&n._hasLocalGroup(e)&&i.conversationList.push({toGroupID:e.replace(t,""),type:2})}})),0===i.conversationList.length?[]:this.request({protocolName:Ni,requestData:i}).then((function(e){var t=[];return e.data.resultList.length>0&&e.data.resultList.map((function(e){if(0===e.code){var n="".concat(1===e.type?b.CONV_C2C:b.CONV_GROUP).concat(e.to);t.push(n)}})),n.deleteLocalConversationList(t),t}))}},{key:"clearHistoryMessage",value:function(e){var t=this,n={fromAccount:this.getMyUserID(),toAccount:void 0,type:void 0,toGroupID:void 0};if(!this._conversationMap.has(e))return Xo({code:fo.CONVERSATION_NOT_FOUND});var i=this._conversationMap.get(e).type;if(i===b.CONV_C2C)n.type=1,n.toAccount=e.replace(b.CONV_C2C,"");else{if(i!==b.CONV_GROUP)return i===b.CONV_SYSTEM?(this.getModule(Un).deleteGroupSystemNotice({messageList:this._messageListHandler.getLocalMessageList(e)}),Jo({conversationID:e})):Xo({code:fo.CONVERSATION_UN_RECORDED_TYPE});n.type=2,n.toGroupID=e.replace(b.CONV_GROUP,"")}var r="".concat(this._n,".").concat("clearHistoryMessage"),o=new wo("clearHistoryMessage");return o.setMessage("conversationID:".concat(e)),Be.l("".concat(r,". conversationID:").concat(e)),this.setMessageRead({conversationID:e}).then((function(){return t.request({protocolName:Pi,requestData:n})})).then((function(){o.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(r," ok")),t._messageListHandler.removeByConversationID(e),t.setCompleted(e);var n=t.getLocalConversation(e);return n&&(n.updateLastMessage(),t._sortConversationListAndEmitEvent()),Jo({conversationID:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),Be.e("".concat(r," failed. error:"),e),Xo(e)}))}},{key:"pinConversation",value:function(e){var t=this,n=e.conversationID,i=e.isPinned;if(!this._conversationMap.has(n))return Xo({code:fo.CONVERSATION_NOT_FOUND});var r=this.getLocalConversation(n);if(r.isPinned===i)return Jo({conversationID:n});var o="".concat(this._n,".").concat("pinConversation"),a=new wo("pinConversation");a.setMessage("conversationID:".concat(n," isPinned:").concat(i)),Be.l("".concat(o,". conversationID:").concat(n," isPinned:").concat(i));var s=null;return bt(n)?s={type:1,toAccount:n.replace(b.CONV_C2C,"")}:Dt(n)&&(s={type:2,groupID:n.replace(b.CONV_GROUP,"")}),this.request({protocolName:Ui,requestData:{fromAccount:this.getMyUserID(),operationType:!0===i?1:2,itemList:[s]}}).then((function(){return a.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(o," ok")),r.isPinned!==i&&(r.isPinned=i,t._sortConversationListAndEmitEvent()),zo({conversationID:n})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(o," failed. error:"),e),Xo(e)}))}},{key:"setMessageRemindType",value:function(e){return this._messageRemindHandler.set(e)}},{key:"patchMessageRemindType",value:function(e){var t=e.ID,n=e.isC2CConversation,i=e.messageRemindType,r=!1,o=this.getLocalConversation(n?"".concat(b.CONV_C2C).concat(t):"".concat(b.CONV_GROUP).concat(t));return o&&o.messageRemindType!==i&&(o.messageRemindType=i,r=!0),Be.d("".concat(this._n,".patchMessageRemindType options:"),e,"ret:".concat(r)),r}},{key:"onC2CMessageRemindTypeSynced",value:function(e){var t=this,n="".concat(this._n,".onC2CMessageRemindTypeSynced");Be.d(n,e),e.dataList.forEach((function(e){if(!$t(e.muteNotificationsSync)){var i,r=e.muteNotificationsSync,o=r.to,a=r.updateSequence,s=r.muteFlag;t._messageRemindHandler.setUpdateSequence(a),0===s?i=b.MSG_REMIND_ACPT_AND_NOTE:1===s?i=b.MSG_REMIND_DISCARD:2===s&&(i=b.MSG_REMIND_ACPT_NOT_NOTE);var c=0;t.patchMessageRemindType({ID:o,isC2CConversation:!0,messageRemindType:i})&&(c+=1),Be.l("".concat(n," updateCount:").concat(c)),c>=1&&t.emitConversationUpdate(!0,!1)}}))}},{key:"onGroupMessageRemindTypeSynced",value:function(e){Be.d("".concat(this._n,".onGroupMessageRemindTypeSynced options:"),e),this._messageRemindHandler.onGroupMessageRemindTypeUpdated(e)}},{key:"deleteLocalConversation",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this._conversationMap.has(e);if(Be.d("".concat(this._n,".deleteLocalConversation conversationID:").concat(e," has:").concat(n)),n&&(this._conversationMap.delete(e),this._roamingMessageKeyAndTimeMap.has(e)&&this._roamingMessageKeyAndTimeMap.delete(e),this._roamingMessageSequenceMap.has(e)&&this._roamingMessageSequenceMap.delete(e),this._setStorageConversationList(),this._messageListHandler.removeByConversationID(e),this._completedMap.delete(e),t)){var i=!this._isTopicConversation(e);this.emitConversationUpdate(i,!1)}}},{key:"deleteLocalConversationList",value:function(e){var t=this,n=0,i=!1;e.forEach((function(e){t._conversationMap.has(e)&&(n+=t._conversationMap.get(e).unreadCount||0,t.deleteLocalConversation(e,!1),i=!0)})),Be.l("".concat(this._n,".deleteLocalConversationList conversationIDList.length:").concat(e.length," isConvIDExisted:").concat(i)),i&&(this.emitConversationUpdate(!0,!1),n>0&&this.emitTotalUnreadMessageCountUpdate())}},{key:"isMessageSentByCurrentInstance",value:function(e){return!(!this._messageListHandler.hasLocalMessage(e.conversationID,e.ID)&&!this.singlyLinkedList.has(e.random))}},{key:"modifyMessageList",value:function(e){if(e.startsWith(b.CONV_C2C)&&this._conversationMap.has(e)){var t=this._conversationMap.get(e),n=Date.now();this._messageListHandler.modifyMessageSentByPeer({conversationID:e,latestNick:t.userProfile.nick,latestAvatar:t.userProfile.avatar});var i=this.getModule(Nn).getNickAndAvatarByUserID(this.getMyUserID());this._messageListHandler.modifyMessageSentByMe({conversationID:e,latestNick:i.nick,latestAvatar:i.avatar}),Be.l("".concat(this._n,".modifyMessageList conversationID:").concat(e," cost ").concat(Date.now()-n," ms"))}}},{key:"updateUserProfileSpecifiedKey",value:function(e){Be.l("".concat(this._n,".updateUserProfileSpecifiedKey options:"),e);var t=e.conversationID,n=e.nick,i=e.avatar;if(this._conversationMap.has(t)){var r=this._conversationMap.get(t).userProfile;it(n)&&r.nick!==n&&(r.nick=n),it(i)&&r.avatar!==i&&(r.avatar=i),this.emitConversationUpdate(!0,!1)}}},{key:"_onMyProfileModified",value:function(e){var n=this,i=this.getLocalConversationList(),r=Date.now();i.forEach((function(i){n.modifyMessageSentByMe(t({conversationID:i.conversationID},e))})),Be.l("".concat(this._n,"._onMyProfileModified. modify all messages sent by me, cost ").concat(Date.now()-r," ms"))}},{key:"modifyMessageSentByMe",value:function(e){this._messageListHandler.modifyMessageSentByMe(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._messageListHandler.getLatestMessageSentByMe(e)}},{key:"modifyMessageSentByPeer",value:function(e){this._messageListHandler.modifyMessageSentByPeer(e)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._messageListHandler.getLatestMessageSentByPeer(e)}},{key:"pushIntoNoticeResult",value:function(e,t){return!(!this._messageListHandler.pushIn(t)||this.singlyLinkedList.has(t.random)||(e.push(t),0))}},{key:"getLocalLastMessage",value:function(e){return this._messageListHandler.getLocalLastMessage(e)}},{key:"checkAndPatchRemark",value:function(){var e=Promise.resolve();if(0===this._conversationMap.size)return e;var t=this.getModule(xn);if(!t)return e;var n=_(this._conversationMap.values()).filter((function(e){return e.type===b.CONV_C2C}));if(0===n.length)return e;var i=0;return n.forEach((function(e){var n=e.conversationID.replace(b.CONV_C2C,"");if(t.isMyFriend(n)){var r=t.getFriendRemark(n);e.remark!==r&&(e.remark=r,i+=1)}})),Be.l("".concat(this._n,".checkAndPatchRemark. c2c conversation count:").concat(n.length,", patched count:").concat(i)),e}},{key:"updateTopicConversation",value:function(e){this._updateLocalConversationList({conversationOptionsList:e,isFromGetConversations:!0})}},{key:"sendReadReceipt",value:function(e){var t=e[0],n=null;return t.conversationType===b.CONV_C2C?n=this._m.getModule(Pn):t.conversationType===b.CONV_GROUP&&(n=this._m.getModule(Un)),n?n.sendReadReceipt(e):Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"getReadReceiptList",value:function(e){var t=e[0],n=null;return t.conversationType===b.CONV_C2C?n=this._m.getModule(Pn):t.conversationType===b.CONV_GROUP&&(n=this._m.getModule(Un)),n?n.getReadReceiptList(e):Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"getLastMessageTime",value:function(e){var t=this.getLocalConversation(e);return t?t.lastMessage.lastTime:0}},{key:"getTotalUnreadMessageCount",value:function(){var e=this.getLocalConversationList(),t=0;return e.forEach((function(e){e.type!==b.CONV_SYSTEM&&(""!==e.messageRemindType&&e.messageRemindType!==b.MSG_REMIND_ACPT_AND_NOTE||(t+=e.unreadCount))})),t}},{key:"emitTotalUnreadMessageCountUpdate",value:function(){var e=this.getTotalUnreadMessageCount();this._convTotalUnreadCount!==e&&(Be.l("".concat(this._n,".emitTotalUnreadMessageCountUpdate from ").concat(this._convTotalUnreadCount," to ").concat(e)),this._convTotalUnreadCount=e,this.emitOuterEvent(k.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED))}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._pagingStatus=en.NOT_START,this._messageListHandler.reset(),this._messageRemindHandler.reset(),this._roamingMessageKeyAndTimeMap.clear(),this._roamingMessageSequenceMap.clear(),this.singlyLinkedList.reset(),this._peerReadTimeMap.clear(),this._completedMap.clear(),this._conversationMap.clear(),this._pagingTimeStamp=0,this._pagingStartIndex=0,this._pagingPinnedTimeStamp=0,this._pagingPinnedStartIndex=0,this._remoteGroupReadSequenceMap.clear(),this._convTotalUnreadCount=0,this.resetReady()}}]),r}(ci),Ia=function(){function e(t){i(this,e),this._groupModule=t,this._n="GroupTipsHandler",this._cachedGroupTipsMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this._getTopicPendingMap=new Map}return o(e,[{key:"onCheckTimer",value:function(e){e%1==0&&this._cachedGroupTipsMap.size>0&&this._checkCachedGroupTips()}},{key:"_checkCachedGroupTips",value:function(){var e=this;this._cachedGroupTipsMap.forEach((function(t,n){var i=e._checkCountMap.get(n),r=e._groupModule.hasLocalGroup(n);Be.l("".concat(e._n,"._checkCachedGroupTips groupID:").concat(n," hasLocalGroup:").concat(r," checkCount:").concat(i)),r?(e._notifyCachedGroupTips(n),e._checkCountMap.delete(n),e._groupModule.deleteUnjoinedAVChatRoom(n)):i>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupTips(n),e._checkCountMap.delete(n)):(i++,e._checkCountMap.set(n,i))}))}},{key:"onNewGroupTips",value:function(e){Be.d("".concat(this._n,".onReceiveGroupTips count:").concat(e.dataList.length));var t=this.newGroupTipsStoredAndSummary(e),n=t.eventDataList,i=t.result,r=t.AVChatRoomMessageList;r.length>0&&this._groupModule.onAVChatRoomMessage(r),n.length>0&&(this._groupModule.updateNextMessageSeq(n),this._groupModule.getModule(Vn).onNewMessage({conversationOptionsList:n,isInstantMessage:!0})),i.length>0&&(this._groupModule.emitOuterEvent(k.MESSAGE_RECEIVED,i),this.handleMessageList(i))}},{key:"newGroupTipsStoredAndSummary",value:function(e){for(var n=this,i=e.event,r=e.dataList,o=null,a=[],s=[],c={},u=[],l=function(e,l){var d=Tt(r[e]);if(6===i){if(n._groupModule.isGroupAttributesUpdatedNotice(d))return"continue";if(n._groupModule.isGroupCountersNotice(d))return"continue"}var p=d.groupProfile,h=p.groupID,f=p.communityType,g=void 0===f?0:f,m=p.topicID,v=void 0===m?void 0:m,_=p.invisible,y=void 0,I=n._groupModule.isMessageFromTopic(g,v);if(I){y=b.CONV_TOPIC,d.to=v;var M=n._groupModule.getModule(Fn);M.hasLocalTopic(h,v)||n._getTopicPendingMap.has(v)||(n._getTopicPendingMap.set(v,1),M.getTopicList({groupID:h,topicIDList:[v]}).finally((function(){n._getTopicPendingMap.delete(v)})))}var T=n._groupModule.hasLocalGroup(h);if(!T&&n._groupModule.isUnjoinedAVChatRoom(h))return"continue";if(!T&&!I)return n._cacheGroupTipsAndProbe({groupID:h,event:i,item:d}),"continue";if(n._groupModule.isMessageFromOrToAVChatroom(h))return d.event=i,u.push(d),"continue";if(d.currentUser=n._groupModule.getMyUserID(),d.conversationType=b.CONV_GROUP,(o=new Ko(d)).setElement({type:b.MSG_GRP_TIP,content:t(t({},d.elements),{},{groupProfile:d.groupProfile})}),o.isSystemMessage=!1,1===_)return n._qualityStat(o),"continue";var C=n._groupModule.getModule(Vn),S=o,E=S.conversationID,k=S.sequence;if(6===i)o._onlineOnlyFlag=!0,s.push(o);else if(!C.pushIntoNoticeResult(s,o))return"continue";if(n._groupModule.isMessageFromCommunityOfTopic(g,v))return"continue";if(6===i&&C.getLocalConversation(E))return"continue";6!==i&&n._qualityStat(o);var D=C.isRemoteRead({conversationID:E,sequence:k});if(st(c[E])){var w=0;"in"===o.flow&&(o._isExcludedFromUnreadCount||o._onlineOnlyFlag||D||(w=1)),c[E]=a.push({conversationID:E,unreadCount:w,type:st(y)?o.conversationType:y,subType:o.conversationSubType,lastMessage:o._isExcludedFromLastMessage?"":o})-1}else{var A=c[E];a[A].type=o.conversationType,a[A].subType=o.conversationSubType,a[A].lastMessage=o._isExcludedFromLastMessage?"":o,"in"===o.flow&&(o._isExcludedFromUnreadCount||o._onlineOnlyFlag||D||a[A].unreadCount++)}},d=0,p=r.length;d<p;d++)l(d);return{eventDataList:a,result:s,AVChatRoomMessageList:u}}},{key:"_qualityStat",value:function(e){this._groupModule.getModule(ti).addMessageSequence({key:To,message:e})}},{key:"handleMessageList",value:function(e){var t=this;e.forEach((function(e){switch(e.payload.operationType){case 1:t._onNewMemberComeIn(e);break;case 2:t._onMemberQuit(e);break;case 3:t._onMemberKickedOut(e);break;case 4:t._onMemberSetAdmin(e);break;case 5:t._onMemberCancelledAdmin(e);break;case 6:t._onGroupProfileModified(e);break;case 7:t._onMemberInfoModified(e);break;case 8:t._onTopicProfileUpdated(e);break;default:Be.w("".concat(t._n,".handleMessageList unknown operationType:").concat(e.payload.operationType))}}))}},{key:"_onNewMemberComeIn",value:function(e){var t=e.payload,n=t.memberNum,i=t.groupProfile.groupID,r=this._groupModule.getLocalGroupProfile(i);r&&nt(n)&&r.memberCount!==n&&(r.memberCount=n,this._updateConversationGroupProfile(r))}},{key:"_onMemberQuit",value:function(e){var t=e.payload,n=t.memberNum,i=t.groupProfile.groupID,r=this._groupModule.getLocalGroupProfile(i);r&&nt(n)&&r.memberCount!==n&&(r.memberCount=n,this._updateConversationGroupProfile(r)),this._groupModule.getModule(Gn).deleteLocalGroupMembers(i,e.payload.userIDList)}},{key:"_onMemberKickedOut",value:function(e){var t=e.payload,n=t.memberNum,i=t.groupProfile.groupID,r=this._groupModule.getLocalGroupProfile(i);r&&nt(n)&&r.memberCount!==n&&(r.memberCount=n,this._updateConversationGroupProfile(r)),this._groupModule.getModule(Gn).deleteLocalGroupMembers(i,e.payload.userIDList)}},{key:"_updateConversationGroupProfile",value:function(e){this._groupModule.getModule(Vn).updateConversationGroupProfile([e])}},{key:"_onMemberSetAdmin",value:function(e){var t=e.payload.groupProfile.groupID,n=e.payload.userIDList,i=this._groupModule.getModule(Gn);n.forEach((function(e){var n=i.getLocalGroupMemberInfo(t,e);n&&n.updateRole(b.GRP_MBR_ROLE_ADMIN)}))}},{key:"_onMemberCancelledAdmin",value:function(e){var t=e.payload.groupProfile.groupID,n=e.payload.userIDList,i=this._groupModule.getModule(Gn);n.forEach((function(e){var n=i.getLocalGroupMemberInfo(t,e);n&&n.updateRole(b.GRP_MBR_ROLE_MEMBER)}))}},{key:"_onGroupProfileModified",value:function(e){var t=this,n=e.payload,i=n.newGroupProfile,r=n.groupProfile.groupID,o=this._groupModule.getLocalGroupProfile(r);Object.keys(i).forEach((function(e){switch(e){case"ownerID":t._ownerChanged(o,i);break;case"groupName":o.name=i[e];break;default:o[e]=i[e]}}));var a=!o.isSupportTopic;this._groupModule.emitGroupListUpdate(!0,a)}},{key:"_ownerChanged",value:function(e,t){var n=e.groupID,i=this._groupModule.getLocalGroupProfile(n),r=this._groupModule.getMyUserID();if(r===t.ownerID){i.updateGroup({selfInfo:{role:b.GRP_MBR_ROLE_OWNER}});var o=this._groupModule.getModule(Gn),a=o.getLocalGroupMemberInfo(n,r),s=this._groupModule.getLocalGroupProfile(n).ownerID,c=o.getLocalGroupMemberInfo(n,s);a&&a.updateRole(b.GRP_MBR_ROLE_OWNER),c&&c.updateRole(b.GRP_MBR_ROLE_MEMBER)}}},{key:"_onMemberInfoModified",value:function(e){var t=e.to,n=e.payload,i=n.groupProfile,r=n.memberList,o=i.groupID;kt(t)&&this._updateTopicMuteTime(e);var a=this._groupModule.getModule(Gn);r.forEach((function(e){var t=a.getLocalGroupMemberInfo(o,e.userID);t&&nt(e.muteTime)&&t.updateMuteUntil(e.muteTime)}))}},{key:"_updateTopicMuteTime",value:function(e){var t=e.to,n=e.payload,i=n.groupProfile,r=n.memberList,o=void 0===r?[]:r,a=this._groupModule.getModule(Fn),s=i.groupID,c=a.getLocalTopic(s,t);if(c){for(var u=!1,l=0;l<o.length;l++){var d=o[l];if(d.userID===this._groupModule.getMyUserID()&&d.muteTime>=0){c.updateSelfInfo({muteTime:d.muteTime}),u=!0;break}}u&&this._groupModule.emitOuterEvent(k.TOPIC_UPDATED,{groupID:s,topic:c})}}},{key:"_onTopicProfileUpdated",value:function(e){var n=e.payload,i=n.groupProfile.groupID,r=n.newTopicInfo;this._groupModule.getModule(Fn).onTopicProfileUpdated(t({groupID:i,topicID:e.to},r))}},{key:"_cacheGroupTips",value:function(e,t){this._cachedGroupTipsMap.has(e)||this._cachedGroupTipsMap.set(e,[]),this._cachedGroupTipsMap.get(e).push(t)}},{key:"_deleteCachedGroupTips",value:function(e){this._cachedGroupTipsMap.has(e)&&this._cachedGroupTipsMap.delete(e)}},{key:"_notifyCachedGroupTips",value:function(e){var t=this,n=this._cachedGroupTipsMap.get(e)||[];n.forEach((function(e){t.onNewGroupTips(e)})),this._deleteCachedGroupTips(e),Be.l("".concat(this._n,"._notifyCachedGroupTips groupID:").concat(e," count:").concat(n.length))}},{key:"_cacheGroupTipsAndProbe",value:function(e){var t=this,n=e.groupID,i=e.event,r=e.item;this._cacheGroupTips(n,{event:i,dataList:[r]}),this._groupModule.getGroupSimplifiedInfo(n).then((function(e){e.type===b.GRP_AVCHATROOM?t._groupModule.hasLocalGroup(n)?t._notifyCachedGroupTips(n):t._groupModule.setUnjoinedAVChatRoom(n):(t._groupModule.updateGroupMap([e]),t._notifyCachedGroupTips(n))})),this._checkCountMap.has(n)||this._checkCountMap.set(n,0),Be.l("".concat(this._n,"._cacheGroupTipsAndProbe groupID:").concat(n))}},{key:"reset",value:function(){this._cachedGroupTipsMap.clear(),this._checkCountMap.clear(),this._getTopicPendingMap.clear()}}]),e}(),Ma=function(){function e(t){i(this,e),this._groupModule=t,this._n="CommonGroupHandler",this.tempConversationList=null,this._cachedGroupMessageMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this._getTopicPendingMap=new Map,this._isPagingGetCompleted=!1,t.getInnerEmitterInstance().once(ea,this._initGroupList,this)}return o(e,[{key:"onCheckTimer",value:function(e){e%1==0&&this._cachedGroupMessageMap.size>0&&this._checkCachedGroupMessage()}},{key:"_checkCachedGroupMessage",value:function(){var e=this;this._cachedGroupMessageMap.forEach((function(t,n){var i=e._checkCountMap.get(n),r=e._groupModule.hasLocalGroup(n);Be.l("".concat(e._n,"._checkCachedGroupMessage groupID:").concat(n," hasLocalGroup:").concat(r," checkCount:").concat(i)),r?(e._notifyCachedGroupMessage(n),e._checkCountMap.delete(n),e._groupModule.deleteUnjoinedAVChatRoom(n)):i>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupMessage(n),e._checkCountMap.delete(n)):(i++,e._checkCountMap.set(n,i))}))}},{key:"_initGroupList",value:function(){var e=this;Be.l("".concat(this._n,"._initGroupList"));var t=new wo("getGroupListInStorage"),n=this._groupModule.getStorageGroupList();if(at(n)&&n.length>0){n.forEach((function(t){e._groupModule.initGroupMap(t)})),this._groupModule.emitGroupListUpdate(!0,!1);var i=this._groupModule.getLocalGroupList().length;t.setNetworkType(this._groupModule.getNetworkType()).setMessage("group count:".concat(i)).end()}else t.setNetworkType(this._groupModule.getNetworkType()).setMessage("group count:0").end();Be.l("".concat(this._n,"._initGroupList ok"))}},{key:"handleUpdateGroupLastMessage",value:function(e){var n="".concat(this._n,".handleUpdateGroupLastMessage");if(Be.l("".concat(n," conversation count:").concat(e.length,", local group count:").concat(this._groupModule.getLocalGroupList().length)),0!==this._groupModule.getGroupMap().size){for(var i,r,o,a=!1,s=0,c=e.length;s<c;s++)(i=e[s]).type===b.CONV_GROUP&&(r=i.conversationID.split(/^GROUP/)[1],(o=this._groupModule.getLocalGroupProfile(r))&&(o.lastMessage=t({},i.lastMessage),a=!0));a&&(this._groupModule.sortLocalGroupList(),this._groupModule.emitGroupListUpdate(!0,!1))}else this.tempConversationList=e}},{key:"onNewGroupMessage",value:function(e){Be.d("".concat(this._n,".onNewGroupMessage count:").concat(e.dataList.length));var t=this._newGroupMessageStoredAndSummary(e),n=t.conversationOptionsList,i=t.messageList,r=t.AVChatRoomMessageList;r.length>0&&this._groupModule.onAVChatRoomMessage(r),this._groupModule.filterModifiedMessage(i),n.length>0&&(this._groupModule.updateNextMessageSeq(n),this._groupModule.getModule(Vn).onNewMessage({conversationOptionsList:n,isInstantMessage:e.isInstantMessage||!0,updateUnreadCount:e.updateUnreadCount||!0}));var o=this._groupModule.filterUnmodifiedMessage(i);o.length>0&&this._groupModule.emitOuterEvent(k.MESSAGE_RECEIVED,o),i.length=0}},{key:"_newGroupMessageStoredAndSummary",value:function(e){var t=this,n=e.dataList,i=e.event,r=e.isInstantMessage,o=null,a=[],s=[],c=[],u={},l=this._groupModule.getModule(Kn),d=this._groupModule.getFileDownloadProxy(),p=n.length;p>1&&n.sort((function(e,t){return e.sequence-t.sequence}));for(var h=function(e){var p=Tt(n[e]),h=p.groupProfile,f=h.groupID,g=h.communityType,m=void 0===g?0:g,v=h.topicID,_=void 0===v?void 0:v,y=h.invisible,I=void 0,M=t._groupModule.isMessageFromTopic(m,_);if(M){I=b.CONV_TOPIC,p.to=_;var T=t._groupModule.getModule(Fn);T.hasLocalTopic(f,_)||t._getTopicPendingMap.has(_)||(t._getTopicPendingMap.set(_,1),T.getTopicList({groupID:f,topicIDList:[_]}).finally((function(){t._getTopicPendingMap.delete(_)})))}var C=t._groupModule.hasLocalGroup(f);if(!C&&t._groupModule.isUnjoinedAVChatRoom(f))return"continue";if(!C&&!M)return t._cacheGroupMessageAndProbe({groupID:f,event:i,item:p}),"continue";if(t._groupModule.isMessageFromOrToAVChatroom(f))return p.event=i,c.push(p),"continue";if(p.currentUser=t._groupModule.getMyUserID(),p.conversationType=b.CONV_GROUP,p.isSystemMessage=!!p.isSystemMessage,o=new Ko(p),p.elements=l.parseElements(p.elements,p.from),o.setElement(p.elements,d),1===y)return t._qualityStat(r,o),"continue";var S=1===n[e].isModified,E=t._groupModule.getModule(Vn);if(E.isMessageSentByCurrentInstance(o)?o.isModified=S:S=!1,1===p.onlineOnlyFlag)o._onlineOnlyFlag=!0,E.isMessageSentByCurrentInstance(o)||s.push(o);else{if(t._groupModule.isMessageFromCommunityOfTopic(m,_))return s.push(o),"continue";if(!E.pushIntoMessageList(s,o,S))return"continue";t._qualityStat(r,o);var k=o,D=k.conversationID,w=k.sequence,A=E.isRemoteRead({conversationID:D,sequence:w});if(st(u[D])){var R=0;"in"===o.flow&&(o._isExcludedFromUnreadCount||A||(R=1)),u[D]=a.push({conversationID:D,unreadCount:R,type:st(I)?o.conversationType:I,subType:o.conversationSubType,lastMessage:o._isExcludedFromLastMessage?"":o})-1}else{var L=u[D];a[L].type=st(I)?o.conversationType:I,a[L].subType=o.conversationSubType,a[L].lastMessage=o._isExcludedFromLastMessage?"":o,"in"===o.flow&&(o._isExcludedFromUnreadCount||A||a[L].unreadCount++)}}},f=0;f<p;f++)h(f);return{conversationOptionsList:a,messageList:s,AVChatRoomMessageList:c}}},{key:"_qualityStat",value:function(e,t){var n=this._groupModule.getModule(ti);n.addMessageSequence({key:To,message:t}),e&&t.clientTime>0&&n.addMessageDelay(t.clientTime)}},{key:"onGroupMessageRevoked",value:function(e){var t=this._groupModule.getModule(Vn),n=[],i=null,r=!0;e.dataList.forEach((function(e){var o=e.elements.revokedInfos;st(o)||o.forEach((function(e){var o=$t(e.topicID)?"GROUP".concat(e.groupID):"GROUP".concat(e.topicID);i=t.revoke(o,e.sequence,e.random);var a=e.revokerInfo&&e.revokerInfo.revoker;if(i)i.revoker=a,n.push(i);else{var s={conversationID:o,to:e.topicID||"",sequence:e.sequence,time:e.time,revoker:a};t.isLastMessageRevoked(s)&&(n.push(s),r=!1)}}))})),0!==n.length&&(t.onMessageRevoked(n),!0===r&&(Be.l("".concat(this._n,".onGroupMessageRevoked count:").concat(n.length)),this._groupModule.emitOuterEvent(k.MESSAGE_REVOKED,n)))}},{key:"_groupListTreeShaking",value:function(e){for(var t=new Map(_(this._groupModule.getGroupMap())),n=0,i=e.length;n<i;n++)t.delete(e[n].groupID);this._groupModule.hasJoinedAVChatRoom()&&this._groupModule.getJoinedAVChatRoom().forEach((function(e){t.delete(e)})),this._groupModule.getGroupMap().forEach((function(e,n){e.isSupportTopic&&t.delete(n)}));for(var r=_(t.keys()),o=0,a=r.length;o<a;o++)this._groupModule.deleteGroup(r[o])}},{key:"getGroupList",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupList"),i=new wo("getGroupList");Be.l("".concat(n));var r={introduction:"Introduction",notification:"Notification",createTime:"CreateTime",ownerID:"Owner_Account",lastInfoTime:"LastInfoTime",memberNum:"MemberNum",maxMemberNum:"MaxMemberNum",joinOption:"ApplyJoinOption",inviteOption:"InviteJoinOption",muteAllMembers:"ShutUpAllMember"},o=["Type","Name","FaceUrl","NextMsgSeq","LastMsgTime","AtInfoList","LastRecallTime"],a=[];e&&e.groupProfileFilter&&e.groupProfileFilter.forEach((function(e){r[e]&&o.push(r[e])}));var s=(e||{}).isGroupWithTopicOnly,c=void 0!==s&&s;return this._pagingGetGroupList({limit:50,offset:0,groupBaseInfoFilter:o,groupList:a,isGroupWithTopicOnly:c}).then((function(){Be.l("".concat(n," ok. count:").concat(a.length," isGroupWithTopicOnly:").concat(c)),c||t._groupListTreeShaking(a),t._groupModule.updateGroupMap(a);var e=t._groupModule.getLocalGroupList().length;i.setNetworkType(t._groupModule.getNetworkType()).setMessage("remote count:".concat(a.length,", after tree shaking, local count:").concat(e,", isGroupWithTopicOnly:").concat(c)).end(),t.tempConversationList&&(t.handleUpdateGroupLastMessage(t.tempConversationList),t.tempConversationList=null),t._groupModule.patchGroupMessageRemindType(),t._groupModule.recomputeUnreadCount(),t._groupModule.emitGroupListUpdate(!0,!c);var r=t._groupModule.getLocalGroupList();if(c){var o=r.filter((function(e){return!0===e.isSupportTopic}));return zo({groupList:o})}return t._isPagingGetCompleted=!0,zo({groupList:r})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"isPagingGetCompleted",value:function(){return this._isPagingGetCompleted}},{key:"_pagingGetGroupList",value:function(e){var t=this,n="".concat(this._n,".").concat("_pagingGetGroupList"),i=e.isCommunityRelay,r=void 0!==i&&i,o=e.isGroupWithTopicOnly,a=void 0!==o&&o,s=e.limit,c=e.offset,u=e.groupBaseInfoFilter,l=e.groupList;if(a)return this._pagingGetGroupListWithTopic({limit:s,offset:c,groupBaseInfoFilter:u,groupList:l});var d=new wo("_pagingGetGroupList");return this._groupModule.request({protocolName:zi,requestData:{type:r?b.GRP_COMMUNITY:void 0,memberAccount:this._groupModule.getMyUserID(),limit:s,offset:c,responseFilter:{groupBaseInfoFilter:u,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]}}}).then((function(e){var i=e.data,o=i.groups,a=void 0===o?[]:o,p=i.totalCount;l.push.apply(l,_(a)),t._handleGroupAtInfoWithoutTopic(r,a);var h=c+s,f=!(p>h),g="offset:".concat(c," totalCount:").concat(p," isCompleted:").concat(f," ")+"currentCount:".concat(l.length," isCommunityRelay:").concat(r);return d.setNetworkType(t._groupModule.getNetworkType()).setMessage("".concat(g)).end(),r||f?!r&&f?(Be.l("".concat(n," start to get community list")),c=0,t._pagingGetGroupList({limit:s,offset:c,groupBaseInfoFilter:u,groupList:l,isCommunityRelay:!0})):r&&!f?(c=h,t._pagingGetGroupList({limit:s,offset:c,groupBaseInfoFilter:u,groupList:l,isCommunityRelay:!0})):(Be.l("".concat(n," ok. totalCount:").concat(l.length)),zo({groupList:l})):(c=h,t._pagingGetGroupList({limit:s,offset:c,groupBaseInfoFilter:u,groupList:l}))})).catch((function(e){return 11e3!==e.code&&t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];d.setMessage("isCommunityRelay:".concat(r)).setError(e,i,o).end()})),r?(11e3===e.code&&(d=null,Be.l("".concat(n," ok. community unavailable"))),Jo({groupList:l})):Xo(e)}))}},{key:"_pagingGetGroupListWithTopic",value:function(e){var t=this,n="".concat(this._n,"._pagingGetGroupListWithTopic"),i=e.limit,r=e.offset,o=e.groupBaseInfoFilter,a=e.groupList,s=new wo("pagingGetGroupListWithTopic");return this._groupModule.request({protocolName:zi,requestData:{type:b.GRP_COMMUNITY,memberAccount:this._groupModule.getMyUserID(),limit:i,offset:r,responseFilter:{groupBaseInfoFilter:o,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]},isSupportTopic:1}}).then((function(e){var c=e.data,u=c.groups,l=void 0===u?[]:u,d=c.totalCount;a.push.apply(a,_(l));var p=r+i,h=!(d>p),f="offset:".concat(r," totalCount:").concat(d," isCompleted:").concat(h," ")+"currentCount:".concat(a.length);return s.setNetworkType(t._groupModule.getNetworkType()).setMessage("".concat(f)).end(),h?(Be.l("".concat(n," ok. totalCount:").concat(a.length)),zo({groupList:a})):(r=p,t._pagingGetGroupListWithTopic({limit:i,offset:r,groupBaseInfoFilter:o,groupList:a}))})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];s.setError(e,i,r).end()})),Xo(e)}))}},{key:"_cacheGroupMessage",value:function(e,t){this._cachedGroupMessageMap.has(e)||this._cachedGroupMessageMap.set(e,[]),this._cachedGroupMessageMap.get(e).push(t)}},{key:"_deleteCachedGroupMessage",value:function(e){this._cachedGroupMessageMap.has(e)&&this._cachedGroupMessageMap.delete(e)}},{key:"_notifyCachedGroupMessage",value:function(e){var t=this,n=this._cachedGroupMessageMap.get(e)||[];n.forEach((function(e){t.onNewGroupMessage(e)})),this._deleteCachedGroupMessage(e),Be.l("".concat(this._n,"._notifyCachedGroupMessage groupID:").concat(e," count:").concat(n.length))}},{key:"_cacheGroupMessageAndProbe",value:function(e){var t=this,n=e.groupID,i=e.event,r=e.item;this._cacheGroupMessage(n,{event:i,dataList:[r]}),this._groupModule.getGroupSimplifiedInfo(n).then((function(e){e.type===b.GRP_AVCHATROOM?t._groupModule.hasLocalGroup(n)?t._notifyCachedGroupMessage(n):t._groupModule.setUnjoinedAVChatRoom(n):(t._groupModule.updateGroupMap([e]),t._notifyCachedGroupMessage(n))})),this._checkCountMap.has(n)||this._checkCountMap.set(n,0),Be.l("".concat(this._n,"._cacheGroupMessageAndProbe groupID:").concat(n))}},{key:"_handleGroupAtInfoWithoutTopic",value:function(e,n){var i=this;e&&0!==n.length&&n.forEach((function(e){var n=e.groupID,r=e.groupAtInfoList,o=[];st(r)||(r.forEach((function(e){o.push(t(t({},e),{},{groupID:n}))})),i._groupModule.getModule(Vn).onNewGroupAtTips({dataList:o}))}))}},{key:"reset",value:function(){this._cachedGroupMessageMap.clear(),this._checkCountMap.clear(),this._getTopicPendingMap.clear(),this._isPagingGetCompleted=!1,this._groupModule.getInnerEmitterInstance().once(ea,this._initGroupList,this)}}]),e}(),Ta=1,Ca=2,Sa=3,Ea=4,ka=5,ba=function(){function e(t){i(this,e),this._groupModule=t,this._n="GroupAttributesHandler",this._groupAttributesMap=new Map,this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4,this._groupModule.getInnerEmitterInstance().on(ta,this._onCloudConfigUpdated,this)}return o(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this._groupModule.getCloudConfig("grp_attr_cache_time");st(e)||(this.CACHE_EXPIRE_TIME=Number(e))}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesMap.forEach((function(e){e.localMainSequence=0}))}},{key:"isGroupAttributesUpdatedNotice",value:function(e){var t=e.to,n=e.elements.newGroupProfile,i=!st(n)&&!$t(n.groupAttributeOption);return i&&this._onGroupAttributesUpdated({groupID:t,groupAttributeOption:n.groupAttributeOption}),i}},{key:"_onGroupAttributesUpdated",value:function(e){var t=this,n=e.groupID,i=e.groupAttributeOption,r=i.mainSequence,o=i.isWithChangedAttributeInfo,a=i.groupAttributeList,s=void 0===a?[]:a,c=i.operationType;if(Be.l("".concat(this._n,".onGroupAttributesUpdated. ")+"groupID:".concat(n," isWithChangedAttributeInfo:").concat(o," operationType:").concat(c)),!st(c)){this._groupAttributesCopy=this._getCachedAttributes({groupID:n});var u=this._getLocalGroupAttributes(n).localMainSequence;if(1===o&&r-u==1)return this._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:r,groupAttributeList:s,operationType:c}),void this._emitGroupAttributesUpdated(n);if(this._hasLocalGroupAttributes(n)){var l=this._getLocalGroupAttributes(n).avChatRoomKey;this._getGroupAttributes({groupID:n,avChatRoomKey:l}).then((function(){t._emitGroupAttributesUpdated(n)}))}}}},{key:"initGroupAttributesCache",value:function(e){var t=e.groupID,n=e.avChatRoomKey,i=void 0===n?void 0:n;this._groupAttributesMap.set(t,{lastUpdateTime:0,localMainSequence:0,remoteMainSequence:0,attributes:new Map,avChatRoomKey:i}),Be.l("".concat(this._n,".initGroupAttributesCache groupID:").concat(t," avChatRoomKey:").concat(i))}},{key:"initGroupAttributes",value:function(e){var t=this,n=e.groupID,i=e.groupAttributes,r=this._getLocalGroupAttributes(n),o=r.remoteMainSequence,a=r.avChatRoomKey,s=new wo("initGroupAttributes");return s.setMessage("groupID:".concat(n," avChatRoomKey:").concat(a," mainSequence:").concat(o)),this._groupModule.request({protocolName:Ir,requestData:{groupID:n,avChatRoomKey:a,mainSequence:o,groupAttributeList:this._transformGroupAttributes(i)}}).then((function(e){var r=e.data,o=r.mainSequence,a=_(r.groupAttributeList);return a.forEach((function(e){e.value=i[e.key]})),t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:o,groupAttributeList:a,operationType:Ta}),s.setNetworkType(t._groupModule.getNetworkType()).end(),Be.l("".concat(t._n,".").concat("initGroupAttributes"," ok. groupID:").concat(n)),zo({groupAttributes:i})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];s.setError(e,i,r).end()})),Xo(e)}))}},{key:"setGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupAttributes"),i=e.groupID,r=e.groupAttributes,o=this._getLocalGroupAttributes(i),a=o.remoteMainSequence,s=o.avChatRoomKey,c=o.attributes,u=this._transformGroupAttributes(r);u.forEach((function(e){var t=e.key;e.sequence=0,c.has(t)&&(e.sequence=c.get(t).sequence)}));var l=new wo("setGroupAttributes");return l.setMessage("groupID:".concat(i," groupAttributes:").concat(JSON.stringify(r))),Be.l("".concat(n,". groupID:").concat(i," mainSequence:").concat(a)),this._groupModule.request({protocolName:Mr,requestData:{groupID:i,avChatRoomKey:s,mainSequence:a,groupAttributeList:u}}).then((function(e){var o=e.data,a=o.mainSequence,s=_(o.groupAttributeList);return s.forEach((function(e){e.value=r[e.key]})),t._refreshCachedGroupAttributes({groupID:i,remoteMainSequence:a,groupAttributeList:s,operationType:Ca}),l.setNetworkType(t._groupModule.getNetworkType()).end(),Be.l("".concat(n," ok.")),zo({groupAttributes:r})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];l.setError(e,i,r).end()})),Xo(e)}))}},{key:"deleteGroupAttributes",value:function(e){var t=this,n=e.groupID,i=e.keyList,r=void 0===i?[]:i,o=this._getLocalGroupAttributes(n),a=o.remoteMainSequence,s=o.avChatRoomKey,c=o.attributes,u=_(c.keys()),l=Cr,d=Sa,p={groupID:n,avChatRoomKey:s,mainSequence:a},h=[];r.length>0&&(u=[],l=Tr,d=Ea,r.forEach((function(e){var t=0;c.has(e)&&(t=c.get(e).sequence,u.push(e)),h.push({key:e,sequence:t})})),p.groupAttributeList=h);var f=new wo("deleteGroupAttributes");return f.setMessage("groupID:".concat(n," mainSequence:").concat(a," keyList:").concat(r," protocolName:").concat(l)),this._groupModule.request({protocolName:l,requestData:p}).then((function(e){var i=e.data.mainSequence;return t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:i,groupAttributeList:h,operationType:d}),f.setNetworkType(t._groupModule.getNetworkType()).end(),Be.l("".concat(t._n,".").concat("deleteGroupAttributes"," ok. groupID:").concat(n)),zo({keyList:u})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];f.setError(e,i,r).end()})),Xo(e)}))}},{key:"getGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupAttributes"),i=e.groupID,r=this._getLocalGroupAttributes(i),o=r.avChatRoomKey,a=r.lastUpdateTime,s=r.localMainSequence,c=r.remoteMainSequence,u=new wo("getGroupAttributes");if(u.setMessage("groupID:".concat(i," localMainSequence:").concat(s," remoteMainSequence:").concat(c," keyList:").concat(e.keyList)),Date.now()-a>=this.CACHE_EXPIRE_TIME||s<c)return this._getGroupAttributes({groupID:i,avChatRoomKey:o}).then((function(r){u.setMoreMessage("get attributes from remote. count:".concat(r.length)).setNetworkType(t._groupModule.getNetworkType()).end(),Be.l("".concat(n," from remote. groupID:").concat(i));var o=t._getCachedAttributes(e);return zo({groupAttributes:o})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];u.setError(e,i,r).end()})),Xo(e)}));u.setMoreMessage("get attributes from cache").setNetworkType(this._groupModule.getNetworkType()).end(),Be.l("".concat(n," from cache. groupID:").concat(i));var l=this._getCachedAttributes(e);return Jo({groupAttributes:l})}},{key:"_getGroupAttributes",value:function(e){var n=this,i=0;return st(e.avChatRoomKey)||(i=1),this._groupModule.request({protocolName:Sr,requestData:t(t({},e),{},{groupType:i})}).then((function(t){var i=t.data,r=i.mainSequence,o=i.groupAttributeList,a=_(o);return st(r)||n._refreshCachedGroupAttributes({groupID:e.groupID,remoteMainSequence:r,groupAttributeList:a,operationType:ka}),Be.l("".concat(n._n,"._getGroupAttributes ok. groupID:").concat(e.groupID)),o})).catch((function(e){return Xo(e)}))}},{key:"_refreshCachedGroupAttributes",value:function(e){var t=e.groupID,n=e.remoteMainSequence,i=e.groupAttributeList,r=e.operationType;if(this._hasLocalGroupAttributes(t)){var o=this._getLocalGroupAttributes(t),a=o.localMainSequence;if(r===ka||n-a==1)o.remoteMainSequence=n,o.localMainSequence=n,o.lastUpdateTime=Date.now(),this._updateCachedAttributes({groupAttributes:o,groupAttributeList:i,operationType:r});else{if(a===n)return;o.remoteMainSequence=n}this._groupAttributesMap.set(t,o);var s="operationType:".concat(r," localMainSequence:").concat(a," remoteMainSequence:").concat(n);Be.l("".concat(this._n,"._refreshCachedGroupAttributes. ").concat(s))}}},{key:"_getCachedAttributes",value:function(e){var t=e.groupID,n=e.keyList,i=void 0===n?[]:n,r={};if(this._hasLocalGroupAttributes(t)){var o=this._getLocalGroupAttributes(t).attributes;if(i.length>0)i.forEach((function(e){o.has(e)&&(r[e]=o.get(e).value)}));else{var a,s=E(o.keys());try{for(s.s();!(a=s.n()).done;){var c=a.value;r[c]=o.get(c).value}}catch(u){s.e(u)}finally{s.f()}}}return r}},{key:"_updateCachedAttributes",value:function(e){var t=e.groupAttributes,n=e.groupAttributeList,i=e.operationType;i!==Sa?i!==Ea?(i===Ta&&t.attributes.clear(),n.forEach((function(e){var n=e.key,i=e.value,r=e.sequence;t.attributes.set(n,{value:i,sequence:r})}))):n.forEach((function(e){t.attributes.delete(e.key)})):t.attributes.clear()}},{key:"_hasLocalGroupAttributes",value:function(e){return this._groupAttributesMap.has(e)}},{key:"_getLocalGroupAttributes",value:function(e){return this._hasLocalGroupAttributes(e)||this.initGroupAttributesCache({groupID:e}),this._groupAttributesMap.get(e)}},{key:"_transformGroupAttributes",value:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({key:n,value:e[n]})})),t}},{key:"_emitGroupAttributesUpdated",value:function(e){var t=this._getCachedAttributes({groupID:e}),n=this._computeAttrChangedInfo(t),i=n.updatedKeyList,r=n.deletedKeyList;this._groupModule.emitOuterEvent(k.GROUP_ATTRIBUTES_UPDATED,{groupID:e,groupAttributes:t,updatedKeyList:i,deletedKeyList:r})}},{key:"_computeAttrChangedInfo",value:function(e){var t=this,n=[],i=[];return Object.keys(e).forEach((function(i){e[i]!==t._groupAttributesCopy[i]&&n.push(i)})),Object.keys(this._groupAttributesCopy).forEach((function(t){st(e[t])&&i.push(t)})),this._groupAttributesCopy={},Be.l("".concat(this._n,"._computeAttrChangedInfo update count:").concat(n.length,", delete count:").concat(i.length)),{updatedKeyList:n,deletedKeyList:i}}},{key:"deleteLocalGroupAttributes",value:function(e){this._hasLocalGroupAttributes(e)&&this._groupAttributesMap.delete(e)}},{key:"reset",value:function(){this._groupAttributesMap.clear(),this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4}}]),e}(),Da="Set",wa="Increase",Aa="Decrease",Ra=function(){function e(t){i(this,e),this._groupModule=t,this._n="GroupCountersHandler",this._groupCountersMap=new Map,this.EXPIRE_TIME=3e4,this._groupModule.getInnerEmitterInstance().on(ta,this._onCloudConfigUpdated,this)}return o(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this._groupModule.getCloudConfig("grp_counter_expire_time");st(e)||(this.EXPIRE_TIME=Number(e))}},{key:"isGroupCountersNotice",value:function(e){var t=e.to,n=e.elements.groupCounterInfo,i=!1;return $t(n)||(this._onGroupCountersUpdated({groupID:t,groupCounterInfo:n}),i=!0),i}},{key:"_onGroupCountersUpdated",value:function(e){var t=this,n=e.groupID;e.groupCounterInfo.forEach((function(e){var i=e.type,r=e.groupCounterSeq,o=e.counterList,a=void 0===o?[]:o;0!==i&&2!==i||(t._updateLocalGroupCounters({groupID:n,groupCounterSeq:r,counterList:a}),a.forEach((function(e){t._groupModule.emitOuterEvent(k.GROUP_COUNTER_UPDATED,{groupID:n,key:e.key,value:e.value})}))),1===i&&t._deleteLocalGroupCounters({groupID:n,groupCounterSeq:r,counterList:a})})),Be.l("".concat(this._n,"._onGroupCountersUpdated groupID:").concat(n))}},{key:"initGroupCountersCache",value:function(e){var t=e.groupID,n=e.avChatRoomKey;this._groupCountersMap.set(t,{lastUpdateTime:0,groupCounterSeq:0,counters:new Map,avChatRoomKey:n}),Be.l("".concat(this._n,".initGroupCountersCache groupID:").concat(t," avChatRoomKey:").concat(n))}},{key:"setGroupCounters",value:function(e){var t=this;if(!this._groupModule.canIUse(H.GRP_COUNTER))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".setGroupCounters"),i=e.groupID,r=e.counters,o=this._convertObjectToList(r),a=this._getLocalGroupCounters(i).avChatRoomKey,s="groupID:".concat(i," count:").concat(o.length),c=new wo("setGroupCounters");return c.setMessage("".concat(s)),Be.l("".concat(n,". ").concat(s)),this._updateGroupCounters({groupID:i,counterList:o,avChatRoomKey:a,mode:Da}).then((function(e){return c.end(),Be.l("".concat(n," ok.")),zo({counters:e})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"increaseGroupCounter",value:function(e){var t=this;if(!this._groupModule.canIUse(H.GRP_COUNTER))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".increaseGroupCounters"),i=e.groupID,r=e.key,o=e.value,a=this._getLocalGroupCounters(i).avChatRoomKey,s="groupID:".concat(i," key:").concat(r," value:").concat(o),c=new wo("increaseGroupCounter");c.setMessage("".concat(s)),Be.l("".concat(n,". ").concat(s));var u=[{key:r,value:o}];return this._updateGroupCounters({groupID:i,counterList:u,avChatRoomKey:a,mode:wa}).then((function(e){return c.end(),Be.l("".concat(n," ok.")),zo({counters:e})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"decreaseGroupCounter",value:function(e){var t=this;if(!this._groupModule.canIUse(H.GRP_COUNTER))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".decreaseGroupCounter"),i=e.groupID,r=e.key,o=e.value,a=this._getLocalGroupCounters(i).avChatRoomKey,s="groupID:".concat(i," key:").concat(r," value:").concat(o),c=new wo("decreaseGroupCounter");c.setMessage("".concat(s)),Be.l("".concat(n,". ").concat(s));var u=[{key:r,value:o}];return this._updateGroupCounters({groupID:i,counterList:u,avChatRoomKey:a,mode:Aa}).then((function(e){return c.end(),Be.l("".concat(n," ok.")),zo({counters:e})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"getGroupCounters",value:function(e){var t=this;if(!this._groupModule.canIUse(H.GRP_COUNTER))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".getGroupCounters"),i=e.groupID,r=e.keyList,o=void 0===r?[]:r,a=this._getLocalGroupCounters(i),s=a.avChatRoomKey,c=a.lastUpdateTime,u=new wo("getGroupCounters");if(u.setMessage("groupID:".concat(i)),Date.now()-c>=this.EXPIRE_TIME)return this._getRemoteGroupCounters({groupID:i,avChatRoomKey:s}).then((function(e){u.setMoreMessage("from remote. count:".concat(e.length)).end(),Be.l("".concat(n," from remote. groupID:").concat(i));var r=t._getLocalCounters(i,o);return zo({counters:r})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];u.setError(e,i,r).end()})),Xo(e)}));u.setMoreMessage("from cache").end(),Be.l("".concat(n," from cache. groupID:").concat(i));var l=this._getLocalCounters(i,o);return Jo({counters:l})}},{key:"_getRemoteGroupCounters",value:function(e){var n=this;return this._groupModule.request({protocolName:wr,requestData:t({},e)}).then((function(t){var i=t.data,r=i.counterList,o=void 0===r?[]:r,a=i.groupCounterSeq;return n._updateLocalGroupCounters({groupID:e.groupID,counterList:o,groupCounterSeq:a}),Be.l("".concat(n._n,"._getRemoteGroupCounters ok. groupID:").concat(e.groupID)),o})).catch((function(e){return Xo(e)}))}},{key:"_convertObjectToList",value:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({key:n,value:e[n]})})),t}},{key:"_updateGroupCounters",value:function(e){var n="".concat(this._n,"._updateGroupCounters"),i=e.groupID,r=e.avChatRoomKey,o=e.mode;return Be.l("".concat(n,". groupID:").concat(i," avChatRoomKey:").concat(r," mode:").concat(o)),this._groupModule.request({protocolName:Dr,requestData:t({},e)}).then((function(e){Be.l("".concat(n," ok."));var t=e.data.counterList,i={};return(void 0===t?[]:t).forEach((function(e){var t=e.key,n=e.value;i[t]=n})),i})).catch((function(e){return Xo(e)}))}},{key:"_hasLocalGroupCounters",value:function(e){return this._groupCountersMap.has(e)}},{key:"_getLocalGroupCounters",value:function(e){return this._hasLocalGroupCounters(e)||this.initGroupCountersCache({groupID:e}),this._groupCountersMap.get(e)}},{key:"_updateLocalGroupCounters",value:function(e){var t=e.groupID,n=e.counterList,i=void 0===n?[]:n,r=e.groupCounterSeq;if(this._hasLocalGroupCounters(t)){var o=this._getLocalGroupCounters(t),a=o.counters,s=o.avChatRoomKey,c=o.groupCounterSeq;if(r>0&&r<c)return;i.forEach((function(e){var t=e.key,n=e.value;a.set(t,n)})),this._groupCountersMap.set(t,{lastUpdateTime:Date.now(),groupCounterSeq:r,counters:a,avChatRoomKey:s})}}},{key:"_deleteLocalGroupCounters",value:function(e){var t=e.groupID,n=e.counterList,i=void 0===n?[]:n,r=e.groupCounterSeq;if(this._hasLocalGroupCounters(t)){var o=this._getLocalGroupCounters(t),a=o.counters,s=o.avChatRoomKey;i.forEach((function(e){a.delete(e.key)})),this._groupCountersMap.set(t,{lastUpdateTime:Date.now(),groupCounterSeq:r,counters:a,avChatRoomKey:s})}}},{key:"_getLocalCounters",value:function(e,t){var n={};if(!this._hasLocalGroupCounters(e))return n;var i=this._getLocalGroupCounters(e).counters;if(t.length>0)t.forEach((function(e){i.has(e)&&(n[e]=i.get(e))}));else{var r,o=E(i.keys());try{for(o.s();!(r=o.n()).done;){var a=r.value;n[a]=i.get(a)}}catch(s){o.e(s)}finally{o.f()}}return n}},{key:"reset",value:function(){this._groupCountersMap.clear(),this.EXPIRE_TIME=3e4}}]),e}(),La=function(){function e(t){i(this,e);var n=t.manager,r=t.groupID,o=t.onInit,a=t.onSuccess,s=t.onFail;this._n="Polling",this._manager=n,this._groupModule=n._groupModule,this._onInit=o,this._onSuccess=a,this._onFail=s,this._groupID=r,this._timeoutID=-1,this._isRunning=!1,this._protocolName=gr}return o(e,[{key:"start",value:function(){var e=this._groupModule.isLoggedIn();e||(this._protocolName=mr),Be.l("".concat(this._n,".start pollingInterval:").concat(this._manager.getPollingInterval()," isLoggedIn:").concat(e)),this._isRunning=!0,this._request()}},{key:"isRunning",value:function(){return this._isRunning}},{key:"_request",value:function(){var e=this,t=this._onInit(this._groupID);this._groupModule.request({protocolName:this._protocolName,requestData:t}).then((function(t){e._onSuccess(e._groupID,t),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.getPollingInterval()))})).catch((function(t){e._onFail(e._groupID,t),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.MAX_POLLING_INTERVAL))}))}},{key:"stop",value:function(){Be.l("".concat(this._n,".stop")),this._timeoutID>0&&(clearTimeout(this._timeoutID),this._timeoutID=-1),this._isRunning=!1}}]),e}(),Oa={3:!0,4:!0,5:!0,6:!0,17:!0},Na=function(){function e(t){i(this,e),this._groupModule=t,this._n="AVChatRoomHandler",this._joinedGroupMap=new Map,this._pollingRequestInfoMap=new Map,this._pollingInstanceMap=new Map,this.sequencesLinkedList=new pa(200),this.messageIDLinkedList=new pa(100),this.receivedMessageCount=0,this._reportMessageStackedCount=0,this._onlineMemberCountMap=new Map,this.DEFAULT_EXPIRE_TIME=60,this.DEFAULT_POLLING_INTERVAL=300,this.MAX_POLLING_INTERVAL=2e3,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0,this._startBroadcastSeq=1,this._broadcastMessageIDMap=new Map,this.DEFAULT_POLLING_SIMPLIFIED_MSG=0}return o(e,[{key:"hasJoinedAVChatRoom",value:function(){return this._joinedGroupMap.size>0}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._joinedGroupMap.has(e)}},{key:"getJoinedAVChatRoom",value:function(){return this._joinedGroupMap.size>0?_(this._joinedGroupMap.keys()):null}},{key:"_updateRequestData",value:function(e){var n=this._pollingRequestInfoMap.get(e);return e===_(this._pollingInstanceMap.keys())[0]?t(t({},n),{},{startBroadcastSeq:this._startBroadcastSeq,simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG}):t(t({},n),{},{simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG})}},{key:"_handleSuccess",value:function(e,t){var n=t.data,i=n.key,r=n.nextSeq,o=n.rspMsgList,a=n.errorCode,s=n.nextBroadcastSeq,c=n.broadcastMessageList;if(0!==a){var u=this._pollingRequestInfoMap.get(e),l=new wo("longPollingAVError"),d=u?"".concat(u.key,"-").concat(u.startSeq):"requestInfo is undefined";l.setMessage("".concat(e,"-").concat(d,"-").concat(t.errorInfo)).setCode(t.errorCode).setNetworkType(this._groupModule.getNetworkType()).end(!0)}else{if(!this.checkJoinedAVChatRoomByID(e))return;it(i)&&nt(r)&&this._pollingRequestInfoMap.set(e,{key:i,startSeq:r}),nt(s)&&s>this._startBroadcastSeq&&(this._startBroadcastSeq=s),at(o)&&o.length>0?(o.forEach((function(e){e.to=e.groupID})),this.onMessage(o)):(this._pollingNoMessageCount+=1,this._pollingNoMessageCount===this.DEFAULT_POLLING_NO_MESSAGE_COUNT&&(this._pollingInterval=this.DEFAULT_POLLING_INTERVAL+this.DEFAULT_POLLING_INTERVAL_PLUS)),this._onBroadcastMessage(c)}}},{key:"_handleFailure",value:function(e,t){}},{key:"onMessage",value:function(e){if(at(e)&&0!==e.length){0!==this._pollingNoMessageCount&&(this._pollingNoMessageCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL);var t=null,n=[],i=this._getModule(Vn),r=this._getModule(ti),o=e.length;o>1&&e.sort((function(e,t){return e.sequence-t.sequence}));for(var a=this._getModule(qn),s=0;s<o;s++){var c=this.restoreMessageFromSimplified(e[s]);if(Oa[c.event]){if(6===c.event){if(this._groupModule.isGroupAttributesUpdatedNotice(c))continue;if(this._groupModule.isGroupCountersNotice(c))continue}this.receivedMessageCount+=1,t=this.packMessage(c,c.event);var u=1===c.isModified,l=1===c.isHistoryMessage;if((a.isUnlimitedAVChatRoom()||!this.sequencesLinkedList.has(t.sequence))&&!this.messageIDLinkedList.has(t.ID)){var d=t.conversationID;if(this.receivedMessageCount%50==0?this._getModule(Xn).detectFirstRound(d,this.sequencesLinkedList.data()):this.receivedMessageCount%80==0&&this._getModule(Xn).detectSecondRound(d,this.sequencesLinkedList.data()),null!==this.sequencesLinkedList.tail()){var p=this.sequencesLinkedList.tail().value,h=t.sequence-p;h>1&&h<=20?this._getModule(Xn).onMessageMaybeLost(d,p+1,h-1):h<-1&&h>=-20&&this._getModule(Xn).onMessageMaybeLost(d,t.sequence+1,Math.abs(h)-1)}this.sequencesLinkedList.set(t.sequence),this.messageIDLinkedList.set(t.ID);var f=!1;if(this._isMessageSentByCurrentInstance(t)?u&&(f=!0,t.isModified=u,i.updateMessageIsModifiedProperty(t)):f=!0,f){if(t.conversationType===b.CONV_SYSTEM&&5===t.payload.operationType&&this._onGroupDismissed(t.payload.groupProfile.groupID),!l&&t.conversationType!==b.CONV_SYSTEM){var g=t.conversationID.replace(b.CONV_GROUP,"");this._pollingInstanceMap.has(g)?this._groupModule.isLoggedIn()&&r.addMessageSequence({key:So,message:t}):(t.type!==b.MSG_GRP_TIP&&t.clientTime>0&&r.addMessageDelay(t.clientTime),r.addMessageSequence({key:Co,message:t}))}n.push(t)}}}else Be.w("".concat(this._n,".onMessage unknown event:").concat(c.event))}if(0!==n.length){this._groupModule.filterModifiedMessage(n);var m=this.packConversationOption(n);m.length>0&&this._getModule(Vn).onNewMessage({conversationOptionsList:m,isInstantMessage:!0}),Be.d("".concat(this._n,".onMessage count:").concat(n.length)),this._checkMessageStacked(n);var v=this._groupModule.filterUnmodifiedMessage(n);v.length>0&&this._groupModule.emitOuterEvent(k.MESSAGE_RECEIVED,v),n.length=0}}}},{key:"isBroadcastOrNormal",value:function(e){return 3===e||17===e}},{key:"isGroupTip",value:function(e){return 4===e||6===e}},{key:"isGroupSystemNotice",value:function(e){return 5===e}},{key:"restoreGroupTipElements",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.groupJoinType||(e.groupJoinType=1);var t=e.operatorInfo,n=void 0===t?{}:t,i=e.operatorID,r=e.userIDList,o=void 0===r?[]:r,a=n.userID,s=void 0===a?i:a,c=n.avatar,u=void 0===c?"":c,l=n.nick,d=void 0===l?"":l;e.operatorInfo={userID:s,avatar:u,nick:d};var p=o.map((function(e){return{userID:e}}));return e.memberInfoList=e.memberInfoList||p,e}},{key:"restoreMessageFromSimplified",value:function(e){var n=e.event;if(this.isBroadcastOrNormal(n)&&(e.cloudCustomData=e.cloudCustomData||"",e.elements=e.elements.map((function(e){if(e.type===b.MSG_CUSTOM){var n=e.content,i=void 0===n?{}:n;e.content=t({data:"",description:"",extension:""},i)}return e}))),(this.isGroupTip(n)||this.isGroupSystemNotice(n))&&(e.from=e.from||"@TIM#SYSTEM"),this.isGroupTip(n)){e.elements=this.restoreGroupTipElements(e.elements);var i=e.elements,r=void 0===i?{}:i,o=r.operationType,s=r.operatorInfo;if(1===o){var c=[{userID:(void 0===s?{}:s).userID}];r.memberInfoList=r.memberInfoList||c}}if(this.isGroupSystemNotice(n)){var u=e.elements,l=u.memberInfoList,d=u.operatorInfo;l||(l=void 0===d?{}:d),e.elements.memberInfoList=t({userID:e.elements.operatorID,avatar:"",nick:""},l),e.elements=t({authentication:"",remarkInfo:"",messageKey:1e3*e.time},e.elements);var p=Object.keys(e.elements).filter((function(e){return"operatorInfo"!==e})).reduce((function(n,i){return t(t({},n),{},a({},i,e.elements[i]))}),{});e.elements=p}return e}},{key:"_onGroupDismissed",value:function(e){Be.l("".concat(this._n,"._onGroupDismissed groupID:").concat(e)),this._groupModule.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"_checkMessageStacked",value:function(e){var t="MessageStacked",n=e.length;n>=100&&(this._groupModule.outputWarning(t),this._reportMessageStackedCount<5&&(new wo(t).setNetworkType(this._groupModule.getNetworkType()).setMessage("count:".concat(n," groupID:").concat(_(this._joinedGroupMap.keys()))).setLevel("warning").end(),this._reportMessageStackedCount+=1))}},{key:"_isMessageSentByCurrentInstance",value:function(e){return!!this._getModule(Vn).isMessageSentByCurrentInstance(e)}},{key:"packMessage",value:function(e,t){e.currentUser=this._groupModule.getMyUserID(),e.conversationType=5===t?b.CONV_SYSTEM:b.CONV_GROUP,e.isSystemMessage=!!e.isSystemMessage;var n=new Ko(e),i=this.packElements(e,t);return n.setElement(i,this._groupModule.getFileDownloadProxy()),n}},{key:"packElements",value:function(e,n){return 4===n||6===n?(this._updateMemberCountByGroupTips(e),{type:b.MSG_GRP_TIP,content:t(t({},e.elements),{},{groupProfile:e.groupProfile})}):5===n?{type:b.MSG_GRP_SYS_NOTICE,content:t(t({},e.elements),{},{groupProfile:t(t({},e.groupProfile),{},{groupID:e.groupID})})}:this._getModule(Kn).parseElements(e.elements,e.from)}},{key:"packConversationOption",value:function(e){for(var t=new Map,n=0;n<e.length;n++){var i=e[n],r=i.conversationID;if(t.has(r)){var o=t.get(r);o.lastMessage=i,"in"===i.flow&&o.unreadCount++}else t.set(r,{conversationID:i.conversationID,unreadCount:"out"===i.flow?0:1,type:i.conversationType,subType:i.conversationSubType,lastMessage:i})}return _(t.values())}},{key:"_updateMemberCountByGroupTips",value:function(e){var t=e.groupProfile.groupID,n=e.elements.onlineMemberInfo,i=void 0===n?void 0:n;if(!$t(i)){var r=i.onlineMemberNum,o=void 0===r?0:r,a=i.expireTime,s=void 0===a?this.DEFAULT_EXPIRE_TIME:a,c=this._onlineMemberCountMap.get(t)||{},u=Date.now();$t(c)?Object.assign(c,{lastReqTime:0,lastSyncTime:0,latestUpdateTime:u,memberCount:o,expireTime:s}):(c.latestUpdateTime=u,c.memberCount=o),Be.d("".concat(this._n,"._updateMemberCountByGroupTips info:"),c),this._onlineMemberCountMap.set(t,c)}}},{key:"_onBroadcastMessage",value:function(e){if(!$t(e)){for(var t=[],n=e.length,i=null,r=0;r<n;r++){var o=this.restoreMessageFromSimplified(e[r]);Oa[o.event]?((i=this.packMessage(o,o.event)).isBroadcastMessage=!0,this._broadcastMessageIDMap.has(i.ID)||(t.push(i),this._broadcastMessageIDMap.set(i.ID,1))):Be.w("".concat(this._n,"._onBroadcastMessage unknown event:").concat(o.event))}t.length>0&&this._groupModule.emitOuterEvent(k.MESSAGE_RECEIVED,t)}}},{key:"start",value:function(e){if(this._pollingInstanceMap.has(e)){var t=this._pollingInstanceMap.get(e);t.isRunning()||t.start()}else{var n=new La({manager:this,groupID:e,onInit:this._updateRequestData.bind(this),onSuccess:this._handleSuccess.bind(this),onFail:this._handleFailure.bind(this)});n.start(),this._pollingInstanceMap.set(e,n),Be.l("".concat(this._n,".start groupID:").concat(e))}}},{key:"handleJoinResult",value:function(e){var t=this;return this._preCheck().then((function(){var n=e.longPollingKey,i=e.group,r=i.groupID;return t._joinedGroupMap.set(r,i),t._groupModule.updateGroupMap([i]),t._groupModule.deleteUnjoinedAVChatRoom(r),t._groupModule.emitGroupListUpdate(!0,!1),st(n)?Jo({status:Ye,group:i}):Promise.resolve()}))}},{key:"startRunLoop",value:function(e){var t=this;return this.handleJoinResult(e).then((function(){var n=e.longPollingKey,i=e.group,r=e.startSeq,o=void 0===r?0:r,a=i.groupID;return t._pollingRequestInfoMap.set(a,{key:n,startSeq:o}),t.start(a),t._groupModule.isLoggedIn()?Jo({status:Ye,group:i}):Jo({status:Ye})}))}},{key:"_preCheck",value:function(){if(this._getModule(qn).isUnlimitedAVChatRoom())return Promise.resolve();if(!this.hasJoinedAVChatRoom())return Promise.resolve();var e=v(this._joinedGroupMap.entries().next().value,2),t=e[0],n=e[1];if(this._groupModule.isLoggedIn()){if(n.selfInfo.role!==b.GRP_MBR_ROLE_OWNER&&n.ownerID!==this._groupModule.getMyUserID())return this._groupModule.quitGroup(t);this._groupModule.deleteLocalGroupAndConversation(t)}else this._groupModule.deleteLocalGroupAndConversation(t);return this.reset(t),Promise.resolve()}},{key:"joinWithoutAuth",value:function(e){var t=this,n=e.groupID,i="".concat(this._n,".").concat("joinWithoutAuth"),r=new wo("joinWithoutAuth");return this._groupModule.request({protocolName:Zi,requestData:e}).then((function(e){var o=e.data.longPollingKey;if(t._groupModule.probeNetwork().then((function(e){var t=v(e,2);t[0];var i=t[1];r.setNetworkType(i).setMessage("groupID:".concat(n," longPollingKey:").concat(o)).end(!0)})),st(o))return Xo({code:fo.CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN});Be.l("".concat(i," ok. groupID:").concat(n)),t._getModule(Vn).setCompleted("".concat(b.CONV_GROUP).concat(n));var a=new fa({groupID:n});return t.startRunLoop({group:a,longPollingKey:o}),zo({status:Ye})})).catch((function(e){return Be.e("".concat(i," failed. groupID:").concat(n," error:"),e),t._groupModule.probeNetwork().then((function(t){var i=v(t,2),o=i[0],a=i[1];r.setError(e,o,a).setMessage("groupID:".concat(n)).end(!0)})),Xo(e)})).finally((function(){t._groupModule.getModule(Hn).reportAtOnce()}))}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this._onlineMemberCountMap.get(e)||{},n=Date.now();return $t(t)||n-t.lastSyncTime>1e3*t.expireTime&&n-t.latestUpdateTime>1e4&&n-t.lastReqTime>3e3?(t.lastReqTime=n,this._onlineMemberCountMap.set(e,t),this._getGroupOnlineMemberCount(e).then((function(e){return zo({memberCount:e.memberCount})})).catch((function(e){return Xo(e)}))):Jo({memberCount:t.memberCount})}},{key:"_getGroupOnlineMemberCount",value:function(e){var t=this,n="".concat(this._n,".").concat("_getGroupOnlineMemberCount");return this._groupModule.request({protocolName:vr,requestData:{groupID:e}}).then((function(i){var r=t._onlineMemberCountMap.get(e)||{},o=i.data,a=o.onlineMemberNum,s=void 0===a?0:a,c=o.expireTime,u=void 0===c?t.DEFAULT_EXPIRE_TIME:c;Be.l("".concat(n," ok. groupID:").concat(e," memberCount:").concat(s," expireTime:").concat(u));var l=Date.now();return $t(r)&&(r.lastReqTime=l),t._onlineMemberCountMap.set(e,Object.assign(r,{lastSyncTime:l,latestUpdateTime:l,memberCount:s,expireTime:u})),{memberCount:s}})).catch((function(i){return Be.w("".concat(n," failed. error:"),i),new wo("_getGroupOnlineMemberCount").setCode(i.code).setMessage("groupID:".concat(e," error:").concat(JSON.stringify(i))).setNetworkType(t._groupModule.getNetworkType()).end(),Promise.reject(i)}))}},{key:"_getModule",value:function(e){return this._groupModule.getModule(e)}},{key:"setPollingInterval",value:function(e){st(e)||(nt(e)?this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=e:this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=parseInt(e,10))}},{key:"setPollingIntervalPlus",value:function(e){st(e)||(nt(e)?this.DEFAULT_POLLING_INTERVAL_PLUS=e:this.DEFAULT_POLLING_INTERVAL_PLUS=parseInt(e,10))}},{key:"setPollingNoMessageCount",value:function(e){st(e)||(nt(e)?this.DEFAULT_POLLING_NO_MESSAGE_COUNT=e:this.DEFAULT_POLLING_NO_MESSAGE_COUNT=parseInt(e,10))}},{key:"setPollingSimplifiedMessage",value:function(e){st(e)||"0"!==e&&"1"!==e||(this.DEFAULT_POLLING_SIMPLIFIED_MSG=parseInt(e,10))}},{key:"getPollingInterval",value:function(){return this._pollingInterval}},{key:"onAVChatRoomMemberBanned",value:function(e){var t=e.payload.groupProfile.groupID;Be.l("".concat(this._n,".onAVChatRoomMemberBanned groupID:").concat(t)),this._groupModule.deleteLocalGroupAndConversation(t),this.reset(t)}},{key:"restartPolling",value:function(){Be.l("".concat(this._n,".restartPolling count:").concat(this._pollingInstanceMap.size));var e,t=E(this._pollingInstanceMap.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.stop(),n.start()}}catch(i){t.e(i)}finally{t.f()}}},{key:"reset",value:function(e){if(e){Be.l("".concat(this._n,".reset groupID:").concat(e));var t=this._pollingInstanceMap.get(e);t&&t.stop(),this._pollingInstanceMap.delete(e),this._joinedGroupMap.delete(e),this._pollingRequestInfoMap.delete(e),this._onlineMemberCountMap.delete(e)}else{Be.l("".concat(this._n,".reset all"));var n,i=E(this._pollingInstanceMap.values());try{for(i.s();!(n=i.n()).done;)n.value.stop()}catch(r){i.e(r)}finally{i.f()}this._pollingInstanceMap.clear(),this._joinedGroupMap.clear(),this._pollingRequestInfoMap.clear(),this._onlineMemberCountMap.clear(),this._broadcastMessageIDMap.clear()}this.sequencesLinkedList.reset(),this.messageIDLinkedList.reset(),this.receivedMessageCount=0,this._reportMessageStackedCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=300,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0}}]),e}(),Pa=1,Ua=15,xa=function(){function e(t){i(this,e),this._groupModule=t,this._n="GroupSystemNoticeHandler",this.pendencyMap=new Map}return o(e,[{key:"onNewGroupSystemNotice",value:function(e){var t=e.dataList,n=e.isSyncingEnded,i=e.isInstantMessage;Be.d("".concat(this._n,".onReceiveSystemNotice count:").concat(t.length));var r=this.newSystemNoticeStoredAndSummary({notifiesList:t,isInstantMessage:i}),o=r.eventDataList,a=r.result;o.length>0&&(this._groupModule.getModule(Vn).onNewMessage({conversationOptionsList:o,isInstantMessage:i}),this._onReceivedGroupSystemNotice({result:a,isInstantMessage:i})),i?a.length>0&&this._groupModule.emitOuterEvent(k.MESSAGE_RECEIVED,a):!0===n&&this._clearGroupSystemNotice()}},{key:"newSystemNoticeStoredAndSummary",value:function(e){var n=e.notifiesList,i=e.isInstantMessage,r=null,o=n.length,a=0,s=[],c={conversationID:b.CONV_SYSTEM,unreadCount:0,type:b.CONV_SYSTEM,subType:null,lastMessage:null};for(a=0;a<o;a++){var u=n[a],l=u.groupProfile,d=l.communityType,p=void 0===d?0:d,h=l.topicID,f=void 0===h?void 0:h,g=u.elements,m=g.topicIDList,v=void 0===m?void 0:m,_=g.operationType;if(!(2!==p||$t(f)&&$t(v))){if([17,18,20].includes(_)){this._handleTopicSystemNotice(u);continue}$t(f)||(u.to=f)}u.elements.operationType!==Ua&&(u.currentUser=this._groupModule.getMyUserID(),u.conversationType=b.CONV_SYSTEM,u.conversationID=b.CONV_SYSTEM,(r=new Ko(u)).setElement({type:b.MSG_GRP_SYS_NOTICE,content:t(t({},u.elements),{},{groupProfile:t({},u.groupProfile)})}),r.isSystemMessage=!0,(1===r.sequence&&1===r.random||2===r.sequence&&2===r.random)&&(r.sequence=mt(),r.random=mt(),r.generateMessageID(),Be.l("".concat(this._n,".newSystemNoticeStoredAndSummary sequence and random maybe duplicated, regenerate. ID:").concat(r.ID))),this._groupModule.getModule(Vn).pushIntoNoticeResult(s,r)&&(i?c.unreadCount++:r.setIsRead(!0),c.subType=r.conversationSubType))}return c.lastMessage=s[s.length-1],{eventDataList:s.length>0?[c]:[],result:s}}},{key:"_clearGroupSystemNotice",value:function(){var e=this;this._getPendencyList().then((function(t){t.forEach((function(t){e.pendencyMap.set("".concat(t.from,"_").concat(t.groupID,"_").concat(t.to),t)}));var n=e._groupModule.getModule(Vn).getLocalMessageList(b.CONV_SYSTEM),i=[];n.forEach((function(t){var n=t.payload,r=n.operatorID,o=n.operationType,a=n.groupProfile;if(o===Pa){var s="".concat(r,"_").concat(a.groupID,"_").concat(a.to),c=e.pendencyMap.get(s);c&&nt(c.handled)&&0!==c.handled&&i.push(t)}})),e.deleteGroupSystemNotice({messageList:i})}))}},{key:"deleteGroupSystemNotice",value:function(e){var t=this,n="".concat(this._n,".deleteGroupSystemNotice");return at(e.messageList)&&0!==e.messageList.length?(Be.l("".concat(n," ")+e.messageList.map((function(e){return e.ID}))),this._groupModule.request({protocolName:fr,requestData:{messageListToDelete:e.messageList.map((function(e){return{from:b.CONV_SYSTEM,messageSeq:e.clientSequence,messageRandom:e.random}}))}}).then((function(){Be.l("".concat(n," ok"));var i=t._groupModule.getModule(Vn);return e.messageList.forEach((function(e){i.deleteLocalMessage(e)})),zo()})).catch((function(e){return Be.e("".concat(n," error:"),e),Xo(e)}))):Jo()}},{key:"_getPendencyList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.type,i=void 0===n?void 0:n,r=t.startTime,o=void 0===r?0:r,a=t.limit,s=void 0===a?20:a;return this._groupModule.request({protocolName:hr,requestData:{type:i,startTime:o,limit:s,handleAccount:this._groupModule.getMyUserID()}}).then((function(t){var n=t.data.pendencyList;return 0!==t.data.nextStartTime?e._getPendencyList({startTime:t.data.nextStartTime}).then((function(e){return[].concat(_(n),_(e))})):n}))}},{key:"getGroupApplicationList",value:function(){var e=this;return this._getPendencyList().then((function(t){return e._getPendencyList({type:b.GRP_COMMUNITY}).then((function(n){return t.push.apply(t,_(n)),e._handlePendencyResult(t)})).catch((function(n){return e._handlePendencyResult(t)}))}))}},{key:"_handlePendencyResult",value:function(e){var t=this,n=[];return e.forEach((function(e){t.pendencyMap.set("".concat(e.from,"_").concat(e.groupID,"_").concat(e.to),e),0===e.handled&&n.push({applicant:e.from,applicantNick:e.fromUserNickName,groupName:e.groupName,groupID:e.groupID,authentication:e.authentication,messageKey:e.time,applicationType:e.applicationType,userID:e.userID})})),Jo({applicationList:n})}},{key:"_onReceivedGroupSystemNotice",value:function(e){var t=this,n=e.result;e.isInstantMessage&&n.forEach((function(e){switch(e.payload.operationType){case 1:case 3:case 6:case 11:case 12:case 15:break;case 2:t._onApplyGroupRequestAgreed(e);break;case 4:t._onMemberKicked(e);break;case 5:t._onGroupDismissed(e);break;case 7:t._onInviteGroup(e);break;case 8:t._onQuitGroup(e);break;case 9:t._onSetManager(e);break;case 10:t._onDeleteManager(e);break;case 20:t._onMessageRemindTypeSynced(e);break;case 21:t._groupModule.onAVChatRoomMemberBanned(e)}}))}},{key:"_onApplyGroupRequestAgreed",value:function(e){var t=this,n=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(n)||this._groupModule.getGroupProfile({groupID:n}).then((function(e){var n=e.data.group;if(n){t._groupModule.updateGroupMap([n]);var i=!n.isSupportTopic;t._groupModule.emitGroupListUpdate(!0,i)}}))}},{key:"_onMemberKicked",value:function(e){var t=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(t)&&this._groupModule.deleteLocalGroupAndConversation(t)}},{key:"_onGroupDismissed",value:function(e){var t=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(t)&&this._groupModule.deleteLocalGroupAndConversation(t);var n=this._groupModule._AVChatRoomHandler;n&&n.checkJoinedAVChatRoomByID(t)&&n.reset(t)}},{key:"_onInviteGroup",value:function(e){var t=this,n=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(n)||this._groupModule.getGroupProfile({groupID:n}).then((function(e){var n=e.data.group;n&&(t._groupModule.updateGroupMap([n]),t._groupModule.emitGroupListUpdate())}))}},{key:"_onQuitGroup",value:function(e){var t=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(t)&&this._groupModule.deleteLocalGroupAndConversation(t)}},{key:"_onSetManager",value:function(e){var t=e.payload.groupProfile,n=t.to,i=t.groupID,r=this._groupModule.getModule(Gn).getLocalGroupMemberInfo(i,n);r&&r.updateRole(b.GRP_MBR_ROLE_ADMIN)}},{key:"_onDeleteManager",value:function(e){var t=e.payload.groupProfile,n=t.to,i=t.groupID,r=this._groupModule.getModule(Gn).getLocalGroupMemberInfo(i,n);r&&r.updateRole(b.GRP_MBR_ROLE_MEMBER)}},{key:"_onMessageRemindTypeSynced",value:function(e){var t=e.payload.groupProfile.groupID,n=e.payload.messageRemindType;this._groupModule.getModule(Vn).onGroupMessageRemindTypeSynced({groupID:t,messageRemindType:n})}},{key:"_handleTopicSystemNotice",value:function(e){var t=e.groupProfile,n=t.groupID,i=t.topicID,r=e.elements,o=r.operationType,a=r.topicIDList,s=r.messageRemindType,c=this._groupModule.getModule(Fn);17===o?c.onTopicCreated({groupID:n,topicID:i}):18===o?c.onTopicDeleted({groupID:n,topicIDList:a}):20===o&&c.onTopicMessageRemindTypeUpdated({groupID:n,topicID:i,messageRemindType:s})}},{key:"reset",value:function(){this.pendencyMap.clear()}}]),e}(),Ga=["relayFlag"],Fa=function(e){s(r,e);var n=m(r);function r(e){var t;return i(this,r),(t=n.call(this,e))._n="GroupModule",t._commonGroupHandler=null,t._AVChatRoomHandler=null,t._groupSystemNoticeHandler=null,t._commonGroupHandler=new Ma(f(t)),t._groupAttributesHandler=new ba(f(t)),t._groupCountersHandler=new Ra(f(t)),t._AVChatRoomHandler=new Na(f(t)),t._groupTipsHandler=new Ia(f(t)),t._groupSystemNoticeHandler=new xa(f(t)),t.groupMap=new Map,t._unjoinedAVChatRoomList=new Map,t._receiptDetailCompleteMap=new Map,t.getInnerEmitterInstance().on(ta,t._onCloudConfigUpdated,f(t)),t}return o(r,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("polling_interval"),t=this.getCloudConfig("polling_interval_plus"),n=this.getCloudConfig("polling_no_msg_count"),i=this.getCloudConfig("polling_simplified_msg");this._AVChatRoomHandler&&(Be.l("".concat(this._n,"._onCloudConfigUpdated pollingInterval:").concat(e)+" pollingIntervalPlus:".concat(t," pollingNoMessageCount:").concat(n)+" pollingSimplifiedMessage:".concat(i)),this._AVChatRoomHandler.setPollingInterval(e),this._AVChatRoomHandler.setPollingIntervalPlus(t),this._AVChatRoomHandler.setPollingNoMessageCount(n),this._AVChatRoomHandler.setPollingSimplifiedMessage(i))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&(this._commonGroupHandler.onCheckTimer(e),this._groupTipsHandler.onCheckTimer(e))}},{key:"guardForAVChatRoom",value:function(e){var t=this;if(e.conversationType===b.CONV_GROUP){var n=kt(e.to)?qt(e.to):e.to;return this.hasLocalGroup(n)?Jo():this.getGroupProfile({groupID:n}).then((function(i){var r=i.data.group.type;if(Be.l("".concat(t._n,".guardForAVChatRoom. groupID:").concat(n," type:").concat(r)),r===b.GRP_AVCHATROOM){var o=fo.MESSAGE_SEND_FAIL_NOT_IN_AVCHATROOM;return Xo(new Wo({code:o,message:t.getErrorMessage(o,e.from,n),data:{message:e}}))}return Jo()}))}return Jo()}},{key:"checkJoinedAVChatRoomByID",value:function(e){return!!this._AVChatRoomHandler&&this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"onNewGroupMessage",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.onNewGroupMessage(e)}},{key:"updateNextMessageSeq",value:function(e){var t=this;if(at(e)){var n=this.getModule(Fn);e.forEach((function(e){var i=e.conversationID.replace(b.CONV_GROUP,"");kt(i)&&n.updateLastMessage(i,e.lastMessage),t.groupMap.has(i)&&(t.groupMap.get(i).nextMessageSeq=e.lastMessage.sequence+1)}))}}},{key:"onNewGroupTips",value:function(e){this._groupTipsHandler&&this._groupTipsHandler.onNewGroupTips(e)}},{key:"onGroupMessageRevoked",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.onGroupMessageRevoked(e)}},{key:"onNewGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler&&this._groupSystemNoticeHandler.onNewGroupSystemNotice(e)}},{key:"onGroupMessageReadNotice",value:function(e){var t=this;e.dataList.forEach((function(e){var n=e.elements.groupMessageReadNotice;if(!st(n)){var i=t.getModule(Vn);n.forEach((function(e){var n=e.groupID,r=e.topicID,o=void 0===r?void 0:r,a=e.lastMessageSeq;Be.d("".concat(t._n,".onGroupMessageReadNotice groupID:").concat(n," lastMessageSeq:").concat(a));var s="".concat(b.CONV_GROUP).concat(n),c=!0;$t(o)||(s="".concat(b.CONV_GROUP).concat(o),c=!1),i.updateIsReadAfterReadReport({conversationID:s,lastMessageSeq:a}),i.updateUnreadCount(s,c),i.clearGroupAtInfoList(s,c)}))}}))}},{key:"onReadReceiptList",value:function(e){var t=this;Be.d("".concat(this._n,".onReadReceiptList options:"),JSON.stringify(e)),e.dataList.forEach((function(e){var n=e.groupProfile,i=e.elements,r=n.groupID,o=t.getModule(Vn),a=i.readReceiptList;o.updateReadReceiptInfo({groupID:r,readReceiptList:a})}))}},{key:"onGroupMessageModified",value:function(e){Be.d("".concat(this._n,".onGroupMessageModified options:"),JSON.stringify(e));var n=this.getModule(Vn);e.dataList.forEach((function(e){n.onMessageModified(t(t({},e),{},{conversationType:b.CONV_GROUP,to:e.topicID?e.topicID:e.groupID}))}))}},{key:"deleteGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler&&this._groupSystemNoticeHandler.deleteGroupSystemNotice(e)}},{key:"initGroupMap",value:function(e){this.groupMap.set(e.groupID,new fa(e))}},{key:"deleteGroup",value:function(e){this.groupMap.delete(e)}},{key:"updateGroupMap",value:function(e){var t,n=this,i=this.getModule(Vn);e.forEach((function(e){t=e.groupID,n.groupMap.has(t)?n.groupMap.get(t).updateGroup(e):(n.groupMap.set(t,new fa(e)),i.deleteGroupRomaingMessageInfo(t))}));var r,o=this.getMyUserID(),a=E(this.groupMap);try{for(a.s();!(r=a.n()).done;){var s=v(r.value,2)[1];s.selfInfo.userID=o,"Owner"===s.selfInfo.role&&(s.ownerID=o)}}catch(c){a.e(c)}finally{a.f()}this._setStorageGroupList()}},{key:"getStorageGroupList",value:function(){return this.getModule(Bn).getItem("groupMap")}},{key:"_setStorageGroupList",value:function(){var e=this.getLocalGroupList().filter((function(e){var t=e.type;return!St(t)})).filter((function(e){return!e.isSupportTopic})).slice(0,20).map((function(e){return{groupID:e.groupID,name:e.name,avatar:e.avatar,type:e.type}}));this.getModule(Bn).setItem("groupMap",e)}},{key:"getGroupMap",value:function(){return this.groupMap}},{key:"getLocalGroupList",value:function(){return _(this.groupMap.values())}},{key:"getLocalGroupProfile",value:function(e){return this.groupMap.get(e)}},{key:"sortLocalGroupList",value:function(){var e=_(this.groupMap).filter((function(e){var t=v(e,2);return t[0],!$t(t[1].lastMessage)}));e.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})),this.groupMap=new Map(_(e))}},{key:"updateGroupLastMessage",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.handleUpdateGroupLastMessage(e)}},{key:"emitGroupListUpdate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalGroupList();if(e&&this.emitOuterEvent(k.GROUP_LIST_UPDATED),t){var i=JSON.parse(JSON.stringify(n));this.getModule(Vn).updateConversationGroupProfile(i)}}},{key:"patchGroupMessageRemindType",value:function(){var e=this.getLocalGroupList(),t=this.getModule(Vn),n=0;e.forEach((function(e){!0===t.patchMessageRemindType({ID:e.groupID,isC2CConversation:!1,messageRemindType:e.selfInfo.messageRemindType})&&(n+=1)})),Be.l("".concat(this._n,".patchGroupMessageRemindType count:").concat(n))}},{key:"recomputeUnreadCount",value:function(){var e=this.getLocalGroupList(),t=this.getModule(Vn);e.forEach((function(e){var n=e.groupID,i=e.selfInfo,r=i.excludedUnreadSequenceList,o=i.readedSequence;if(at(r)){var a=0;r.forEach((function(t){t>=o&&t<=e.nextMessageSeq-1&&(a+=1)})),a>=1&&t.recomputeGroupUnreadCount({conversationID:"".concat(b.CONV_GROUP).concat(n),count:a})}}))}},{key:"getMyNameCardByGroupID",value:function(e){var t=this.getLocalGroupProfile(e);return t?t.selfInfo.nameCard:""}},{key:"isPagingGetCompleted",value:function(){return!!this._commonGroupHandler&&this._commonGroupHandler.isPagingGetCompleted()}},{key:"getGroupList",value:function(e){return this._commonGroupHandler?this._commonGroupHandler.getGroupList(e):Jo()}},{key:"getGroupProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupProfile"),i=new wo("getGroupProfile"),r=e.groupID,o=e.groupCustomFieldFilter;Be.l("".concat(n," groupID:").concat(r));var a={groupIDList:[r],responseFilter:{groupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember","InviteJoinOption"],groupCustomFieldFilter:o,memberInfoFilter:["Role","JoinTime","MsgSeq","MsgFlag","NameCard"]}};return this.getGroupProfileAdvance(a).then((function(e){var o,a=e.data,s=a.successGroupList,c=a.failureGroupList;return Be.l("".concat(n," ok")),c.length>0?Xo(c[0]):(St(s[0].type)&&!t.hasLocalGroup(r)?o=new fa(s[0]):(t.updateGroupMap(s),o=t.getLocalGroupProfile(r)),o.isSupportTopic||t.getModule(Vn).updateConversationGroupProfile([o]),i.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(r," type:").concat(o.type," muteAllMembers:").concat(o.muteAllMembers," ownerID:").concat(o.ownerID)).end(),zo({group:o}))})).catch((function(r){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],a=n[1];i.setError(r,o,a).setMessage("groupID:".concat(e.groupID)).end()})),Be.e("".concat(n," failed. error:"),r),Xo(r)}))}},{key:"getGroupProfileAdvance",value:function(e){var n="".concat(this._n,".getGroupProfileAdvance"),i=e.groupIDList;at(i)&&i.length>50&&(this.outputWarning("GetGroupProfileLimit"),i.length=50);var r=[],o=[];i.forEach((function(e){Et({groupID:e})?o.push(e):r.push(e)}));var a=[];if(r.length>0){var s=this._getGroupProfileAdvance(t(t({},e),{},{groupIDList:r}));a.push(s)}if(o.length>0){var c=this._getGroupProfileAdvance(t(t({},e),{},{groupIDList:o,relayFlag:r.length>0}));a.push(c)}return Promise.all(a).then((function(e){var t=[],n=[];return e.forEach((function(e){t.push.apply(t,_(e.successGroupList)),n.push.apply(n,_(e.failureGroupList))})),zo({successGroupList:t,failureGroupList:n})})).catch((function(e){return Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"_getGroupProfileAdvance",value:function(e){var t=this,n=e.relayFlag,i=void 0!==n&&n,r=h(e,Ga);return this.request({protocolName:Wi,requestData:r}).then((function(e){Be.l("".concat(t._n,"._getGroupProfileAdvance ok."));var n=e.data.groups;return{successGroupList:n.filter((function(e){return st(e.errorCode)||0===e.errorCode})),failureGroupList:n.filter((function(e){return e.errorCode&&0!==e.errorCode})).map((function(e){return new Wo({code:e.errorCode,message:e.errorInfo,data:{groupID:e.groupID}})}))}})).catch((function(t){return i&&Et({groupID:e.groupIDList[0]})?{successGroupList:[],failureGroupList:[]}:Xo(t)}))}},{key:"createGroup",value:function(e){var n=this,i="".concat(this._n,".").concat("createGroup"),r=e.type,o=e.groupID;if(e.name&&!1===this._filterProfanity("name",e))return Xo({code:fo.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return Xo({code:fo.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return Xo({code:fo.PROFANITY_FOUND});if(!["Public","Private","ChatRoom","AVChatRoom","Community"].includes(r))return Xo({code:fo.ILLEGAL_GROUP_TYPE});if(!Et({type:r})){if(!$t(o)&&Et({groupID:o}))return Xo({code:fo.ILLEGAL_GROUP_ID});e.isSupportTopic=void 0}if(St(r)&&!st(e.memberList)&&e.memberList.length>0&&(e.memberList=void 0),this._canIUseJoinOption(r)||st(e.joinOption)||(e.joinOption=void 0),Et({type:r})){if(!$t(o)&&!Et({groupID:o}))return Xo({code:fo.ILLEGAL_GROUP_ID});e.isSupportTopic=!0===e.isSupportTopic?1:0}var a=new wo("createGroup");Be.l("".concat(i," options:"),e);var s=null,c=[];return this.request({protocolName:Yi,requestData:t(t({},e),{},{ownerID:this.getMyUserID(),webPushFlag:1})}).then((function(r){var o=r.data,u=o.groupID,l=o.overLimitUserIDList,d=void 0===l?[]:l;if(s=u,c=d,a.setNetworkType(n.getNetworkType()).setMessage("groupType:".concat(e.type," groupID:").concat(u," overLimitUserIDList=").concat(d)).end(),Be.l("".concat(i," ok groupID:").concat(u," overLimitUserIDList:"),d),e.type===b.GRP_AVCHATROOM)return n.getGroupProfile({groupID:u});if(e.type===b.GRP_COMMUNITY&&1===e.isSupportTopic)return n.getGroupProfile({groupID:u});$t(e.memberList)||$t(d)||(e.memberList=e.memberList.filter((function(e){return-1===d.indexOf(e.userID)}))),n.updateGroupMap([t(t({},e),{},{groupID:u})]);var p=n.getModule(Ln),h=p.createCustomMessage({to:u,conversationType:b.CONV_GROUP,payload:{data:"group_create",extension:n.isIntl()?"".concat(n.getMyUserID()," created a group"):"".concat(n.getMyUserID(),"创建群组")}});return p.sendMessageInstance(h),n.emitGroupListUpdate(),n.getGroupProfile({groupID:u})})).then((function(e){var t=e.data.group,n=t.selfInfo,i=n.nameCard,r=n.joinTime;return t.updateSelfInfo({nameCard:i,joinTime:r,messageRemindType:b.MSG_REMIND_ACPT_AND_NOTE,role:b.GRP_MBR_ROLE_OWNER}),zo({group:t,overLimitUserIDList:c})})).catch((function(r){if(a.setMessage("groupType:".concat(e.type)),n.probeNetwork().then((function(e){var t=v(e,2),n=t[0],i=t[1];a.setError(r,n,i).end()})),10010===r.code||10007===r.code){n.updateGroupMap([t(t({},e),{},{groupID:s})]);var o=n.getLocalGroupProfile(s);return Be.l("".concat(i," success, but failed to get group profile.")),zo({group:o,overLimitUserIDList:c})}return Be.e("".concat(i," failed. error:"),r),Xo(r)}))}},{key:"dismissGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("dismissGroup");if(this.hasLocalGroup(e)&&this.getLocalGroupProfile(e).type===b.GRP_WORK)return Xo(new Wo({code:fo.CANNOT_DISMISS_WORK}));var i=new wo("dismissGroup");return i.setMessage("groupID:".concat(e)),Be.l("".concat(n," groupID:").concat(e)),this.request({protocolName:$i,requestData:{groupID:e}}).then((function(){return i.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),t.checkJoinedAVChatRoomByID(e)&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),zo({groupID:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"updateGroupProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateGroupProfile");if(this.hasLocalGroup(e.groupID)){var i=this.getLocalGroupProfile(e.groupID).type;this._canIUseJoinOption(i)||st(e.joinOption)||(Be.w("".concat(n," joinOption is unavailable for Work/Meeting/AVChatRoom")),e.joinOption=void 0)}if(st(e.muteAllMembers)||(e.muteAllMembers?e.muteAllMembers="On":e.muteAllMembers="Off"),e.name&&!1===this._filterProfanity("name",e))return Xo({code:fo.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return Xo({code:fo.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return Xo({code:fo.PROFANITY_FOUND});var r=new wo("updateGroupProfile");return r.setMessage(JSON.stringify(e)),Be.l("".concat(n," groupID:").concat(e.groupID)),this.request({protocolName:Ji,requestData:e}).then((function(){return r.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok")),t.hasLocalGroup(e.groupID)&&(t.groupMap.get(e.groupID).updateGroup(e),t._setStorageGroupList()),zo({group:t.groupMap.get(e.groupID)})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Be.l("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"_filterProfanity",value:function(e,t){var n=this.getModule(ri);if(!n)return!0;var i=n.filterText(t[e],$),r=i.isAllowedToSend,o=i.modifiedText;return!0===r&&(t[e]=o,!0)}},{key:"joinGroup",value:function(e){var t=this,n=e.groupID,i=e.type,r="".concat(this._n,".joinGroup");if(i===b.GRP_WORK)return Xo({code:fo.CANNOT_JOIN_WORK});if(this.deleteUnjoinedAVChatRoom(n),this.hasLocalGroup(n)){if(!this.isLoggedIn())return Jo({status:b.JOIN_STATUS_ALREADY_IN_GROUP});var o=new wo("applyJoinGroup");return this.getGroupProfile({groupID:n}).then((function(){return o.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(n," joinedStatus:").concat(b.JOIN_STATUS_ALREADY_IN_GROUP)).end(),Jo({status:b.JOIN_STATUS_ALREADY_IN_GROUP})})).catch((function(i){return o.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(n," unjoined")).end(),Be.w("".concat(r," ").concat(n," was unjoined, now join!")),t.groupMap.delete(n),t.applyJoinGroup(e)}))}return Be.l("".concat(r," groupID:").concat(n)),this.isLoggedIn()?this.applyJoinGroup(e):this._AVChatRoomHandler.joinWithoutAuth(e)}},{key:"applyJoinGroup",value:function(e){var n=this,i="".concat(this._n,".").concat("applyJoinGroup"),r=e.groupID;if(!$t(e.applyMessage)&&!1===this._filterProfanity("applyMessage",e))return Xo({code:fo.PROFANITY_FOUND});var o=new wo("applyJoinGroup"),a=t({},e),s=this.canIUse(H.AVCHATROOM_HISTORY_MSG);return s&&(a.historyMessageFlag=1),this.getModule(Vn).deleteTopicRoamingMessageInfo(r),this.request({protocolName:Xi,requestData:a}).then((function(e){var t=e.data,a=t.joinedStatus,c=t.longPollingKey,u=t.startSeq,l=t.avChatRoomFlag,d=t.avChatRoomKey,p=t.messageList,h="groupID:".concat(r," joinedStatus:").concat(a," longPollingKey:").concat(c," startSeq:").concat(u)+" avChatRoomFlag:".concat(l," canGetAVChatRoomHistoryMessage:").concat(s,",")+" history message count:".concat($t(p)?0:p.length);switch(o.setNetworkType(n.getNetworkType()).setMessage("".concat(h)).end(),Be.l("".concat(i," ok. ").concat(h)),a){case $e:return zo({status:$e});case Ye:return n.getGroupProfile({groupID:r}).then((function(e){var t=e.data.group;return n._handleJoinResult({group:t,avChatRoomFlag:l,longPollingKey:c,startSeq:u,avChatRoomKey:d,messageList:p})})).catch((function(){var e=new fa({groupID:r});return n._handleJoinResult({group:e,avChatRoomFlag:l,longPollingKey:c,startSeq:u,avChatRoomKey:d,messageList:p})}));default:var f=new Wo({code:fo.JOIN_GROUP_FAIL});return Be.e("".concat(i," failed. error:"),f),Xo(f)}})).catch((function(e){return o.setMessage("groupID:".concat(r)),n.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),Be.e("".concat(i," failed. error:"),e),Xo(e)}))}},{key:"_handleJoinResult",value:function(e){var t,n=this,i=e.group,r=e.avChatRoomFlag,o=e.longPollingKey,a=e.startSeq,s=e.avChatRoomKey,c=e.messageList,u=i.groupID;return 1===r?(this.getModule(Vn).setCompleted("".concat(b.CONV_GROUP).concat(u)),this._groupAttributesHandler.initGroupAttributesCache({groupID:u,avChatRoomKey:s}),this._groupCountersHandler.initGroupCountersCache({groupID:u,avChatRoomKey:s}),(t=st(o)?this._AVChatRoomHandler.handleJoinResult({group:i}):this._AVChatRoomHandler.startRunLoop({group:i,longPollingKey:o,startSeq:a})).then((function(){n._onAVChatRoomHistoryMessage(c)})),t):(this.emitGroupListUpdate(!0,!1),zo({status:Ye,group:i}))}},{key:"quitGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("quitGroup");Be.l("".concat(n," groupID:").concat(e));var i=this.checkJoinedAVChatRoomByID(e);if(!i&&!this.hasLocalGroup(e))return Xo({code:fo.MEMBER_NOT_IN_GROUP});if(i&&!this.isLoggedIn())return Be.l("".concat(n," anonymously ok. groupID:").concat(e)),this.deleteLocalGroupAndConversation(e),this._AVChatRoomHandler.reset(e),Jo({groupID:e});var r=new wo("quitGroup");return r.setMessage("groupID:".concat(e)),this.request({protocolName:Qi,requestData:{groupID:e}}).then((function(){return r.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),i&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),zo({groupID:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"searchGroupByID",value:function(e){var t=this,n="".concat(this._n,".").concat("searchGroupByID"),i={groupIDList:[e]},r=new wo("searchGroupByID");return r.setMessage("groupID:".concat(e)),Be.l("".concat(n," groupID:").concat(e)),this.request({protocolName:er,requestData:i}).then((function(e){var i=e.data.groupProfile;if(0!==i[0].errorCode)throw new Wo({code:i[0].errorCode,message:i[0].errorInfo});return r.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok")),zo({group:new fa(i[0])})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Be.w("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"changeGroupOwner",value:function(e){var t=this,n="".concat(this._n,".").concat("changeGroupOwner");if(this.hasLocalGroup(e.groupID)&&this.getLocalGroupProfile(e.groupID).type===b.GRP_AVCHATROOM)return Xo({code:fo.CANNOT_CHANGE_OWNER_IN_AVCHATROOM});if(e.newOwnerID===this.getMyUserID())return Xo({code:fo.CANNOT_CHANGE_OWNER_TO_SELF});var i=new wo("changeGroupOwner");return i.setMessage("groupID:".concat(e.groupID," newOwnerID:").concat(e.newOwnerID)),Be.l("".concat(n," groupID:").concat(e.groupID)),this.request({protocolName:tr,requestData:e}).then((function(){i.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok"));var r=e.groupID,o=e.newOwnerID;t.groupMap.get(r).ownerID=o;var a=t.getModule(Gn).getLocalGroupMemberList(r);if(a instanceof Map){var s=a.get(t.getMyUserID());st(s)||(s.updateRole("Member"),t.groupMap.get(r).selfInfo.role="Member");var c=a.get(o);st(c)||c.updateRole("Owner")}return t.emitGroupListUpdate(!0,!1),zo({group:t.groupMap.get(r)})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"getGroupApplicationList",value:function(){return this._groupSystemNoticeHandler.getGroupApplicationList()}},{key:"handleGroupApplication",value:function(e){var t,n,i,r,o,a=this,s="".concat(this._n,".").concat("handleGroupApplication"),c=e.handleAction,u=e.handleMessage,l=e.message,d=e.application;l?(t=l.payload.operatorID,n=l.payload.groupProfile.groupID,i=l.payload.authentication,r=l.payload.messageKey):d&&(t=d.applicant,n=d.groupID,i=d.authentication,r=d.messageKey);var p=nr;d&&2===d.applicationType&&(p=ir,o=d.userID);var h=new wo("handleGroupApplication");return h.setMessage("groupID:".concat(n)),Be.l("".concat(s," groupID:").concat(n)),this.request({protocolName:p,requestData:{handleAction:c,handleMessage:u,applicant:t,invitee:o,groupID:n,authentication:i,messageKey:r}}).then((function(){return h.setNetworkType(a.getNetworkType()).end(),Be.l("".concat(s," ok")),l&&a._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),zo({group:a.getLocalGroupProfile(n)})})).catch((function(e){return a.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];h.setError(e,i,r).end()})),Be.e("".concat(s," failed. error"),e),Xo(e)}))}},{key:"handleGroupInvitation",value:function(e){var n=this,i="".concat(this._n,".").concat("handleGroupInvitation"),r=e.message.payload,o=r.groupProfile.groupID,a=r.authentication,s=r.messageKey,c=r.operatorID,u=e.handleAction,l=new wo("handleGroupInvitation");return l.setMessage("groupID:".concat(o," inviter:").concat(c," handleAction:").concat(u)),Be.l("".concat(i," groupID:").concat(o," inviter:").concat(c," handleAction:").concat(u)),this.request({protocolName:rr,requestData:t(t({},e),{},{inviter:c,groupID:o,authentication:a,messageKey:s})}).then((function(){return l.setNetworkType(n.getNetworkType()).end(),Be.l("".concat(i," ok")),n._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),zo({group:n.getLocalGroupProfile(o)})})).catch((function(e){return n.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];l.setError(e,i,r).end()})),Be.e("".concat(i," failed. error"),e),Xo(e)}))}},{key:"getGroupOnlineMemberCount",value:function(e){return this._AVChatRoomHandler?this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)?this._AVChatRoomHandler.getGroupOnlineMemberCount(e):Jo({memberCount:0}):Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"hasLocalGroup",value:function(e){return this.groupMap.has(e)}},{key:"deleteLocalGroupAndConversation",value:function(e){var t=this.checkJoinedAVChatRoomByID(e);if(Be.l("".concat(this._n,".deleteLocalGroupAndConversation isJoinedAVChatRoom:").concat(t)),t&&this.getModule(Vn).deleteLocalConversation("".concat(b.CONV_GROUP).concat(e)),Et({groupID:e})){var n=this.getLocalGroupProfile(e);n&&!0===n.isSupportTopic&&this.getModule(Fn).deleteTopicListInCommunity(e)}this._deleteLocalGroup(e),this.emitGroupListUpdate(!0,!1)}},{key:"_deleteLocalGroup",value:function(e){this.groupMap.delete(e),this.getModule(Gn).deleteGroupMemberList(e),this._setStorageGroupList()}},{key:"sendMessage",value:function(e,t){if(at(e._receiverList)&&e._receiverList.length>0&&!this.canIUse(H.MSG_TO_SPECIFIED_GRP_MBR))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var n=this.createGroupMessagePack(e,t);return this.request(n)}},{key:"createGroupMessagePack",value:function(e,t){var n=null;t&&t.offlinePushInfo&&(n=t.offlinePushInfo);var i="";it(e.cloudCustomData)&&e.cloudCustomData.length>0&&(i=e.cloudCustomData);var r=[];if(ot(t)&&ot(t.messageControlInfo)){var o=t.messageControlInfo,a=o.excludedFromUnreadCount,s=o.excludedFromLastMessage,c=o.excludedFromContentModeration;!0===a&&r.push("NoUnread"),!0===s&&r.push("NoLastMsg"),!0===c&&r.push("NoMsgCheck")}var u=void 0;at(e._receiverList)&&e._receiverList.length>0&&(u=e._receiverList,e._receiverList.length>50&&(u=e._receiverList.slice(0,50),this.outputWarning("ReceiverListLimit")));var l=this.isOnlineMessage(e,t)?1:0,d=e.getGroupAtInfoList(),p={fromAccount:this.getMyUserID(),groupID:e.to,msgBody:e.getElements(),cloudCustomData:i,random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:e.type!==b.MSG_TEXT||$t(d)?void 0:d,onlineOnlyFlag:l,clientTime:e.clientTime,offlinePushInfo:n?{pushFlag:!0===n.disablePush?1:0,title:n.title||"",desc:n.description||"",ext:n.extension||"",apnsInfo:{badgeMode:!0===n.ignoreIOSBadge?1:0,isVoipPush:this._isVoipPush(n)},androidInfo:{OPPOChannelID:n.androidOPPOChannelID||""}}:void 0,messageControlInfo:0===l?r:void 0,needReadReceipt:!0!==e.needReadReceipt||this.isMessageFromOrToAVChatroom(e.to)?0:1,receiverList:u,isSupportExtension:!0===e.isSupportExtension?1:0};return kt(e.to)&&(p.groupID=qt(e.to),p.topicID=e.to),{protocolName:mi,tjgID:this.generateTjgID(e),requestData:p}}},{key:"_isVoipPush",value:function(e){var t=void 0;return st(e.disableVoipPush)||(t=!1===e.disableVoipPush?1:0),t}},{key:"revokeMessage",value:function(e){var t={groupID:e.to,msgSeqList:[{msgSeq:e.sequence}]};return kt(e.to)&&(t.groupID=qt(e.to),t.topicID=e.to),this.request({protocolName:or,requestData:t})}},{key:"deleteMessage",value:function(e){var t=e.to,n=e.keyList;Be.l("".concat(this._n,".deleteMessage groupID:").concat(t," count:").concat(n.length));var i={groupID:t,deleter:this.getMyUserID(),keyList:n};return kt(t)&&(i.groupID=qt(t),i.topicID=t),this.request({protocolName:_r,requestData:i})}},{key:"modifyRemoteMessage",value:function(e){var t=e.to,n=e.sequence,i=e.payload,r=e.type,o=e.version,a=void 0===o?0:o,s=e.cloudCustomData,c=t,u=void 0;kt(t)&&(c=qt(t),u=t);var l=void 0;return Ht(r)&&(l=[]).push({type:r,content:i}),this.request({protocolName:yr,requestData:{groupID:c,topicID:u,sequence:n,version:a,elements:l,cloudCustomData:s}})}},{key:"getRoamingMessage",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessage"),i=e.conversationID,r=e.groupID,o=e.sequence,a=new wo("getGroupRoamingMessages"),s=0,c=void 0;return kt(r)&&(r=qt(c=r)),this._computeLastSequence({groupID:r,topicID:c,sequence:o}).then((function(e){return s=e,Be.l("".concat(n," groupID:").concat(r," startSequence:").concat(s)),t.request({protocolName:cr,requestData:{groupID:r,count:21,sequence:s,topicID:c}})})).then((function(e){var o=e.data,u=o.messageList,l=o.complete,d=o.invisibleSequenceList,p=void 0===d?[]:d;st(u)?Be.l("".concat(n," ok. complete:").concat(l," but messageList is undefined!")):Be.l("".concat(n," ok. complete:").concat(l," count:").concat(u.length));var h=t._getMinSequence(p,u)-1;a.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(r," topicID:").concat(c," startSequence:").concat(s," complete:").concat(l," nextSequence:").concat(h)).end();var f=t.getModule(Vn),g=[];return $t(u)||(f.updateRoamingMessageSequence(i,h),g=f.onRoamingMessage(u,i),f.updateIsRead(i),f.patchConversationLastMessage(i)),(2===l||h<=1)&&(f.setCompleted(i),h=""),Be.l("".concat(n," nextReqID:").concat(h,", stored message count:").concat(g.length,", invisible sequence count:").concat(p.length)),{nextReqID:h+"",storedMessageList:g}})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];a.setError(e,i,o).setMessage("groupID:".concat(r," topicID:").concat(c," startSequence:").concat(s)).end()})),Be.w("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"_getGroupIDOfMessage",value:function(e){return e.conversationID.replace(b.CONV_GROUP,"")}},{key:"_getMinSequence",value:function(e,t){var n=0;$t(t)||(n=t[t.length-1].sequence);var i=0;return $t(e)||(i=e[e.length-1]),Be.l("".concat(this._n,"._getMinSequence minVisibleSequence:").concat(n," minInvisibleSequence:").concat(i)),i>0&&i<n?i:n}},{key:"getReadReceiptList",value:function(e){var t=this,n="".concat(this._n,".").concat("getReadReceiptList"),i=this._getGroupIDOfMessage(e[0]),r=this.getMyUserID(),o=e.filter((function(e){return e.from===r&&!0===e.needReadReceipt})).map((function(e){return{sequence:e.sequence}}));if(Be.l("".concat(n," groupID:").concat(i," sequenceList:").concat(JSON.stringify(o))),0===o.length)return Jo({messageList:e});var a=new wo("getReadReceiptList");return a.setMessage("groupID:".concat(i)),this.request({protocolName:ur,requestData:{groupID:i,sequenceList:o}}).then((function(t){a.end(),Be.l("".concat(n," ok"));var i=t.data.readReceiptList;return at(i)&&i.forEach((function(t){e.forEach((function(e){0===t.code&&t.sequence===e.sequence&&(e.readReceiptInfo.readCount=t.readCount,e.readReceiptInfo.unreadCount=t.unreadCount)}))})),zo({messageList:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.w("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"sendReadReceipt",value:function(e){var t=this,n="".concat(this._n,".").concat("sendReadReceipt"),i=this._getGroupIDOfMessage(e[0]),r=new wo("sendReadReceipt");r.setMessage("groupID:".concat(i));var o=this.getMyUserID(),a=e.filter((function(e){return e.from!==o&&!0===e.needReadReceipt})).map((function(e){return{sequence:e.sequence}}));return 0===a.length?Xo({code:fo.READ_RECEIPT_MESSAGE_LIST_EMPTY}):(Be.l("".concat(n,". sequenceList:").concat(JSON.stringify(a))),this.request({protocolName:lr,requestData:{groupID:i,sequenceList:a}}).then((function(e){return r.end(),Be.l("".concat(n," ok")),zo()})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Be.w("".concat(n," failed. error:"),e),Xo(e)})))}},{key:"getReadReceiptDetail",value:function(e){var t=this,n=e.message,i=e.filter,r=e.cursor,o=e.count,a=this._getGroupIDOfMessage(n),s=n.ID,c=n.sequence,u="".concat(this._n,".").concat("getReadReceiptDetail"),l=this._receiptDetailCompleteMap.get(s)||!1,d=0!==i&&1!==i?0:i,p=it(r)?r:"",h=!nt(o)||o<=0||o>=100?100:o,f="groupID:".concat(a," sequence:").concat(c," cursor:").concat(p," filter:").concat(d," completeFlag:").concat(l);Be.l("".concat(u," ").concat(f));var g={cursor:"",isCompleted:!1,messageID:s,unreadUserIDList:[],readUserIDList:[]},m=new wo("getReadReceiptDetail");return m.setMessage(f),this.request({protocolName:pr,requestData:{groupID:a,sequence:c,flag:d,cursor:p,count:h}}).then((function(e){m.end();var n=e.data,i=n.cursor,r=n.isCompleted,o=n.unreadUserIDList,a=n.readUserIDList;return g.cursor=i,1===r&&(g.isCompleted=!0,t._receiptDetailCompleteMap.set(s,!0)),0===d?g.readUserIDList=a.map((function(e){return e.userID})):1===d&&(g.unreadUserIDList=o.map((function(e){return e.userID}))),Be.l("".concat(u," ok")),zo(g)})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];m.setError(e,i,r).end()})),Be.w("".concat(u," failed. error:"),e),Xo(e)}))}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessagesHopping"),i=new wo("getGroupRoamingMessagesHopping"),r=e.groupID,o=e.count,a=e.sequence,s=e.direction,c=a;1===s&&(c=a+o-1);var u=void 0;kt(r)&&(r=qt(u=r));var l="".concat(u?"topicID:".concat(u):"groupID:".concat(r)," sequence:").concat(a," direction:").concat(s);return Be.l("".concat(n," ").concat(l)),this.request({protocolName:cr,requestData:{groupID:r,topicID:u,count:o,sequence:c}}).then((function(r){var o=r.data,c=o.messageList,u=o.complete,d="complete:".concat(u," count:").concat(c?c.length:0);if(Be.l("".concat(n," ok. ").concat(d)),i.setNetworkType(t.getNetworkType()).setMessage("".concat(l," ").concat(d)).end(),2===u||$t(c)){var p=t._computeResult();return zo(p)}var h="".concat(b.CONV_GROUP).concat(e.groupID),f=t.getModule(Vn).onRoamingMessage(c,h,!1),g=t._computeResult({direction:s,sequence:a,remoteMessageList:c,processedMessageList:f});return zo(g)})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),s=n[0],c=n[1];i.setError(e,s,c).setMessage("groupID:".concat(r," sequence:").concat(a," count:").concat(o)).end()})),Be.w("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"_computeResult",value:function(e){var t={messageList:[],isCompleted:!1,nextMessageSeq:""};if(st(e))return t.isCompleted=!0,t;var n=e.direction,i=e.sequence,r=e.remoteMessageList,o=void 0===r?[]:r,a=e.processedMessageList,s=void 0===a?[]:a,c=o.length;return 1===n?(t.nextMessageSeq=o[0].sequence+1,s.forEach((function(e){e.sequence>=i&&t.messageList.push(e)})),0===t.messageList.length&&o[0].sequence<i&&(t.isCompleted=!0,t.nextMessageSeq=""),t):(t.nextMessageSeq=o[c-1].sequence-1,t.messageList=_(s),0===t.nextMessageSeq&&(t.isCompleted=!0,t.nextMessageSeq=""),t)}},{key:"setMessageRead",value:function(e){var t=this,n=e.conversationID,i=e.lastMessageSeq,r="".concat(this._n,".setMessageRead");Be.l("".concat(r," conversationID:").concat(n," lastMessageSeq:").concat(i)),nt(i)||this.outputWarning("DoNotModifyLastSeq");var o=new wo("setGroupMessageRead");o.setMessage("".concat(n,"-").concat(i));var a=n.replace(b.CONV_GROUP,""),s=void 0;return kt(a)&&(a=qt(s=a)),this.request({protocolName:ar,requestData:{groupID:a,topicID:s,messageReadSeq:i}}).then((function(){o.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(r," ok."));var e=t.getModule(Vn);e.updateIsReadAfterReadReport({conversationID:n,lastMessageSeq:i});var c=!0;if(!st(s)){c=!1;var u=t.getModule(Fn).getLocalTopic(a,s);u&&u.updateSelfInfo({readedSequence:i})}return e.updateUnreadCount(n,c),zo()})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),Be.l("".concat(r," failed. error:"),e),Xo(e)}))}},{key:"_computeLastSequence",value:function(e){var t=e.groupID,n=e.topicID,i=void 0===n?void 0:n,r=e.sequence;return r>0?Promise.resolve(r):st(i)||this.hasLocalGroup(t)?st(i)?this.getGroupLastSequence(t):this.getTopicLastSequence({groupID:t,topicID:i}):Promise.resolve(0)}},{key:"getGroupLastSequence",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupLastSequence"),i=new wo("getGroupLastSequence"),r=0,o="";if(this.hasLocalGroup(e)){var a=this.getLocalGroupProfile(e),s=a.lastMessage;if(s.lastSequence>0&&!1===s.onlineOnlyFlag)return r=s.lastSequence,o="got lastSequence:".concat(r," from local group profile[lastMessage.lastSequence]. groupID:").concat(e),Be.l("".concat(n," ").concat(o)),i.setNetworkType(this.getNetworkType()).setMessage("".concat(o)).end(),Promise.resolve(r);if(a.nextMessageSeq>1)return r=a.nextMessageSeq-1,o="got lastSequence:".concat(r," from local group profile[nextMessageSeq]. groupID:").concat(e),Be.l("".concat(n," ").concat(o)),i.setNetworkType(this.getNetworkType()).setMessage("".concat(o)).end(),Promise.resolve(r)}var c="GROUP".concat(e),u=this.getModule(Vn).getLocalConversation(c);if(u&&u.lastMessage.lastSequence&&!1===u.lastMessage.onlineOnlyFlag)return r=u.lastMessage.lastSequence,o="got lastSequence:".concat(r," from local conversation profile[lastMessage.lastSequence]. groupID:").concat(e),Be.l("".concat(n," ").concat(o)),i.setNetworkType(this.getNetworkType()).setMessage("".concat(o)).end(),Promise.resolve(r);var l={groupIDList:[e],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}};return this.getGroupProfileAdvance(l).then((function(a){var s=a.data.successGroupList;return $t(s)?Be.l("".concat(n," successGroupList is empty. groupID:").concat(e)):(r=s[0].nextMessageSeq-1,o="got lastSequence:".concat(r," from getGroupProfileAdvance. groupID:").concat(e),Be.l("".concat(n," ").concat(o))),i.setNetworkType(t.getNetworkType()).setMessage("".concat(o)).end(),r})).catch((function(r){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],a=n[1];i.setError(r,o,a).setMessage("get lastSequence failed from getGroupProfileAdvance. groupID:".concat(e)).end()})),Be.w("".concat(n," failed. error:"),r),Xo(r)}))}},{key:"getTopicLastSequence",value:function(e){var t=this,n=e.groupID,i=e.topicID,r="".concat(this._n,".").concat("getTopicLastSequence"),o=new wo("getTopicLastSequence"),a=0,s="",c=this.getModule(Fn);return c.hasLocalTopic(n,i)?(a=c.getLocalTopic(n,i).nextMessageSeq-1,s="get lastSequence:".concat(a," from local topic info[nextMessageSeq]. topicID:").concat(i),Be.l("".concat(r," ").concat(s)),o.setNetworkType(this.getNetworkType()).setMessage("".concat(s)).end(),Promise.resolve(a)):c.getTopicList({groupID:n,topicIDList:[i]}).then((function(e){var n=e.data.successTopicList;return $t(n)?Be.l("".concat(r," successTopicList is empty. topicID:").concat(i)):(a=n[0].nextMessageSeq-1,s="get lastSequence:".concat(a," from getTopicList. topicID:").concat(i),Be.l("".concat(r," ").concat(s))),o.setNetworkType(t.getNetworkType()).setMessage("".concat(s)).end(),a})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),r=n[0],a=n[1];o.setError(e,r,a).setMessage("get lastSequence failed from getTopicList. topicID:".concat(i)).end()})),Be.w("".concat(r," failed. error:"),e),Xo(e)}))}},{key:"isMessageFromOrToAVChatroom",value:function(e){return!!this._AVChatRoomHandler&&this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"hasJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler?this._AVChatRoomHandler.hasJoinedAVChatRoom():0}},{key:"getJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler?this._AVChatRoomHandler.getJoinedAVChatRoom():[]}},{key:"isOnlineMessage",value:function(e,t){return!(!this._canIUseOnlineOnlyFlag(e)||!t||!0!==t.onlineUserOnly)}},{key:"_canIUseOnlineOnlyFlag",value:function(e){var t=this.getJoinedAVChatRoom();return!t||!t.includes(e.to)||e.conversationType!==b.CONV_GROUP}},{key:"_onAVChatRoomHistoryMessage",value:function(e){if(!$t(e)){Be.l("".concat(this._n,"._onAVChatRoomHistoryMessage count:").concat(e.length));var n=[];e.forEach((function(e){n.push(t(t({},e),{},{isHistoryMessage:1}))})),this.onAVChatRoomMessage(n)}}},{key:"onAVChatRoomMessage",value:function(e){this._AVChatRoomHandler&&this._AVChatRoomHandler.onMessage(e)}},{key:"onAVChatRoomMemberBanned",value:function(e){this._AVChatRoomHandler&&this._AVChatRoomHandler.onAVChatRoomMemberBanned(e)}},{key:"getGroupSimplifiedInfo",value:function(e){var t=this,n=new wo("getGroupSimplifiedInfo"),i={groupIDList:[e],responseFilter:{groupBaseInfoFilter:["Type","Name"]}};return this.getGroupProfileAdvance(i).then((function(i){var r=i.data.successGroupList;return n.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(e," type:").concat(r[0].type)).end(),r[0]})).catch((function(i){t.probeNetwork().then((function(t){var r=v(t,2),o=r[0],a=r[1];n.setError(i,o,a).setMessage("groupID:".concat(e)).end()}))}))}},{key:"setUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.set(e,1)}},{key:"deleteUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.has(e)&&this._unjoinedAVChatRoomList.delete(e)}},{key:"isUnjoinedAVChatRoom",value:function(e){return this._unjoinedAVChatRoomList.has(e)}},{key:"isGroupAttributesUpdatedNotice",value:function(e){return this._groupAttributesHandler.isGroupAttributesUpdatedNotice(e)}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesHandler.updateLocalMainSequenceOnReconnected()}},{key:"initGroupAttributes",value:function(e){return this._groupAttributesHandler.initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._groupAttributesHandler.setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._groupAttributesHandler.deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._groupAttributesHandler.getGroupAttributes(e)}},{key:"isMessageFromTopic",value:function(e,t){return 2===e&&!$t(t)}},{key:"isMessageFromCommunityOfTopic",value:function(e,t){return 2===e&&$t(t)}},{key:"getMessageExtensions",value:function(e,t){return Be.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.request({protocolName:kr,requestData:{groupID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Be.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n)),this.request({protocolName:Er,requestData:{groupID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"getGroupNotify",value:function(e){var n=this;if(this.hasLocalGroup(e)){var i=this.getLocalGroupProfile(e),r=i.type,o=i.isSupportTopic;if(!St(r)&&!o){var a="".concat(this._n,".getGroupNotify"),s=this._getGroupLastRevokedTime(e),c=1e3*Ue();Be.l("".concat(a," groupID:").concat(e," type:").concat(r," beginTime:").concat(s," endTime:").concat(c)),this.request({protocolName:br,requestData:{type:Et({type:r,groupID:e})?b.GRP_COMMUNITY:void 0,groupID:e,beginTime:s,endTime:c}}).then((function(i){var r=i.data,o=r.nextRevokedTime,s=r.notifyList;Be.l("".concat(a," ok. groupID:").concat(e," nextRevokedTime:").concat(o));var c={dataList:[{elements:{revokedInfos:[]}}]};at(s)&&s.forEach((function(n){c.dataList[0].elements.revokedInfos.push({groupID:e,sequence:n.sequence,random:n.random,revokerInfo:t({},n.revokerInfo)})})),n.onGroupMessageRevoked(c),0!==o?(n._setGroupLastRevokedTime(e,o),n.getGroupNotify(e)):n._setGroupLastRevokedTime(e,1e3*Ue())})).catch((function(e){Be.e("".concat(a," failed. error:"),e)}))}}}},{key:"_getGroupLastRevokedTime",value:function(e){return this.hasLocalGroup(e)?this.getLocalGroupProfile(e)._lastRevokedTime:0}},{key:"_setGroupLastRevokedTime",value:function(e,t){this.hasLocalGroup(e)&&(this.getLocalGroupProfile(e)._lastRevokedTime=t)}},{key:"isGroupCountersNotice",value:function(e){return this._groupCountersHandler.isGroupCountersNotice(e)}},{key:"setGroupCounters",value:function(e){return this._groupCountersHandler.setGroupCounters(e)}},{key:"increaseGroupCounter",value:function(e){return this._groupCountersHandler.increaseGroupCounter(e)}},{key:"decreaseGroupCounter",value:function(e){return this._groupCountersHandler.decreaseGroupCounter(e)}},{key:"getGroupCounters",value:function(e){return this._groupCountersHandler.getGroupCounters(e)}},{key:"restartPolling",value:function(){this._AVChatRoomHandler&&this._AVChatRoomHandler.restartPolling()}},{key:"_canIUseJoinOption",value:function(e){return e===b.GRP_PUBLIC||Et({type:e})}},{key:"reset",value:function(){this.groupMap.clear(),this._unjoinedAVChatRoomList.clear(),this._receiptDetailCompleteMap.clear(),this._commonGroupHandler.reset(),this._groupSystemNoticeHandler.reset(),this._groupTipsHandler.reset(),this._groupAttributesHandler.reset(),this._groupCountersHandler.reset(),this._AVChatRoomHandler&&this._AVChatRoomHandler.reset()}}]),r}(ci),Va=function(){function e(t){i(this,e),this.userID="",this.avatar="",this.nick="",this.role="",this.joinTime="",this.lastSendMsgTime="",this.nameCard="",this.muteUntil=0,this.memberCustomField=[],this._initMember(t)}return o(e,[{key:"_initMember",value:function(e){this.updateMember(e)}},{key:"updateMember",value:function(e){var t=[null,void 0,"",0,NaN];e.memberCustomField&&Ct(this.memberCustomField,e.memberCustomField),ht(this,e,["memberCustomField","marks"],t)}},{key:"updateRole",value:function(e){["Owner","Admin","Member"].indexOf(e)<0||(this.role=e)}},{key:"updateMuteUntil",value:function(e){st(e)||(this.muteUntil=Math.floor((Date.now()+1e3*e)/1e3))}},{key:"updateNameCard",value:function(e){st(e)||(this.nameCard=e)}},{key:"updateMemberCustomField",value:function(e){e&&Ct(this.memberCustomField,e)}}]),e}(),qa=function(e){s(r,e);var n=m(r);function r(e){var t;return i(this,r),(t=n.call(this,e))._n="GroupMemberModule",t.groupMemberListMap=new Map,t.getInnerEmitterInstance().on(na,t._onProfileUpdated,f(t)),t}return o(r,[{key:"_onProfileUpdated",value:function(e){for(var t=this,n=e.data,i=function(e){var i=n[e];t.groupMemberListMap.forEach((function(e){e.has(i.userID)&&e.get(i.userID).updateMember({nick:i.nick,avatar:i.avatar})}))},r=0;r<n.length;r++)i(r)}},{key:"deleteGroupMemberList",value:function(e){this.groupMemberListMap.delete(e)}},{key:"getGroupMemberList",value:function(e){var t=this,n=e.groupID,i=e.offset,r=void 0===i?0:i,o=e.count,a=void 0===o?15:o,s=e.filter,c=void 0===s?void 0:s,u="".concat(this._n,".").concat("getGroupMemberList"),l=this.getModule(Un),d=l.hasLocalGroup(n);if(Be.l("".concat(u," groupID:").concat(n," offset:").concat(r," count:").concat(a," hasLocalGroup:").concat(d)),!d)return Jo({memberList:[],offset:0});if(l.getLocalGroupProfile(n).type===b.GRP_AVCHATROOM){if(this.canIUse(H.AVCHATROOM_MBR_LIST))return this._getAVChatRoomMemberList({groupID:n,offset:r,filter:c});this.outputWarning("LiveOnlineMember")}var p=new wo("getGroupMemberList"),h=0,f={groupID:n,limit:a>100?100:a};Et({groupID:n})?f.next="".concat(r):(f.offset=r,h=r+a);var g=[];return this.request({protocolName:Ar,requestData:f}).then((function(e){var i=e.data,r=i.members,o=i.memberNum,a=i.next,s=void 0===a?void 0:a;if(st(s)||(h=$t(s)?0:s),!at(r)||0===r.length)return h=0,Promise.resolve([]);var c=t.getModule(Un);return c.hasLocalGroup(n)&&(c.getLocalGroupProfile(n).memberNum=o),g=t._updateLocalGroupMemberMap(n,r),t.getModule(Nn).getUserProfile({userIDList:r.map((function(e){return e.userID})),tagList:[je.NICK,je.AVATAR]})})).then((function(e){var i=e.data;if(!at(i)||0===i.length)return Jo({memberList:[],offset:h});var o=i.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}}));return t._updateLocalGroupMemberMap(n,o),g.length<a&&(h=0),p.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(n," offset:").concat(r," count:").concat(a)).end(),Be.l("".concat(u," ok.")),zo({memberList:g,offset:h})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];p.setError(e,i,r).end()})),Be.e("".concat(u," failed. error:"),e),Xo(e)}))}},{key:"_getAVChatRoomMemberList",value:function(e){var t=this,n=e.groupID,i=e.offset,r=e.filter,o="".concat(this._n,".").concat("_getAVChatRoomMemberList"),a=new wo("_getAVChatRoomMemberList");return a.setMessage("groupID:".concat(n," offset:").concat(i," filter:").concat(r)),this.request({protocolName:Rr,requestData:{groupID:n,offset:i,filter:r}}).then((function(e){var i=e.data,r=i.memberList,s=void 0===r?[]:r,c=i.offset,u=void 0===c?0:c;a.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(o," ok. member count:").concat(s.length,", next request timestamp:").concat(u));var l=t._updateLocalGroupMemberMap(n,s);return zo({memberList:l,offset:u})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(o," failed. error:"),e),Xo(e)}))}},{key:"getGroupMemberProfile",value:function(e){var n=this,i="".concat(this._n,".").concat("getGroupMemberProfile"),r=new wo("getGroupMemberProfile");r.setMessage(e.userIDList.length>5?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)),Be.l("".concat(i," groupID:").concat(e.groupID," userIDList:").concat(e.userIDList.join(","))),e.userIDList.length>50&&(e.userIDList=e.userIDList.slice(0,50));var o=e.groupID,a=e.userIDList;return this._getGroupMemberProfileAdvance(t(t({},e),{},{userIDList:a})).then((function(e){var t=e.data.members;return at(t)&&0!==t.length?(n._updateLocalGroupMemberMap(o,t),n.getModule(Nn).getUserProfile({userIDList:t.map((function(e){return e.userID})),tagList:[je.NICK,je.AVATAR]})):Jo([])})).then((function(e){var t=e.data.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}}));n._updateLocalGroupMemberMap(o,t);var i=a.filter((function(e){return n.hasLocalGroupMember(o,e)})).map((function(e){return n.getLocalGroupMemberInfo(o,e)}));return r.setNetworkType(n.getNetworkType()).end(),zo({memberList:i})}))}},{key:"addGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("addGroupMember"),i=e.groupID,r=this.getModule(Un).getLocalGroupProfile(i),o=r.type,a=new wo("addGroupMember");if(a.setMessage("groupID:".concat(i," groupType:").concat(o)),St(o)){var s=new Wo({code:fo.CANNOT_ADD_MEMBER_IN_AVCHATROOM});return a.setError(s,!0,this.getNetworkType()).end(),Xo(s)}return e.userIDList=e.userIDList.map((function(e){return{userID:e}})),Be.l("".concat(n," groupID:").concat(i)),this.request({protocolName:Or,requestData:e}).then((function(i){var o=i.data.members;Be.l("".concat(n," ok"));var s=o.filter((function(e){return 1===e.result})).map((function(e){return e.userID})),c=o.filter((function(e){return 0===e.result})).map((function(e){return e.userID})),u=o.filter((function(e){return 2===e.result})).map((function(e){return e.userID})),l=o.filter((function(e){return 4===e.result})).map((function(e){return e.userID})),d="groupID:".concat(e.groupID,", ")+"successUserIDList:".concat(s,", ")+"failureUserIDList:".concat(c,", ")+"existedUserIDList:".concat(u,", ")+"overLimitUserIDList:".concat(l);return a.setNetworkType(t.getNetworkType()).setMoreMessage(d).end(),0===s.length?zo({successUserIDList:s,failureUserIDList:c,existedUserIDList:u,overLimitUserIDList:l}):(r.memberCount+=s.length,t._updateConversationGroupProfile(r),zo({successUserIDList:s,failureUserIDList:c,existedUserIDList:u,overLimitUserIDList:l,group:r}))})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"deleteGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteGroupMember"),i=e.groupID,r=e.userIDList,o=this.getModule(Un).getLocalGroupProfile(i);if(st(o))return Xo({code:fo.CANNOT_FIND_GROUP});if(St(o.type))return this.canIUse(H.AVCHATROOM_BAN_MBR)?this._banAVChatRoomMember(e):Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var a=new wo("deleteGroupMember"),s="groupID:".concat(i," ").concat(r.length>5?"userIDList.length:".concat(r.length):"userIDList:".concat(r));return a.setMessage(s),Be.l("".concat(n," groupID:").concat(i," userIDList:"),r),this.request({protocolName:Nr,requestData:e}).then((function(){return a.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok")),o.memberCount-=1,t._updateConversationGroupProfile(o),t.deleteLocalGroupMembers(i,r),zo({group:o,userIDList:r})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"_updateConversationGroupProfile",value:function(e){this.getModule(Vn).updateConversationGroupProfile([e])}},{key:"_banAVChatRoomMember",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteGroupMember"),i=e.groupID,r=e.userIDList,o="groupID:".concat(i," ").concat(r.length>5?"userIDList.length:".concat(r.length):"userIDList:".concat(r)),a=new wo("deleteGroupMember");a.setMessage(o),Be.l("".concat(n," groupID:").concat(i," userIDList:"),r);var s=this.getModule(Un).getLocalGroupProfile(i);return st(e.duration)||0===e.duration?Xo({code:fo.BAN_DURATION_INVALID}):this.request({protocolName:Pr,requestData:e}).then((function(){return a.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok")),t.deleteLocalGroupMembers(i,r),zo({group:s,userIDList:r})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"setGroupMemberMuteTime",value:function(e){var t=this,n=e.groupID,i=e.userID,r=e.muteTime,o="".concat(this._n,".").concat("setGroupMemberMuteTime");if(i===this.getMyUserID())return Xo(new Wo({code:fo.CANNOT_MUTE_SELF}));Be.l("".concat(o," groupID:").concat(n," userID:").concat(i));var a=new wo("setGroupMemberMuteTime");return a.setMessage("groupID:".concat(n," userID:").concat(i," muteTime:").concat(r)),this.modifyGroupMemberInfo({groupID:n,userID:i,muteTime:r}).then((function(e){a.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(o," ok"));var i=t.getModule(Un);return zo({group:i.getLocalGroupProfile(n),member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(o," failed. error:"),e),Xo(e)}))}},{key:"setGroupMemberRole",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupMemberRole"),i=e.groupID,r=e.userID,o=e.role,a=this.getModule(Un).getLocalGroupProfile(i);if(a.selfInfo.role!==b.GRP_MBR_ROLE_OWNER)return Xo({code:fo.NOT_OWNER});if([b.GRP_WORK,b.GRP_AVCHATROOM].includes(a.type))return Xo({code:fo.CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM});var s=[b.GRP_MBR_ROLE_ADMIN,b.GRP_MBR_ROLE_MEMBER];if(Et({groupID:i})&&s.push(b.GRP_MBR_ROLE_CUSTOM),s.indexOf(o)<0)return Xo({code:fo.INVALID_MEMBER_ROLE});if(r===this.getMyUserID())return Xo({code:fo.CANNOT_SET_SELF_MEMBER_ROLE});var c=new wo("setGroupMemberRole");return c.setMessage("groupID:".concat(i," userID:").concat(r," role:").concat(o)),Be.l("".concat(n," groupID:").concat(i," userID:").concat(r)),this.modifyGroupMemberInfo({groupID:i,userID:r,role:o}).then((function(e){return c.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok")),zo({group:a,member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"_filterProfanity",value:function(e,t){var n=this.getModule(ri);if(!n)return!0;var i=n.filterText(t[e],J),r=i.isAllowedToSend,o=i.modifiedText;return!0===r&&(t[e]=o,!0)}},{key:"setGroupMemberNameCard",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupMemberNameCard");if(e.nameCard&&!1===this._filterProfanity("nameCard",e))return Xo({code:fo.PROFANITY_FOUND});var i=e.groupID,r=e.userID,o=void 0===r?this.getMyUserID():r,a=e.nameCard;Be.l("".concat(n," groupID:").concat(i," userID:").concat(o));var s=new wo("setGroupMemberNameCard");return s.setMessage("groupID:".concat(i," userID:").concat(o," nameCard:").concat(a)),this.modifyGroupMemberInfo({groupID:i,userID:o,nameCard:a}).then((function(e){Be.l("".concat(n," ok")),s.setNetworkType(t.getNetworkType()).end();var r=t.getModule(Un).getLocalGroupProfile(i);return o===t.getMyUserID()&&r&&r.setSelfNameCard(a),zo({group:r,member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];s.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"setGroupMemberCustomField",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupMemberCustomField"),i=e.groupID,r=e.userID,o=void 0===r?this.getMyUserID():r,a=e.memberCustomField;Be.l("".concat(n," groupID:").concat(i," userID:").concat(o));var s=new wo("setGroupMemberCustomField");return s.setMessage("groupID:".concat(i," userID:").concat(o," memberCustomField:").concat(JSON.stringify(a))),this.modifyGroupMemberInfo({groupID:i,userID:o,memberCustomField:a}).then((function(e){s.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok"));var r=t.getModule(Un).getLocalGroupProfile(i);return zo({group:r,member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];s.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"modifyGroupMemberInfo",value:function(e){var n=this,i=e.groupID,r=e.userID,o=void 0;return kt(i)&&(i=qt(o=i)),this.request({protocolName:Ur,requestData:t(t({},e),{},{groupID:i,topicID:o})}).then((function(){if(n.hasLocalGroupMember(i,r)){var t=n.getLocalGroupMemberInfo(i,r);return st(e.muteTime)||t.updateMuteUntil(e.muteTime),st(e.role)||t.updateRole(e.role),st(e.nameCard)||t.updateNameCard(e.nameCard),st(e.memberCustomField)||t.updateMemberCustomField(e.memberCustomField),t}return n.getGroupMemberProfile({groupID:i,userIDList:[r]}).then((function(e){return v(e.data.memberList,1)[0]}))}))}},{key:"markGroupMemberList",value:function(e){var t=this,n="".concat(this._n,".").concat("markGroupMemberList"),i=e.groupID,r=e.markType,o=e.enableMark,a=e.userIDList,s=void 0===a?[]:a,c="groupID:".concat(i," markType:").concat(r," enableMark:").concat(o," userIDList count: ").concat(s.length);Be.l("".concat(n," ").concat(c));var u=2,l=[];!0===o&&(u=1);var d=_(s);s.length>500&&(d=s.slice(0,500),Be.w("".concat(n," ").concat(zt(500)))),d.forEach((function(e){l.push({userID:e,markType:[r]})})),d=null;var p=new wo("markGroupMemberList");return p.setMessage("".concat(c)),this.request({protocolName:xr,requestData:{groupID:i,operationType:u,memberList:l}}).then((function(e){var i=e.data.memberList,r=void 0===i?[]:i,o=[],a=[];r.length===s.length?o.push.apply(o,_(s)):(r.forEach((function(e){o.push(e.userID)})),s.forEach((function(e){o.includes(e)||a.push(e)})));var c="success count:".concat(o.length," fail count:").concat(a.length);return p.setNetworkType(t.getNetworkType()).setMessage(c).end(),Be.l("".concat(n," ok. ").concat(c)),zo({successUserIDList:o,failureUserIDList:a})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];p.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"_getGroupMemberProfileAdvance",value:function(e){return this.request({protocolName:Lr,requestData:t(t({},e),{},{memberInfoFilter:e.memberInfoFilter?e.memberInfoFilter:["Role","JoinTime","NameCard","ShutUpUntil"]})})}},{key:"_updateLocalGroupMemberMap",value:function(e,t){var n=this;return at(t)&&0!==t.length?t.map((function(t){return n.hasLocalGroupMember(e,t.userID)?n.getLocalGroupMemberInfo(e,t.userID).updateMember(t):n.setLocalGroupMember(e,new Va(t)),n.getLocalGroupMemberInfo(e,t.userID)})):[]}},{key:"deleteLocalGroupMembers",value:function(e,t){var n=this.groupMemberListMap.get(e);n&&t.forEach((function(e){n.delete(e)}))}},{key:"getLocalGroupMemberInfo",value:function(e,t){return this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).get(t):null}},{key:"setLocalGroupMember",value:function(e,t){if(this.groupMemberListMap.has(e))this.groupMemberListMap.get(e).set(t.userID,t);else{var n=(new Map).set(t.userID,t);this.groupMemberListMap.set(e,n)}}},{key:"getLocalGroupMemberList",value:function(e){return this.groupMemberListMap.get(e)}},{key:"hasLocalGroupMember",value:function(e,t){return this.groupMemberListMap.has(e)&&this.groupMemberListMap.get(e).has(t)}},{key:"hasLocalGroupMemberMap",value:function(e){return this.groupMemberListMap.has(e)}},{key:"reset",value:function(){this.groupMemberListMap.clear()}}]),r}(ci),Ba=["topicID","topicName","avatar","introduction","notification","unreadCount","muteAllMembers","customData","groupAtInfoList","nextMessageSeq","selfInfo"],Ha=function(e,t){return $t(e)?{lastTime:0,lastSequence:0,fromAccount:"",payload:null,type:"",messageForShow:"",nick:"",version:0,cloudCustomData:"",isRevoked:!1,revoker:null}:{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",payload:e.payload||null,type:e.type||"",messageForShow:Bt(e.type,e.payload,t),nick:e.nick||"",version:e.version||0,cloudCustomData:e.cloudCustomData||"",isRevoked:e.isRevoked||!1,revoker:e.revoker||null}},ja=function(){function e(t,n){i(this,e),this.topicID="",this.topicName="",this.avatar="",this.introduction="",this.notification="",this.unreadCount=0,this.muteAllMembers=!1,this.customData="",this.groupAtInfoList=[],this.nextMessageSeq=0,this.lastMessage=Ha(t.lastMessage,n),this.selfInfo={muteTime:0,readedSequence:0,messageRemindType:"",excludedUnreadSequenceList:void 0},this._initTopic(t)}return o(e,[{key:"_initTopic",value:function(e){for(var t in e)Ba.indexOf(t)<0||("selfInfo"===t?this.updateSelfInfo(e[t]):this[t]="muteAllMembers"===t?1===e[t]:e[t])}},{key:"updateUnreadCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.unreadCount=e}},{key:"updateNextMessageSeq",value:function(e){this.nextMessageSeq=e}},{key:"updateLastMessage",value:function(e){this.lastMessage=Ha(e)}},{key:"updateGroupAtInfoList",value:function(e){this.groupAtInfoList=JSON.parse(JSON.stringify(e))}},{key:"updateTopic",value:function(e){st(e.selfInfo)||this.updateSelfInfo(e.selfInfo),st(e.muteAllMembers)||(this.muteAllMembers=1===e.muteAllMembers),ht(this,e,["groupID","lastMessageTime","selfInfo","muteAllMembers","lastMsg"])}},{key:"updateSelfInfo",value:function(e){return 0!==ht(this.selfInfo,e,[],[""])}},{key:"reduceUnreadCount",value:function(){return this.unreadCount>=1&&(this.unreadCount-=1,!0)}},{key:"isLastMessageRevoked",value:function(e){return e.sequence===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}}]),e}(),Ka=function(e){s(r,e);var n=m(r);function r(e){var t;return i(this,r),(t=n.call(this,e))._n="TopicModule",t._topicMap=new Map,t._getTopicTimeMap=new Map,t.TOPIC_CACHE_TIME=300,t.TOPIC_LAST_ACTIVE_TIME=3600,t.getInnerEmitterInstance().on(ta,t._onCloudConfigUpdated,f(t)),t}return o(r,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("topic_cache_time"),t=this.getCloudConfig("topic_last_active_time");st(e)||(this.TOPIC_CACHE_TIME=Number(e)),st(t)||(this.TOPIC_LAST_ACTIVE_TIME=Number(t))}},{key:"onTopicCreated",value:function(e){var t=e.groupID;this.resetGetTopicTime(t),this.emitOuterEvent(k.TOPIC_CREATED,e)}},{key:"onTopicDeleted",value:function(e){var t=this,n=e.groupID,i=e.topicIDList;(void 0===i?[]:i).forEach((function(e){t._deleteLocalTopic(n,e)})),this.emitOuterEvent(k.TOPIC_DELETED,e)}},{key:"onTopicMessageRemindTypeUpdated",value:function(e){var t=e.groupID,n=e.topicID,i=e.messageRemindType,r=this.getLocalTopic(t,n);if(r){var o=r.updateSelfInfo({messageRemindType:i});o&&this.emitOuterEvent(k.TOPIC_UPDATED,{groupID:t,topic:r}),Be.d("".concat(this._n,".onTopicMessageRemindTypeUpdated topicID:").concat(n)+" messageRemindType:".concat(i," isTopicUpdated:").concat(o))}}},{key:"onTopicProfileUpdated",value:function(e){var t=e.groupID,n=e.topicID,i=this.getLocalTopic(t,n);i&&(i.updateTopic(e),this.emitOuterEvent(k.TOPIC_UPDATED,{groupID:t,topic:i}))}},{key:"onConversationProxy",value:function(e){var t=e.topicID,n=e.unreadCount,i=e.groupAtInfoList,r=qt(t),o=this.getLocalTopic(r,t),a=!1;o&&(st(n)||o.unreadCount===n||(o.updateUnreadCount(n),a=!0),st(i)||(o.updateGroupAtInfoList(i),a=!0)),a&&this.emitOuterEvent(k.TOPIC_UPDATED,{groupID:r,topic:o})}},{key:"onMessageSent",value:function(e){var t=e.groupID,n=e.topicID,i=e.lastMessage,r=this.getLocalTopic(t,n);r&&(r.nextMessageSeq+=1,r.updateLastMessage(i),this.emitOuterEvent(k.TOPIC_UPDATED,{groupID:t,topic:r}))}},{key:"onMessageModified",value:function(e){var t=e.to,n=e.time,i=e.sequence,r=e.elements,o=e.cloudCustomData,a=e.messageVersion,s=qt(t),c=this.getLocalTopic(s,t);if(c){var u=c.lastMessage;Be.d("".concat(this._n,".onMessageModified topicID:").concat(t," lastMessage:"),JSON.stringify(u),"options:",JSON.stringify(e)),u&&(null===u.payload||u.lastTime===n&&u.lastSequence===i&&u.version!==a)&&(u.type=r[0].type,u.payload=r[0].content,u.messageForShow=Bt(u.type,u.payload,this.isIntl()),u.cloudCustomData=o,u.version=a,u.lastSequence=i,u.lastTime=n,this.emitOuterEvent(k.TOPIC_UPDATED,{groupID:s,topic:c}))}}},{key:"onMessageRevoked",value:function(e){var t=this;if(0!==e.length){var n=null,i=null,r=!1;e.forEach((function(e){var o=e.to;i=qt(o),(n=t.getLocalTopic(i,o))&&(n.reduceUnreadCount()&&(r=!0),n.isLastMessageRevoked(e)&&(n.setLastMessageRevoked(!0),n.setLastMessageRevoker(e.revoker),r=!0))})),r&&this.emitOuterEvent(k.TOPIC_UPDATED,{groupID:i,topic:n})}}},{key:"isLastMessageRevoked",value:function(e){var t=e.topicID,n=e.sequence,i=qt(t),r=this.getLocalTopic(i,t),o=!1;return r&&(o=r.isLastMessageRevoked({sequence:n})),o}},{key:"getJoinedCommunityList",value:function(){return this.getModule(Un).getGroupList({isGroupWithTopicOnly:!0}).then((function(e){var t=e.data.groupList;return zo({groupList:void 0===t?[]:t})})).catch((function(e){return Xo(e)}))}},{key:"createTopicInCommunity",value:function(e){var n=this,i="".concat(this._n,".").concat("createTopicInCommunity"),r=e.topicID;if(!st(r)&&!kt(r))return Xo({code:fo.ILLEGAL_TOPIC_ID});if(e.topicName&&!1===this._filterProfanity("topicName",e))return Xo({code:fo.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return Xo({code:fo.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return Xo({code:fo.PROFANITY_FOUND});var o=new wo("createTopicInCommunity");return this.request({protocolName:eo,requestData:t({},e)}).then((function(r){var a=r.data.topicID;return o.setMessage("topicID:".concat(a)).setNetworkType(n.getNetworkType()).end(),Be.l("".concat(i," ok")),n._updateTopicMap([t(t({},e),{},{topicID:a})]),zo({topicID:a})})).catch((function(e){return n.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),Be.e("".concat(i," failed. error:"),e),Xo(e)}))}},{key:"deleteTopicFromCommunity",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteTopicFromCommunity"),i=e.groupID,r=e.topicIDList,o=void 0===r?[]:r,a=new wo("deleteTopicFromCommunity");return a.setMessage("groupID:".concat(i," topicIDList:").concat(o)),this.request({protocolName:to,requestData:{groupID:i,topicIDList:o}}).then((function(e){var n=e.data.resultList,r=[],o=[];(void 0===n?[]:n).forEach((function(e){var t=e.topicID,n=e.errorCode,i=e.errorInfo;0===n?r.push({topicID:t}):o.push({topicID:t,code:n,message:i})}));var s="success count:".concat(r.length,", fail count:").concat(o.length);return a.setMoreMessage("".concat(s)).setNetworkType(t.getNetworkType()).end(),Be.l("".concat(s)),r.forEach((function(e){t._deleteLocalTopic(i,e.topicID)})),zo({successTopicList:r,failureTopicList:o})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"updateTopicProfile",value:function(e){var n=this,i="".concat(this._n,".").concat("updateTopicProfile");if(Be.l("".concat(i," options:"),e),e.topicName&&!1===this._filterProfanity("topicName",e))return Xo({code:fo.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return Xo({code:fo.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return Xo({code:fo.PROFANITY_FOUND});var r=new wo("updateTopicProfile");return r.setMessage("groupID:".concat(e.groupID," topicID:").concat(e.topicID)),st(e.muteAllMembers)||(e.muteAllMembers=!0===e.muteAllMembers?"On":"Off"),this.request({protocolName:no,requestData:t({},e)}).then((function(){return r.setNetworkType(n.getNetworkType()).end(),Be.l("".concat(i," ok")),n._updateTopicMap([e]),zo({topic:n.getLocalTopic(e.groupID,e.topicID)})})).catch((function(e){return n.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Be.e("".concat(i," failed. error:"),e),Xo(e)}))}},{key:"getTopicList",value:function(e){var n=this,i="".concat(this._n,".").concat("getTopicList"),r=e.groupID,o=e.topicIDList,a=void 0===o?[]:o,s=0===a.length,c=new wo("getTopicList");if(c.setMessage("groupID:".concat(r)),this._getTopicTimeMap.has(r)){var u=this._getTopicTimeMap.get(r),l=u.isGetAll,d=u.time;if((l||!l&&!s)&&Date.now()-d<1e3*this.TOPIC_CACHE_TIME){var p=this._getLocalTopicList(r,a);if(s||p.length===a.length)return c.setNetworkType(this.getNetworkType()).setMoreMessage("from cache, topic count:".concat(p.length)).end(),Be.l("".concat(i," groupID:").concat(r," from cache, topic count:").concat(p.length)),Jo({successTopicList:p,failureTopicList:[]})}}return this.request({protocolName:io,requestData:{groupID:r,topicIDList:a}}).then((function(e){var o=e.data.topicInfoList,a=[],u=[],l=[];(void 0===o?[]:o).forEach((function(e){var n=e.topic,i=e.selfInfo,r=e.errorCode,o=e.errorInfo,s=n.topicID;0===r?(a.push(t(t({},n),{},{selfInfo:i})),u.push(s)):l.push({topicID:s,code:r,message:o})})),n._updateTopicMap(a),n._handleTopicAtInfo(a);var d="success count:".concat(u.length,", fail count:").concat(l.length);c.setNetworkType(n.getNetworkType()).setMoreMessage("".concat(d)).end(),Be.l("".concat(i," groupID:").concat(r," from remote, ").concat(d));var p=[];return $t(u)||(n._getTopicTimeMap.set(r,{time:Date.now(),isGetAll:s}),p=n._getLocalTopicList(r,u)),zo({successTopicList:p,failureTopicList:l})})).catch((function(e){return n.probeNetwork(e).then((function(t){var n=v(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),Be.e("".concat(i," failed. error:"),e),Xo(e)}))}},{key:"hasLocalTopic",value:function(e,t){return!!this._topicMap.has(e)&&this._topicMap.get(e).has(t)}},{key:"getLocalTopic",value:function(e,t){var n=null;return this._topicMap.has(e)&&(n=this._topicMap.get(e).get(t)),n}},{key:"_getLocalTopicList",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this._topicMap.get(e),i=[];return n&&(i=_(n.values())),0===t.length?i:i.filter((function(e){return t.includes(e.topicID)}))}},{key:"_deleteLocalTopic",value:function(e,t){this._topicMap.has(e)&&(this._topicMap.get(e).delete(t),Be.l("".concat(this._n,"._deleteLocalTopic groupID:").concat(e," topicID:").concat(t)))}},{key:"_updateTopicMap",value:function(e){var t=this,n=[];e.forEach((function(e){var i=e.groupID,r=e.topicID,o=null;t._topicMap.has(i)||t._topicMap.set(i,new Map),t._topicMap.get(i).has(r)?(o=t._topicMap.get(i).get(r)).updateTopic(e):(t._getTopicLastMessage(e),o=new ja(e,t.isIntl()),t._topicMap.get(i).set(r,o));var a=t._computeUnreadCount(o);o.updateUnreadCount(a),n.push({conversationID:"".concat(b.CONV_GROUP).concat(r),type:b.CONV_TOPIC,unreadCount:a})})),n.length>0&&this.getModule(Vn).updateTopicConversation(n)}},{key:"resetGetTopicTime",value:function(e){var t=this;st(e)?_(this._getTopicTimeMap.keys()).forEach((function(e){t._getTopicTimeMap.set(e,0)})):this._getTopicTimeMap.set(e,0)}},{key:"getTopicListOnReconnected",value:function(){var e=this,t=_(this._topicMap.keys()),n=[];t.forEach((function(t){var i=[];e._getLocalTopicList(t).forEach((function(t){var n=t.lastMessage.lastTime,r=void 0===n?0:n;Date.now()-1e3*r<1e3*e.TOPIC_LAST_ACTIVE_TIME&&i.push(t.topicID)})),i.length>0&&n.push({groupID:t,topicIDList:i})})),Be.l("".concat(this._n,".getTopicListOnReconnected. active community count:").concat(n.length)),this._relayGetTopicList(n)}},{key:"_relayGetTopicList",value:function(e){var t=this;if(0!==e.length){var n=e.shift(),i=n.topicIDList.length>5?"topicIDList.length:".concat(n.topicIDList.length):"topicIDList:".concat(n.topicIDList),r=new wo("relayGetTopicList");r.setMessage(i),Be.l("".concat(this._n,"._relayGetTopicList. ").concat(i)),this.getTopicList(n).then((function(){r.setNetworkType(t.getNetworkType()).end(),t._relayGetTopicList(e)})).catch((function(n){t.probeNetwork().then((function(e){var t=v(e,2),i=t[0],o=t[1];r.setError(n,i,o).end()})),t._relayGetTopicList(e)}))}}},{key:"_handleTopicAtInfo",value:function(e){var n=this;0!==e.length&&e.forEach((function(e){var i=e.groupID,r=e.topicID,o=e.groupAtInfoList,a=[];st(o)||(o.forEach((function(e){a.push(t(t({},e),{},{groupID:i,topicID:r}))})),n.getModule(Vn).onNewGroupAtTips({dataList:a}))}))}},{key:"_getTopicLastMessage",value:function(e){if(!st(e.lastMsg)){var t={time:e.lastMsg.time,sequence:e.lastMsg.sequence,from:e.lastMsg.from,payload:e.lastMsg.elements[0]?e.lastMsg.elements[0].content:null,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:"",nick:e.lastMsg.nick,version:e.lastMsg.messageVersion,cloudCustomData:e.lastMsg.cloudCustomData,isRevoked:2===e.lastMsg.isPlaceMessage,revoker:$t(e.lastMsg.revokerInfo)?null:e.lastMsg.revokerInfo.revoker};e.lastMessage=t}}},{key:"deleteTopicListInCommunity",value:function(e){var t=this,n=this._getLocalTopicList(e),i=this.getModule(Vn);n.forEach((function(n){var r=n.topicID;t._deleteLocalTopic(e,r),t._getTopicTimeMap.delete(e),i.deleteLocalConversation("".concat(b.CONV_GROUP).concat(r))}))}},{key:"_computeUnreadCount",value:function(e){var t=e.selfInfo,n=t.excludedUnreadSequenceList,i=t.readedSequence,r=e.nextMessageSeq-e.selfInfo.readedSequence-1;if(at(n)){var o=0;n.forEach((function(t){t>=i&&t<=e.nextMessageSeq-1&&(o+=1)})),o>=1&&(r-=o)}return r<0?0:r}},{key:"_filterProfanity",value:function(e,t){var n=this.getModule(ri);if(!n)return!0;var i=n.filterText(t[e],$),r=i.isAllowedToSend,o=i.modifiedText;return!0===r&&(t[e]=o,!0)}},{key:"updateLastMessage",value:function(e,t){var n=qt(e),i=this.getLocalTopic(n,e);if(i){var r=t.sequence+1;i.updateNextMessageSeq(r),i.updateLastMessage(t),this.emitOuterEvent(k.TOPIC_UPDATED,{groupID:n,topic:i})}}},{key:"getMessageExtensions",value:function(e,t){Be.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t));var n=qt(e.to);return this.request({protocolName:kr,requestData:{groupID:n,topicID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Be.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n));var i=qt(e.to);return this.request({protocolName:Er,requestData:{groupID:i,topicID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._topicMap.clear(),this._getTopicTimeMap.clear(),this.TOPIC_CACHE_TIME=300,this.TOPIC_LAST_ACTIVE_TIME=3600}}]),r}(ci),za=function(){function e(t){i(this,e),this._userModule=t,this._n="ProfileHandler",this.TAG="profile",this.accountProfileMap=new Map,this.expirationTime=864e5}return o(e,[{key:"setExpirationTime",value:function(e){this.expirationTime=e}},{key:"getUserProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getUserProfile"),i=e.userIDList;e.fromAccount=this._userModule.getMyAccount(),i.length>100&&(Be.w("".concat(n," ").concat(zt(100))),i.length=100);for(var r,o=[],a=[],s=0,c=i.length;s<c;s++)r=i[s],this._userModule.isMyFriend(r)&&this._contains(r)?a.push(this._getProfileFromMap(r)):o.push(r);if(0===o.length)return Jo(a);e.toAccount=o;var u=e.bFromGetMyProfile||!1,l=[];e.toAccount.forEach((function(e){l.push({toAccount:e,standardSequence:0,customSequence:0})})),e.userItem=l;var d=new wo("getUserProfile");return d.setMessage(i.length>5?"userIDList.length:".concat(i.length):"userIDList:".concat(i)),this._userModule.request({protocolName:vi,requestData:e}).then((function(e){d.setNetworkType(t._userModule.getNetworkType()).end(),Be.i("".concat(n," ok"));var i=t._handleResponse(e).concat(a);return zo(u?i[0]:i)})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];d.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"getMyProfile",value:function(){var e=this._userModule.getMyAccount(),t="".concat(this._n,".getMyProfile");if(Be.l("".concat(t," myAccount:").concat(e)),this._fill(),this._contains(e)){var n=this._getProfileFromMap(e);return Be.d("".concat(t," from cache, myProfile:").concat(JSON.stringify(n))),Jo(n)}return this.getUserProfile({fromAccount:e,userIDList:[e],bFromGetMyProfile:!0})}},{key:"_handleResponse",value:function(e){var t=e.data.userProfileItem;if(!at(t))return[];for(var n=[],i=Date.now(),r=0,o=t.length;r<o;r++){var a=t[r],s=a.to,c=a.profileItem;if("@TLS#NOT_FOUND"!==s&&""!==s){var u=this._update(s,this._getLatestProfileFromResponse(s,c)).latestProfile;n.push(u)}}return Be.l("".concat(this._n,"._handleResponse cost ").concat(Date.now()-i," ms")),n}},{key:"_getLatestProfileFromResponse",value:function(e,t){var n={userID:e,profileCustomField:[]};if(!$t(t))for(var i=0,r=t.length;i<r;i++)if(t[i].tag.indexOf("Tag_Profile_Custom")>-1)n.profileCustomField.push({key:t[i].tag,value:t[i].value});else switch(t[i].tag){case je.NICK:n.nick=t[i].value;break;case je.GENDER:n.gender=t[i].value;break;case je.BIRTHDAY:n.birthday=t[i].value;break;case je.LOCATION:n.location=t[i].value;break;case je.SELFSIGNATURE:n.selfSignature=t[i].value;break;case je.ALLOWTYPE:n.allowType=t[i].value;break;case je.LANGUAGE:n.language=t[i].value;break;case je.AVATAR:n.avatar=t[i].value;break;case je.MESSAGESETTINGS:n.messageSettings=t[i].value;break;case je.ADMINFORBIDTYPE:n.adminForbidType=t[i].value;break;case je.LEVEL:n.level=t[i].value;break;case je.ROLE:n.role=t[i].value;break;default:Be.w("".concat(this._n,"._getLatestProfileFromResponse unknown tag:"),t[i].tag,t[i].value)}return n}},{key:"updateMyProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateMyProfile");if(e.nick&&!1===this._userModule.filterProfanity("nick",e))return Xo({code:fo.PROFANITY_FOUND});if(e.selfSignature&&!1===this._userModule.filterProfanity("selfSignature",e))return Xo({code:fo.PROFANITY_FOUND});var i=new wo("updateMyProfile");i.setMessage(JSON.stringify(e));var r=(new la).validate(e);if(!r.valid)return i.setCode(fo.UPDATE_PROFILE_INVALID_PARAM).setMoreMessage("info:".concat(r.tips)).setNetworkType(this._userModule.getNetworkType()).end(),Be.e("".concat(n," info:").concat(r.tips)),Xo({code:fo.UPDATE_PROFILE_INVALID_PARAM});var o=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&("profileCustomField"===a?e.profileCustomField.forEach((function(e){o.push({tag:e.key,value:e.value})})):o.push({tag:je[a.toUpperCase()],value:e[a]}));if(0===o.length){var s=new Wo({code:fo.UPDATE_PROFILE_NO_KEY});return i.setError(s,!0,this._userModule.getNetworkType()).end(),Be.e("".concat(n," failed. error:"),s),Xo(s)}var c=this._userModule.getMyAccount();return this._userModule.request({protocolName:_i,requestData:{fromAccount:c,profileItem:o}}).then((function(r){i.setNetworkType(t._userModule.getNetworkType()).end(),Be.i("".concat(n," ok"));var o=t._update(c,e),a=o.isProfileUpdated,s=o.latestProfile;return!0===a&&t._userModule.emitOuterEvent(k.PROFILE_UPDATED,[s]),Jo(s)})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"onProfileModified",value:function(e){var t=e.dataList;if(!$t(t)){var n,i=t.length;Be.d("".concat(this._n,".onProfileModified count:").concat(i," dataList:"),e.dataList);for(var r=[],o=0;o<i;o++){n=t[o].userID;var a=this._update(n,this._getLatestProfileFromResponse(n,t[o].profileList)),s=a.isProfileUpdated,c=a.latestProfile;!0===s&&r.push(c)}r.length>0&&(this._userModule.emitInnerEvent(na,r),this._userModule.emitOuterEvent(k.PROFILE_UPDATED,r))}}},{key:"_fill",value:function(){if(0===this.accountProfileMap.size){for(var e=this._getCachedProfiles(),t=Date.now(),n=0,i=e.length;n<i;n++)t-e[n].lastUpdatedTime<this.expirationTime&&this.accountProfileMap.set(e[n].userID,e[n]);Be.l("".concat(this._n,"._fill from cache, size:").concat(this.accountProfileMap.size))}}},{key:"_update",value:function(e,t){var n,i=!1,r=Date.now();return this._contains(e)?(n=this._getProfileFromMap(e),t.profileCustomField&&!0===Ct(n.profileCustomField,t.profileCustomField)&&(n.lastUpdatedTime=r,i=!0),ht(n,t,["profileCustomField"])>0&&(n.lastUpdatedTime=r,i=!0)):(n=new la(t),(this._userModule.isMyFriend(e)||e===this._userModule.getMyAccount())&&(n.lastUpdatedTime=r,i=!0,this.accountProfileMap.set(e,n))),this._flush(e===this._userModule.getMyAccount()),Be.l("".concat(this._n,"._update account:").concat(e," isProfileUpdated:").concat(i)),{isProfileUpdated:i,latestProfile:n}}},{key:"_flush",value:function(e){var t=_(this.accountProfileMap.values()),n=this._userModule.getStorageModule();Be.d("".concat(this._n,"._flush length:").concat(t.length," flushAtOnce:").concat(e)),n.setItem(this.TAG,t,e)}},{key:"_contains",value:function(e){return this.accountProfileMap.has(e)}},{key:"_getProfileFromMap",value:function(e){return this.accountProfileMap.get(e)}},{key:"_getCachedProfiles",value:function(){var e=this._userModule.getStorageModule().getItem(this.TAG);return $t(e)?[]:e}},{key:"onConversationsProfileUpdated",value:function(e){for(var t,n,i,r=[],o=0,a=e.length;o<a;o++)n=(t=e[o]).userID,this._userModule.isMyFriend(n)||(this._contains(n)?(i=this._getProfileFromMap(n),ht(i,t)>0&&r.push(n)):r.push(t.userID));0!==r.length&&(Be.i("".concat(this._n,".onConversationsProfileUpdated toAccountList:").concat(r)),this.getUserProfile({userIDList:r}))}},{key:"getNickAndAvatarByUserID",value:function(e){if(this._contains(e)){var t=this._getProfileFromMap(e);return{nick:t.nick,avatar:t.avatar}}return{nick:"",avatar:""}}},{key:"reset",value:function(){this._flush(!0),this.accountProfileMap.clear()}}]),e}(),Wa=o((function e(t){i(this,e),$t||(this.userID=t.userID||"",this.timeStamp=t.timeStamp||0)})),Ya=function(){function e(t){i(this,e),this._userModule=t,this._n="BlacklistHandler",this._blacklistMap=new Map,this.startIndex=0,this.maxLimited=100,this.currentSequence=0}return o(e,[{key:"getLocalBlacklist",value:function(){return _(this._blacklistMap.keys())}},{key:"getBlacklist",value:function(){var e=this,t="".concat(this._n,".getBlacklist"),n={fromAccount:this._userModule.getMyAccount(),maxLimited:this.maxLimited,startIndex:0,lastSequence:this.currentSequence},i=new wo("getBlacklist");return this._userModule.request({protocolName:yi,requestData:n}).then((function(n){var r=n.data,o=r.blackListItem,a=r.currentSequence,s=$t(o)?0:o.length;i.setNetworkType(e._userModule.getNetworkType()).setMessage("count:".concat(s)).end(),Be.i("".concat(t," ok")),e.currentSequence=a,e._handleResponse(o,!0),e._userModule.emitOuterEvent(k.BLACKLIST_UPDATED,_(e._blacklistMap.keys()))})).catch((function(n){return e._userModule.probeNetwork().then((function(e){var t=v(e,2),r=t[0],o=t[1];i.setError(n,r,o).end()})),Be.e("".concat(t," failed. error:"),n),Xo(n)}))}},{key:"addBlacklist",value:function(e){var t=this,n=new wo("addToBlacklist"),i="".concat(this._n,".addBlacklist"),r=this._userModule.getMyAccount();if(1===e.userIDList.length&&e.userIDList[0]===r){var o=fo.CANNOT_ADD_SELF_TO_BLACKLIST,a=this._userModule.getErrorMessage(o);n.setCode(o).setMessage(a).setNetworkType(this._userModule.getNetworkType()).end();var s=new Wo({code:o});return Be.e("".concat(i," failed. error:"),s),Xo(s)}return e.userIDList.includes(r)&&(e.userIDList=e.userIDList.filter((function(e){return e!==r}))),e.fromAccount=this._userModule.getMyAccount(),e.toAccount=e.userIDList,this._userModule.request({protocolName:Ii,requestData:e}).then((function(r){return n.setNetworkType(t._userModule.getNetworkType()).setMessage(e.userIDList.length>5?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),Be.i("".concat(i," ok")),t._handleResponse(r.resultItem,!0),zo(_(t._blacklistMap.keys()))})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var i=v(t,2),r=i[0],o=i[1];n.setError(e,r,o).end()})),Be.e("".concat(i," failed. error:"),e),Xo(e)}))}},{key:"_handleResponse",value:function(e,t){if(!$t(e))for(var n,i,r,o=0,a=e.length;o<a;o++)i=e[o].to,r=e[o].resultCode,(st(r)||0===r)&&(t?((n=this._blacklistMap.has(i)?this._blacklistMap.get(i):new Wa).userID=i,!$t(e[o].addBlackTimeStamp)&&(n.timeStamp=e[o].addBlackTimeStamp),this._blacklistMap.set(i,n)):this._blacklistMap.has(i)&&(n=this._blacklistMap.get(i),this._blacklistMap.delete(i)));Be.l("".concat(this._n,"._handleResponse total:").concat(this._blacklistMap.size," bAdd:").concat(t))}},{key:"deleteBlacklist",value:function(e){var t=this,n="".concat(this._n,".deleteBlacklist"),i=new wo("removeFromBlacklist");return e.fromAccount=this._userModule.getMyAccount(),e.toAccount=e.userIDList,this._userModule.request({protocolName:Mi,requestData:e}).then((function(r){return i.setNetworkType(t._userModule.getNetworkType()).setMessage(e.userIDList.length>5?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),Be.i("".concat(n," ok")),t._handleResponse(r.data.resultItem,!1),zo(_(t._blacklistMap.keys()))})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"onAccountDeleted",value:function(e){for(var t,n=[],i=0,r=e.length;i<r;i++)t=e[i],this._blacklistMap.has(t)&&(this._blacklistMap.delete(t),n.push(t));n.length>0&&(Be.l("".concat(this._n,".onAccountDeleted count:").concat(n.length," userIDList:"),n),this._userModule.emitOuterEvent(k.BLACKLIST_UPDATED,_(this._blacklistMap.keys())))}},{key:"onAccountAdded",value:function(e){for(var t,n=[],i=0,r=e.length;i<r;i++)t=e[i],this._blacklistMap.has(t)||(this._blacklistMap.set(t,new Wa({userID:t})),n.push(t));n.length>0&&(Be.l("".concat(this._n,".onAccountAdded count:").concat(n.length," userIDList:"),n),this._userModule.emitOuterEvent(k.BLACKLIST_UPDATED,_(this._blacklistMap.keys())))}},{key:"reset",value:function(){this._blacklistMap.clear(),this.startIndex=0,this.maxLimited=100,this.currentSequence=0}}]),e}(),$a=function(e){var t=String(e).replace(/[=]+$/,""),n="";if(t.length%4==1)return"";for(var i,r,o=0,a=0;r=t.charAt(a++);~r&&(i=o%4?64*i+r:r,o++%4)?n+=String.fromCharCode(255&i>>(-2*o&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);try{return decodeURIComponent(escape(n))}catch(s){return""}},Ja=function(){function e(t){i(this,e),this._userModule=t,this._n="UserStatusHandler",this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100,this._userModule.getInnerEmitterInstance().on(ta,this._onCloudConfigUpdated,this)}return o(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this._userModule.getCloudConfig("status_query_count"),t=this._userModule.getCloudConfig("status_sub_count"),n=this._userModule.getCloudConfig("status_unsub_count");Be.l("".concat(this._n,"._onCloudConfigUpdated statusQueryCount:").concat(e," statusSubscribeCount:").concat(t)+" statusUnsubscribeCount:".concat(n)),st(e)||(this.MAX_QUERY_USER_COUNT=parseInt(e,10)),st(e)||(this.MAX_SUBSCRIBE_USER_COUNT=parseInt(t,10)),st(e)||(this.MAX_UNSUBSCRIBE_USER_COUNT=parseInt(n,10))}},{key:"onUserStatusUpdated",value:function(e){var t=e.dataList,n=this._userModule.getMyUserID(),i=this._userModule.getModule(qn),r=t.map((function(e){var t=e.to,r=e.statusType,o=e.customStatus,a=$a(o);return t===n&&i.setCustomStatus(a),{userID:t,statusType:r,customStatus:a}}));this._userModule.emitOuterEvent(k.USER_STATUS_UPDATED,r)}},{key:"setSelfStatus",value:function(e){var t=this,n="".concat(this._n,".setSelfStatus");if(!1===this._userModule.filterProfanity("customStatus",e))return Xo({code:fo.PROFANITY_FOUND});var i=new wo("setSelfStatus"),r=e.customStatus;return this._userModule.request({protocolName:ro,requestData:{customStatus:r}}).then((function(e){return i.setNetworkType(t._userModule.getNetworkType()).setMessage("customStatus:".concat(r)).end(),Be.l("".concat(n," ok. customStatus:").concat(r)),t._userModule.getModule(qn).setCustomStatus(r),zo({userID:t._userModule.getMyUserID(),statusType:1,customStatus:r})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"getUserStatus",value:function(e){var t=this,n="".concat(this._n,".getUserStatus"),i=e.userIDList,r=void 0===i?[]:i,o=this._userModule.getMyUserID(),a=_(r),s=void 0,c=a.indexOf(o);if(c>-1){a.splice(c,1);var u=this._userModule.getModule(qn).getCustomStatus();s={userID:o,statusType:1,customStatus:u}}if(0===a.length)return Jo({successUserList:[s],failureUserList:[]});if(!this._userModule.canIUse(H.USER_STATUS))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});a.length>this.MAX_QUERY_USER_COUNT&&(Be.w("".concat(n," ").concat(zt(this.MAX_QUERY_USER_COUNT))),a=r.slice(0,this.MAX_QUERY_USER_COUNT));var l=new wo("getUserStatus");return this._userModule.request({protocolName:oo,requestData:{userIDList:a}}).then((function(e){var i=e.data,o=i.successUserList,a=void 0===o?[]:o,c=i.failureUserList,u=void 0===c?[]:c,d=a.map((function(e){var t=e.userID,n=e.statusType,i=e.customStatus;return{userID:t,statusType:n,customStatus:$a(i)}})),p=u.map((function(e){var t=e.userID,n=e.invalidUserID,i=e.errorCode,r=e.errorInfo;return{userID:$t(n)?t:n,code:i,message:r}}));st(s)||d.unshift(s);var h="userID count:".concat(r.length,", success count:").concat(d.length,", fail count:").concat(p.length);return l.setNetworkType(t._userModule.getNetworkType()).setMessage("".concat(h)).end(),Be.l("".concat(n," ok. ").concat(h,".")),zo({successUserList:d,failureUserList:p})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],o=n[1];l.setMessage("userID count:".concat(r.length)).setError(e,i,o).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"subscribeUserStatus",value:function(e){var t=this;if(!this._userModule.canIUse(H.USER_STATUS))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".subscribeUserStatus"),i=e.userIDList,r=void 0===i?[]:i,o=_(r);o.length>this.MAX_SUBSCRIBE_USER_COUNT&&(Be.w("".concat(n," ").concat(zt(this.MAX_SUBSCRIBE_USER_COUNT))),o=r.slice(0,this.MAX_SUBSCRIBE_USER_COUNT));var a=new wo("subscribeUserStatus"),s="userID count:".concat(r.length);return Be.l("".concat(n," ").concat(s)),this._userModule.request({protocolName:ao,requestData:{userIDList:o}}).then((function(e){var i=e.data.failureUserList,r=(void 0===i?[]:i).map((function(e){var t=e.userID,n=e.invalidUserID,i=e.errorCode,r=e.errorInfo;return{userID:$t(n)?t:n,code:i,message:r}}));return a.setNetworkType(t._userModule.getNetworkType()).setMessage("".concat(s," fail count:").concat(r.length)).end(),Be.l("".concat(n," ok. fail count:").concat(r.length,".")),zo({failureUserList:r})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setMessage("".concat(s)).setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"unsubscribeUserStatus",value:function(e){var t=this;if(!this._userModule.canIUse(H.USER_STATUS))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".unsubscribeUserStatus"),i=(e||{}).userIDList,r=void 0===i?[]:i,o=_(r);r.length>this.MAX_UNSUBSCRIBE_USER_COUNT&&(Be.w("".concat(n," ").concat(zt(this.MAX_UNSUBSCRIBE_USER_COUNT))),o=r.slice(0,this.MAX_UNSUBSCRIBE_USER_COUNT));var a=new wo("unsubscribeUserStatus"),s="userID count:".concat(r.length);Be.l("".concat(n," ").concat(s));var c={userIDList:o};return 0===o.length&&(c.userIDList=void 0,c.unsubscribeAll=1),this._userModule.request({protocolName:so,requestData:c}).then((function(e){var i=e.data.failureUserList,r=(void 0===i?[]:i).map((function(e){var t=e.userID,n=e.invalidUserID,i=e.errorCode,r=e.errorInfo;return{userID:$t(n)?t:n,code:i,message:r}}));return a.setNetworkType(t._userModule.getNetworkType()).setMessage("".concat(s," fail count:").concat(r.length)).end(),Be.l("".concat(n," ok. fail count:").concat(r.length,".")),zo({failureUserList:r})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setMessage("".concat(s)).setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"reset",value:function(){this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100}}]),e}(),Xa=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="UserModule",r._profileHandler=new za(f(r)),r._blacklistHandler=new Ya(f(r)),r._userStatusHandler=new Ja(f(r)),r.getInnerEmitterInstance().on(ea,r.onContextUpdated,f(r)),r}return o(n,[{key:"onContextUpdated",value:function(e){this._profileHandler.getMyProfile(),this._blacklistHandler.getBlacklist()}},{key:"onProfileModified",value:function(e){this._profileHandler.onProfileModified(e)}},{key:"onRelationChainModified",value:function(e){var t=e.dataList;if(!$t(t)){var n=[];t.forEach((function(e){e.blackListDelAccount&&n.push.apply(n,_(e.blackListDelAccount))})),n.length>0&&this._blacklistHandler.onAccountDeleted(n);var i=[];t.forEach((function(e){e.blackListAddAccount&&i.push.apply(i,_(e.blackListAddAccount))})),i.length>0&&this._blacklistHandler.onAccountAdded(i)}}},{key:"onConversationsProfileUpdated",value:function(e){this._profileHandler.onConversationsProfileUpdated(e)}},{key:"getMyAccount",value:function(){return this.getMyUserID()}},{key:"getMyProfile",value:function(){return this._profileHandler.getMyProfile()}},{key:"getStorageModule",value:function(){return this.getModule(Bn)}},{key:"filterProfanity",value:function(e,t){var n=this.getModule(ri);if(!n)return!0;var i=n.filterText(t[e],Y),r=i.isAllowedToSend,o=i.modifiedText;return!0===r&&(t[e]=o,!0)}},{key:"isMyFriend",value:function(e){var t=this.getModule(xn);return!!t&&t.isMyFriend(e)}},{key:"getUserProfile",value:function(e){return this._profileHandler.getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._profileHandler.updateMyProfile(e)}},{key:"getNickAndAvatarByUserID",value:function(e){return this._profileHandler.getNickAndAvatarByUserID(e)}},{key:"getLocalBlacklist",value:function(){var e=this._blacklistHandler.getLocalBlacklist();return Jo(e)}},{key:"addBlacklist",value:function(e){return this._blacklistHandler.addBlacklist(e)}},{key:"deleteBlacklist",value:function(e){return this._blacklistHandler.deleteBlacklist(e)}},{key:"onUserStatusUpdated",value:function(e){this._userStatusHandler.onUserStatusUpdated(e)}},{key:"setSelfStatus",value:function(e){return this._userStatusHandler.setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._userStatusHandler.getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._userStatusHandler.subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._userStatusHandler.unsubscribeUserStatus(e)}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._profileHandler.reset(),this._blacklistHandler.reset(),this._userStatusHandler.reset()}}]),n}(ci),Za=function(){function e(t,n){i(this,e),this._m=t,this._isLoggedIn=!1,this._SDKAppID=n.SDKAppID,this._userID=n.userID||"",this._userSig=n.userSig||"",this._version="2.27.1",this._a2Key="",this._tinyID="",this._customStatus="",this._contentType="json",this._unlimitedAVChatRoom=n.unlimitedAVChatRoom,this._scene=n.scene||"",this._oversea=n.oversea,this._instanceID=n.instanceID,this._statusInstanceID=0,this._isDevMode=n.devMode,this._proxyServer=n.proxyServer,this._fileUploadProxy=n.fileUploadProxy,this._fileDownloadProxy=n.fileDownloadProxy}return o(e,[{key:"isLoggedIn",value:function(){return this._isLoggedIn}},{key:"isOversea",value:function(){return this._oversea}},{key:"isPrivateNetWork",value:function(){return this._proxyServer}},{key:"isDevMode",value:function(){return this._isDevMode}},{key:"isSingaporeSite",value:function(){return this._SDKAppID>=2e7&&this._SDKAppID<3e7||this._SDKAppID>=172e7&&this._SDKAppID<173e7}},{key:"isKoreaSite",value:function(){return this._SDKAppID>=3e7&&this._SDKAppID<4e7||this._SDKAppID>=173e7&&this._SDKAppID<174e7}},{key:"isGermanySite",value:function(){return this._SDKAppID>=4e7&&this._SDKAppID<5e7||this._SDKAppID>=174e7&&this._SDKAppID<175e7}},{key:"isIndiaSite",value:function(){return this._SDKAppID>=5e7&&this._SDKAppID<6e7||this._SDKAppID>=175e7&&this._SDKAppID<176e7}},{key:"isJapanSite",value:function(){return this._SDKAppID>=6e7&&this._SDKAppID<7e7||this._SDKAppID>=176e7&&this._SDKAppID<177e7}},{key:"isUSASite",value:function(){return this._SDKAppID>=7e7&&this._SDKAppID<8e7||this._SDKAppID>=177e7&&this._SDKAppID<178e7}},{key:"isIntl",value:function(){return 0===(e=this._SDKAppID)||e>=2e7&&e<8e7||e>=172e7&&e<178e7;var e}},{key:"isUnlimitedAVChatRoom",value:function(){return this._unlimitedAVChatRoom}},{key:"setUserID",value:function(e){this._userID=e}},{key:"getUserID",value:function(){return this._userID}},{key:"setUserSig",value:function(e){this._userSig=e}},{key:"getUserSig",value:function(){return this._userSig}},{key:"getSDKAppID",value:function(){return this._SDKAppID}},{key:"setTinyID",value:function(e){this._tinyID=e,this._isLoggedIn=!0}},{key:"getTinyID",value:function(){return this._tinyID}},{key:"setCustomStatus",value:function(e){this._customStatus=e}},{key:"getCustomStatus",value:function(){return this._customStatus}},{key:"getScene",value:function(){return Ae?window.tencent_cloud_im_csig_flutter_for_web_25F_cy:this._isTUIKit()?"tuikit":this._scene}},{key:"getInstanceID",value:function(){return this._instanceID}},{key:"getStatusInstanceID",value:function(){return this._statusInstanceID}},{key:"setStatusInstanceID",value:function(e){this._statusInstanceID=e}},{key:"getVersion",value:function(){return this._version}},{key:"getA2Key",value:function(){return this._a2Key}},{key:"setA2Key",value:function(e){this._a2Key=e}},{key:"getContentType",value:function(){return this._contentType}},{key:"getProxyServer",value:function(){return this._proxyServer}},{key:"getFileUploadProxy",value:function(){return this._fileUploadProxy}},{key:"getFileDownloadProxy",value:function(){return this._fileDownloadProxy}},{key:"_isTUIKit",value:function(){var e=!1,t=!1,n=!1,i=!1,r=[];oe&&(r=Object.keys(se)),ae&&(r=re?Object.keys(uni):Object.keys(window));for(var o=0,a=r.length;o<a;o++)if(r[o].toLowerCase().includes("uikit")){e=!0;break}if(r=null,oe&&!ut(se.createGamePortal)&&ut(getApp)&&!st(getApp())){var s=getApp().globalData;ot(s)&&!0===s.isTUIKit&&(t=!0)}!0===this._m.getModule(Bn).getStorageSync("TIM_".concat(this._SDKAppID,"_isTUIKit"))&&(n=!0);var c=null;if(X&&!Q&&"undefined"==typeof uni&&__wxConfig&&(c=__wxConfig.pages),Z&&"undefined"==typeof uni&&__qqConfig&&(c=__qqConfig.pages),at(c)&&c.length>0){for(var u=0,l=c.length;u<l;u++)if(c[u].toLowerCase().includes("tui")){i=!0;break}c=null}return e||t||n||i}},{key:"reset",value:function(){this._isLoggedIn=!1,this._userSig="",this._a2Key="",this._tinyID="",this._customStatus="",this._statusInstanceID=0}}]),e}(),Qa=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="SignModule",r._helloInterval=120,r._lastLoginTs=0,r._lastWsHelloTs=0,r._isWebUniapp=0,ia.mixin(f(r)),r}return o(n,[{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this._helloInterval==0&&this._hello()}},{key:"login",value:function(e){var t="";if(this.isLoggedIn()){var n=this.getMyUserID();return(t=this.getErrorMessage("RepeatLogin",n))&&Be.w(t),Jo({actionStatus:"OK",errorCode:0,errorInfo:t,repeatLogin:!0})}if(Date.now()-this._lastLoginTs<=15e3)return this.outputWarning("LoggingIn",e.userID),Xo({code:fo.REPEAT_LOGIN});Be.l("".concat(this._n,".login userID:").concat(e.userID));var i=this._checkLoginInfo(e);if(0!==i.code)return Xo(i);var r=this.getModule(qn),o=e.userID,a=e.userSig;return r.setUserID(o),r.setUserSig(a),this.getModule($n).updateProtocolConfig(),this._login()}},{key:"_login",value:function(){var e=this,t=this.getModule(qn),n=t.getScene(),i=0,r=new wo("login");r.setMessage("".concat(n)).setMoreMessage("identifier:".concat(this.getMyUserID())),re?"tuikit"===n?r.setUIPlatform(4):r.setUIPlatform(3):oe?"tuikit"===n?r.setUIPlatform(12):r.setUIPlatform(11):ae&&(Ae?"flutter_web_uikit"===n?r.setUIPlatform(21):r.setUIPlatform(20):this._isReactUIKit()?we?r.setUIPlatform(25):r.setUIPlatform(24):we?"tuikit"===n?r.setUIPlatform(17):r.setUIPlatform(16):"tuikit"===n?r.setUIPlatform(14):r.setUIPlatform(13));var o=this.getModule(ii);if(o.canIUseOfflinePush()){this._isWebUniapp=o.getUniAppPlatform();var a=this._getStatusInstanceID();t.setStatusInstanceID(a),this.getModule($n).updateProtocolConfig(),i=o.getDeviceBrand()}var s="".concat(this._n,"._login");return this._lastLoginTs=Date.now(),this.request({protocolName:ui,requestData:{deviceBrand:i,isWebUniapp:this._isWebUniapp}}).then((function(i){e._lastLoginTs=0;var o=Date.now(),a=null,c=i.data,u=c.a2Key,l=c.tinyID,d=c.helloInterval,p=c.instanceID,h=c.timeStamp,f=c.customStatus,g=void 0===f?"":f;Be.l("".concat(s," ok. scene:").concat(n," helloInterval:").concat(d," instanceID:").concat(p," timeStamp:").concat(h));var m=1e3*h,v=o-r.getStartTs(),_=m+parseInt(v/2)-o,y=r.getStartTs()+_;if(r.start(y),function(e,t){Pe=t;var n=new Date;n.setTime(e),Be.i("baseTime from server:".concat(n," offset:").concat(Pe))}(m,_),!l)throw a=new Wo({code:fo.NO_TINYID}),r.setError(a,!0,e.getNetworkType()).end(),a;if(!u)throw a=new Wo({code:fo.NO_A2KEY}),r.setError(a,!0,e.getNetworkType()).end(),a;var I=$a(g);r.setNetworkType(e.getNetworkType()).setMoreMessage("helloInterval:".concat(d," instanceID:").concat(p," offset:").concat(_," customStatus:").concat(I)).end(),t.setA2Key(u),t.setTinyID(l),t.setStatusInstanceID(p),t.setCustomStatus(I),e.getModule($n).updateProtocolConfig(),e.emitInnerEvent(ea),e._helloInterval=d,e.triggerReady();var M=e.getModule(ii);return M.canIUseOfflinePush()&&(uni.setStorageSync("timUniAppInstanceID",p),M.init()),e._fetchCloudControlConfig(),e.getModule(ri).init(),i})).catch((function(t){return e.probeNetwork().then((function(e){var n=v(e,2),i=n[0],o=n[1];r.setError(t,i,o).end(!0)})),e._m.setNotReadyReason(fo.LOGIN_FAILED),Be.e("".concat(s," failed. error:"),t),e._lastLoginTs=0,e._m.onLoginFailed(),Xo(t)}))}},{key:"logout",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this.isLoggedIn())return Xo({code:fo.USER_NOT_LOGGED_IN});new wo("logout").setNetworkType(this.getNetworkType()).setMessage("identifier:".concat(this.getMyUserID())).end(!0);var n="".concat(this._n,".logout");return Be.i("".concat(n," type:").concat(t)),0===t&&this._m.setNotReadyReason(fo.LOGGED_OUT),this.request({protocolName:li,requestData:{type:t}}).then((function(){return e.resetReady(),Jo({})})).catch((function(t){return Be.e("".concat(n," error:"),t),e.resetReady(),Jo({})}))}},{key:"_fetchCloudControlConfig",value:function(){this.getModule(Zn).fetchConfig()}},{key:"_getStatusInstanceID",value:function(){return uni.getStorageSync("timUniAppInstanceID")}},{key:"_hello",value:function(){var e=this;this._lastWsHelloTs=Date.now(),this.request({protocolName:di,requestData:{isWebUniapp:this._isWebUniapp}}).catch((function(t){Be.w("".concat(e._n,"._hello error:"),t)}))}},{key:"getLastWsHelloTs",value:function(){return this._lastWsHelloTs}},{key:"_checkLoginInfo",value:function(e){var t=0;return $t(this.getModule(qn).getSDKAppID())?t=fo.NO_SDKAPPID:$t(e.userID)?t=fo.NO_IDENTIFIER:$t(e.userSig)&&(t=fo.NO_USERSIG),{code:t}}},{key:"_isReactUIKit",value:function(){return ae&&void 0!==window.tencent_cloud_im_csig_react_uikit_23F_xa}},{key:"onMultipleAccountKickedOut",value:function(e){var t=this;new wo("kickedOut").setNetworkType(this.getNetworkType()).setMessage("type:".concat(b.KICKED_OUT_MULT_ACCOUNT," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Be.w("".concat(this._n,".onMultipleAccountKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then((function(){t.emitOuterEvent(k.KICKED_OUT,{type:b.KICKED_OUT_MULT_ACCOUNT}),t._m.setNotReadyReason(fo.KICKED_OUT_MULT_ACCOUNT),t._m.reset()}))}},{key:"onMultipleDeviceKickedOut",value:function(e){var t=this;new wo("kickedOut").setNetworkType(this.getNetworkType()).setMessage("type:".concat(b.KICKED_OUT_MULT_DEVICE," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Be.w("".concat(this._n,".onMultipleDeviceKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then((function(){t.emitOuterEvent(k.KICKED_OUT,{type:b.KICKED_OUT_MULT_DEVICE}),t._m.setNotReadyReason(fo.KICKED_OUT_MULT_DEVICE),t._m.reset()}))}},{key:"onUserSigExpired",value:function(){new wo("kickedOut").setNetworkType(this.getNetworkType()).setMessage(b.KICKED_OUT_USERSIG_EXPIRED).end(!0),Be.w("".concat(this._n,".onUserSigExpired: userSig expired")),0!==this.getModule(qn).getStatusInstanceID()&&(this.emitOuterEvent(k.KICKED_OUT,{type:b.KICKED_OUT_USERSIG_EXPIRED}),this._m.setNotReadyReason(fo.KICKED_OUT_USERSIG_EXPIRED),this._m.reset())}},{key:"onRestApiKickedOut",value:function(e){new wo("kickedOut").setNetworkType(this.getNetworkType()).setMessage("type:".concat(b.KICKED_OUT_REST_API," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Be.w("".concat(this._n,".onRestApiKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),0!==this.getModule(qn).getStatusInstanceID()&&(this.emitOuterEvent(k.KICKED_OUT,{type:b.KICKED_OUT_REST_API}),this._m.setNotReadyReason(fo.KICKED_OUT_REST_API),this._m.reset(),this.getModule(Jn).onRestApiKickedOut())}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this.resetReady(),this._helloInterval=120,this._lastLoginTs=0,this._lastWsHelloTs=0,this._isWebUniapp=0}}]),n}(ci);function es(){return null}var ts=function(){function e(t){i(this,e),this._m=t,this._n="StorageModule",this._storageQueue=new Map,this._errorTolerantHandle()}return o(e,[{key:"_errorTolerantHandle",value:function(){oe||!st(window)&&this._canIUseCookies()||(this.getItem=es,this.setItem=es,this.removeItem=es,this.clear=es)}},{key:"onCheckTimer",value:function(e){if(e%20==0){if(0===this._storageQueue.size)return;this._doFlush()}}},{key:"_doFlush",value:function(){try{var e,t=E(this._storageQueue);try{for(t.s();!(e=t.n()).done;){var n=v(e.value,2),i=n[0],r=n[1];this._setStorageSync(this._getKey(i),r)}}catch(o){t.e(o)}finally{t.f()}this._storageQueue.clear()}catch(a){Be.w("".concat(this._n,"._doFlush error:"),a)}}},{key:"_getPrefix",value:function(){var e=this._m.getModule(qn);return"TIM_".concat(e.getSDKAppID(),"_").concat(e.getUserID(),"_")}},{key:"_getKey",value:function(e){return"".concat(this._getPrefix()).concat(e)}},{key:"getItem",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;return this.getStorageSync(n)}catch(i){return Be.w("".concat(this._n,".getItem error:"),i),{}}}},{key:"setItem",value:function(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]){var n=arguments.length>3&&void 0!==arguments[3]&&!arguments[3]?e:this._getKey(e);this._setStorageSync(n,t)}else this._storageQueue.set(e,t)}},{key:"clear",value:function(){try{oe?se.clearStorageSync():this._canIUseCookies()&&localStorage.clear()}catch(e){Be.w("".concat(this._n,".clear error:"),e)}}},{key:"removeItem",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;this._removeStorageSync(n)}catch(i){Be.w("".concat(this._n,".removeItem error:"),i)}}},{key:"getSize",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"b";try{var i={size:0,limitSize:5242880,unit:n};if(Object.defineProperty(i,"leftSize",{enumerable:!0,get:function(){return i.limitSize-i.size}}),oe&&(i.limitSize=1024*se.getStorageInfoSync().limitSize),e)i.size=JSON.stringify(this.getItem(e)).length+this._getKey(e).length;else if(oe)se.getStorageInfoSync().keys.forEach((function(e){i.size+=JSON.stringify(t.getStorageSync(e)).length+t._getKey(e).length}));else if(this._canIUseCookies())for(var r in localStorage)localStorage.hasOwnProperty(r)&&(i.size+=localStorage.getItem(r).length+r.length);return this._convertUnit(i)}catch(o){Be.w("".concat(this._n," error:"),o)}}},{key:"_convertUnit",value:function(e){var t={},n=e.unit;for(var i in t.unit=n,e)"number"==typeof e[i]&&("kb"===n.toLowerCase()?t[i]=Math.round(e[i]/1024):"mb"===n.toLowerCase()?t[i]=Math.round(e[i]/1024/1024):t[i]=e[i]);return t}},{key:"_setStorageSync",value:function(e,t){oe?te?my.setStorageSync({key:e,data:t}):se.setStorageSync(e,t):this._canIUseCookies()&&localStorage.setItem(e,JSON.stringify(t))}},{key:"getStorageSync",value:function(e){return oe?te?my.getStorageSync({key:e}).data:se.getStorageSync(e):this._canIUseCookies()?JSON.parse(localStorage.getItem(e)):{}}},{key:"_removeStorageSync",value:function(e){oe?te?my.removeStorageSync({key:e}):se.removeStorageSync(e):this._canIUseCookies()&&localStorage.removeItem(e)}},{key:"_canIUseCookies",value:function(){return navigator&&navigator.cookieEnabled&&localStorage}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._doFlush()}}]),e}(),ns=function(){function e(t){i(this,e),this._n="SSOLogBody",this._report=[]}return o(e,[{key:"pushIn",value:function(e){Be.d("".concat(this._n,".pushIn"),this._report.length,e),this._report.push(e)}},{key:"backfill",value:function(e){var t;at(e)&&0!==e.length&&(Be.d("".concat(this._n,".backfill"),this._report.length,e.length),(t=this._report).unshift.apply(t,_(e)))}},{key:"getLogsNumInMemory",value:function(){return this._report.length}},{key:"isEmpty",value:function(){return 0===this._report.length}},{key:"_reset",value:function(){this._report.length=0,this._report=[]}},{key:"getLogsInMemory",value:function(){var e=this._report.slice();return this._reset(),e}}]),e}(),is=function(e){var t=e.getModule(qn);return{SDKType:10,SDKAppID:t.getSDKAppID(),SDKVersion:t.getVersion(),tinyID:Number(t.getTinyID()),userID:t.getUserID(),platform:e.getPlatform(),instanceID:t.getInstanceID(),traceID:Ue()}},rs=function(e){s(r,e);var n=m(r);function r(e){var t;i(this,r),(t=n.call(this,e))._n="EventStatModule",t.TAG="im-ssolog-event",t._reportBody=new ns,t.MIN_THRESHOLD=20,t.MAX_THRESHOLD=100,t.WAITING_TIME=6e4,t.REPORT_LEVEL=[4,5,6],t.REPORT_SDKAPPID_BLACKLIST=[],t.REPORT_TINYID_WHITELIST=[],t._lastReportTime=Date.now();var o=t.getInnerEmitterInstance();return o.on(ea,t._onLoginSuccess,f(t)),o.on(ta,t._onCloudConfigUpdated,f(t)),t}return o(r,[{key:"reportAtOnce",value:function(){Be.d("".concat(this._n,".reportAtOnce")),this._report()}},{key:"_onLoginSuccess",value:function(){var e=this,t=this.getModule(Bn),n=t.getItem(this.TAG,!1);!$t(n)&&ut(n.forEach)&&(Be.l("".concat(this._n,"._onLoginSuccess get ssolog in storage, count:").concat(n.length)),n.forEach((function(t){e._reportBody.pushIn(t)})),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("evt_rpt_threshold"),t=this.getCloudConfig("evt_rpt_waiting"),n=this.getCloudConfig("evt_rpt_level"),i=this.getCloudConfig("evt_rpt_sdkappid_bl"),r=this.getCloudConfig("evt_rpt_tinyid_wl");st(e)||(this.MIN_THRESHOLD=Number(e)),st(t)||(this.WAITING_TIME=Number(t)),st(n)||(this.REPORT_LEVEL=n.split(",").map((function(e){return Number(e)}))),st(i)||(this.REPORT_SDKAPPID_BLACKLIST=i.split(",").map((function(e){return Number(e)}))),st(r)||(this.REPORT_TINYID_WHITELIST=r.split(","))}},{key:"pushIn",value:function(e){e instanceof wo&&(e.updateTimeStamp(),this._reportBody.pushIn(e),this._reportBody.getLogsNumInMemory()>=this.MIN_THRESHOLD&&this._report())}},{key:"onCheckTimer",value:function(){Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()}},{key:"_filterLogs",value:function(e){var t=this,n=this.getModule(qn),i=n.getSDKAppID(),r=n.getTinyID();return Ft(this.REPORT_SDKAPPID_BLACKLIST,i)&&!Vt(this.REPORT_TINYID_WHITELIST,r)?[]:e.filter((function(e){return t.REPORT_LEVEL.includes(e.level)}))}},{key:"_report",value:function(){var e=this;if(!this._reportBody.isEmpty()){var n=this._reportBody.getLogsInMemory(),i=this._filterLogs(n);if(0!==i.length){var r={header:is(this),event:i};this.request({protocolName:qr,requestData:t({},r)}).then((function(){e._lastReportTime=Date.now()})).catch((function(t){Be.w("".concat(e._n,".report failed. networkType:").concat(e.getNetworkType()," error:"),t),e._reportBody.backfill(n),e._reportBody.getLogsNumInMemory()>e.MAX_THRESHOLD&&e._flushAtOnce()}))}else this._lastReportTime=Date.now()}}},{key:"_flushAtOnce",value:function(){var e=this.getModule(Bn),t=e.getItem(this.TAG,!1),n=this._reportBody.getLogsInMemory(),i="".concat(this._n,"._flushAtOnce");if($t(t))Be.l("".concat(i," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1);else{var r=n.concat(t);r.length>this.MAX_THRESHOLD&&(r=r.slice(0,this.MAX_THRESHOLD)),Be.l("".concat(i," count:").concat(r.length)),e.setItem(this.TAG,r,!0,!1)}}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._lastReportTime=0,this._report(),this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[]}}]),r}(ci),os="none",as="online",ss=[fo.OVER_FREQUENCY_LIMIT,fo.OPEN_SERVICE_OVERLOAD_ERROR],cs=function(){function e(t){i(this,e),this._m=t,this._networkType="",this._n="NetMonitorModule",this.MAX_WAIT_TIME=3e3,this._mpNetworkStatusCallback=null,this._webOnlineCallback=null,this._webOfflineCallback=null}return o(e,[{key:"start",value:function(){var e=this;oe?(se.getNetworkType({success:function(t){e._networkType=t.networkType||t.subtype||"",t.networkType===os?Be.w("".concat(e._n,".start no network, please check!")):Be.i("".concat(e._n,".start networkType:").concat(t.networkType))}}),this._mpNetworkStatusCallback=this._onNetworkStatusChange.bind(this),se.onNetworkStatusChange(this._mpNetworkStatusCallback)):(this._networkType=as,this._webOnlineCallback=this._onWebOnline.bind(this),this._webOfflineCallback=this._onWebOffline.bind(this),window&&(window.addEventListener("online",this._webOnlineCallback),window.addEventListener("offline",this._webOfflineCallback)))}},{key:"_onWebOnline",value:function(){this._onNetworkStatusChange({isConnected:!0,networkType:as})}},{key:"_onWebOffline",value:function(){this._onNetworkStatusChange({isConnected:!1,networkType:os})}},{key:"_onNetworkStatusChange",value:function(e){var t=e.isConnected,n=e.networkType,i="".concat(this._n,"._onNetworkStatusChange"),r=!1;t?(Be.i("".concat(i," previous:").concat(this._networkType," current:").concat(n)),this._networkType!==n&&(r=!0,this._m.getModule(Jn).reConnect(!0))):this._networkType!==n&&(r=!0,Be.w("".concat(i," no network, please check!")),this._m.getModule(Jn).offline()),r&&(new wo("networkChange").setMessage("isConnected:".concat(t," previousNetworkType:").concat(this._networkType," networkType:").concat(n)).end(),this._networkType=n)}},{key:"probe",value:function(e){var t=this;if(!st(e)&&ss.includes(e.code))return Promise.resolve([!0,this._networkType]);var n="".concat(this._n,".probe");return new Promise((function(e,i){oe?se.getNetworkType({success:function(i){t._networkType=i.networkType,i.networkType===os?(Be.w("".concat(n," no network, please check!")),e([!1,i.networkType])):(Be.i("".concat(n," networkType:").concat(i.networkType)),e([!0,i.networkType]))}}):t._networkType===os?e([!1,os]):e([!0,as])}))}},{key:"getNetworkType",value:function(){return this._networkType}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),oe?null!==this._mpNetworkStatusCallback&&(se.offNetworkStatusChange&&(ie||Q?se.offNetworkStatusChange(this._mpNetworkStatusCallback):se.offNetworkStatusChange()),this._mpNetworkStatusCallback=null):window&&(null!==this._webOnlineCallback&&(window.removeEventListener("online",this._webOnlineCallback),this._webOnlineCallback=null),null!==this._onWebOffline&&(window.removeEventListener("offline",this._webOfflineCallback),this._webOfflineCallback=null))}}]),e}(),us=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,i,o,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new r(i,o||e,a),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},s.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,o=i.length,a=new Array(o);r<o;r++)a[r]=i[r].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},s.prototype.emit=function(e,t,i,r,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,r),!0;case 5:return l.fn.call(l.context,t,i,r,o),!0;case 6:return l.fn.call(l.context,t,i,r,o,a),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,h=l.length;for(u=0;u<h;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,i);break;case 4:l[u].fn.call(l[u].context,t,i,r);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,i,r){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||r&&!s.once||i&&s.context!==i||a(this,o);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==t||r&&!s[c].once||i&&s[c].context!==i)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s})),ls=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="BigDataChannelModule",r.FILETYPE={SOUND:2106,FILE:2107,VIDEO:2113},r._bdh_download_server="grouptalk.c2c.qq.com",r._BDHBizID=10001,r._authKey="",r._expireTime=0,r.getInnerEmitterInstance().on(ea,r._getAuthKey,f(r)),r}return o(n,[{key:"_getAuthKey",value:function(){var e=this;this.isIntl()||this.request({protocolName:fi}).then((function(t){t.data.authKey&&(e._authKey=t.data.authKey,e._expireTime=parseInt(t.data.expireTime))}))}},{key:"_isFromOlderVersion",value:function(e){return!(!e.content||2===e.content.downloadFlag)}},{key:"parseElements",value:function(e,t){if(!at(e)||!t)return[];for(var n=[],i=null,r=0;r<e.length;r++)i=e[r],this._needParse(i)?n.push(this._parseElement(i,t)):n.push(e[r]);return n}},{key:"_needParse",value:function(e){return!e.cloudCustomData&&!(!this._isFromOlderVersion(e)||e.type!==b.MSG_AUDIO&&e.type!==b.MSG_FILE&&e.type!==b.MSG_VIDEO)}},{key:"_parseElement",value:function(e,t){switch(e.type){case b.MSG_AUDIO:return this._parseAudioElement(e,t);case b.MSG_FILE:return this._parseFileElement(e,t);case b.MSG_VIDEO:return this._parseVideoElement(e,t)}}},{key:"_parseAudioElement",value:function(e,t){return e.content.url=this._genAudioUrl(e.content.uuid,t),e}},{key:"_parseFileElement",value:function(e,t){return e.content.url=this._genFileUrl(e.content.uuid,t,e.content.fileName),e}},{key:"_parseVideoElement",value:function(e,t){return e.content.url=this._genVideoUrl(e.content.uuid,t),e}},{key:"_genAudioUrl",value:function(e,t){if(""===this._authKey)return"";var n=this.getModule(qn).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(n,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.SOUND,"&openid=").concat(t,"&ver=0")}},{key:"_genFileUrl",value:function(e,t,n){if(""===this._authKey)return"";n||(n="".concat(Math.floor(1e5*Math.random()),"-").concat(Date.now()));var i=this.getModule(qn).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(i,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.FILE,"&openid=").concat(t,"&ver=0&filename=").concat(encodeURIComponent(n))}},{key:"_genVideoUrl",value:function(e,t){if(""===this._authKey)return"";var n=this.getModule(qn).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(n,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.VIDEO,"&openid=").concat(t,"&ver=0")}},{key:"reset",value:function(){this._authKey="",this.expireTime=0}}]),n}(ci),ds=["requestSnapshotUrl"],ps=function(e){s(r,e);var n=m(r);function r(e){var t;i(this,r),(t=n.call(this,e))._n="UploadModule",t.TIMUploadPlugin=null,t.timUploadPlugin=null,t.COSSDK=null,t._cosUploadMethod=null,t.expiredTimeLimit=600,t.appid=0,t.bucketName="",t.ciUrl="",t.directory="",t.downloadUrl="",t.uploadUrl="",t.region="ap-shanghai",t.cos=null,t.cosOptions={secretId:"",secretKey:"",sessionToken:"",expiredTime:0},t.uploadFileType="",t.duration=900,t.tryCount=0,t.UPLOAD_SIZE_LIMIT={AUDIO:20971520,FILE:104857600,IMAGE:20971520,VIDEO:104857600};var o=t.getInnerEmitterInstance();return o.on(ea,t._init,f(t)),o.on(ta,t._onCloudConfigUpdated,f(t)),t}return o(r,[{key:"_init",value:function(){var e=this.getModule(Wn);if(this.TIMUploadPlugin=e.getPlugin("tim-upload-plugin"),this.TIMUploadPlugin)this._initUploaderMethod();else{var t=oe?"cos-wx-sdk":"cos-js-sdk";this.COSSDK=e.getPlugin(t),this.COSSDK?(this._getAuthorizationKey(),this.outputWarning("CosReplacement",t)):this.outputWarning("PluginUndetected")}}},{key:"_onCloudConfigUpdated",value:function(){var e="".concat(this._n,"._onCloudConfigUpdated"),t=this.getCloudConfig("upload_size_limit");if(Be.l("".concat(e," uploadSizeLimit:").concat(t)),!st(t))try{var n=JSON.parse(t);this.UPLOAD_SIZE_LIMIT={AUDIO:n.a?1048576*parseInt(n.a):this.UPLOAD_SIZE_LIMIT.AUDIO,FILE:n.f?1048576*parseInt(n.f):this.UPLOAD_SIZE_LIMIT.FILE,IMAGE:n.i?1048576*parseInt(n.i):this.UPLOAD_SIZE_LIMIT.IMAGE,VIDEO:n.v?1048576*parseInt(n.v):this.UPLOAD_SIZE_LIMIT.VIDEO}}catch(i){Be.e("".concat(e," JSON parse error. uploadSizeLimit:"),t)}}},{key:"_getAuthorizationKey",value:function(){var e=this,t="".concat(this._n,".").concat("_getAuthorizationKey"),n=new wo("_getAuthorizationKey"),i=Math.ceil(Date.now()/1e3);this.request({protocolName:Gr,requestData:{duration:this.expiredTimeLimit}}).then((function(r){var o=r.data;Be.l("".concat(t," ok. data:"),o);var a=o.expiredTime-i;n.setMessage("requestId:".concat(o.requestId," requestTime:").concat(i," expiredTime:").concat(o.expiredTime," diff:").concat(a,"s")).setNetworkType(e.getNetworkType()).end(),!oe&&o.region&&(e.region=o.region),e.appid=o.appid,e.bucketName=o.bucketName,e.ciUrl=o.ciUrl,e.directory=o.directory,e.downloadUrl=o.downloadUrl,e.uploadUrl=o.uploadUrl,e.cosOptions={secretId:o.secretId,secretKey:o.secretKey,sessionToken:o.sessionToken,expiredTime:o.expiredTime},Be.l("".concat(t," ok. region:").concat(e.region," bucketName:").concat(e.bucketName)),e._initUploaderMethod()})).catch((function(i){e.probeNetwork().then((function(e){var t=v(e,2),r=t[0],o=t[1];n.setError(i,r,o).end()})),Be.w("".concat(t," failed. error:"),i)}))}},{key:"_getCosPreSigUrl",value:function(e){var t=this,n="".concat(this._n,".").concat("_getCosPreSigUrl"),i=Math.ceil(Date.now()/1e3),r=new wo("_getCosPreSigUrl");return this.request({protocolName:Fr,requestData:{fileType:e.fileType,fileName:e.fileName,uploadMethod:e.uploadMethod,duration:e.duration}}).then((function(e){t.tryCount=0;var o=e.data||{},a=o.expiredTime-i;return Be.l("".concat(n," ok. data:"),o),r.setMessage("requestId:".concat(o.requestId," expiredTime:").concat(o.expiredTime," diff:").concat(a,"s")).setNetworkType(t.getNetworkType()).end(),o})).catch((function(i){return-1===i.code&&(i.code=fo.COS_GET_SIG_FAIL),t.probeNetwork().then((function(e){var t=v(e,2),n=t[0],o=t[1];r.setError(i,n,o).end()})),Be.w("".concat(n," failed. error:"),i),t.tryCount<1?(t.tryCount++,t._getCosPreSigUrl(e)):(t.tryCount=0,Xo({code:fo.COS_GET_SIG_FAIL}))}))}},{key:"_initUploaderMethod",value:function(){var e=this;if(this.TIMUploadPlugin)return this.timUploadPlugin=new this.TIMUploadPlugin,void(this._cosUploadMethod=function(t,n){e.timUploadPlugin.uploadFile(t,n)});this.appid&&(this.cos=oe?new this.COSSDK({ForcePathStyle:!0,getAuthorization:this._getAuthorization.bind(this)}):new this.COSSDK({getAuthorization:this._getAuthorization.bind(this)}),this._cosUploadMethod=oe?function(t,n){e.cos.postObject(t,n)}:function(t,n){e.cos.uploadFiles(t,n)})}},{key:"onCheckTimer",value:function(e){this.COSSDK&&(this.TIMUploadPlugin||this.isLoggedIn()&&e%60==0&&Math.ceil(Date.now()/1e3)>=this.cosOptions.expiredTime-120&&this._getAuthorizationKey())}},{key:"_getAuthorization",value:function(e,t){t({TmpSecretId:this.cosOptions.secretId,TmpSecretKey:this.cosOptions.secretKey,XCosSecurityToken:this.cosOptions.sessionToken,ExpiredTime:this.cosOptions.expiredTime})}},{key:"upload",value:function(e){if(!0===e.getRelayFlag())return Promise.resolve();var t=this.getModule(ti);switch(e.type){case b.MSG_IMAGE:return t.addTotalCount(Mo),this._uploadImage(e);case b.MSG_FILE:return t.addTotalCount(Mo),this._uploadFile(e);case b.MSG_AUDIO:return t.addTotalCount(Mo),this._uploadAudio(e);case b.MSG_VIDEO:return t.addTotalCount(Mo),this._uploadVideo(e);default:return Promise.resolve()}}},{key:"_uploadImage",value:function(e){var n=this,i=this.getModule(Ln),r=e.getElements()[0],o=i.getMessageOption(e.clientSequence);return this.doUploadImage({file:o.payload.file,to:o.to,onProgress:function(e){if(r.updatePercent(e),ut(o.onProgress))try{o.onProgress(e)}catch(t){return Xo({code:fo.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(i){var o,a,s=i.location,c=i.fileType,u=i.fileSize,l=i.width,d=i.height,p=i.smallImageUrl,h=i.smallImageWidth,f=i.smallImageHeight,g=i.largeImageUrl,m=i.largeImageWidth,v=i.largeImageHeight,_=n.isPrivateNetWork()?s:Mt(s);return r.updateImageFormat(c),p&&g?(o={url:p,width:h,height:f},a={url:g,width:m,height:v}):(o=Pt({originUrl:_,originWidth:l,originHeight:d,min:198}),a=Pt({originUrl:_,originWidth:l,originHeight:d,min:720})),r.updateImageInfoArray([{size:u,url:_,width:l,height:d},t({},a),t({},o)]),e}))}},{key:"_uploadFile",value:function(e){var t=this,n=this.getModule(Ln),i=e.getElements()[0],r=n.getMessageOption(e.clientSequence);return this.doUploadFile({file:r.payload.file,to:r.to,onProgress:function(e){if(i.updatePercent(e),ut(r.onProgress))try{r.onProgress(e)}catch(t){return Xo({code:fo.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(n){var r=n.location,o=t.isPrivateNetWork()?r:Mt(r);return i.updateFileUrl(o),e}))}},{key:"_uploadAudio",value:function(e){var t=this,n=this.getModule(Ln),i=e.getElements()[0],r=n.getMessageOption(e.clientSequence);return this.doUploadAudio({file:r.payload.file,to:r.to,onProgress:function(e){if(i.updatePercent(e),ut(r.onProgress))try{r.onProgress(e)}catch(t){return Xo({code:fo.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(n){var r=n.location,o=t.isPrivateNetWork()?r:Mt(r);return i.updateAudioUrl(o),e}))}},{key:"_uploadVideo",value:function(e){var t=this,n=this.getModule(Ln),i=e.getElements()[0],r=n.getMessageOption(e.clientSequence);return this.doUploadVideo({file:r.payload.file,to:r.to,onProgress:function(e){if(i.updatePercent(e),ut(r.onProgress))try{r.onProgress(e)}catch(t){return Xo({code:fo.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(n){var r=n.location,o=n.snapshotInfo,a=t.isPrivateNetWork()?r:Mt(r);return i.updateVideoUrl(a),$t(o)||i.updateSnapshotInfo(o),e}))}},{key:"_checkSizeError",value:function(e){return Xo({code:fo["MESSAGE_".concat(e,"_SIZE_LIMIT")],message:this.getErrorMessage("UploadSizeLimit",e.toLowerCase(),"".concat(this.UPLOAD_SIZE_LIMIT[e]/1048576," MB"))})}},{key:"doUploadImage",value:function(e){var t=this;if(!e.file)return Xo({code:fo.MESSAGE_IMAGE_SELECT_FILE_FIRST});var n=this._checkImageType(e.file);if(!0!==n)return n;var i=this._checkImageSize(e.file);if(!0!==i)return i;var r=null;return this._setUploadFileType(aa),this.uploadByCOS(e).then((function(e){return r=e,t.isPrivateNetWork()?Rt(e.location):Rt("https://".concat(e.location))})).then((function(e){return r.width=e.width,r.height=e.height,Promise.resolve(r)}))}},{key:"_checkImageType",value:function(e){var t="";return t=oe?e.url.slice(e.url.lastIndexOf(".")+1):e.files[0].name.slice(e.files[0].name.lastIndexOf(".")+1),ra.indexOf(t.toLowerCase())>=0||Xo({code:fo.MESSAGE_IMAGE_TYPES_LIMIT})}},{key:"_checkImageSize",value:function(e){var t=0;return 0===(t=oe?e.size:e.files[0].size)?Xo({code:fo.MESSAGE_FILE_IS_EMPTY}):t<this.UPLOAD_SIZE_LIMIT.IMAGE||this._checkSizeError("IMAGE")}},{key:"doUploadFile",value:function(e){return e.file?e.file.files[0].size>this.UPLOAD_SIZE_LIMIT.FILE?this._checkSizeError("FILE"):0===e.file.files[0].size?Xo({code:fo.MESSAGE_FILE_IS_EMPTY}):(this._setUploadFileType(ua),this.uploadByCOS(e)):Xo({code:fo.MESSAGE_FILE_SELECT_FILE_FIRST})}},{key:"doUploadVideo",value:function(e){return e.file.videoFile.size>this.UPLOAD_SIZE_LIMIT.VIDEO?this._checkSizeError("VIDEO"):0===e.file.videoFile.size?Xo({code:fo.MESSAGE_FILE_IS_EMPTY}):-1===oa.indexOf(e.file.videoFile.type)?Xo({code:fo.MESSAGE_VIDEO_TYPES_LIMIT}):(this._setUploadFileType(sa),oe?this.handleVideoUpload({file:e.file.videoFile,onProgress:e.onProgress}):ae?this.handleVideoUpload(e):void 0)}},{key:"handleVideoUpload",value:function(e){var t=this;return new Promise((function(n,i){t.uploadByCOS(e).then((function(e){n(e)})).catch((function(){t.uploadByCOS(e).then((function(e){n(e)})).catch((function(){i(new Wo({code:fo.MESSAGE_VIDEO_UPLOAD_FAIL}))}))}))}))}},{key:"doUploadAudio",value:function(e){return e.file?e.file.size>this.UPLOAD_SIZE_LIMIT.AUDIO?this._checkSizeError("AUDIO"):0===e.file.size?Xo({code:fo.MESSAGE_FILE_IS_EMPTY}):(this._setUploadFileType(ca),this.uploadByCOS(e)):Xo({code:fo.MESSAGE_AUDIO_UPLOAD_FAIL})}},{key:"uploadByCOS",value:function(e){var t=this;if(!ut(this._cosUploadMethod))return this.outputWarning("PluginUndetected"),Xo({code:fo.COS_UNDETECTED});if(this.timUploadPlugin)return this._uploadWithPreSigUrl(e);var n=new wo("upload"),i="".concat(this._n,".uploadByCOS"),r=Date.now(),o=this._getFile(e);return new Promise((function(a,s){var c=oe?t._createCosOptionsWXMiniApp(e):t._createCosOptionsWeb(e),u=t;t._cosUploadMethod(c,(function(e,c){var l=Object.create(null);if(c){if(e||at(c.files)&&c.files[0].error){var d=new Wo({code:fo.MESSAGE_FILE_UPLOAD_FAIL});return n.setError(d,!0,t.getNetworkType()).end(),Be.l("".concat(i," failed. error:"),c.files[0].error),403===c.files[0].error.statusCode&&(Be.w("".concat(i," failed. cos AccessKeyId was invalid, regain auth key!")),t._getAuthorizationKey()),void s(d)}l.fileName=o.name,l.fileSize=o.size,l.fileType=o.type.slice(o.type.indexOf("/")+1).toLowerCase(),l.location=oe?c.Location:c.files[0].data.Location;var p=Date.now()-r,h=u._formatFileSize(o.size),f=u._formatSpeed(1e3*o.size/p),g="size:".concat(h," time:").concat(p,"ms speed:").concat(f);Be.l("".concat(i," success. name:").concat(o.name," ").concat(g)),a(l);var m=t.getModule(ti);return m.addCost(Mo,p),m.addFileSize(Mo,o.size),void n.setNetworkType(t.getNetworkType()).setMessage(g).end()}var v=new Wo({code:fo.MESSAGE_FILE_UPLOAD_FAIL});n.setError(v,!0,u.getNetworkType()).end(),Be.w("".concat(i," failed. error:"),e),403===e.statusCode&&(Be.w("".concat(i," failed. cos AccessKeyId was invalid, regain auth key!")),t._getAuthorizationKey()),s(v)}))}))}},{key:"_uploadWithPreSigUrl",value:function(e){var t=this,n="".concat(this._n,"._uploadWithPreSigUrl"),i=this._getFile(e);return this._createCosOptionsPreSigUrl(e).then((function(e){return new Promise((function(r,o){var a=new wo("upload"),s=e.requestSnapshotUrl,c=void 0===s?void 0:s,u=h(e,ds),l=Date.now();t._cosUploadMethod(u,(function(e,s){if(e||403===s.statusCode)return a.setError(new Wo(e),!0,t.getNetworkType()).end(),Be.l("".concat(n," failed, error:"),e),void o(new Wo({code:fo.MESSAGE_FILE_UPLOAD_FAIL}));var d=Object.create(null),p=s.data.location||"";t.isPrivateNetWork()||0!==p.indexOf("https://")&&0!==p.indexOf("http://")||(p=p.split("//")[1]),d.fileName=i.name,d.fileSize=i.size,d.fileType=i.type.slice(i.type.indexOf("/")+1).toLowerCase(),d.location=p;var h=Date.now()-l,f=t._formatFileSize(i.size),g=t._formatSpeed(1e3*i.size/h),m="size:".concat(f,",time:").concat(h,"ms,speed:").concat(g," res:").concat(JSON.stringify(s.data));Be.l("".concat(n," success name:").concat(i.name,",").concat(m)),a.setNetworkType(t.getNetworkType()).setMessage(m).end();var v=t.getModule(ti);v.addCost(Mo,h),v.addFileSize(Mo,i.size);var _=[];if(u.thumbUrl&&u.largeUrl&&(_=[t._getSmallImageInfoByUrl(u.thumbUrl,d),t._getLargeImageInfoByUrl(u.largeUrl,d)]),c&&_.push(t._getSnapshotInfoByUrl(c,d)),_.length>0)return Promise.all(_).then((function(){r(d)}));r(d)}))}))}))}},{key:"_getRawOrUploadProxyUrl",value:function(e){var t=this.getModule(qn).getFileUploadProxy(),n=e;return t&&(n=e.replace(/^https:\/\/[^/]+/,t)),n}},{key:"_getFile",value:function(e){var t;return at(e.file.files)||(t=e.file.files,"filelist"===dt(t))?e.file.files[0]:e.file}},{key:"_formatFileSize",value:function(e){return e<1024?e+"B":e<1048576?Math.floor(e/1024)+"KB":Math.floor(e/1048576)+"MB"}},{key:"_formatSpeed",value:function(e){return e<=1048576?Gt(e/1024,1)+"KB/s":Gt(e/1048576,1)+"MB/s"}},{key:"_createCosOptionsWeb",value:function(e){var t=this._getFile(e),n=t.name,i=n.slice(n.lastIndexOf(".")),r=this._genFileName("".concat(mt(999999)).concat(i));return{files:[{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(r),Body:t}],SliceSize:1048576,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Be.w("onProgress callback error:",n)}},onFileFinish:function(e,t,n){}}}},{key:"_createCosOptionsWXMiniApp",value:function(e){var t=this._getFile(e),n=this._genFileName(t.name),i=t.url;return{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(n),FilePath:i,onProgress:function(t){if(Be.l(JSON.stringify(t)),"function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Be.w("onProgress callback error:",n)}}}}},{key:"_createCosOptionsPreSigUrl",value:function(e){var t=this,n="",i="",r=0,o=this._getFile(e);if(oe)n=this._genFileName(o.name),i=o.url,r=1;else{var a=o.name,s=a.slice(a.lastIndexOf("."));n=this._genFileName("".concat(mt(999999)).concat(s)),i=o,r=0}return this._getCosPreSigUrl({fileType:this.uploadFileType,fileName:n,uploadMethod:r,duration:this.duration}).then((function(r){var o=r.uploadUrl,a=r.downloadUrl,s=r.requestSnapshotUrl,c=void 0===s?void 0:s,u=r.thumbUrl,l=r.largeUrl;return{url:t._getRawOrUploadProxyUrl(o),fileType:t.uploadFileType,fileName:n,resources:i,downloadUrl:a,requestSnapshotUrl:c,thumbUrl:u,largeUrl:l,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Be.w("onProgress callback error:",n),Be.e(n)}}}}))}},{key:"_genFileName",value:function(e){return"".concat(Lt(),"-").concat(e)}},{key:"_setUploadFileType",value:function(e){this.uploadFileType=e}},{key:"_getSnapshotInfoByUrl",value:function(e,t){var n=this,i=new wo("getSnapshotInfo");return this.request({protocolName:Vr,requestData:{platform:this.getPlatform(),coverName:this._genFileName(mt(99999)),requestSnapshotUrl:e}}).then((function(e){var n=(e.data||{}).snapshotUrl;return i.setMessage("snapshotUrl:".concat(n)).end(),$t(n)?{}:Rt(n).then((function(e){t.snapshotInfo={snapshotUrl:n,snapshotWidth:e.width,snapshotHeight:e.height}}))})).catch((function(e){return Be.w("".concat(n._n,"._getSnapshotInfoByUrl failed. error:"),e),i.setCode(e.errorCode).setMessage(e.errorInfo).end(),{}}))}},{key:"_getSmallImageInfoByUrl",value:function(e,t){return Rt(e).then((function(n){t.smallImageUrl=e,t.smallImageWidth=n.width,t.smallImageHeight=n.height}))}},{key:"_getLargeImageInfoByUrl",value:function(e,t){return Rt(e).then((function(n){t.largeImageUrl=e,t.largeImageWidth=n.width,t.largeImageHeight=n.height}))}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset"))}}]),r}(ci),hs=["downloadKey","pbDownloadKey","messageList"],fs=function(){function e(t){i(this,e),this._n="MergerMessageHandler",this._messageModule=t}return o(e,[{key:"uploadMergerMessage",value:function(e,t){var n=this,i="".concat(this._n,".").concat("uploadMergerMessage");Be.d("".concat(i," message:"),e,"messageBytes:".concat(t));var r=e.payload.messageList,o=r.length,a=new wo("uploadMergerMessage");return this._messageModule.request({protocolName:Wr,requestData:{messageList:r}}).then((function(e){Be.d("".concat(i," ok. response:"),e.data);var r=e.data,s=r.pbDownloadKey,c=r.downloadKey,u={pbDownloadKey:s,downloadKey:c,messageNumber:o};return a.setNetworkType(n._messageModule.getNetworkType()).setMessage("".concat(o,"-").concat(t,"-").concat(c)).end(),u})).catch((function(e){throw Be.w("".concat(i," failed. error:"),e),n._messageModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),e}))}},{key:"downloadMergerMessage",value:function(e){var n=this,i="".concat(this._n,".").concat("downloadMergerMessage");Be.d("".concat(i," message:"),e);var r=e.payload.downloadKey,o=this._messageModule.getFileDownloadProxy(),a=new wo("downloadMergerMessage");return a.setMessage("downloadKey:".concat(r)),this._messageModule.request({protocolName:Yr,requestData:{downloadKey:r}}).then((function(r){if(Be.d("".concat(i," ok. response:"),r.data),ut(e.clearElement)){var s=e.payload;s.downloadKey,s.pbDownloadKey,s.messageList;var c=h(s,hs);e.clearElement(),e.setElement({type:e.type,content:t({messageList:r.data.messageList},c)},o)}else{var u=[];r.data.messageList.forEach((function(e){if(!$t(e)){var t=new Bo(e,o);u.push(t)}})),e.payload.messageList=u,e.payload.downloadKey="",e.payload.pbDownloadKey=""}return a.setNetworkType(n._messageModule.getNetworkType()).end(),e})).catch((function(e){throw Be.w("".concat(i," failed. key:").concat(r," error:"),e),n._messageModule.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),e}))}},{key:"createMergerMessagePack",value:function(e,t,n){return e.conversationType===b.CONV_C2C?this._createC2CMergerMessagePack(e,t,n):this._createGroupMergerMessagePack(e,t,n)}},{key:"_createC2CMergerMessagePack",value:function(e,t,n){var i=null;t&&(t.offlinePushInfo&&(i=t.offlinePushInfo),!0===t.onlineUserOnly&&(i?i.disablePush=!0:i={disablePush:!0}));var r=[];if(ot(t)&&ot(t.messageControlInfo)){var o=t.messageControlInfo,a=o.excludedFromUnreadCount,s=o.excludedFromLastMessage,c=o.excludedFromContentModeration;!0===a&&r.push("NoUnread"),!0===s&&r.push("NoLastMsg"),!0===c&&r.push("NoMsgCheck")}var u="";it(e.cloudCustomData)&&e.cloudCustomData.length>0&&(u=e.cloudCustomData);var l=n.pbDownloadKey,d=n.downloadKey,p=n.messageNumber,h=e.payload,f=h.title,g=h.abstractList,m=h.compatibleText,v=this._messageModule.getModule(Pn),_=v&&v.isOnlineMessage(e,t)?0:void 0;return{protocolName:gi,tjgID:this._messageModule.generateTjgID(e),requestData:{fromAccount:this._messageModule.getMyUserID(),toAccount:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:l,downloadKey:d,title:f,abstractList:g,compatibleText:m,messageNumber:p}}],cloudCustomData:u,clientTime:e.clientTime,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:_,offlinePushInfo:i?{pushFlag:!0===i.disablePush?1:0,title:i.title||"",desc:i.description||"",ext:i.extension||"",apnsInfo:{badgeMode:!0===i.ignoreIOSBadge?1:0},androidInfo:{OPPOChannelID:i.androidOPPOChannelID||""}}:void 0,messageControlInfo:0!==_?r:void 0,isSupportExtension:!0===e.isSupportExtension?1:0}}}},{key:"_createGroupMergerMessagePack",value:function(e,t,n){var i=null;t&&t.offlinePushInfo&&(i=t.offlinePushInfo);var r=[];if(ot(t)&&ot(t.messageControlInfo)){var o=t.messageControlInfo,a=o.excludedFromUnreadCount,s=o.excludedFromLastMessage,c=o.excludedFromContentModeration;!0===a&&r.push("NoUnread"),!0===s&&r.push("NoLastMsg"),!0===c&&r.push("NoMsgCheck")}var u="";it(e.cloudCustomData)&&e.cloudCustomData.length>0&&(u=e.cloudCustomData);var l=n.pbDownloadKey,d=n.downloadKey,p=n.messageNumber,h=e.payload,f=h.title,g=h.abstractList,m=h.compatibleText,v=this._messageModule.getModule(Un),_=v&&v.isOnlineMessage(e,t)?1:0;return{protocolName:mi,tjgID:this._messageModule.generateTjgID(e),requestData:{fromAccount:this._messageModule.getMyUserID(),groupID:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:l,downloadKey:d,title:f,abstractList:g,compatibleText:m,messageNumber:p}}],random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:void 0,cloudCustomData:u,onlineOnlyFlag:_,offlinePushInfo:i?{pushFlag:!0===i.disablePush?1:0,title:i.title||"",desc:i.description||"",ext:i.extension||"",apnsInfo:{badgeMode:!0===i.ignoreIOSBadge?1:0},androidInfo:{OPPOChannelID:i.androidOPPOChannelID||""}}:void 0,clientTime:e.clientTime,needReadReceipt:!0!==e.needReadReceipt||v.isMessageFromOrToAVChatroom(e.to)?0:1,messageControlInfo:0===_?r:void 0,isSupportExtension:!0===e.isSupportExtension?1:0}}}}]),e}(),gs={ERR_SVR_COMM_SENSITIVE_TEXT:80001,ERR_SVR_COMM_BODY_SIZE_LIMIT:80002,OPEN_SERVICE_OVERLOAD_ERROR:60022,ERR_SVR_MSG_PKG_PARSE_FAILED:20001,ERR_SVR_MSG_INTERNAL_AUTH_FAILED:20002,ERR_SVR_MSG_INVALID_ID:20003,ERR_SVR_MSG_PUSH_DENY:20006,ERR_SVR_MSG_IN_PEER_BLACKLIST:20007,ERR_SVR_MSG_BOTH_NOT_FRIEND:20009,ERR_SVR_MSG_NOT_PEER_FRIEND:20010,ERR_SVR_MSG_NOT_SELF_FRIEND:20011,ERR_SVR_MSG_SHUTUP_DENY:20012,ERR_SVR_GROUP_INVALID_PARAMETERS:10004,ERR_SVR_GROUP_PERMISSION_DENY:10007,ERR_SVR_GROUP_NOT_FOUND:10010,ERR_SVR_GROUP_INVALID_GROUPID:10015,ERR_SVR_GROUP_REJECT_FROM_THIRDPARTY:10016,ERR_SVR_GROUP_SHUTUP_DENY:10017,MESSAGE_SEND_FAIL:2100,OVER_FREQUENCY_LIMIT:2996},ms=[fo.MESSAGE_ONPROGRESS_FUNCTION_ERROR,fo.MESSAGE_IMAGE_SELECT_FILE_FIRST,fo.MESSAGE_IMAGE_TYPES_LIMIT,fo.MESSAGE_FILE_IS_EMPTY,fo.MESSAGE_IMAGE_SIZE_LIMIT,fo.MESSAGE_FILE_SELECT_FILE_FIRST,fo.MESSAGE_FILE_SIZE_LIMIT,fo.MESSAGE_VIDEO_SIZE_LIMIT,fo.MESSAGE_VIDEO_TYPES_LIMIT,fo.MESSAGE_AUDIO_UPLOAD_FAIL,fo.MESSAGE_AUDIO_SIZE_LIMIT,fo.COS_UNDETECTED];function vs(e){var t=!1;return Object.values(gs).includes(e)&&(t=!0),(e>=120001&&e<=13e4||e>=10100&&e<=10200)&&(t=!0),t}var _s=function(e){s(r,e);var n=m(r);function r(e){var t;return i(this,r),(t=n.call(this,e))._n="MessageModule",t._messageOptionsMap=new Map,t._mergerMessageHandler=new fs(f(t)),t}return o(r,[{key:"createTextMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new Ko(e),i="string"==typeof e.payload?e.payload:e.payload.text,r=new Ao({text:i}),o=this._getNickAndAvatarByUserID(t);return n.setElement(r),n.setNickAndAvatar(o),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createImageMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new Ko(e);if(oe){var i=e.payload.file;if(et(i))return void this.outputWarning("FileUnsupportedInMP","createImageMessage");var r=i.tempFiles[0].path||i.tempFiles[0].tempFilePath,o={url:r,name:r.slice(r.lastIndexOf("/")+1),size:i.tempFiles&&i.tempFiles[0].size||1,type:r.slice(r.lastIndexOf(".")+1).toLowerCase()};e.payload.file=o}else if(ae)if(et(e.payload.file)){var a=e.payload.file;e.payload.file={files:[a]}}else if(ot(e.payload.file)&&"undefined"!=typeof uni){var s=e.payload.file.tempFiles[0];e.payload.file={files:[s]}}var c=new Ro({imageFormat:He.UNKNOWN,uuid:this._generateUUID(e.payload.file),file:e.payload.file}),u=this._getNickAndAvatarByUserID(t);return n.setElement(c),n.setNickAndAvatar(u),n.setNameCard(this._getNameCardByGroupID(n)),this._messageOptionsMap.set(n.clientSequence,e),n}},{key:"createAudioMessage",value:function(e){var t=e.payload.file;if(oe){var n={url:t.tempFilePath,name:t.tempFilePath.slice(t.tempFilePath.lastIndexOf("/")+1),size:t.fileSize,second:parseInt(t.duration)/1e3,type:t.tempFilePath.slice(t.tempFilePath.lastIndexOf(".")+1).toLowerCase()};e.payload.file=n}var i=this.getMyUserID();e.currentUser=i,e.senderTinyID=this.getMyTinyID();var r=new Ko(e),o=new Oo({second:Math.floor(t.duration/1e3),size:t.fileSize||t.size,url:t.tempFilePath,uuid:this._generateUUID(e.payload.file)}),a=this._getNickAndAvatarByUserID(i);return r.setElement(o),r.setNickAndAvatar(a),r.setNameCard(this._getNameCardByGroupID(r)),this._messageOptionsMap.set(r.clientSequence,e),r}},{key:"createVideoMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID(),e.payload.file.thumbUrl="",e.payload.file.thumbSize=0;var n={};if(oe){if(te)return void this.outputWarning("VideoUnsupportedInAlipay");if(et(e.payload.file))return void this.outputWarning("FileUnsupportedInMP","createVideoMessage");var i=e.payload.file;at(i.tempFiles)&&(i=i.tempFiles[0]),n.url=i.tempFilePath,n.name=i.tempFilePath.slice(i.tempFilePath.lastIndexOf("/")+1),n.size=i.size||1,n.second=i.duration||0,n.type=i.tempFilePath.slice(i.tempFilePath.lastIndexOf(".")+1).toLowerCase()}else if(ae){if(et(e.payload.file)){var r=e.payload.file;e.payload.file.files=[r]}else if(ot(e.payload.file)&&"undefined"!=typeof uni){var o=e.payload.file.tempFile;e.payload.file.files=[o]}var a=e.payload.file;n.url=window.URL.createObjectURL(a.files[0]),n.name=a.files[0].name,n.size=a.files[0].size||1,n.second=a.files[0].duration||0,n.type=a.files[0].type.split("/")[1]}e.payload.file.videoFile=n;var s=new Ko(e),c=new Vo({videoFormat:n.type,videoSecond:Gt(n.second,0),videoSize:n.size,remoteVideoUrl:"",videoUrl:n.url,videoUUID:this._generateUUID(e.payload.file.videoFile),thumbUUID:this._generateUUID(e.payload.file.videoFile),thumbWidth:e.payload.file.width||200,thumbHeight:e.payload.file.height||200,thumbUrl:e.payload.file.thumbUrl,thumbSize:e.payload.file.thumbSize,thumbFormat:e.payload.file.thumbUrl.slice(e.payload.file.thumbUrl.lastIndexOf(".")+1).toLowerCase()}),u=this._getNickAndAvatarByUserID(t);return s.setElement(c),s.setNickAndAvatar(u),s.setNameCard(this._getNameCardByGroupID(s)),this._messageOptionsMap.set(s.clientSequence,e),s}},{key:"createCustomMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new Ko(e),i=new Fo({data:e.payload.data,description:e.payload.description,extension:e.payload.extension}),r=this._getNickAndAvatarByUserID(t);return n.setElement(i),n.setNickAndAvatar(r),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createFaceMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new Ko(e),i=new Lo(e.payload),r=this._getNickAndAvatarByUserID(t);return n.setElement(i),n.setNickAndAvatar(r),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createMergerMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=this._getNickAndAvatarByUserID(t),i=new Ko(e),r=new Ho(e.payload);return i.setElement(r),i.setNickAndAvatar(n),i.setNameCard(this._getNameCardByGroupID(i)),i.setRelayFlag(!0),i}},{key:"createForwardMessage",value:function(e){var t=e.to,n=e.conversationType,i=e.priority,r=e.payload,o=e.needReadReceipt,a=e.receiverList,s=this.getMyUserID(),c=this._getNickAndAvatarByUserID(s);if(r.type===b.MSG_GRP_TIP)return Xo({code:fo.MESSAGE_FORWARD_TYPE_INVALID});var u={to:t,conversationType:n,conversationID:"".concat(n).concat(t),priority:i,isPlaceMessage:0,status:Qt.UNSEND,currentUser:s,senderTinyID:this.getMyTinyID(),cloudCustomData:e.cloudCustomData||r.cloudCustomData||"",needReadReceipt:o,receiverList:a,isSupportExtension:e.isSupportExtension||!1},l=new Ko(u);return l.setElement(r.getElements()[0]),l.setNickAndAvatar(c),l.setNameCard(this._getNameCardByGroupID(r)),l.setRelayFlag(!0),l}},{key:"downloadMergerMessage",value:function(e){return this._mergerMessageHandler.downloadMergerMessage(e)}},{key:"createFileMessage",value:function(e){if(oe){if(!X&&!Z&&!ie)return;var n=se.getSystemInfoSync().SDKVersion;if(X&&Nt(n,"2.5.0")<0)return void this.outputWarning("WXChooseMessageFile");if(Z&&Nt(n,"1.18.0")<0)return void this.outputWarning("QQChooseMessageFile")}if(ae||ie){if(et(e.payload.file)){var i=e.payload.file;e.payload.file={files:[i]}}else if(ot(e.payload.file)&&"undefined"!=typeof uni){var r=e.payload.file,o=r.tempFiles,a=r.files,s=null;at(o)?s=o[0]:at(a)&&(s=a[0]),e.payload.file={files:[s]}}}else if(X||Z){var c=e.payload.file.tempFiles,u=t(t({},c[0]),{},{url:c[0].path});e.payload.file={files:[u]}}var l=this.getMyUserID();e.currentUser=l,e.senderTinyID=this.getMyTinyID();var d=new Ko(e),p=new Go({uuid:this._generateUUID(e.payload.file),file:e.payload.file}),h=this._getNickAndAvatarByUserID(l);return d.setElement(p),d.setNickAndAvatar(h),d.setNameCard(this._getNameCardByGroupID(d)),this._messageOptionsMap.set(d.clientSequence,e),d}},{key:"createLocationMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new Ko(e),i=new qo(e.payload),r=this._getNickAndAvatarByUserID(t);return n.setElement(i),n.setNickAndAvatar(r),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"_onCannotFindModule",value:function(){return Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"sendMessageInstance",value:function(e,t){var n=this;if(!1===this.getModule(ri).filterMessage(e,t))return this._onSendMessageFailed(e,new Wo({code:fo.PROFANITY_FOUND}));var i,r=null;switch(e.conversationType){case b.CONV_C2C:if(!(r=this.getModule(Pn)))return this._onCannotFindModule();break;case b.CONV_GROUP:if(!(r=this.getModule(Un)))return this._onCannotFindModule();if(Et({groupID:e.to})){var o=r.getLocalGroupProfile(e.to);if(o&&o.isSupportTopic)return Xo({code:fo.MESSAGE_SEND_GROUP_WITH_TOPIC_FAIL})}break;default:return Xo({code:fo.MESSAGE_SEND_INVALID_CONVERSATION_TYPE})}var a=this.getModule(zn),s=this.getModule(Un);return a.upload(e).then((function(){return n._getSendMessageSpecifiedKey(e)===Io&&n.getModule(ti).addSuccessCount(Mo),s.guardForAVChatRoom(e).then((function(){if(!e.isSendable())return Xo({code:fo.MESSAGE_FILE_URL_IS_EMPTY});n._addSendMessageTotalCount(e),i=Date.now();var o=function(e){var t="utf-8";ae&&document&&(t=document.charset.toLowerCase());var n,i,r=0;if(i=e.length,"utf-8"===t||"utf8"===t)for(var o=0;o<i;o++)(n=e.codePointAt(o))<=127?r+=1:n<=2047?r+=2:n<=65535?r+=3:(r+=4,o++);else if("utf-16"===t||"utf16"===t)for(var a=0;a<i;a++)(n=e.codePointAt(a))<=65535?r+=2:(r+=4,a++);else r=e.replace(/[^\x00-\xff]/g,"aa").length;return r}(JSON.stringify(e));return e.type===b.MSG_MERGER&&o>11264?n._mergerMessageHandler.uploadMergerMessage(e,o).then((function(i){var r=n._mergerMessageHandler.createMergerMessagePack(e,t,i);return n.request(r)})):(n.getModule(Vn).setMessageRandom(e),e.conversationType===b.CONV_C2C||e.conversationType===b.CONV_GROUP?r.sendMessage(e,t):void 0)})).then((function(o){var a=o.data,s=a.time,c=a.sequence,u=a.readReceiptCode;nt(u)&&0!==u&&(new wo("sendMessageWithReceipt").setMessage("from:".concat(e.from," to:").concat(e.to," sequence:").concat(c," readReceiptCode:").concat(u)).end(),Be.w("".concat(n._n,".sendMessageInstance readReceiptCode:").concat(u," message:").concat(n.getErrorMessage(u)))),n._addSendMessageSuccessCount(e,i),n._messageOptionsMap.delete(e.clientSequence);var l=n.getModule(Vn);e.status=Qt.SUCCESS,e.time=s;var d=!1;if(e.conversationType===b.CONV_GROUP)e.sequence=c;else if(e.conversationType===b.CONV_C2C){var p=l.getLatestMessageSentByMe(e.conversationID);if(p){var h=p.nick,f=p.avatar;h===e.nick&&f===e.avatar||(d=!0)}}if(d&&l.modifyMessageSentByMe({conversationID:e.conversationID,latestNick:e.nick,latestAvatar:e.avatar}),r.isOnlineMessage(e,t))e._onlineOnlyFlag=!0;else{l.appendToMessageList(e);var g=e;ot(t)&&ot(t.messageControlInfo)&&(!0===t.messageControlInfo.excludedFromLastMessage&&(e._isExcludedFromLastMessage=!0,g=""),!0===t.messageControlInfo.excludedFromUnreadCount&&(e._isExcludedFromUnreadCount=!0));var m=e.conversationType;kt(e.to)&&(m=b.CONV_TOPIC,n.getModule(Fn).onMessageSent({groupID:qt(e.to),topicID:e.to,lastMessage:g})),l.onMessageSent({conversationOptionsList:[{conversationID:e.conversationID,unreadCount:0,type:m,subType:e.conversationSubType,lastMessage:g}]})}return e.getRelayFlag()||"TIMImageElem"!==e.type||Ut(e.payload.imageInfoArray),zo({message:e})}))})).catch((function(t){return n._onSendMessageFailed(e,t)}))}},{key:"_onSendMessageFailed",value:function(e,t){e.status=Qt.FAIL,this.getModule(Vn).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,t);var n=new wo("sendMessage");return n.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)),this.probeNetwork().then((function(e){var i=v(e,2),r=i[0],o=i[1];n.setError(t,r,o).end()})),Be.e("".concat(this._n,"._onSendMessageFailed error:"),t),Xo(new Wo({code:t&&t.code?t.code:fo.MESSAGE_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if([b.MSG_IMAGE,b.MSG_AUDIO,b.MSG_VIDEO,b.MSG_FILE].includes(e.type))return Io;if(e.conversationType===b.CONV_C2C)return vo;if(e.conversationType===b.CONV_GROUP){var t=this.getModule(Un).getLocalGroupProfile(e.to);if(!t)return;var n=t.type;return St(n)?yo:_o}}},{key:"_addSendMessageTotalCount",value:function(e){var t=this._getSendMessageSpecifiedKey(e);t&&this.getModule(ti).addTotalCount(t)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n=Math.abs(Date.now()-t),i=this._getSendMessageSpecifiedKey(e);if(i){var r=this.getModule(ti);r.addSuccessCount(i),r.addCost(i,n)}}},{key:"_addSendMessageFailCountOnUser",value:function(e,t){var n,i,r=t.code,o=void 0===r?-1:r,a=this.getModule(ti),s=this._getSendMessageSpecifiedKey(e);s===Io&&(n=o,i=!1,ms.includes(n)&&(i=!0),i)?a.addFailedCountOfUserSide(Mo):vs(o)&&s&&a.addFailedCountOfUserSide(s)}},{key:"resendMessage",value:function(e){return e.isResend=!0,e.status=Qt.UNSEND,this.sendMessageInstance(e)}},{key:"revokeMessage",value:function(e){var t=this,n=null;if(e.conversationType===b.CONV_C2C?n=this.getModule(Pn):e.conversationType===b.CONV_GROUP&&(n=this.getModule(Un)),!n)return this._onCannotFindModule();var i=new wo("revokeMessage");i.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to));var r="".concat(this._n,".").concat("revokeMessage");return n.revokeMessage(e).then((function(n){var o=n.data.recallRetList;if(!$t(o)&&0!==o[0].retCode){var a=new Wo({code:o[0].retCode,data:{message:e}});return i.setCode(a.code).setMoreMessage(a.message).end(),Xo(a)}return Be.i("".concat(r," ok. ID:").concat(e.ID)),e.isRevoked=!0,i.end(),t.getModule(Vn).onMessageRevoked([e]),zo({message:e})})).catch((function(n){t.probeNetwork().then((function(e){var t=v(e,2),r=t[0],o=t[1];i.setError(n,r,o).end()}));var o=new Wo({code:n&&n.code?n.code:fo.MESSAGE_REVOKE_FAIL,message:n&&n.message?n.message:void 0,data:{message:e}});return Be.w("".concat(r," failed. error:"),n),Xo(o)}))}},{key:"deleteMessage",value:function(e){var t=this,n=null,i=e[0],r=i.conversationID,o="",a=[],s=[];if(i.conversationType===b.CONV_C2C)n=this.getModule(Pn),o=r.replace(b.CONV_C2C,""),e.forEach((function(e){e&&e.status===Qt.SUCCESS&&e.conversationID===r&&(e._onlineOnlyFlag||a.push("".concat(e.sequence,"_").concat(e.random,"_").concat(e.time)),s.push(e))}));else if(i.conversationType===b.CONV_GROUP)n=this.getModule(Un),o=r.replace(b.CONV_GROUP,""),e.forEach((function(e){e&&e.status===Qt.SUCCESS&&e.conversationID===r&&(e._onlineOnlyFlag||a.push("".concat(e.sequence)),s.push(e))}));else if(i.conversationType===b.CONV_SYSTEM)return Xo({code:fo.CANNOT_DELETE_GROUP_SYSTEM_NOTICE});if(!n)return this._onCannotFindModule();if(0===a.length)return this._onMessageDeleted(s);a.length>30&&(a=a.slice(0,30),s=s.slice(0,30));var c=new wo("deleteMessage");c.setMessage("to:".concat(o," count:").concat(a.length));var u="".concat(this._n,".").concat("deleteMessage");return n.deleteMessage({to:o,keyList:a}).then((function(e){return c.end(),Be.i("".concat(u," ok")),t._onMessageDeleted(s)})).catch((function(e){t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),Be.w("".concat(u," failed. error:"),e);var n=new Wo({code:e&&e.code?e.code:fo.MESSAGE_DELETE_FAIL,message:e&&e.message?e.message:void 0});return Xo(n)}))}},{key:"_onMessageDeleted",value:function(e){return this.getModule(Vn).onMessageDeleted(e),Jo({messageList:e})}},{key:"translateText",value:function(e){var n="".concat(this._n,".").concat("translateText"),i=e.sourceTextList,r=e.sourceLanguage,o=e.targetLanguage,a=new wo("translateText");return a.setMessage("sourceLanguage:".concat(r," targetLanguage:").concat(o)),this.request({protocolName:ho,requestData:{sourceTextList:i,source:r||"auto",target:o,from:this.getMyTinyID(),SDKAppID:this.getSDKAppID()}}).then((function(e){var i=e.data,r=i.error,o=i.requestID,s=i.translatedTextList;if(0===r.code)return a.end(),Be.i("".concat(n," ok. requestID:").concat(o)),zo({translatedTextList:s});throw t(t({},r),{},{requestID:o})})).catch((function(e){return a.setCode(e.code).setMoreMessage(e.requestID).end(),Be.w("".concat(n," failed. error:"),e),Xo({code:fo.TRANSLATE_TEXT_FAIL})}))}},{key:"modifyRemoteMessage",value:function(e){var t=this,n=null,i=e.conversationType,r=e.to;if(this.getModule(Un).isMessageFromOrToAVChatroom(r))return Xo({code:fo.MESSAGE_MODIFY_DISABLED_IN_AVCHATROOM,data:{message:e}});if(!1===this.getModule(ri).filterMessage(e))return Xo({code:fo.PROFANITY_FOUND,data:{message:e}});i===b.CONV_C2C?n=this.getModule(Pn):i===b.CONV_GROUP&&(n=this.getModule(Un));var o=new wo("modifyMessage");o.setMessage("to:".concat(r));var a="".concat(this._n,".modifyRemoteMessage");return n.modifyRemoteMessage(e).then((function(n){o.end(),Be.i("".concat(a," ok"));var i=t._onModifyRemoteMessageResp(e,n.data);return zo({message:i})})).catch((function(n){if(o.setCode(n.code).setMoreMessage(n.message).end(),Be.w("".concat(a," failed. error:"),n),20027===n.code){var i=t._onModifyRemoteMessageResp(e,n.data);return Xo({code:fo.MESSAGE_MODIFY_CONFLICT,data:{message:i}})}return Xo({code:n.code,message:n.message,data:{message:e}})}))}},{key:"_onModifyRemoteMessageResp",value:function(e,t){Be.d("".concat(this._n,"._onModifyRemoteMessageResp options:"),t);var n=e.conversationType,i=e.from,r=e.to,o=e.random,a=e.sequence,s=e.time,c=t.elements,u=t.messageVersion,l=t.cloudCustomData,d=void 0===l?"":l;return this.getModule(Vn).onMessageModified({conversationType:n,from:i,to:r,time:s,random:o,sequence:a,elements:c,cloudCustomData:d,messageVersion:u})}},{key:"_generateUUID",value:function(e){var t=this.getModule(qn),n="".concat(t.getSDKAppID(),"-").concat(t.getUserID(),"-").concat(function(){for(var e="",t=32;t>0;--t)e+=vt[Math.floor(Math.random()*_t)];return e}()),i=e.name||e.value||e.url||e.tempFilePath,r=i&&i.slice(i.lastIndexOf(".")+1);return r&&(n="".concat(n,".").concat(r)),n}},{key:"getMessageOption",value:function(e){return this._messageOptionsMap.get(e)}},{key:"_getNickAndAvatarByUserID",value:function(e){return this.getModule(Nn).getNickAndAvatarByUserID(e)}},{key:"_getNameCardByGroupID",value:function(e){if(e.conversationType===b.CONV_GROUP){var t=this.getModule(Un);if(t)return t.getMyNameCardByGroupID(e.to)}return""}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._messageOptionsMap.clear()}}]),r}(ci),ys=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="MessageExtensionModule",r.messageExtensionMap=new Map,r.globalSeqMap=new Map,r.getMessageExtensionsMap=new Map,r}return o(n,[{key:"onMessageExtensionNotify",value:function(e){var t=this,n=e.dataList,i=n.messageInfo,r=n.operateType,o=n.operateResultList,a=n.tinyID,s=n.globalSequence,c=i.clientTime,u=i.random,l="".concat(a,"-").concat(c,"-").concat(u),d=[],p=[];Be.l("".concat(this._n,".onMessageExtensionNotify messageID:").concat(l," operateType:").concat(r," globalSequence:").concat(s)),this._updateGlobalSequence(l,s);var h=!1,f=!1;o.forEach((function(e){var n=e.extensions,i=void 0===n?[]:n,o=e.clearSequence;1===r?(h=!0,i.forEach((function(e){d.push({key:e.key,value:e.value})})),t._updateLocalExtension(l,i)):2===r?(f=!0,i.forEach((function(e){p.push(e.key)})),t._updateLocalExtension(l,i)):3===r&&(f=!0,t._hasLocalExtension(l)&&t._getLocalExtension(l).forEach((function(e,t){e.seq<=o&&!$t(e.value)&&p.push(t)})),t._clearLocalExtension(l,o))})),h&&this.emitOuterEvent(k.MESSAGE_EXTENSIONS_UPDATED,{messageID:l,extensions:d}),f&&this.emitOuterEvent(k.MESSAGE_EXTENSIONS_DELETED,{messageID:l,keyList:p})}},{key:"setMessageExtensions",value:function(e,t){var n=this;if(!this.canIUse(H.MSG_EXT))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var i="".concat(this._n,".").concat("setMessageExtensions"),r=e.ID,o=e.conversationID,a=e.sequence,s=e.time,c=_(t);t.length>20&&(c=t.slice(0,20),Be.w("".concat(i,". the length of extensions cannot exceed 20.")));var u="conversationID:".concat(o," messageID:").concat(r," sequence:").concat(a," time:").concat(s," count:").concat(c.length),l=new wo("setMessageExtensions");return l.setMessage(u),Be.l("".concat(i," ").concat(u)),this._modifyMessageExtensions(e,c).then((function(e){var t=e.resultList,n=e.successCount,r=e.failureCount,o="success count:".concat(n," fail count:").concat(r);return l.setMoreMessage(o).end(),Be.l("".concat(i," ok. ").concat(o)),zo({extensions:t})})).catch((function(e){return n.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];l.setError(e,i,r).end()})),Be.e("".concat(i," failed. error:"),e),Xo(e)}))}},{key:"getMessageExtensions",value:function(e){var t=this;if(!this.canIUse(H.MSG_EXT))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("getMessageExtensions"),i=e.ID,r=e.conversationID,o=e.sequence,a=e.time,s="conversationID:".concat(r," messageID:").concat(i," sequence:").concat(o," time:").concat(a),c=new wo("getMessageExtensions");c.setMessage(s),Be.l("".concat(n," ").concat(s));var u=void 0;return this.getMessageExtensionsMap.has(i)&&(u=this._getGlobalSequence(i)),this._getMessageExtensions(e,u).then((function(e){return c.end(),Be.l("".concat(n," ok. total count:").concat(e.length)),st(u)&&e.length>0&&t.getMessageExtensionsMap.set(i,1),zo({extensions:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"deleteMessageExtensions",value:function(e,t){var n=this;if(!this.canIUse(H.MSG_EXT))return Xo({code:fo.CANNOT_USE_COMMERCIAL_ABILITY});var i="".concat(this._n,".").concat("deleteMessageExtensions"),r=[],o=3;$t(t)||(o=2,t.forEach((function(e){r.push({key:e,value:"",seq:0})})));var a=e.ID,s=e.conversationID,c=e.sequence,u=e.time,l="conversationID:".concat(s," messageID:").concat(a," sequence:").concat(c," time:").concat(u," operateType:").concat(o),d=new wo("deleteMessageExtensions");return d.setMessage(l),Be.l("".concat(i," ").concat(l)),this._modifyMessageExtensions(e,r,o).then((function(e){var t=e.resultList,n=e.successCount,r=e.failureCount,a="";return 2===o&&(a="success count:".concat(n," fail count:").concat(r)),d.setMoreMessage("".concat(a)).end(),Be.l("".concat(i," ok. ").concat(a)),zo({extensions:t})})).catch((function(e){return n.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];d.setError(e,i,r).end()})),Be.e("".concat(i," failed. error:"),e),Xo(e)}))}},{key:"_modifyMessageExtensions",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=kt(e.to)?b.CONV_TOPIC:e.conversationType,o=void 0;3!==i&&(o=this._getRequestExtensions(e,t));var a=null;switch(r){case b.CONV_C2C:a=this.getModule(Pn);break;case b.CONV_GROUP:a=this.getModule(Un);break;case b.CONV_TOPIC:a=this.getModule(Fn);break;default:return Xo({code:fo.CANNOT_FIND_MODULE})}return a.modifyMessageExtensions(e,o,i).then((function(t){var i=t.data,r=i.extensions,o=i.seq,a=[],s=0,c=0,u=[];return(r=$t(r)?[]:r).forEach((function(e){var t=e.errorCode,n=e.extension,i=n.key,r=n.value,o=n.seq;a.push({code:t,key:i,value:r}),0===t?s++:c++,u.push({key:i,value:r,seq:o})})),n._updateGlobalSequence(e.ID,o),u.length>0&&(n._updateLocalExtension(e.ID,u),u=null),{resultList:a,successCount:s,failureCount:c}})).catch((function(e){return Xo(e)}))}},{key:"_getRequestExtensions",value:function(e,t){var n=[];if(this._hasLocalExtension(e.ID)){var i=this._getLocalExtension(e.ID);return t.forEach((function(e){var t=e.key,r=e.value,o=0;i.has(t)&&(o=i.get(t).seq),n.push({key:t,value:r,seq:o})})),n}return t.forEach((function(e){var t=e.key,i=e.value;n.push({key:t,value:i,seq:0})})),n}},{key:"_getMessageExtensions",value:function(e,t){var n=this,i="".concat(this._n,"._getMessageExtensions"),r=e.ID,o=e.to,a=null;switch(kt(o)?b.CONV_TOPIC:e.conversationType){case b.CONV_C2C:a=this.getModule(Pn);break;case b.CONV_GROUP:a=this.getModule(Un);break;case b.CONV_TOPIC:a=this.getModule(Fn);break;default:return Xo({code:fo.CANNOT_FIND_MODULE})}return a.getMessageExtensions(e,t).then((function(t){var o=t.data,a=o.extensions,s=o.completeFlag,c=o.globalSequence,u=o.clearSequence;if(a=$t(a)?[]:a,Be.l("".concat(i," ok. completeFlag:").concat(s," globalSequence:").concat(c," clearSequence:").concat(u," count:").concat(a.length)),n._updateLocalExtension(r,a),n._clearLocalExtension(r,u),n._updateGlobalSequence(r,c),1!==s){var l=a.slice(-1)[0].seq+1;return n._getMessageExtensions(e,l)}return n._getLocalExtensions(r)})).catch((function(e){return Xo(e)}))}},{key:"_hasLocalExtension",value:function(e){return this.messageExtensionMap.has(e)}},{key:"_getLocalExtension",value:function(e){return this.messageExtensionMap.get(e)}},{key:"_updateLocalExtension",value:function(e,t){this._hasLocalExtension(e)||this.messageExtensionMap.set(e,new Map);var n=this._getLocalExtension(e);t.forEach((function(e){var t=e.key,i=e.value,r=void 0===i?"":i,o=e.seq;n.set(t,{value:r,seq:o})}))}},{key:"_clearLocalExtension",value:function(e,t){if(!(t<=0)&&this._hasLocalExtension(e)){var n=this._getLocalExtension(e);n.forEach((function(e,i){e.seq<=t&&n.delete(i)}))}}},{key:"_getLocalExtensions",value:function(e){var t=[];return this._hasLocalExtension(e)&&this._getLocalExtension(e).forEach((function(e,n){var i=e.value;$t(i)||t.push({key:n,value:i})})),t}},{key:"_getGlobalSequence",value:function(e){return this.globalSeqMap.get(e)}},{key:"_updateGlobalSequence",value:function(e,t){this.globalSeqMap.set(e,t)}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this.messageExtensionMap.clear(),this.globalSeqMap.clear(),this.getMessageExtensionsMap.clear()}}]),n}(ci),Is=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="ComboMessageModule",r}return o(n,[{key:"sendMessage",value:function(e){var t=this,n=this._constructMessageInstance(e);if(null===n)return Xo({code:fo.MESSAGE_SEND_FAIL});this._addSendMessageTotalCount(n);var i=Date.now();return this.getModule(Vn).setMessageRandom(n),this._sendComboMessage(n,e).then((function(e){var r=e.data,o=r.time,a=r.sequence,s=r.readReceiptCode;nt(s)&&0!==s&&(new wo("sendMessageWithReceipt").setMessage("from:".concat(n.from," to:").concat(n.to," sequence:").concat(a," readReceiptCode:").concat(s)).end(),Be.w("".concat(t._n,".sendMessage readReceiptCode:").concat(s," message:").concat(t.getErrorMessage(s)))),t._addSendMessageSuccessCount(n,i);var c=t.getModule(Vn);n.status=Qt.SUCCESS,n.time=o,n.conversationType===b.CONV_GROUP&&(n.sequence=a),c.appendToMessageList(n);var u=n;return!0===n._isExcludedFromLastMessage&&(u=""),c.onMessageSent({conversationOptionsList:[{conversationID:n.conversationID,unreadCount:0,type:n.conversationType,subType:n.conversationSubType,lastMessage:u}]}),zo({message:n})})).catch((function(e){return t._onSendMessageFailed(n,e)}))}},{key:"_sendComboMessage",value:function(e,t){var n=this._m.getModule($n),i="";return e.conversationType===b.CONV_C2C&&(i="".concat(B.NAME.OPEN_IM,".").concat(B.CMD.SEND_MESSAGE)),e.conversationType===b.CONV_GROUP&&(i="".concat(B.NAME.GROUP,".").concat(B.CMD.SEND_GROUP_MESSAGE)),n.sendComboMessage({servcmd:i,data:t})}},{key:"_constructMessageInstance",value:function(e){var t="".concat(this._n,"._constructMessageInstance"),n=null;try{var i=this.getMyUserID(),r={};if(r.senderTinyID=this.getMyTinyID(),r.currentUser=i,r.from=e.From_Account||i,e.GroupId?(r.conversationID="".concat(b.CONV_GROUP).concat(e.GroupId),r.conversationType=b.CONV_GROUP,r.to=e.GroupId):e.To_Account&&(r.conversationID="".concat(b.CONV_C2C).concat(e.To_Account),r.conversationType=b.CONV_C2C,r.to=e.To_Account),r.time=e.MsgTimeStamp||0,r.random=e.Random||e.MsgRandom||0,r.priority=e.MsgPriority,it(e.CloudCustomData)&&e.CloudCustomData.length>0&&(r.cloudCustomData=e.CloudCustomData),at(e.SendMsgControl)&&(r.messageControlInfo={},e.SendMsgControl.includes("NoUnread")&&(r.messageControlInfo.excludedFromUnreadCount=1),e.SendMsgControl.includes("NoLastMsg")&&(r.messageControlInfo.excludedFromLastMessage=1)),r.conversationType===b.CONV_GROUP&&at(e.To_Account)&&e.To_Account.length>0){var o=e.To_Account;e.To_Account.length>50&&(o=e.To_Account.slice(0,50),Be.w("".concat(t," To_Account must be less than or equal to 50."))),r.receiverList=_(o),e.To_Account=_(o)}1!==e.IsNeedReadReceipt&&1!==e.NeedReadReceipt||(r.needReadReceipt=!0),1===e.SupportMessageExtension&&(r.isSupportExtension=!0),(n=new Ko(r)).status=Qt.UNSEND,e.MsgClientTime=n.clientTime,n.conversationType===b.CONV_C2C&&(e.MsgSeq=n.sequence);for(var a,s=e.MsgBody.length,c=0;c<s;c++)"TIMTextElem"===(a=e.MsgBody[c]).MsgType?n.setTextElement(a.MsgContent.Text):"TIMCustomElem"===a.MsgType?n.setCustomElement({data:a.MsgContent.Data||"",description:a.MsgContent.Desc||"",extension:a.MsgContent.Ext||""}):"TIMFaceElem"===a.MsgType&&n.setFaceElement({index:a.MsgContent.Index,data:a.MsgContent.Data});var u=n.getElements();n.payload=u[0].content,n.type=u[0].type}catch(l){n=null,Be.e("".concat(t," failed. error:"),l)}return n}},{key:"_onSendMessageFailed",value:function(e,t){e.status=Qt.FAIL,this.getModule(Vn).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,t);var n=new wo("sendMessage");return n.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)),this.probeNetwork().then((function(e){var i=v(e,2),r=i[0],o=i[1];n.setError(t,r,o).end()})),Be.e("".concat(this._n,"._onSendMessageFailed error:"),t),Xo(new Wo({code:t&&t.code?t.code:fo.MESSAGE_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if(e.conversationType===b.CONV_C2C)return vo;if(e.conversationType===b.CONV_GROUP){var t=this.getModule(Un).getLocalGroupProfile(e.to);if(!t)return;var n=t.type;return St(n)?yo:_o}}},{key:"_addSendMessageTotalCount",value:function(e){var t=this._getSendMessageSpecifiedKey(e);t&&this.getModule(ti).addTotalCount(t)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n=Math.abs(Date.now()-t),i=this._getSendMessageSpecifiedKey(e);if(i){var r=this.getModule(ti);r.addSuccessCount(i),r.addCost(i,n)}}},{key:"_addSendMessageFailCountOnUser",value:function(e,t){var n=t.code,i=void 0===n?-1:n,r=this.getModule(ti),o=this._getSendMessageSpecifiedKey(e);vs(i)&&o&&r.addFailedCountOfUserSide(o)}}]),n}(ci),Ms=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="PluginModule",r.plugins={},r}return o(n,[{key:"registerPlugin",value:function(e){var t=this;Object.keys(e).forEach((function(n){t.plugins[n]=e[n]})),new wo("registerPlugin").setMessage("".concat(Object.keys(e))).end()}},{key:"getPlugin",value:function(e){return this.plugins[e]}},{key:"reset",value:function(){}}]),n}(ci),Ts=function(e){s(r,e);var n=m(r);function r(e){var t;return i(this,r),(t=n.call(this,e))._n="SyncUnreadMessageModule",t._cookie="",t._onlineSyncFlag=!1,t.getInnerEmitterInstance().on(ea,t._onLoginSuccess,f(t)),t}return o(r,[{key:"_onLoginSuccess",value:function(e){this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"_startSync",value:function(e){var n=this,i=e.cookie,r=e.syncFlag,o=e.isOnlineSync,a="".concat(this._n,"._startSync");Be.l("".concat(a," cookie:").concat(i," syncFlag:").concat(r," isOnlineSync:").concat(o)),this.request({protocolName:hi,requestData:{cookie:i,syncFlag:r,isOnlineSync:o}}).then((function(e){var i=e.data,r=i.cookie,o=i.syncFlag;n._cookie=r,$t(r)||(0===o||1===o?(n._dispatchUnreadMessage(t(t({},e.data),{},{isSyncingEnded:!1})),n._startSync({cookie:r,syncFlag:o,isOnlineSync:0})):2===o&&n._dispatchUnreadMessage(t(t({},e.data),{},{isSyncingEnded:!0})))})).catch((function(e){Be.e("".concat(a," failed. error:"),e)}))}},{key:"_dispatchUnreadMessage",value:function(e){e.eventArray&&this.getModule($n).onMessage({head:{},body:{eventArray:e.eventArray,isInstantMessage:this._onlineSyncFlag,isSyncingEnded:e.isSyncingEnded}}),this.getModule(Pn).onNewC2CMessage({dataList:e.messageList,isInstantMessage:!!e.isSyncingEnded&&this._onlineSyncFlag,C2CRemainingUnreadList:e.C2CRemainingUnreadList,C2CPairUnreadList:e.C2CPairUnreadList})}},{key:"startOnlineSync",value:function(){Be.l("".concat(this._n,".startOnlineSync")),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:1})}},{key:"startSyncOnReconnected",value:function(){Be.l("".concat(this._n,".startSyncOnReconnected.")),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._onlineSyncFlag=!1,this._cookie=""}}]),r}(ci),Cs={request:{toAccount:"To_Account",fromAccount:"From_Account",to:"To_Account",from:"From_Account",groupID:"GroupId",groupAtUserID:"GroupAt_Account",extension:"Ext",data:"Data",description:"Desc",elements:"MsgBody",sizeType:"Type",downloadFlag:"Download_Flag",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",videoUrl:"",imageUrl:"URL",fileUrl:"Url",uuid:"UUID",priority:"MsgPriority",receiverUserID:"To_Account",receiverGroupID:"GroupId",messageSender:"SenderId",messageReceiver:"ReceiverId",nick:"From_AccountNick",avatar:"From_AccountHeadurl",messageNumber:"MsgNum",pbDownloadKey:"PbMsgKey",downloadKey:"JsonMsgKey",applicationType:"PendencyType",userIDList:"To_Account",groupNameList:"GroupName",userID:"To_Account",groupAttributeList:"GroupAttr",mainSequence:"AttrMainSeq",avChatRoomKey:"BytesKey",attributeControl:"AttrControl",sequence:"seq",messageControlInfo:"SendMsgControl",updateSequence:"UpdateSeq",clientTime:"MsgClientTime",sequenceList:"MsgSeqList",topicID:"TopicId",customData:"CustomString",isSupportTopic:"SupportTopic",isWebUniapp:"is_web_uniapp",isSupportExtension:"SupportMessageExtension",messageSequence:"MsgSeq",messageKey:"MsgKey",startSequence:"startSeq",simplifiedMessage:"DownsizeFlag"},response:{MsgPriority:"priority",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",Download_Flag:"downloadFlag",GroupId:"groupID",Member_Account:"userID",MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",MsgSeq:"sequence",MsgRandom:"random",MsgTime:"time",MsgTimeStamp:"time",MsgContent:"content",MsgBody:"elements",From_AccountNick:"nick",From_AccountHeadurl:"avatar",GroupWithdrawInfoArray:"revokedInfos",GroupReadInfoArray:"groupMessageReadNotice",LastReadMsgSeq:"lastMessageSeq",WithdrawC2cMsgNotify:"c2cMessageRevokedNotify",C2cWithdrawInfoArray:"revokedInfos",C2cReadedReceipt:"c2cMessageReadReceipt",ReadC2cMsgNotify:"c2cMessageReadNotice",LastReadTime:"peerReadTime",MsgRand:"random",MsgType:"type",MsgShow:"messageShow",NextMsgSeq:"nextMessageSeq",FaceUrl:"avatar",ProfileDataMod:"profileModify",Profile_Account:"userID",ValueBytes:"value",ValueNum:"value",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgFrom_AccountExtraInfo:"messageFromAccountExtraInformation",Operator_Account:"operatorID",OpType:"operationType",ReportType:"operationType",UserId:"userID",User_Account:"userID",List_Account:"userIDList",MsgOperatorMemberExtraInfo:"operatorInfo",MsgMemberExtraInfo:"memberInfoList",ImageUrl:"avatar",NickName:"nick",MsgGroupNewInfo:"newGroupProfile",MsgAppDefinedData:"groupCustomField",Owner_Account:"ownerID",GroupFaceUrl:"avatar",GroupIntroduction:"introduction",GroupNotification:"notification",GroupApplyJoinOption:"joinOption",MsgKey:"messageKey",GroupInfo:"groupProfile",ShutupTime:"muteTime",Desc:"description",Ext:"extension",GroupAt_Account:"groupAtUserID",MsgNum:"messageNumber",PbMsgKey:"pbDownloadKey",JsonMsgKey:"downloadKey",MsgModifiedFlag:"isModified",PendencyItem:"applicationItem",PendencyType:"applicationType",AddTime:"time",AddSource:"source",AddWording:"wording",ProfileImImage:"avatar",PendencyAdd:"friendApplicationAdded",FrienPencydDel_Account:"friendApplicationDeletedUserIDList",Peer_Account:"userID",GroupAttr:"groupAttributeList",GroupAttrAry:"groupAttributeList",AttrMainSeq:"mainSequence",seq:"sequence",GroupAttrOption:"groupAttributeOption",BytesChangedKeys:"changedKeyList",GroupAttrInfo:"groupAttributeList",GroupAttrSeq:"mainSequence",PushChangedAttrValFlag:"isWithChangedAttributeInfo",SubKeySeq:"sequence",Val:"value",MsgGroupFromCardName:"senderNameCard",MsgGroupFromNickName:"senderNick",C2cNick:"peerNick",C2cImage:"peerAvatar",SendMsgControl:"messageControlInfo",NoLastMsg:"excludedFromLastMessage",NoUnread:"excludedFromUnreadCount",UpdateSeq:"updateSequence",MuteNotifications:"muteFlag",MsgClientTime:"clientTime",TinyId:"tinyID",GroupMsgReceiptList:"readReceiptList",ReadNum:"readCount",UnreadNum:"unreadCount",TopicId:"topicID",MillionGroupFlag:"communityType",SupportTopic:"isSupportTopic",MsgTopicNewInfo:"newTopicInfo",ShutupAll:"muteAllMembers",CustomString:"customData",TopicFaceUrl:"avatar",TopicIntroduction:"introduction",TopicNotification:"notification",TopicIdArray:"topicIDList",MsgVersion:"messageVersion",C2cMsgModNotifys:"c2cMessageModified",GroupMsgModNotifys:"groupMessageModified",ApplyJoinOption:"joinOption",MsgFlag:"messageRemindType",AtInfoList:"groupAtInfoList",AtFlagList:"groupAtType",AtMsgSeq:"sequence",BanDuration:"duration",BanDescription:"reason",NotVisible:"invisible",BytesTag:"tag",BytesValue:"value",RptBytesValue:"value",LatestSeq:"globalSequence",ClearSeq:"clearSequence",SupportMessageExtension:"isSupportExtension",ExtensionList:"extensions",GroupCounter:"counterList",Revoker_Account:"revoker",MsgExtensionNotify:"messageExtensionNotify",ExtensionC2cMsgInfo:"messageInfo",ExtensionGroupMsgInfo:"messageInfo",MsgOptType:"operateType",SetKVInfo:"operateResultList",DeleteKVInfo:"operateResultList",ClearKVInfo:"operateResultList",MsgKeyValue:"extensions",ClearMsgSeq:"clearSequence",MsgLastSeq:"globalSequence",InviteJoinOption:"inviteOption",MemberList_Account:"inviteeList",MsgMemberExtraInfoList:"inviteeInfoList",E:"event",GInf:"groupProfile",MCT:"clientTime",MR:"random",MP:"priority",MTS:"time",GId:"groupID",MS:"sequence",CCD:"cloudCustomData",F_Account:"from",F_Hd:"avatar",F_NN:"nick",GN:"groupName",GT:"groupType",IsSys:"isSystemMessage",OpInf:"operatorInfo",Img:"avatar",NN:"nick",OnlineInf:"onlineMemberInfo",ET:"expireTime",Num:"onlineMemberNum",Opt:"operationType",O_Account:"operatorID",RT:"operationType",UDF:"userDefinedField",L_Account:"userIDList"},ignoreKeyWord:["C2C","ID","USP"]};function Ss(e,t){if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");var n;return t=Object.assign({pascalCase:!1},t),0===(e=Array.isArray(e)?e.map((function(e){return e.trim()})).filter((function(e){return e.length})).join("-"):e.trim()).length?"":1===e.length?t.pascalCase?e.toUpperCase():e.toLowerCase():(e!==e.toLowerCase()&&(e=Es(e)),n=e=e.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,(function(e,t){return t.toUpperCase()})).replace(/\d+(\w|$)/g,(function(e){return e.toUpperCase()})),t.pascalCase?n.charAt(0).toUpperCase()+n.slice(1):n)}var Es=function(e){for(var t=!1,n=!1,i=!1,r=0;r<e.length;r++){var o=e[r];t&&/[a-zA-Z]/.test(o)&&o.toUpperCase()===o?(e=e.slice(0,r)+"-"+e.slice(r),t=!1,i=n,n=!0,r++):n&&i&&/[a-zA-Z]/.test(o)&&o.toLowerCase()===o?(e=e.slice(0,r-1)+"-"+e.slice(r-1),i=n,n=!1,t=!0):(t=o.toLowerCase()===o&&o.toUpperCase()!==o,i=n,n=o.toUpperCase()===o&&o.toLowerCase()!==o)}return e};function ks(e,t){var n=0;return function e(t,i){if(++n>100)return n--,t;if(at(t)){var r=t.map((function(t){return rt(t)?e(t,i):t}));return n--,r}if(rt(t)){var o=(a=t,s=function(e,t){if(!pt(t))return!1;if((r=t)!==Ss(r))for(var n=0;n<Cs.ignoreKeyWord.length&&!t.includes(Cs.ignoreKeyWord[n]);n++);var r,o;return st(i[t])?"OPPOChannelID"===(o=t)?o:o[0].toUpperCase()+Ss(o).slice(1):i[t]},c=Object.create(null),Object.keys(a).forEach((function(e){var t=s(a[e],e);t&&(c[t]=a[e])})),c);return o=At(o,(function(t,n){return at(t)||rt(t)?e(t,i):t})),n--,o}var a,s,c}(e,t)}function bs(e,t){if(at(e))return e.map((function(e){return rt(e)?bs(e,t):e}));if(rt(e)){var n=(i=e,r=function(e,n){return st(t[n])?Ss(n):t[n]},o={},Object.keys(i).forEach((function(e){o[r(i[e],e)]=i[e]})),o);return At(n,(function(e){return at(e)||rt(e)?bs(e,t):e}))}var i,r,o}var Ds=String.fromCharCode,ws=function(e){var t=0|e.charCodeAt(0);if(55296<=t)if(t<56320){var n=0|e.charCodeAt(1);if(56320<=n&&n<=57343){if((t=(t<<10)+n-56613888|0)>65535)return Ds(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}else t=65533}else t<=57343&&(t=65533);return t<=2047?Ds(192|t>>>6,128|63&t):Ds(224|t>>>12,128|t>>>6&63,128|63&t)},As=function(e){for(var t=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ws),n=0|t.length,i=new Uint8Array(n),r=0;r<n;r=r+1|0)i[r]=0|t.charCodeAt(r);return i},Rs=function(e){for(var t=new Uint8Array(e),n="",i=0,r=t.length;i<r;){var o=t[i],a=0,s=0;if(o<=127?(a=0,s=255&o):o<=223?(a=1,s=31&o):o<=239?(a=2,s=15&o):o<=244&&(a=3,s=7&o),r-i-a>0)for(var c=0;c<a;)s=s<<6|63&(o=t[i+c+1]),c+=1;else s=65533,a=r-i;n+=String.fromCodePoint(s),i+=a+1}return n},Ls=function(){function e(t){i(this,e),this._handler=t;var n=t.getURL();if(this._socket=null,this._workerSocket=null,this._id=mt(),this._handler.getIsWorkerEnabled()){var r=URL.createObjectURL(new Blob([';let _socket = null;onmessage = function(event) {  if (event.data.cmd === "start") {    const url = event.data.url;    _socket = new WebSocket(url);    _socket.binaryType = "arraybuffer";    _socket.onopen = function() {      postMessage({ callback: "onOpen" });    };    _socket.onclose = function(e) {      postMessage({ callback: "onOpen", e: { code: e.code, reason: e.reason } });    };    _socket.onmessage = function(e) {      postMessage({ callback: "onMessage", data: e.data });    };    _socket.onerror = function(e) {      postMessage({ callback: "onError", e: { isTrusted: "true" } });    };  } else if (event.data.cmd === "sendMessage") {    if (_socket !== null) {      _socket.send(event.data.data);    }  } else if (event.data.cmd === "stop") {    if (_socket !== null) {      _socket.close(event.data.code);      _socket = null;    }  }};'],{type:"application/javascript; charset=utf-8"}));this._workerSocket=new Worker(r);var o=this;this._workerSocket.onmessage=function(e){var t=e.data,n=t.callback,i=t.e;"onOpen"===n?o._onOpen():"onClose"===n?o._onClose(i):"onError"===n?o._onError(i):"onMessage"===n&&o._onMessage(e.data)},this._workerSocket.postMessage({cmd:"start",id:this._id,url:n})}else oe?te?(se.connectSocket({url:n,header:{"content-type":"application/json"}}),se.onSocketClose(this._onClose.bind(this)),se.onSocketOpen(this._onOpen.bind(this)),se.onSocketMessage(this._onMessage.bind(this)),se.onSocketError(this._onError.bind(this))):(this._socket=se.connectSocket({url:n,header:{"content-type":"application/json"},complete:function(){}}),this._socket.onClose(this._onClose.bind(this)),this._socket.onOpen(this._onOpen.bind(this)),this._socket.onMessage(this._onMessage.bind(this)),this._socket.onError(this._onError.bind(this))):ae&&(this._socket=new WebSocket(n),this._socket.binaryType="arraybuffer",this._socket.onopen=this._onOpen.bind(this),this._socket.onmessage=this._onMessage.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this));this._canIUseBinaryFrame=t.canIUseBinaryFrame()}return o(e,[{key:"getID",value:function(){return this._id}},{key:"_onOpen",value:function(){this._handler.onOpen({id:this._id})}},{key:"_onClose",value:function(e){this._handler.onClose({id:this._id,e:e})}},{key:"_onMessage",value:function(e){this._handler.onMessage({data:this._canIUseBinaryFrame?Rs(e.data):e.data})}},{key:"_onError",value:function(e){this._handler.onError({id:this._id,e:e})}},{key:"setIsWorkerEnabled",value:function(e){this._isWorkerEnabled=!0}},{key:"close",value:function(e){if(this._workerSocket&&(this._workerSocket.postMessage({cmd:"stop",code:e}),this._workerSocket.terminate(),this._workerSocket=null),te)return se.offSocketClose(),se.offSocketMessage(),se.offSocketOpen(),se.offSocketError(),void se.closeSocket();this._socket&&(oe?(this._socket.onClose((function(){})),this._socket.onOpen((function(){})),this._socket.onMessage((function(){})),this._socket.onError((function(){}))):ae&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null),ee?this._socket.close({code:e}):this._socket.close(e),this._socket=null)}},{key:"send",value:function(e){if(this._workerSocket)this._workerSocket.postMessage({cmd:"sendMessage",data:this._canIUseBinaryFrame?As(e.data).buffer:e.data});else{if(te)return void se.sendSocketMessage({data:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}});this._socket&&(oe?this._socket.send({data:this._canIUseBinaryFrame?As(e.data).buffer:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):ae&&this._socket.send(this._canIUseBinaryFrame?As(e.data).buffer:e.data))}}}]),e}(),Os=4e3,Ns=4001,Ps=["keyMap"],Us=["keyMap"],xs="connected",Gs="connecting",Fs="disconnected",Vs=function(){function e(t){i(this,e),this._channelModule=t,this._n="SocketHandler",this._promiseMap=new Map,this._readyState=Fs,this._simpleRequestMap=new Map,this.MAX_SIZE=100,this._startSequence=mt(),this._startTs=0,this._reConnectFlag=!1,this._nextPingTs=0,this._reConnectCount=0,this.MAX_RECONNECT_COUNT=3,this._socketID=-1,this._random=0,this._socket=null,this._url="",this._onOpenTs=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0,this._setWebsocketHost(),this._initConnection()}return o(e,[{key:"_setWebsocketHost",value:function(){var e=this._channelModule.getModule(qn),t=N;this._channelModule.isOversea()&&(t=P),e.isSingaporeSite()?t=U:e.isKoreaSite()?t=x:e.isGermanySite()?t=G:e.isIndiaSite()?t=F:e.isJapanSite()?t=V:e.isUSASite()&&(t=q),B.HOST.setCurrent(t)}},{key:"_initConnection",value:function(){st(B.HOST.CURRENT.BACKUP)||""===this._url?this._url=B.HOST.CURRENT.DEFAULT:this._url===B.HOST.CURRENT.DEFAULT?this._url=B.HOST.CURRENT.BACKUP:this._url===B.HOST.CURRENT.BACKUP?this._url=this._canIUseAnyCast()?B.HOST.CURRENT.ANYCAST:B.HOST.CURRENT.DEFAULT:this._url===B.HOST.CURRENT.ANYCAST&&(B.HOST.CURRENT.ANYCAST="",this._url=B.HOST.CURRENT.DEFAULT);var e=this._channelModule.getModule(qn).getProxyServer();$t(e)||(this._url=e),this._connect(),this._nextPingTs=0}},{key:"_canIUseAnyCast",value:function(){return ae&&B.HOST.CURRENT.ANYCAST}},{key:"onCheckTimer",value:function(e){e%1==0&&this._checkPromiseMap()}},{key:"_checkPromiseMap",value:function(){var e=this;0!==this._promiseMap.size&&this._promiseMap.forEach((function(t,n){var i=t.reject,r=t.timestamp,o=15e3;-1!==n.indexOf(ui)&&(o=9e4),Date.now()-r>=o&&(Be.l("".concat(e._n,"._checkPromiseMap request timeout, delete requestID:").concat(n)),e._promiseMap.delete(n),i(new Wo({code:fo.NETWORK_TIMEOUT})),e._channelModule.onRequestTimeout(n))}))}},{key:"onOpen",value:function(e){if(""!==this._readyState){this._onOpenTs=Date.now();var t=e.id;this._socketID=t;var n=Date.now()-this._startTs;Be.l("".concat(this._n,"._onOpen cost ").concat(n," ms. socketID:").concat(t)),new wo("wsOnOpen").setMessage(n).setCostTime(n).setMoreMessage("socketID:".concat(t)).end(),e.id===this._socketID&&(this._readyState=xs,this._reConnectCount=0,this._resend(),!0===this._reConnectFlag&&(this._channelModule.onReconnected(),this._reConnectFlag=!1),this._channelModule.onOpen())}}},{key:"onClose",value:function(e){var t=new wo("wsOnClose"),n=e.id,i=e.e,r="sourceSocketID:".concat(n," currentSocketID:").concat(this._socketID," code:").concat(i.code," reason:").concat(i.reason),o=0;0!==this._onOpenTs&&(o=Date.now()-this._onOpenTs),t.setMessage(o).setCostTime(o).setMoreMessage(r).setCode(i.code).end(),Be.l("".concat(this._n,"._onClose ").concat(r," onlineTime:").concat(o)),n===this._socketID&&(this._readyState=Fs,o<1e3?this._channelModule.onReconnectFailed():this._channelModule.onClose())}},{key:"onError",value:function(e){var t=e.id,n=e.e,i="sourceSocketID:".concat(t," currentSocketID:").concat(this._socketID);new wo("wsOnError").setMessage(n.errMsg||ft(n)).setMoreMessage(i).setLevel("error").end(),Be.w("".concat(this._n,"._onError"),n,i),t===this._socketID&&(this._readyState="",this._channelModule.onError())}},{key:"onMessage",value:function(e){var t;try{t=JSON.parse(e.data)}catch(u){new wo("jsonParseError").setMessage(e.data).end()}if(t&&t.head){var n=this._getRequestIDFromHead(t.head),i=t.body;if(!n.startsWith(B.NAME.TUIROOM_SVR)){var r=xt(t.head);i=bs(t.body,this._getResponseKeyMap(r))}if(Be.d("".concat(this._n,".onMessage ret:").concat(JSON.stringify(i)," requestID:").concat(n," has:").concat(this._promiseMap.has(n))),this._setNextPingTs(),this._promiseMap.has(n)){var o=this._promiseMap.get(n),a=o.resolve,s=o.reject,c=o.timestamp;return this._promiseMap.delete(n),this._calcRTT(c),void(i.errorCode&&0!==i.errorCode?(this._channelModule.onErrorCodeNotZero(i),s(new Wo({code:i.errorCode,message:i.errorInfo||"",data:n.includes(wi)||n.includes(yr)?{elements:i.elements,messageVersion:i.messageVersion,cloudCustomData:i.cloudCustomData}:void 0}))):a(zo(i)))}this._channelModule.onMessage({head:t.head,body:i})}}},{key:"_calcRTT",value:function(e){var t=Date.now()-e;this._channelModule.getModule(ti).addRTT(t)}},{key:"_connect",value:function(){this._startTs=Date.now(),this._onOpenTs=0,this._socket=new Ls(this),this._socketID=this._socket.getID(),this._readyState=Gs,Be.l("".concat(this._n,"._connect isWorkerEnabled:").concat(this.getIsWorkerEnabled()," socketID:").concat(this._socketID," url:").concat(this.getURL())),new wo("wsConnect").setMessage("socketID:".concat(this._socketID," url:").concat(this.getURL())).end()}},{key:"getURL",value:function(){this._channelModule.isDevMode()&&(this._canIUseBinaryFrame=!1);var e=Ot();(te||X&&"windows"===e||ie)&&(this._canIUseBinaryFrame=!1);var t=-1;"ios"===e?t=ye||-1:"android"===e&&(t=Me||-1);var n=this._channelModule.getModule(qn),i=this._channelModule.getPlatform(),r=n.getSDKAppID(),o=n.getInstanceID(),a="sdkappid=".concat(r,"&instanceid=").concat(o,"&random=").concat(this._getRandom(),"&platform=").concat(i,"&host=").concat(e,"&version=").concat(t);return this._canIUseBinaryFrame?"".concat(this._url,"/binfo?").concat(a):"".concat(this._url,"/info?").concat(a)}},{key:"_closeConnection",value:function(e){Be.l("".concat(this._n,"._closeConnection socketID:").concat(this._socketID)),this._socket&&(this._socket.close(e),this._socketID=-1,this._socket=null,this._readyState=Fs)}},{key:"_resend",value:function(){var e=this;if(Be.l("".concat(this._n,"._resend reConnectFlag:").concat(this._reConnectFlag),"promiseMap.size:".concat(this._promiseMap.size," simpleRequestMap.size:").concat(this._simpleRequestMap.size)),this._promiseMap.size>0&&this._promiseMap.forEach((function(t,n){var i=t.uplinkData,r=t.resolve,o=t.reject;e._promiseMap.set(n,{resolve:r,reject:o,timestamp:Date.now(),uplinkData:i}),e._execute(n,i)})),this._simpleRequestMap.size>0){var t,n=E(this._simpleRequestMap);try{for(n.s();!(t=n.n()).done;){var i=v(t.value,2),r=i[0],o=i[1];this._execute(r,o)}}catch(a){n.e(a)}finally{n.f()}this._simpleRequestMap.clear()}}},{key:"send",value:function(e){var t=this;e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap;var n=h(e,Ps),i=this._getRequestIDFromHead(e.head),r=JSON.stringify(n);return new Promise((function(e,o){t._promiseMap.set(i,{resolve:e,reject:o,timestamp:Date.now(),uplinkData:r}),Be.d("".concat(t._n,".send uplinkData:").concat(JSON.stringify(n)," requestID:").concat(i," readyState:").concat(t._readyState)),t._readyState!==xs?t._reConnect():(t._execute(i,r),t._channelModule.getModule(ti).addRequestCount())}))}},{key:"simplySend",value:function(e){e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap;var t=h(e,Us),n=this._getRequestIDFromHead(e.head),i=JSON.stringify(t);this._readyState!==xs?(this._simpleRequestMap.size<this.MAX_SIZE?this._simpleRequestMap.set(n,i):Be.l("".concat(this._n,".simplySend. simpleRequestMap is full, drop request!")),this._reConnect()):this._execute(n,i)}},{key:"_execute",value:function(e,t){this._socket.send({data:t,fail:oe?this._onSendFail.bind(this):void 0,requestID:e})}},{key:"_onSendFail",value:function(e){Be.l("".concat(this._n,"._onSendFail requestID:").concat(e))}},{key:"_getSequence",value:function(){var e;if(this._startSequence<2415919103)return e=this._startSequence,this._startSequence+=1,2415919103===this._startSequence&&(this._startSequence=mt()),e}},{key:"_getRequestIDFromHead",value:function(e){return e.servcmd+e.seq}},{key:"_getResponseKeyMap",value:function(e){var n=this._channelModule.getKeyMap(e);return t(t({},Cs.response),n.response)}},{key:"_reConnect",value:function(){this._readyState!==xs&&this._readyState!==Gs&&this.forcedReconnect()}},{key:"forcedReconnect",value:function(){var e=this,t="".concat(this._n,".forcedReconnect");Be.l("".concat(t," count:").concat(this._reConnectCount," readyState:").concat(this._readyState)),this._reConnectFlag=!0,this._resetRandom(),this._reConnectCount<this.MAX_RECONNECT_COUNT?(this._reConnectCount+=1,this._closeConnection(Ns),this._initConnection()):(this._reConnectCount=0,this._channelModule.probeNetwork().then((function(n){var i=v(n,2),r=i[0];i[1],r?(Be.w("".concat(t," disconnected from wsserver but network is ok, continue...")),e._closeConnection(Ns),e._initConnection()):e._channelModule.onReconnectFailed()})))}},{key:"getReconnectFlag",value:function(){return this._reConnectFlag}},{key:"_setNextPingTs",value:function(){this._nextPingTs=Date.now()+1e4}},{key:"getNextPingTs",value:function(){return this._nextPingTs}},{key:"isConnected",value:function(){return this._readyState===xs}},{key:"canIUseBinaryFrame",value:function(){return this._canIUseBinaryFrame}},{key:"setIsWorkerEnabled",value:function(e){Be.l("".concat(this._n,".setIsWorkerEnabled flag:").concat(e)),this._isWorkerEnabled=e}},{key:"getIsWorkerEnabled",value:function(){return this._isWorkerEnabled&&De}},{key:"_getRandom",value:function(){return 0===this._random&&(this._random=Math.random()),this._random}},{key:"_resetRandom",value:function(){this._random=0}},{key:"close",value:function(){Be.l("".concat(this._n,".close")),this._closeConnection(Os),this._promiseMap.clear(),this._startSequence=mt(),this._readyState=Fs,this._simpleRequestMap.clear(),this._reConnectFlag=!1,this._reConnectCount=0,this._onOpenTs=0,this._url="",this._random=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0}}]),e}(),qs=function(e){s(n,e);var t=m(n);function n(e){var r;if(i(this,n),(r=t.call(this,e))._n="ChannelModule",r._socketHandler=new Vs(f(r)),r._probing=!1,r._isAppShowing=!0,r._previousState=b.NET_STATE_CONNECTED,oe&&"function"==typeof se.onAppShow&&"function"==typeof se.onAppHide){var o=r._onAppHide.bind(f(r)),a=r._onAppShow.bind(f(r));"function"==typeof se.offAppHide&&se.offAppHide(o),"function"==typeof se.offAppShow&&se.offAppShow(a),se.onAppHide(o),se.onAppShow(a)}return r._timerForNotLoggedIn=-1,r._timerForNotLoggedIn=setInterval(r.onCheckTimer.bind(f(r)),1e3),r._fatalErrorFlag=!1,r}return o(n,[{key:"onCheckTimer",value:function(e){this._socketHandler&&(this.isLoggedIn()?(this._timerForNotLoggedIn>0&&(clearInterval(this._timerForNotLoggedIn),this._timerForNotLoggedIn=-1),this._socketHandler.onCheckTimer(e)):this._socketHandler.onCheckTimer(1),this._checkNextPing())}},{key:"onErrorCodeNotZero",value:function(e){this.getModule($n).onErrorCodeNotZero(e)}},{key:"onMessage",value:function(e){this.getModule($n).onMessage(e)}},{key:"send",value:function(e){return this._socketHandler?this._previousState!==b.NET_STATE_CONNECTED&&e.head.servcmd.includes(qr)?(this.reConnect(),this._sendLogViaHTTP(e)):this._socketHandler.send(e):Promise.reject()}},{key:"_sendLogViaHTTP",value:function(e){var t=B.HOST.CURRENT.STAT;return new Promise((function(n,i){var r="".concat(t,"/v4/imopenstat/tim_web_report_v2?sdkappid=").concat(e.head.sdkappid,"&reqtime=").concat(Date.now()),o=JSON.stringify(e.body),a="application/x-www-form-urlencoded;charset=UTF-8";if(oe)se.request({url:r,data:o,method:"POST",timeout:3e3,header:{"content-type":a},success:function(){n()},fail:function(){i(new Wo({code:fo.NETWORK_ERROR}))}});else{var s=new XMLHttpRequest,c=setTimeout((function(){s.abort(),i(new Wo({code:fo.NETWORK_TIMEOUT}))}),3e3);s.onreadystatechange=function(){4===s.readyState&&(clearTimeout(c),200===s.status||304===s.status?n():i(new Wo({code:fo.NETWORK_ERROR})))},s.open("POST",r,!0),s.setRequestHeader("Content-type",a),s.send(o)}}))}},{key:"simplySend",value:function(e){return this._socketHandler?this._socketHandler.simplySend(e):Promise.reject()}},{key:"onOpen",value:function(){this._ping()}},{key:"onClose",value:function(){this._socketHandler&&this._socketHandler.getReconnectFlag()&&this._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED),this.reConnect()}},{key:"onError",value:function(){oe&&!ie&&this.outputWarning("DomainNameInMP"),this._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED)}},{key:"getKeyMap",value:function(e){return this.getModule($n).getKeyMap(e)}},{key:"_onAppHide",value:function(){this._isAppShowing=!1}},{key:"_onAppShow",value:function(){this._isAppShowing=!0}},{key:"onRequestTimeout",value:function(e){}},{key:"onReconnected",value:function(){Be.l("".concat(this._n,".onReconnected")),this._m.restartTimer(),this.getModule($n).onReconnected(),this._emitNetStateChangeEvent(b.NET_STATE_CONNECTED)}},{key:"onReconnectFailed",value:function(){Be.l("".concat(this._n,".onReconnectFailed")),this._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED)}},{key:"setIsWorkerEnabled",value:function(e){this._socketHandler&&this._socketHandler.setIsWorkerEnabled(!1)}},{key:"offline",value:function(){this._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED)}},{key:"reConnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!1;this._socketHandler&&(t=this._socketHandler.getReconnectFlag());var n="forcedFlag:".concat(e," fatalErrorFlag:").concat(this._fatalErrorFlag," previousState:").concat(this._previousState," reconnectFlag:").concat(t);if(Be.l("".concat(this._n,".reConnect ").concat(n)),!this._fatalErrorFlag&&this._socketHandler){if(!0===e)this._socketHandler.forcedReconnect();else{if(this._previousState===b.NET_STATE_CONNECTING&&t)return;this._socketHandler.forcedReconnect()}this._emitNetStateChangeEvent(b.NET_STATE_CONNECTING)}}},{key:"_emitNetStateChangeEvent",value:function(e){this._previousState!==e&&(Be.l("".concat(this._n,"._emitNetStateChangeEvent from ").concat(this._previousState," to ").concat(e)),this._previousState=e,this.emitOuterEvent(k.NET_STATE_CHANGE,{state:e}))}},{key:"_ping",value:function(){var e=this;if(!0!==this._probing){this._probing=!0;var t=this.getModule($n).getProtocolData({protocolName:Br});this.send(t).then((function(){e._probing=!1})).catch((function(t){if(Be.w("".concat(e._n,"._ping failed. error:"),t),e._probing=!1,t&&60002===t.code)return new wo("error").setMessage("code:".concat(t.code," message:").concat(t.message)).setNetworkType(e.getModule(jn).getNetworkType()).end(),e._fatalErrorFlag=!0,void e._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED);e.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];Be.l("".concat(e._n,"._ping failed. probe network, isAppShowing:").concat(e._isAppShowing," online:").concat(i," networkType:").concat(r)),i?e.reConnect():e._emitNetStateChangeEvent(b.NET_STATE_DISCONNECTED)}))}))}}},{key:"_checkNextPing",value:function(){this._socketHandler&&this._socketHandler.isConnected()&&Date.now()>=this._socketHandler.getNextPingTs()&&this._ping()}},{key:"dealloc",value:function(){this._socketHandler&&(this._socketHandler.close(),this._socketHandler=null),this._timerForNotLoggedIn>-1&&clearInterval(this._timerForNotLoggedIn)}},{key:"onRestApiKickedOut",value:function(){this._socketHandler&&(this._socketHandler.close(),this.reConnect(!0))}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._previousState=b.NET_STATE_CONNECTED,this._probing=!1,this._fatalErrorFlag=!1,this._timerForNotLoggedIn=setInterval(this.onCheckTimer.bind(this),1e3)}}]),n}(ci),Bs=["a2","tinyid"],Hs=["a2","tinyid"],js=function(){function e(t){i(this,e),this._n="ProtocolHandler",this._sessionModule=t,this._configMap=new Map,this._fillConfigMap()}return o(e,[{key:"_fillConfigMap",value:function(){this._configMap.clear();var e=this._sessionModule.genCommonHead(),n=this._sessionModule.genCosSpecifiedHead(),i=this._sessionModule.genSSOReportHead(),r=this._sessionModule.isIntl();this._configMap.set(ui,{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.LOGIN)}),body:{state:"Online",isWebUniapp:0,deviceBrand:0},keyMap:{request:{deviceBrand:"InstType"},response:{InstId:"instanceID",HelloInterval:"helloInterval"}}}),this._configMap.set(li,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.LOGOUT)}),body:{type:0},keyMap:{request:{type:"wslogout_type"}}}}(e)),this._configMap.set(di,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.HELLO)}),body:{isWebUniapp:0},keyMap:{response:{NewInstInfo:"newInstanceInfo"}}}}(e)),this._configMap.set(pi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.STAT_SERVICE,".").concat(B.CMD.KICK_OTHER)}),body:{}}}(e)),this._configMap.set(Gr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_COS_SIGN,".").concat(B.CMD.COS_SIGN)}),body:{cmd:"open_im_cos_svc",subCmd:"get_cos_token",duration:300,version:2},keyMap:{request:{userSig:"usersig",subCmd:"sub_cmd",cmd:"cmd",duration:"duration",version:"version"},response:{expired_time:"expiredTime",bucket_name:"bucketName",session_token:"sessionToken",tmp_secret_id:"secretId",tmp_secret_key:"secretKey"}}}}(n)),this._configMap.set(Fr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.CUSTOM_UPLOAD,".").concat(B.CMD.COS_PRE_SIG)}),body:{fileType:void 0,fileName:void 0,uploadMethod:0,duration:900},keyMap:{request:{userSig:"usersig",fileType:"file_type",fileName:"file_name",uploadMethod:"upload_method"},response:{expired_time:"expiredTime",request_id:"requestId",head_url:"headUrl",upload_url:"uploadUrl",download_url:"downloadUrl",ci_url:"ciUrl",snapshot_url:"requestSnapshotUrl"}}}}(n)),this._configMap.set(Vr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.CUSTOM_UPLOAD,".").concat(B.CMD.VIDEO_COVER)}),body:{version:1,platform:void 0,coverName:void 0,requestSnapshotUrl:void 0},keyMap:{request:{version:"version",platform:"platform",coverName:"cover_name",requestSnapshotUrl:"snapshot_url"},response:{error_code:"errorCode",error_msg:"errorInfo",download_url:"snapshotUrl"}}}}(n)),this._configMap.set(Xr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_CONFIG_MANAGER,".").concat(B.CMD.FETCH_COMMERCIAL_CONFIG)}),body:{SDKAppID:0},keyMap:{request:{SDKAppID:"uint32_sdkappid"},response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}}(e)),this._configMap.set(Zr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_CONFIG_MANAGER,".").concat(B.CMD.PUSHED_COMMERCIAL_CONFIG)}),body:{},keyMap:{response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}}(e)),this._configMap.set($r,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_CONFIG_MANAGER,".").concat(B.CMD.FETCH_CLOUD_CONTROL_CONFIG)}),body:{SDKAppID:0,version:0},keyMap:{request:{SDKAppID:"uint32_sdkappid",version:"uint64_version"},response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}}(e)),this._configMap.set(Jr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_CONFIG_MANAGER,".").concat(B.CMD.PUSHED_CLOUD_CONTROL_CONFIG)}),body:{},keyMap:{response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}}(e)),this._configMap.set(Qr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OVERLOAD_PUSH,".").concat(B.CMD.OVERLOAD_NOTIFY)}),body:{},keyMap:{response:{OverLoadServCmd:"overloadCommand",DelaySecs:"waitingTime"}}}}(e)),this._configMap.set(hi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.GET_MESSAGES)}),body:{cookie:"",syncFlag:0,needAbstract:1,isOnlineSync:0,needSignaling:1},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",from:"From_Account",to:"To_Account",time:"MsgTimeStamp",sequence:"MsgSeq",random:"MsgRandom",elements:"MsgBody"},response:{MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",ClientSeq:"clientSequence",MsgSeq:"sequence",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgRandom:"random",MsgTimeStamp:"time",MsgContent:"content",ToGroupId:"to",MsgKey:"messageKey",GroupTips:"groupTips",MsgBody:"elements",MsgType:"type",C2CRemainingUnreadCount:"C2CRemainingUnreadList",C2CPairUnreadCount:"C2CPairUnreadList"}}}}(e)),r||(this._configMap.set(fi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.BIG_DATA_HALLWAY_AUTH_KEY)}),body:{}}}(e)),this._configMap.set(po,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_MSG_AUDIT_MGR,".").concat(B.CMD.GET_RPOFANITY_LIST)}),body:{version:0,deviceID:"",startIndex:void 0},keyMap:{request:{version:"uint64_version",deviceID:"str_device_id",startIndex:"uint64_start_index"},response:{msg_cmd_error_code:"errorInfo",str_err_msg:"errorMessage",uint32_code:"errorCode",msg_scene_ctl_config:"filterConfig",uint64_c2c_custom_msg_flag:"c2c_custom_message",uint64_c2c_text_msg_flag:"c2c_text_message",uint64_group_custom_msg_flag:"group_custom_message",uint64_group_text_msg_flag:"group_text_message",uint64_group_info_flag:"group_profile",uint64_group_member_info_flag:"group_member_profile",uint64_relation_chain_flag:"sns",uint64_user_info_flag:"user_profile",rpt_msg_dirty_word:"lexicon",str_dirty_word:"profanity",str_replaced_content:"replacement",uint64_filter_type:"filterType",uint64_id:"id",uint64_word_type:"profanityType",uint64_complete_flag:"completeFlag",uint64_next_start_index:"nextStartIndex",uint64_version:"version",uint64_expired_time:"expiredTime"}}}}(e))),this._configMap.set(gi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.SEND_MESSAGE)}),body:{fromAccount:"",toAccount:"",msgSeq:0,msgRandom:0,msgBody:[],cloudCustomData:void 0,nick:"",avatar:"",msgLifeTime:void 0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{badgeMode:0,isVoipPush:void 0},androidInfo:{OPPOChannelID:""}},messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,isSupportExtension:0},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",count:"MaxCnt",lastMessageTime:"LastMsgTime",messageKey:"MsgKey",peerAccount:"Peer_Account",data:"Data",description:"Desc",extension:"Ext",type:"MsgType",content:"MsgContent",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",nick:"From_AccountNick",avatar:"From_AccountHeadurl",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"IsNeedReadReceipt"}}}}(e)),this._configMap.set(mi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.SEND_GROUP_MESSAGE)}),body:{fromAccount:"",groupID:"",random:0,clientSequence:0,priority:"",msgBody:[],cloudCustomData:void 0,onlineOnlyFlag:0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{badgeMode:0,isVoipPush:void 0},androidInfo:{OPPOChannelID:""}},groupAtInfo:[],messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,topicID:void 0,receiverList:void 0,isSupportExtension:0},keyMap:{request:{to:"GroupId",extension:"Ext",data:"Data",description:"Desc",random:"Random",sequence:"ReqMsgSeq",count:"ReqMsgNumber",type:"MsgType",priority:"MsgPriority",content:"MsgContent",elements:"MsgBody",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",clientSequence:"ClientSeq",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"NeedReadReceipt",receiverList:"To_Account"},response:{MsgTime:"time",MsgSeq:"sequence"}}}}(e)),this._configMap.set(Ti,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.REVOKE_C2C_MESSAGE)}),body:{msgInfo:{fromAccount:"",toAccount:"",msgTimeStamp:0,msgSeq:0,msgRandom:0}},keyMap:{request:{msgInfo:"MsgInfo",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom"}}}}(e)),this._configMap.set(or,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.REVOKE_GROUP_MESSAGE)}),body:{groupID:"",msgSeqList:void 0,topicID:""},keyMap:{request:{msgSeqList:"MsgSeqList",msgSeq:"MsgSeq"}}}}(e)),this._configMap.set(ki,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.GET_C2C_ROAM_MESSAGES)}),body:{peerAccount:"",count:15,lastMessageTime:0,messageKey:"",withRecalledMessage:1,direction:0},keyMap:{request:{messageKey:"MsgKey",peerAccount:"Peer_Account",count:"MaxCnt",lastMessageTime:"LastMsgTime",withRecalledMessage:"WithRecalledMsg",direction:"GetDirection"},response:{LastMsgTime:"lastMessageTime",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer"}}}}(e)),this._configMap.set(wi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.MODIFY_C2C_MESSAGE)}),body:{from:"",to:"",sequence:0,random:0,time:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{request:{sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}}(e)),this._configMap.set(cr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_GROUP_ROAM_MESSAGES)}),body:{withRecalledMsg:1,groupID:"",count:15,sequence:"",topicID:void 0},keyMap:{request:{sequence:"ReqMsgSeq",count:"ReqMsgNumber",withRecalledMessage:"WithRecalledMsg"},response:{Random:"random",MsgTime:"time",MsgSeq:"sequence",ReqMsgSeq:"sequence",RspMsgList:"messageList",IsPlaceMsg:"isPlaceMessage",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgPriority:"priority",MsgBody:"elements",MsgType:"type",MsgContent:"content",IsFinished:"complete",Download_Flag:"downloadFlag",ClientSeq:"clientSequence",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList"}}}}(e)),this._configMap.set(Ci,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.SET_C2C_MESSAGE_READ)}),body:{C2CMsgReaded:void 0},keyMap:{request:{lastMessageTime:"LastedMsgTime"}}}}(e)),this._configMap.set(Si,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.SET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{userIDList:void 0,muteFlag:0},keyMap:{request:{userIDList:"Peer_Account",muteFlag:"Mute_Notifications"}}}}(e)),this._configMap.set(Ei,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.GET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{updateSequence:0},keyMap:{response:{MuteNotificationsList:"muteFlagList"}}}}(e)),this._configMap.set(ar,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.SET_GROUP_MESSAGE_READ)}),body:{groupID:void 0,messageReadSeq:void 0,topicID:void 0},keyMap:{request:{messageReadSeq:"MsgReadedSeq"}}}}(e)),this._configMap.set(sr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.SET_ALL_MESSAGE_READ)}),body:{readAllC2CMessage:0,groupMessageReadInfoList:[]},keyMap:{request:{readAllC2CMessage:"C2CReadAllMsg",groupMessageReadInfoList:"GroupReadInfo",messageSequence:"MsgSeq"},response:{C2CReadAllMsg:"readAllC2CMessage",GroupReadInfoArray:"groupMessageReadInfoList"}}}}(e)),this._configMap.set(Di,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.DELETE_C2C_MESSAGE)}),body:{fromAccount:"",to:"",keyList:void 0},keyMap:{request:{keyList:"MsgKeyList"}}}}(e)),this._configMap.set(_r,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.DELETE_GROUP_MESSAGE)}),body:{groupID:"",deleter:"",keyList:void 0,topicID:void 0},keyMap:{request:{deleter:"Deleter_Account",keyList:"Seqs"}}}}(e)),this._configMap.set(ho,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_TRANSLATE,".").concat(B.CMD.TRANSLATE_TEXT)}),body:{sourceTextList:void 0,SDKAppID:0,from:0,source:"",target:""},keyMap:{request:{sourceTextList:"SourceText",SDKAppID:"SdkAppId",from:"FromAccount"},response:{TargetText:"translatedTextList",RequestId:"requestID",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}}(e)),this._configMap.set(yr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.MODIFY_GROUP_MESSAGE)}),body:{groupID:"",topicID:void 0,sequence:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{request:{sequence:"MsgSeq",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}}(e)),this._configMap.set(ur,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{request:{sequence:"MsgSeq"}}}}(e)),this._configMap.set(dr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.SEND_C2C_READ_RECEIPT)}),body:{peerAccount:"",messageInfoList:void 0},keyMap:{request:{peerAccount:"Peer_Account",messageInfoList:"C2CMsgInfo",fromAccount:"From_Account",toAccount:"To_Account",sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",clientTime:"MsgClientTime"}}}}(e)),this._configMap.set(lr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.SEND_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{request:{sequenceList:"MsgSeqList",sequence:"MsgSeq"}}}}(e)),this._configMap.set(pr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_READ_RECEIPT_DETAIL)}),body:{groupID:"",sequence:void 0,flag:0,cursor:0,count:0},keyMap:{request:{sequence:"MsgSeq",count:"Num"},response:{ReadList:"readUserIDList",Read_Account:"userID",UnreadList:"unreadUserIDList",Unread_Account:"userID",IsFinish:"isCompleted"}}}}(e)),this._configMap.set(Ai,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM_MSG_EXT,".").concat(B.CMD.MODIFY_C2C_MESSAGE_EXTENSIONS)}),body:{from:void 0,to:void 0,messageKey:void 0,operateType:void 0,extensionList:void 0}}}(e)),this._configMap.set(Ri,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM_MSG_EXT,".").concat(B.CMD.GET_C2C_MESSAGE_EXTENSIONS)}),body:{from:void 0,to:void 0,messageKey:void 0,startSequence:void 0}}}(e)),this._configMap.set(Er,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM_MSG_EXT,".").concat(B.CMD.MODIFY_GROUP_MESSAGE_EXTENSIONS)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,operateType:void 0,extensionList:void 0}}}(e)),this._configMap.set(kr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM_MSG_EXT,".").concat(B.CMD.GET_GROUP_MESSAGE_EXTENSIONS)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,startSequence:void 0}}}(e)),this._configMap.set(bi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.GET_PEER_READ_TIME)}),body:{userIDList:void 0},keyMap:{request:{userIDList:"To_Account"},response:{ReadTime:"peerReadTimeList"}}}}(e)),this._configMap.set(Oi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.GET_CONVERSATION_LIST)}),body:{fromAccount:void 0,count:0},keyMap:{request:{},response:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime"}}}}(e)),this._configMap.set(Li,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.PAGING_GET_CONVERSATION_LIST)}),body:{fromAccount:void 0,timeStamp:void 0,startIndex:void 0,pinnedTimeStamp:void 0,pinnedStartIndex:void 0,orderType:void 0,messageAssistFlag:4,assistFlag:15},keyMap:{request:{messageAssistFlag:"MsgAssistFlags",assistFlag:"AssistFlags",pinnedTimeStamp:"TopTimeStamp",pinnedStartIndex:"TopStartIndex"},response:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime",LastMsgFlags:"lastMessageFlag",TopFlags:"isPinned",TopTimeStamp:"pinnedTimeStamp",TopStartIndex:"pinnedStartIndex",GroupId:"convGroupID"}}}}(e)),this._configMap.set(Ni,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.DELETE_CONVERSATION)}),body:{fromAccount:"",conversationList:void 0,clearHistoryMessage:void 0},keyMap:{request:{toGroupID:"ToGroupid",clearHistoryMessage:"ClearRamble",conversationList:"ContactItem"},response:{ResultItem:"resultList",ToGroupid:"toGroupID",ResultCode:"code",ResultInfo:"info"}}}}(e)),this._configMap.set(Pi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.CLEAR_HISTORY_MESSAGE)}),body:{fromAccount:"",toAccount:void 0,type:1,toGroupID:void 0},keyMap:{request:{toGroupID:"ToGroupid"}}}}(e)),this._configMap.set(Ui,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.PIN_CONVERSATION)}),body:{fromAccount:"",operationType:1,itemList:void 0},keyMap:{request:{itemList:"RecentContactItem"}}}}(e)),this._configMap.set(xi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.DELETE_GROUP_AT_TIPS)}),body:{messageListToDelete:void 0},keyMap:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}}(e)),this._configMap.set(Gi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.MARK_CONVERSATION)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},response:{ToGroupId:"groupID",OptType:"operationType"}}}}(e)),this._configMap.set(Fi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.MARK_CONVERSATION)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},response:{ToGroupId:"groupID",OptType:"operationType"}}}}(e)),this._configMap.set(Vi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.CREATE_CONVERSATION_GROUP)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"GroupContactItem",groupID:"ToGroupId"},response:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType"}}}}(e)),this._configMap.set(qi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.DELETE_CONVERSATION_GROUP)}),body:{fromAccount:"",groupName:void 0},keyMap:{request:{},response:{GroupId:"convGroupID"}}}}(e)),this._configMap.set(Bi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.UPDATE_CONVERSATION_GROUP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{request:{oldName:"OldGroupName",newName:"NewGroupName",groupID:"ToGroupId",operationType:"ContactOptType",groupName:"OldGroupName",updateItem:"ContactUpdateItem"},response:{ContactOptType:"operationType",ToGroupId:"groupID",GroupId:"convGroupID"}}}}(e)),this._configMap.set(Hi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.UPDATE_CONVERSATION_GROUP)}),body:{fromAccount:"",updateType:void 0,updateGroup:{groupName:void 0,updateGroupType:void 0,updateItem:void 0}},keyMap:{request:{},response:{}}}}(e)),this._configMap.set(ji,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.UPDATE_CONVERSATION_GROUP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{request:{},response:{}}}}(e)),this._configMap.set(Ki,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.RECENT_CONTACT,".").concat(B.CMD.GET_CONVERSATION_GROUP_LIST)}),body:{fromAccount:"",startTime:void 0,startIndex:void 0},keyMap:{request:{},response:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList"}}}}(e)),this._configMap.set(vi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.PROFILE,".").concat(B.CMD.PORTRAIT_GET)}),body:{fromAccount:"",userItem:[]},keyMap:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}}(e)),this._configMap.set(_i,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.PROFILE,".").concat(B.CMD.PORTRAIT_SET)}),body:{fromAccount:"",profileItem:[{tag:je.NICK,value:""},{tag:je.GENDER,value:""},{tag:je.ALLOWTYPE,value:""},{tag:je.AVATAR,value:""}]},keyMap:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}}(e)),this._configMap.set(yi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.GET_BLACKLIST)}),body:{fromAccount:"",startIndex:0,maxLimited:30,lastSequence:0},keyMap:{response:{CurruentSequence:"currentSequence"}}}}(e)),this._configMap.set(Ii,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.ADD_BLACKLIST)}),body:{fromAccount:"",toAccount:[]}}}(e)),this._configMap.set(Mi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.FRIEND,".").concat(B.CMD.DELETE_BLACKLIST)}),body:{fromAccount:"",toAccount:[]}}}(e)),this._configMap.set(ro,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.SET_SELF_STATUS)}),body:{customStatus:""},keyMap:{}}}(e)),this._configMap.set(oo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.GET_USER_STATUS)}),body:{userIDList:void 0},keyMap:{response:{UserStatusList:"successUserList",ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID",Status:"statusType"}}}}(e)),this._configMap.set(ao,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.SUBSCRIBE_USER_STATUS)}),body:{userIDList:void 0},keyMap:{response:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}}(e)),this._configMap.set(so,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.UNSUBSCRIBE_USER_STATUS)}),body:{userIDList:void 0,unsubscribeAll:void 0},keyMap:{response:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}}(e)),this._configMap.set(zi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_JOINED_GROUPS)}),body:{memberAccount:"",limit:void 0,offset:void 0,groupType:void 0,responseFilter:{groupBaseInfoFilter:void 0,selfInfoFilter:void 0},isSupportTopic:0},keyMap:{request:{memberAccount:"Member_Account"},response:{GroupIdList:"groups",NoUnreadSeqList:"excludedUnreadSequenceList",MsgSeq:"readedSequence",LastRecallTime:"_lastRevokedTime"}}}}(e)),this._configMap.set(Wi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_GROUP_INFO)}),body:{groupIDList:void 0,responseFilter:{groupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember"],groupCustomFieldFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0}},keyMap:{request:{groupIDList:"GroupIdList",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",groupCustomFieldFilter:"AppDefinedDataFilter_Group",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{GroupIdList:"groups",AppDefinedData:"groupCustomField",AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_Group:"groupCustomFieldFilter",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",InfoSeq:"infoSequence",MemberList:"members",GroupInfo:"groups",ShutUpUntil:"muteUntil",ShutUpAllMember:"muteAllMembers"}}}}(e)),this._configMap.set(Yi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.CREATE_GROUP)}),body:{type:void 0,name:void 0,groupID:void 0,ownerID:void 0,introduction:void 0,notification:void 0,maxMemberNum:void 0,joinOption:void 0,memberList:void 0,groupCustomField:void 0,memberCustomField:void 0,webPushFlag:1,avatar:"",isSupportTopic:void 0,inviteOption:void 0},keyMap:{request:{ownerID:"Owner_Account",userID:"Member_Account",avatar:"FaceUrl",maxMemberNum:"MaxMemberCount",joinOption:"ApplyJoinOption",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",inviteOption:"InviteJoinOption"},response:{HugeGroupFlag:"avChatRoomFlag",OverJoinedGroupLimit_Account:"overLimitUserIDList"}}}}(e)),this._configMap.set($i,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.DESTROY_GROUP)}),body:{groupID:void 0}}}(e)),this._configMap.set(Ji,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.MODIFY_GROUP_INFO)}),body:{groupID:void 0,name:void 0,introduction:void 0,notification:void 0,avatar:void 0,joinOption:void 0,groupCustomField:void 0,muteAllMembers:void 0,inviteOption:void 0},keyMap:{request:{groupCustomField:"AppDefinedData",muteAllMembers:"ShutUpAllMember",joinOption:"ApplyJoinOption",avatar:"FaceUrl",inviteOption:"InviteJoinOption"},response:{AppDefinedData:"groupCustomField",ShutUpAllMember:"muteAllMembers"}}}}(e)),this._configMap.set(Xi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.APPLY_JOIN_GROUP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1,historyMessageFlag:void 0},keyMap:{request:{applyMessage:"ApplyMsg",historyMessageFlag:"HugeGroupHistoryMsgFlag"},response:{HugeGroupFlag:"avChatRoomFlag",AVChatRoomKey:"avChatRoomKey",RspMsgList:"messageList",ToGroupId:"to"}}}}(e)),this._configMap.set(Zi,function(e){return e.a2,e.tinyid,{head:t(t({},h(e,Bs)),{},{servcmd:"".concat(B.NAME.BIG_GROUP_NO_AUTH,".").concat(B.CMD.APPLY_JOIN_GROUP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1},keyMap:{request:{applyMessage:"ApplyMsg"},response:{HugeGroupFlag:"avChatRoomFlag"}}}}(e)),this._configMap.set(Qi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.QUIT_GROUP)}),body:{groupID:void 0}}}(e)),this._configMap.set(er,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.SEARCH_GROUP_BY_ID)}),body:{groupIDList:void 0,responseFilter:{groupBasePublicInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption","InviteJoinOption"]}},keyMap:{response:{}}}}(e)),this._configMap.set(tr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.CHANGE_GROUP_OWNER)}),body:{groupID:void 0,newOwnerID:void 0},keyMap:{request:{newOwnerID:"NewOwner_Account"}}}}(e)),this._configMap.set(nr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.HANDLE_APPLY_JOIN_GROUP)}),body:{groupID:void 0,applicant:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{request:{applicant:"Applicant_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}}(e)),this._configMap.set(ir,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.HANDLE_INVITE_JOIN_GROUP)}),body:{groupID:void 0,applicant:void 0,invitee:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,userDefinedField:void 0},keyMap:{request:{applicant:"Applicant_Account",invitee:"Invited_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg"}}}}(e)),this._configMap.set(rr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.HANDLE_GROUP_INVITATION)}),body:{groupID:void 0,inviter:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{request:{inviter:"Inviter_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}}(e)),this._configMap.set(hr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_GROUP_APPLICATION)}),body:{startTime:void 0,limit:void 0,handleAccount:void 0},keyMap:{request:{handleAccount:"Handle_Account"},response:{To_Account:"userID"}}}}(e)),this._configMap.set(fr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.DELETE_GROUP_SYSTEM_MESSAGE)}),body:{messageListToDelete:void 0},keyMap:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}}(e)),this._configMap.set(gr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.BIG_GROUP_LONG_POLLING,".").concat(B.CMD.AVCHATROOM_LONG_POLL)}),body:{USP:1,startSeq:1,startBroadcastSeq:void 0,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{request:{USP:"USP"},response:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}}(e)),this._configMap.set(mr,function(e){return e.a2,e.tinyid,{head:t(t({},h(e,Hs)),{},{servcmd:"".concat(B.NAME.BIG_GROUP_LONG_POLLING_NO_AUTH,".").concat(B.CMD.AVCHATROOM_LONG_POLL)}),body:{USP:1,startSeq:1,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{request:{USP:"USP"},response:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}}(e)),this._configMap.set(vr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_ONLINE_MEMBER_NUM)}),body:{groupID:void 0}}}(e)),this._configMap.set(Ir,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.SET_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key",value:"value"}}}}(e)),this._configMap.set(Mr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.MODIFY_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key",value:"value"}}}}(e)),this._configMap.set(Tr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.DELETE_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key"}}}}(e)),this._configMap.set(Cr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.CLEAR_GROUP_ATTRIBUTES)}),body:{groupID:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]}}}(e)),this._configMap.set(Sr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP_ATTR,".").concat(B.CMD.GET_GROUP_ATTRIBUTES)}),body:{groupID:void 0,avChatRoomKey:void 0,groupType:1},keyMap:{request:{avChatRoomKey:"Key",groupType:"GroupType"}}}}(e)),this._configMap.set(br,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_GROUP_NOTIFY)}),body:{notifyType:1,groupID:"",beginTime:0,endTime:0,limit:20},keyMap:{request:{},response:{NextMsgTime:"nextRevokedTime",NotifyMsgList:"notifyList"}}}}(e)),this._configMap.set(Dr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.UPDATE_GROUP_COUNTER)}),body:{groupID:void 0,counterList:void 0,avChatRoomKey:void 0,mode:void 0},keyMap:{request:{counterList:"GroupCounter"}}}}(e)),this._configMap.set(wr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_GROUP_COUNTER)}),body:{groupID:void 0,keyList:[],avChatRoomKey:void 0},keyMap:{request:{keyList:"GroupCounterKeys"}}}}(e)),this._configMap.set(eo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP_COMMUNITY,".").concat(B.CMD.CREATE_TOPIC)}),body:{groupID:void 0,topicName:void 0,avatar:void 0,customData:void 0,topicID:void 0,notification:void 0,introduction:void 0},keyMap:{request:{avatar:"FaceUrl"}}}}(e)),this._configMap.set(to,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP_COMMUNITY,".").concat(B.CMD.DELETE_TOPIC)}),body:{groupID:void 0,topicIDList:void 0},keyMap:{request:{topicIDList:"TopicIdList"},response:{DestroyResultItem:"resultList"}}}}(e)),this._configMap.set(no,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP_COMMUNITY,".").concat(B.CMD.UPDATE_TOPIC_PROFILE)}),body:{groupID:void 0,topicID:void 0,avatar:void 0,customData:void 0,notification:void 0,introduction:void 0,muteAllMembers:void 0,topicName:void 0},keyMap:{request:{avatar:"FaceUrl",muteAllMembers:"ShutUpAllMember"}}}}(e)),this._configMap.set(io,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP_COMMUNITY,".").concat(B.CMD.GET_TOPIC_LIST)}),body:{groupID:void 0,topicIDList:void 0,MemberInfoFilter:["NoUnreadSeqList"]},keyMap:{request:{topicIDList:"TopicIdList"},response:{TopicAndSelfInfo:"topicInfoList",TopicInfo:"topic",GroupID:"groupID",ShutUpTime:"muteTime",ShutUpAllFlag:"muteAllMembers",LastMsgTime:"lastMessageTime",MsgSeq:"readedSequence",LastMsgSeq:"sequence",NoUnreadSeqList:"excludedUnreadSequenceList"}}}}(e)),this._configMap.set(Ar,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_GROUP_MEMBER_LIST)}),body:{groupID:void 0,limit:0,offset:void 0,next:void 0,memberRoleFilter:void 0,memberInfoFilter:["Role","NameCard","ShutUpUntil","JoinTime"],memberCustomFieldFilter:void 0},keyMap:{request:{memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",MemberList:"members",ShutUpUntil:"muteUntil"}}}}(e)),this._configMap.set(Rr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP_AVCHATROOM,".").concat(B.CMD.GET_AVCHATROOM_MEMBER_LIST)}),body:{groupID:void 0,offset:void 0,filter:void 0},keyMap:{request:{offset:"Timestamp",filter:"Mark"},response:{NextTimestamp:"offset"}}}}(e)),this._configMap.set(Lr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.GET_GROUP_MEMBER_INFO)}),body:{groupID:void 0,userIDList:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{request:{userIDList:"Member_List_Account",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{MemberList:"members",ShutUpUntil:"muteUntil",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",AppMemberDefinedData:"memberCustomField"}}}}(e)),this._configMap.set(Or,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.ADD_GROUP_MEMBER)}),body:{groupID:void 0,silence:void 0,userIDList:void 0},keyMap:{request:{userID:"Member_Account",userIDList:"MemberList"},response:{MemberList:"members"}}}}(e)),this._configMap.set(Nr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.DELETE_GROUP_MEMBER)}),body:{groupID:void 0,userIDList:void 0,reason:void 0},keyMap:{request:{userIDList:"MemberToDel_Account"}}}}(e)),this._configMap.set(Pr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.BAN_AVCHATROOM_MEMBER)}),body:{groupID:void 0,userIDList:void 0,duration:void 0,reason:""},keyMap:{request:{userIDList:"Members_Account",duration:"Duration",reason:"Description"}}}}(e)),this._configMap.set(Ur,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP,".").concat(B.CMD.MODIFY_GROUP_MEMBER_INFO)}),body:{groupID:void 0,topicID:void 0,userID:void 0,messageRemindType:void 0,nameCard:void 0,role:void 0,memberCustomField:void 0,muteTime:void 0},keyMap:{request:{userID:"Member_Account",memberCustomField:"AppMemberDefinedData",muteTime:"ShutUpTime",messageRemindType:"MsgFlag"}}}}(e)),this._configMap.set(xr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.GROUP_AVCHATROOM,".").concat(B.CMD.MARK_AVCHATROOM_MEMBER_INFO)}),body:{groupID:void 0,operationType:1,memberList:[]},keyMap:{request:{operationType:"CommandType",memberList:"MemberList",markType:"Marks",userID:"Member_Account"},response:{CommandType:"operationType",Marks:"markType",Member_Account:"userID"}}}}(e)),this._configMap.set(qr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STAT,".").concat(B.CMD.TIM_WEB_REPORT_V2)}),body:{header:{},event:[],quality:[]},keyMap:{request:{SDKType:"sdk_type",SDKVersion:"sdk_version",deviceType:"device_type",platform:"platform",instanceID:"instance_id",traceID:"trace_id",SDKAppID:"sdk_app_id",userID:"user_id",tinyID:"tiny_id",extension:"extension",timestamp:"timestamp",networkType:"network_type",eventType:"event_type",code:"error_code",message:"error_message",moreMessage:"more_message",duplicate:"duplicate",costTime:"cost_time",level:"level",qualityType:"quality_type",reportIndex:"report_index",wholePeriod:"whole_period",totalCount:"total_count",rttCount:"success_count_business",successRateOfRequest:"percent_business",countLessThan1Second:"success_count_business",percentOfCountLessThan1Second:"percent_business",countLessThan3Second:"success_count_platform",percentOfCountLessThan3Second:"percent_platform",successCountOfBusiness:"success_count_business",successRateOfBusiness:"percent_business",successCountOfPlatform:"success_count_platform",successRateOfPlatform:"percent_platform",successCountOfMessageReceived:"success_count_business",successRateOfMessageReceived:"percent_business",avgRTT:"average_value",avgDelay:"average_value",avgValue:"average_value",uiPlatform:"ui_platform"}}}}(i)),this._configMap.set(Br,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.HEARTBEAT,".").concat(B.CMD.ALIVE)}),body:{}}}(e)),this._configMap.set(Hr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_PUSH,".").concat(B.CMD.MESSAGE_PUSH)}),body:{},keyMap:{response:{C2cMsgArray:"C2CMessageArray",GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",C2cNotifyMsgArray:"C2CNotifyMessageArray",C2cMsgInfo:"C2CReadReceiptArray",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyAdd_Account:"userID",ProfileImNick:"nick",PendencyType:"applicationType",C2CReadAllMsg:"readAllC2CMessage",IsNeedReadReceipt:"needReadReceipt",Status:"statusType"}}}}(e)),this._configMap.set(jr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_PUSH,".").concat(B.CMD.MULTI_MESSAGE_PUSH)}),body:{},keyMap:{response:{GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyType:"applicationType"}}}}(e)),this._configMap.set(Kr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.OPEN_IM,".").concat(B.CMD.MESSAGE_PUSH_ACK)}),body:{sessionData:void 0},keyMap:{request:{sessionData:"SessionData"}}}}(e)),this._configMap.set(zr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.STATUS_FORCE_OFFLINE)}),body:{},keyMap:{response:{C2cNotifyMsgArray:"C2CNotifyMessageArray",NoticeSeq:"noticeSequence",KickoutMsgNotify:"kickoutMsgNotify",NewInstInfo:"newInstanceInfo"}}}}(e)),this._configMap.set(Yr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_LONG_MESSAGE,".").concat(B.CMD.DOWNLOAD_MERGER_MESSAGE)}),body:{downloadKey:""},keyMap:{response:{Data:"data",Desc:"description",Ext:"extension",Download_Flag:"downloadFlag",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID"}}}}(e)),this._configMap.set(Wr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_LONG_MESSAGE,".").concat(B.CMD.UPLOAD_MERGER_MESSAGE)}),body:{messageList:[]},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",type:"MsgType",content:"MsgContent",data:"Data",description:"Desc",extension:"Ext",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody"}}}}(e)),this._configMap.set(lo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.SET_TOKEN)}),body:{tokenID:"",pushMsg:0,sdkAppID:0,businessID:"",deviceBrand:"",deviceToken:"",isTpns:0,isWebUniapp:0},keyMap:{request:{tokenID:"TokenID",pushMsg:"PushMsg",sdkAppID:"EnterVersion",businessID:"BusiID",deviceBrand:"InstType",deviceToken:"VarToken",isTpns:"IsTpns"}}}}(e)),this._configMap.set(uo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.STAT_FOREGROUND)}),body:{isWebUniapp:0}}}(e)),this._configMap.set(co,function(e){return{head:t(t({},e),{},{servcmd:"".concat(B.NAME.IM_OPEN_STATUS,".").concat(B.CMD.STAT_BACKGROUND)}),body:{C2CUnread:0,GroupUnread:0,isWebUniapp:0},keyMap:{request:{c2cUnreadCount:"C2cUnread",groupUnreadCount:"GrpUnread"}}}}(e))}},{key:"has",value:function(e){return this._configMap.has(e)}},{key:"get",value:function(e){return this._configMap.get(e)}},{key:"update",value:function(){this._fillConfigMap()}},{key:"getKeyMap",value:function(e){return this.has(e)?this.get(e).keyMap||{}:(Be.w("".concat(this._n,".getKeyMap unknown protocolName:").concat(e)),{})}},{key:"getProtocolData",value:function(e){var t=e.protocolName,n=e.requestData,i=this.get(t),r=null;if(n){var o=this._simpleDeepCopy(i),a=this._updateService(n,o),s=a.body,c=Object.create(null);for(var u in s)if(Object.prototype.hasOwnProperty.call(s,u)){if(c[u]=s[u],void 0===n[u])continue;c[u]=n[u]}a.body=c,r=this._getUplinkData(a)}else r=this._getUplinkData(i);return r}},{key:"_getUplinkData",value:function(e){var t=this._requestDataCleaner(e),n=xt(t.head),i=ks(t.body,this._getRequestKeyMap(n));return t.body=i,t}},{key:"_updateService",value:function(e,t){var n=xt(t.head);if(this._isFromGroupRequest(t)){var i=e.type,r=e.groupID,o=void 0===r?void 0:r,a=e.groupIDList,s=void 0===a?[]:a;st(o)&&(o=s[0]||""),Et({type:i,groupID:o})&&(t.head.servcmd="".concat(B.NAME.GROUP_COMMUNITY,".").concat(n))}return t}},{key:"_isFromGroupRequest",value:function(e){return e.head.servcmd.includes(B.NAME.GROUP)||e.head.servcmd.includes(B.NAME.GROUP_ATTR)}},{key:"_getRequestKeyMap",value:function(e){var n=this.getKeyMap(e);return t(t({},Cs.request),n.request)}},{key:"_requestDataCleaner",value:function(e){var t=Array.isArray(e)?[]:Object.create(null);for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&pt(i)&&null!==e[i]&&void 0!==e[i]&&("object"!==n(e[i])?t[i]=e[i]:t[i]=this._requestDataCleaner.bind(this)(e[i]));return t}},{key:"_simpleDeepCopy",value:function(e){for(var t,n=Object.keys(e),i={},r=0,o=n.length;r<o;r++)t=n[r],at(e[t])?i[t]=Array.from(e[t]):rt(e[t])?i[t]=this._simpleDeepCopy(e[t]):i[t]=e[t];return i}}]),e}(),Ks=[Kr],zs=function(){function e(t){i(this,e),this._sessionModule=t,this._n="DownlinkHandler",this._eventHandlerMap=new Map,this._eventHandlerMap.set("C2CMessageArray",this._c2cMessageArrayHandler.bind(this)),this._eventHandlerMap.set("groupMessageArray",this._groupMessageArrayHandler.bind(this)),this._eventHandlerMap.set("groupTips",this._groupTipsHandler.bind(this)),this._eventHandlerMap.set("C2CNotifyMessageArray",this._C2CNotifyMessageArrayHandler.bind(this)),this._eventHandlerMap.set("C2CReadReceiptArray",this._C2CReadReceiptArrayHandler.bind(this)),this._eventHandlerMap.set("profileModify",this._profileHandler.bind(this)),this._eventHandlerMap.set("friendListMod",this._relationChainHandler.bind(this)),this._eventHandlerMap.set("recentContactMod",this._recentContactHandler.bind(this)),this._eventHandlerMap.set("readAllC2CMessage",this._allMessageReadHandler.bind(this)),this._eventHandlerMap.set("c2cMessageModified",this._c2cMessageModifiedHandler.bind(this)),this._eventHandlerMap.set("groupMessageModified",this._groupMessageModifiedHandler.bind(this)),this._eventHandlerMap.set("userStatusList",this._userStatusListHandler.bind(this)),this._eventHandlerMap.set("messageExtensionNotify",this._messageExtensionNotifyHandler.bind(this)),this._keys=_(this._eventHandlerMap.keys())}return o(e,[{key:"_c2cMessageArrayHandler",value:function(e){var t=this._sessionModule.getModule(Pn);t&&(e.dataList.forEach((function(e){if(1===e.isSyncMessage){var t=e.from;e.from=e.to,e.to=t}})),1===e.needSync&&this._sessionModule.getModule(Yn).startOnlineSync(),t.onNewC2CMessage({dataList:e.dataList,isInstantMessage:!0}))}},{key:"_c2cMessageModifiedHandler",value:function(e){var t=this._sessionModule.getModule(Pn);t&&t.onC2CMessageModified(e)}},{key:"_groupMessageArrayHandler",value:function(e){var t=this._sessionModule.getModule(Un);t&&t.onNewGroupMessage({event:e.event,dataList:e.dataList,isInstantMessage:!0})}},{key:"_groupMessageModifiedHandler",value:function(e){var t=this._sessionModule.getModule(Un);t&&t.onGroupMessageModified(e)}},{key:"_groupTipsHandler",value:function(e){var t=this._sessionModule.getModule(Un);if(t){var n=e.event,i=e.dataList,r=e.isInstantMessage,o=void 0===r||r,a=e.isSyncingEnded;switch(n){case 4:case 6:t.onNewGroupTips({event:n,dataList:i});break;case 5:for(var s=0;s<i.length;s++)if(at(i[s].elements.revokedInfos))t.onGroupMessageRevoked({dataList:i});else if(at(i[s].elements.groupMessageReadNotice))t.onGroupMessageReadNotice({dataList:i});else{if(!at(i[s].elements.readReceiptList)){t.onNewGroupSystemNotice({dataList:i,isInstantMessage:o,isSyncingEnded:a});break}t.onReadReceiptList({dataList:i})}break;case 12:this._sessionModule.getModule(Vn).onNewGroupAtTips({dataList:i});break;default:Be.l("".concat(this._n,"._groupTipsHandler unknown event:").concat(n," dataList:"),i)}}}},{key:"_C2CNotifyMessageArrayHandler",value:function(e){var t=this,n=e.dataList;if(at(n)){var i=this._sessionModule.getModule(Pn);n.forEach((function(e){if(ot(e))if(e.hasOwnProperty("kickoutMsgNotify")){var r=e.kickoutMsgNotify,o=r.kickType,a=r.newInstanceInfo,s=void 0===a?{}:a;1===o?t._sessionModule.onMultipleAccountKickedOut(s):2===o?t._sessionModule.onMultipleDeviceKickedOut(s):3===o&&t._sessionModule.onRestApiKickedOut(s)}else e.hasOwnProperty("c2cMessageRevokedNotify")?i&&i.onC2CMessageRevoked({dataList:n}):e.hasOwnProperty("c2cMessageReadReceipt")?i&&i.onC2CMessageReadReceipt({dataList:n}):e.hasOwnProperty("c2cMessageReadNotice")?i&&i.onC2CMessageReadNotice({dataList:n}):e.hasOwnProperty("muteNotificationsSync")&&t._sessionModule.getModule(Vn).onC2CMessageRemindTypeSynced({dataList:n})}))}}},{key:"_C2CReadReceiptArrayHandler",value:function(e){this._sessionModule.getModule(Pn).onReadReceiptList(e)}},{key:"_profileHandler",value:function(e){this._sessionModule.getModule(Nn).onProfileModified({dataList:e.dataList});var t=this._sessionModule.getModule(xn);t&&t.onFriendProfileModified({dataList:e.dataList})}},{key:"_relationChainHandler",value:function(e){this._sessionModule.getModule(Nn).onRelationChainModified({dataList:e.dataList});var t=this._sessionModule.getModule(xn);t&&t.onRelationChainModified({dataList:e.dataList})}},{key:"_recentContactHandler",value:function(e){var t=e.dataList;if(at(t)){var n=this._sessionModule.getModule(Vn);n&&t.forEach((function(e){var t=e.pushType;if(1===t){var i=e.recentContactDeleteItem;n.onConversationDeleted(i.recentContactList)}else if(2===t){var r=e.recentContactTopItem;n.onConversationPinned(r.recentContactList)}else if(3===t){var o=e.recentContactTopItem;n.onConversationUnpinned(o.recentContactList)}else if(4===t){var a=e.recentContactMarkContact;n.onConversationMarkUpdated(a.recentContactMarkContactItem)}else if(5===t){var s=e.recentContactCreateContactGroup;n.onConversationGroupCreated(s.msgContactGroupContactItem)}else if(6===t){var c=e.recentContactDelContactGroup;n.onConversationGroupDeleted(c.msgGroupItem)}else if(7===t){var u=e.recentContactUpdateContactGroup,l=u.updateType,d=u.msgUpdateGroup,p=u.msgUpdateContact;if(1===l){var h=d.updateGroupType;1===h?n.onConversationGroupNameUpdated(d):2===h&&n.onConversationInGroupUpdated(d)}else 2===l&&n.onConversationAddedToOrDeletedFromGroup(p)}}))}}},{key:"_allMessageReadHandler",value:function(e){var t=e.dataList,n=this._sessionModule.getModule(Vn);n&&n.onPushedAllMessageRead(t)}},{key:"_userStatusListHandler",value:function(e){this._sessionModule.getModule(Nn).onUserStatusUpdated(e)}},{key:"_messageExtensionNotifyHandler",value:function(e){this._sessionModule.getModule(On).onMessageExtensionNotify(e)}},{key:"onMessage",value:function(e){var t=this,n=e.body;if(this._filterMessageFromIMOpenPush(e)){var i=n.eventArray,r=n.isInstantMessage,o=n.isSyncingEnded,a=n.needSync;if(at(i))for(var s=null,c=null,u=0,l=0,d=i.length;l<d;l++){u=(s=i[l]).event;var p=Object.keys(s).find((function(e){return-1!==t._keys.indexOf(e)}));p?(c=14===u?{readAllC2CMessage:s[p],groupMessageReadInfoList:s.groupMessageReadNotice||[]}:16===u?{userID:s.userID,readReceiptList:s[p]}:s[p],this._eventHandlerMap.get(p)({event:u,dataList:c,isInstantMessage:r,isSyncingEnded:o,needSync:a})):Be.l("".concat(this._n,".onMessage unknown eventItem:").concat(s))}}}},{key:"_filterMessageFromIMOpenPush",value:function(e){var t=e.head,n=e.body,i=t.servcmd,r=!1;if(st(i)||(r=i.includes(B.NAME.IM_CONFIG_MANAGER)||i.includes(B.NAME.OVERLOAD_PUSH)||i.includes(B.NAME.STAT_SERVICE)),!r)return!0;if(i.includes(B.CMD.PUSHED_CLOUD_CONTROL_CONFIG))this._sessionModule.getModule(Zn).onPushedCloudControlConfig(n);else if(i.includes(B.CMD.PUSHED_COMMERCIAL_CONFIG))this._sessionModule.getModule(ni).onPushedConfig(n);else if(i.includes(B.CMD.OVERLOAD_NOTIFY))this._sessionModule.onPushedServerOverload(n);else if(i.includes(B.CMD.KICK_OTHER)){var o=Date.now();this._sessionModule.reLoginOnKickOther();var a=new wo("kickOther"),s=this._sessionModule.getModule(Rn).getLastWsHelloTs(),c=o-s;a.setMessage("last wshello time:".concat(s," diff:").concat(c,"ms")).setNetworkType(this._sessionModule.getNetworkType()).end()}return!1}}]),e}(),Ws=[{cmd:B.CMD.GET_GROUP_INFO,interval:1,count:20},{cmd:B.CMD.GET_AVCHATROOM_MEMBER_LIST,interval:3,count:1},{cmd:B.CMD.GET_GROUP_APPLICATION,interval:1,count:15},{cmd:B.CMD.GET_TOPIC_LIST,interval:1,count:10},{cmd:B.CMD.SET_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:B.CMD.MODIFY_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:B.CMD.DELETE_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:B.CMD.CLEAR_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:B.CMD.GET_GROUP_ATTRIBUTES,interval:5,count:20},{cmd:B.CMD.UPDATE_GROUP_COUNTER,interval:5,count:20},{cmd:B.CMD.GET_GROUP_COUNTER,interval:5,count:20},{cmd:B.CMD.SET_ALL_MESSAGE_READ,interval:1,count:1},{cmd:B.CMD.GET_USER_STATUS,interval:5,count:20},{cmd:B.CMD.SUBSCRIBE_USER_STATUS,interval:5,count:20},{cmd:B.CMD.UNSUBSCRIBE_USER_STATUS,interval:5,count:20}],Ys=function(e){s(r,e);var n=m(r);function r(e){var t;return i(this,r),(t=n.call(this,e))._n="SessionModule",t._platform=t.getPlatform(),t._protocolHandler=new js(f(t)),t._messageDispatcher=new zs(f(t)),t._commandFrequencyLimitMap=new Map,t._commandRequestInfoMap=new Map,t._serverOverloadInfoMap=new Map,t._init(),t.getInnerEmitterInstance().on(ta,t._onCloudConfigUpdated,f(t)),t}return o(r,[{key:"_init",value:function(){this._updateCommandFrequencyLimitMap(Ws)}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("cmd_frequency_limit");st(e)||(e=JSON.parse(e),this._updateCommandFrequencyLimitMap(e))}},{key:"_updateCommandFrequencyLimitMap",value:function(e){var t=this;e.forEach((function(e){t._commandFrequencyLimitMap.set(e.cmd,{interval:e.interval,count:e.count})}))}},{key:"updateProtocolConfig",value:function(){this._protocolHandler.update()}},{key:"request",value:function(e){Be.d("".concat(this._n,".request options:"),e);var t=e.protocolName,n=e.tjgID;if(!this._protocolHandler.has(t))return Be.w("".concat(this._n,".request unknown protocol:").concat(t)),Xo({code:fo.CANNOT_FIND_PROTOCOL});var i=this.getProtocolData(e),r=i.head.servcmd;if(this._isFrequencyOverLimit(r))return Xo({code:fo.OVER_FREQUENCY_LIMIT});if(this._isServerOverload(r))return Xo({code:fo.OPEN_SERVICE_OVERLOAD_ERROR});$t(n)||(i.head.tjgID=n);var o=this.getModule(Jn);return Ks.includes(t)?o.simplySend(i):o.send(i)}},{key:"getKeyMap",value:function(e){return this._protocolHandler.getKeyMap(e)}},{key:"genCommonHead",value:function(){var e=this.getModule(qn);return{ver:"v4",platform:this._platform,websdkappid:O,websdkversion:L,a2:e.getA2Key()||void 0,tinyid:e.getTinyID()||void 0,status_instid:e.getStatusInstanceID(),sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getA2Key()?void 0:e.getUserID(),usersig:e.getA2Key()?void 0:e.getUserSig(),sdkability:192371,tjgID:""}}},{key:"genCosSpecifiedHead",value:function(){var e=this.getModule(qn);return{ver:"v4",platform:this._platform,websdkappid:O,websdkversion:L,sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getUserID(),usersig:e.getUserSig(),status_instid:e.getStatusInstanceID(),sdkability:192371}}},{key:"genSSOReportHead",value:function(){var e=this.getModule(qn);return{ver:"v4",platform:this._platform,websdkappid:O,websdkversion:L,sdkappid:e.getSDKAppID(),contenttype:"",reqtime:0,identifier:"",usersig:"",status_instid:e.getStatusInstanceID(),sdkability:192371}}},{key:"getProtocolData",value:function(e){return this._protocolHandler.getProtocolData(e)}},{key:"trans",value:function(e){var n=e.servcmd,i=e.data,r={head:t(t({},this.genCommonHead()),{},{servcmd:n}),body:i};return this.getModule(Jn).send(r)}},{key:"sendComboMessage",value:function(e){var n=e.servcmd,i=e.data,r={head:t(t({},this.genCommonHead()),{},{servcmd:n}),body:i};return this.getModule(Jn).send(r)}},{key:"onErrorCodeNotZero",value:function(e){var t=e.errorCode;if(t===fo.HELLO_ANSWER_KICKED_OUT){var n=e.kickType,i=e.newInstanceInfo,r=void 0===i?{}:i;1===n?this.onMultipleAccountKickedOut(r):2===n?this.onMultipleDeviceKickedOut(r):3===n&&this.onRestApiKickedOut(r)}t!==fo.MESSAGE_A2KEY_EXPIRED&&t!==fo.ACCOUNT_A2KEY_EXPIRED||(this._onUserSigExpired(),this.getModule(Jn).reConnect())}},{key:"onMessage",value:function(e){var t=e.body,n=t.needAck,i=void 0===n?0:n,r=t.sessionData;1===i&&this._sendACK(r),this._messageDispatcher.onMessage(e)}},{key:"onReconnected",value:function(){this._reLoginOnReconnected()}},{key:"reLoginOnKickOther",value:function(){Be.l("".concat(this._n,".reLoginOnKickOther")),this._reLogin()}},{key:"_reLoginOnReconnected",value:function(){Be.l("".concat(this._n,"._reLoginOnReconnected")),this._reLogin()}},{key:"_reLogin",value:function(){var e=this;if(this.isLoggedIn()){var t=0,n=this.getModule(ii);n.canIUseOfflinePush()&&(t=n.getUniAppPlatform()),this.request({protocolName:ui,requestData:{isWebUniapp:t}}).then((function(t){var n=t.data.instanceID;e.getModule(qn).setStatusInstanceID(n),Be.l("".concat(e._n,"._reLogin ok.")),e.getModule(Vn).syncConversationList().then((function(){Be.l("".concat(e._n,"._reLogin, sync conversation list ok.")),e.getModule(ei).start()})),e.getModule(Un).updateLocalMainSequenceOnReconnected();var i=e.getModule(Fn);i.resetGetTopicTime(),i.getTopicListOnReconnected()}))}}},{key:"onMultipleAccountKickedOut",value:function(e){this.getModule(Rn).onMultipleAccountKickedOut(e)}},{key:"onMultipleDeviceKickedOut",value:function(e){this.getModule(Rn).onMultipleDeviceKickedOut(e)}},{key:"_onUserSigExpired",value:function(){this.getModule(Rn).onUserSigExpired()}},{key:"onRestApiKickedOut",value:function(e){this.getModule(Rn).onRestApiKickedOut(e)}},{key:"_sendACK",value:function(e){this.request({protocolName:Kr,requestData:{sessionData:e}})}},{key:"_isFrequencyOverLimit",value:function(e){var t=e.split(".")[1];if(!this._commandFrequencyLimitMap.has(t))return!1;if(!this._commandRequestInfoMap.has(t))return this._commandRequestInfoMap.set(t,{startTime:Date.now(),requestCount:1}),!1;var n=this._commandFrequencyLimitMap.get(t),i=n.count,r=n.interval,o=this._commandRequestInfoMap.get(t),a=o.startTime,s=o.requestCount;if(Date.now()-a>1e3*r)return this._commandRequestInfoMap.set(t,{startTime:Date.now(),requestCount:1}),!1;s+=1,this._commandRequestInfoMap.set(t,{startTime:a,requestCount:s});var c=!1;return s>i&&(c=!0),c}},{key:"_isServerOverload",value:function(e){if(!this._serverOverloadInfoMap.has(e))return!1;var t=this._serverOverloadInfoMap.get(e),n=t.overloadTime,i=t.waitingTime,r=!1;return Date.now()-n<=1e3*i?r=!0:(this._serverOverloadInfoMap.delete(e),r=!1),r}},{key:"onPushedServerOverload",value:function(e){var t=e.overloadCommand,n=e.waitingTime;this._serverOverloadInfoMap.set(t,{overloadTime:Date.now(),waitingTime:n}),Be.w("".concat(this._n,".onPushedServerOverload waitingTime:").concat(n,"s"))}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._updateCommandFrequencyLimitMap(Ws),this._commandRequestInfoMap.clear(),this._serverOverloadInfoMap.clear()}}]),r}(ci),$s=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="MessageLossDetectionModule",r._maybeLostSequencesMap=new Map,r._firstRoundRet=[],r}return o(n,[{key:"onMessageMaybeLost",value:function(e,t,n){this._maybeLostSequencesMap.has(e)||this._maybeLostSequencesMap.set(e,[]);for(var i=this._maybeLostSequencesMap.get(e),r=0;r<n;r++)-1===i.indexOf(t+r)&&i.push(t+r)}},{key:"detectFirstRound",value:function(e,t){var n=this._maybeLostSequencesMap.get(e);if(!$t(n)&&!$t(t)){var i=n.filter((function(e){return-1===t.indexOf(e)}));0===i.length?Be.i("".concat(this._n,".detectFirstRound no message loss. conversationID:").concat(e)):this._firstRoundRet=this._firstRoundRet.concat(i),n.length=0}}},{key:"detectSecondRound",value:function(e,t){if(!$t(this._firstRoundRet)&&!$t(t)){var n=this._firstRoundRet.filter((function(e){return-1===t.indexOf(e)}));this._firstRoundRet.length=0;var i,r=n.length;0!==r&&(r<=5?i=e+"-"+n.join("-"):(n.sort((function(e,t){return e-t})),i=e+" start:"+n[0]+" end:"+n[r-1]+" count:"+r),new wo("messageLoss").setMessage(i).setNetworkType(this.getNetworkType()).setLevel("warning").end(),Be.i("".concat(this._n,".detectSecondRound message loss detected. conversationID:").concat(e," lostSequences:").concat(n)))}}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._maybeLostSequencesMap.clear(),this._firstRoundRet.length=0}}]),n}(ci),Js=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="CloudControlModule",r._cloudConfig=new Map,r._expiredTime=0,r._version=0,r._isFetching=!1,r}return o(n,[{key:"getCloudConfig",value:function(e){return st(e)?this._cloudConfig:this._cloudConfig.has(e)?this._cloudConfig.get(e):void 0}},{key:"_canFetchConfig",value:function(){return this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime}},{key:"fetchConfig",value:function(){var e=this,t=this._canFetchConfig();if(Be.l("".concat(this._n,".fetchConfig canFetchConfig:").concat(t)),t){var n=new wo("fetchCloudControlConfig"),i=this.getModule(qn).getSDKAppID();this._isFetching=!0,this.request({protocolName:$r,requestData:{SDKAppID:i,version:this._version}}).then((function(t){e._isFetching=!1,n.setMessage("version:".concat(e._version," newVersion:").concat(t.data.version," config:").concat(t.data.cloudControlConfig)).setNetworkType(e.getNetworkType()).end(),Be.l("".concat(e._n,".fetchConfig ok")),e._parseCloudControlConfig(t.data)})).catch((function(t){e._isFetching=!1,e.probeNetwork().then((function(e){var i=v(e,2),r=i[0],o=i[1];n.setError(t,r,o).end()})),Be.l("".concat(e._n,".fetchConfig failed. error:"),t),e._setExpiredTimeOnResponseError(12e4)}))}}},{key:"onPushedCloudControlConfig",value:function(e){Be.l("".concat(this._n,".onPushedCloudControlConfig")),new wo("pushedCloudControlConfig").setNetworkType(this.getNetworkType()).setMessage("newVersion:".concat(e.version," config:").concat(e.cloudControlConfig)).end(),this._parseCloudControlConfig(e)}},{key:"onCheckTimer",value:function(e){this._canFetchConfig()&&this.fetchConfig()}},{key:"_parseCloudControlConfig",value:function(e){var t=this,n="".concat(this._n,"._parseCloudControlConfig"),i=e.errorCode,r=e.errorMessage,o=e.cloudControlConfig,a=e.version,s=e.expiredTime;if(0===i){if(this._version!==a){var c=null;try{c=JSON.parse(o)}catch(u){this.isPrivateNetWork()||Be.e("".concat(n," JSON parse error. cloudControlConfig:"),o)}c&&(this._cloudConfig.clear(),Object.keys(c).forEach((function(e){t._cloudConfig.set(e,c[e])})),this._version=a,this.emitInnerEvent(ta))}this._expiredTime=Date.now()+1e3*s}else st(i)?(Be.l("".concat(n," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(Be.e("".concat(n," errorCode:").concat(i," errorMessage:").concat(r)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._cloudConfig.clear(),this._expiredTime=0,this._version=0,this._isFetching=!1}}]),n}(ci),Xs=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="RecoverMessageModule",r.PULL_LIMIT_COUNT=15,r}return o(n,[{key:"start",value:function(){this._recoverGroupChat(),this._recoverC2CChat()}},{key:"_recoverGroupChat",value:function(){var e,t,n=this,i=this._getLocalConversationList().filter((function(e){return e.type===b.CONV_GROUP&&e.groupProfile.type!==b.GRP_AVCHATROOM})),r=this.getModule(Vn),o=0,a=0,s=0;i.forEach((function(i){var c=i.conversationID,u=i.lastMessage;t=c.replace(b.CONV_GROUP,""),e=r.getLocalLastMessage(c),u&&0!==u.lastSequence&&e?(a=u.lastSequence,o=e.sequence,s=a-o,o>0&&s>=1&&s<300?n._recoverGroupMessage({groupID:t,localLastMessageSequence:o,remoteLastMessageSequence:a}):n._getGroupNotify(t)):n._getGroupNotify(t)}))}},{key:"_recoverC2CChat",value:function(){var e,t=this,n=this._getLocalConversationList().filter((function(e){return e.type===b.CONV_C2C})),i=this.getModule(Vn),r=0,o=0,a=0,s=[Promise.resolve()];n.forEach((function(n){var c=n.conversationID,u=n.lastMessage;e=i.getLocalLastMessage(c),u&&0!==u.lastTime&&e&&(o=u.lastTime,r=e.time,a=o-r,r>0&&a>=1&&a<=600&&s.push(t._recoverC2CMessage({conversationID:c,localLastMessageTime:r,remoteLastMessageTime:o})))})),Promise.all(s).then((function(){Be.l("".concat(t._n,"._recoverC2CChat all promise fulfilled, start to sync unread messages")),t.getModule(Yn).startSyncOnReconnected()}))}},{key:"_getLocalConversationList",value:function(){return this.getModule(Vn).getLocalConversationList()}},{key:"_recoverGroupMessage",value:function(e){var t=this,n="".concat(this._n,"._recoverGroupMessage");Be.l("".concat(n," options:"),e);var i=e.groupID,r=e.localLastMessageSequence,o=e.remoteLastMessageSequence;this._getGroupRomaingMessage({groupID:i,sequence:r}).then((function(e){var r=e.data,a=r.complete,s=r.messageList;if(!st(s)){var c=s[0].sequence;Be.l("".concat(n," pkgLastMessageSequence:").concat(c," complete:").concat(a)),c<o&&2!==a&&t._recoverGroupMessage({groupID:i,localLastMessageSequence:c,remoteLastMessageSequence:o}),new wo("recoverMessage").setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(i," complete:").concat(a," messageList length:").concat(s.length)).end(),t.getModule(Un).onNewGroupMessage({dataList:s,isInstantMessage:!1,updateUnreadCount:!1}),t._getGroupNotify(i)}}))}},{key:"_getGroupNotify",value:function(e){this.getModule(Un).getGroupNotify(e)}},{key:"_getGroupRomaingMessage",value:function(e){var t=e.groupID,n=e.sequence;return this.request({protocolName:cr,requestData:{groupID:t,count:this.PULL_LIMIT_COUNT,sequence:n+this.PULL_LIMIT_COUNT-1}})}},{key:"_recoverC2CMessage",value:function(e){var t=this,n="".concat(this._n,"._recoverC2CMessage");Be.l("".concat(this._n,"._recoverC2CMessage options:"),e);var i=e.conversationID,r=e.localLastMessageTime,o=e.remoteLastMessageTime;return this._getC2CRoamingMessage({conversationID:i,time:r}).then((function(e){var r=e.data,a=r.complete,s=r.messageList;if(!st(s)){var c=s.length;new wo("recoverMessage").setNetworkType(t.getNetworkType()).setMessage("".concat(i," complete:").concat(a," messageList length:").concat(c)).end(),t.getModule(Pn).onNewC2CMessage({dataList:s,isInstantMessage:!0});var u=s[c-1].time;if(Be.l("".concat(n," pkgLastMessageTime:").concat(u," complete:").concat(a)),u<o&&1!==a)return t._recoverC2CMessage({conversationID:i,localLastMessageTime:u,remoteLastMessageTime:o})}}))}},{key:"_getC2CRoamingMessage",value:function(e){var t=e.conversationID,n=e.time;return this.request({protocolName:ki,requestData:{peerAccount:t.replace(b.CONV_C2C,""),count:this.PULL_LIMIT_COUNT+1,lastMessageTime:n,direction:1}})}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset"))}}]),n}(ci),Zs=function(){function e(){i(this,e),this._n="AvgE2EDelay",this._e2eDelayArray=[]}return o(e,[{key:"addMessageDelay",value:function(e){var t=Ge()-e;t>=0&&this._e2eDelayArray.push(t)}},{key:"_calcAvg",value:function(e,t){if(0===t)return 0;var n=0;return e.forEach((function(e){n+=e})),Gt(n/t,1)}},{key:"_calcCountWithLimit",value:function(e){var t=e.e2eDelayArray,n=e.min,i=e.max;return t.filter((function(e){return n<=e&&e<i})).length}},{key:"_calcPercent",value:function(e,t){var n=Gt(e/t*100,2);return n>100&&(n=100),n}},{key:"_checkE2EDelayException",value:function(e,t){var n=e.filter((function(e){return e>t}));if(n.length>0){var i=n.length,r=Math.min.apply(Math,_(n)),o=Math.max.apply(Math,_(n)),a=this._calcAvg(n,i),s=Gt(i/e.length*100,2);s>50&&new wo("messageE2EDelayException").setMessage("count:".concat(i," min:").concat(r," max:").concat(o," avg:").concat(a," percent:").concat(s)).setLevel("warning").end()}}},{key:"getStatResult",value:function(){var e=this._e2eDelayArray.length;if(0===e)return null;var t=_(this._e2eDelayArray),n=this._calcCountWithLimit({e2eDelayArray:t,min:0,max:1}),i=this._calcCountWithLimit({e2eDelayArray:t,min:1,max:3}),r=this._calcPercent(n,e),o=this._calcPercent(i,e),a=this._calcAvg(t,e);return this._checkE2EDelayException(t,3),t.length=0,this.reset(),{totalCount:e,countLessThan1Second:n,percentOfCountLessThan1Second:r,countLessThan3Second:i,percentOfCountLessThan3Second:o,avgDelay:a}}},{key:"reset",value:function(){this._e2eDelayArray.length=0}}]),e}(),Qs=function(){function e(){i(this,e),this._n="AvgRTT",this._requestCount=0,this._rttArray=[]}return o(e,[{key:"addRequestCount",value:function(){this._requestCount+=1}},{key:"addRTT",value:function(e){this._rttArray.push(e)}},{key:"_calcTotalCount",value:function(){return this._requestCount}},{key:"_calcRTTCount",value:function(e){return e.length}},{key:"_calcSuccessRateOfRequest",value:function(e,t){if(0===t)return 0;var n=Gt(e/t*100,2);return n>100&&(n=100),n}},{key:"_calcAvg",value:function(e,t){if(0===t)return 0;var n=0;return e.forEach((function(e){n+=e})),parseInt(n/t)}},{key:"_calcMax",value:function(){return Math.max.apply(Math,_(this._rttArray))}},{key:"_calcMin",value:function(){return Math.min.apply(Math,_(this._rttArray))}},{key:"getStatResult",value:function(){var e=this._calcTotalCount(),t=_(this._rttArray);if(0===e)return null;var n=this._calcRTTCount(t),i=this._calcSuccessRateOfRequest(n,e),r=this._calcAvg(t,n);return Be.l("".concat(this._n,".getStatResult max:").concat(this._calcMax()," min:").concat(this._calcMin()," avg:").concat(r)),this.reset(),{totalCount:e,rttCount:n,successRateOfRequest:i,avgRTT:r}}},{key:"reset",value:function(){this._requestCount=0,this._rttArray.length=0}}]),e}(),ec=function(){function e(){i(this,e),this._map=new Map}return o(e,[{key:"initMap",value:function(e){var t=this;e.forEach((function(e){t._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}))}},{key:"addTotalCount",value:function(e){return!(st(e)||!this._map.has(e)||(this._map.get(e).totalCount+=1,0))}},{key:"addSuccessCount",value:function(e){return!(st(e)||!this._map.has(e)||(this._map.get(e).successCount+=1,0))}},{key:"addFailedCountOfUserSide",value:function(e){return!(st(e)||!this._map.has(e)||(this._map.get(e).failedCountOfUserSide+=1,0))}},{key:"addCost",value:function(e,t){return!(st(e)||!this._map.has(e)||(this._map.get(e).costArray.push(t),0))}},{key:"addFileSize",value:function(e,t){return!(st(e)||!this._map.has(e)||(this._map.get(e).fileSizeArray.push(t),0))}},{key:"_calcSuccessRateOfBusiness",value:function(e){if(st(e)||!this._map.has(e))return-1;var t=this._map.get(e),n=Gt(t.successCount/t.totalCount*100,2);return n>100&&(n=100),n}},{key:"_calcSuccessRateOfPlatform",value:function(e){if(st(e)||!this._map.has(e))return-1;var t=this._map.get(e),n=this._calcSuccessCountOfPlatform(e)/t.totalCount*100;return(n=Gt(n,2))>100&&(n=100),n}},{key:"_calcTotalCount",value:function(e){return st(e)||!this._map.has(e)?-1:this._map.get(e).totalCount}},{key:"_calcSuccessCountOfBusiness",value:function(e){return st(e)||!this._map.has(e)?-1:this._map.get(e).successCount}},{key:"_calcSuccessCountOfPlatform",value:function(e){if(st(e)||!this._map.has(e))return-1;var t=this._map.get(e);return t.successCount+t.failedCountOfUserSide}},{key:"_calcAvg",value:function(e){return st(e)||!this._map.has(e)?-1:e===Mo?this._calcAvgSpeed(e):this._calcAvgCost(e)}},{key:"_calcAvgCost",value:function(e){var t=this._map.get(e).costArray.length;if(0===t)return 0;var n=0;return this._map.get(e).costArray.forEach((function(e){n+=e})),parseInt(n/t)}},{key:"_calcAvgSpeed",value:function(e){var t=0,n=0;return this._map.get(e).costArray.forEach((function(e){t+=e})),this._map.get(e).fileSizeArray.forEach((function(e){n+=e})),parseInt(1e3*n/t)}},{key:"getStatResult",value:function(e){var t=this._calcTotalCount(e);if(0===t)return null;var n=this._calcSuccessCountOfBusiness(e),i=this._calcSuccessRateOfBusiness(e),r=this._calcSuccessCountOfPlatform(e),o=this._calcSuccessRateOfPlatform(e),a=this._calcAvg(e);return this.reset(e),{totalCount:t,successCountOfBusiness:n,successRateOfBusiness:i,successCountOfPlatform:r,successRateOfPlatform:o,avgValue:a}}},{key:"reset",value:function(e){st(e)?this._map.clear():this._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}}]),e}(),tc=function(){function e(){i(this,e),this._lastMap=new Map,this._currentMap=new Map}return o(e,[{key:"initMap",value:function(e){var t=this;e.forEach((function(e){t._lastMap.set(e,new Map),t._currentMap.set(e,new Map)}))}},{key:"addMessageSequence",value:function(e){var t=e.key,n=e.message;if(st(t)||!this._lastMap.has(t)||!this._currentMap.has(t))return!1;var i=n.conversationID,r=n.sequence,o=i.replace(b.CONV_GROUP,"");if(0===this._lastMap.get(t).size)this._addCurrentMap(e);else if(this._lastMap.get(t).has(o)){var a=this._lastMap.get(t).get(o),s=a.length-1;r>a[0]&&r<a[s]?(a.push(r),a.sort(),this._lastMap.get(t).set(o,a)):this._addCurrentMap(e)}else this._addCurrentMap(e);return!0}},{key:"_addCurrentMap",value:function(e){var t=e.key,n=e.message,i=n.conversationID,r=n.sequence,o=i.replace(b.CONV_GROUP,"");this._currentMap.get(t).has(o)||this._currentMap.get(t).set(o,[]),this._currentMap.get(t).get(o).push(r)}},{key:"_copyData",value:function(e){if(!st(e)){this._lastMap.set(e,new Map);var t,n=this._lastMap.get(e),i=E(this._currentMap.get(e));try{for(i.s();!(t=i.n()).done;){var r=v(t.value,2),o=r[0],a=r[1];n.set(o,a)}}catch(s){i.e(s)}finally{i.f()}n=null,this._currentMap.set(e,new Map)}}},{key:"getStatResult",value:function(e){if(st(this._currentMap.get(e))||st(this._lastMap.get(e)))return null;if(0===this._lastMap.get(e).size)return this._copyData(e),null;var t=0,n=0;if(this._lastMap.get(e).forEach((function(e,i){var r=_(e.values()),o=r.length,a=r[o-1]-r[0]+1;t+=a,n+=o})),0===t)return null;var i=Gt(n/t*100,2);return i>100&&(i=100),this._copyData(e),{totalCount:t,successCountOfMessageReceived:n,successRateOfMessageReceived:i}}},{key:"reset",value:function(){this._currentMap.clear(),this._lastMap.clear()}}]),e}(),nc=function(e){s(r,e);var n=m(r);function r(e){var t;i(this,r),(t=n.call(this,e))._n="QualityStatModule",t.TAG="im-ssolog-quality-stat",t.reportIndex=0,t.wholePeriod=!1,t._qualityItems=[go,mo,vo,_o,yo,Io,Mo,To,Co,So],t._messageSentItems=[vo,_o,yo,Io,Mo],t._messageReceivedItems=[To,Co,So],t.REPORT_INTERVAL=120,t.REPORT_SDKAPPID_BLACKLIST=[],t.REPORT_TINYID_WHITELIST=[],t._statInfoArr=[],t._avgRTT=new Qs,t._avgE2EDelay=new Zs,t._rateMessageSent=new ec,t._rateMessageReceived=new tc;var o=t.getInnerEmitterInstance();return o.on(ea,t._onLoginSuccess,f(t)),o.on(ta,t._onCloudConfigUpdated,f(t)),t}return o(r,[{key:"_onLoginSuccess",value:function(){var e=this;this._rateMessageSent.initMap(this._messageSentItems),this._rateMessageReceived.initMap(this._messageReceivedItems);var t=this.getModule(Bn),n=t.getItem(this.TAG,!1);!$t(n)&&ut(n.forEach)&&(Be.l("".concat(this._n,"._onLoginSuccess get quality stat logs from local storage, count:").concat(n.length)),n.forEach((function(t){e._statInfoArr.push(t)})),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("q_rpt_interval"),t=this.getCloudConfig("q_rpt_sdkappid_bl"),n=this.getCloudConfig("q_rpt_tinyid_wl");st(e)||(this.REPORT_INTERVAL=Number(e)),st(t)||(this.REPORT_SDKAPPID_BLACKLIST=t.split(",").map((function(e){return Number(e)}))),st(n)||(this.REPORT_TINYID_WHITELIST=n.split(","))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this.REPORT_INTERVAL==0&&(this.wholePeriod=!0,this._report())}},{key:"addRequestCount",value:function(){this._avgRTT.addRequestCount()}},{key:"addRTT",value:function(e){this._avgRTT.addRTT(e)}},{key:"addMessageDelay",value:function(e){this._avgE2EDelay.addMessageDelay(e)}},{key:"addTotalCount",value:function(e){this._rateMessageSent.addTotalCount(e)||Be.w("".concat(this._n,".addTotalCount invalid key:"),e)}},{key:"addSuccessCount",value:function(e){this._rateMessageSent.addSuccessCount(e)||Be.w("".concat(this._n,".addSuccessCount invalid key:"),e)}},{key:"addFailedCountOfUserSide",value:function(e){this._rateMessageSent.addFailedCountOfUserSide(e)||Be.w("".concat(this._n,".addFailedCountOfUserSide invalid key:"),e)}},{key:"addCost",value:function(e,t){this._rateMessageSent.addCost(e,t)||Be.w("".concat(this._n,".addCost invalid key or cost:"),e,t)}},{key:"addFileSize",value:function(e,t){this._rateMessageSent.addFileSize(e,t)||Be.w("".concat(this._n,".addFileSize invalid key or size:"),e,t)}},{key:"addMessageSequence",value:function(e){this._rateMessageReceived.addMessageSequence(e)||Be.w("".concat(this._n,".addMessageSequence invalid key:"),e.key)}},{key:"_getQualityItem",value:function(e){var n={},i=bo[this.getNetworkType()];st(i)&&(i=8);var r={qualityType:Eo[e],timestamp:Ue(),networkType:i,extension:""};switch(e){case go:n=this._avgRTT.getStatResult();break;case mo:n=this._avgE2EDelay.getStatResult();break;case vo:case _o:case yo:case Io:case Mo:n=this._rateMessageSent.getStatResult(e);break;case To:case Co:case So:n=this._rateMessageReceived.getStatResult(e)}return null===n?null:t(t({},r),n)}},{key:"_report",value:function(e){var t=this,n=[],i=null;st(e)?this._qualityItems.forEach((function(e){null!==(i=t._getQualityItem(e))&&(i.reportIndex=t.reportIndex,i.wholePeriod=t.wholePeriod,n.push(i))})):null!==(i=this._getQualityItem(e))&&(i.reportIndex=this.reportIndex,i.wholePeriod=this.wholePeriod,n.push(i)),Be.d("".concat(this._n,"._report"),n),this._statInfoArr.length>0&&(n=n.concat(this._statInfoArr),this._statInfoArr=[]);var r=this.getModule(qn),o=r.getSDKAppID(),a=r.getTinyID();Ft(this.REPORT_SDKAPPID_BLACKLIST,o)&&!Vt(this.REPORT_TINYID_WHITELIST,a)&&(n=[]),n.length>0&&this._doReport(n)}},{key:"_doReport",value:function(e){var n=this,i={header:is(this),quality:e};this.request({protocolName:qr,requestData:t({},i)}).then((function(){n.reportIndex++,n.wholePeriod=!1})).catch((function(t){Be.w("".concat(n._n,"._doReport, online:").concat(n.getNetworkType()," error:"),t),n._statInfoArr=n._statInfoArr.concat(e),n._flushAtOnce()}))}},{key:"_flushAtOnce",value:function(){var e=this.getModule(Bn),t=e.getItem(this.TAG,!1),n=this._statInfoArr,i="".concat(this._n,"._flushAtOnce");if($t(t))Be.l("".concat(i," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1);else{var r=n.concat(t);r.length>10&&(r=r.slice(0,10)),Be.l("".concat(i," count:").concat(r.length)),e.setItem(this.TAG,r,!0,!1)}this._statInfoArr=[]}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._report(),this.reportIndex=0,this.wholePeriod=!1,this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[],this._avgRTT.reset(),this._avgE2EDelay.reset(),this._rateMessageSent.reset(),this._rateMessageReceived.reset()}}]),r}(ci),ic=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="WorkerTimerModule",r._isWorkerEnabled=!0,r._workerTimer=null,r._timerID=-1,r._init(),r.getInnerEmitterInstance().on(ta,r._onCloudConfigUpdated,f(r)),r}return o(n,[{key:"isWorkerEnabled",value:function(){return this._isWorkerEnabled&&De}},{key:"startWorkerTimer",value:function(){Be.l("".concat(this._n,".startWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("start")}},{key:"stopWorkerTimer",value:function(){Be.l("".concat(this._n,".stopWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("stop")}},{key:"_init",value:function(){if(De){var e=URL.createObjectURL(new Blob(['let interval = -1;onmessage = function(event) {  if (event.data === "start") {    if (interval > 0) {      clearInterval(interval);    }    interval = setInterval(() => {      postMessage("");    }, 1000);    postMessage(interval);  } else if (event.data === "stop") {    clearInterval(interval);    interval = -1;  }};'],{type:"application/javascript; charset=utf-8"}));this._workerTimer=new Worker(e);var t=this;this._workerTimer.onmessage=function(e){e.data?(t._timerID=e.data,Be.l("".concat(t._n,"._init seed:").concat(t._timerID))):t._m.onCheckTimer()}}}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("enable_worker");Be.l("".concat(this._n,"._onCloudConfigUpdated enableWorker:").concat(e)),st(e)||"1"===e?!this._isWorkerEnabled&&De&&(this._isWorkerEnabled=!0,this.startWorkerTimer(),this._m.onWorkerTimerEnabled()):this._isWorkerEnabled&&De&&(this._isWorkerEnabled=!1,this.stopWorkerTimer(),this._m.onWorkerTimerDisabled())}},{key:"terminate",value:function(){Be.l("".concat(this._n,".terminate")),this._workerTimer&&(this._workerTimer.terminate(),this._workerTimer=null,this._timerID=-1)}},{key:"getTimerID",value:function(){return this._timerID}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset"))}}]),n}(ci),rc=function(){function e(){i(this,e),this._n="PurchasedFeatureHandler",this._purchasedFeatureMap=new Map}return o(e,[{key:"isValidPurchaseBits",value:function(e){return e&&"string"==typeof e&&e.length>=1&&e.length<=64&&/[01]{1,64}/.test(e)}},{key:"parsePurchaseBits",value:function(e){var t="".concat(this._n,".parsePurchaseBits");if(this.isValidPurchaseBits(e)){this._purchasedFeatureMap.clear();for(var n=null,i=e.length-1,r=0;i>=0;i--,r++)n=r<32?new w(0,Math.pow(2,r)).toString():new w(Math.pow(2,r-32),0).toString(),"1"===e[i]?this._purchasedFeatureMap.set(n,!0):this._purchasedFeatureMap.set(n,!1)}else Be.w("".concat(t," invalid purchase bits:").concat(e))}},{key:"hasPurchasedFeature",value:function(e){return!!this._purchasedFeatureMap.get(e)}},{key:"isFeatureEnabled",value:function(e){for(var t=parseInt(e).toString(2),n=void 0,i=!0,r=t.length-1,o=0;r>=0;r--,o++)if("1"===t.charAt(r)&&(n=o<32?new w(0,Math.pow(2,o)).toString():new w(Math.pow(2,o-32),0).toString(),!this._purchasedFeatureMap.get(n))){i=!1;break}return Be.l("".concat(this._n,".isFeatureEnabled decimalNumber:").concat(e," binaryString:").concat(t," ret:").concat(i)),Jo({enabled:i})}},{key:"clear",value:function(){this._purchasedFeatureMap.clear()}}]),e}(),oc=function(){function e(t){i(this,e),this._m=t,this._n="CommercialConfigModule",this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler=new rc}return o(e,[{key:"_canFetch",value:function(){return this._getModule(qn).isLoggedIn()?!this._isFetching&&Date.now()>=this._expiredTime:(this._expiredTime=Date.now()+2e3,!1)}},{key:"onCheckTimer",value:function(e){this._canFetch()&&this.fetchConfig()}},{key:"fetchConfig",value:function(){var e=this,t=this._canFetch(),n="".concat(this._n,".fetchConfig");if(Be.l("".concat(n," canFetch:").concat(t)),t){var i=this._getModule(jn),r=new wo("fetchCommercialConfig");r.setNetworkType(i.getNetworkType());var o=this._getModule(qn).getSDKAppID(),a=this._getModule($n);this._isFetching=!0,a.request({protocolName:Xr,requestData:{SDKAppID:o}}).then((function(t){r.setMessage("purchaseBits:".concat(t.data.purchaseBits)).end(),Be.l("".concat(n," ok.")),e._parseConfig(t.data),e._isFetching=!1})).catch((function(t){i.probe().then((function(e){var n=v(e,2),i=n[0],o=n[1];r.setError(t,i,o).end()})),e._isFetching=!1}))}}},{key:"onPushedConfig",value:function(e){var t="".concat(this._n,".onPushedConfig");Be.l("".concat(t)),new wo("pushedCommercialConfig").setNetworkType(this._getModule(jn).getNetworkType()).setMessage("purchaseBits:".concat(e.purchaseBits)).end(),this._parseConfig(e)}},{key:"_parseConfig",value:function(e){var t="".concat(this._n,"._parseConfig"),n=e.errorCode,i=e.errorMessage,r=e.purchaseBits,o=e.expiredTime;0===n?(this._purchasedFeatureHandler.parsePurchaseBits(r),this._expiredTime=Date.now()+1e3*o):st(n)?(Be.l("".concat(t," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(Be.e("".concat(t," errorCode:").concat(n," errorMessage:").concat(i)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"canIUse",value:function(e){return this._purchasedFeatureHandler.hasPurchasedFeature(e)}},{key:"isFeatureEnabled",value:function(e){return this._purchasedFeatureHandler.isFeatureEnabled(e)}},{key:"_getModule",value:function(e){return this._m.getModule(e)}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler.clear()}}]),e}(),ac=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._m=e,r._n="OfflinePushModule",r._offlinePushPlugin=void 0,r._androidPushConfig={huaweiPushBussinessId:"",xiaomiPushBussinessId:"",xiaomiPushAppId:"",xiaomiPushAppKey:"",meizuPushBussinessId:"",meizuPushAppId:"",meizuPushAppKey:"",vivoPushBussinessId:"",fcmPushBussinessId:"",oppoPushBussinessId:"",oppoPushAppKey:"",oppoPushAppSecret:"",honorPushBussinessId:""},r._deviceToken="",r._businessID=0,r._iosBusinessID=0,r._c2cUnreadCount=0,r._groupUnreadCount=0,r._isWebUniapp=0,r}return o(n,[{key:"registerPlugin",value:function(e){if(ie){this._offlinePushPlugin=e["tim-offline-push-plugin"];var t=e.offlinePushConfig||{},n=t.huaweiBusinessID,i=t.xiaomiBusinessID,r=t.xiaomiAppID,o=t.xiaomiAppKey,a=t.meizuBusinessID,s=t.meizuAppID,c=t.meizuAppKey,u=t.vivoBusinessID,l=t.oppoBusinessID,d=t.oppoAppKey,p=t.oppoAppSecret,h=t.honorBusinessID,f=t.iosBusinessID;this._androidPushConfig.huaweiPushBussinessId=n,this._androidPushConfig.xiaomiPushBussinessId=i,this._androidPushConfig.xiaomiPushAppId=r,this._androidPushConfig.xiaomiPushAppKey=o,this._androidPushConfig.meizuPushBussinessId=a,this._androidPushConfig.meizuPushAppId=s,this._androidPushConfig.meizuPushAppKey=c,this._androidPushConfig.vivoPushBussinessId=u,this._androidPushConfig.oppoPushBussinessId=l,this._androidPushConfig.oppoPushAppKey=d,this._androidPushConfig.oppoPushAppSecret=p,this._androidPushConfig.honorPushBussinessId=h,new wo("registerPlugin").setMessage("tim-offline-push-plugin").setMoreMessage("isExist:".concat(!st(this._offlinePushPlugin))).end(!0),Be.l("".concat(this._n,".").concat("registerPlugin"," ok. offlinePushConfig:").concat(JSON.stringify(e.offlinePushConfig))),this._iosBusinessID=f,this._setAppShowListener()}else this.outputWarning("OfflinePushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._getDeviceToken()}},{key:"_getDeviceToken",value:function(){var e=this,t="".concat(this._n,".").concat("_getDeviceToken");if(ut(this._offlinePushPlugin.getDeviceToken)){var n="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig),", iosBusinessID:").concat(this._iosBusinessID);Be.l("".concat(t," start. ").concat(n)),new wo("_getDeviceToken").setMessage("".concat(n)).end(!0),this._offlinePushPlugin.getDeviceToken(this._androidPushConfig,(function(i){var r=new wo("getDeviceTokenRes"),o=i.code,a=i.msg;if(0===o){var s=i.data,c=s.deviceToken,u=s.deviceBrand,l=s.deviceType,d=s.bussinessId;e._deviceToken=c,e._businessID=d||e._iosBusinessID,n="deviceToken:".concat(c,", deviceBrand:").concat(u||l,", businessID:").concat(e._businessID),Be.l("".concat(t," ok. ").concat(n)),r.setMessage(n).end(!0),e._setToken()}else r.setMessage("code:".concat(o,", msg:").concat(a)).end(!0),Be.e("".concat(t," failed. error:"),i)}))}else Be.e("".concat(t," getDeviceToken is not a function"))}},{key:"canIUseOfflinePush",value:function(){return ie&&!st(this._offlinePushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setAppShowListener");st(this._offlinePushPlugin)?Be.e("".concat(t," offlinePushPlugin is undefined")):ut(this._offlinePushPlugin.setAppShowListener)?(new wo("_setAppShowListener").end(!0),Be.l("".concat(t," start")),this._offlinePushPlugin.setAppShowListener((function(n){var i=(n||{}).appShow;new wo("setAppShowListenerRes").setMessage("appShow:".concat(i)).end(!0),Be.l("".concat(t," ok. appShow:").concat(i)),e._m.isReady()&&(0===i?(e._getConvUnreadCount(),e._onBackground()):1===i&&e._onForeground())}))):Be.e("".concat(t," setAppShowListener is not a function"))}},{key:"getDeviceBrand",value:function(){if(!st(this._offlinePushPlugin)&&ut(this._offlinePushPlugin.getDeviceType)){var e=(this._offlinePushPlugin.getDeviceType()||{}).deviceType;return Be.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}}},{key:"_setToken",value:function(){var e,t=this,n="".concat(this._n,"._setToken"),i=this.getModule(qn),r=1,o="",a="";$t(this._deviceToken)&&(r=0);var s=this.getUniAppPlatform(),c=this.getDeviceBrand();s===R.IOS||s===R.IPAD||s===R.MAC?a=this._deviceToken:s===R.ANDROID&&(o=this._deviceToken);var u=new wo("offlinePushSetToken");return e="deviceToken:".concat(a||o,", businessID:").concat(this._businessID,", ")+"deviceBrand:".concat(c,", isWebUniapp:").concat(this._isWebUniapp,", pushMsg:").concat(r,", platform:").concat(s),u.setMessage("".concat(e)),Be.l("".concat(n," ").concat(e)),this.request({protocolName:lo,requestData:{tokenID:o,pushMsg:r,sdkAppID:i.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:c,deviceToken:a,isWebUniapp:this._isWebUniapp}}).then((function(e){return u.end(),Be.l("".concat(n," ok")),e})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],r=n[1];u.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Xo(e)}))}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.getModule(Vn).getLocalConversationList().forEach((function(t){t.type===b.CONV_C2C&&(e._c2cUnreadCount+=t.unreadCount),t.type===b.CONV_GROUP&&(e._groupUnreadCount+=t.unreadCount)}))}},{key:"_onBackground",value:function(){var e=this,t="".concat(this._n,".").concat("_onBackground"),n=new wo("_onBackground");this.request({protocolName:co,requestData:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then((function(i){return n.setMessage("c2cUnreadCount: ".concat(e._c2cUnreadCount,", groupUnreadCount: ").concat(e._groupUnreadCount)).end(),Be.l("".concat(t," ok")),i})).catch((function(i){e.probeNetwork().then((function(e){var t=v(e,2),r=t[0],o=t[1];n.setError(i,r,o).end()})),Be.e("".concat(t," failed. error:"),i)}))}},{key:"_onForeground",value:function(){var e=this,t="".concat(this._n,".").concat("_onForeground"),n=new wo("_onForeground");this.request({protocolName:uo,requestData:{isWebUniapp:this._isWebUniapp}}).then((function(e){return n.end(),Be.l("".concat(t," ok")),e})).catch((function(i){e.probeNetwork().then((function(e){var t=v(e,2),r=t[0],o=t[1];n.setError(i,r,o).end()})),Be.e("".concat(t," failed. error:"),i)}))}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,t=this.getDeviceBrand();return"ios"===e?R.IOS:"android"===e?R.ANDROID:1002===t?R.IPAD:1001===t?R.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,Be.l("".concat(this._n,".reset"))}}]),n}(ci),sc=function(e){s(n,e);var t=m(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._n="ProfanityFilterModule",r._plugin=null,r._filterConfigMap=new Map,r._startIndex=0,r._version=0,r._canIUseLexicon=!1,r._isFetching=!1,r._expiredTime=0,r}return o(n,[{key:"init",value:function(){var e=this.getModule(Wn).getPlugin("tim-profanity-filter-plugin");e?(this._plugin=new e({logger:Be,isArray:at,isMap:Qe,isDevMode:this.isDevMode()}),this._getLexicon()):this.outputWarning("ProfanityPluginNotFound")}},{key:"onCheckTimer",value:function(){this._plugin&&this._canIUseLexicon&&this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime&&this._getLexicon()}},{key:"filterMessage",value:function(e,t){var n=!0;if(!this._plugin||!this._canIUseLexicon)return n;if(t&&t.messageControlInfo&&!0===t.messageControlInfo.excludedFromContentModeration)return n;var i=e.type,r=e.conversationType;if(i!==b.MSG_TEXT&&i!==b.MSG_CUSTOM)return n;var o,a="".concat(this._n,".filterMessage");if(Be.l("".concat(a)),i===b.MSG_TEXT){if(r===b.CONV_C2C?o=j:r===b.CONV_GROUP&&(o=z),!this._isConfigOn(o))return n;var s=this._plugin.filter(e.payload.text),c=s.type,u=s.modifiedText;1===c?n=!1:2===c&&(e.payload.text=u)}else if(i===b.MSG_CUSTOM){if(r===b.CONV_C2C?o=K:r===b.CONV_GROUP&&(o=W),!this._isConfigOn(o))return n;var l=this._plugin.filter(e.payload.data),d=this._plugin.filter(e.payload.description),p=this._plugin.filter(e.payload.extension);1===l.type||1===d.type||1===p.type?n=!1:(2===l.type&&(e.payload.data=l.modifiedText),2===d.type&&(e.payload.description=d.modifiedText),2===p.type&&(e.payload.extension=p.modifiedText))}return Be.l("".concat(a," done. isAllowedToSend:").concat(n)),n}},{key:"filterText",value:function(e,t){var n="".concat(this._n,".filterText"),i={isAllowedToSend:!0,modifiedText:e};if(!this._plugin||!this._canIUseLexicon)return i;if(!this._isConfigOn(t))return i;Be.l("".concat(n));var r=this._plugin.filter(e),o=r.type,a=r.modifiedText;return 1===o?i.isAllowedToSend=!1:2===o&&(i.modifiedText=a),Be.l("".concat(n," done. ret:"),i),i}},{key:"_getLexicon",value:function(){var e=this,t=new wo("profanityFilter"),n="".concat(this._n,"._getLexicon");this._isFetching=!0,this.request({protocolName:po,requestData:{startIndex:this._startIndex,version:this._version}}).then((function(i){var r=i.data,o=r.errorInfo,a=r.filterConfig,s=r.lexicon,c=r.strToken,u=r.completeFlag,l=r.nextStartIndex,d=r.version,p=r.expiredTime,h=o.errorCode,f=o.errorMessage;return 0!==h?(e._isFetching=!1,Be.w("".concat(n," failed. error:"),o),void t.setCode(h).setMessage(f).end()):(e._onFilterConfig(a),e._getToken(c),1===u?(Be.l("".concat(n," done. version:").concat(d," expiredTime:").concat(p)),e._version=d,e._canIUseLexicon=!0,e._isFetching=!1,e._expiredTime=Date.now()+1e3*p,void e._plugin.onLexiconCompleted(s)):(e._startIndex=l,e._plugin.onLexiconSliced(s),void e._getLexicon()))})).catch((function(i){e.probeNetwork().then((function(e){var n=v(e,2),r=n[0],o=n[1];t.setError(i,r,o).end()})),e._isFetching=!1,Be.l("".concat(n," failed. error:"),i)}))}},{key:"_onFilterConfig",value:function(e){var t=this;$t(e)||(this._filterConfigMap.clear(),Object.keys(e).forEach((function(n){t._filterConfigMap.set(n,e[n])})),Be.l("".concat(this._n,"._onFilterConfig. keys:").concat(Array.from(this._filterConfigMap.keys())," values:").concat(Array.from(this._filterConfigMap.values()))))}},{key:"_isConfigOn",value:function(e){return 1===this._filterConfigMap.get(e)}},{key:"_getToken",value:function(e){if(it(e)){var t=e.length,n="";if(t%2==0)for(var i=0;i<=t-1;i+=2)n+=e[i+1],n+=e[i];else{for(var r=0;r<t-1;r+=2)n+=e[r+1],n+=e[r];n+=e[t-1]}this._plugin.onToken(n)}}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._plugin&&(this._plugin.reset(),this._plugin=null),this._filterConfigMap.clear(),this._startIndex=0,this._version=0,this._canIUseLexicon=!1,this._isFetching=!1,this._expiredTime=0}}]),n}(ci),cc=function(){function e(t){i(this,e),this._m=t,this._n="TransCmdModule"}return o(e,[{key:"sendTRTCCustomData",value:function(e){return this._trans(t({serv:B.NAME.TUIROOM_SVR},e))}},{key:"_trans",value:function(e){Be.d("".concat(this._n,"._trans. options:").concat(JSON.stringify(e)));var t=e.serv,n=e.data;return this._m.getModule($n).trans({servcmd:"".concat(t,".*"),data:it(n)?JSON.parse(n):n})}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset"))}}]),e}(),uc=function(){function e(t){i(this,e),this._m=t,this._n="ErrorMessageModule",this.TIM_ERROR_ASSISTANCE="tim_error_assistance",this.STORAGE_EXPIRES_TIME=6048e5,this._map=new Map,this._init()}return o(e,[{key:"_init",value:function(){var e=this._getStorageModule().getItem(this.TIM_ERROR_ASSISTANCE,!1);if(e){var t=JSON.parse(e);this._needToUpdate(t)?this._fetch():this._fillMap(t.message)}else this._fetch()}},{key:"_needToUpdate",value:function(e){var t=e.localSavedTime,n=e.localSavedVersion,i=t&&(new Date).getTime()-t>=this.STORAGE_EXPIRES_TIME,r=!n||"2.27.1"!==n;return Be.l("".concat(this._n,"._needToUpdate isTimeout:").concat(i," isDifferentVersion:").concat(r)),i||r}},{key:"_fetch",value:function(){if(!this._m.getModule(qn).isPrivateNetWork()){var e="https://web.sdk.qcloud.com/im/download/error-message/0.0.1/tim-error-message.txt",t="application/x-www-form-urlencoded;charset=UTF-8",n="".concat(this._n,"._fetch ok in"),i=this;if(oe)se.request({url:e,method:"GET",timeout:3e3,header:{"content-type":t},dataType:"text",success:function(e){i._fillAndSave(e.data),Be.l("".concat(n," mini program"))},fail:function(){}});else{var r=new XMLHttpRequest,o=setTimeout((function(){r.abort()}),3e3);r.onreadystatechange=function(){4===r.readyState&&(clearTimeout(o),200!==r.status&&304!==r.status||(Be.l("".concat(n," browser")),i._fillAndSave(r.responseText)))},r.open("GET",e,!0),r.setRequestHeader("Content-type",t),r.send()}}}},{key:"_fillAndSave",value:function(e){this._fillMap(e),this._getStorageModule().setItem(this.TIM_ERROR_ASSISTANCE,JSON.stringify({message:e,localSavedTime:(new Date).getTime(),localSavedVersion:"2.27.1"}),!0,!1)}},{key:"_getStorageModule",value:function(){return this._m.getModule(Bn)}},{key:"_fillMap",value:function(e){this._map.clear();for(var t,n,i,r=e.split(";\n"),o=r.length,a=new RegExp(/'/g),s=0;s<o;s++)if(t=r[s].indexOf(":"),n=r[s].slice(0,t),i=r[s].slice(t+1,r[s].length),!n.startsWith("//")){if(st(i))continue;this._map.set(n,i.replace(a,""))}}},{key:"get",value:function(e){var t=e.isIntl,n=e.key,i=e.replacement1,r=e.replacement2,o="".concat(n,t?"_en":"_cn");!this._map.has(o)&&this._map.has(n)&&(o=n);var a="";return this._map.has(o)?(a=this._map.get(o),st(i)||(a=a.replace("$replacement1",i)),st(r)||(a=a.replace("$replacement2",r)),a):a}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset"))}}]),e}(),lc=function(){function e(t){i(this,e);var n=new wo("sdkConstruct");this._n="ModuleManager",this._isReady=!1,this._reason=fo.USER_NOT_LOGGED_IN,this._startLoginTs=0,this._moduleMap=new Map,this._innerEmitter=null,this._outerEmitter=null,this._checkCount=0,this._checkTimer=-1,this._moduleMap.set(qn,new Za(this,t)),this._moduleMap.set(ni,new oc(this)),this._moduleMap.set(Zn,new Js(this)),this._moduleMap.set(Qn,new ic(this)),this._moduleMap.set(ti,new nc(this)),this._moduleMap.set(Jn,new qs(this)),this._moduleMap.set($n,new Ys(this)),this._moduleMap.set(Rn,new Qa(this)),this._moduleMap.set(Ln,new _s(this)),this._moduleMap.set(On,new ys(this)),this._moduleMap.set(ai,new Is(this)),this._moduleMap.set(Nn,new Xa(this)),this._moduleMap.set(Pn,new Zo(this)),this._moduleMap.set(Vn,new ya(this)),this._moduleMap.set(Un,new Fa(this)),this._moduleMap.set(Gn,new qa(this)),this._moduleMap.set(Fn,new Ka(this)),this._moduleMap.set(Bn,new ts(this)),this._moduleMap.set(si,new uc(this)),this._moduleMap.set(Hn,new rs(this)),this._moduleMap.set(jn,new cs(this)),this._moduleMap.set(Kn,new ls(this)),this._moduleMap.set(zn,new ps(this)),this._moduleMap.set(Wn,new Ms(this)),this._moduleMap.set(Yn,new Ts(this)),this._moduleMap.set(Xn,new $s(this)),this._moduleMap.set(ei,new Xs(this)),this._moduleMap.set(ii,new ac(this)),this._moduleMap.set(ri,new sc(this)),this._moduleMap.set(oi,new cc(this)),this._eventThrottleMap=new Map;var r=t.instanceID,o=t.oversea,a=t.SDKAppID,s="instanceID:".concat(r," SDKAppID:").concat(a," host:").concat(Ot()," oversea:").concat(o," inBrowser:").concat(ae," inMiniApp:").concat(oe)+" workerAvailable:".concat(De," UserAgent:").concat(ce);wo.bindEventStatModule(this._moduleMap.get(Hn)),n.setMessage("".concat(s," ").concat(function(){var e="";if(oe)try{var t=se.getSystemInfoSync(),n=t.model,i=t.version,r=t.system,o=t.platform,a=t.SDKVersion;e="model:".concat(n," version:").concat(i," system:").concat(r," platform:").concat(o," SDKVersion:").concat(a)}catch(s){e=""}return e}())).end(),Be.i("SDK ".concat(s)),Wo.prototype._getErrorMessage=this.getErrorMessage.bind(this),this._readyList=void 0,this._ssoLogForReady=null,this._initReadyList()}return o(e,[{key:"_startTimer",value:function(){var e=this._moduleMap.get(Qn),t=e.isWorkerEnabled();Be.l("".concat(this._n,".startTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.startWorkerTimer():this._startMainThreadTimer()}},{key:"_startMainThreadTimer",value:function(){this._checkTimer<0&&(this._checkTimer=setInterval(this.onCheckTimer.bind(this),1e3)),Be.l("".concat(this._n,"._startMainThreadTimer seed:").concat(this._checkTimer))}},{key:"stopTimer",value:function(){var e=this._moduleMap.get(Qn),t=e.isWorkerEnabled();Be.l("".concat(this._n,".stopTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.stopWorkerTimer():this._stopMainThreadTimer()}},{key:"_stopMainThreadTimer",value:function(){Be.l("".concat(this._n,"._stopMainThreadTimer")),this._checkTimer>0&&(clearInterval(this._checkTimer),this._checkTimer=-1,this._checkCount=0)}},{key:"_stopMainThreadSocket",value:function(){Be.l("".concat(this._n,"._stopMainThreadSocket"));var e=this._moduleMap.get(Jn);e.setIsWorkerEnabled(!0),e.reConnect()}},{key:"_startMainThreadSocket",value:function(){Be.l("".concat(this._n,"._startMainThreadSocket"));var e=this._moduleMap.get(Jn);e.setIsWorkerEnabled(!1),e.reConnect()}},{key:"onWorkerTimerEnabled",value:function(){Be.l("".concat(this._n,".onWorkerTimerEnabled, disable main thread timer and socket")),this._stopMainThreadTimer(),this._stopMainThreadSocket()}},{key:"onWorkerTimerDisabled",value:function(){Be.l("".concat(this._n,".onWorkerTimerDisabled, enable main thread timer and socket")),this._startMainThreadTimer(),this._startMainThreadSocket()}},{key:"onCheckTimer",value:function(){this._checkCount+=1;var e,t=E(this._moduleMap);try{for(t.s();!(e=t.n()).done;){var n=v(e.value,2)[1];n.onCheckTimer&&n.onCheckTimer(this._checkCount)}}catch(i){t.e(i)}finally{t.f()}}},{key:"_initReadyList",value:function(){var e=this;this._readyList=[this._moduleMap.get(Rn),this._moduleMap.get(Vn)],this._readyList.forEach((function(t){t.ready((function(){return e._onModuleReady()}))}))}},{key:"_onModuleReady",value:function(){var e=!0;if(this._readyList.forEach((function(t){t.isReady()||(e=!1)})),e&&!this._isReady){this._isReady=!0,this._outerEmitter.emit(k.SDK_READY);var t=Date.now()-this._startLoginTs;Be.w("SDK is ready. cost ".concat(t," ms")),this._startLoginTs=Date.now();var n=this._moduleMap.get(jn).getNetworkType(),i=this._ssoLogForReady.getStartTs()+Pe;this._ssoLogForReady.setNetworkType(n).setMessage(t).start(i).end()}}},{key:"login",value:function(){0===this._startLoginTs&&(xe(),this._startLoginTs=Date.now(),this._startTimer(),this._moduleMap.get(jn).start(),this._ssoLogForReady=new wo("sdkReady"),this._reason=fo.LOGGING_IN)}},{key:"onLoginFailed",value:function(){this._startLoginTs=0}},{key:"getOuterEmitterInstance",value:function(){return null===this._outerEmitter&&(this._outerEmitter=new us,$o(this._outerEmitter),this._outerEmitter._emit=this._outerEmitter.emit,this._outerEmitter.emit=function(e,t){var n=this;if(e===k.CONVERSATION_LIST_UPDATED||e===k.FRIEND_LIST_UPDATED||e===k.GROUP_LIST_UPDATED||e===k.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED)if(this._eventThrottleMap.has(e)){var i=Date.now(),r=this._eventThrottleMap.get(e);i-r.last<=1e3?(r.timeoutID&&clearTimeout(r.timeoutID),r.timeoutID=setTimeout((function(){r.last=Date.now(),n._outerEmitter._emit.apply(n._outerEmitter,[e,{name:e,data:n._getEventData(e)}])}),1e3)):(r.last=i,this._outerEmitter._emit.apply(this._outerEmitter,[e,{name:e,data:this._getEventData(e)}]))}else this._eventThrottleMap.set(e,{last:Date.now(),timeoutID:-1}),this._outerEmitter._emit.apply(this._outerEmitter,[e,{name:e,data:this._getEventData(e)}]);else this._outerEmitter._emit.apply(this._outerEmitter,[e,{name:e,data:arguments[1]}])}.bind(this)),this._outerEmitter}},{key:"_getEventData",value:function(e){return e===k.CONVERSATION_LIST_UPDATED?this._moduleMap.get(Vn).getLocalConversationList():e===k.FRIEND_LIST_UPDATED?this._moduleMap.get(xn).getLocalFriendList(!1):e===k.GROUP_LIST_UPDATED?this._moduleMap.get(Un).getLocalGroupList():e===k.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?this._moduleMap.get(Vn).getTotalUnreadMessageCount():void 0}},{key:"getInnerEmitterInstance",value:function(){return null===this._innerEmitter&&(this._innerEmitter=new us,this._innerEmitter._emit=this._innerEmitter.emit,this._innerEmitter.emit=function(e,t){var n;n=ot(arguments[1])&&arguments[1].data?[e,{name:arguments[0],data:arguments[1].data}]:[e,{name:arguments[0],data:arguments[1]}],this._innerEmitter._emit.apply(this._innerEmitter,n)}.bind(this)),this._innerEmitter}},{key:"hasModule",value:function(e){return this._moduleMap.has(e)}},{key:"getModule",value:function(e){return this._moduleMap.get(e)}},{key:"isReady",value:function(){return this._isReady}},{key:"isIntl",value:function(){return this.getModule(qn).isIntl()}},{key:"getNotReadyReason",value:function(){return this._reason}},{key:"setNotReadyReason",value:function(e){this._reason=e}},{key:"getErrorMessage",value:function(e,t,n){return this._moduleMap.get(si).get({key:e,replacement1:t,replacement2:n,isIntl:this.isIntl()})}},{key:"outputWarning",value:function(e,t,n){var i=this.getErrorMessage(e,t,n);i&&Be.w(i)}},{key:"onError",value:function(e){var t="code:".concat(e.code," message:").concat(e.message);Be.w("Oops! ".concat(t)),new wo("error").setMessage(t).setNetworkType(this.getModule(jn).getNetworkType()).setLevel("error").end(),this.getOuterEmitterInstance().emit(k.ERROR,e)}},{key:"restartTimer",value:function(){Be.l("".concat(this._n,".restartTimer")),this.stopTimer(),this._startTimer(),this.getModule(Un).restartPolling()}},{key:"getTimerID",value:function(){var e=this._moduleMap.get(Qn);return e.isWorkerEnabled()?e.getTimerID():this._checkTimer}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),xe();var e,t=E(this._moduleMap);try{for(t.s();!(e=t.n()).done;){var n=v(e.value,2)[1];n.reset&&n.reset()}}catch(a){t.e(a)}finally{t.f()}this._startLoginTs=0,this._initReadyList(),this._isReady=!1,this.stopTimer(),this._outerEmitter.emit(k.SDK_NOT_READY);var i,r=E(this._eventThrottleMap);try{for(r.s();!(i=r.n()).done;){var o=v(i.value,2)[1];o.timeoutID&&clearTimeout(o.timeoutID)}}catch(a){r.e(a)}finally{r.f()}this._eventThrottleMap.clear()}}]),e}(),dc=function(){function e(t){i(this,e),this._funcMap=new Map,this._m=t}return o(e,[{key:"defense",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if("string"!=typeof e)return null;if(0===e.length)return null;if("function"!=typeof t)return null;if(this._funcMap.has(e)&&this._funcMap.get(e).has(t))return this._funcMap.get(e).get(t);this._funcMap.has(e)||this._funcMap.set(e,new Map);var i=null;return this._funcMap.get(e).has(t)?i=this._funcMap.get(e).get(t):(i=this._pack(e,t,n),this._funcMap.get(e).set(t,i)),i}},{key:"defenseOnce",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return"function"!=typeof t?null:this._pack(e,t,n)}},{key:"find",value:function(e,t){return"string"!=typeof e||0===e.length||"function"!=typeof t?null:this._funcMap.has(e)&&this._funcMap.get(e).has(t)?this._funcMap.get(e).get(t):(this._m.outputWarning("ListenerFnNotFound",e),null)}},{key:"delete",value:function(e,t){return"function"==typeof t&&!!this._funcMap.has(e)&&!!this._funcMap.get(e).has(t)&&(this._funcMap.get(e).delete(t),0===this._funcMap.get(e).size&&this._funcMap.delete(e),!0)}},{key:"_pack",value:function(e,t,n){var i=this;return function(){try{t.apply(n,Array.from(arguments))}catch(s){var r=Object.values(k).indexOf(e),o="CallbackError";if(-1!==r){var a=Object.keys(k)[r];i._m.outputWarning(o,a,s)}new wo(o).setMessage("eventName:".concat(e)).setMoreMessage(s.message).end()}}}}]),e}(),pc=function(){function e(t){i(this,e);var n={SDKAppID:t.SDKAppID,unlimitedAVChatRoom:t.unlimitedAVChatRoom||!1,scene:t.scene||"",oversea:t.oversea||!1,instanceID:Lt(),devMode:t.devMode||!1,proxyServer:t.proxyServer||void 0,fileUploadProxy:t.fileUploadProxy||void 0,fileDownloadProxy:t.fileDownloadProxy||t.fileUploadProxy||void 0};this._m=new lc(n),this._safetyCallbackFactory=new dc(this._m)}return o(e,[{key:"onError",value:function(e){this._m.onError(e)}},{key:"login",value:function(e){return this._m.login(),this._getModule(Rn).login(e)}},{key:"logout",value:function(){var e=this;return this._getModule(Rn).logout().then((function(t){return e._m.reset(),t}))}},{key:"isReady",value:function(){return this._m.isReady()}},{key:"isIntl",value:function(){return this._m.isIntl()}},{key:"getNotReadyReason",value:function(){return this._m.getNotReadyReason()}},{key:"getErrorMessage",value:function(e,t,n){return this._m.getErrorMessage(e,t,n)}},{key:"_getModule",value:function(e){return this._m.getModule(e)}},{key:"destroy",value:function(){var e=this;return this.logout().finally((function(){e._m.stopTimer(),e._getModule(Qn).terminate(),e._getModule(Jn).dealloc();var t=e._m.getOuterEmitterInstance(),n=e._getModule(qn);t.emit(k.SDK_DESTROY,{SDKAppID:n.getSDKAppID()})}))}},{key:"on",value:function(e,t,n){Be.d("on","eventName:".concat(e)),this._m.getOuterEmitterInstance().on(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"once",value:function(e,t,n){Be.d("once","eventName:".concat(e)),this._m.getOuterEmitterInstance().once(e,this._safetyCallbackFactory.defenseOnce(e,t,n),n||this)}},{key:"off",value:function(e,t,n,i){Be.d("off","eventName:".concat(e));var r=this._safetyCallbackFactory.find(e,t);null!==r&&(this._m.getOuterEmitterInstance().off(e,r,n,i),this._safetyCallbackFactory.delete(e,t))}},{key:"registerPlugin",value:function(e){st(e["tim-offline-push-plugin"])?this._getModule(Wn).registerPlugin(e):this._getModule(ii).registerPlugin(e)}},{key:"setLogLevel",value:function(e){e<=0&&(this.getErrorMessage("TIM_ASCII_ART"),this.getErrorMessage("API_REFER")&&Kt(),this.getErrorMessage("DOCS_GUIDE")),Be.setLevel(e)}},{key:"createTextMessage",value:function(e){return this._getModule(Ln).createTextMessage(e)}},{key:"createTextAtMessage",value:function(e){return this._getModule(Ln).createTextMessage(e)}},{key:"createImageMessage",value:function(e){return this._getModule(Ln).createImageMessage(e)}},{key:"createAudioMessage",value:function(e){return this._getModule(Ln).createAudioMessage(e)}},{key:"createVideoMessage",value:function(e){return this._getModule(Ln).createVideoMessage(e)}},{key:"createCustomMessage",value:function(e){return this._getModule(Ln).createCustomMessage(e)}},{key:"createFaceMessage",value:function(e){return this._getModule(Ln).createFaceMessage(e)}},{key:"createFileMessage",value:function(e){return this._getModule(Ln).createFileMessage(e)}},{key:"createLocationMessage",value:function(e){return this._getModule(Ln).createLocationMessage(e)}},{key:"createMergerMessage",value:function(e){return this._getModule(Ln).createMergerMessage(e)}},{key:"downloadMergerMessage",value:function(e){return e.type!==b.MSG_MERGER?Xo({code:fo.MESSAGE_MERGER_TYPE_INVALID}):$t(e.payload.downloadKey)?Xo({code:fo.MESSAGE_MERGER_KEY_INVALID}):this._getModule(Ln).downloadMergerMessage(e).catch((function(e){return Xo({code:fo.MESSAGE_MERGER_DOWNLOAD_FAIL})}))}},{key:"createForwardMessage",value:function(e){return this._getModule(Ln).createForwardMessage(e)}},{key:"sendMessage",value:function(e,t){return e instanceof Ko?this._getModule(Ln).sendMessageInstance(e,t):Xo({code:fo.MESSAGE_SEND_NEED_MESSAGE_INSTANCE})}},{key:"callExperimentalAPI",value:function(e,t){return"sendComboMessage"===e?this._getModule(ai).sendMessage(t):"handleGroupInvitation"===e?this._getModule(Un).handleGroupInvitation(t):"isCommercialAbilityEnabled"===e?this._getModule(ni).isFeatureEnabled(t):"isIntl"===e?this.isIntl():"sendTRTCCustomData"===e?this._getModule(oi).sendTRTCCustomData(t):"getTimerID"===e?this._m.getTimerID():Xo({code:fo.INVALID_OPERATION})}},{key:"revokeMessage",value:function(e){return this._getModule(Ln).revokeMessage(e)}},{key:"resendMessage",value:function(e){return this._getModule(Ln).resendMessage(e)}},{key:"deleteMessage",value:function(e){return this._getModule(Ln).deleteMessage(e)}},{key:"translateText",value:function(e){return this._getModule(Ln).translateText(e)}},{key:"setMessageExtensions",value:function(e,t){return this._getModule(On).setMessageExtensions(e,t)}},{key:"getMessageExtensions",value:function(e){return this._getModule(On).getMessageExtensions(e)}},{key:"deleteMessageExtensions",value:function(e,t){return this._getModule(On).deleteMessageExtensions(e,t)}},{key:"modifyMessage",value:function(e){return this._getModule(Ln).modifyRemoteMessage(e)}},{key:"getMessageList",value:function(e){return this._getModule(Vn).getMessageList(e)}},{key:"getMessageListHopping",value:function(e){return this._getModule(Vn).getMessageListHopping(e)}},{key:"sendMessageReadReceipt",value:function(e){return this._getModule(Vn).sendReadReceipt(e)}},{key:"getMessageReadReceiptList",value:function(e){return this._getModule(Vn).getReadReceiptList(e)}},{key:"getGroupMessageReadMemberList",value:function(e){return this._getModule(Un).getReadReceiptDetail(e)}},{key:"findMessage",value:function(e){return this._getModule(Vn).findMessage(e)}},{key:"setMessageRead",value:function(e){return this._getModule(Vn).setMessageRead(e)}},{key:"getConversationList",value:function(e){return this._getModule(Vn).getConversationList(e)}},{key:"getConversationProfile",value:function(e){return this._getModule(Vn).getConversationProfile(e)}},{key:"deleteConversation",value:function(e){return this._getModule(Vn).deleteConversation(e)}},{key:"clearHistoryMessage",value:function(e){return this._getModule(Vn).clearHistoryMessage(e)}},{key:"pinConversation",value:function(e){return this._getModule(Vn).pinConversation(e)}},{key:"setAllMessageRead",value:function(e){return this._getModule(Vn).setAllMessageRead(e)}},{key:"setMessageRemindType",value:function(e){return this._getModule(Vn).setMessageRemindType(e)}},{key:"getTotalUnreadMessageCount",value:function(){return this._getModule(Vn).getTotalUnreadMessageCount()}},{key:"setConversationCustomData",value:function(e){return this._getModule(Vn).setConversationCustomData(e)}},{key:"markConversation",value:function(e){return this._getModule(Vn).markConversation(e)}},{key:"getConversationGroupList",value:function(){return this._getModule(Vn).getConversationGroupList()}},{key:"createConversationGroup",value:function(e){return this._getModule(Vn).createConversationGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._getModule(Vn).deleteConversationGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._getModule(Vn).renameConversationGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._getModule(Vn).addConversationsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._getModule(Vn).deleteConversationsFromGroup(e)}},{key:"getMyProfile",value:function(){return this._getModule(Nn).getMyProfile()}},{key:"getUserProfile",value:function(e){return this._getModule(Nn).getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._getModule(Nn).updateMyProfile(e)}},{key:"getBlacklist",value:function(){return this._getModule(Nn).getLocalBlacklist()}},{key:"addToBlacklist",value:function(e){return this._getModule(Nn).addBlacklist(e)}},{key:"removeFromBlacklist",value:function(e){return this._getModule(Nn).deleteBlacklist(e)}},{key:"setSelfStatus",value:function(e){return this._getModule(Nn).setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._getModule(Nn).getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._getModule(Nn).subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._getModule(Nn).unsubscribeUserStatus(e)}},{key:"getFriendList",value:function(){var e=this._getModule(xn);return e?e.getLocalFriendList():Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"addFriend",value:function(e){var t=this._getModule(xn);return t?t.addFriend(e):Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"deleteFriend",value:function(e){var t=this._getModule(xn);return t?t.deleteFriend(e):Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"checkFriend",value:function(e){var t=this._getModule(xn);return t?t.checkFriend(e):Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"getFriendProfile",value:function(e){var t=this._getModule(xn);return t?t.getFriendProfile(e):Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"updateFriend",value:function(e){var t=this._getModule(xn);return t?t.updateFriend(e):Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"getFriendApplicationList",value:function(){var e=this._getModule(xn);return e?e.getLocalFriendApplicationList():Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"acceptFriendApplication",value:function(e){var t=this._getModule(xn);return t?t.acceptFriendApplication(e):Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"refuseFriendApplication",value:function(e){var t=this._getModule(xn);return t?t.refuseFriendApplication(e):Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"deleteFriendApplication",value:function(e){var t=this._getModule(xn);return t?t.deleteFriendApplication(e):Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"setFriendApplicationRead",value:function(){var e=this._getModule(xn);return e?e.setFriendApplicationRead():Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"getFriendGroupList",value:function(){var e=this._getModule(xn);return e?e.getLocalFriendGroupList():Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"createFriendGroup",value:function(e){var t=this._getModule(xn);return t?t.createFriendGroup(e):Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"deleteFriendGroup",value:function(e){var t=this._getModule(xn);return t?t.deleteFriendGroup(e):Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"addToFriendGroup",value:function(e){var t=this._getModule(xn);return t?t.addToFriendGroup(e):Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"removeFromFriendGroup",value:function(e){var t=this._getModule(xn);return t?t.removeFromFriendGroup(e):Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"renameFriendGroup",value:function(e){var t=this._getModule(xn);return t?t.renameFriendGroup(e):Xo({code:fo.CANNOT_FIND_MODULE})}},{key:"getGroupList",value:function(e){return this._getModule(Un).getGroupList(e)}},{key:"getGroupProfile",value:function(e){return this._getModule(Un).getGroupProfile(e)}},{key:"createGroup",value:function(e){return this._getModule(Un).createGroup(e)}},{key:"dismissGroup",value:function(e){return this._getModule(Un).dismissGroup(e)}},{key:"updateGroupProfile",value:function(e){return this._getModule(Un).updateGroupProfile(e)}},{key:"joinGroup",value:function(e){return this._getModule(Un).joinGroup(e)}},{key:"quitGroup",value:function(e){return this._getModule(Un).quitGroup(e)}},{key:"searchGroupByID",value:function(e){return this._getModule(Un).searchGroupByID(e)}},{key:"getGroupOnlineMemberCount",value:function(e){return this._getModule(Un).getGroupOnlineMemberCount(e)}},{key:"changeGroupOwner",value:function(e){return this._getModule(Un).changeGroupOwner(e)}},{key:"getGroupApplicationList",value:function(){return this._getModule(Un).getGroupApplicationList()}},{key:"handleGroupApplication",value:function(e){return this._getModule(Un).handleGroupApplication(e)}},{key:"initGroupAttributes",value:function(e){return this._getModule(Un).initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._getModule(Un).setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._getModule(Un).deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._getModule(Un).getGroupAttributes(e)}},{key:"setGroupCounters",value:function(e){return this._getModule(Un).setGroupCounters(e)}},{key:"increaseGroupCounter",value:function(e){return this._getModule(Un).increaseGroupCounter(e)}},{key:"decreaseGroupCounter",value:function(e){return this._getModule(Un).decreaseGroupCounter(e)}},{key:"getGroupCounters",value:function(e){return this._getModule(Un).getGroupCounters(e)}},{key:"getGroupMemberList",value:function(e){return this._getModule(Gn).getGroupMemberList(e)}},{key:"getGroupMemberProfile",value:function(e){return this._getModule(Gn).getGroupMemberProfile(e)}},{key:"addGroupMember",value:function(e){return this._getModule(Gn).addGroupMember(e)}},{key:"deleteGroupMember",value:function(e){return this._getModule(Gn).deleteGroupMember(e)}},{key:"setGroupMemberMuteTime",value:function(e){return this._getModule(Gn).setGroupMemberMuteTime(e)}},{key:"setGroupMemberRole",value:function(e){return this._getModule(Gn).setGroupMemberRole(e)}},{key:"setGroupMemberNameCard",value:function(e){return this._getModule(Gn).setGroupMemberNameCard(e)}},{key:"setGroupMemberCustomField",value:function(e){return this._getModule(Gn).setGroupMemberCustomField(e)}},{key:"markGroupMemberList",value:function(e){return this._getModule(Gn).markGroupMemberList(e)}},{key:"getJoinedCommunityList",value:function(){return this._getModule(Fn).getJoinedCommunityList()}},{key:"createTopicInCommunity",value:function(e){return this._getModule(Fn).createTopicInCommunity(e)}},{key:"deleteTopicFromCommunity",value:function(e){return this._getModule(Fn).deleteTopicFromCommunity(e)}},{key:"updateTopicProfile",value:function(e){return this._getModule(Fn).updateTopicProfile(e)}},{key:"getTopicList",value:function(e){return this._getModule(Fn).getTopicList(e)}}]),e}(),hc={login:1,logout:1,destroy:1,on:1,off:1,ready:1,setLogLevel:1,joinGroup:1,quitGroup:1,registerPlugin:1,getGroupOnlineMemberCount:1};function fc(e,t){if(e.isReady()||1===hc[t])return!0;var n=e.getNotReadyReason(),i={code:n,message:"".concat(e.getErrorMessage(n)," | ").concat(t," | ").concat(e.getErrorMessage(fo.SDK_IS_NOT_READY))};return e.onError(i),i}var gc={},mc={create:function(e){var n=0,i=e.SDKAppID;if(nt(i))n=i;else if(n=parseInt(i),isNaN(i))return Be.e("".concat("TIM.create"," failed. Failed to parse the SDKAppID, please check the arguments")),null;if(n&&gc[n])return gc[n];Be.l("".concat("TIM.create"));var r=new pc(t(t({},e),{},{SDKAppID:n}));r.on(k.SDK_DESTROY,(function(e){gc[e.data.SDKAppID]=null,delete gc[e.data.SDKAppID]}));var o,a,s=(o=r,a=Object.create(null),Object.keys(An).forEach((function(e){if(o[e]){var t=new D;a[e]=function(){var n=Array.from(arguments);return t.use((function(t,n){var i=fc(o,e);return!0===i?n():Xo(i)})).use((function(t,n){if(!0===Jt(t,wn[e],e))return n()})).use((function(t,n){return o[e].apply(o,t)})),t.run(n)}}})),a);return gc[n]=s,wn.hookGetAPITips(r.getErrorMessage.bind(r)),Be.l("".concat("TIM.create"," ok")),s}};return mc.TYPES=b,mc.EVENT=k,mc.VERSION="2.27.1",Be.l("TIM.VERSION:".concat(mc.VERSION)),mc}()),ou}const cu=Z(su()),uu=S({components:{},props:{list:{type:Array,default:()=>[]},total:{type:Number,default:()=>0},isShowDel:{type:Boolean,default:()=>!1},self:{type:Object,default:()=>({})}},setup(e,t){const n=cu.TYPES,i=E({total:0,list:[],isShowDel:!1,self:{}});k((()=>{i.total=e.total,i.isShowDel=e.isShowDel,i.list=e.list,i.self=e.self}));return{...b(i),getMore:()=>{t.emit("more")},submit:e=>{t.emit("del",[e])},handleRoleName:e=>{const{t:t}=window.TUIKitTUICore.config.i18n.useI18n();let r="";switch(null==e?void 0:e.role){case n.GRP_MBR_ROLE_ADMIN:r=t("TUIChat.manage.管理员");break;case n.GRP_MBR_ROLE_OWNER:r=t("TUIChat.manage.群主")}return r&&(r=`(${r})`),e.userID===i.self.userID&&(r+=` (${t("TUIChat.manage.我")})`),r},handleMemberProfileShow:e=>{t.emit("handleMemberProfileShow",e)}}}}),lu={class:"member"},du={class:"list"},pu=["onClick"],hu=["src"],fu={class:"name"},gu=["onClick"];const mu=D(uu,[["render",function(e,t,n,i,r,o){return w(),A("main",lu,[P("ul",du,[(w(!0),A(_,null,R(e.list,((t,n)=>(w(),A("li",{class:"list-item",key:n},[P("aside",{onClick:n=>e.handleMemberProfileShow(t)},[P("img",{class:"avatar",src:(null==t?void 0:t.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,hu),P("span",fu,L((null==t?void 0:t.nick)||(null==t?void 0:t.userID)),1),P("span",null,L(e.handleRoleName(t)),1)],8,pu),"Owner"!==t.role&&e.isShowDel?(w(),A("i",{key:0,class:"icon icon-del",onClick:n=>e.submit(t)},null,8,gu)):O("",!0)])))),128)),e.list.length<e.total?(w(),A("li",{key:0,class:"list-item",onClick:t[0]||(t[0]=(...t)=>e.getMore&&e.getMore(...t))},L(e.$t("TUIChat.manage.查看更多")),1)):O("",!0)])])}],["__scopeId","data-v-fcdcebe7"]]),vu=S({props:{userInfo:{type:Object,default:()=>({})}},setup(e,t){const n=null==nl?void 0:nl.TUIServer,i=E({isFriendShip:!1,userInfo:{},self:{}});k((()=>{i.self=e.self})),v((()=>e.userInfo),(async(t,o)=>{var a;if(t===o)return;const s=await n.getUserProfile([null==(a=null==e?void 0:e.userInfo)?void 0:a.userID]);i.userInfo=null==s?void 0:s.data[0],r()}),{deep:!0,immediate:!0});const r=async()=>{if(!i.userInfo.userID)return;const e=await n.checkFriend(i.userInfo.userID,Qi.TYPES.SNS_CHECK_TYPE_BOTH);i.isFriendShip=e===Qi.TYPES.SNS_TYPE_BOTH_WAY};return{...b(i),enter:async(e,t)=>{const i=`${t}${e}`;n.TUICore.TUIServer.TUIConversation.getConversationProfile(i).then((e=>{n.TUICore.TUIServer.TUIConversation.handleCurrentConversation(e.data.conversation)}))},showEnter:()=>{var e;return i.isFriendShip||!(null==(e=null==n?void 0:n.TUICore)?void 0:e.isOfficial)}}}}),_u={class:"memeber-profile"},yu={class:"memeber-profile-main"},Iu=["src"],Mu={class:"list"},Tu=(e=>(F("data-v-29b72058"),e=e(),V(),e))((()=>P("label",null,"ID：",-1))),Cu={class:"memeber-profile-footer"};const Su=D(vu,[["render",function(e,t,n,i,r,o){var a,s,c,u,l;return w(),A("div",_u,[P("div",yu,[P("img",{class:"avatar",src:(null==(a=e.userInfo)?void 0:a.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,Iu),P("ul",Mu,[P("h1",null,L((null==(s=e.userInfo)?void 0:s.nick)||(null==(c=e.userInfo)?void 0:c.userID)),1),P("li",null,[Tu,P("span",null,L(null==(u=e.userInfo)?void 0:u.userID),1)]),P("li",null,[P("label",null,L(e.$t("TUIContact.个性签名"))+"：",1),P("span",null,L(null==(l=e.userInfo)?void 0:l.selfSignature),1)])])]),P("div",Cu,[e.showEnter()?(w(),A("div",{key:0,class:"button",onClick:t[0]||(t[0]=t=>{var n;return e.enter(null==(n=e.userInfo)?void 0:n.userID,"C2C")})},L(e.$t("TUIContact.发送消息")),1)):O("",!0)])])}],["__scopeId","data-v-29b72058"]]),Eu=S({props:{show:{type:Boolean,default:()=>!1},isHeaderShow:{type:Boolean,default:()=>!0},isFooterShow:{type:Boolean,default:()=>!0},background:{type:Boolean,default:()=>!0},title:{type:String,default:()=>""},isH5:{type:Boolean,default:()=>!1},center:{type:Boolean,default:()=>!1}},setup(e,t){const n=E({show:!1,isHeaderShow:!0,isFooterShow:!0,background:!0,title:""});k((()=>{n.show=e.show,n.title=e.title,n.isHeaderShow=e.isHeaderShow,n.isFooterShow=e.isFooterShow,n.background=e.background}));const i=()=>{n.show=!n.show,t.emit("update:show",n.show)};return{...b(n),toggleView:i,submit:()=>{t.emit("submit"),i()}}}}),ku={key:0},bu={class:"dialog-main-content"},Du={key:1};const wu=D(Eu,[["render",function(e,t,n,i,r,o){return e.show?(w(),A("div",{key:0,class:G(["dialog",[e.isH5?"dialog-h5":"",e.center?"center":""]]),onClick:t[3]||(t[3]=x(((...t)=>e.toggleView&&e.toggleView(...t)),["self"]))},[P("main",{class:"dialog-main",style:U(!e.background&&{background:"none"})},[e.isHeaderShow?(w(),A("header",ku,[P("h1",null,L(e.title),1),P("i",{class:"icon icon-close",onClick:t[0]||(t[0]=(...t)=>e.toggleView&&e.toggleView(...t))})])):O("",!0),P("div",bu,[X(e.$slots,"default",{},void 0,!0)]),e.isFooterShow?(w(),A("footer",Du,[P("button",{class:"btn btn-cancel",onClick:t[1]||(t[1]=(...t)=>e.toggleView&&e.toggleView(...t))},L(e.$t("component.取消")),1),P("button",{class:"btn btn-default",onClick:t[2]||(t[2]=(...t)=>e.submit&&e.submit(...t))},L(e.$t("component.确定")),1)])):O("",!0)],4)],2)):O("",!0)}],["__scopeId","data-v-873bcccd"]]),Au=S({components:{Mask:mc,Transfer:xc,Slider:Vc,ManageName:Jc,ManageNotification:iu,ManageMember:mu,MemeberProfile:Su,Dialog:wu},props:{userInfo:{type:Object,default:()=>({isGroup:!1,list:[]})},conversation:{type:Object,default:()=>({})},show:{type:Boolean,default:()=>!1},isH5:{type:Boolean,default:()=>!1}},setup(e,t){var n;const i=Au.TUIServer.TUICore.TIM.TYPES,{GroupServer:r}=Au,{t:o}=Au.TUIServer.TUICore.config.i18n.useI18n(),a=E({conversation:{},userInfo:{isGroup:!1,list:[]},isShowMuteTimeInput:!1,editLableName:"",mask:!1,currentTab:"",transferType:"",isSearch:!1,isRadio:!1,transferList:[],selectedList:[],isMuteTime:!1,show:!1,typeName:{[i.GRP_WORK]:"好友工作群",[i.GRP_PUBLIC]:"陌生人社交群",[i.GRP_MEETING]:"临时会议群",[i.GRP_AVCHATROOM]:"直播群",[i.JOIN_OPTIONS_FREE_ACCESS]:"自由加入",[i.JOIN_OPTIONS_NEED_PERMISSION]:"需要验证",[i.JOIN_OPTIONS_DISABLE_APPLY]:"禁止加群"},delDialogShow:!1,userList:[],transferTitle:"",member:{admin:[],member:[],muteMember:[]},currentMember:{}}),s=f();k((()=>{a.conversation=e.conversation,a.userInfo=e.userInfo,a.show=e.show}));const c=(null==(n=null==window?void 0:window.TUIKitTUICore)?void 0:n.isOfficial)&&(null==ca?void 0:ca.useStore())||{},u=g((()=>{let e="";switch(a.currentTab){case"notification":e="群公告";break;case"member":case"profile":e="群成员";break;default:e="群管理"}return e}));v((()=>a.userInfo.list),((e,t)=>{a.member={admin:[],member:[],muteMember:[]},e.map((e=>{switch(null==e?void 0:e.role){case i.GRP_MBR_ROLE_ADMIN:a.member.admin.push(e);break;case i.GRP_MBR_ROLE_MEMBER:a.member.member.push(e)}return e}));const n=(new Date).getTime();a.member.muteMember=e.filter((e=>1e3*(null==e?void 0:e.muteUntil)-n>0))}),{deep:!0});const l=g((()=>{var e,t;const{conversation:n}=a,r=null==(e=null==n?void 0:n.groupProfile)?void 0:e.selfInfo.role,o=null==(t=null==n?void 0:n.groupProfile)?void 0:t.type,s=r===i.GRP_MBR_ROLE_OWNER,c=o===i.GRP_WORK;return s&&!c})),d=g((()=>{var e;const{conversation:t}=a;return!((null==(e=null==t?void 0:t.groupProfile)?void 0:e.type)!==i.GRP_WORK)})),p=g((()=>{let e=3;return d.value||(e+=1),"Owner"!==a.conversation.groupProfile.selfInfo.role&&(e+=1),e})),h=g((()=>{var e;const{conversation:t}=a,n=null==(e=null==t?void 0:t.groupProfile)?void 0:e.selfInfo.role,r=n===i.GRP_MBR_ROLE_OWNER,o=n===i.GRP_MBR_ROLE_ADMIN;return r||o})),m=g((()=>{var e,t;const{conversation:n}=a,r=null==(e=null==n?void 0:n.groupProfile)?void 0:e.type,o=(null==(t=null==n?void 0:n.groupProfile)?void 0:t.selfInfo.role)===i.GRP_MBR_ROLE_OWNER,s=r===i.GRP_WORK,c=r===i.GRP_AVCHATROOM;return!(s||c||!o)})),_=g((()=>{var e;const{conversation:t}=a;return!((null==(e=null==t?void 0:t.groupProfile)?void 0:e.type)===i.GRP_WORK||!h.value)})),y=e=>{var t;const{conversation:n}=a,i={groupID:null==(t=null==n?void 0:n.groupProfile)?void 0:t.groupID,count:100,offset:e&&"more"===e?a.userInfo.list.length:0};r.getGroupMemberList(i).then((t=>{a.userInfo.list=e&&"more"===e?[...a.userInfo.list,...t.data.memberList]:t.data.memberList}))},I=async e=>{const{conversation:t}=a,n={groupID:t.groupProfile.groupID,userIDList:e};await r.addGroupMember(n),y("More")},M=async e=>{const t={groupID:a.conversation.groupProfile.groupID,newOwnerID:e},n=await r.changeGroupOwner(t);a.conversation.groupProfile={},a.conversation.groupProfile=n.data.group},T=async e=>{const{conversation:t}=a;let n="";switch(e.role){case i.GRP_MBR_ROLE_ADMIN:n=i.GRP_MBR_ROLE_MEMBER;break;case i.GRP_MBR_ROLE_MEMBER:n=i.GRP_MBR_ROLE_ADMIN}const o={groupID:t.groupProfile.groupID,userID:e.userID,role:n};await r.setGroupMemberRole(o),y()},C=async(e,t)=>{var n;const{conversation:i}=a,o={groupID:i.groupProfile.groupID,userID:e,muteTime:"add"===t?2592e3:0};await r.setGroupMemberMuteTime(o),"add"===t&&(null==(n=null==window?void 0:window.TUIKitTUICore)?void 0:n.isOfficial)&&(null==c?void 0:c.commit)&&(null==c||c.commit("handleTask",4)),y()},S=async e=>{const{conversation:t}=a,n={groupID:t.groupProfile.groupID,userIDList:e,reason:""};await r.deleteGroupMember(n),y()},D=async e=>{const{key:t,value:n}=e,i={groupID:a.conversation.groupProfile.groupID,[t]:n},o=await r.updateGroupProfile(i),{conversation:s}=Au.TUIServer.store;s.groupProfile=o.data.group,Au.TUIServer.store.conversation={},Au.TUIServer.store.conversation=s,a.editLableName=""},w=e=>{a.currentTab=e,a.editLableName="","member"===a.currentTab&&(a.transferType="remove"),a.currentTab||(a.transferType="")},A=async e=>{switch(a.selectedList=[],e){case"add":a.isRadio=!1,a.transferList=await(async()=>(await Au.TUIServer.getFriendList()).data.map((e=>null==e?void 0:e.profile)).filter((e=>!a.userInfo.list.some((t=>t.userID===e.userID)))))(),a.transferTitle="添加成员";break;case"remove":a.isRadio=!1,a.transferList=a.userInfo.list.filter((e=>{var t,n;return e.userID!==(null==(n=null==(t=a.conversation)?void 0:t.groupProfile)?void 0:n.selfInfo.userID)})),a.transferTitle="删除成员";break;case"addAdmin":a.isRadio=!0,a.transferList=a.member.member,a.transferTitle="新增管理员";break;case"removeAdmin":a.isRadio=!0,a.transferList=a.member.admin,a.transferTitle="移除管理员";break;case"changeOwner":a.isRadio=!0,a.transferList=[...a.member.admin,...a.member.member],a.transferTitle="转让群组";break;case"addMute":a.isRadio=!0,a.transferList=a.member.member,"Owner"===a.conversation.groupProfile.selfInfo.role&&(a.transferList=[...a.member.admin,...a.member.member]),a.transferTitle="新增禁言用户";break;case"removeMute":a.isRadio=!0,a.transferList=a.member.muteMember,a.transferTitle="移除禁言用户"}a.transferType=e,a.mask=!a.mask};Pa(s,(()=>{a.show=!1}));const R=(e,t)=>{const n=[];switch(e.map((e=>(n.push(e.userID),e))),Mo.getInstance().reportEvent({name:"groupOptions",ext1:"groupOptions"}),t){case"add":I(n),Mo.getInstance().reportEvent({name:"groupOptions",ext1:"groupAddMember"});break;case"remove":S(n),Mo.getInstance().reportEvent({name:"groupOptions",ext1:"groupRemoveMember"});break;case"addAdmin":T(e[0]),Mo.getInstance().reportEvent({name:"groupOptions",ext1:"groupAddAdmin"});break;case"removeAdmin":T(e[0]),Mo.getInstance().reportEvent({name:"groupOptions",ext1:"groupRemoveAdmin"});break;case"changeOwner":M(n[0]),Mo.getInstance().reportEvent({name:"groupOptions",ext1:"groupChangeOwner"});break;case"addMute":C(n[0],"add"),Mo.getInstance().reportEvent({name:"groupOptions",ext1:"groupAddMute"});break;case"removeMute":C(n[0],"remove"),Mo.getInstance().reportEvent({name:"groupOptions",ext1:"groupRemoveMute"})}};return{...b(a),isDismissGroupAuth:l,isShowAddMember:d,isSetMuteTime:_,isAdmin:m,isAuth:h,addMember:I,deleteMember:e=>{const{conversation:t}=a,n={groupID:t.groupProfile.groupID,userIDList:[e.userID]};r.deleteGroupMember(n)},changeOwner:M,quit:async e=>{await r.quitGroup(e.groupID),Au.TUIServer.store.conversation={}},dismiss:async e=>{var t;await r.dismissGroup(e.groupID),Au.TUIServer.store.conversation={},(null==(t=null==window?void 0:window.TUIKitTUICore)?void 0:t.isOfficial)&&(null==c?void 0:c.commit)&&(null==c||c.commit("handleTask",5))},handleAdmin:T,setMemberMuteTime:C,kickedOut:S,edit:e=>{a.editLableName=e},updateProfile:D,setTab:w,TabName:u,getMember:y,handleSearchMember:async t=>{var n,i;let s={},c={};const u={groupID:a.conversation.groupProfile.groupID,userIDList:[t]};switch(a.transferType){case"add":try{c=await r.getGroupMemberProfile(u),a.transferList=a.transferList.filter((e=>{var t;return e.userID!==(null==(t=s.data[0])?void 0:t.userID)})),a.transferList=[...a.transferList,...s.data],(null==(n=null==c?void 0:c.data)?void 0:n.memberList.length)>0&&(a.transferList=a.transferList.map((e=>{var t;return e.userID===(null==(t=null==c?void 0:c.data)?void 0:t.memberList[0].userID)&&(e.isDisabled=!0),e})))}catch(l){ns(o("TUIChat.manage.该用户不存在"),e)}break;case"remove":try{if(s=await r.getGroupMemberProfile(u),0===s.data.memberList.length){return ns(o("TUIChat.manage.该用户不在群组内"),e)}a.transferList=a.transferList.filter((e=>{var t,n;return e.userID!==(null==(n=null==(t=null==s?void 0:s.data)?void 0:t.memberList[0])?void 0:n.userID)})),a.transferList=[...a.transferList,...null==(i=null==s?void 0:s.data)?void 0:i.memberList]}catch(l){ns(o("TUIChat.manage.该用户不存在"),e)}}},submit:e=>{"remove"===a.transferType?(a.userList=e,a.delDialogShow=!a.delDialogShow):R(e,a.transferType),a.mask=!1},cancel:()=>{A()},toggleMask:A,toggleShow:()=>{if(!r){return ns(o("TUIChat.manage.请先注册 TUIGroup 模块"),e)}a.show=!a.show,a.show||(a.currentTab=""),a.show&&(y(),Mo.getInstance().reportEvent({name:"showGroupManage",ext1:"showGroupManage"}))},setAllMuteTime:e=>{var t;D({key:"muteAllMembers",value:e}),(null==(t=null==window?void 0:window.TUIKitTUICore)?void 0:t.isOfficial)&&(null==c?void 0:c.commit)&&(null==c||c.commit("handleTask",4))},handleManage:R,showUserNum:p,dialog:s,handleGroupIDCopy:async()=>{var e,t;try{const{toClipboard:n}=nc();await n(null==(t=null==(e=null==a?void 0:a.conversation)?void 0:e.groupProfile)?void 0:t.groupID)}catch(n){ns(n,a.env)}},handleMemberProfileShow:e=>{a.currentMember=e,w("profile")}}}}),Ru=Au,Lu=e=>(F("data-v-079a033c"),e=e(),V(),e),Ou={class:"manage-header"},Nu={class:"manage-header-left"},Pu={key:0,class:"main"},Uu={class:"userInfo space-top"},xu=Lu((()=>P("i",{class:"icon icon-right"},null,-1))),Gu=["onClick"],Fu=["src"],Vu={key:0},qu={key:1},Bu=Lu((()=>P("i",{class:"icon icon-right end"},null,-1))),Hu=Lu((()=>P("i",{class:"icon icon-right"},null,-1))),ju={class:"groupID"},Ku=["title"],zu=["src"],Wu={class:"footer space-top"},Yu={key:4,class:"admin"},$u={key:0,class:"admin-list"},Ju=["src"],Xu={key:1,class:"admin-content space-top"},Zu={key:2,class:"admin-list last"},Qu=["src"],el={key:0,class:"delDialog-title"},tl={key:1,class:"delDialog-title"};const nl=D(Ru,[["render",function(e,t,n,i,r,o){var a,s,c,u,l;const d=J("ManageName"),p=J("ManageMember"),h=J("MemeberProfile"),f=J("ManageNotification"),g=J("Slider"),m=J("Transfer"),v=J("Mask"),y=J("Dialog");return w(),A("div",null,[P("i",{class:"icon icon-chat-setting",onClick:t[0]||(t[0]=(...t)=>e.toggleShow&&e.toggleShow(...t))}),e.show?(w(),A("div",{key:0,class:G(["manage",[e.isH5?"manage-h5":""]]),ref:"dialog"},[P("header",Ou,[e.isH5&&!e.currentTab?(w(),A("i",{key:0,class:"icon icon-back",onClick:t[1]||(t[1]=(...t)=>e.toggleShow&&e.toggleShow(...t))})):O("",!0),P("aside",Nu,[e.currentTab?(w(),A("i",{key:0,class:"icon icon-back",onClick:t[2]||(t[2]=t=>e.setTab(""))})):O("",!0),P("main",null,[P("h1",null,L(e.$t(`TUIChat.manage.${e.TabName}`)),1)])]),P("span",null,[e.isH5?O("",!0):(w(),A("i",{key:0,class:"icon icon-close",onClick:t[3]||(t[3]=(...t)=>e.toggleShow&&e.toggleShow(...t))}))])]),e.currentTab?"member"===e.currentTab?(w(),j(p,{key:1,self:e.conversation.groupProfile.selfInfo,list:e.userInfo.list,total:~~e.conversation.groupProfile.memberCount,isShowDel:"Owner"===e.conversation.groupProfile.selfInfo.role,onMore:t[14]||(t[14]=t=>e.getMember("more")),onDel:e.submit,onHandleMemberProfileShow:e.handleMemberProfileShow},null,8,["self","list","total","isShowDel","onDel","onHandleMemberProfileShow"])):"profile"===e.currentTab?(w(),j(h,{key:2,userInfo:e.currentMember},null,8,["userInfo"])):"notification"===e.currentTab?(w(),j(f,{key:3,isAuth:e.isAuth,data:e.conversation.groupProfile,onUpdate:e.updateProfile},null,8,["isAuth","data","onUpdate"])):"admin"===e.currentTab?(w(),A("main",Yu,[e.isAdmin?(w(),A("div",$u,[P("label",null,L(e.$t("TUIChat.manage.群管理员")),1),P("ol",null,[(w(!0),A(_,null,R(e.member.admin,((e,t)=>(w(),A("dl",{key:t},[P("dt",null,[P("img",{class:"avatar",src:(null==e?void 0:e.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,Ju)]),P("dd",null,L((null==e?void 0:e.nick)||(null==e?void 0:e.userID)),1)])))),128)),P("dl",null,[P("dt",{class:"avatar",onClick:t[15]||(t[15]=t=>e.toggleMask("addAdmin"))},"+")]),P("dl",null,[e.member.admin.length>0?(w(),A("dt",{key:0,class:"avatar",onClick:t[16]||(t[16]=t=>e.toggleMask("removeAdmin"))},"-")):O("",!0)])])])):O("",!0),e.isSetMuteTime?(w(),A("div",Xu,[P("aside",null,[P("label",null,L(e.$t("TUIChat.manage.全员禁言")),1),P("p",null,L(e.$t("TUIChat.manage.全员禁言开启后，只允许群主和管理员发言。")),1)]),M(g,{open:e.conversation.groupProfile.muteAllMembers,onChange:e.setAllMuteTime},null,8,["open","onChange"])])):O("",!0),e.isSetMuteTime?(w(),A("div",Zu,[P("label",null,L(e.$t("TUIChat.manage.单独禁言人员")),1),P("ol",null,[(w(!0),A(_,null,R(e.member.muteMember,((e,t)=>(w(),A("dl",{key:t},[P("dt",null,[P("img",{class:"avatar",src:(null==e?void 0:e.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,Qu)]),P("dd",null,L((null==e?void 0:e.nick)||(null==e?void 0:e.userID)),1)])))),128)),P("dl",null,[P("dt",{class:"avatar",onClick:t[17]||(t[17]=t=>e.toggleMask("addMute"))},"+")]),P("dl",null,[e.member.muteMember.length>0?(w(),A("dt",{key:0,class:"avatar",onClick:t[18]||(t[18]=t=>e.toggleMask("removeMute"))},"-")):O("",!0)])])])):O("",!0)])):O("",!0):(w(),A("main",Pu,[M(d,{class:"space-top",isAuth:e.isAuth,isH5:e.isH5,data:e.conversation.groupProfile,onUpdate:e.updateProfile},null,8,["isAuth","isH5","data","onUpdate"]),P("div",Uu,[P("header",{class:"userInfo-header",onClick:t[4]||(t[4]=t=>e.setTab("member"))},[P("label",null,L(e.$t("TUIChat.manage.群成员")),1),P("p",null,[P("span",null,L(e.conversation.groupProfile.memberCount)+L(e.$t("TUIChat.manage.人")),1),xu])]),P("ol",null,[(w(!0),A(_,null,R(null==(s=null==(a=e.userInfo)?void 0:a.list)?void 0:s.slice(0,e.showUserNum),((t,n)=>(w(),A("dl",{key:n},[P("dt",{onClick:n=>e.handleMemberProfileShow(t)},[P("img",{class:"avatar",src:(null==t?void 0:t.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,Fu)],8,Gu),P("dd",null,L((null==t?void 0:t.nick)||(null==t?void 0:t.userID)),1)])))),128)),e.isShowAddMember?(w(),A("dl",Vu,[P("dt",{class:"avatar",onClick:t[5]||(t[5]=t=>e.toggleMask("add"))},"+")])):O("",!0),"Owner"===e.conversation.groupProfile.selfInfo.role?(w(),A("dl",qu,[P("dt",{class:"avatar",onClick:t[6]||(t[6]=t=>e.toggleMask("remove"))},"-")])):O("",!0)])]),P("ul",{class:"content space-top",onClick:t[10]||(t[10]=t=>e.editLableName="")},[P("li",{onClick:t[7]||(t[7]=x((t=>e.setTab("notification")),["stop"]))},[P("aside",null,[P("label",null,L(e.$t("TUIChat.manage.群公告")),1),P("article",null,L(e.conversation.groupProfile.notification),1)]),Bu]),e.isAdmin&&e.isSetMuteTime?(w(),A("li",{key:0,onClick:t[8]||(t[8]=x((t=>e.setTab("admin")),["stop"]))},[P("label",null,L(e.$t("TUIChat.manage.群管理")),1),Hu])):O("",!0),P("li",null,[P("label",null,L(e.$t("TUIChat.manage.群ID")),1),P("div",ju,[P("span",null,L(e.conversation.groupProfile.groupID),1),P("i",{class:"icon icon-msg-copy",onClick:t[9]||(t[9]=(...t)=>e.handleGroupIDCopy&&e.handleGroupIDCopy(...t)),title:e.$t("TUIChat.复制")},null,8,Ku)])]),P("li",null,[P("label",null,L(e.$t("TUIChat.manage.群头像")),1),P("img",{class:"avatar",src:(null==(u=null==(c=e.conversation)?void 0:c.groupProfile)?void 0:u.avatar)||"https://web.sdk.qcloud.com/im/demo/TUIkit/web/img/constomer.svg",onerror:"this.src='https://web.sdk.qcloud.com/im/demo/TUIkit/web/img/constomer.svg'"},null,8,zu)]),P("li",null,[P("label",null,L(e.$t("TUIChat.manage.群类型")),1),P("span",null,L(e.$t(`TUIChat.manage.${e.typeName[e.conversation.groupProfile.type]}`)),1)]),P("li",null,[P("label",null,L(e.$t("TUIChat.manage.加群方式")),1),P("span",null,L(e.$t(`TUIChat.manage.${e.typeName[e.conversation.groupProfile.joinOption]}`)),1)])]),P("ul",Wu,["Owner"===e.conversation.groupProfile.selfInfo.role&&(null==(l=e.userInfo)?void 0:l.list.length)>1?(w(),A("li",{key:0,onClick:t[11]||(t[11]=x((t=>e.toggleMask("changeOwner")),["stop"]))},L(e.$t("TUIChat.manage.转让群组")),1)):O("",!0),e.isDismissGroupAuth?(w(),A("li",{key:1,onClick:t[12]||(t[12]=x((t=>e.dismiss(e.conversation.groupProfile)),["stop"]))},L(e.$t("TUIChat.manage.解散群聊")),1)):(w(),A("li",{key:2,onClick:t[13]||(t[13]=x((t=>e.quit(e.conversation.groupProfile)),["stop"]))},L(e.$t("TUIChat.manage.退出群组")),1))])])),M(v,{show:e.mask,"onUpdate:show":t[19]||(t[19]=t=>e.mask=t)},{default:K((()=>[M(m,{title:e.$t(`TUIChat.manage.${e.transferTitle}`),list:e.transferList,isSearch:e.isSearch,isRadio:e.isRadio,selectedList:e.selectedList,onSubmit:e.submit,onCancel:e.cancel,onSearch:e.handleSearchMember,isH5:e.isH5},null,8,["title","list","isSearch","isRadio","selectedList","onSubmit","onCancel","onSearch","isH5"])])),_:1},8,["show"]),M(y,{title:e.$t("TUIChat.manage.删除成员"),show:e.delDialogShow,isH5:e.isH5,center:!0,isHeaderShow:!e.isH5,onSubmit:t[20]||(t[20]=t=>e.handleManage(e.userList,"remove")),"onUpdate:show":t[21]||(t[21]=t=>e.delDialogShow=t)},{default:K((()=>[1===e.userList.length?(w(),A("p",el,L(e.$t("TUIChat.manage.确定从群聊中删除该成员？")),1)):O("",!0),e.userList.length>1?(w(),A("p",tl,L(e.$t("TUIChat.manage.确定从群聊中删除所选成员？")),1)):O("",!0)])),_:1},8,["title","show","isH5","isHeaderShow"])],2)):O("",!0)])}],["__scopeId","data-v-079a033c"]]),il={product:{label:"产品文档",url:"https://cloud.tencent.com/document/product/269/1499#.E7.BE.A4.E7.BB.84.E5.8A.9F.E8.83.BD"},customMessage:{label:"自定义消息",url:"https://web.sdk.qcloud.com/im/doc/zh-cn/SDK.html#createCustomMessage"},complaint:{label:"点此投诉",url:"https://cloud.tencent.com/apply/p/xc3oaubi98g"},implement:{label:"集成TUICallKit",url:"https://cloud.tencent.com/document/product/269/79861"},purchase:{label:"开通腾讯实时音视频服务",url:"https://cloud.tencent.com/document/product/1640/79968"}};function rl(e){this.content=e}function ol(e,t,n){for(let i=0;;i++){if(i==e.childCount||i==t.childCount)return e.childCount==t.childCount?null:n;let r=e.child(i),o=t.child(i);if(r!=o){if(!r.sameMarkup(o))return n;if(r.isText&&r.text!=o.text){for(let e=0;r.text[e]==o.text[e];e++)n++;return n}if(r.content.size||o.content.size){let e=ol(r.content,o.content,n+1);if(null!=e)return e}n+=r.nodeSize}else n+=r.nodeSize}}function al(e,t,n,i){for(let r=e.childCount,o=t.childCount;;){if(0==r||0==o)return r==o?null:{a:n,b:i};let a=e.child(--r),s=t.child(--o),c=a.nodeSize;if(a!=s){if(!a.sameMarkup(s))return{a:n,b:i};if(a.isText&&a.text!=s.text){let e=0,t=Math.min(a.text.length,s.text.length);for(;e<t&&a.text[a.text.length-e-1]==s.text[s.text.length-e-1];)e++,n--,i--;return{a:n,b:i}}if(a.content.size||s.content.size){let e=al(a.content,s.content,n-1,i-1);if(e)return e}n-=c,i-=c}else n-=c,i-=c}}rl.prototype={constructor:rl,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return-1==t?void 0:this.content[t+1]},update:function(e,t,n){var i=n&&n!=e?this.remove(n):this,r=i.find(e),o=i.content.slice();return-1==r?o.push(n||e,t):(o[r+1]=t,n&&(o[r]=n)),new rl(o)},remove:function(e){var t=this.find(e);if(-1==t)return this;var n=this.content.slice();return n.splice(t,2),new rl(n)},addToStart:function(e,t){return new rl([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var n=this.remove(e).content.slice();return n.push(e,t),new rl(n)},addBefore:function(e,t,n){var i=this.remove(t),r=i.content.slice(),o=i.find(e);return r.splice(-1==o?r.length:o,0,t,n),new rl(r)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){return(e=rl.from(e)).size?new rl(e.content.concat(this.subtract(e).content)):this},append:function(e){return(e=rl.from(e)).size?new rl(this.subtract(e).content.concat(e.content)):this},subtract:function(e){var t=this;e=rl.from(e);for(var n=0;n<e.content.length;n+=2)t=t.remove(e.content[n]);return t},toObject:function(){var e={};return this.forEach((function(t,n){e[t]=n})),e},get size(){return this.content.length>>1}},rl.from=function(e){if(e instanceof rl)return e;var t=[];if(e)for(var n in e)t.push(n,e[n]);return new rl(t)};class sl{constructor(e,t){if(this.content=e,this.size=t||0,null==t)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,i=0,r){for(let o=0,a=0;a<t;o++){let s=this.content[o],c=a+s.nodeSize;if(c>e&&!1!==n(s,i+a,r||null,o)&&s.content.size){let r=a+1;s.nodesBetween(Math.max(0,e-r),Math.min(s.content.size,t-r),n,i+r)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,i){let r="",o=!0;return this.nodesBetween(e,t,((a,s)=>{a.isText?(r+=a.text.slice(Math.max(e,s)-s,t-s),o=!n):a.isLeaf?(i?r+="function"==typeof i?i(a):i:a.type.spec.leafText&&(r+=a.type.spec.leafText(a)),o=!n):!o&&a.isBlock&&(r+=n,o=!0)}),0),r}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,i=this.content.slice(),r=0;for(t.isText&&t.sameMarkup(n)&&(i[i.length-1]=t.withText(t.text+n.text),r=1);r<e.content.length;r++)i.push(e.content[r]);return new sl(i,this.size+e.size)}cut(e,t=this.size){if(0==e&&t==this.size)return this;let n=[],i=0;if(t>e)for(let r=0,o=0;o<t;r++){let a=this.content[r],s=o+a.nodeSize;s>e&&((o<e||s>t)&&(a=a.isText?a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),n.push(a),i+=a.nodeSize),o=s}return new sl(n,i)}cutByIndex(e,t){return e==t?sl.empty:0==e&&t==this.content.length?this:new sl(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let i=this.content.slice(),r=this.size+t.nodeSize-n.nodeSize;return i[e]=t,new sl(i,r)}addToStart(e){return new sl([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new sl(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let i=this.content[t];e(i,n,t),n+=i.nodeSize}}findDiffStart(e,t=0){return ol(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return al(this,e,t,n)}findIndex(e,t=-1){if(0==e)return ul(0,e);if(e==this.size)return ul(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,i=0;;n++){let r=i+this.child(n).nodeSize;if(r>=e)return r==e||t>0?ul(n+1,r):ul(n,i);i=r}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((e=>e.toJSON())):null}static fromJSON(e,t){if(!t)return sl.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new sl(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return sl.empty;let t,n=0;for(let i=0;i<e.length;i++){let r=e[i];n+=r.nodeSize,i&&r.isText&&e[i-1].sameMarkup(r)?(t||(t=e.slice(0,i)),t[t.length-1]=r.withText(t[t.length-1].text+r.text)):t&&t.push(r)}return new sl(t||e,n)}static from(e){if(!e)return sl.empty;if(e instanceof sl)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new sl([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}sl.empty=new sl([],0);const cl={index:0,offset:0};function ul(e,t){return cl.index=e,cl.offset=t,cl}function ll(e,t){if(e===t)return!0;if(!e||"object"!=typeof e||!t||"object"!=typeof t)return!1;let n=Array.isArray(e);if(Array.isArray(t)!=n)return!1;if(n){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!ll(e[n],t[n]))return!1}else{for(let n in e)if(!(n in t)||!ll(e[n],t[n]))return!1;for(let n in t)if(!(n in e))return!1}return!0}let dl=class e{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let i=0;i<e.length;i++){let r=e[i];if(this.eq(r))return e;if(this.type.excludes(r.type))t||(t=e.slice(0,i));else{if(r.type.excludes(this.type))return e;!n&&r.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),n=!0),t&&t.push(r)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&ll(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);return n.create(t.attrs)}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&0==t.length)return e.none;if(t instanceof e)return[t];let n=t.slice();return n.sort(((e,t)=>e.type.rank-t.type.rank)),n}};dl.none=[];class pl extends Error{}class hl{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=gl(this.content,e+this.openStart,t);return n&&new hl(n,this.openStart,this.openEnd)}removeBetween(e,t){return new hl(fl(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return hl.empty;let n=t.openStart||0,i=t.openEnd||0;if("number"!=typeof n||"number"!=typeof i)throw new RangeError("Invalid input for Slice.fromJSON");return new hl(sl.fromJSON(e,t.content),n,i)}static maxOpen(e,t=!0){let n=0,i=0;for(let r=e.firstChild;r&&!r.isLeaf&&(t||!r.type.spec.isolating);r=r.firstChild)n++;for(let r=e.lastChild;r&&!r.isLeaf&&(t||!r.type.spec.isolating);r=r.lastChild)i++;return new hl(e,n,i)}}function fl(e,t,n){let{index:i,offset:r}=e.findIndex(t),o=e.maybeChild(i),{index:a,offset:s}=e.findIndex(n);if(r==t||o.isText){if(s!=n&&!e.child(a).isText)throw new RangeError("Removing non-flat range");return e.cut(0,t).append(e.cut(n))}if(i!=a)throw new RangeError("Removing non-flat range");return e.replaceChild(i,o.copy(fl(o.content,t-r-1,n-r-1)))}function gl(e,t,n,i){let{index:r,offset:o}=e.findIndex(t),a=e.maybeChild(r);if(o==t||a.isText)return i&&!i.canReplace(r,r,n)?null:e.cut(0,t).append(n).append(e.cut(t));let s=gl(a.content,t-o-1,n);return s&&e.replaceChild(r,a.copy(s))}function ml(e,t,n){if(n.openStart>e.depth)throw new pl("Inserted content deeper than insertion position");if(e.depth-n.openStart!=t.depth-n.openEnd)throw new pl("Inconsistent open depths");return vl(e,t,n,0)}function vl(e,t,n,i){let r=e.index(i),o=e.node(i);if(r==t.index(i)&&i<e.depth-n.openStart){let a=vl(e,t,n,i+1);return o.copy(o.content.replaceChild(r,a))}if(n.content.size){if(n.openStart||n.openEnd||e.depth!=i||t.depth!=i){let{start:r,end:a}=function(e,t){let n=t.depth-e.openStart,i=t.node(n).copy(e.content);for(let r=n-1;r>=0;r--)i=t.node(r).copy(sl.from(i));return{start:i.resolveNoCache(e.openStart+n),end:i.resolveNoCache(i.content.size-e.openEnd-n)}}(n,e);return Tl(o,Cl(e,r,a,t,i))}{let i=e.parent,r=i.content;return Tl(i,r.cut(0,e.parentOffset).append(n.content).append(r.cut(t.parentOffset)))}}return Tl(o,Sl(e,t,i))}function _l(e,t){if(!t.type.compatibleContent(e.type))throw new pl("Cannot join "+t.type.name+" onto "+e.type.name)}function yl(e,t,n){let i=e.node(n);return _l(i,t.node(n)),i}function Il(e,t){let n=t.length-1;n>=0&&e.isText&&e.sameMarkup(t[n])?t[n]=e.withText(t[n].text+e.text):t.push(e)}function Ml(e,t,n,i){let r=(t||e).node(n),o=0,a=t?t.index(n):r.childCount;e&&(o=e.index(n),e.depth>n?o++:e.textOffset&&(Il(e.nodeAfter,i),o++));for(let s=o;s<a;s++)Il(r.child(s),i);t&&t.depth==n&&t.textOffset&&Il(t.nodeBefore,i)}function Tl(e,t){return e.type.checkContent(t),e.copy(t)}function Cl(e,t,n,i,r){let o=e.depth>r&&yl(e,t,r+1),a=i.depth>r&&yl(n,i,r+1),s=[];return Ml(null,e,r,s),o&&a&&t.index(r)==n.index(r)?(_l(o,a),Il(Tl(o,Cl(e,t,n,i,r+1)),s)):(o&&Il(Tl(o,Sl(e,t,r+1)),s),Ml(t,n,r,s),a&&Il(Tl(a,Sl(n,i,r+1)),s)),Ml(i,null,r,s),new sl(s)}function Sl(e,t,n){let i=[];if(Ml(null,e,n,i),e.depth>n){Il(Tl(yl(e,t,n+1),Sl(e,t,n+1)),i)}return Ml(t,null,n,i),new sl(i)}hl.empty=new hl(sl.empty,0,0);class El{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return null==e?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[3*this.resolveDepth(e)]}index(e){return this.path[3*this.resolveDepth(e)+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e!=this.depth||this.textOffset?1:0)}start(e){return 0==(e=this.resolveDepth(e))?0:this.path[3*e-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(!(e=this.resolveDepth(e)))throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]}after(e){if(!(e=this.resolveDepth(e)))throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]+this.path[3*e].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(t);return n?e.child(t).cut(n):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):0==e?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[3*t],i=0==t?0:this.path[3*t-1]+1;for(let r=0;r<e;r++)i+=n.child(r).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(0==e.content.size)return dl.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),i=e.maybeChild(t);if(!n){let e=n;n=i,i=e}let r=n.marks;for(var o=0;o<r.length;o++)!1!==r[o].type.spec.inclusive||i&&r[o].isInSet(i.marks)||(r=r[o--].removeFromSet(r));return r}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,i=e.parent.maybeChild(e.index());for(var r=0;r<n.length;r++)!1!==n[r].type.spec.inclusive||i&&n[r].isInSet(i.marks)||(n=n[r--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new wl(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],i=0,r=t;for(let o=e;;){let{index:e,offset:t}=o.content.findIndex(r),a=r-t;if(n.push(o,e,i+t),!a)break;if(o=o.child(e),o.isText)break;r=a-1,i+=t+1}return new El(t,n,r)}static resolveCached(e,t){for(let i=0;i<kl.length;i++){let n=kl[i];if(n.pos==t&&n.doc==e)return n}let n=kl[bl]=El.resolve(e,t);return bl=(bl+1)%Dl,n}}let kl=[],bl=0,Dl=12;class wl{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Al=Object.create(null);let Rl=class e{constructor(e,t,n,i=dl.none){this.type=e,this.attrs=t,this.marks=i,this.content=n||sl.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,i=0){this.content.nodesBetween(e,t,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,i){return this.content.textBetween(e,t,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&ll(this.attrs,t||e.defaultAttrs||Al)&&dl.sameSet(this.marks,n||dl.none)}copy(t=null){return t==this.content?this:new e(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new e(this.type,this.attrs,this.content,t)}cut(e,t=this.content.size){return 0==e&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return hl.empty;let i=this.resolve(e),r=this.resolve(t),o=n?0:i.sharedDepth(t),a=i.start(o),s=i.node(o).content.cut(i.pos-a,r.pos-a);return new hl(s,i.depth-o,r.depth-o)}replace(e,t,n){return ml(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(0==e)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let i=this.content.child(t-1);return{node:i,index:t-1,offset:n-i.nodeSize}}resolve(e){return El.resolveCached(this,e)}resolveNoCache(e){return El.resolve(this,e)}rangeHasMark(e,t,n){let i=!1;return t>e&&this.nodesBetween(e,t,(e=>(n.isInSet(e.marks)&&(i=!0),!i))),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),Ol(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=sl.empty,i=0,r=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,i,r),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let s=i;s<r;s++)if(!this.type.allowsMarks(n.child(s).marks))return!1;return!0}canReplaceWith(e,t,n,i){if(i&&!this.type.allowsMarks(i))return!1;let r=this.contentMatchAt(e).matchType(n),o=r&&r.matchFragment(this.content,t);return!!o&&o.validEnd}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content);let e=dl.none;for(let t=0;t<this.marks.length;t++)e=this.marks[t].addToSet(e);if(!dl.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map((e=>e.type.name))}`);this.content.forEach((e=>e.check()))}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map((e=>e.toJSON()))),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n=null;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if("text"==t.type){if("string"!=typeof t.text)throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let i=sl.fromJSON(e,t.content);return e.nodeType(t.type).create(t.attrs,i,n)}};Rl.prototype.text=void 0;class Ll extends Rl{constructor(e,t,n,i){if(super(e,t,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Ol(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Ll(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Ll(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return 0==e&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function Ol(e,t){for(let n=e.length-1;n>=0;n--)t=e[n].type.name+"("+t+")";return t}class Nl{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new Pl(e,t);if(null==n.next)return Nl.empty;let i=Ul(n);n.next&&n.err("Unexpected trailing text");let r=function(e){let t=Object.create(null);return n(Bl(e,0));function n(i){let r=[];i.forEach((t=>{e[t].forEach((({term:t,to:n})=>{if(!t)return;let i;for(let e=0;e<r.length;e++)r[e][0]==t&&(i=r[e][1]);Bl(e,n).forEach((e=>{i||r.push([t,i=[]]),-1==i.indexOf(e)&&i.push(e)}))}))}));let o=t[i.join(",")]=new Nl(i.indexOf(e.length-1)>-1);for(let e=0;e<r.length;e++){let i=r[e][1].sort(ql);o.next.push({type:r[e][0],next:t[i.join(",")]||n(i)})}return o}}(function(e){let t=[[]];return r(o(e,0),n()),t;function n(){return t.push([])-1}function i(e,n,i){let r={term:i,to:n};return t[e].push(r),r}function r(e,t){e.forEach((e=>e.to=t))}function o(e,t){if("choice"==e.type)return e.exprs.reduce(((e,n)=>e.concat(o(n,t))),[]);if("seq"!=e.type){if("star"==e.type){let a=n();return i(t,a),r(o(e.expr,a),a),[i(a)]}if("plus"==e.type){let a=n();return r(o(e.expr,t),a),r(o(e.expr,a),a),[i(a)]}if("opt"==e.type)return[i(t)].concat(o(e.expr,t));if("range"==e.type){let a=t;for(let t=0;t<e.min;t++){let t=n();r(o(e.expr,a),t),a=t}if(-1==e.max)r(o(e.expr,a),a);else for(let t=e.min;t<e.max;t++){let t=n();i(a,t),r(o(e.expr,a),t),a=t}return[i(a)]}if("name"==e.type)return[i(t,void 0,e.value)];throw new Error("Unknown expr type")}for(let i=0;;i++){let a=o(e.exprs[i],t);if(i==e.exprs.length-1)return a;r(a,t=n())}}}(i));return function(e,t){for(let n=0,i=[e];n<i.length;n++){let e=i[n],r=!e.validEnd,o=[];for(let t=0;t<e.next.length;t++){let{type:n,next:a}=e.next[t];o.push(n.name),!r||n.isText||n.hasRequiredAttrs()||(r=!1),-1==i.indexOf(a)&&i.push(a)}r&&t.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(r,n),r}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let i=this;for(let r=t;i&&r<n;r++)i=i.matchType(e.child(r).type);return i}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!t.isText&&!t.hasRequiredAttrs())return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let i=[this];return function r(o,a){let s=o.matchFragment(e,n);if(s&&(!t||s.validEnd))return sl.from(a.map((e=>e.createAndFill())));for(let e=0;e<o.next.length;e++){let{type:t,next:n}=o.next[e];if(!t.isText&&!t.hasRequiredAttrs()&&-1==i.indexOf(n)){i.push(n);let e=r(n,a.concat(t));if(e)return e}}return null}(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),r=i.match;if(r.matchType(e)){let e=[];for(let t=i;t.type;t=t.via)e.push(t.type);return e.reverse()}for(let e=0;e<r.next.length;e++){let{type:o,next:a}=r.next[e];o.isLeaf||o.hasRequiredAttrs()||o.name in t||i.type&&!a.validEnd||(n.push({match:o.contentMatch,type:o,via:i}),t[o.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];return function t(n){e.push(n);for(let i=0;i<n.next.length;i++)-1==e.indexOf(n.next[i].next)&&t(n.next[i].next)}(this),e.map(((t,n)=>{let i=n+(t.validEnd?"*":" ")+" ";for(let r=0;r<t.next.length;r++)i+=(r?", ":"")+t.next[r].type.name+"->"+e.indexOf(t.next[r].next);return i})).join("\n")}}Nl.empty=new Nl(!0);class Pl{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function Ul(e){let t=[];do{t.push(xl(e))}while(e.eat("|"));return 1==t.length?t[0]:{type:"choice",exprs:t}}function xl(e){let t=[];do{t.push(Gl(e))}while(e.next&&")"!=e.next&&"|"!=e.next);return 1==t.length?t[0]:{type:"seq",exprs:t}}function Gl(e){let t=function(e){if(e.eat("(")){let t=Ul(e);return e.eat(")")||e.err("Missing closing paren"),t}if(!/\W/.test(e.next)){let t=function(e,t){let n=e.nodeTypes,i=n[t];if(i)return[i];let r=[];for(let o in n){let e=n[o];e.groups.indexOf(t)>-1&&r.push(e)}0==r.length&&e.err("No node type or group '"+t+"' found");return r}(e,e.next).map((t=>(null==e.inline?e.inline=t.isInline:e.inline!=t.isInline&&e.err("Mixing inline and block content"),{type:"name",value:t})));return e.pos++,1==t.length?t[0]:{type:"choice",exprs:t}}e.err("Unexpected token '"+e.next+"'")}(e);for(;;)if(e.eat("+"))t={type:"plus",expr:t};else if(e.eat("*"))t={type:"star",expr:t};else if(e.eat("?"))t={type:"opt",expr:t};else{if(!e.eat("{"))break;t=Vl(e,t)}return t}function Fl(e){/\D/.test(e.next)&&e.err("Expected number, got '"+e.next+"'");let t=Number(e.next);return e.pos++,t}function Vl(e,t){let n=Fl(e),i=n;return e.eat(",")&&(i="}"!=e.next?Fl(e):-1),e.eat("}")||e.err("Unclosed braced range"),{type:"range",min:n,max:i,expr:t}}function ql(e,t){return t-e}function Bl(e,t){let n=[];return function t(i){let r=e[i];if(1==r.length&&!r[0].term)return t(r[0].to);n.push(i);for(let e=0;e<r.length;e++){let{term:i,to:o}=r[e];i||-1!=n.indexOf(o)||t(o)}}(t),n.sort(ql)}function Hl(e){let t=Object.create(null);for(let n in e){let i=e[n];if(!i.hasDefault)return null;t[n]=i.default}return t}function jl(e,t){let n=Object.create(null);for(let i in e){let r=t&&t[i];if(void 0===r){let t=e[i];if(!t.hasDefault)throw new RangeError("No value supplied for attribute "+i);r=t.default}n[i]=r}return n}function Kl(e){let t=Object.create(null);if(e)for(let n in e)t[n]=new Wl(e[n]);return t}let zl=class e{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=Kl(n.attrs),this.defaultAttrs=Hl(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==e),this.isText="text"==e}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Nl.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:jl(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Rl(this,this.computeAttrs(e),sl.from(t),dl.setFrom(n))}createChecked(e=null,t,n){return t=sl.from(t),this.checkContent(t),new Rl(this,this.computeAttrs(e),t,dl.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),(t=sl.from(t)).size){let e=this.contentMatch.fillBefore(t);if(!e)return null;t=e.append(t)}let i=this.contentMatch.matchFragment(t),r=i&&i.fillBefore(sl.empty,!0);return r?new Rl(this,e,t.append(r),dl.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}allowsMarkType(e){return null==this.markSet||this.markSet.indexOf(e)>-1}allowsMarks(e){if(null==this.markSet)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(null==this.markSet)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:dl.none:e}static compile(t,n){let i=Object.create(null);t.forEach(((t,r)=>i[t]=new e(t,n,r)));let r=n.spec.topNode||"doc";if(!i[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!i.text)throw new RangeError("Every schema needs a 'text' type");for(let e in i.text.attrs)throw new RangeError("The text node type should not have attributes");return i}};class Wl{constructor(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default}get isRequired(){return!this.hasDefault}}class Yl{constructor(e,t,n,i){this.name=e,this.rank=t,this.schema=n,this.spec=i,this.attrs=Kl(i.attrs),this.excluded=null;let r=Hl(this.attrs);this.instance=r?new dl(this,r):null}create(e=null){return!e&&this.instance?this.instance:new dl(this,jl(this.attrs,e))}static compile(e,t){let n=Object.create(null),i=0;return e.forEach(((e,r)=>n[e]=new Yl(e,i++,t,r))),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}excludes(e){return this.excluded.indexOf(e)>-1}}class $l{constructor(e){this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=rl.from(e.nodes),t.marks=rl.from(e.marks||{}),this.nodes=zl.compile(this.spec.nodes,this),this.marks=Yl.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let e=this.nodes[i],t=e.spec.content||"",r=e.spec.marks;e.contentMatch=n[t]||(n[t]=Nl.parse(t,this.nodes)),e.inlineContent=e.contentMatch.inlineContent,e.markSet="_"==r?null:r?Jl(this,r.split(" ")):""!=r&&e.inlineContent?null:[]}for(let i in this.marks){let e=this.marks[i],t=e.spec.excludes;e.excluded=null==t?[e]:""==t?[]:Jl(this,t.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,i){if("string"==typeof e)e=this.nodeType(e);else{if(!(e instanceof zl))throw new RangeError("Invalid node type: "+e);if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}return e.createChecked(t,n,i)}text(e,t){let n=this.nodes.text;return new Ll(n,n.defaultAttrs,e,dl.setFrom(t))}mark(e,t){return"string"==typeof e&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return Rl.fromJSON(this,e)}markFromJSON(e){return dl.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function Jl(e,t){let n=[];for(let i=0;i<t.length;i++){let r=t[i],o=e.marks[r],a=o;if(o)n.push(o);else for(let t in e.marks){let i=e.marks[t];("_"==r||i.spec.group&&i.spec.group.split(" ").indexOf(r)>-1)&&n.push(a=i)}if(!a)throw new SyntaxError("Unknown mark type: '"+t[i]+"'")}return n}class Xl{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[],t.forEach((e=>{e.tag?this.tags.push(e):e.style&&this.styles.push(e)})),this.normalizeLists=!this.tags.some((t=>{if(!/^(ul|ol)\b/.test(t.tag)||!t.node)return!1;let n=e.nodes[t.node];return n.contentMatch.matchType(n)}))}parse(e,t={}){let n=new id(this,t,!1);return n.addAll(e,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new id(this,t,!0);return n.addAll(e,t.from,t.to),hl.maxOpen(n.finish())}matchTag(e,t,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let n=this.tags[i];if(rd(e,n.tag)&&(void 0===n.namespace||e.namespaceURI==n.namespace)&&(!n.context||t.matchesContext(n.context))){if(n.getAttrs){let t=n.getAttrs(e);if(!1===t)continue;n.attrs=t||void 0}return n}}}matchStyle(e,t,n,i){for(let r=i?this.styles.indexOf(i)+1:0;r<this.styles.length;r++){let i=this.styles[r],o=i.style;if(!(0!=o.indexOf(e)||i.context&&!n.matchesContext(i.context)||o.length>e.length&&(61!=o.charCodeAt(e.length)||o.slice(e.length+1)!=t))){if(i.getAttrs){let e=i.getAttrs(t);if(!1===e)continue;i.attrs=e||void 0}return i}}}static schemaRules(e){let t=[];function n(e){let n=null==e.priority?50:e.priority,i=0;for(;i<t.length;i++){let e=t[i];if((null==e.priority?50:e.priority)<n)break}t.splice(i,0,e)}for(let i in e.marks){let t=e.marks[i].spec.parseDOM;t&&t.forEach((e=>{n(e=od(e)),e.mark||e.ignore||e.clearMark||(e.mark=i)}))}for(let i in e.nodes){let t=e.nodes[i].spec.parseDOM;t&&t.forEach((e=>{n(e=od(e)),e.node||e.ignore||e.mark||(e.node=i)}))}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Xl(e,Xl.schemaRules(e)))}}const Zl={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Ql={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},ed={ol:!0,ul:!0};function td(e,t,n){return null!=t?(t?1:0)|("full"===t?2:0):e&&"pre"==e.whitespace?3:-5&n}class nd{constructor(e,t,n,i,r,o,a){this.type=e,this.attrs=t,this.marks=n,this.pendingMarks=i,this.solid=r,this.options=a,this.content=[],this.activeMarks=dl.none,this.stashMarks=[],this.match=o||(4&a?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(sl.from(e));if(!t){let t,n=this.type.contentMatch;return(t=n.findWrapping(e.type))?(this.match=n,t):null}this.match=this.type.contentMatch.matchFragment(t)}return this.match.findWrapping(e.type)}finish(e){if(!(1&this.options)){let e,t=this.content[this.content.length-1];if(t&&t.isText&&(e=/[ \t\r\n\u000c]+$/.exec(t.text))){let n=t;t.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length))}}let t=sl.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(sl.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}popFromStashMark(e){for(let t=this.stashMarks.length-1;t>=0;t--)if(e.eq(this.stashMarks[t]))return this.stashMarks.splice(t,1)[0]}applyPending(e){for(let t=0,n=this.pendingMarks;t<n.length;t++){let i=n[t];(this.type?this.type.allowsMarkType(i.type):ad(i.type,e))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Zl.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class id{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0;let i,r=t.topNode,o=td(null,t.preserveWhitespace,0)|(n?4:0);i=r?new nd(r.type,r.attrs,dl.none,dl.none,!0,t.topMatch||r.type.contentMatch,o):new nd(n?null:e.schema.topNodeType,null,dl.none,dl.none,!0,null,o),this.nodes=[i],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e){if(3==e.nodeType)this.addTextNode(e);else if(1==e.nodeType){let t=e.getAttribute("style");if(t){let n=this.readStyles(function(e){let t,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,i=[];for(;t=n.exec(e);)i.push(t[1],t[2].trim());return i}(t));if(!n)return;let[i,r]=n,o=this.top;for(let e=0;e<r.length;e++)this.removePendingMark(r[e],o);for(let e=0;e<i.length;e++)this.addPendingMark(i[e]);this.addElement(e);for(let e=0;e<i.length;e++)this.removePendingMark(i[e],o);for(let e=0;e<r.length;e++)this.addPendingMark(r[e])}else this.addElement(e)}}addTextNode(e){let t=e.nodeValue,n=this.top;if(2&n.options||n.inlineContext(e)||/[^ \t\r\n\u000c]/.test(t)){if(1&n.options)t=2&n.options?t.replace(/\r\n?/g,"\n"):t.replace(/\r?\n|\r/g," ");else if(t=t.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(t)&&this.open==this.nodes.length-1){let i=n.content[n.content.length-1],r=e.previousSibling;(!i||r&&"BR"==r.nodeName||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(t=t.slice(1))}t&&this.insertNode(this.parser.schema.text(t)),this.findInText(e)}else this.findInside(e)}addElement(e,t){let n,i=e.nodeName.toLowerCase();ed.hasOwnProperty(i)&&this.parser.normalizeLists&&function(e){for(let t=e.firstChild,n=null;t;t=t.nextSibling){let e=1==t.nodeType?t.nodeName.toLowerCase():null;e&&ed.hasOwnProperty(e)&&n?(n.appendChild(t),t=n):"li"==e?n=t:e&&(n=null)}}(e);let r=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(n=this.parser.matchTag(e,this,t));if(r?r.ignore:Ql.hasOwnProperty(i))this.findInside(e),this.ignoreFallback(e);else if(!r||r.skip||r.closeParent){r&&r.closeParent?this.open=Math.max(0,this.open-1):r&&r.skip.nodeType&&(e=r.skip);let t,n=this.top,o=this.needsBlock;if(Zl.hasOwnProperty(i))n.content.length&&n.content[0].isInline&&this.open&&(this.open--,n=this.top),t=!0,n.type||(this.needsBlock=!0);else if(!e.firstChild)return void this.leafFallback(e);this.addAll(e),t&&this.sync(n),this.needsBlock=o}else this.addElementByRule(e,r,!1===r.consuming?n:void 0)}leafFallback(e){"BR"==e.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode("\n"))}ignoreFallback(e){"BR"!=e.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))}readStyles(e){let t=dl.none,n=dl.none;e:for(let i=0;i<e.length;i+=2)for(let r;;){let o=this.parser.matchStyle(e[i],e[i+1],this,r);if(!o)continue e;if(o.ignore)return null;if(o.clearMark?this.top.pendingMarks.forEach((e=>{o.clearMark(e)&&(n=e.addToSet(n))})):t=this.parser.schema.marks[o.mark].create(o.attrs).addToSet(t),!1!==o.consuming)break;r=o}return[t,n]}addElementByRule(e,t,n){let i,r,o;if(t.node)r=this.parser.schema.nodes[t.node],r.isLeaf?this.insertNode(r.create(t.attrs))||this.leafFallback(e):i=this.enter(r,t.attrs||null,t.preserveWhitespace);else{o=this.parser.schema.marks[t.mark].create(t.attrs),this.addPendingMark(o)}let a=this.top;if(r&&r.isLeaf)this.findInside(e);else if(n)this.addElement(e,n);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach((e=>this.insertNode(e)));else{let n=e;"string"==typeof t.contentElement?n=e.querySelector(t.contentElement):"function"==typeof t.contentElement?n=t.contentElement(e):t.contentElement&&(n=t.contentElement),this.findAround(e,n,!0),this.addAll(n)}i&&this.sync(a)&&this.open--,o&&this.removePendingMark(o,a)}addAll(e,t,n){let i=t||0;for(let r=t?e.childNodes[t]:e.firstChild,o=null==n?null:e.childNodes[n];r!=o;r=r.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(r);this.findAtPoint(e,i)}findPlace(e){let t,n;for(let i=this.open;i>=0;i--){let r=this.nodes[i],o=r.findWrapping(e);if(o&&(!t||t.length>o.length)&&(t=o,n=r,!o.length))break;if(r.solid)break}if(!t)return!1;this.sync(n);for(let i=0;i<t.length;i++)this.enterInner(t[i],null,!1);return!0}insertNode(e){if(e.isInline&&this.needsBlock&&!this.top.type){let e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(e)){this.closeExtra();let t=this.top;t.applyPending(e.type),t.match&&(t.match=t.match.matchType(e.type));let n=t.activeMarks;for(let i=0;i<e.marks.length;i++)t.type&&!t.type.allowsMarkType(e.marks[i].type)||(n=e.marks[i].addToSet(n));return t.content.push(e.mark(n)),!0}return!1}enter(e,t,n){let i=this.findPlace(e.create(t));return i&&this.enterInner(e,t,!0,n),i}enterInner(e,t=null,n=!1,i){this.closeExtra();let r=this.top;r.applyPending(e),r.match=r.match&&r.match.matchType(e);let o=td(e,i,r.options);4&r.options&&0==r.content.length&&(o|=4),this.nodes.push(new nd(e,t,r.activeMarks,r.pendingMarks,n,null,o)),this.open++}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let t=n.length-1;t>=0;t--)e+=n[t].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)null==this.find[t].pos&&1==e.nodeType&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)if(null==this.find[i].pos&&1==e.nodeType&&e.contains(this.find[i].node)){t.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,i=!(this.isOpen||n&&n.parent.type!=this.nodes[0].type),r=-(n?n.depth+1:0)+(i?0:1),o=(e,a)=>{for(;e>=0;e--){let s=t[e];if(""==s){if(e==t.length-1||0==e)continue;for(;a>=r;a--)if(o(e-1,a))return!0;return!1}{let e=a>0||0==a&&i?this.nodes[a].type:n&&a>=r?n.node(a-r).type:null;if(!e||e.name!=s&&-1==e.groups.indexOf(s))return!1;a--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let e=this.parser.schema.nodes[t];if(e.isTextblock&&e.defaultAttrs)return e}}addPendingMark(e){let t=function(e,t){for(let n=0;n<t.length;n++)if(e.eq(t[n]))return t[n]}(e,this.top.pendingMarks);t&&this.top.stashMarks.push(t),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)}removePendingMark(e,t){for(let n=this.open;n>=0;n--){let i=this.nodes[n];if(i.pendingMarks.lastIndexOf(e)>-1)i.pendingMarks=e.removeFromSet(i.pendingMarks);else{i.activeMarks=e.removeFromSet(i.activeMarks);let t=i.popFromStashMark(e);t&&i.type&&i.type.allowsMarkType(t.type)&&(i.activeMarks=t.addToSet(i.activeMarks))}if(i==t)break}}}function rd(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function od(e){let t={};for(let n in e)t[n]=e[n];return t}function ad(e,t){let n=t.schema.nodes;for(let i in n){let r=n[i];if(!r.allowsMarkType(e))continue;let o=[],a=e=>{o.push(e);for(let n=0;n<e.edgeCount;n++){let{type:i,next:r}=e.edge(n);if(i==t)return!0;if(o.indexOf(r)<0&&a(r))return!0}};if(a(r.contentMatch))return!0}}class sd{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=ud(t).createDocumentFragment());let i=n,r=[];return e.forEach((e=>{if(r.length||e.marks.length){let n=0,o=0;for(;n<r.length&&o<e.marks.length;){let t=e.marks[o];if(this.marks[t.type.name]){if(!t.eq(r[n][0])||!1===t.type.spec.spanning)break;n++,o++}else o++}for(;n<r.length;)i=r.pop()[1];for(;o<e.marks.length;){let n=e.marks[o++],a=this.serializeMark(n,e.isInline,t);a&&(r.push([n,i]),i.appendChild(a.dom),i=a.contentDOM||a.dom)}}i.appendChild(this.serializeNodeInner(e,t))})),n}serializeNodeInner(e,t){let{dom:n,contentDOM:i}=sd.renderSpec(ud(t),this.nodes[e.type.name](e));if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,i)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let i=e.marks.length-1;i>=0;i--){let r=this.serializeMark(e.marks[i],e.isInline,t);r&&((r.contentDOM||r.dom).appendChild(n),n=r.dom)}return n}serializeMark(e,t,n={}){let i=this.marks[e.type.name];return i&&sd.renderSpec(ud(n),i(e,t))}static renderSpec(e,t,n=null){if("string"==typeof t)return{dom:e.createTextNode(t)};if(null!=t.nodeType)return{dom:t};if(t.dom&&null!=t.dom.nodeType)return t;let i,r=t[0],o=r.indexOf(" ");o>0&&(n=r.slice(0,o),r=r.slice(o+1));let a=n?e.createElementNS(n,r):e.createElement(r),s=t[1],c=1;if(s&&"object"==typeof s&&null==s.nodeType&&!Array.isArray(s)){c=2;for(let e in s)if(null!=s[e]){let t=e.indexOf(" ");t>0?a.setAttributeNS(e.slice(0,t),e.slice(t+1),s[e]):a.setAttribute(e,s[e])}}for(let u=c;u<t.length;u++){let r=t[u];if(0===r){if(u<t.length-1||u>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:a,contentDOM:a}}{let{dom:t,contentDOM:o}=sd.renderSpec(e,r,n);if(a.appendChild(t),o){if(i)throw new RangeError("Multiple content holes");i=o}}}return{dom:a,contentDOM:i}}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new sd(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=cd(e.nodes);return t.text||(t.text=e=>e.text),t}static marksFromSchema(e){return cd(e.marks)}}function cd(e){let t={};for(let n in e){let i=e[n].spec.toDOM;i&&(t[n]=i)}return t}function ud(e){return e.document||window.document}const ld=Math.pow(2,16);function dd(e){return 65535&e}class pd{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class hd{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&hd.empty)return hd.empty}recover(e){let t=0,n=dd(e);if(!this.inverted)for(let i=0;i<n;i++)t+=this.ranges[3*i+2]-this.ranges[3*i+1];return this.ranges[3*n]+t+function(e){return(e-(65535&e))/ld}(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let i=0,r=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let s=this.ranges[a]-(this.inverted?i:0);if(s>e)break;let c=this.ranges[a+r],u=this.ranges[a+o],l=s+c;if(e<=l){let r=s+i+((c?e==s?-1:e==l?1:t:t)<0?0:u);if(n)return r;let o=e==(t<0?s:l)?null:a/3+(e-s)*ld,d=e==s?2:e==l?1:4;return(t<0?e!=s:e!=l)&&(d|=8),new pd(r,d,o)}i+=u-c}return n?e+i:new pd(e+i,0,null)}touches(e,t){let n=0,i=dd(t),r=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let t=this.ranges[a]-(this.inverted?n:0);if(t>e)break;let s=this.ranges[a+r];if(e<=t+s&&a==3*i)return!0;n+=this.ranges[a+o]-s}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,r=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?r:0),s=o+(this.inverted?0:r),c=this.ranges[i+t],u=this.ranges[i+n];e(a,a+c,s,s+u),r+=u-c}}invert(){return new hd(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return 0==e?hd.empty:new hd(e<0?[0,-e,0]:[0,0,e])}}hd.empty=new hd([]);class fd{constructor(e=[],t,n=0,i=e.length){this.maps=e,this.mirror=t,this.from=n,this.to=i}slice(e=0,t=this.maps.length){return new fd(this.maps,this.mirror,e,t)}copy(){return new fd(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,t){this.to=this.maps.push(e),null!=t&&this.setMirror(this.maps.length-1,t)}appendMapping(e){for(let t=0,n=this.maps.length;t<e.maps.length;t++){let i=e.getMirror(t);this.appendMap(e.maps[t],null!=i&&i<t?n+i:void 0)}}getMirror(e){if(this.mirror)for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this.maps.length+e.maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e.maps[t].invert(),null!=i&&i>t?n-i-1:void 0)}}invert(){let e=new fd;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this.maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let i=0;for(let r=this.from;r<this.to;r++){let n=this.maps[r].mapResult(e,t);if(null!=n.recover){let t=this.getMirror(r);if(null!=t&&t>r&&t<this.to){r=t,e=this.maps[t].recover(n.recover);continue}}i|=n.delInfo,e=n.pos}return n?e:new pd(e,i,null)}}const gd=Object.create(null);class md{getMap(){return hd.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=gd[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in gd)throw new RangeError("Duplicate use of step JSON ID "+e);return gd[e]=t,t.prototype.jsonID=e,t}}class vd{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new vd(e,null)}static fail(e){return new vd(null,e)}static fromReplace(e,t,n,i){try{return vd.ok(e.replace(t,n,i))}catch(ok){if(ok instanceof pl)return vd.fail(ok.message);throw ok}}}function _d(e,t,n){let i=[];for(let r=0;r<e.childCount;r++){let o=e.child(r);o.content.size&&(o=o.copy(_d(o.content,t,o))),o.isInline&&(o=t(o,n,r)),i.push(o)}return sl.fromArray(i)}class yd extends md{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),r=new hl(_d(t.content,((e,t)=>e.isAtom&&t.type.allowsMarkType(this.mark.type)?e.mark(this.mark.addToSet(e.marks)):e),i),t.openStart,t.openEnd);return vd.fromReplace(e,this.from,this.to,r)}invert(){return new Id(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new yd(t.pos,n.pos,this.mark)}merge(e){return e instanceof yd&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new yd(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new yd(t.from,t.to,e.markFromJSON(t.mark))}}md.jsonID("addMark",yd);class Id extends md{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new hl(_d(t.content,(e=>e.mark(this.mark.removeFromSet(e.marks))),e),t.openStart,t.openEnd);return vd.fromReplace(e,this.from,this.to,n)}invert(){return new yd(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new Id(t.pos,n.pos,this.mark)}merge(e){return e instanceof Id&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Id(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Id(t.from,t.to,e.markFromJSON(t.mark))}}md.jsonID("removeMark",Id);class Md extends md{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return vd.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return vd.fromReplace(e,this.pos,this.pos+1,new hl(sl.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let e=this.mark.addToSet(t.marks);if(e.length==t.marks.length){for(let n=0;n<t.marks.length;n++)if(!t.marks[n].isInSet(e))return new Md(this.pos,t.marks[n]);return new Md(this.pos,this.mark)}}return new Td(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Md(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Md(t.pos,e.markFromJSON(t.mark))}}md.jsonID("addNodeMark",Md);class Td extends md{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return vd.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return vd.fromReplace(e,this.pos,this.pos+1,new hl(sl.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return t&&this.mark.isInSet(t.marks)?new Md(this.pos,this.mark):this}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Td(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Td(t.pos,e.markFromJSON(t.mark))}}md.jsonID("removeNodeMark",Td);class Cd extends md{constructor(e,t,n,i=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=i}apply(e){return this.structure&&Ed(e,this.from,this.to)?vd.fail("Structure replace would overwrite content"):vd.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new hd([this.from,this.to-this.from,this.slice.size])}invert(e){return new Cd(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new Cd(t.pos,Math.max(t.pos,n.pos),this.slice)}merge(e){if(!(e instanceof Cd)||e.structure||this.structure)return null;if(this.from+this.slice.size!=e.from||this.slice.openEnd||e.slice.openStart){if(e.to!=this.from||this.slice.openStart||e.slice.openEnd)return null;{let t=this.slice.size+e.slice.size==0?hl.empty:new hl(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Cd(e.from,this.to,t,this.structure)}}{let t=this.slice.size+e.slice.size==0?hl.empty:new hl(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Cd(this.from,this.to+(e.to-e.from),t,this.structure)}}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Cd(t.from,t.to,hl.fromJSON(e,t.slice),!!t.structure)}}md.jsonID("replace",Cd);class Sd extends md{constructor(e,t,n,i,r,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=i,this.slice=r,this.insert=o,this.structure=a}apply(e){if(this.structure&&(Ed(e,this.from,this.gapFrom)||Ed(e,this.gapTo,this.to)))return vd.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return vd.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?vd.fromReplace(e,this.from,this.to,n):vd.fail("Content does not fit in gap")}getMap(){return new hd([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new Sd(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=e.map(this.gapFrom,-1),r=e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||i<t.pos||r>n.pos?null:new Sd(t.pos,n.pos,i,r,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to||"number"!=typeof t.gapFrom||"number"!=typeof t.gapTo||"number"!=typeof t.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Sd(t.from,t.to,t.gapFrom,t.gapTo,hl.fromJSON(e,t.slice),t.insert,!!t.structure)}}function Ed(e,t,n){let i=e.resolve(t),r=n-t,o=i.depth;for(;r>0&&o>0&&i.indexAfter(o)==i.node(o).childCount;)o--,r--;if(r>0){let e=i.node(o).maybeChild(i.indexAfter(o));for(;r>0;){if(!e||e.isLeaf)return!0;e=e.firstChild,r--}}return!1}function kd(e,t,n){return(0==t||e.canReplace(t,e.childCount))&&(n==e.childCount||e.canReplace(0,n))}function bd(e){let t=e.parent.content.cutByIndex(e.startIndex,e.endIndex);for(let n=e.depth;;--n){let i=e.$from.node(n),r=e.$from.index(n),o=e.$to.indexAfter(n);if(n<e.depth&&i.canReplace(r,o,t))return n;if(0==n||i.type.spec.isolating||!kd(i,r,o))break}return null}function Dd(e,t,n=null,i=e){let r=function(e,t){let{parent:n,startIndex:i,endIndex:r}=e,o=n.contentMatchAt(i).findWrapping(t);if(!o)return null;let a=o.length?o[0]:t;return n.canReplaceWith(i,r,a)?o:null}(e,t),o=r&&function(e,t){let{parent:n,startIndex:i,endIndex:r}=e,o=n.child(i),a=t.contentMatch.findWrapping(o.type);if(!a)return null;let s=(a.length?a[a.length-1]:t).contentMatch;for(let c=i;s&&c<r;c++)s=s.matchType(n.child(c).type);return s&&s.validEnd?a:null}(i,t);return o?r.map(wd).concat({type:t,attrs:n}).concat(o.map(wd)):null}function wd(e){return{type:e,attrs:null}}function Ad(e,t,n=1,i){let r=e.resolve(t),o=r.depth-n,a=i&&i[i.length-1]||r.parent;if(o<0||r.parent.type.spec.isolating||!r.parent.canReplace(r.index(),r.parent.childCount)||!a.type.validContent(r.parent.content.cutByIndex(r.index(),r.parent.childCount)))return!1;for(let u=r.depth-1,l=n-2;u>o;u--,l--){let e=r.node(u),t=r.index(u);if(e.type.spec.isolating)return!1;let n=e.content.cutByIndex(t,e.childCount),o=i&&i[l]||e;if(o!=e&&(n=n.replaceChild(0,o.type.create(o.attrs))),!e.canReplace(t+1,e.childCount)||!o.type.validContent(n))return!1}let s=r.indexAfter(o),c=i&&i[0];return r.node(o).canReplaceWith(s,s,c?c.type:r.node(o+1).type)}function Rd(e,t){let n=e.resolve(t),i=n.index();return Ld(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(i,i+1)}function Ld(e,t){return!(!e||!t||e.isLeaf||!e.canAppend(t))}function Od(e,t,n=-1){let i=e.resolve(t);for(let r=i.depth;;r--){let e,o,a=i.index(r);if(r==i.depth?(e=i.nodeBefore,o=i.nodeAfter):n>0?(e=i.node(r+1),a++,o=i.node(r).maybeChild(a)):(e=i.node(r).maybeChild(a-1),o=i.node(r+1)),e&&!e.isTextblock&&Ld(e,o)&&i.node(r).canReplace(a,a+1))return t;if(0==r)break;t=n<0?i.before(r):i.after(r)}}function Nd(e,t,n=t,i=hl.empty){if(t==n&&!i.size)return null;let r=e.resolve(t),o=e.resolve(n);return Pd(r,o,i)?new Cd(t,n,i):new Ud(r,o,i).fit()}function Pd(e,t,n){return!n.openStart&&!n.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),n.content)}md.jsonID("replaceAround",Sd);class Ud{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=sl.empty;for(let i=0;i<=e.depth;i++){let t=e.node(i);this.frontier.push({type:t.type,match:t.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=sl.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let r=this.placed,o=n.depth,a=i.depth;for(;o&&a&&1==r.childCount;)r=r.firstChild.content,o--,a--;let s=new hl(r,o,a);return e>-1?new Sd(n.pos,e,this.$to.pos,this.$to.end(),s,t):s.size||n.pos!=this.$to.pos?new Cd(n.pos,i.pos,s):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let r=t.firstChild;if(t.childCount>1&&(i=0),r.type.spec.isolating&&i<=n){e=n;break}t=r.content}for(let t=1;t<=2;t++)for(let n=1==t?e:this.unplaced.openStart;n>=0;n--){let e,i=null;n?(i=Fd(this.unplaced.content,n-1).firstChild,e=i.content):e=this.unplaced.content;let r=e.firstChild;for(let o=this.depth;o>=0;o--){let e,{type:a,match:s}=this.frontier[o],c=null;if(1==t&&(r?s.matchType(r.type)||(c=s.fillBefore(sl.from(r),!1)):i&&a.compatibleContent(i.type)))return{sliceDepth:n,frontierDepth:o,parent:i,inject:c};if(2==t&&r&&(e=s.findWrapping(r.type)))return{sliceDepth:n,frontierDepth:o,parent:i,wrap:e};if(i&&s.matchType(i.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=Fd(e,t);return!(!i.childCount||i.firstChild.isLeaf)&&(this.unplaced=new hl(e,t+1,Math.max(n,i.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=Fd(e,t);if(i.childCount<=1&&t>0){let r=e.size-t<=t+i.size;this.unplaced=new hl(xd(e,t-1,1),t-1,r?t-1:n)}else this.unplaced=new hl(xd(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:i,wrap:r}){for(;this.depth>t;)this.closeFrontierNode();if(r)for(let f=0;f<r.length;f++)this.openFrontierNode(r[f]);let o=this.unplaced,a=n?n.content:o.content,s=o.openStart-e,c=0,u=[],{match:l,type:d}=this.frontier[t];if(i){for(let e=0;e<i.childCount;e++)u.push(i.child(e));l=l.matchFragment(i)}let p=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let e=a.child(c),t=l.matchType(e.type);if(!t)break;c++,(c>1||0==s||e.content.size)&&(l=t,u.push(Vd(e.mark(d.allowedMarks(e.marks)),1==c?s:0,c==a.childCount?p:-1)))}let h=c==a.childCount;h||(p=-1),this.placed=Gd(this.placed,t,sl.from(u)),this.frontier[t].match=l,h&&p<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let f=0,g=a;f<p;f++){let e=g.lastChild;this.frontier.push({type:e.type,match:e.contentMatchAt(e.childCount)}),g=e.content}this.unplaced=h?0==e?hl.empty:new hl(xd(o.content,e-1,1),e-1,p<0?o.openEnd:e-1):new hl(xd(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e,t=this.frontier[this.depth];if(!t.type.isTextblock||!qd(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:i}=this.frontier[t],r=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=qd(e,t,i,n,r);if(o){for(let n=t-1;n>=0;n--){let{match:t,type:i}=this.frontier[n],r=qd(e,n,i,t,!0);if(!r||r.childCount)continue e}return{depth:t,fit:o,move:r?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Gd(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let t=e.node(n),i=t.type.contentMatch.fillBefore(t.content,!0,e.index(n));this.openFrontierNode(t.type,t.attrs,i)}return e}openFrontierNode(e,t=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Gd(this.placed,this.depth,sl.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(sl.empty,!0);e.childCount&&(this.placed=Gd(this.placed,this.frontier.length,e))}}function xd(e,t,n){return 0==t?e.cutByIndex(n,e.childCount):e.replaceChild(0,e.firstChild.copy(xd(e.firstChild.content,t-1,n)))}function Gd(e,t,n){return 0==t?e.append(n):e.replaceChild(e.childCount-1,e.lastChild.copy(Gd(e.lastChild.content,t-1,n)))}function Fd(e,t){for(let n=0;n<t;n++)e=e.firstChild.content;return e}function Vd(e,t,n){if(t<=0)return e;let i=e.content;return t>1&&(i=i.replaceChild(0,Vd(i.firstChild,t-1,1==i.childCount?n-1:0))),t>0&&(i=e.type.contentMatch.fillBefore(i).append(i),n<=0&&(i=i.append(e.type.contentMatch.matchFragment(i).fillBefore(sl.empty,!0)))),e.copy(i)}function qd(e,t,n,i,r){let o=e.node(t),a=r?e.indexAfter(t):e.index(t);if(a==o.childCount&&!n.compatibleContent(o.type))return null;let s=i.fillBefore(o.content,!0,a);return s&&!function(e,t,n){for(let i=n;i<t.childCount;i++)if(!e.allowsMarks(t.child(i).marks))return!0;return!1}(n,o.content,a)?s:null}function Bd(e){return e.spec.defining||e.spec.definingForContent}function Hd(e,t,n,i,r){if(t<n){let r=e.firstChild;e=e.replaceChild(0,r.copy(Hd(r.content,t+1,n,i,r)))}if(t>i){let t=r.contentMatchAt(0),n=t.fillBefore(e).append(e);e=n.append(t.matchFragment(n).fillBefore(sl.empty,!0))}return e}function Kd(e,t){let n=[];for(let i=Math.min(e.depth,t.depth);i>=0;i--){let r=e.start(i);if(r<e.pos-(e.depth-i)||t.end(i)>t.pos+(t.depth-i)||e.node(i).type.spec.isolating||t.node(i).type.spec.isolating)break;(r==t.start(i)||i==e.depth&&i==t.depth&&e.parent.inlineContent&&t.parent.inlineContent&&i&&t.start(i-1)==r-1)&&n.push(i)}return n}class zd extends md{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return vd.fail("No node at attribute step's position");let n=Object.create(null);for(let r in t.attrs)n[r]=t.attrs[r];n[this.attr]=this.value;let i=t.type.create(n,null,t.marks);return vd.fromReplace(e,this.pos,this.pos+1,new hl(sl.from(i),0,t.isLeaf?0:1))}getMap(){return hd.empty}invert(e){return new zd(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new zd(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if("number"!=typeof t.pos||"string"!=typeof t.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new zd(t.pos,t.attr,t.value)}}md.jsonID("attr",zd);let Wd=class extends Error{};Wd=function e(t){let n=Error.call(this,t);return n.__proto__=e.prototype,n},(Wd.prototype=Object.create(Error.prototype)).constructor=Wd,Wd.prototype.name="TransformError";class Yd{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new fd}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Wd(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=hl.empty){let i=Nd(this.doc,e,t,n);return i&&this.step(i),this}replaceWith(e,t,n){return this.replace(e,t,new hl(sl.from(n),0,0))}delete(e,t){return this.replace(e,t,hl.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return function(e,t,n,i){if(!i.size)return e.deleteRange(t,n);let r=e.doc.resolve(t),o=e.doc.resolve(n);if(Pd(r,o,i))return e.step(new Cd(t,n,i));let a=Kd(r,e.doc.resolve(n));0==a[a.length-1]&&a.pop();let s=-(r.depth+1);a.unshift(s);for(let p=r.depth,h=r.pos-1;p>0;p--,h--){let e=r.node(p).type.spec;if(e.defining||e.definingAsContext||e.isolating)break;a.indexOf(p)>-1?s=p:r.before(p)==h&&a.splice(1,0,-p)}let c=a.indexOf(s),u=[],l=i.openStart;for(let p=i.content,h=0;;h++){let e=p.firstChild;if(u.push(e),h==i.openStart)break;p=e.content}for(let p=l-1;p>=0;p--){let e=u[p].type,t=Bd(e);if(t&&r.node(c).type!=e)l=p;else if(t||!e.isTextblock)break}for(let p=i.openStart;p>=0;p--){let t=(p+l+1)%(i.openStart+1),s=u[t];if(s)for(let u=0;u<a.length;u++){let l=a[(u+c)%a.length],d=!0;l<0&&(d=!1,l=-l);let p=r.node(l-1),h=r.index(l-1);if(p.canReplaceWith(h,h,s.type,s.marks))return e.replace(r.before(l),d?o.after(l):n,new hl(Hd(i.content,0,i.openStart,t),t,i.openEnd))}}let d=e.steps.length;for(let p=a.length-1;p>=0&&(e.replace(t,n,i),!(e.steps.length>d));p--){let e=a[p];e<0||(t=r.before(e),n=o.after(e))}}(this,e,t,n),this}replaceRangeWith(e,t,n){return function(e,t,n,i){if(!i.isInline&&t==n&&e.doc.resolve(t).parent.content.size){let r=function(e,t,n){let i=e.resolve(t);if(i.parent.canReplaceWith(i.index(),i.index(),n))return t;if(0==i.parentOffset)for(let r=i.depth-1;r>=0;r--){let e=i.index(r);if(i.node(r).canReplaceWith(e,e,n))return i.before(r+1);if(e>0)return null}if(i.parentOffset==i.parent.content.size)for(let r=i.depth-1;r>=0;r--){let e=i.indexAfter(r);if(i.node(r).canReplaceWith(e,e,n))return i.after(r+1);if(e<i.node(r).childCount)return null}return null}(e.doc,t,i.type);null!=r&&(t=n=r)}e.replaceRange(t,n,new hl(sl.from(i),0,0))}(this,e,t,n),this}deleteRange(e,t){return function(e,t,n){let i=e.doc.resolve(t),r=e.doc.resolve(n),o=Kd(i,r);for(let a=0;a<o.length;a++){let t=o[a],n=a==o.length-1;if(n&&0==t||i.node(t).type.contentMatch.validEnd)return e.delete(i.start(t),r.end(t));if(t>0&&(n||i.node(t-1).canReplace(i.index(t-1),r.indexAfter(t-1))))return e.delete(i.before(t),r.after(t))}for(let a=1;a<=i.depth&&a<=r.depth;a++)if(t-i.start(a)==i.depth-a&&n>i.end(a)&&r.end(a)-n!=r.depth-a)return e.delete(i.before(a),n);e.delete(t,n)}(this,e,t),this}lift(e,t){return function(e,t,n){let{$from:i,$to:r,depth:o}=t,a=i.before(o+1),s=r.after(o+1),c=a,u=s,l=sl.empty,d=0;for(let f=o,g=!1;f>n;f--)g||i.index(f)>0?(g=!0,l=sl.from(i.node(f).copy(l)),d++):c--;let p=sl.empty,h=0;for(let f=o,g=!1;f>n;f--)g||r.after(f+1)<r.end(f)?(g=!0,p=sl.from(r.node(f).copy(p)),h++):u++;e.step(new Sd(c,u,a,s,new hl(l.append(p),d,h),l.size-d,!0))}(this,e,t),this}join(e,t=1){return function(e,t,n){let i=new Cd(t-n,t+n,hl.empty,!0);e.step(i)}(this,e,t),this}wrap(e,t){return function(e,t,n){let i=sl.empty;for(let a=n.length-1;a>=0;a--){if(i.size){let e=n[a].type.contentMatch.matchFragment(i);if(!e||!e.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}i=sl.from(n[a].type.create(n[a].attrs,i))}let r=t.start,o=t.end;e.step(new Sd(r,o,r,o,new hl(i,0,0),n.length,!0))}(this,e,t),this}setBlockType(e,t=e,n,i=null){return function(e,t,n,i,r){if(!i.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let o=e.steps.length;e.doc.nodesBetween(t,n,((t,n)=>{if(t.isTextblock&&!t.hasMarkup(i,r)&&function(e,t,n){let i=e.resolve(t),r=i.index();return i.parent.canReplaceWith(r,r+1,n)}(e.doc,e.mapping.slice(o).map(n),i)){e.clearIncompatible(e.mapping.slice(o).map(n,1),i);let a=e.mapping.slice(o),s=a.map(n,1),c=a.map(n+t.nodeSize,1);return e.step(new Sd(s,c,s+1,c-1,new hl(sl.from(i.create(r,null,t.marks)),0,0),1,!0)),!1}}))}(this,e,t,n,i),this}setNodeMarkup(e,t,n=null,i){return function(e,t,n,i,r){let o=e.doc.nodeAt(t);if(!o)throw new RangeError("No node at given position");n||(n=o.type);let a=n.create(i,null,r||o.marks);if(o.isLeaf)return e.replaceWith(t,t+o.nodeSize,a);if(!n.validContent(o.content))throw new RangeError("Invalid content for node type "+n.name);e.step(new Sd(t,t+o.nodeSize,t+1,t+o.nodeSize-1,new hl(sl.from(a),0,0),1,!0))}(this,e,t,n,i),this}setNodeAttribute(e,t,n){return this.step(new zd(e,t,n)),this}addNodeMark(e,t){return this.step(new Md(e,t)),this}removeNodeMark(e,t){if(!(t instanceof dl)){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(!(t=t.isInSet(n.marks)))return this}return this.step(new Td(e,t)),this}split(e,t=1,n){return function(e,t,n=1,i){let r=e.doc.resolve(t),o=sl.empty,a=sl.empty;for(let s=r.depth,c=r.depth-n,u=n-1;s>c;s--,u--){o=sl.from(r.node(s).copy(o));let e=i&&i[u];a=sl.from(e?e.type.create(e.attrs,a):r.node(s).copy(a))}e.step(new Cd(t,t,new hl(o.append(a),n,n),!0))}(this,e,t,n),this}addMark(e,t,n){return function(e,t,n,i){let r,o,a=[],s=[];e.doc.nodesBetween(t,n,((e,c,u)=>{if(!e.isInline)return;let l=e.marks;if(!i.isInSet(l)&&u.type.allowsMarkType(i.type)){let u=Math.max(c,t),d=Math.min(c+e.nodeSize,n),p=i.addToSet(l);for(let e=0;e<l.length;e++)l[e].isInSet(p)||(r&&r.to==u&&r.mark.eq(l[e])?r.to=d:a.push(r=new Id(u,d,l[e])));o&&o.to==u?o.to=d:s.push(o=new yd(u,d,i))}})),a.forEach((t=>e.step(t))),s.forEach((t=>e.step(t)))}(this,e,t,n),this}removeMark(e,t,n){return function(e,t,n,i){let r=[],o=0;e.doc.nodesBetween(t,n,((e,a)=>{if(!e.isInline)return;o++;let s=null;if(i instanceof Yl){let t,n=e.marks;for(;t=i.isInSet(n);)(s||(s=[])).push(t),n=t.removeFromSet(n)}else i?i.isInSet(e.marks)&&(s=[i]):s=e.marks;if(s&&s.length){let i=Math.min(a+e.nodeSize,n);for(let e=0;e<s.length;e++){let n,c=s[e];for(let e=0;e<r.length;e++){let t=r[e];t.step==o-1&&c.eq(r[e].style)&&(n=t)}n?(n.to=i,n.step=o):r.push({style:c,from:Math.max(a,t),to:i,step:o})}}})),r.forEach((t=>e.step(new Id(t.from,t.to,t.style))))}(this,e,t,n),this}clearIncompatible(e,t,n){return function(e,t,n,i=n.contentMatch){let r=e.doc.nodeAt(t),o=[],a=t+1;for(let s=0;s<r.childCount;s++){let t=r.child(s),c=a+t.nodeSize,u=i.matchType(t.type);if(u){i=u;for(let i=0;i<t.marks.length;i++)n.allowsMarkType(t.marks[i].type)||e.step(new Id(a,c,t.marks[i]))}else o.push(new Cd(a,c,hl.empty));a=c}if(!i.validEnd){let t=i.fillBefore(sl.empty,!0);e.replace(a,a,new hl(t,0,0))}for(let s=o.length-1;s>=0;s--)e.step(o[s])}(this,e,t,n),this}}const $d=Object.create(null);class Jd{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new Xd(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=hl.empty){let n=t.content.lastChild,i=null;for(let a=0;a<t.openEnd;a++)i=n,n=n.lastChild;let r=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:s,$to:c}=o[a],u=e.mapping.slice(r);e.replaceRange(u.map(s.pos),u.map(c.pos),a?hl.empty:t),0==a&&sp(e,r,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,i=this.ranges;for(let r=0;r<i.length;r++){let{$from:o,$to:a}=i[r],s=e.mapping.slice(n),c=s.map(o.pos),u=s.map(a.pos);r?e.deleteRange(c,u):(e.replaceRangeWith(c,u,t),sp(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let i=e.parent.inlineContent?new ep(e):ap(e.node(0),e.parent,e.pos,e.index(),t,n);if(i)return i;for(let r=e.depth-1;r>=0;r--){let i=t<0?ap(e.node(0),e.node(r),e.before(r+1),e.index(r),t,n):ap(e.node(0),e.node(r),e.after(r+1),e.index(r)+1,t,n);if(i)return i}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new rp(e.node(0))}static atStart(e){return ap(e,e,0,0,1)||new rp(e)}static atEnd(e){return ap(e,e,e.content.size,e.childCount,-1)||new rp(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=$d[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in $d)throw new RangeError("Duplicate use of selection JSON ID "+e);return $d[e]=t,t.prototype.jsonID=e,t}getBookmark(){return ep.between(this.$anchor,this.$head).getBookmark()}}Jd.prototype.visible=!0;class Xd{constructor(e,t){this.$from=e,this.$to=t}}let Zd=!1;function Qd(e){Zd||e.parent.inlineContent||(Zd=!0)}class ep extends Jd{constructor(e,t=e){Qd(e),Qd(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return Jd.near(n);let i=e.resolve(t.map(this.anchor));return new ep(i.parent.inlineContent?i:n,n)}replace(e,t=hl.empty){if(super.replace(e,t),t==hl.empty){let t=this.$from.marksAcross(this.$to);t&&e.ensureMarks(t)}}eq(e){return e instanceof ep&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new tp(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if("number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new ep(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let i=e.resolve(t);return new this(i,n==t?i:e.resolve(n))}static between(e,t,n){let i=e.pos-t.pos;if(n&&!i||(n=i>=0?1:-1),!t.parent.inlineContent){let e=Jd.findFrom(t,n,!0)||Jd.findFrom(t,-n,!0);if(!e)return Jd.near(t,n);t=e.$head}return e.parent.inlineContent||(0==i||(e=(Jd.findFrom(e,-n,!0)||Jd.findFrom(e,n,!0)).$anchor).pos<t.pos!=i<0)&&(e=t),new ep(e,t)}}Jd.jsonID("text",ep);class tp{constructor(e,t){this.anchor=e,this.head=t}map(e){return new tp(e.map(this.anchor),e.map(this.head))}resolve(e){return ep.between(e.resolve(this.anchor),e.resolve(this.head))}}class np extends Jd{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:i}=t.mapResult(this.anchor),r=e.resolve(i);return n?Jd.near(r):new np(r)}content(){return new hl(sl.from(this.node),0,0)}eq(e){return e instanceof np&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new ip(this.anchor)}static fromJSON(e,t){if("number"!=typeof t.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new np(e.resolve(t.anchor))}static create(e,t){return new np(e.resolve(t))}static isSelectable(e){return!e.isText&&!1!==e.type.spec.selectable}}np.prototype.visible=!1,Jd.jsonID("node",np);class ip{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new tp(n,n):new ip(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&np.isSelectable(n)?new np(t):Jd.near(t)}}class rp extends Jd{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=hl.empty){if(t==hl.empty){e.delete(0,e.doc.content.size);let t=Jd.atStart(e.doc);t.eq(e.selection)||e.setSelection(t)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new rp(e)}map(e){return new rp(e)}eq(e){return e instanceof rp}getBookmark(){return op}}Jd.jsonID("all",rp);const op={map(){return this},resolve:e=>new rp(e)};function ap(e,t,n,i,r,o=!1){if(t.inlineContent)return ep.create(e,n);for(let a=i-(r>0?0:1);r>0?a<t.childCount:a>=0;a+=r){let i=t.child(a);if(i.isAtom){if(!o&&np.isSelectable(i))return np.create(e,n-(r<0?i.nodeSize:0))}else{let t=ap(e,i,n+r,r<0?i.childCount:0,r,o);if(t)return t}n+=i.nodeSize*r}return null}function sp(e,t,n){let i=e.steps.length-1;if(i<t)return;let r,o=e.steps[i];(o instanceof Cd||o instanceof Sd)&&(e.mapping.maps[i].forEach(((e,t,n,i)=>{null==r&&(r=i)})),e.setSelection(Jd.near(e.doc.resolve(r),n)))}class cp extends Yd{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=-3&(1|this.updated),this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=2,this}ensureMarks(e){return dl.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(e,t){super.addStep(e,t),this.updated=-3&this.updated,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||dl.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let i=this.doc.type.schema;if(null==t)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(null==n&&(n=t),n=null==n?t:n,!e)return this.deleteRange(t,n);let r=this.storedMarks;if(!r){let e=this.doc.resolve(t);r=n==t?e.marks():e.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,i.text(e,r)),this.selection.empty||this.setSelection(Jd.near(this.selection.$to)),this}}setMeta(e,t){return this.meta["string"==typeof e?e:e.key]=t,this}getMeta(e){return this.meta["string"==typeof e?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function up(e,t){return t&&e?e.bind(t):e}class lp{constructor(e,t,n){this.name=e,this.init=up(t.init,n),this.apply=up(t.apply,n)}}const dp=[new lp("doc",{init:e=>e.doc||e.schema.topNodeType.createAndFill(),apply:e=>e.doc}),new lp("selection",{init:(e,t)=>e.selection||Jd.atStart(t.doc),apply:e=>e.selection}),new lp("storedMarks",{init:e=>e.storedMarks||null,apply:(e,t,n,i)=>i.selection.$cursor?e.storedMarks:null}),new lp("scrollToSelection",{init:()=>0,apply:(e,t)=>e.scrolledIntoView?t+1:t})];class pp{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=dp.slice(),t&&t.forEach((e=>{if(this.pluginsByKey[e.key])throw new RangeError("Adding different instances of a keyed plugin ("+e.key+")");this.plugins.push(e),this.pluginsByKey[e.key]=e,e.spec.state&&this.fields.push(new lp(e.key,e.spec.state,e))}))}}class hp{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let t=this.config.plugins[n];if(t.spec.filterTransaction&&!t.spec.filterTransaction.call(t,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),i=null;for(;;){let r=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let s=i?i[o].n:0,c=i?i[o].state:this,u=s<t.length&&a.spec.appendTransaction.call(a,s?t.slice(s):t,c,n);if(u&&n.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!i){i=[];for(let e=0;e<this.config.plugins.length;e++)i.push(e<o?{state:n,n:t.length}:{state:this,n:0})}t.push(u),n=n.applyInner(u),r=!0}i&&(i[o]={state:n,n:t.length})}}if(!r)return{state:n,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new hp(this.config),n=this.config.fields;for(let i=0;i<n.length;i++){let r=n[i];t[r.name]=r.apply(e,this[r.name],this,t)}return t}get tr(){return new cp(this)}static create(e){let t=new pp(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new hp(t);for(let i=0;i<t.fields.length;i++)n[t.fields[i].name]=t.fields[i].init(e,n);return n}reconfigure(e){let t=new pp(this.schema,e.plugins),n=t.fields,i=new hp(t);for(let r=0;r<n.length;r++){let t=n[r].name;i[t]=this.hasOwnProperty(t)?this[t]:n[r].init(e,i)}return i}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map((e=>e.toJSON()))),e&&"object"==typeof e)for(let n in e){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[n],r=i.spec.state;r&&r.toJSON&&(t[n]=r.toJSON.call(i,this[i.key]))}return t}static fromJSON(e,t,n){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new pp(e.schema,e.plugins),r=new hp(i);return i.fields.forEach((i=>{if("doc"==i.name)r.doc=Rl.fromJSON(e.schema,t.doc);else if("selection"==i.name)r.selection=Jd.fromJSON(r.doc,t.selection);else if("storedMarks"==i.name)t.storedMarks&&(r.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let o in n){let a=n[o],s=a.spec.state;if(a.key==i.name&&s&&s.fromJSON&&Object.prototype.hasOwnProperty.call(t,o))return void(r[i.name]=s.fromJSON.call(a,e,t[o],r))}r[i.name]=i.init(e,r)}})),r}}function fp(e,t,n){for(let i in e){let r=e[i];r instanceof Function?r=r.bind(t):"handleDOMEvents"==i&&(r=fp(r,t,{})),n[i]=r}return n}class gp{constructor(e){this.spec=e,this.props={},e.props&&fp(e.props,this,this.props),this.key=e.key?e.key.key:vp("plugin")}getState(e){return e[this.key]}}const mp=Object.create(null);function vp(e){return e in mp?e+"$"+ ++mp[e]:(mp[e]=0,e+"$")}class _p{constructor(e="key"){this.key=vp(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const yp=function(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t},Ip=function(e){let t=e.assignedSlot||e.parentNode;return t&&11==t.nodeType?t.host:t};let Mp=null;const Tp=function(e,t,n){let i=Mp||(Mp=document.createRange());return i.setEnd(e,null==n?e.nodeValue.length:n),i.setStart(e,t||0),i},Cp=function(e,t,n,i){return n&&(Ep(e,t,n,i,-1)||Ep(e,t,n,i,1))},Sp=/^(img|br|input|textarea|hr)$/i;function Ep(e,t,n,i,r){for(;;){if(e==n&&t==i)return!0;if(t==(r<0?0:kp(e))){let n=e.parentNode;if(!n||1!=n.nodeType||bp(e)||Sp.test(e.nodeName)||"false"==e.contentEditable)return!1;t=yp(e)+(r<0?0:1),e=n}else{if(1!=e.nodeType)return!1;if("false"==(e=e.childNodes[t+(r<0?-1:0)]).contentEditable)return!1;t=r<0?kp(e):0}}}function kp(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function bp(e){let t;for(let n=e;n&&!(t=n.pmViewDesc);n=n.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}const Dp=function(e){return e.focusNode&&Cp(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)};function wp(e,t){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=e,n.key=n.code=t,n}const Ap="undefined"!=typeof navigator?navigator:null,Rp="undefined"!=typeof document?document:null,Lp=Ap&&Ap.userAgent||"",Op=/Edge\/(\d+)/.exec(Lp),Np=/MSIE \d/.exec(Lp),Pp=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Lp),Up=!!(Np||Pp||Op),xp=Np?document.documentMode:Pp?+Pp[1]:Op?+Op[1]:0,Gp=!Up&&/gecko\/(\d+)/i.test(Lp);Gp&&(/Firefox\/(\d+)/.exec(Lp)||[0,0])[1];const Fp=!Up&&/Chrome\/(\d+)/.exec(Lp),Vp=!!Fp,qp=Fp?+Fp[1]:0,Bp=!Up&&!!Ap&&/Apple Computer/.test(Ap.vendor),Hp=Bp&&(/Mobile\/\w+/.test(Lp)||!!Ap&&Ap.maxTouchPoints>2),jp=Hp||!!Ap&&/Mac/.test(Ap.platform),Kp=!!Ap&&/Win/.test(Ap.platform),zp=/Android \d/.test(Lp),Wp=!!Rp&&"webkitFontSmoothing"in Rp.documentElement.style,Yp=Wp?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function $p(e){return{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function Jp(e,t){return"number"==typeof e?e:e[t]}function Xp(e){let t=e.getBoundingClientRect(),n=t.width/e.offsetWidth||1,i=t.height/e.offsetHeight||1;return{left:t.left,right:t.left+e.clientWidth*n,top:t.top,bottom:t.top+e.clientHeight*i}}function Zp(e,t,n){let i=e.someProp("scrollThreshold")||0,r=e.someProp("scrollMargin")||5,o=e.dom.ownerDocument;for(let a=n||e.dom;a;a=Ip(a)){if(1!=a.nodeType)continue;let e=a,n=e==o.body,s=n?$p(o):Xp(e),c=0,u=0;if(t.top<s.top+Jp(i,"top")?u=-(s.top-t.top+Jp(r,"top")):t.bottom>s.bottom-Jp(i,"bottom")&&(u=t.bottom-s.bottom+Jp(r,"bottom")),t.left<s.left+Jp(i,"left")?c=-(s.left-t.left+Jp(r,"left")):t.right>s.right-Jp(i,"right")&&(c=t.right-s.right+Jp(r,"right")),c||u)if(n)o.defaultView.scrollBy(c,u);else{let n=e.scrollLeft,i=e.scrollTop;u&&(e.scrollTop+=u),c&&(e.scrollLeft+=c);let r=e.scrollLeft-n,o=e.scrollTop-i;t={left:t.left-r,top:t.top-o,right:t.right-r,bottom:t.bottom-o}}if(n)break}}function Qp(e){let t=[],n=e.ownerDocument;for(let i=e;i&&(t.push({dom:i,top:i.scrollTop,left:i.scrollLeft}),e!=n);i=Ip(i));return t}function eh(e,t){for(let n=0;n<e.length;n++){let{dom:i,top:r,left:o}=e[n];i.scrollTop!=r+t&&(i.scrollTop=r+t),i.scrollLeft!=o&&(i.scrollLeft=o)}}let th=null;function nh(e,t){let n,i,r,o,a=2e8,s=0,c=t.top,u=t.top;for(let l=e.firstChild,d=0;l;l=l.nextSibling,d++){let e;if(1==l.nodeType)e=l.getClientRects();else{if(3!=l.nodeType)continue;e=Tp(l).getClientRects()}for(let p=0;p<e.length;p++){let h=e[p];if(h.top<=c&&h.bottom>=u){c=Math.max(h.bottom,c),u=Math.min(h.top,u);let e=h.left>t.left?h.left-t.left:h.right<t.left?t.left-h.right:0;if(e<a){n=l,a=e,i=e&&3==n.nodeType?{left:h.right<t.left?h.right:h.left,top:t.top}:t,1==l.nodeType&&e&&(s=d+(t.left>=(h.left+h.right)/2?1:0));continue}}else h.top>t.top&&!r&&h.left<=t.left&&h.right>=t.left&&(r=l,o={left:Math.max(h.left,Math.min(h.right,t.left)),top:h.top});!n&&(t.left>=h.right&&t.top>=h.top||t.left>=h.left&&t.top>=h.bottom)&&(s=d+1)}}return!n&&r&&(n=r,i=o,a=0),n&&3==n.nodeType?function(e,t){let n=e.nodeValue.length,i=document.createRange();for(let r=0;r<n;r++){i.setEnd(e,r+1),i.setStart(e,r);let n=sh(i,1);if(n.top!=n.bottom&&ih(t,n))return{node:e,offset:r+(t.left>=(n.left+n.right)/2?1:0)}}return{node:e,offset:0}}(n,i):!n||a&&1==n.nodeType?{node:e,offset:s}:nh(n,i)}function ih(e,t){return e.left>=t.left-1&&e.left<=t.right+1&&e.top>=t.top-1&&e.top<=t.bottom+1}function rh(e,t,n){let i=e.childNodes.length;if(i&&n.top<n.bottom)for(let r=Math.max(0,Math.min(i-1,Math.floor(i*(t.top-n.top)/(n.bottom-n.top))-2)),o=r;;){let n=e.childNodes[o];if(1==n.nodeType){let e=n.getClientRects();for(let i=0;i<e.length;i++){let r=e[i];if(ih(t,r))return rh(n,t,r)}}if((o=(o+1)%i)==r)break}return e}function oh(e,t){let n,i=e.dom.ownerDocument,r=0,o=function(e,t,n){if(e.caretPositionFromPoint)try{let i=e.caretPositionFromPoint(t,n);if(i)return{node:i.offsetNode,offset:i.offset}}catch(i){}if(e.caretRangeFromPoint){let i=e.caretRangeFromPoint(t,n);if(i)return{node:i.startContainer,offset:i.startOffset}}}(i,t.left,t.top);o&&({node:n,offset:r}=o);let a,s=(e.root.elementFromPoint?e.root:i).elementFromPoint(t.left,t.top);if(!s||!e.dom.contains(1!=s.nodeType?s.parentNode:s)){let n=e.dom.getBoundingClientRect();if(!ih(t,n))return null;if(s=rh(e.dom,t,n),!s)return null}if(Bp)for(let u=s;n&&u;u=Ip(u))u.draggable&&(n=void 0);if(s=function(e,t){let n=e.parentNode;return n&&/^li$/i.test(n.nodeName)&&t.left<e.getBoundingClientRect().left?n:e}(s,t),n){if(Gp&&1==n.nodeType&&(r=Math.min(r,n.childNodes.length),r<n.childNodes.length)){let e,i=n.childNodes[r];"IMG"==i.nodeName&&(e=i.getBoundingClientRect()).right<=t.left&&e.bottom>t.top&&r++}n==e.dom&&r==n.childNodes.length-1&&1==n.lastChild.nodeType&&t.top>n.lastChild.getBoundingClientRect().bottom?a=e.state.doc.content.size:0!=r&&1==n.nodeType&&"BR"==n.childNodes[r-1].nodeName||(a=function(e,t,n,i){let r=-1;for(let o=t,a=!1;o!=e.dom;){let t=e.docView.nearestDesc(o,!0);if(!t)return null;if(1==t.dom.nodeType&&(t.node.isBlock&&t.parent&&!a||!t.contentDOM)){let e=t.dom.getBoundingClientRect();if(t.node.isBlock&&t.parent&&!a&&(a=!0,e.left>i.left||e.top>i.top?r=t.posBefore:(e.right<i.left||e.bottom<i.top)&&(r=t.posAfter)),!t.contentDOM&&r<0)return(t.node.isBlock?i.top<(e.top+e.bottom)/2:i.left<(e.left+e.right)/2)?t.posBefore:t.posAfter}o=t.dom.parentNode}return r>-1?r:e.docView.posFromDOM(t,n,-1)}(e,n,r,t))}null==a&&(a=function(e,t,n){let{node:i,offset:r}=nh(t,n),o=-1;if(1==i.nodeType&&!i.firstChild){let e=i.getBoundingClientRect();o=e.left!=e.right&&n.left>(e.left+e.right)/2?1:-1}return e.docView.posFromDOM(i,r,o)}(e,s,t));let c=e.docView.nearestDesc(s,!0);return{pos:a,inside:c?c.posAtStart-c.border:-1}}function ah(e){return e.top<e.bottom||e.left<e.right}function sh(e,t){let n=e.getClientRects();if(n.length){let e=n[t<0?0:n.length-1];if(ah(e))return e}return Array.prototype.find.call(n,ah)||e.getBoundingClientRect()}const ch=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function uh(e,t,n){let{node:i,offset:r,atom:o}=e.docView.domFromPos(t,n<0?-1:1),a=Wp||Gp;if(3==i.nodeType){if(!a||!ch.test(i.nodeValue)&&(n<0?r:r!=i.nodeValue.length)){let e=r,t=r,o=n<0?1:-1;return n<0&&!r?(t++,o=-1):n>=0&&r==i.nodeValue.length?(e--,o=1):n<0?e--:t++,lh(sh(Tp(i,e,t),o),o<0)}{let e=sh(Tp(i,r,r),n);if(Gp&&r&&/\s/.test(i.nodeValue[r-1])&&r<i.nodeValue.length){let t=sh(Tp(i,r-1,r-1),-1);if(t.top==e.top){let n=sh(Tp(i,r,r+1),-1);if(n.top!=e.top)return lh(n,n.left<t.left)}}return e}}if(!e.state.doc.resolve(t-(o||0)).parent.inlineContent){if(null==o&&r&&(n<0||r==kp(i))){let e=i.childNodes[r-1];if(1==e.nodeType)return dh(e.getBoundingClientRect(),!1)}if(null==o&&r<kp(i)){let e=i.childNodes[r];if(1==e.nodeType)return dh(e.getBoundingClientRect(),!0)}return dh(i.getBoundingClientRect(),n>=0)}if(null==o&&r&&(n<0||r==kp(i))){let e=i.childNodes[r-1],t=3==e.nodeType?Tp(e,kp(e)-(a?0:1)):1!=e.nodeType||"BR"==e.nodeName&&e.nextSibling?null:e;if(t)return lh(sh(t,1),!1)}if(null==o&&r<kp(i)){let e=i.childNodes[r];for(;e.pmViewDesc&&e.pmViewDesc.ignoreForCoords;)e=e.nextSibling;let t=e?3==e.nodeType?Tp(e,0,a?0:1):1==e.nodeType?e:null:null;if(t)return lh(sh(t,-1),!0)}return lh(sh(3==i.nodeType?Tp(i):i,-n),n>=0)}function lh(e,t){if(0==e.width)return e;let n=t?e.left:e.right;return{top:e.top,bottom:e.bottom,left:n,right:n}}function dh(e,t){if(0==e.height)return e;let n=t?e.top:e.bottom;return{top:n,bottom:n,left:e.left,right:e.right}}function ph(e,t,n){let i=e.state,r=e.root.activeElement;i!=t&&e.updateState(t),r!=e.dom&&e.focus();try{return n()}finally{i!=t&&e.updateState(i),r!=e.dom&&r&&r.focus()}}const hh=/[\u0590-\u08ac]/;let fh=null,gh=null,mh=!1;function vh(e,t,n){return fh==t&&gh==n?mh:(fh=t,gh=n,mh="up"==n||"down"==n?function(e,t,n){let i=t.selection,r="up"==n?i.$from:i.$to;return ph(e,t,(()=>{let{node:t}=e.docView.domFromPos(r.pos,"up"==n?-1:1);for(;;){let n=e.docView.nearestDesc(t,!0);if(!n)break;if(n.node.isBlock){t=n.contentDOM||n.dom;break}t=n.dom.parentNode}let i=uh(e,r.pos,1);for(let e=t.firstChild;e;e=e.nextSibling){let t;if(1==e.nodeType)t=e.getClientRects();else{if(3!=e.nodeType)continue;t=Tp(e,0,e.nodeValue.length).getClientRects()}for(let e=0;e<t.length;e++){let r=t[e];if(r.bottom>r.top+1&&("up"==n?i.top-r.top>2*(r.bottom-i.top):r.bottom-i.bottom>2*(i.bottom-r.top)))return!1}}return!0}))}(e,t,n):function(e,t,n){let{$head:i}=t.selection;if(!i.parent.isTextblock)return!1;let r=i.parentOffset,o=!r,a=r==i.parent.content.size,s=e.domSelection();return hh.test(i.parent.textContent)&&s.modify?ph(e,t,(()=>{let{focusNode:t,focusOffset:r,anchorNode:o,anchorOffset:a}=e.domSelectionRange(),c=s.caretBidiLevel;s.modify("move",n,"character");let u=i.depth?e.docView.domAfterPos(i.before()):e.dom,{focusNode:l,focusOffset:d}=e.domSelectionRange(),p=l&&!u.contains(1==l.nodeType?l:l.parentNode)||t==l&&r==d;try{s.collapse(o,a),t&&(t!=o||r!=a)&&s.extend&&s.extend(t,r)}catch(h){}return null!=c&&(s.caretBidiLevel=c),p})):"left"==n||"backward"==n?o:a}(e,t,n))}class _h{constructor(e,t,n,i){this.parent=e,this.children=t,this.dom=n,this.contentDOM=i,this.dirty=0,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,n=this.posAtStart;;t++){let i=this.children[t];if(i==e)return n;n+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,n){if(this.contentDOM&&this.contentDOM.contains(1==e.nodeType?e:e.parentNode)){if(n<0){let n,i;if(e==this.contentDOM)n=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.previousSibling}for(;n&&(!(i=n.pmViewDesc)||i.parent!=this);)n=n.previousSibling;return n?this.posBeforeChild(i)+i.size:this.posAtStart}{let n,i;if(e==this.contentDOM)n=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.nextSibling}for(;n&&(!(i=n.pmViewDesc)||i.parent!=this);)n=n.nextSibling;return n?this.posBeforeChild(i):this.posAtEnd}}let i;if(e==this.dom&&this.contentDOM)i=t>yp(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=2&e.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==t)for(let t=e;;t=t.parentNode){if(t==this.dom){i=!1;break}if(t.previousSibling)break}if(null==i&&t==e.childNodes.length)for(let t=e;;t=t.parentNode){if(t==this.dom){i=!0;break}if(t.nextSibling)break}}return(null==i?n>0:i)?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let n=!0,i=e;i;i=i.parentNode){let r,o=this.getDesc(i);if(o&&(!t||o.node)){if(!n||!(r=o.nodeDOM)||(1==r.nodeType?r.contains(1==e.nodeType?e:e.parentNode):r==e))return o;n=!1}}}getDesc(e){let t=e.pmViewDesc;for(let n=t;n;n=n.parent)if(n==this)return t}posFromDOM(e,t,n){for(let i=e;i;i=i.parentNode){let r=this.getDesc(i);if(r)return r.localPosFromDOM(e,t,n)}return-1}descAt(e){for(let t=0,n=0;t<this.children.length;t++){let i=this.children[t],r=n+i.size;if(n==e&&r!=n){for(;!i.border&&i.children.length;)i=i.children[0];return i}if(e<r)return i.descAt(e-n-i.border);n=r}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,i=0;for(let r=0;n<this.children.length;n++){let t=this.children[n],o=r+t.size;if(o>e||t instanceof Eh){i=e-r;break}r=o}if(i)return this.children[n].domFromPos(i-this.children[n].border,t);for(let r;n&&!(r=this.children[n-1]).size&&r instanceof yh&&r.side>=0;n--);if(t<=0){let e,i=!0;for(;e=n?this.children[n-1]:null,e&&e.dom.parentNode!=this.contentDOM;n--,i=!1);return e&&t&&i&&!e.border&&!e.domAtom?e.domFromPos(e.size,t):{node:this.contentDOM,offset:e?yp(e.dom)+1:0}}{let e,i=!0;for(;e=n<this.children.length?this.children[n]:null,e&&e.dom.parentNode!=this.contentDOM;n++,i=!1);return e&&i&&!e.border&&!e.domAtom?e.domFromPos(0,t):{node:this.contentDOM,offset:e?yp(e.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,n=0){if(0==this.children.length)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,r=-1;for(let o=n,a=0;;a++){let n=this.children[a],s=o+n.size;if(-1==i&&e<=s){let r=o+n.border;if(e>=r&&t<=s-n.border&&n.node&&n.contentDOM&&this.contentDOM.contains(n.contentDOM))return n.parseRange(e,t,r);e=o;for(let t=a;t>0;t--){let n=this.children[t-1];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(1)){i=yp(n.dom)+1;break}e-=n.size}-1==i&&(i=0)}if(i>-1&&(s>t||a==this.children.length-1)){t=s;for(let e=a+1;e<this.children.length;e++){let n=this.children[e];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(-1)){r=yp(n.dom);break}t+=n.size}-1==r&&(r=this.contentDOM.childNodes.length);break}o=s}return{node:this.contentDOM,from:e,to:t,fromOffset:i,toOffset:r}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return 0==t.size||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:n}=this.domFromPos(e,0);if(1!=t.nodeType||n==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[n]}setSelection(e,t,n,i=!1){let r=Math.min(e,t),o=Math.max(e,t);for(let p=0,h=0;p<this.children.length;p++){let a=this.children[p],s=h+a.size;if(r>h&&o<s)return a.setSelection(e-h-a.border,t-h-a.border,n,i);h=s}let a=this.domFromPos(e,e?-1:1),s=t==e?a:this.domFromPos(t,t?-1:1),c=n.getSelection(),u=!1;if((Gp||Bp)&&e==t){let{node:e,offset:t}=a;if(3==e.nodeType){if(u=!(!t||"\n"!=e.nodeValue[t-1]),u&&t==e.nodeValue.length)for(let n,i=e;i;i=i.parentNode){if(n=i.nextSibling){"BR"==n.nodeName&&(a=s={node:n.parentNode,offset:yp(n)+1});break}let e=i.pmViewDesc;if(e&&e.node&&e.node.isBlock)break}}else{let n=e.childNodes[t-1];u=n&&("BR"==n.nodeName||"false"==n.contentEditable)}}if(Gp&&c.focusNode&&c.focusNode!=s.node&&1==c.focusNode.nodeType){let e=c.focusNode.childNodes[c.focusOffset];e&&"false"==e.contentEditable&&(i=!0)}if(!(i||u&&Bp)&&Cp(a.node,a.offset,c.anchorNode,c.anchorOffset)&&Cp(s.node,s.offset,c.focusNode,c.focusOffset))return;let l=!1;if((c.extend||e==t)&&!u){c.collapse(a.node,a.offset);try{e!=t&&c.extend(s.node,s.offset),l=!0}catch(d){}}if(!l){if(e>t){let e=a;a=s,s=e}let n=document.createRange();n.setEnd(s.node,s.offset),n.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(n)}}ignoreMutation(e){return!this.contentDOM&&"selection"!=e.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let n=0,i=0;i<this.children.length;i++){let r=this.children[i],o=n+r.size;if(n==o?e<=o&&t>=n:e<o&&t>n){let i=n+r.border,a=o-r.border;if(e>=i&&t<=a)return this.dirty=e==n||t==o?2:1,void(e!=i||t!=a||!r.contentLost&&r.dom.parentNode==this.contentDOM?r.markDirty(e-i,t-i):r.dirty=3);r.dirty=r.dom!=r.contentDOM||r.dom.parentNode!=this.contentDOM||r.children.length?3:2}n=o}this.dirty=2}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let n=1==e?2:1;t.dirty<n&&(t.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}}class yh extends _h{constructor(e,t,n,i){let r,o=t.type.toDOM;if("function"==typeof o&&(o=o(n,(()=>r?r.parent?r.parent.posBeforeChild(r):void 0:i))),!t.type.spec.raw){if(1!=o.nodeType){let e=document.createElement("span");e.appendChild(o),o=e}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=t,this.widget=t,r=this}matchesWidget(e){return 0==this.dirty&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return!!t&&t(e)}ignoreMutation(e){return"selection"!=e.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class Ih extends _h{constructor(e,t,n,i){super(e,[],t,null),this.textDOM=n,this.text=i}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return"characterData"===e.type&&e.target.nodeValue==e.oldValue}}class Mh extends _h{constructor(e,t,n,i){super(e,[],n,i),this.mark=t}static create(e,t,n,i){let r=i.nodeViews[t.type.name],o=r&&r(t,i,n);return o&&o.dom||(o=sd.renderSpec(document,t.type.spec.toDOM(t,n))),new Mh(e,t,o.dom,o.contentDOM||o.dom)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM||void 0}}matchesMark(e){return 3!=this.dirty&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),0!=this.dirty){let e=this.parent;for(;!e.node;)e=e.parent;e.dirty<this.dirty&&(e.dirty=this.dirty),this.dirty=0}}slice(e,t,n){let i=Mh.create(this.parent,this.mark,!0,n),r=this.children,o=this.size;t<o&&(r=Gh(r,t,o,n)),e>0&&(r=Gh(r,0,e,n));for(let a=0;a<r.length;a++)r[a].parent=i;return i.children=r,i}}class Th extends _h{constructor(e,t,n,i,r,o,a,s,c){super(e,[],r,o),this.node=t,this.outerDeco=n,this.innerDeco=i,this.nodeDOM=a}static create(e,t,n,i,r,o){let a,s=r.nodeViews[t.type.name],c=s&&s(t,r,(()=>a?a.parent?a.parent.posBeforeChild(a):void 0:o),n,i),u=c&&c.dom,l=c&&c.contentDOM;if(t.isText)if(u){if(3!=u.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else u=document.createTextNode(t.text);else u||({dom:u,contentDOM:l}=sd.renderSpec(document,t.type.spec.toDOM(t)));l||t.isText||"BR"==u.nodeName||(u.hasAttribute("contenteditable")||(u.contentEditable="false"),t.type.spec.draggable&&(u.draggable=!0));let d=u;return u=Oh(u,n,t),c?a=new kh(e,t,n,i,u,l||null,d,c,r,o+1):t.isText?new Sh(e,t,n,i,u,d,r):new Th(e,t,n,i,u,l||null,d,r,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(e.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let t=this.children.length-1;t>=0;t--){let n=this.children[t];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>sl.empty)}else e.contentElement=this.contentDOM;else e.getContent=()=>this.node.content;return e}matchesNode(e,t,n){return 0==this.dirty&&e.eq(this.node)&&Nh(t,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let n=this.node.inlineContent,i=t,r=e.composing?this.localCompositionInfo(e,t):null,o=r&&r.pos>-1?r:null,a=r&&r.pos<0,s=new Uh(this,o&&o.node,e);!function(e,t,n,i){let r=t.locals(e),o=0;if(0==r.length){for(let n=0;n<e.childCount;n++){let a=e.child(n);i(a,r,t.forChild(o,a),n),o+=a.nodeSize}return}let a=0,s=[],c=null;for(let u=0;;){if(a<r.length&&r[a].to==o){let e,t=r[a++];for(;a<r.length&&r[a].to==o;)(e||(e=[t])).push(r[a++]);if(e){e.sort(xh);for(let t=0;t<e.length;t++)n(e[t],u,!!c)}else n(t,u,!!c)}let l,d;if(c)d=-1,l=c,c=null;else{if(!(u<e.childCount))break;d=u,l=e.child(u++)}for(let e=0;e<s.length;e++)s[e].to<=o&&s.splice(e--,1);for(;a<r.length&&r[a].from<=o&&r[a].to>o;)s.push(r[a++]);let p=o+l.nodeSize;if(l.isText){let e=p;a<r.length&&r[a].from<e&&(e=r[a].from);for(let t=0;t<s.length;t++)s[t].to<e&&(e=s[t].to);e<p&&(c=l.cut(e-o),l=l.cut(0,e-o),p=e,d=-1)}i(l,l.isInline&&!l.isLeaf?s.filter((e=>!e.inline)):s.slice(),t.forChild(o,l),d),o=p}}(this.node,this.innerDeco,((t,r,o)=>{t.spec.marks?s.syncToMarks(t.spec.marks,n,e):t.type.side>=0&&!o&&s.syncToMarks(r==this.node.childCount?dl.none:this.node.child(r).marks,n,e),s.placeWidget(t,e,i)}),((t,o,c,u)=>{let l;s.syncToMarks(t.marks,n,e),s.findNodeMatch(t,o,c,u)||a&&e.state.selection.from>i&&e.state.selection.to<i+t.nodeSize&&(l=s.findIndexWithChild(r.node))>-1&&s.updateNodeAt(t,o,c,l,e)||s.updateNextNode(t,o,c,e,u,i)||s.addNode(t,o,c,e,i),i+=t.nodeSize})),s.syncToMarks([],n,e),this.node.isTextblock&&s.addTextblockHacks(),s.destroyRest(),(s.changed||2==this.dirty)&&(o&&this.protectLocalComposition(e,o),bh(this.contentDOM,this.children,e),Hp&&function(e){if("UL"==e.nodeName||"OL"==e.nodeName){let t=e.style.cssText;e.style.cssText=t+"; list-style: square !important",window.getComputedStyle(e).listStyle,e.style.cssText=t}}(this.dom))}localCompositionInfo(e,t){let{from:n,to:i}=e.state.selection;if(!(e.state.selection instanceof ep)||n<t||i>t+this.node.content.size)return null;let r=e.domSelectionRange(),o=function(e,t){for(;;){if(3==e.nodeType)return e;if(1==e.nodeType&&t>0){if(e.childNodes.length>t&&3==e.childNodes[t].nodeType)return e.childNodes[t];t=kp(e=e.childNodes[t-1])}else{if(!(1==e.nodeType&&t<e.childNodes.length))return null;e=e.childNodes[t],t=0}}}(r.focusNode,r.focusOffset);if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let e=o.nodeValue,r=function(e,t,n,i){for(let r=0,o=0;r<e.childCount&&o<=i;){let a=e.child(r++),s=o;if(o+=a.nodeSize,!a.isText)continue;let c=a.text;for(;r<e.childCount;){let t=e.child(r++);if(o+=t.nodeSize,!t.isText)break;c+=t.text}if(o>=n){let e=s<i?c.lastIndexOf(t,i-s-1):-1;if(e>=0&&e+t.length+s>=n)return s+e;if(n==i&&c.length>=i+t.length-s&&c.slice(i-s,i-s+t.length)==t)return i}}return-1}(this.node.content,e,n-t,i-t);return r<0?null:{node:o,pos:r,text:e}}return{node:o,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:n,text:i}){if(this.getDesc(t))return;let r=t;for(;r.parentNode!=this.contentDOM;r=r.parentNode){for(;r.previousSibling;)r.parentNode.removeChild(r.previousSibling);for(;r.nextSibling;)r.parentNode.removeChild(r.nextSibling);r.pmViewDesc&&(r.pmViewDesc=void 0)}let o=new Ih(this,r,t,i);e.input.compositionNodes.push(o),this.children=Gh(this.children,n,n+i.length,e,o)}update(e,t,n,i){return!(3==this.dirty||!e.sameMarkup(this.node))&&(this.updateInner(e,t,n,i),!0)}updateInner(e,t,n,i){this.updateOuterDeco(t),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=0}updateOuterDeco(e){if(Nh(e,this.outerDeco))return;let t=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=Rh(this.dom,this.nodeDOM,Ah(this.outerDeco,this.node,t),Ah(e,this.node,t)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)}deselectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}}function Ch(e,t,n,i,r){Oh(i,t,e);let o=new Th(void 0,e,t,n,i,i,i,r,0);return o.contentDOM&&o.updateChildren(r,0),o}class Sh extends Th{constructor(e,t,n,i,r,o,a){super(e,t,n,i,r,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,n,i){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!e.sameMarkup(this.node))&&(this.updateOuterDeco(t),0==this.dirty&&e.text==this.node.text||e.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=0,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,n){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,n)}ignoreMutation(e){return"characterData"!=e.type&&"selection"!=e.type}slice(e,t,n){let i=this.node.cut(e,t),r=document.createTextNode(i.text);return new Sh(this.parent,i,this.outerDeco,this.innerDeco,r,r,n)}markDirty(e,t){super.markDirty(e,t),this.dom==this.nodeDOM||0!=e&&t!=this.nodeDOM.nodeValue.length||(this.dirty=3)}get domAtom(){return!1}}class Eh extends _h{parseRule(){return{ignore:!0}}matchesHack(e){return 0==this.dirty&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class kh extends Th{constructor(e,t,n,i,r,o,a,s,c,u){super(e,t,n,i,r,o,a,c,u),this.spec=s}update(e,t,n,i){if(3==this.dirty)return!1;if(this.spec.update){let r=this.spec.update(e,t,n);return r&&this.updateInner(e,t,n,i),r}return!(!this.contentDOM&&!e.isLeaf)&&super.update(e,t,n,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,n,i){this.spec.setSelection?this.spec.setSelection(e,t,n):super.setSelection(e,t,n,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return!!this.spec.stopEvent&&this.spec.stopEvent(e)}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function bh(e,t,n){let i=e.firstChild,r=!1;for(let o=0;o<t.length;o++){let a=t[o],s=a.dom;if(s.parentNode==e){for(;s!=i;)i=Ph(i),r=!0;i=i.nextSibling}else r=!0,e.insertBefore(s,i);if(a instanceof Mh){let t=i?i.previousSibling:e.lastChild;bh(a.contentDOM,a.children,n),i=t?t.nextSibling:e.firstChild}}for(;i;)i=Ph(i),r=!0;r&&n.trackWrites==e&&(n.trackWrites=null)}const Dh=function(e){e&&(this.nodeName=e)};Dh.prototype=Object.create(null);const wh=[new Dh];function Ah(e,t,n){if(0==e.length)return wh;let i=n?wh[0]:new Dh,r=[i];for(let o=0;o<e.length;o++){let a=e[o].type.attrs;if(a){a.nodeName&&r.push(i=new Dh(a.nodeName));for(let e in a){let o=a[e];null!=o&&(n&&1==r.length&&r.push(i=new Dh(t.isInline?"span":"div")),"class"==e?i.class=(i.class?i.class+" ":"")+o:"style"==e?i.style=(i.style?i.style+";":"")+o:"nodeName"!=e&&(i[e]=o))}}}return r}function Rh(e,t,n,i){if(n==wh&&i==wh)return t;let r=t;for(let o=0;o<i.length;o++){let t=i[o],a=n[o];if(o){let n;a&&a.nodeName==t.nodeName&&r!=e&&(n=r.parentNode)&&n.nodeName.toLowerCase()==t.nodeName||(n=document.createElement(t.nodeName),n.pmIsDeco=!0,n.appendChild(r),a=wh[0]),r=n}Lh(r,a||wh[0],t)}return r}function Lh(e,t,n){for(let i in t)"class"==i||"style"==i||"nodeName"==i||i in n||e.removeAttribute(i);for(let i in n)"class"!=i&&"style"!=i&&"nodeName"!=i&&n[i]!=t[i]&&e.setAttribute(i,n[i]);if(t.class!=n.class){let i=t.class?t.class.split(" ").filter(Boolean):[],r=n.class?n.class.split(" ").filter(Boolean):[];for(let t=0;t<i.length;t++)-1==r.indexOf(i[t])&&e.classList.remove(i[t]);for(let t=0;t<r.length;t++)-1==i.indexOf(r[t])&&e.classList.add(r[t]);0==e.classList.length&&e.removeAttribute("class")}if(t.style!=n.style){if(t.style){let n,i=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;for(;n=i.exec(t.style);)e.style.removeProperty(n[1])}n.style&&(e.style.cssText+=n.style)}}function Oh(e,t,n){return Rh(e,e,wh,Ah(t,n,1!=e.nodeType))}function Nh(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].type.eq(t[n].type))return!1;return!0}function Ph(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}class Uh{constructor(e,t,n){this.lock=t,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=function(e,t){let n=t,i=n.children.length,r=e.childCount,o=new Map,a=[];e:for(;r>0;){let s;for(;;)if(i){let e=n.children[i-1];if(!(e instanceof Mh)){s=e,i--;break}n=e,i=e.children.length}else{if(n==t)break e;i=n.parent.children.indexOf(n),n=n.parent}let c=s.node;if(c){if(c!=e.child(r-1))break;--r,o.set(s,r),a.push(s)}}return{index:r,matched:o,matches:a.reverse()}}(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let n=e;n<t;n++)this.top.children[n].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,n){let i=0,r=this.stack.length>>1,o=Math.min(r,e.length);for(;i<o&&(i==r-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&!1!==e[i].type.spec.spanning;)i++;for(;i<r;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),r--;for(;r<e.length;){this.stack.push(this.top,this.index+1);let i=-1;for(let t=this.index;t<Math.min(this.index+3,this.top.children.length);t++){let n=this.top.children[t];if(n.matchesMark(e[r])&&!this.isLocked(n.dom)){i=t;break}}if(i>-1)i>this.index&&(this.changed=!0,this.destroyBetween(this.index,i)),this.top=this.top.children[this.index];else{let i=Mh.create(this.top,e[r],t,n);this.top.children.splice(this.index,0,i),this.top=i,this.changed=!0}this.index=0,r++}}findNodeMatch(e,t,n,i){let r,o=-1;if(i>=this.preMatch.index&&(r=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&r.matchesNode(e,t,n))o=this.top.children.indexOf(r,this.index);else for(let a=this.index,s=Math.min(this.top.children.length,a+5);a<s;a++){let i=this.top.children[a];if(i.matchesNode(e,t,n)&&!this.preMatch.matched.has(i)){o=a;break}}return!(o<0)&&(this.destroyBetween(this.index,o),this.index++,!0)}updateNodeAt(e,t,n,i,r){let o=this.top.children[i];return 3==o.dirty&&o.dom==o.contentDOM&&(o.dirty=2),!!o.update(e,t,n,r)&&(this.destroyBetween(this.index,i),this.index++,!0)}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let t=e.pmViewDesc;if(t)for(let e=this.index;e<this.top.children.length;e++)if(this.top.children[e]==t)return e;return-1}e=t}}updateNextNode(e,t,n,i,r,o){for(let a=this.index;a<this.top.children.length;a++){let s=this.top.children[a];if(s instanceof Th){let c=this.preMatch.matched.get(s);if(null!=c&&c!=r)return!1;let u,l=s.dom,d=this.isLocked(l)&&!(e.isText&&s.node&&s.node.isText&&s.nodeDOM.nodeValue==e.text&&3!=s.dirty&&Nh(t,s.outerDeco));if(!d&&s.update(e,t,n,i))return this.destroyBetween(this.index,a),s.dom!=l&&(this.changed=!0),this.index++,!0;if(!d&&(u=this.recreateWrapper(s,e,t,n,i,o)))return this.top.children[this.index]=u,u.dirty=2,u.updateChildren(i,o+1),u.dirty=0,this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,n,i,r,o){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content))return null;let a=Th.create(this.top,t,n,i,r,o);if(!a.contentDOM)return null;a.children=e.children,e.children=[];for(let s of a.children)s.parent=a;return a}addNode(e,t,n,i,r){let o=Th.create(this.top,e,t,n,i,r);o.contentDOM&&o.updateChildren(i,r+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,t,n){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(!i||!i.matchesWidget(e)||e!=i.widget&&i.widget.type.toDOM.parentNode){let i=new yh(this.top,e,t,n);this.top.children.splice(this.index++,0,i),this.changed=!0}else this.index++}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof Mh;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof Sh)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Bp||Vp)&&e&&"false"==e.dom.contentEditable&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);"IMG"==e&&(n.className="ProseMirror-separator",n.alt=""),"BR"==e&&(n.className="ProseMirror-trailingBreak");let i=new Eh(this.top,[],n,null);t!=this.top?t.children.push(i):t.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||1==e.nodeType&&e.contains(this.lock.parentNode))}}function xh(e,t){return e.type.side-t.type.side}function Gh(e,t,n,i,r){let o=[];for(let a=0,s=0;a<e.length;a++){let c=e[a],u=s,l=s+=c.size;u>=n||l<=t?o.push(c):(u<t&&o.push(c.slice(0,t-u,i)),r&&(o.push(r),r=void 0),l>n&&o.push(c.slice(n-u,c.size,i)))}return o}function Fh(e,t=null){let n=e.domSelectionRange(),i=e.state.doc;if(!n.focusNode)return null;let r=e.docView.nearestDesc(n.focusNode),o=r&&0==r.size,a=e.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(a<0)return null;let s,c,u=i.resolve(a);if(Dp(n)){for(s=u;r&&!r.node;)r=r.parent;let e=r.node;if(r&&e.isAtom&&np.isSelectable(e)&&r.parent&&(!e.isInline||!function(e,t,n){for(let i=0==t,r=t==kp(e);i||r;){if(e==n)return!0;let t=yp(e);if(!(e=e.parentNode))return!1;i=i&&0==t,r=r&&t==kp(e)}}(n.focusNode,n.focusOffset,r.dom))){let e=r.posBefore;c=new np(a==e?u:i.resolve(e))}}else{let t=e.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(t<0)return null;s=i.resolve(t)}if(!c){c=Yh(e,s,u,"pointer"==t||e.state.selection.head<u.pos&&!o?1:-1)}return c}function Vh(e){return e.editable?e.hasFocus():Jh(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function qh(e,t=!1){let n=e.state.selection;if(zh(e,n),Vh(e)){if(!t&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&Vp){let t=e.domSelectionRange(),n=e.domObserver.currentSelection;if(t.anchorNode&&n.anchorNode&&Cp(t.anchorNode,t.anchorOffset,n.anchorNode,n.anchorOffset))return e.input.mouseDown.delayedSelectionSync=!0,void e.domObserver.setCurSelection()}if(e.domObserver.disconnectSelection(),e.cursorWrapper)!function(e){let t=e.domSelection(),n=document.createRange(),i=e.cursorWrapper.dom,r="IMG"==i.nodeName;r?n.setEnd(i.parentNode,yp(i)+1):n.setEnd(i,0);n.collapse(!1),t.removeAllRanges(),t.addRange(n),!r&&!e.state.selection.visible&&Up&&xp<=11&&(i.disabled=!0,i.disabled=!1)}(e);else{let i,r,{anchor:o,head:a}=n;!Bh||n instanceof ep||(n.$from.parent.inlineContent||(i=Hh(e,n.from)),n.empty||n.$from.parent.inlineContent||(r=Hh(e,n.to))),e.docView.setSelection(o,a,e.root,t),Bh&&(i&&Kh(i),r&&Kh(r)),n.visible?e.dom.classList.remove("ProseMirror-hideselection"):(e.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(e){let t=e.dom.ownerDocument;t.removeEventListener("selectionchange",e.input.hideSelectionGuard);let n=e.domSelectionRange(),i=n.anchorNode,r=n.anchorOffset;t.addEventListener("selectionchange",e.input.hideSelectionGuard=()=>{n.anchorNode==i&&n.anchorOffset==r||(t.removeEventListener("selectionchange",e.input.hideSelectionGuard),setTimeout((()=>{Vh(e)&&!e.state.selection.visible||e.dom.classList.remove("ProseMirror-hideselection")}),20))})}(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}const Bh=Bp||Vp&&qp<63;function Hh(e,t){let{node:n,offset:i}=e.docView.domFromPos(t,0),r=i<n.childNodes.length?n.childNodes[i]:null,o=i?n.childNodes[i-1]:null;if(Bp&&r&&"false"==r.contentEditable)return jh(r);if(!(r&&"false"!=r.contentEditable||o&&"false"!=o.contentEditable)){if(r)return jh(r);if(o)return jh(o)}}function jh(e){return e.contentEditable="true",Bp&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function Kh(e){e.contentEditable="false",e.wasDraggable&&(e.draggable=!0,e.wasDraggable=null)}function zh(e,t){if(t instanceof np){let n=e.docView.descAt(t.from);n!=e.lastSelectedViewDesc&&(Wh(e),n&&n.selectNode(),e.lastSelectedViewDesc=n)}else Wh(e)}function Wh(e){e.lastSelectedViewDesc&&(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),e.lastSelectedViewDesc=void 0)}function Yh(e,t,n,i){return e.someProp("createSelectionBetween",(i=>i(e,t,n)))||ep.between(t,n,i)}function $h(e){return!(e.editable&&!e.hasFocus())&&Jh(e)}function Jh(e){let t=e.domSelectionRange();if(!t.anchorNode)return!1;try{return e.dom.contains(3==t.anchorNode.nodeType?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(3==t.focusNode.nodeType?t.focusNode.parentNode:t.focusNode))}catch(n){return!1}}function Xh(e,t){let{$anchor:n,$head:i}=e.selection,r=t>0?n.max(i):n.min(i),o=r.parent.inlineContent?r.depth?e.doc.resolve(t>0?r.after():r.before()):null:r;return o&&Jd.findFrom(o,t)}function Zh(e,t){return e.dispatch(e.state.tr.setSelection(t).scrollIntoView()),!0}function Qh(e,t,n){let i=e.state.selection;if(!(i instanceof ep)){if(i instanceof np&&i.node.isInline)return Zh(e,new ep(t>0?i.$to:i.$from));{let n=Xh(e.state,t);return!!n&&Zh(e,n)}}if(!i.empty||n.indexOf("s")>-1)return!1;if(e.endOfTextblock(t>0?"forward":"backward")){let n=Xh(e.state,t);return!!(n&&n instanceof np)&&Zh(e,n)}if(!(jp&&n.indexOf("m")>-1)){let n,r=i.$head,o=r.textOffset?null:t<0?r.nodeBefore:r.nodeAfter;if(!o||o.isText)return!1;let a=t<0?r.pos-o.nodeSize:r.pos;return!!(o.isAtom||(n=e.docView.descAt(a))&&!n.contentDOM)&&(np.isSelectable(o)?Zh(e,new np(t<0?e.state.doc.resolve(r.pos-o.nodeSize):r)):!!Wp&&Zh(e,new ep(e.state.doc.resolve(t<0?a:a+o.nodeSize))))}}function ef(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function tf(e){let t=e.pmViewDesc;return t&&0==t.size&&(e.nextSibling||"BR"!=e.nodeName)}function nf(e,t){return t<0?function(e){let t=e.domSelectionRange(),n=t.focusNode,i=t.focusOffset;if(!n)return;let r,o,a=!1;Gp&&1==n.nodeType&&i<ef(n)&&tf(n.childNodes[i])&&(a=!0);for(;;)if(i>0){if(1!=n.nodeType)break;{let e=n.childNodes[i-1];if(tf(e))r=n,o=--i;else{if(3!=e.nodeType)break;n=e,i=n.nodeValue.length}}}else{if(of(n))break;{let t=n.previousSibling;for(;t&&tf(t);)r=n.parentNode,o=yp(t),t=t.previousSibling;if(t)n=t,i=ef(n);else{if(n=n.parentNode,n==e.dom)break;i=0}}}a?af(e,n,i):r&&af(e,r,o)}(e):rf(e)}function rf(e){let t=e.domSelectionRange(),n=t.focusNode,i=t.focusOffset;if(!n)return;let r,o,a=ef(n);for(;;)if(i<a){if(1!=n.nodeType)break;if(!tf(n.childNodes[i]))break;r=n,o=++i}else{if(of(n))break;{let t=n.nextSibling;for(;t&&tf(t);)r=t.parentNode,o=yp(t)+1,t=t.nextSibling;if(t)n=t,i=0,a=ef(n);else{if(n=n.parentNode,n==e.dom)break;i=a=0}}}r&&af(e,r,o)}function of(e){let t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function af(e,t,n){let i=e.domSelection();if(Dp(i)){let e=document.createRange();e.setEnd(t,n),e.setStart(t,n),i.removeAllRanges(),i.addRange(e)}else i.extend&&i.extend(t,n);e.domObserver.setCurSelection();let{state:r}=e;setTimeout((()=>{e.state==r&&qh(e)}),50)}function sf(e,t){let n=e.state.doc.resolve(t);if(!Vp&&!Kp&&n.parent.inlineContent){let i=e.coordsAtPos(t);if(t>n.start()){let n=e.coordsAtPos(t-1),r=(n.top+n.bottom)/2;if(r>i.top&&r<i.bottom&&Math.abs(n.left-i.left)>1)return n.left<i.left?"ltr":"rtl"}if(t<n.end()){let n=e.coordsAtPos(t+1),r=(n.top+n.bottom)/2;if(r>i.top&&r<i.bottom&&Math.abs(n.left-i.left)>1)return n.left>i.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(e.dom).direction?"rtl":"ltr"}function cf(e,t,n){let i=e.state.selection;if(i instanceof ep&&!i.empty||n.indexOf("s")>-1)return!1;if(jp&&n.indexOf("m")>-1)return!1;let{$from:r,$to:o}=i;if(!r.parent.inlineContent||e.endOfTextblock(t<0?"up":"down")){let n=Xh(e.state,t);if(n&&n instanceof np)return Zh(e,n)}if(!r.parent.inlineContent){let n=t<0?r:o,a=i instanceof rp?Jd.near(n,t):Jd.findFrom(n,t);return!!a&&Zh(e,a)}return!1}function uf(e,t){if(!(e.state.selection instanceof ep))return!0;let{$head:n,$anchor:i,empty:r}=e.state.selection;if(!n.sameParent(i))return!0;if(!r)return!1;if(e.endOfTextblock(t>0?"forward":"backward"))return!0;let o=!n.textOffset&&(t<0?n.nodeBefore:n.nodeAfter);if(o&&!o.isText){let i=e.state.tr;return t<0?i.delete(n.pos-o.nodeSize,n.pos):i.delete(n.pos,n.pos+o.nodeSize),e.dispatch(i),!0}return!1}function lf(e,t,n){e.domObserver.stop(),t.contentEditable=n,e.domObserver.start()}function df(e,t){let n=t.keyCode,i=function(e){let t="";return e.ctrlKey&&(t+="c"),e.metaKey&&(t+="m"),e.altKey&&(t+="a"),e.shiftKey&&(t+="s"),t}(t);if(8==n||jp&&72==n&&"c"==i)return uf(e,-1)||nf(e,-1);if(46==n||jp&&68==n&&"c"==i)return uf(e,1)||nf(e,1);if(13==n||27==n)return!0;if(37==n||jp&&66==n&&"c"==i){let t=37==n?"ltr"==sf(e,e.state.selection.from)?-1:1:-1;return Qh(e,t,i)||nf(e,t)}if(39==n||jp&&70==n&&"c"==i){let t=39==n?"ltr"==sf(e,e.state.selection.from)?1:-1:1;return Qh(e,t,i)||nf(e,t)}return 38==n||jp&&80==n&&"c"==i?cf(e,-1,i)||nf(e,-1):40==n||jp&&78==n&&"c"==i?function(e){if(!Bp||e.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:n}=e.domSelectionRange();if(t&&1==t.nodeType&&0==n&&t.firstChild&&"false"==t.firstChild.contentEditable){let n=t.firstChild;lf(e,n,"true"),setTimeout((()=>lf(e,n,"false")),20)}return!1}(e)||cf(e,1,i)||rf(e):i==(jp?"m":"c")&&(66==n||73==n||89==n||90==n)}function pf(e,t){e.someProp("transformCopied",(n=>{t=n(t,e)}));let n=[],{content:i,openStart:r,openEnd:o}=t;for(;r>1&&o>1&&1==i.childCount&&1==i.firstChild.childCount;){r--,o--;let e=i.firstChild;n.push(e.type.name,e.attrs!=e.type.defaultAttrs?e.attrs:null),i=e.content}let a=e.someProp("clipboardSerializer")||sd.fromSchema(e.state.schema),s=Tf(),c=s.createElement("div");c.appendChild(a.serializeFragment(i,{document:s}));let u,l=c.firstChild,d=0;for(;l&&1==l.nodeType&&(u=If[l.nodeName.toLowerCase()]);){for(let e=u.length-1;e>=0;e--){let t=s.createElement(u[e]);for(;c.firstChild;)t.appendChild(c.firstChild);c.appendChild(t),d++}l=c.firstChild}return l&&1==l.nodeType&&l.setAttribute("data-pm-slice",`${r} ${o}${d?` -${d}`:""} ${JSON.stringify(n)}`),{dom:c,text:e.someProp("clipboardTextSerializer",(n=>n(t,e)))||t.content.textBetween(0,t.content.size,"\n\n")}}function hf(e,t,n,i,r){let o,a,s=r.parent.type.spec.code;if(!n&&!t)return null;let c=t&&(i||s||!n);if(c){if(e.someProp("transformPastedText",(n=>{t=n(t,s||i,e)})),s)return t?new hl(sl.from(e.state.schema.text(t.replace(/\r\n?/g,"\n"))),0,0):hl.empty;let n=e.someProp("clipboardTextParser",(n=>n(t,r,i,e)));if(n)a=n;else{let n=r.marks(),{schema:i}=e.state,a=sd.fromSchema(i);o=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach((e=>{let t=o.appendChild(document.createElement("p"));e&&t.appendChild(a.serializeNode(i.text(e,n)))}))}}else e.someProp("transformPastedHTML",(t=>{n=t(n,e)})),o=function(e){let t=/^(\s*<meta [^>]*>)*/.exec(e);t&&(e=e.slice(t[0].length));let n,i=Tf().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(e);(n=r&&If[r[1].toLowerCase()])&&(e=n.map((e=>"<"+e+">")).join("")+e+n.map((e=>"</"+e+">")).reverse().join(""));if(i.innerHTML=e,n)for(let o=0;o<n.length;o++)i=i.querySelector(n[o])||i;return i}(n),Wp&&function(e){let t=e.querySelectorAll(Vp?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<t.length;n++){let i=t[n];1==i.childNodes.length&&" "==i.textContent&&i.parentNode&&i.parentNode.replaceChild(e.ownerDocument.createTextNode(" "),i)}}(o);let u=o&&o.querySelector("[data-pm-slice]"),l=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(l&&l[3])for(let d=+l[3];d>0;d--){let e=o.firstChild;for(;e&&1!=e.nodeType;)e=e.nextSibling;if(!e)break;o=e}if(!a){let t=e.someProp("clipboardParser")||e.someProp("domParser")||Xl.fromSchema(e.state.schema);a=t.parseSlice(o,{preserveWhitespace:!(!c&&!l),context:r,ruleFromNode:e=>"BR"!=e.nodeName||e.nextSibling||!e.parentNode||ff.test(e.parentNode.nodeName)?null:{ignore:!0}})}if(l)a=function(e,t){if(!e.size)return e;let n,i=e.content.firstChild.type.schema;try{n=JSON.parse(t)}catch(ok){return e}let{content:r,openStart:o,openEnd:a}=e;for(let s=n.length-2;s>=0;s-=2){let e=i.nodes[n[s]];if(!e||e.hasRequiredAttrs())break;r=sl.from(e.create(n[s+1],r)),o++,a++}return new hl(r,o,a)}(yf(a,+l[1],+l[2]),l[4]);else if(a=hl.maxOpen(function(e,t){if(e.childCount<2)return e;for(let n=t.depth;n>=0;n--){let i,r=t.node(n).contentMatchAt(t.index(n)),o=[];if(e.forEach((e=>{if(!o)return;let t,n=r.findWrapping(e.type);if(!n)return o=null;if(t=o.length&&i.length&&mf(n,i,e,o[o.length-1],0))o[o.length-1]=t;else{o.length&&(o[o.length-1]=vf(o[o.length-1],i.length));let t=gf(e,n);o.push(t),r=r.matchType(t.type),i=n}})),o)return sl.from(o)}return e}(a.content,r),!0),a.openStart||a.openEnd){let e=0,t=0;for(let n=a.content.firstChild;e<a.openStart&&!n.type.spec.isolating;e++,n=n.firstChild);for(let n=a.content.lastChild;t<a.openEnd&&!n.type.spec.isolating;t++,n=n.lastChild);a=yf(a,e,t)}return e.someProp("transformPasted",(t=>{a=t(a,e)})),a}const ff=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function gf(e,t,n=0){for(let i=t.length-1;i>=n;i--)e=t[i].create(null,sl.from(e));return e}function mf(e,t,n,i,r){if(r<e.length&&r<t.length&&e[r]==t[r]){let o=mf(e,t,n,i.lastChild,r+1);if(o)return i.copy(i.content.replaceChild(i.childCount-1,o));if(i.contentMatchAt(i.childCount).matchType(r==e.length-1?n.type:e[r+1]))return i.copy(i.content.append(sl.from(gf(n,e,r+1))))}}function vf(e,t){if(0==t)return e;let n=e.content.replaceChild(e.childCount-1,vf(e.lastChild,t-1)),i=e.contentMatchAt(e.childCount).fillBefore(sl.empty,!0);return e.copy(n.append(i))}function _f(e,t,n,i,r,o){let a=t<0?e.firstChild:e.lastChild,s=a.content;return r<i-1&&(s=_f(s,t,n,i,r+1,o)),r>=n&&(s=t<0?a.contentMatchAt(0).fillBefore(s,e.childCount>1||o<=r).append(s):s.append(a.contentMatchAt(a.childCount).fillBefore(sl.empty,!0))),e.replaceChild(t<0?0:e.childCount-1,a.copy(s))}function yf(e,t,n){return t<e.openStart&&(e=new hl(_f(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)),n<e.openEnd&&(e=new hl(_f(e.content,1,n,e.openEnd,0,0),e.openStart,n)),e}const If={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Mf=null;function Tf(){return Mf||(Mf=document.implementation.createHTMLDocument("title"))}const Cf={},Sf={},Ef={touchstart:!0,touchmove:!0};class kf{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function bf(e,t){e.input.lastSelectionOrigin=t,e.input.lastSelectionTime=Date.now()}function Df(e){e.someProp("handleDOMEvents",(t=>{for(let n in t)e.input.eventHandlers[n]||e.dom.addEventListener(n,e.input.eventHandlers[n]=t=>wf(e,t))}))}function wf(e,t){return e.someProp("handleDOMEvents",(n=>{let i=n[t.type];return!!i&&(i(e,t)||t.defaultPrevented)}))}function Af(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let n=t.target;n!=e.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(t))return!1;return!0}function Rf(e){return{left:e.clientX,top:e.clientY}}function Lf(e,t,n,i,r){if(-1==i)return!1;let o=e.state.doc.resolve(i);for(let a=o.depth+1;a>0;a--)if(e.someProp(t,(t=>a>o.depth?t(e,n,o.nodeAfter,o.before(a),r,!0):t(e,n,o.node(a),o.before(a),r,!1))))return!0;return!1}function Of(e,t,n){e.focused||e.focus();let i=e.state.tr.setSelection(t);"pointer"==n&&i.setMeta("pointer",!0),e.dispatch(i)}function Nf(e,t,n,i,r){return Lf(e,"handleClickOn",t,n,i)||e.someProp("handleClick",(n=>n(e,t,i)))||(r?function(e,t){if(-1==t)return!1;let n,i,r=e.state.selection;r instanceof np&&(n=r.node);let o=e.state.doc.resolve(t);for(let a=o.depth+1;a>0;a--){let e=a>o.depth?o.nodeAfter:o.node(a);if(np.isSelectable(e)){i=n&&r.$from.depth>0&&a>=r.$from.depth&&o.before(r.$from.depth+1)==r.$from.pos?o.before(r.$from.depth):o.before(a);break}}return null!=i&&(Of(e,np.create(e.state.doc,i),"pointer"),!0)}(e,n):function(e,t){if(-1==t)return!1;let n=e.state.doc.resolve(t),i=n.nodeAfter;return!!(i&&i.isAtom&&np.isSelectable(i))&&(Of(e,new np(n),"pointer"),!0)}(e,n))}function Pf(e,t,n,i){return Lf(e,"handleDoubleClickOn",t,n,i)||e.someProp("handleDoubleClick",(n=>n(e,t,i)))}function Uf(e,t,n,i){return Lf(e,"handleTripleClickOn",t,n,i)||e.someProp("handleTripleClick",(n=>n(e,t,i)))||function(e,t,n){if(0!=n.button)return!1;let i=e.state.doc;if(-1==t)return!!i.inlineContent&&(Of(e,ep.create(i,0,i.content.size),"pointer"),!0);let r=i.resolve(t);for(let o=r.depth+1;o>0;o--){let t=o>r.depth?r.nodeAfter:r.node(o),n=r.before(o);if(t.inlineContent)Of(e,ep.create(i,n+1,n+1+t.content.size),"pointer");else{if(!np.isSelectable(t))continue;Of(e,np.create(i,n),"pointer")}return!0}}(e,n,i)}function xf(e){return jf(e)}Sf.keydown=(e,t)=>{let n=t;if(e.input.shiftKey=16==n.keyCode||n.shiftKey,!Vf(e,n)&&(e.input.lastKeyCode=n.keyCode,e.input.lastKeyCodeTime=Date.now(),!zp||!Vp||13!=n.keyCode))if(229!=n.keyCode&&e.domObserver.forceFlush(),!Hp||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)e.someProp("handleKeyDown",(t=>t(e,n)))||df(e,n)?n.preventDefault():bf(e,"key");else{let t=Date.now();e.input.lastIOSEnter=t,e.input.lastIOSEnterFallbackTimeout=setTimeout((()=>{e.input.lastIOSEnter==t&&(e.someProp("handleKeyDown",(t=>t(e,wp(13,"Enter")))),e.input.lastIOSEnter=0)}),200)}},Sf.keyup=(e,t)=>{16==t.keyCode&&(e.input.shiftKey=!1)},Sf.keypress=(e,t)=>{let n=t;if(Vf(e,n)||!n.charCode||n.ctrlKey&&!n.altKey||jp&&n.metaKey)return;if(e.someProp("handleKeyPress",(t=>t(e,n))))return void n.preventDefault();let i=e.state.selection;if(!(i instanceof ep&&i.$from.sameParent(i.$to))){let t=String.fromCharCode(n.charCode);/[\r\n]/.test(t)||e.someProp("handleTextInput",(n=>n(e,i.$from.pos,i.$to.pos,t)))||e.dispatch(e.state.tr.insertText(t).scrollIntoView()),n.preventDefault()}};const Gf=jp?"metaKey":"ctrlKey";Cf.mousedown=(e,t)=>{let n=t;e.input.shiftKey=n.shiftKey;let i=xf(e),r=Date.now(),o="singleClick";r-e.input.lastClick.time<500&&function(e,t){let n=t.x-e.clientX,i=t.y-e.clientY;return n*n+i*i<100}(n,e.input.lastClick)&&!n[Gf]&&("singleClick"==e.input.lastClick.type?o="doubleClick":"doubleClick"==e.input.lastClick.type&&(o="tripleClick")),e.input.lastClick={time:r,x:n.clientX,y:n.clientY,type:o};let a=e.posAtCoords(Rf(n));a&&("singleClick"==o?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new Ff(e,a,n,!!i)):("doubleClick"==o?Pf:Uf)(e,a.pos,a.inside,n)?n.preventDefault():bf(e,"pointer"))};class Ff{constructor(e,t,n,i){let r,o;if(this.view=e,this.pos=t,this.event=n,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[Gf],this.allowDefault=n.shiftKey,t.inside>-1)r=e.state.doc.nodeAt(t.inside),o=t.inside;else{let n=e.state.doc.resolve(t.pos);r=n.parent,o=n.depth?n.before():0}const a=i?null:n.target,s=a?e.docView.nearestDesc(a,!0):null;this.target=s?s.dom:null;let{selection:c}=e.state;(0==n.button&&r.type.spec.draggable&&!1!==r.type.spec.selectable||c instanceof np&&c.from<=o&&c.to>o)&&(this.mightDrag={node:r,pos:o,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!Gp||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),bf(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout((()=>qh(this.view))),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(Rf(e))),this.updateAllowDefault(e),this.allowDefault||!t?bf(this.view,"pointer"):Nf(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():0==e.button&&(this.flushed||Bp&&this.mightDrag&&!this.mightDrag.node.isAtom||Vp&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(Of(this.view,Jd.near(this.view.state.doc.resolve(t.pos)),"pointer"),e.preventDefault()):bf(this.view,"pointer")}move(e){this.updateAllowDefault(e),bf(this.view,"pointer"),0==e.buttons&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}function Vf(e,t){return!!e.composing||!!(Bp&&Math.abs(t.timeStamp-e.input.compositionEndedAt)<500)&&(e.input.compositionEndedAt=-2e8,!0)}Cf.touchstart=e=>{e.input.lastTouch=Date.now(),xf(e),bf(e,"pointer")},Cf.touchmove=e=>{e.input.lastTouch=Date.now(),bf(e,"pointer")},Cf.contextmenu=e=>xf(e);const qf=zp?5e3:-1;function Bf(e,t){clearTimeout(e.input.composingTimeout),t>-1&&(e.input.composingTimeout=setTimeout((()=>jf(e)),t))}function Hf(e){for(e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=function(){let e=document.createEvent("Event");return e.initEvent("event",!0,!0),e.timeStamp}());e.input.compositionNodes.length>0;)e.input.compositionNodes.pop().markParentsDirty()}function jf(e,t=!1){if(!(zp&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),Hf(e),t||e.docView&&e.docView.dirty){let t=Fh(e);return t&&!t.eq(e.state.selection)?e.dispatch(e.state.tr.setSelection(t)):e.updateState(e.state),!0}return!1}}Sf.compositionstart=Sf.compositionupdate=e=>{if(!e.composing){e.domObserver.flush();let{state:t}=e,n=t.selection.$from;if(t.selection.empty&&(t.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some((e=>!1===e.type.spec.inclusive))))e.markCursor=e.state.storedMarks||n.marks(),jf(e,!0),e.markCursor=null;else if(jf(e),Gp&&t.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let t=e.domSelectionRange();for(let n=t.focusNode,i=t.focusOffset;n&&1==n.nodeType&&0!=i;){let t=i<0?n.lastChild:n.childNodes[i-1];if(!t)break;if(3==t.nodeType){e.domSelection().collapse(t,t.nodeValue.length);break}n=t,i=-1}}e.input.composing=!0}Bf(e,qf)},Sf.compositionend=(e,t)=>{e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=t.timeStamp,e.input.compositionID++,Bf(e,20))};const Kf=Up&&xp<15||Hp&&Yp<604;function zf(e,t,n,i,r){let o=hf(e,t,n,i,e.state.selection.$from);if(e.someProp("handlePaste",(t=>t(e,r,o||hl.empty))))return!0;if(!o)return!1;let a=function(e){return 0==e.openStart&&0==e.openEnd&&1==e.content.childCount?e.content.firstChild:null}(o),s=a?e.state.tr.replaceSelectionWith(a,e.input.shiftKey):e.state.tr.replaceSelection(o);return e.dispatch(s.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}Cf.copy=Sf.cut=(e,t)=>{let n=t,i=e.state.selection,r="cut"==n.type;if(i.empty)return;let o=Kf?null:n.clipboardData,a=i.content(),{dom:s,text:c}=pf(e,a);o?(n.preventDefault(),o.clearData(),o.setData("text/html",s.innerHTML),o.setData("text/plain",c)):function(e,t){if(!e.dom.parentNode)return;let n=e.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(t),n.style.cssText="position: fixed; left: -10000px; top: 10px";let i=getSelection(),r=document.createRange();r.selectNodeContents(t),e.dom.blur(),i.removeAllRanges(),i.addRange(r),setTimeout((()=>{n.parentNode&&n.parentNode.removeChild(n),e.focus()}),50)}(e,s),r&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},Sf.paste=(e,t)=>{let n=t;if(e.composing&&!zp)return;let i=Kf?null:n.clipboardData;i&&zf(e,i.getData("text/plain"),i.getData("text/html"),e.input.shiftKey,n)?n.preventDefault():function(e,t){if(!e.dom.parentNode)return;let n=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,i=e.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(i.contentEditable="true"),i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{e.focus(),i.parentNode&&i.parentNode.removeChild(i),n?zf(e,i.value,null,e.input.shiftKey,t):zf(e,i.textContent,i.innerHTML,e.input.shiftKey,t)}),50)}(e,n)};class Wf{constructor(e,t){this.slice=e,this.move=t}}const Yf=jp?"altKey":"ctrlKey";Cf.dragstart=(e,t)=>{let n=t,i=e.input.mouseDown;if(i&&i.done(),!n.dataTransfer)return;let r=e.state.selection,o=r.empty?null:e.posAtCoords(Rf(n));if(o&&o.pos>=r.from&&o.pos<=(r instanceof np?r.to-1:r.to));else if(i&&i.mightDrag)e.dispatch(e.state.tr.setSelection(np.create(e.state.doc,i.mightDrag.pos)));else if(n.target&&1==n.target.nodeType){let t=e.docView.nearestDesc(n.target,!0);t&&t.node.type.spec.draggable&&t!=e.docView&&e.dispatch(e.state.tr.setSelection(np.create(e.state.doc,t.posBefore)))}let a=e.state.selection.content(),{dom:s,text:c}=pf(e,a);n.dataTransfer.clearData(),n.dataTransfer.setData(Kf?"Text":"text/html",s.innerHTML),n.dataTransfer.effectAllowed="copyMove",Kf||n.dataTransfer.setData("text/plain",c),e.dragging=new Wf(a,!n[Yf])},Cf.dragend=e=>{let t=e.dragging;window.setTimeout((()=>{e.dragging==t&&(e.dragging=null)}),50)},Sf.dragover=Sf.dragenter=(e,t)=>t.preventDefault(),Sf.drop=(e,t)=>{let n=t,i=e.dragging;if(e.dragging=null,!n.dataTransfer)return;let r=e.posAtCoords(Rf(n));if(!r)return;let o=e.state.doc.resolve(r.pos),a=i&&i.slice;a?e.someProp("transformPasted",(t=>{a=t(a,e)})):a=hf(e,n.dataTransfer.getData(Kf?"Text":"text/plain"),Kf?null:n.dataTransfer.getData("text/html"),!1,o);let s=!(!i||n[Yf]);if(e.someProp("handleDrop",(t=>t(e,n,a||hl.empty,s))))return void n.preventDefault();if(!a)return;n.preventDefault();let c=a?function(e,t,n){let i=e.resolve(t);if(!n.content.size)return t;let r=n.content;for(let o=0;o<n.openStart;o++)r=r.firstChild.content;for(let o=1;o<=(0==n.openStart&&n.size?2:1);o++)for(let e=i.depth;e>=0;e--){let t=e==i.depth?0:i.pos<=(i.start(e+1)+i.end(e+1))/2?-1:1,n=i.index(e)+(t>0?1:0),a=i.node(e),s=!1;if(1==o)s=a.canReplace(n,n,r);else{let e=a.contentMatchAt(n).findWrapping(r.firstChild.type);s=e&&a.canReplaceWith(n,n,e[0])}if(s)return 0==t?i.pos:t<0?i.before(e+1):i.after(e+1)}return null}(e.state.doc,o.pos,a):o.pos;null==c&&(c=o.pos);let u=e.state.tr;s&&u.deleteSelection();let l=u.mapping.map(c),d=0==a.openStart&&0==a.openEnd&&1==a.content.childCount,p=u.doc;if(d?u.replaceRangeWith(l,l,a.content.firstChild):u.replaceRange(l,l,a),u.doc.eq(p))return;let h=u.doc.resolve(l);if(d&&np.isSelectable(a.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(a.content.firstChild))u.setSelection(new np(h));else{let t=u.mapping.map(c);u.mapping.maps[u.mapping.maps.length-1].forEach(((e,n,i,r)=>t=r)),u.setSelection(Yh(e,h,u.doc.resolve(t)))}e.focus(),e.dispatch(u.setMeta("uiEvent","drop"))},Cf.focus=e=>{e.input.lastFocus=Date.now(),e.focused||(e.domObserver.stop(),e.dom.classList.add("ProseMirror-focused"),e.domObserver.start(),e.focused=!0,setTimeout((()=>{e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelectionRange())&&qh(e)}),20))},Cf.blur=(e,t)=>{let n=t;e.focused&&(e.domObserver.stop(),e.dom.classList.remove("ProseMirror-focused"),e.domObserver.start(),n.relatedTarget&&e.dom.contains(n.relatedTarget)&&e.domObserver.currentSelection.clear(),e.focused=!1)},Cf.beforeinput=(e,t)=>{if(Vp&&zp&&"deleteContentBackward"==t.inputType){e.domObserver.flushSoon();let{domChangeCount:t}=e.input;setTimeout((()=>{if(e.input.domChangeCount!=t)return;if(e.dom.blur(),e.focus(),e.someProp("handleKeyDown",(t=>t(e,wp(8,"Backspace")))))return;let{$cursor:n}=e.state.selection;n&&n.pos>0&&e.dispatch(e.state.tr.delete(n.pos-1,n.pos).scrollIntoView())}),50)}};for(let tt in Sf)Cf[tt]=Sf[tt];function $f(e,t){if(e==t)return!0;for(let n in e)if(e[n]!==t[n])return!1;for(let n in t)if(!(n in e))return!1;return!0}class Jf{constructor(e,t){this.toDOM=e,this.spec=t||tg,this.side=this.spec.side||0}map(e,t,n,i){let{pos:r,deleted:o}=e.mapResult(t.from+i,this.side<0?-1:1);return o?null:new Qf(r-n,r-n,this)}valid(){return!0}eq(e){return this==e||e instanceof Jf&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&$f(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Xf{constructor(e,t){this.attrs=e,this.spec=t||tg}map(e,t,n,i){let r=e.map(t.from+i,this.spec.inclusiveStart?-1:1)-n,o=e.map(t.to+i,this.spec.inclusiveEnd?1:-1)-n;return r>=o?null:new Qf(r,o,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof Xf&&$f(this.attrs,e.attrs)&&$f(this.spec,e.spec)}static is(e){return e.type instanceof Xf}destroy(){}}class Zf{constructor(e,t){this.attrs=e,this.spec=t||tg}map(e,t,n,i){let r=e.mapResult(t.from+i,1);if(r.deleted)return null;let o=e.mapResult(t.to+i,-1);return o.deleted||o.pos<=r.pos?null:new Qf(r.pos-n,o.pos-n,this)}valid(e,t){let n,{index:i,offset:r}=e.content.findIndex(t.from);return r==t.from&&!(n=e.child(i)).isText&&r+n.nodeSize==t.to}eq(e){return this==e||e instanceof Zf&&$f(this.attrs,e.attrs)&&$f(this.spec,e.spec)}destroy(){}}class Qf{constructor(e,t,n){this.from=e,this.to=t,this.type=n}copy(e,t){return new Qf(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,n){return this.type.map(e,this,t,n)}static widget(e,t,n){return new Qf(e,e,new Jf(t,n))}static inline(e,t,n,i){return new Qf(e,t,new Xf(n,i))}static node(e,t,n,i){return new Qf(e,t,new Zf(n,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Xf}}const eg=[],tg={};class ng{constructor(e,t){this.local=e.length?e:eg,this.children=t.length?t:eg}static create(e,t){return t.length?cg(t,e,0,tg):ig}find(e,t,n){let i=[];return this.findInner(null==e?0:e,null==t?1e9:t,i,0,n),i}findInner(e,t,n,i,r){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=t&&a.to>=e&&(!r||r(a.spec))&&n.push(a.copy(a.from+i,a.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<t&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,t-a,n,i+a,r)}}map(e,t,n){return this==ig||0==e.maps.length?this:this.mapInner(e,t,0,0,n||tg)}mapInner(e,t,n,i,r){let o;for(let a=0;a<this.local.length;a++){let s=this.local[a].map(e,n,i);s&&s.type.valid(t,s)?(o||(o=[])).push(s):r.onRemove&&r.onRemove(this.local[a].spec)}return this.children.length?function(e,t,n,i,r,o,a){let s=e.slice();for(let u=0,l=o;u<n.maps.length;u++){let e=0;n.maps[u].forEach(((t,n,i,o)=>{let a=o-i-(n-t);for(let c=0;c<s.length;c+=3){let o=s[c+1];if(o<0||t>o+l-e)continue;let u=s[c]+l-e;n>=u?s[c+1]=t<=u?-2:-1:i>=r&&a&&(s[c]+=a,s[c+1]+=a)}e+=a})),l=n.maps[u].map(l,-1)}let c=!1;for(let u=0;u<s.length;u+=3)if(s[u+1]<0){if(-2==s[u+1]){c=!0,s[u+1]=-1;continue}let t=n.map(e[u]+o),l=t-r;if(l<0||l>=i.content.size){c=!0;continue}let d=n.map(e[u+1]+o,-1)-r,{index:p,offset:h}=i.content.findIndex(l),f=i.maybeChild(p);if(f&&h==l&&h+f.nodeSize==d){let i=s[u+2].mapInner(n,f,t+1,e[u]+o+1,a);i!=ig?(s[u]=l,s[u+1]=d,s[u+2]=i):(s[u+1]=-2,c=!0)}else c=!0}if(c){let c=function(e,t,n,i,r,o,a){function s(e,t){for(let o=0;o<e.local.length;o++){let s=e.local[o].map(i,r,t);s?n.push(s):a.onRemove&&a.onRemove(e.local[o].spec)}for(let n=0;n<e.children.length;n+=3)s(e.children[n+2],e.children[n]+t+1)}for(let c=0;c<e.length;c+=3)-1==e[c+1]&&s(e[c+2],t[c]+o+1);return n}(s,e,t,n,r,o,a),u=cg(c,i,0,a);t=u.local;for(let e=0;e<s.length;e+=3)s[e+1]<0&&(s.splice(e,3),e-=3);for(let e=0,t=0;e<u.children.length;e+=3){let n=u.children[e];for(;t<s.length&&s[t]<n;)t+=3;s.splice(t,0,u.children[e],u.children[e+1],u.children[e+2])}}return new ng(t.sort(ug),s)}(this.children,o||[],e,t,n,i,r):o?new ng(o.sort(ug),eg):ig}add(e,t){return t.length?this==ig?ng.create(e,t):this.addInner(e,t,0):this}addInner(e,t,n){let i,r=0;e.forEach(((e,o)=>{let a,s=o+n;if(a=ag(t,e,s)){for(i||(i=this.children.slice());r<i.length&&i[r]<o;)r+=3;i[r]==o?i[r+2]=i[r+2].addInner(e,a,s+1):i.splice(r,0,o,o+e.nodeSize,cg(a,e,s+1,tg)),r+=3}}));let o=og(r?sg(t):t,-n);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new ng(o.length?this.local.concat(o).sort(ug):this.local,i||this.children)}remove(e){return 0==e.length||this==ig?this:this.removeInner(e,0)}removeInner(e,t){let n=this.children,i=this.local;for(let r=0;r<n.length;r+=3){let i,o=n[r]+t,a=n[r+1]+t;for(let t,n=0;n<e.length;n++)(t=e[n])&&t.from>o&&t.to<a&&(e[n]=null,(i||(i=[])).push(t));if(!i)continue;n==this.children&&(n=this.children.slice());let s=n[r+2].removeInner(i,o+1);s!=ig?n[r+2]=s:(n.splice(r,3),r-=3)}if(i.length)for(let r,o=0;o<e.length;o++)if(r=e[o])for(let e=0;e<i.length;e++)i[e].eq(r,t)&&(i==this.local&&(i=this.local.slice()),i.splice(e--,1));return n==this.children&&i==this.local?this:i.length||n.length?new ng(i,n):ig}forChild(e,t){if(this==ig)return this;if(t.isLeaf)return ng.empty;let n,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(n=this.children[a+2]);break}let r=e+1,o=r+t.content.size;for(let a=0;a<this.local.length;a++){let e=this.local[a];if(e.from<o&&e.to>r&&e.type instanceof Xf){let t=Math.max(r,e.from)-r,n=Math.min(o,e.to)-r;t<n&&(i||(i=[])).push(e.copy(t,n))}}if(i){let e=new ng(i.sort(ug),eg);return n?new rg([e,n]):e}return n||ig}eq(e){if(this==e)return!0;if(!(e instanceof ng)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return lg(this.localsInner(e))}localsInner(e){if(this==ig)return eg;if(e.inlineContent||!this.local.some(Xf.is))return this.local;let t=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof Xf||t.push(this.local[n]);return t}}ng.empty=new ng([],[]),ng.removeOverlap=lg;const ig=ng.empty;class rg{constructor(e){this.members=e}map(e,t){const n=this.members.map((n=>n.map(e,t,tg)));return rg.from(n)}forChild(e,t){if(t.isLeaf)return ng.empty;let n=[];for(let i=0;i<this.members.length;i++){let r=this.members[i].forChild(e,t);r!=ig&&(r instanceof rg?n=n.concat(r.members):n.push(r))}return rg.from(n)}eq(e){if(!(e instanceof rg)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,n=!0;for(let i=0;i<this.members.length;i++){let r=this.members[i].localsInner(e);if(r.length)if(t){n&&(t=t.slice(),n=!1);for(let e=0;e<r.length;e++)t.push(r[e])}else t=r}return t?lg(n?t:t.sort(ug)):eg}static from(e){switch(e.length){case 0:return ig;case 1:return e[0];default:return new rg(e.every((e=>e instanceof ng))?e:e.reduce(((e,t)=>e.concat(t instanceof ng?t:t.members)),[]))}}}function og(e,t){if(!t||!e.length)return e;let n=[];for(let i=0;i<e.length;i++){let r=e[i];n.push(new Qf(r.from+t,r.to+t,r.type))}return n}function ag(e,t,n){if(t.isLeaf)return null;let i=n+t.nodeSize,r=null;for(let o,a=0;a<e.length;a++)(o=e[a])&&o.from>n&&o.to<i&&((r||(r=[])).push(o),e[a]=null);return r}function sg(e){let t=[];for(let n=0;n<e.length;n++)null!=e[n]&&t.push(e[n]);return t}function cg(e,t,n,i){let r=[],o=!1;t.forEach(((t,a)=>{let s=ag(e,t,a+n);if(s){o=!0;let e=cg(s,t,n+a+1,i);e!=ig&&r.push(a,a+t.nodeSize,e)}}));let a=og(o?sg(e):e,-n).sort(ug);for(let s=0;s<a.length;s++)a[s].type.valid(t,a[s])||(i.onRemove&&i.onRemove(a[s].spec),a.splice(s--,1));return a.length||r.length?new ng(a,r):ig}function ug(e,t){return e.from-t.from||e.to-t.to}function lg(e){let t=e;for(let n=0;n<t.length-1;n++){let i=t[n];if(i.from!=i.to)for(let r=n+1;r<t.length;r++){let o=t[r];if(o.from!=i.from){o.from<i.to&&(t==e&&(t=e.slice()),t[n]=i.copy(i.from,o.from),dg(t,r,i.copy(o.from,i.to)));break}o.to!=i.to&&(t==e&&(t=e.slice()),t[r]=o.copy(o.from,i.to),dg(t,r+1,o.copy(i.to,o.to)))}}return t}function dg(e,t,n){for(;t<e.length&&ug(n,e[t])>0;)t++;e.splice(t,0,n)}function pg(e){let t=[];return e.someProp("decorations",(n=>{let i=n(e.state);i&&i!=ig&&t.push(i)})),e.cursorWrapper&&t.push(ng.create(e.state.doc,[e.cursorWrapper.deco])),rg.from(t)}const hg={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},fg=Up&&xp<=11;class gg{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class mg{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new gg,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver((e=>{for(let t=0;t<e.length;t++)this.queue.push(e[t]);Up&&xp<=11&&e.some((e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length))?this.flushSoon():this.flush()})),fg&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout((()=>{this.flushingSoon=-1,this.flush()}),20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,hg)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout((()=>this.flush()),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout((()=>this.suppressingSelectionUpdates=!1),50)}onSelectionChange(){if($h(this.view)){if(this.suppressingSelectionUpdates)return qh(this.view);if(Up&&xp<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Cp(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t,n=new Set;for(let r=e.focusNode;r;r=Ip(r))n.add(r);for(let r=e.anchorNode;r;r=Ip(r))if(n.has(r)){t=r;break}let i=t&&this.view.docView.nearestDesc(t);return i&&i.ignoreMutation({type:"selection",target:3==t.nodeType?t.parentNode:t})?(this.setCurSelection(),!0):void 0}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.observer?this.observer.takeRecords():[];this.queue.length&&(t=this.queue.concat(t),this.queue.length=0);let n=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&$h(e)&&!this.ignoreSelectionChange(n),r=-1,o=-1,a=!1,s=[];if(e.editable)for(let u=0;u<t.length;u++){let e=this.registerMutation(t[u],s);e&&(r=r<0?e.from:Math.min(e.from,r),o=o<0?e.to:Math.max(e.to,o),e.typeOver&&(a=!0))}if(Gp&&s.length>1){let e=s.filter((e=>"BR"==e.nodeName));if(2==e.length){let t=e[0],n=e[1];t.parentNode&&t.parentNode.parentNode==n.parentNode?n.remove():t.remove()}}let c=null;r<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Dp(n)&&(c=Fh(e))&&c.eq(Jd.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,qh(e),this.currentSelection.set(n),e.scrollToSelection()):(r>-1||i)&&(r>-1&&(e.docView.markDirty(r,o),function(e){if(vg.has(e))return;if(vg.set(e,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(e.dom).whiteSpace)){if(e.requiresGeckoHackNode=Gp,_g)return;_g=!0}}(e)),this.handleDOMChange(r,o,a,s),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||qh(e),this.currentSelection.set(n))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if("attributes"==e.type&&(n==this.view.docView||"contenteditable"==e.attributeName||"style"==e.attributeName&&!e.oldValue&&!e.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(e))return null;if("childList"==e.type){for(let n=0;n<e.addedNodes.length;n++)t.push(e.addedNodes[n]);if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let i=e.previousSibling,r=e.nextSibling;if(Up&&xp<=11&&e.addedNodes.length)for(let t=0;t<e.addedNodes.length;t++){let{previousSibling:n,nextSibling:o}=e.addedNodes[t];(!n||Array.prototype.indexOf.call(e.addedNodes,n)<0)&&(i=n),(!o||Array.prototype.indexOf.call(e.addedNodes,o)<0)&&(r=o)}let o=i&&i.parentNode==e.target?yp(i)+1:0,a=n.localPosFromDOM(e.target,o,-1),s=r&&r.parentNode==e.target?yp(r):e.target.childNodes.length;return{from:a,to:n.localPosFromDOM(e.target,s,1)}}return"attributes"==e.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}}let vg=new WeakMap,_g=!1;function yg(e){let t=e.pmViewDesc;if(t)return t.parseRule();if("BR"==e.nodeName&&e.parentNode){if(Bp&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){let e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}if(e.parentNode.lastChild==e||Bp&&/^(tr|table)$/i.test(e.parentNode.nodeName))return{ignore:!0}}else if("IMG"==e.nodeName&&e.getAttribute("mark-placeholder"))return{ignore:!0};return null}const Ig=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Mg(e,t,n,i,r){if(t<0){let t=e.input.lastSelectionTime>Date.now()-50?e.input.lastSelectionOrigin:null,n=Fh(e,t);if(n&&!e.state.selection.eq(n)){if(Vp&&zp&&13===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime&&e.someProp("handleKeyDown",(t=>t(e,wp(13,"Enter")))))return;let i=e.state.tr.setSelection(n);"pointer"==t?i.setMeta("pointer",!0):"key"==t&&i.scrollIntoView(),e.composing&&i.setMeta("composition",e.input.compositionID),e.dispatch(i)}return}let o=e.state.doc.resolve(t),a=o.sharedDepth(n);t=o.before(a+1),n=e.state.doc.resolve(n).after(a+1);let s,c,u=e.state.selection,l=function(e,t,n){let i,{node:r,fromOffset:o,toOffset:a,from:s,to:c}=e.docView.parseRange(t,n),u=e.domSelectionRange(),l=u.anchorNode;if(l&&e.dom.contains(1==l.nodeType?l:l.parentNode)&&(i=[{node:l,offset:u.anchorOffset}],Dp(u)||i.push({node:u.focusNode,offset:u.focusOffset})),Vp&&8===e.input.lastKeyCode)for(let m=a;m>o;m--){let e=r.childNodes[m-1],t=e.pmViewDesc;if("BR"==e.nodeName&&!t){a=m;break}if(!t||t.size)break}let d=e.state.doc,p=e.someProp("domParser")||Xl.fromSchema(e.state.schema),h=d.resolve(s),f=null,g=p.parse(r,{topNode:h.parent,topMatch:h.parent.contentMatchAt(h.index()),topOpen:!0,from:o,to:a,preserveWhitespace:"pre"!=h.parent.type.whitespace||"full",findPositions:i,ruleFromNode:yg,context:h});if(i&&null!=i[0].pos){let e=i[0].pos,t=i[1]&&i[1].pos;null==t&&(t=e),f={anchor:e+s,head:t+s}}return{doc:g,sel:f,from:s,to:c}}(e,t,n),d=e.state.doc,p=d.slice(l.from,l.to);8===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime?(s=e.state.selection.to,c="end"):(s=e.state.selection.from,c="start"),e.input.lastKeyCode=null;let h=function(e,t,n,i,r){let o=e.findDiffStart(t,n);if(null==o)return null;let{a:a,b:s}=e.findDiffEnd(t,n+e.size,n+t.size);if("end"==r){i-=a+Math.max(0,o-Math.min(a,s))-o}if(a<o&&e.size<t.size){o-=i<=o&&i>=a?o-i:0,s=o+(s-a),a=o}else if(s<o){o-=i<=o&&i>=s?o-i:0,a=o+(a-s),s=o}return{start:o,endA:a,endB:s}}(p.content,l.doc.content,l.from,s,c);if((Hp&&e.input.lastIOSEnter>Date.now()-225||zp)&&r.some((e=>1==e.nodeType&&!Ig.test(e.nodeName)))&&(!h||h.endA>=h.endB)&&e.someProp("handleKeyDown",(t=>t(e,wp(13,"Enter")))))return void(e.input.lastIOSEnter=0);if(!h){if(!(i&&u instanceof ep&&!u.empty&&u.$head.sameParent(u.$anchor))||e.composing||l.sel&&l.sel.anchor!=l.sel.head){if(l.sel){let t=Tg(e,e.state.doc,l.sel);if(t&&!t.eq(e.state.selection)){let n=e.state.tr.setSelection(t);e.composing&&n.setMeta("composition",e.input.compositionID),e.dispatch(n)}}return}h={start:u.from,endA:u.to,endB:u.to}}if(Vp&&e.cursorWrapper&&l.sel&&l.sel.anchor==e.cursorWrapper.deco.from&&l.sel.head==l.sel.anchor){let e=h.endB-h.start;l.sel={anchor:l.sel.anchor+e,head:l.sel.anchor+e}}e.input.domChangeCount++,e.state.selection.from<e.state.selection.to&&h.start==h.endB&&e.state.selection instanceof ep&&(h.start>e.state.selection.from&&h.start<=e.state.selection.from+2&&e.state.selection.from>=l.from?h.start=e.state.selection.from:h.endA<e.state.selection.to&&h.endA>=e.state.selection.to-2&&e.state.selection.to<=l.to&&(h.endB+=e.state.selection.to-h.endA,h.endA=e.state.selection.to)),Up&&xp<=11&&h.endB==h.start+1&&h.endA==h.start&&h.start>l.from&&"  "==l.doc.textBetween(h.start-l.from-1,h.start-l.from+1)&&(h.start--,h.endA--,h.endB--);let f,g=l.doc.resolveNoCache(h.start-l.from),m=l.doc.resolveNoCache(h.endB-l.from),v=d.resolve(h.start),_=g.sameParent(m)&&g.parent.inlineContent&&v.end()>=h.endA;if((Hp&&e.input.lastIOSEnter>Date.now()-225&&(!_||r.some((e=>"DIV"==e.nodeName||"P"==e.nodeName)))||!_&&g.pos<l.doc.content.size&&(f=Jd.findFrom(l.doc.resolve(g.pos+1),1,!0))&&f.head==m.pos)&&e.someProp("handleKeyDown",(t=>t(e,wp(13,"Enter")))))return void(e.input.lastIOSEnter=0);if(e.state.selection.anchor>h.start&&function(e,t,n,i,r){if(!i.parent.isTextblock||n-t<=r.pos-i.pos||Cg(i,!0,!1)<r.pos)return!1;let o=e.resolve(t);if(o.parentOffset<o.parent.content.size||!o.parent.isTextblock)return!1;let a=e.resolve(Cg(o,!0,!0));return!(!a.parent.isTextblock||a.pos>n||Cg(a,!0,!1)<n)&&i.parent.content.cut(i.parentOffset).eq(a.parent.content)}(d,h.start,h.endA,g,m)&&e.someProp("handleKeyDown",(t=>t(e,wp(8,"Backspace")))))return void(zp&&Vp&&e.domObserver.suppressSelectionUpdates());Vp&&zp&&h.endB==h.start&&(e.input.lastAndroidDelete=Date.now()),zp&&!_&&g.start()!=m.start()&&0==m.parentOffset&&g.depth==m.depth&&l.sel&&l.sel.anchor==l.sel.head&&l.sel.head==h.endA&&(h.endB-=2,m=l.doc.resolveNoCache(h.endB-l.from),setTimeout((()=>{e.someProp("handleKeyDown",(function(t){return t(e,wp(13,"Enter"))}))}),20));let y,I,M,T=h.start,C=h.endA;if(_)if(g.pos==m.pos)Up&&xp<=11&&0==g.parentOffset&&(e.domObserver.suppressSelectionUpdates(),setTimeout((()=>qh(e)),20)),y=e.state.tr.delete(T,C),I=d.resolve(h.start).marksAcross(d.resolve(h.endA));else if(h.endA==h.endB&&(M=function(e,t){let n,i,r,o=e.firstChild.marks,a=t.firstChild.marks,s=o,c=a;for(let l=0;l<a.length;l++)s=a[l].removeFromSet(s);for(let l=0;l<o.length;l++)c=o[l].removeFromSet(c);if(1==s.length&&0==c.length)i=s[0],n="add",r=e=>e.mark(i.addToSet(e.marks));else{if(0!=s.length||1!=c.length)return null;i=c[0],n="remove",r=e=>e.mark(i.removeFromSet(e.marks))}let u=[];for(let l=0;l<t.childCount;l++)u.push(r(t.child(l)));if(sl.from(u).eq(e))return{mark:i,type:n}}(g.parent.content.cut(g.parentOffset,m.parentOffset),v.parent.content.cut(v.parentOffset,h.endA-v.start()))))y=e.state.tr,"add"==M.type?y.addMark(T,C,M.mark):y.removeMark(T,C,M.mark);else if(g.parent.child(g.index()).isText&&g.index()==m.index()-(m.textOffset?0:1)){let t=g.parent.textBetween(g.parentOffset,m.parentOffset);if(e.someProp("handleTextInput",(n=>n(e,T,C,t))))return;y=e.state.tr.insertText(t,T,C)}if(y||(y=e.state.tr.replace(T,C,l.doc.slice(h.start-l.from,h.endB-l.from))),l.sel){let t=Tg(e,y.doc,l.sel);t&&!(Vp&&zp&&e.composing&&t.empty&&(h.start!=h.endB||e.input.lastAndroidDelete<Date.now()-100)&&(t.head==T||t.head==y.mapping.map(C)-1)||Up&&t.empty&&t.head==T)&&y.setSelection(t)}I&&y.ensureMarks(I),e.composing&&y.setMeta("composition",e.input.compositionID),e.dispatch(y.scrollIntoView())}function Tg(e,t,n){return Math.max(n.anchor,n.head)>t.content.size?null:Yh(e,t.resolve(n.anchor),t.resolve(n.head))}function Cg(e,t,n){let i=e.depth,r=t?e.end():e.pos;for(;i>0&&(t||e.indexAfter(i)==e.node(i).childCount);)i--,r++,t=!1;if(n){let t=e.node(i).maybeChild(e.indexAfter(i));for(;t&&!t.isLeaf;)t=t.firstChild,r++}return r}class Sg{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new kf,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(wg),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):"function"==typeof e?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=bg(this),kg(this),this.nodeViews=Dg(this),this.docView=Ch(this.state.doc,Eg(this),pg(this),this.dom,this),this.domObserver=new mg(this,((e,t,n,i)=>Mg(this,e,t,n,i))),this.domObserver.start(),function(e){for(let t in Cf){let n=Cf[t];e.dom.addEventListener(t,e.input.eventHandlers[t]=t=>{!Af(e,t)||wf(e,t)||!e.editable&&t.type in Sf||n(e,t)},Ef[t]?{passive:!0}:void 0)}Bp&&e.dom.addEventListener("input",(()=>null)),Df(e)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Df(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(wg),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let n in this._props)t[n]=this._props[n];t.state=this.state;for(let n in e)t[n]=e[n];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){let n=this.state,i=!1,r=!1;e.storedMarks&&this.composing&&(Hf(this),r=!0),this.state=e;let o=n.plugins!=e.plugins||this._props.plugins!=t.plugins;if(o||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let e=Dg(this);(function(e,t){let n=0,i=0;for(let r in e){if(e[r]!=t[r])return!0;n++}for(let r in t)i++;return n!=i})(e,this.nodeViews)&&(this.nodeViews=e,i=!0)}(o||t.handleDOMEvents!=this._props.handleDOMEvents)&&Df(this),this.editable=bg(this),kg(this);let a=pg(this),s=Eg(this),c=n.plugins==e.plugins||n.doc.eq(e.doc)?e.scrollToSelection>n.scrollToSelection?"to selection":"preserve":"reset",u=i||!this.docView.matchesNode(e.doc,s,a);!u&&e.selection.eq(n.selection)||(r=!0);let l="preserve"==c&&r&&null==this.dom.style.overflowAnchor&&function(e){let t,n,i=e.dom.getBoundingClientRect(),r=Math.max(0,i.top);for(let o=(i.left+i.right)/2,a=r+1;a<Math.min(innerHeight,i.bottom);a+=5){let i=e.root.elementFromPoint(o,a);if(!i||i==e.dom||!e.dom.contains(i))continue;let s=i.getBoundingClientRect();if(s.top>=r-20){t=i,n=s.top;break}}return{refDOM:t,refTop:n,stack:Qp(e.dom)}}(this);if(r){this.domObserver.stop();let t=u&&(Up||Vp)&&!this.composing&&!n.selection.empty&&!e.selection.empty&&function(e,t){let n=Math.min(e.$anchor.sharedDepth(e.head),t.$anchor.sharedDepth(t.head));return e.$anchor.start(n)!=t.$anchor.start(n)}(n.selection,e.selection);if(u){let n=Vp?this.trackWrites=this.domSelectionRange().focusNode:null;!i&&this.docView.update(e.doc,s,a,this)||(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=Ch(e.doc,s,a,this.dom,this)),n&&!this.trackWrites&&(t=!0)}t||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&function(e){let t=e.docView.domFromPos(e.state.selection.anchor,0),n=e.domSelectionRange();return Cp(t.node,t.offset,n.anchorNode,n.anchorOffset)}(this))?qh(this,t):(zh(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(n),"reset"==c?this.dom.scrollTop=0:"to selection"==c?this.scrollToSelection():l&&function({refDOM:e,refTop:t,stack:n}){let i=e?e.getBoundingClientRect().top:0;eh(n,0==i?0:i-t)}(l)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(this.someProp("handleScrollToSelection",(e=>e(this))));else if(this.state.selection instanceof np){let t=this.docView.domAfterPos(this.state.selection.from);1==t.nodeType&&Zp(this,t.getBoundingClientRect(),e)}else Zp(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(e&&e.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let t=0;t<this.pluginViews.length;t++){let n=this.pluginViews[t];n.update&&n.update(this,e)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let t=this.directPlugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let t=this.state.plugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}}}someProp(e,t){let n,i=this._props&&this._props[e];if(null!=i&&(n=t?t(i):i))return n;for(let o=0;o<this.directPlugins.length;o++){let i=this.directPlugins[o].props[e];if(null!=i&&(n=t?t(i):i))return n}let r=this.state.plugins;if(r)for(let o=0;o<r.length;o++){let i=r[o].props[e];if(null!=i&&(n=t?t(i):i))return n}}hasFocus(){if(Up){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if("false"==e.contentEditable)return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(e){if(e.setActive)return e.setActive();if(th)return e.focus(th);let t=Qp(e);e.focus(null==th?{get preventScroll(){return th={preventScroll:!0},!0}}:void 0),th||(th=!1,eh(t,0))}(this.dom),qh(this),this.domObserver.start()}get root(){let e=this._root;if(null==e)for(let t=this.dom.parentNode;t;t=t.parentNode)if(9==t.nodeType||11==t.nodeType&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t;return e||document}posAtCoords(e){return oh(this,e)}coordsAtPos(e,t=1){return uh(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,n=-1){let i=this.docView.posFromDOM(e,t,n);if(null==i)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,t){return vh(this,t||this.state,e)}pasteHTML(e,t){return zf(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return zf(this,e,null,!0,t||new ClipboardEvent("paste"))}destroy(){this.docView&&(!function(e){e.domObserver.stop();for(let t in e.input.eventHandlers)e.dom.removeEventListener(t,e.input.eventHandlers[t]);clearTimeout(e.input.composingTimeout),clearTimeout(e.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],pg(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)}get isDestroyed(){return null==this.docView}dispatchEvent(e){return function(e,t){wf(e,t)||!Cf[t.type]||!e.editable&&t.type in Sf||Cf[t.type](e,t)}(this,e)}dispatch(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){return Bp&&11===this.root.nodeType&&function(e){let t=e.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}(this.dom.ownerDocument)==this.dom?function(e){let t;function n(e){e.preventDefault(),e.stopImmediatePropagation(),t=e.getTargetRanges()[0]}e.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),e.dom.removeEventListener("beforeinput",n,!0);let i=t.startContainer,r=t.startOffset,o=t.endContainer,a=t.endOffset,s=e.domAtPos(e.state.selection.anchor);return Cp(s.node,s.offset,o,a)&&([i,r,o,a]=[o,a,i,r]),{anchorNode:i,anchorOffset:r,focusNode:o,focusOffset:a}}(this):this.domSelection()}domSelection(){return this.root.getSelection()}}function Eg(e){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(e.editable),t.translate="no",e.someProp("attributes",(n=>{if("function"==typeof n&&(n=n(e.state)),n)for(let e in n)"class"==e&&(t.class+=" "+n[e]),"style"==e?t.style=(t.style?t.style+";":"")+n[e]:t[e]||"contenteditable"==e||"nodeName"==e||(t[e]=String(n[e]))})),[Qf.node(0,e.state.doc.content.size,t)]}function kg(e){if(e.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),e.cursorWrapper={dom:t,deco:Qf.widget(e.state.selection.head,t,{raw:!0,marks:e.markCursor})}}else e.cursorWrapper=null}function bg(e){return!e.someProp("editable",(t=>!1===t(e.state)))}function Dg(e){let t=Object.create(null);function n(e){for(let n in e)Object.prototype.hasOwnProperty.call(t,n)||(t[n]=e[n])}return e.someProp("nodeViews",n),e.someProp("markViews",n),t}function wg(e){if(e.spec.state||e.spec.filterTransaction||e.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}for(var Ag={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Rg={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Lg="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),Og="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),Ng="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Pg=Og||Lg&&+Lg[1]<57,Ug=0;Ug<10;Ug++)Ag[48+Ug]=Ag[96+Ug]=String(Ug);for(Ug=1;Ug<=24;Ug++)Ag[Ug+111]="F"+Ug;for(Ug=65;Ug<=90;Ug++)Ag[Ug]=String.fromCharCode(Ug+32),Rg[Ug]=String.fromCharCode(Ug);for(var xg in Ag)Rg.hasOwnProperty(xg)||(Rg[xg]=Ag[xg]);const Gg="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function Fg(e){let t,n,i,r,o=e.split(/-(?!$)/),a=o[o.length-1];"Space"==a&&(a=" ");for(let s=0;s<o.length-1;s++){let e=o[s];if(/^(cmd|meta|m)$/i.test(e))r=!0;else if(/^a(lt)?$/i.test(e))t=!0;else if(/^(c|ctrl|control)$/i.test(e))n=!0;else if(/^s(hift)?$/i.test(e))i=!0;else{if(!/^mod$/i.test(e))throw new Error("Unrecognized modifier name: "+e);Gg?r=!0:n=!0}}return t&&(a="Alt-"+a),n&&(a="Ctrl-"+a),r&&(a="Meta-"+a),i&&(a="Shift-"+a),a}function Vg(e,t,n=!0){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),n&&t.shiftKey&&(e="Shift-"+e),e}function qg(e){let t=function(e){let t=Object.create(null);for(let n in e)t[Fg(n)]=e[n];return t}(e);return function(e,n){let i,r=function(e){var t=!(Pg&&(e.ctrlKey||e.altKey||e.metaKey)||Ng&&e.shiftKey&&e.key&&1==e.key.length||"Unidentified"==e.key)&&e.key||(e.shiftKey?Rg:Ag)[e.keyCode]||e.key||"Unidentified";return"Esc"==t&&(t="Escape"),"Del"==t&&(t="Delete"),"Left"==t&&(t="ArrowLeft"),"Up"==t&&(t="ArrowUp"),"Right"==t&&(t="ArrowRight"),"Down"==t&&(t="ArrowDown"),t}(n),o=t[Vg(r,n)];if(o&&o(e.state,e.dispatch,e))return!0;if(1==r.length&&" "!=r){if(n.shiftKey){let i=t[Vg(r,n,!1)];if(i&&i(e.state,e.dispatch,e))return!0}if((n.shiftKey||n.altKey||n.metaKey||r.charCodeAt(0)>127)&&(i=Ag[n.keyCode])&&i!=r){let r=t[Vg(i,n)];if(r&&r(e.state,e.dispatch,e))return!0}}return!1}}function Bg(e,t,n=!1){for(let i=e;i;i="start"==t?i.firstChild:i.lastChild){if(i.isTextblock)return!0;if(n&&1!=i.childCount)return!1}return!1}function Hg(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function jg(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}function Kg(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function zg(e,t,n){let i,r,o=t.nodeBefore,a=t.nodeAfter;if(o.type.spec.isolating||a.type.spec.isolating)return!1;if(function(e,t,n){let i=t.nodeBefore,r=t.nodeAfter,o=t.index();return!(!(i&&r&&i.type.compatibleContent(r.type))||(!i.content.size&&t.parent.canReplace(o-1,o)?(n&&n(e.tr.delete(t.pos-i.nodeSize,t.pos).scrollIntoView()),0):!t.parent.canReplace(o,o+1)||!r.isTextblock&&!Rd(e.doc,t.pos)||(n&&n(e.tr.clearIncompatible(t.pos,i.type,i.contentMatchAt(i.childCount)).join(t.pos).scrollIntoView()),0)))}(e,t,n))return!0;let s=t.parent.canReplace(t.index(),t.index()+1);if(s&&(i=(r=o.contentMatchAt(o.childCount)).findWrapping(a.type))&&r.matchType(i[0]||a.type).validEnd){if(n){let r=t.pos+a.nodeSize,s=sl.empty;for(let e=i.length-1;e>=0;e--)s=sl.from(i[e].create(null,s));s=sl.from(o.copy(s));let c=e.tr.step(new Sd(t.pos-1,r,t.pos,r,new hl(s,1,0),i.length,!0)),u=r+2*i.length;Rd(c.doc,u)&&c.join(u),n(c.scrollIntoView())}return!0}let c=Jd.findFrom(t,1),u=c&&c.$from.blockRange(c.$to),l=u&&bd(u);if(null!=l&&l>=t.depth)return n&&n(e.tr.lift(u,l).scrollIntoView()),!0;if(s&&Bg(a,"start",!0)&&Bg(o,"end")){let i=o,r=[];for(;r.push(i),!i.isTextblock;)i=i.lastChild;let s=a,c=1;for(;!s.isTextblock;s=s.firstChild)c++;if(i.canReplace(i.childCount,i.childCount,s.content)){if(n){let i=sl.empty;for(let e=r.length-1;e>=0;e--)i=sl.from(r[e].copy(i));n(e.tr.step(new Sd(t.pos-r.length,t.pos+a.nodeSize,t.pos+c,t.pos+a.nodeSize-c,new hl(i,r.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function Wg(e){return function(t,n){let i=t.selection,r=e<0?i.$from:i.$to,o=r.depth;for(;r.node(o).isInline;){if(!o)return!1;o--}return!!r.node(o).isTextblock&&(n&&n(t.tr.setSelection(ep.create(t.doc,e<0?r.start(o):r.end(o)))),!0)}}const Yg=Wg(-1),$g=Wg(1);function Jg(e,t=null){return function(n,i){let r=!1;for(let o=0;o<n.selection.ranges.length&&!r;o++){let{$from:{pos:i},$to:{pos:a}}=n.selection.ranges[o];n.doc.nodesBetween(i,a,((i,o)=>{if(r)return!1;if(i.isTextblock&&!i.hasMarkup(e,t))if(i.type==e)r=!0;else{let t=n.doc.resolve(o),i=t.index();r=t.parent.canReplaceWith(i,i+1,e)}}))}if(!r)return!1;if(i){let r=n.tr;for(let i=0;i<n.selection.ranges.length;i++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[i];r.setBlockType(o,a,e,t)}i(r.scrollIntoView())}return!0}}function Xg(e,t=null){return function(n,i){let{$from:r,$to:o}=n.selection,a=r.blockRange(o),s=!1,c=a;if(!a)return!1;if(a.depth>=2&&r.node(a.depth-1).type.compatibleContent(e)&&0==a.startIndex){if(0==r.index(a.depth-1))return!1;let e=n.doc.resolve(a.start-2);c=new wl(e,e,a.depth),a.endIndex<a.parent.childCount&&(a=new wl(r,n.doc.resolve(o.end(a.depth)),a.depth)),s=!0}let u=Dd(c,e,t,a);return!!u&&(i&&i(function(e,t,n,i,r){let o=sl.empty;for(let l=n.length-1;l>=0;l--)o=sl.from(n[l].type.create(n[l].attrs,o));e.step(new Sd(t.start-(i?2:0),t.end,t.start,t.end,new hl(o,0,0),n.length,!0));let a=0;for(let l=0;l<n.length;l++)n[l].type==r&&(a=l+1);let s=n.length-a,c=t.start+n.length-(i?2:0),u=t.parent;for(let l=t.startIndex,d=t.endIndex,p=!0;l<d;l++,p=!1)!p&&Ad(e.doc,c,s)&&(e.split(c,s),c+=2*s),c+=u.child(l).nodeSize;return e}(n.tr,a,u,s,e).scrollIntoView()),!0)}}function Zg(e){return function(t,n){let{$from:i,$to:r}=t.selection,o=i.blockRange(r,(t=>t.childCount>0&&t.firstChild.type==e));return!!o&&(!n||(i.node(o.depth-1).type==e?function(e,t,n,i){let r=e.tr,o=i.end,a=i.$to.end(i.depth);o<a&&(r.step(new Sd(o-1,a,o,a,new hl(sl.from(n.create(null,i.parent.copy())),1,0),1,!0)),i=new wl(r.doc.resolve(i.$from.pos),r.doc.resolve(a),i.depth));const s=bd(i);if(null==s)return!1;r.lift(i,s);let c=r.mapping.map(o,-1)-1;Rd(r.doc,c)&&r.join(c);return t(r.scrollIntoView()),!0}(t,n,e,o):function(e,t,n){let i=e.tr,r=n.parent;for(let h=n.end,f=n.endIndex-1,g=n.startIndex;f>g;f--)h-=r.child(f).nodeSize,i.delete(h-1,h+1);let o=i.doc.resolve(n.start),a=o.nodeAfter;if(i.mapping.map(n.end)!=n.start+o.nodeAfter.nodeSize)return!1;let s=0==n.startIndex,c=n.endIndex==r.childCount,u=o.node(-1),l=o.index(-1);if(!u.canReplace(l+(s?0:1),l+1,a.content.append(c?sl.empty:sl.from(r))))return!1;let d=o.pos,p=d+a.nodeSize;return i.step(new Sd(d-(s?1:0),p+(c?1:0),d+1,p-1,new hl((s?sl.empty:sl.from(r.copy(sl.empty))).append(c?sl.empty:sl.from(r.copy(sl.empty))),s?0:1,c?0:1),s?0:1)),t(i.scrollIntoView()),!0}(t,n,o)))}}function Qg(e){const{state:t,transaction:n}=e;let{selection:i}=n,{doc:r}=n,{storedMarks:o}=n;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),filterTransaction:t.filterTransaction,plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return o},get selection(){return i},get doc(){return r},get tr(){return i=n.selection,r=n.doc,o=n.storedMarks,n}}}"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&os.platform&&os.platform();class em{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:i}=t,{tr:r}=n,o=this.buildProps(r);return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,(...e)=>{const n=t(...e)(o);return r.getMeta("preventDispatch")||this.hasCustomState||i.dispatch(r),n}])))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:i,state:r}=this,{view:o}=i,a=[],s=!!e,c=e||r.tr,u={...Object.fromEntries(Object.entries(n).map((([e,n])=>[e,(...e)=>{const i=this.buildProps(c,t),r=n(...e)(i);return a.push(r),u}]))),run:()=>(s||!t||c.getMeta("preventDispatch")||this.hasCustomState||o.dispatch(c),a.every((e=>!0===e)))};return u}createCan(e){const{rawCommands:t,state:n}=this,i=e||n.tr,r=this.buildProps(i,false);return{...Object.fromEntries(Object.entries(t).map((([e,t])=>[e,(...e)=>t(...e)({...r,dispatch:void 0})]))),chain:()=>this.createChain(i,false)}}buildProps(e,t=!0){const{rawCommands:n,editor:i,state:r}=this,{view:o}=i;r.storedMarks&&e.setStoredMarks(r.storedMarks);const a={tr:e,editor:i,view:o,state:Qg({state:r,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map((([e,t])=>[e,(...e)=>t(...e)(a)])))}};return a}}class tm{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const n=this.callbacks[e];return n&&n.forEach((e=>e.apply(this,t))),this}off(e,t){const n=this.callbacks[e];return n&&(t?this.callbacks[e]=n.filter((e=>e!==t)):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}}function nm(e,t,n){if(void 0===e.config[t]&&e.parent)return nm(e.parent,t,n);if("function"==typeof e.config[t]){return e.config[t].bind({...n,parent:e.parent?nm(e.parent,t,n):null})}return e.config[t]}function im(e){return{baseExtensions:e.filter((e=>"extension"===e.type)),nodeExtensions:e.filter((e=>"node"===e.type)),markExtensions:e.filter((e=>"mark"===e.type))}}function rm(e){const t=[],{nodeExtensions:n,markExtensions:i}=im(e),r=[...n,...i],o={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return e.forEach((e=>{const n=nm(e,"addGlobalAttributes",{name:e.name,options:e.options,storage:e.storage});if(!n)return;n().forEach((e=>{e.types.forEach((n=>{Object.entries(e.attributes).forEach((([e,i])=>{t.push({type:n,name:e,attribute:{...o,...i}})}))}))}))})),r.forEach((e=>{const n={name:e.name,options:e.options,storage:e.storage},i=nm(e,"addAttributes",n);if(!i)return;const r=i();Object.entries(r).forEach((([n,i])=>{const r={...o,...i};"function"==typeof(null==r?void 0:r.default)&&(r.default=r.default()),(null==r?void 0:r.isRequired)&&void 0===(null==r?void 0:r.default)&&delete r.default,t.push({type:e.name,name:n,attribute:r})}))})),t}function om(e,t){if("string"==typeof e){if(!t.nodes[e])throw Error(`There is no node type named '${e}'. Maybe you forgot to add the extension?`);return t.nodes[e]}return e}function am(...e){return e.filter((e=>!!e)).reduce(((e,t)=>{const n={...e};return Object.entries(t).forEach((([e,t])=>{n[e]?n[e]="class"===e?[n[e],t].join(" "):"style"===e?[n[e],t].join("; "):t:n[e]=t})),n}),{})}function sm(e,t){return t.filter((e=>e.attribute.rendered)).map((t=>t.attribute.renderHTML?t.attribute.renderHTML(e.attrs)||{}:{[t.name]:e.attrs[t.name]})).reduce(((e,t)=>am(e,t)),{})}function cm(e){return"function"==typeof e}function um(e,t=void 0,...n){return cm(e)?t?e.bind(t)(...n):e(...n):e}function lm(e,t){return e.style?e:{...e,getAttrs:n=>{const i=e.getAttrs?e.getAttrs(n):e.attrs;if(!1===i)return!1;const r=t.reduce(((e,t)=>{const i=t.attribute.parseHTML?t.attribute.parseHTML(n):function(e){return"string"!=typeof e?e:e.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(e):"true"===e||"false"!==e&&e}(n.getAttribute(t.name));return null==i?e:{...e,[t.name]:i}}),{});return{...i,...r}}}}function dm(e){return Object.fromEntries(Object.entries(e).filter((([e,t])=>("attrs"!==e||!function(e={}){return 0===Object.keys(e).length&&e.constructor===Object}(t))&&null!=t)))}function pm(e,t){return t.nodes[e]||t.marks[e]||null}function hm(e,t){return Array.isArray(t)?t.some((t=>("string"==typeof t?t:t.name)===e.name)):t}const fm=(e,t=500)=>{let n="";const i=e.parentOffset;return e.parent.nodesBetween(Math.max(0,i-t),i,((e,t,r,o)=>{var a,s;const c=(null===(s=(a=e.type.spec).toText)||void 0===s?void 0:s.call(a,{node:e,pos:t,parent:r,index:o}))||e.textContent||"%leaf%";n+=c.slice(0,Math.max(0,i-t))})),n};function gm(e){return"[object RegExp]"===Object.prototype.toString.call(e)}class mm{constructor(e){this.find=e.find,this.handler=e.handler}}const vm=(e,t)=>{if(gm(t))return t.exec(e);const n=t(e);if(!n)return null;const i=[n.text];return i.index=n.index,i.input=e,i.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith),i.push(n.replaceWith)),i};function _m(e){var t;const{editor:n,from:i,to:r,text:o,rules:a,plugin:s}=e,{view:c}=n;if(c.composing)return!1;const u=c.state.doc.resolve(i);if(u.parent.type.spec.code||(null===(t=u.nodeBefore||u.nodeAfter)||void 0===t?void 0:t.marks.find((e=>e.type.spec.code))))return!1;let l=!1;const d=fm(u)+o;return a.forEach((e=>{if(l)return;const t=vm(d,e.find);if(!t)return;const a=c.state.tr,u=Qg({state:c.state,transaction:a}),p={from:i-(t[0].length-o.length),to:r},{commands:h,chain:f,can:g}=new em({editor:n,state:u});null!==e.handler({state:u,range:p,match:t,commands:h,chain:f,can:g})&&a.steps.length&&(a.setMeta(s,{transform:a,from:i,to:r,text:o}),c.dispatch(a),l=!0)})),l}function ym(e){const{editor:t,rules:n}=e,i=new gp({state:{init:()=>null,apply(e,t){const n=e.getMeta(i);return n||(e.selectionSet||e.docChanged?null:t)}},props:{handleTextInput:(e,r,o,a)=>_m({editor:t,from:r,to:o,text:a,rules:n,plugin:i}),handleDOMEvents:{compositionend:e=>(setTimeout((()=>{const{$cursor:r}=e.state.selection;r&&_m({editor:t,from:r.pos,to:r.pos,text:"",rules:n,plugin:i})})),!1)},handleKeyDown(e,r){if("Enter"!==r.key)return!1;const{$cursor:o}=e.state.selection;return!!o&&_m({editor:t,from:o.pos,to:o.pos,text:"\n",rules:n,plugin:i})}},isInputRules:!0});return i}const Im=(e,t)=>{if(gm(t))return[...e.matchAll(t)];const n=t(e);return n?n.map((t=>{const n=[t.text];return n.index=t.index,n.input=e,n.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith),n.push(t.replaceWith)),n})):[]};function Mm(e){const{editor:t,rules:n}=e;let i=null,r=!1,o=!1;const a=n.map((e=>new gp({view(e){const t=t=>{var n;i=(null===(n=e.dom.parentElement)||void 0===n?void 0:n.contains(t.target))?e.dom.parentElement:null};return window.addEventListener("dragstart",t),{destroy(){window.removeEventListener("dragstart",t)}}},props:{handleDOMEvents:{drop:e=>(o=i===e.dom.parentElement,!1),paste:(e,t)=>{var n;const i=null===(n=t.clipboardData)||void 0===n?void 0:n.getData("text/html");return r=!!(null==i?void 0:i.includes("data-pm-slice")),!1}}},appendTransaction:(n,i,a)=>{const s=n[0],c="paste"===s.getMeta("uiEvent")&&!r,u="drop"===s.getMeta("uiEvent")&&!o;if(!c&&!u)return;const l=i.doc.content.findDiffStart(a.doc.content),d=i.doc.content.findDiffEnd(a.doc.content);if("number"!=typeof l||!d||l===d.b)return;const p=a.tr,h=Qg({state:a,transaction:p}),f=function(e){const{editor:t,state:n,from:i,to:r,rule:o}=e,{commands:a,chain:s,can:c}=new em({editor:t,state:n}),u=[];return n.doc.nodesBetween(i,r,((e,t)=>{if(!e.isTextblock||e.type.spec.code)return;const l=Math.max(i,t),d=Math.min(r,t+e.content.size),p=e.textBetween(l-t,d-t,void 0,"￼");Im(p,o.find).forEach((e=>{if(void 0===e.index)return;const t=l+e.index+1,i=t+e[0].length,r={from:n.tr.mapping.map(t),to:n.tr.mapping.map(i)},d=o.handler({state:n,range:r,match:e,commands:a,chain:s,can:c});u.push(d)}))})),u.every((e=>null!==e))}({editor:t,state:h,from:Math.max(l-1,0),to:d.b-1,rule:e});return f&&p.steps.length?p:void 0}})));return a}class Tm{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=Tm.resolve(e),this.schema=function(e,t){var n;const i=rm(e),{nodeExtensions:r,markExtensions:o}=im(e),a=null===(n=r.find((e=>nm(e,"topNode"))))||void 0===n?void 0:n.name,s=Object.fromEntries(r.map((n=>{const r=i.filter((e=>e.type===n.name)),o={name:n.name,options:n.options,storage:n.storage,editor:t},a=dm({...e.reduce(((e,t)=>{const i=nm(t,"extendNodeSchema",o);return{...e,...i?i(n):{}}}),{}),content:um(nm(n,"content",o)),marks:um(nm(n,"marks",o)),group:um(nm(n,"group",o)),inline:um(nm(n,"inline",o)),atom:um(nm(n,"atom",o)),selectable:um(nm(n,"selectable",o)),draggable:um(nm(n,"draggable",o)),code:um(nm(n,"code",o)),defining:um(nm(n,"defining",o)),isolating:um(nm(n,"isolating",o)),attrs:Object.fromEntries(r.map((e=>{var t;return[e.name,{default:null===(t=null==e?void 0:e.attribute)||void 0===t?void 0:t.default}]})))}),s=um(nm(n,"parseHTML",o));s&&(a.parseDOM=s.map((e=>lm(e,r))));const c=nm(n,"renderHTML",o);c&&(a.toDOM=e=>c({node:e,HTMLAttributes:sm(e,r)}));const u=nm(n,"renderText",o);return u&&(a.toText=u),[n.name,a]}))),c=Object.fromEntries(o.map((n=>{const r=i.filter((e=>e.type===n.name)),o={name:n.name,options:n.options,storage:n.storage,editor:t},a=dm({...e.reduce(((e,t)=>{const i=nm(t,"extendMarkSchema",o);return{...e,...i?i(n):{}}}),{}),inclusive:um(nm(n,"inclusive",o)),excludes:um(nm(n,"excludes",o)),group:um(nm(n,"group",o)),spanning:um(nm(n,"spanning",o)),code:um(nm(n,"code",o)),attrs:Object.fromEntries(r.map((e=>{var t;return[e.name,{default:null===(t=null==e?void 0:e.attribute)||void 0===t?void 0:t.default}]})))}),s=um(nm(n,"parseHTML",o));s&&(a.parseDOM=s.map((e=>lm(e,r))));const c=nm(n,"renderHTML",o);return c&&(a.toDOM=e=>c({mark:e,HTMLAttributes:sm(e,r)})),[n.name,a]})));return new $l({topNode:a,nodes:s,marks:c})}(this.extensions,t),this.extensions.forEach((e=>{var t;this.editor.extensionStorage[e.name]=e.storage;const n={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:pm(e.name,this.schema)};if("mark"===e.type){(null===(t=um(nm(e,"keepOnSplit",n)))||void 0===t||t)&&this.splittableMarks.push(e.name)}const i=nm(e,"onBeforeCreate",n);i&&this.editor.on("beforeCreate",i);const r=nm(e,"onCreate",n);r&&this.editor.on("create",r);const o=nm(e,"onUpdate",n);o&&this.editor.on("update",o);const a=nm(e,"onSelectionUpdate",n);a&&this.editor.on("selectionUpdate",a);const s=nm(e,"onTransaction",n);s&&this.editor.on("transaction",s);const c=nm(e,"onFocus",n);c&&this.editor.on("focus",c);const u=nm(e,"onBlur",n);u&&this.editor.on("blur",u);const l=nm(e,"onDestroy",n);l&&this.editor.on("destroy",l)}))}static resolve(e){const t=Tm.sort(Tm.flatten(e));return function(e){const t=e.filter(((t,n)=>e.indexOf(t)!==n));return[...new Set(t)]}(t.map((e=>e.name))).length,t}static flatten(e){return e.map((e=>{const t=nm(e,"addExtensions",{name:e.name,options:e.options,storage:e.storage});return t?[e,...this.flatten(t())]:e})).flat(10)}static sort(e){return e.sort(((e,t)=>{const n=nm(e,"priority")||100,i=nm(t,"priority")||100;return n>i?-1:n<i?1:0}))}get commands(){return this.extensions.reduce(((e,t)=>{const n=nm(t,"addCommands",{name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:pm(t.name,this.schema)});return n?{...e,...n()}:e}),{})}get plugins(){const{editor:e}=this,t=Tm.sort([...this.extensions].reverse()),n=[],i=[],r=t.map((t=>{const r={name:t.name,options:t.options,storage:t.storage,editor:e,type:pm(t.name,this.schema)},o=[],a=nm(t,"addKeyboardShortcuts",r);let s={};if("mark"===t.type&&t.config.exitable&&(s.ArrowRight=()=>uv.handleExit({editor:e,mark:t})),a){const t=Object.fromEntries(Object.entries(a()).map((([t,n])=>[t,()=>n({editor:e})])));s={...s,...t}}const c=new gp({props:{handleKeyDown:qg(s)}});o.push(c);const u=nm(t,"addInputRules",r);hm(t,e.options.enableInputRules)&&u&&n.push(...u());const l=nm(t,"addPasteRules",r);hm(t,e.options.enablePasteRules)&&l&&i.push(...l());const d=nm(t,"addProseMirrorPlugins",r);if(d){const e=d();o.push(...e)}return o})).flat();return[ym({editor:e,rules:n}),...Mm({editor:e,rules:i}),...r]}get attributes(){return rm(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=im(this.extensions);return Object.fromEntries(t.filter((e=>!!nm(e,"addNodeView"))).map((t=>{const n=this.attributes.filter((e=>e.type===t.name)),i={name:t.name,options:t.options,storage:t.storage,editor:e,type:om(t.name,this.schema)},r=nm(t,"addNodeView",i);if(!r)return[];return[t.name,(i,o,a,s)=>{const c=sm(i,n);return r()({editor:e,node:i,getPos:a,decorations:s,HTMLAttributes:c,extension:t})}]})))}}function Cm(e){return"Object"===function(e){return Object.prototype.toString.call(e).slice(8,-1)}(e)&&(e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype)}function Sm(e,t){const n={...e};return Cm(e)&&Cm(t)&&Object.keys(t).forEach((i=>{Cm(t[i])?i in e?n[i]=Sm(e[i],t[i]):Object.assign(n,{[i]:t[i]}):Object.assign(n,{[i]:t[i]})})),n}class Em{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions,this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=um(nm(this,"addOptions",{name:this.name}))),this.storage=um(nm(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Em(e)}configure(e={}){const t=this.extend();return t.options=Sm(this.options,e),t.storage=um(nm(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new Em(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions,t.options=um(nm(t,"addOptions",{name:t.name})),t.storage=um(nm(t,"addStorage",{name:t.name,options:t.options})),t}}function km(e,t,n){const{from:i,to:r}=t,{blockSeparator:o="\n\n",textSerializers:a={}}=n||{};let s="",c=!0;return e.nodesBetween(i,r,((e,n,u,l)=>{var d;const p=null==a?void 0:a[e.type.name];p?(e.isBlock&&!c&&(s+=o,c=!0),u&&(s+=p({node:e,pos:n,parent:u,index:l,range:t}))):e.isText?(s+=null===(d=null==e?void 0:e.text)||void 0===d?void 0:d.slice(Math.max(i,n)-n,r-n),c=!1):e.isBlock&&!c&&(s+=o,c=!0)})),s}function bm(e){return Object.fromEntries(Object.entries(e.nodes).filter((([,e])=>e.spec.toText)).map((([e,t])=>[e,t.spec.toText])))}const Dm=Em.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new gp({key:new _p("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:e}=this,{state:t,schema:n}=e,{doc:i,selection:r}=t,{ranges:o}=r;return km(i,{from:Math.min(...o.map((e=>e.$from.pos))),to:Math.max(...o.map((e=>e.$to.pos)))},{textSerializers:bm(n)})}}})]}});function wm(e,t,n={strict:!0}){const i=Object.keys(t);return!i.length||i.every((i=>n.strict?t[i]===e[i]:gm(t[i])?t[i].test(e[i]):t[i]===e[i]))}function Am(e,t,n={}){return e.find((e=>e.type===t&&wm(e.attrs,n)))}function Rm(e,t,n={}){return!!Am(e,t,n)}function Lm(e,t,n={}){if(!e||!t)return;let i=e.parent.childAfter(e.parentOffset);if(e.parentOffset===i.offset&&0!==i.offset&&(i=e.parent.childBefore(e.parentOffset)),!i.node)return;const r=Am([...i.node.marks],t,n);if(!r)return;let o=i.index,a=e.start()+i.offset,s=o+1,c=a+i.node.nodeSize;for(Am([...i.node.marks],t,n);o>0&&r.isInSet(e.parent.child(o-1).marks);)o-=1,a-=e.parent.child(o).nodeSize;for(;s<e.parent.childCount&&Rm([...e.parent.child(s).marks],t,n);)c+=e.parent.child(s).nodeSize,s+=1;return{from:a,to:c}}function Om(e,t){if("string"==typeof e){if(!t.marks[e])throw Error(`There is no mark type named '${e}'. Maybe you forgot to add the extension?`);return t.marks[e]}return e}function Nm(e){return e instanceof ep}function Pm(e=0,t=0,n=0){return Math.min(Math.max(e,t),n)}function Um(e,t=null){if(!t)return null;const n=Jd.atStart(e),i=Jd.atEnd(e);if("start"===t||!0===t)return n;if("end"===t)return i;const r=n.from,o=i.to;return"all"===t?ep.create(e,Pm(0,r,o),Pm(e.content.size,r,o)):ep.create(e,Pm(t,r,o),Pm(t,r,o))}function xm(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function Gm(e){const t=`<body>${e}</body>`;return(new window.DOMParser).parseFromString(t,"text/html").body}function Fm(e,t,n){if(n={slice:!0,parseOptions:{},...n},"object"==typeof e&&null!==e)try{return Array.isArray(e)&&e.length>0?sl.fromArray(e.map((e=>t.nodeFromJSON(e)))):t.nodeFromJSON(e)}catch(i){return Fm("",t,n)}if("string"==typeof e){const i=Xl.fromSchema(t);return n.slice?i.parseSlice(Gm(e),n.parseOptions).content:i.parse(Gm(e),n.parseOptions)}return Fm("",t,n)}function Vm(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}function qm(e,t,n={}){const{from:i,to:r,empty:o}=e.selection,a=t?om(t,e.schema):null,s=[];e.doc.nodesBetween(i,r,((e,t)=>{if(e.isText)return;const n=Math.max(i,t),o=Math.min(r,t+e.nodeSize);s.push({node:e,from:n,to:o})}));const c=r-i,u=s.filter((e=>!a||a.name===e.node.type.name)).filter((e=>wm(e.node.attrs,n,{strict:!1})));if(o)return!!u.length;return u.reduce(((e,t)=>e+t.to-t.from),0)>=c}function Bm(e,t){return t.nodes[e]?"node":t.marks[e]?"mark":null}function Hm(e,t){const n="string"==typeof t?[t]:t;return Object.keys(e).reduce(((t,i)=>(n.includes(i)||(t[i]=e[i]),t)),{})}function jm(e,t,n={}){return Fm(e,t,{slice:!1,parseOptions:n})}function Km(e){return t=>function(e,t){for(let n=e.depth;n>0;n-=1){const i=e.node(n);if(t(i))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:i}}}(t.$from,e)}function zm(e,t){const n=Om(t,e.schema),{from:i,to:r,empty:o}=e.selection,a=[];o?(e.storedMarks&&a.push(...e.storedMarks),a.push(...e.selection.$head.marks())):e.doc.nodesBetween(i,r,(e=>{a.push(...e.marks)}));const s=a.find((e=>e.type.name===n.name));return s?{...s.attrs}:{}}function Wm(e,t){const n=Bm("string"==typeof t?t:t.name,e.schema);return"node"===n?function(e,t){const n=om(t,e.schema),{from:i,to:r}=e.selection,o=[];e.doc.nodesBetween(i,r,(e=>{o.push(e)}));const a=o.reverse().find((e=>e.type.name===n.name));return a?{...a.attrs}:{}}(e,t):"mark"===n?zm(e,t):{}}function Ym(e,t,n){return Object.fromEntries(Object.entries(n).filter((([n])=>{const i=e.find((e=>e.type===t&&e.name===n));return!!i&&i.attribute.keepOnSplit})))}function $m(e,t,n={}){const{empty:i,ranges:r}=e.selection,o=t?Om(t,e.schema):null;if(i)return!!(e.storedMarks||e.selection.$from.marks()).filter((e=>!o||o.name===e.type.name)).find((e=>wm(e.attrs,n,{strict:!1})));let a=0;const s=[];if(r.forEach((({$from:t,$to:n})=>{const i=t.pos,r=n.pos;e.doc.nodesBetween(i,r,((e,t)=>{if(!e.isText&&!e.marks.length)return;const n=Math.max(i,t),o=Math.min(r,t+e.nodeSize);a+=o-n,s.push(...e.marks.map((e=>({mark:e,from:n,to:o}))))}))})),0===a)return!1;const c=s.filter((e=>!o||o.name===e.mark.type.name)).filter((e=>wm(e.mark.attrs,n,{strict:!1}))).reduce(((e,t)=>e+t.to-t.from),0),u=s.filter((e=>!o||e.mark.type!==o&&e.mark.type.excludes(o))).reduce(((e,t)=>e+t.to-t.from),0);return(c>0?c+u:c)>=a}function Jm(e,t){const{nodeExtensions:n}=im(t),i=n.find((t=>t.name===e));if(!i)return!1;const r=um(nm(i,"group",{name:i.name,options:i.options,storage:i.storage}));return"string"==typeof r&&r.split(" ").includes("list")}function Xm(e,t,n){const i=e.state.doc.content.size,r=Pm(t,0,i),o=Pm(n,0,i),a=e.coordsAtPos(r),s=e.coordsAtPos(o,-1),c=Math.min(a.top,s.top),u=Math.max(a.bottom,s.bottom),l=Math.min(a.left,s.left),d=Math.max(a.right,s.right),p={top:c,bottom:u,left:l,right:d,width:d-l,height:u-c,x:l,y:c};return{...p,toJSON:()=>p}}function Zm(e,t){const n=e.storedMarks||e.selection.$to.parentOffset&&e.selection.$from.marks();if(n){const i=n.filter((e=>null==t?void 0:t.includes(e.type.name)));e.tr.ensureMarks(i)}}const Qm=(e,t)=>{const n=Km((e=>e.type===t))(e.selection);if(!n)return!0;const i=e.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(void 0===i)return!0;const r=e.doc.nodeAt(i);return n.node.type!==(null==r?void 0:r.type)||!Rd(e.doc,n.pos)||(e.join(n.pos),!0)},ev=(e,t)=>{const n=Km((e=>e.type===t))(e.selection);if(!n)return!0;const i=e.doc.resolve(n.start).after(n.depth);if(void 0===i)return!0;const r=e.doc.nodeAt(i);return n.node.type!==(null==r?void 0:r.type)||!Rd(e.doc,i)||(e.join(i),!0)};var tv=Object.freeze({__proto__:null,blur:()=>({editor:e,view:t})=>(requestAnimationFrame((()=>{var n;e.isDestroyed||(t.dom.blur(),null===(n=null===window||void 0===window?void 0:window.getSelection())||void 0===n||n.removeAllRanges())})),!0),clearContent:(e=!1)=>({commands:t})=>t.setContent("",e),clearNodes:()=>({state:e,tr:t,dispatch:n})=>{const{selection:i}=t,{ranges:r}=i;return!n||(r.forEach((({$from:n,$to:i})=>{e.doc.nodesBetween(n.pos,i.pos,((e,n)=>{if(e.type.isText)return;const{doc:i,mapping:r}=t,o=i.resolve(r.map(n)),a=i.resolve(r.map(n+e.nodeSize)),s=o.blockRange(a);if(!s)return;const c=bd(s);if(e.type.isTextblock){const{defaultType:e}=o.parent.contentMatchAt(o.index());t.setNodeMarkup(s.start,e)}(c||0===c)&&t.lift(s,c)}))})),!0)},command:e=>t=>e(t),createParagraphNear:()=>({state:e,dispatch:t})=>((e,t)=>{let n=e.selection,{$from:i,$to:r}=n;if(n instanceof rp||i.parent.inlineContent||r.parent.inlineContent)return!1;let o=Kg(r.parent.contentMatchAt(r.indexAfter()));if(!o||!o.isTextblock)return!1;if(t){let n=(!i.parentOffset&&r.index()<r.parent.childCount?i:r).pos,a=e.tr.insert(n,o.createAndFill());a.setSelection(ep.create(a.doc,n+1)),t(a.scrollIntoView())}return!0})(e,t),deleteCurrentNode:()=>({tr:e,dispatch:t})=>{const{selection:n}=e,i=n.$anchor.node();if(i.content.size>0)return!1;const r=e.selection.$anchor;for(let o=r.depth;o>0;o-=1){if(r.node(o).type===i.type){if(t){const t=r.before(o),n=r.after(o);e.delete(t,n).scrollIntoView()}return!0}}return!1},deleteNode:e=>({tr:t,state:n,dispatch:i})=>{const r=om(e,n.schema),o=t.selection.$anchor;for(let e=o.depth;e>0;e-=1){if(o.node(e).type===r){if(i){const n=o.before(e),i=o.after(e);t.delete(n,i).scrollIntoView()}return!0}}return!1},deleteRange:e=>({tr:t,dispatch:n})=>{const{from:i,to:r}=e;return n&&t.delete(i,r),!0},deleteSelection:()=>({state:e,dispatch:t})=>((e,t)=>!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0))(e,t),enter:()=>({commands:e})=>e.keyboardShortcut("Enter"),exitCode:()=>({state:e,dispatch:t})=>((e,t)=>{let{$head:n,$anchor:i}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(i))return!1;let r=n.node(-1),o=n.indexAfter(-1),a=Kg(r.contentMatchAt(o));if(!a||!r.canReplaceWith(o,o,a))return!1;if(t){let i=n.after(),r=e.tr.replaceWith(i,i,a.createAndFill());r.setSelection(Jd.near(r.doc.resolve(i),1)),t(r.scrollIntoView())}return!0})(e,t),extendMarkRange:(e,t={})=>({tr:n,state:i,dispatch:r})=>{const o=Om(e,i.schema),{doc:a,selection:s}=n,{$from:c,from:u,to:l}=s;if(r){const e=Lm(c,o,t);if(e&&e.from<=u&&e.to>=l){const t=ep.create(a,e.from,e.to);n.setSelection(t)}}return!0},first:e=>t=>{const n="function"==typeof e?e(t):e;for(let e=0;e<n.length;e+=1)if(n[e](t))return!0;return!1},focus:(e=null,t={})=>({editor:n,view:i,tr:r,dispatch:o})=>{t={scrollIntoView:!0,...t};const a=()=>{xm()&&i.dom.focus(),requestAnimationFrame((()=>{n.isDestroyed||(i.focus(),(null==t?void 0:t.scrollIntoView)&&n.commands.scrollIntoView())}))};if(i.hasFocus()&&null===e||!1===e)return!0;if(o&&null===e&&!Nm(n.state.selection))return a(),!0;const s=Um(r.doc,e)||n.state.selection,c=n.state.selection.eq(s);return o&&(c||r.setSelection(s),c&&r.storedMarks&&r.setStoredMarks(r.storedMarks),a()),!0},forEach:(e,t)=>n=>e.every(((e,i)=>t(e,{...n,index:i}))),insertContent:(e,t)=>({tr:n,commands:i})=>i.insertContentAt({from:n.selection.from,to:n.selection.to},e,t),insertContentAt:(e,t,n)=>({tr:i,dispatch:r,editor:o})=>{if(r){n={parseOptions:{},updateSelection:!0,...n};const r=Fm(t,o.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions}});if("<>"===r.toString())return!0;let{from:a,to:s}="number"==typeof e?{from:e,to:e}:e,c=!0,u=!0;if((r.toString().startsWith("<")?r:[r]).forEach((e=>{e.check(),c=!!c&&(e.isText&&0===e.marks.length),u=!!u&&e.isBlock})),a===s&&u){const{parent:e}=i.doc.resolve(a);e.isTextblock&&!e.type.spec.code&&!e.childCount&&(a-=1,s+=1)}c?Array.isArray(t)?i.insertText(t.map((e=>e.text||"")).join(""),a,s):"object"==typeof t&&t&&t.text?i.insertText(t.text,a,s):i.insertText(t,a,s):i.replaceWith(a,s,r),n.updateSelection&&function(e,t,n){const i=e.steps.length-1;if(i<t)return;const r=e.steps[i];if(!(r instanceof Cd||r instanceof Sd))return;const o=e.mapping.maps[i];let a=0;o.forEach(((e,t,n,i)=>{0===a&&(a=i)})),e.setSelection(Jd.near(e.doc.resolve(a),n))}(i,i.steps.length-1,-1)}return!0},joinUp:()=>({state:e,dispatch:t})=>((e,t)=>{let n,i=e.selection,r=i instanceof np;if(r){if(i.node.isTextblock||!Rd(e.doc,i.from))return!1;n=i.from}else if(n=Od(e.doc,i.from,-1),null==n)return!1;if(t){let i=e.tr.join(n);r&&i.setSelection(np.create(i.doc,n-e.doc.resolve(n).nodeBefore.nodeSize)),t(i.scrollIntoView())}return!0})(e,t),joinDown:()=>({state:e,dispatch:t})=>((e,t)=>{let n,i=e.selection;if(i instanceof np){if(i.node.isTextblock||!Rd(e.doc,i.to))return!1;n=i.to}else if(n=Od(e.doc,i.to,1),null==n)return!1;return t&&t(e.tr.join(n).scrollIntoView()),!0})(e,t),joinBackward:()=>({state:e,dispatch:t})=>((e,t,n)=>{let i=function(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("backward",e):n.parentOffset>0)?null:n}(e,n);if(!i)return!1;let r=Hg(i);if(!r){let n=i.blockRange(),r=n&&bd(n);return null!=r&&(t&&t(e.tr.lift(n,r).scrollIntoView()),!0)}let o=r.nodeBefore;if(!o.type.spec.isolating&&zg(e,r,t))return!0;if(0==i.parent.content.size&&(Bg(o,"end")||np.isSelectable(o))){let n=Nd(e.doc,i.before(),i.after(),hl.empty);if(n&&n.slice.size<n.to-n.from){if(t){let i=e.tr.step(n);i.setSelection(Bg(o,"end")?Jd.findFrom(i.doc.resolve(i.mapping.map(r.pos,-1)),-1):np.create(i.doc,r.pos-o.nodeSize)),t(i.scrollIntoView())}return!0}}return!(!o.isAtom||r.depth!=i.depth-1||(t&&t(e.tr.delete(r.pos-o.nodeSize,r.pos).scrollIntoView()),0))})(e,t),joinForward:()=>({state:e,dispatch:t})=>((e,t,n)=>{let i=function(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("forward",e):n.parentOffset<n.parent.content.size)?null:n}(e,n);if(!i)return!1;let r=jg(i);if(!r)return!1;let o=r.nodeAfter;if(zg(e,r,t))return!0;if(0==i.parent.content.size&&(Bg(o,"start")||np.isSelectable(o))){let n=Nd(e.doc,i.before(),i.after(),hl.empty);if(n&&n.slice.size<n.to-n.from){if(t){let i=e.tr.step(n);i.setSelection(Bg(o,"start")?Jd.findFrom(i.doc.resolve(i.mapping.map(r.pos)),1):np.create(i.doc,i.mapping.map(r.pos))),t(i.scrollIntoView())}return!0}}return!(!o.isAtom||r.depth!=i.depth-1||(t&&t(e.tr.delete(r.pos,r.pos+o.nodeSize).scrollIntoView()),0))})(e,t),keyboardShortcut:e=>({editor:t,view:n,tr:i,dispatch:r})=>{const o=function(e){const t=e.split(/-(?!$)/);let n,i,r,o,a=t[t.length-1];"Space"===a&&(a=" ");for(let s=0;s<t.length-1;s+=1){const e=t[s];if(/^(cmd|meta|m)$/i.test(e))o=!0;else if(/^a(lt)?$/i.test(e))n=!0;else if(/^(c|ctrl|control)$/i.test(e))i=!0;else if(/^s(hift)?$/i.test(e))r=!0;else{if(!/^mod$/i.test(e))throw new Error(`Unrecognized modifier name: ${e}`);xm()||Vm()?o=!0:i=!0}}return n&&(a=`Alt-${a}`),i&&(a=`Ctrl-${a}`),o&&(a=`Meta-${a}`),r&&(a=`Shift-${a}`),a}(e).split(/-(?!$)/),a=o.find((e=>!["Alt","Ctrl","Meta","Shift"].includes(e))),s=new KeyboardEvent("keydown",{key:"Space"===a?" ":a,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),c=t.captureTransaction((()=>{n.someProp("handleKeyDown",(e=>e(n,s)))}));return null==c||c.steps.forEach((e=>{const t=e.map(i.mapping);t&&r&&i.maybeStep(t)})),!0},lift:(e,t={})=>({state:n,dispatch:i})=>!!qm(n,om(e,n.schema),t)&&((e,t)=>{let{$from:n,$to:i}=e.selection,r=n.blockRange(i),o=r&&bd(r);return null!=o&&(t&&t(e.tr.lift(r,o).scrollIntoView()),!0)})(n,i),liftEmptyBlock:()=>({state:e,dispatch:t})=>((e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let i=n.before();if(Ad(e.doc,i))return t&&t(e.tr.split(i).scrollIntoView()),!0}let i=n.blockRange(),r=i&&bd(i);return null!=r&&(t&&t(e.tr.lift(i,r).scrollIntoView()),!0)})(e,t),liftListItem:e=>({state:t,dispatch:n})=>Zg(om(e,t.schema))(t,n),newlineInCode:()=>({state:e,dispatch:t})=>((e,t)=>{let{$head:n,$anchor:i}=e.selection;return!(!n.parent.type.spec.code||!n.sameParent(i)||(t&&t(e.tr.insertText("\n").scrollIntoView()),0))})(e,t),resetAttributes:(e,t)=>({tr:n,state:i,dispatch:r})=>{let o=null,a=null;const s=Bm("string"==typeof e?e:e.name,i.schema);return!!s&&("node"===s&&(o=om(e,i.schema)),"mark"===s&&(a=Om(e,i.schema)),r&&n.selection.ranges.forEach((e=>{i.doc.nodesBetween(e.$from.pos,e.$to.pos,((e,i)=>{o&&o===e.type&&n.setNodeMarkup(i,void 0,Hm(e.attrs,t)),a&&e.marks.length&&e.marks.forEach((r=>{a===r.type&&n.addMark(i,i+e.nodeSize,a.create(Hm(r.attrs,t)))}))}))})),!0)},scrollIntoView:()=>({tr:e,dispatch:t})=>(t&&e.scrollIntoView(),!0),selectAll:()=>({tr:e,commands:t})=>t.setTextSelection({from:0,to:e.doc.content.size}),selectNodeBackward:()=>({state:e,dispatch:t})=>((e,t,n)=>{let{$head:i,empty:r}=e.selection,o=i;if(!r)return!1;if(i.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):i.parentOffset>0)return!1;o=Hg(i)}let a=o&&o.nodeBefore;return!(!a||!np.isSelectable(a)||(t&&t(e.tr.setSelection(np.create(e.doc,o.pos-a.nodeSize)).scrollIntoView()),0))})(e,t),selectNodeForward:()=>({state:e,dispatch:t})=>((e,t,n)=>{let{$head:i,empty:r}=e.selection,o=i;if(!r)return!1;if(i.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):i.parentOffset<i.parent.content.size)return!1;o=jg(i)}let a=o&&o.nodeAfter;return!(!a||!np.isSelectable(a)||(t&&t(e.tr.setSelection(np.create(e.doc,o.pos)).scrollIntoView()),0))})(e,t),selectParentNode:()=>({state:e,dispatch:t})=>((e,t)=>{let n,{$from:i,to:r}=e.selection,o=i.sharedDepth(r);return 0!=o&&(n=i.before(o),t&&t(e.tr.setSelection(np.create(e.doc,n))),!0)})(e,t),selectTextblockEnd:()=>({state:e,dispatch:t})=>$g(e,t),selectTextblockStart:()=>({state:e,dispatch:t})=>Yg(e,t),setContent:(e,t=!1,n={})=>({tr:i,editor:r,dispatch:o})=>{const{doc:a}=i,s=jm(e,r.schema,n);return o&&i.replaceWith(0,a.content.size,s).setMeta("preventUpdate",!t),!0},setMark:(e,t={})=>({tr:n,state:i,dispatch:r})=>{const{selection:o}=n,{empty:a,ranges:s}=o,c=Om(e,i.schema);if(r)if(a){const e=zm(i,c);n.addStoredMark(c.create({...e,...t}))}else s.forEach((e=>{const r=e.$from.pos,o=e.$to.pos;i.doc.nodesBetween(r,o,((e,i)=>{const a=Math.max(i,r),s=Math.min(i+e.nodeSize,o);e.marks.find((e=>e.type===c))?e.marks.forEach((e=>{c===e.type&&n.addMark(a,s,c.create({...e.attrs,...t}))})):n.addMark(a,s,c.create(t))}))}));return function(e,t,n){var i;const{selection:r}=t;let o=null;if(Nm(r)&&(o=r.$cursor),o){const t=null!==(i=e.storedMarks)&&void 0!==i?i:o.marks();return!!n.isInSet(t)||!t.some((e=>e.type.excludes(n)))}const{ranges:a}=r;return a.some((({$from:t,$to:i})=>{let r=0===t.depth&&e.doc.inlineContent&&e.doc.type.allowsMarkType(n);return e.doc.nodesBetween(t.pos,i.pos,((e,t,i)=>{if(r)return!1;if(e.isInline){const t=!i||i.type.allowsMarkType(n),o=!!n.isInSet(e.marks)||!e.marks.some((e=>e.type.excludes(n)));r=t&&o}return!r})),r}))}(i,n,c)},setMeta:(e,t)=>({tr:n})=>(n.setMeta(e,t),!0),setNode:(e,t={})=>({state:n,dispatch:i,chain:r})=>{const o=om(e,n.schema);return!!o.isTextblock&&r().command((({commands:e})=>!!Jg(o,t)(n)||e.clearNodes())).command((({state:e})=>Jg(o,t)(e,i))).run()},setNodeSelection:e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,i=Pm(e,0,n.content.size),r=np.create(n,i);t.setSelection(r)}return!0},setTextSelection:e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,{from:i,to:r}="number"==typeof e?{from:e,to:e}:e,o=ep.atStart(n).from,a=ep.atEnd(n).to,s=Pm(i,o,a),c=Pm(r,o,a),u=ep.create(n,s,c);t.setSelection(u)}return!0},sinkListItem:e=>({state:t,dispatch:n})=>{const i=om(e,t.schema);return(r=i,function(e,t){let{$from:n,$to:i}=e.selection,o=n.blockRange(i,(e=>e.childCount>0&&e.firstChild.type==r));if(!o)return!1;let a=o.startIndex;if(0==a)return!1;let s=o.parent,c=s.child(a-1);if(c.type!=r)return!1;if(t){let n=c.lastChild&&c.lastChild.type==s.type,i=sl.from(n?r.create():null),a=new hl(sl.from(r.create(null,sl.from(s.type.create(null,i)))),n?3:1,0),u=o.start,l=o.end;t(e.tr.step(new Sd(u-(n?3:1),l,u,l,a,1,!0)).scrollIntoView())}return!0})(t,n);var r},splitBlock:({keepMarks:e=!0}={})=>({tr:t,state:n,dispatch:i,editor:r})=>{const{selection:o,doc:a}=t,{$from:s,$to:c}=o,u=Ym(r.extensionManager.attributes,s.node().type.name,s.node().attrs);if(o instanceof np&&o.node.isBlock)return!(!s.parentOffset||!Ad(a,s.pos))&&(i&&(e&&Zm(n,r.extensionManager.splittableMarks),t.split(s.pos).scrollIntoView()),!0);if(!s.parent.isBlock)return!1;if(i){const i=c.parentOffset===c.parent.content.size;o instanceof ep&&t.deleteSelection();const a=0===s.depth?void 0:function(e){for(let t=0;t<e.edgeCount;t+=1){const{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}(s.node(-1).contentMatchAt(s.indexAfter(-1)));let l=i&&a?[{type:a,attrs:u}]:void 0,d=Ad(t.doc,t.mapping.map(s.pos),1,l);if(l||d||!Ad(t.doc,t.mapping.map(s.pos),1,a?[{type:a}]:void 0)||(d=!0,l=a?[{type:a,attrs:u}]:void 0),d&&(t.split(t.mapping.map(s.pos),1,l),a&&!i&&!s.parentOffset&&s.parent.type!==a)){const e=t.mapping.map(s.before()),n=t.doc.resolve(e);s.node(-1).canReplaceWith(n.index(),n.index()+1,a)&&t.setNodeMarkup(t.mapping.map(s.before()),a)}e&&Zm(n,r.extensionManager.splittableMarks),t.scrollIntoView()}return!0},splitListItem:e=>({tr:t,state:n,dispatch:i,editor:r})=>{var o;const a=om(e,n.schema),{$from:s,$to:c}=n.selection,u=n.selection.node;if(u&&u.isBlock||s.depth<2||!s.sameParent(c))return!1;const l=s.node(-1);if(l.type!==a)return!1;const d=r.extensionManager.attributes;if(0===s.parent.content.size&&s.node(-1).childCount===s.indexAfter(-1)){if(2===s.depth||s.node(-3).type!==a||s.index(-2)!==s.node(-2).childCount-1)return!1;if(i){let e=sl.empty;const n=s.index(-1)?1:s.index(-2)?2:3;for(let t=s.depth-n;t>=s.depth-3;t-=1)e=sl.from(s.node(t).copy(e));const i=s.indexAfter(-1)<s.node(-2).childCount?1:s.indexAfter(-2)<s.node(-3).childCount?2:3,r=Ym(d,s.node().type.name,s.node().attrs),c=(null===(o=a.contentMatch.defaultType)||void 0===o?void 0:o.createAndFill(r))||void 0;e=e.append(sl.from(a.createAndFill(null,c)||void 0));const u=s.before(s.depth-(n-1));t.replace(u,s.after(-i),new hl(e,4-n,0));let l=-1;t.doc.nodesBetween(u,t.doc.content.size,((e,t)=>{if(l>-1)return!1;e.isTextblock&&0===e.content.size&&(l=t+1)})),l>-1&&t.setSelection(ep.near(t.doc.resolve(l))),t.scrollIntoView()}return!0}const p=c.pos===s.end()?l.contentMatchAt(0).defaultType:null,h=Ym(d,l.type.name,l.attrs),f=Ym(d,s.node().type.name,s.node().attrs);t.delete(s.pos,c.pos);const g=p?[{type:a,attrs:h},{type:p,attrs:f}]:[{type:a,attrs:h}];if(!Ad(t.doc,s.pos,2))return!1;if(i){const{selection:e,storedMarks:o}=n,{splittableMarks:a}=r.extensionManager,c=o||e.$to.parentOffset&&e.$from.marks();if(t.split(s.pos,2,g).scrollIntoView(),!c||!i)return!0;const u=c.filter((e=>a.includes(e.type.name)));t.ensureMarks(u)}return!0},toggleList:(e,t,n,i={})=>({editor:r,tr:o,state:a,dispatch:s,chain:c,commands:u,can:l})=>{const{extensions:d,splittableMarks:p}=r.extensionManager,h=om(e,a.schema),f=om(t,a.schema),{selection:g,storedMarks:m}=a,{$from:v,$to:_}=g,y=v.blockRange(_),I=m||g.$to.parentOffset&&g.$from.marks();if(!y)return!1;const M=Km((e=>Jm(e.type.name,d)))(g);if(y.depth>=1&&M&&y.depth-M.depth<=1){if(M.node.type===h)return u.liftListItem(f);if(Jm(M.node.type.name,d)&&h.validContent(M.node.content)&&s)return c().command((()=>(o.setNodeMarkup(M.pos,h),!0))).command((()=>Qm(o,h))).command((()=>ev(o,h))).run()}return n&&I&&s?c().command((()=>{const e=l().wrapInList(h,i),t=I.filter((e=>p.includes(e.type.name)));return o.ensureMarks(t),!!e||u.clearNodes()})).wrapInList(h,i).command((()=>Qm(o,h))).command((()=>ev(o,h))).run():c().command((()=>!!l().wrapInList(h,i)||u.clearNodes())).wrapInList(h,i).command((()=>Qm(o,h))).command((()=>ev(o,h))).run()},toggleMark:(e,t={},n={})=>({state:i,commands:r})=>{const{extendEmptyMarkRange:o=!1}=n,a=Om(e,i.schema);return $m(i,a,t)?r.unsetMark(a,{extendEmptyMarkRange:o}):r.setMark(a,t)},toggleNode:(e,t,n={})=>({state:i,commands:r})=>{const o=om(e,i.schema),a=om(t,i.schema);return qm(i,o,n)?r.setNode(a):r.setNode(o,n)},toggleWrap:(e,t={})=>({state:n,commands:i})=>{const r=om(e,n.schema);return qm(n,r,t)?i.lift(r):i.wrapIn(r,t)},undoInputRule:()=>({state:e,dispatch:t})=>{const n=e.plugins;for(let i=0;i<n.length;i+=1){const r=n[i];let o;if(r.spec.isInputRules&&(o=r.getState(e))){if(t){const t=e.tr,n=o.transform;for(let e=n.steps.length-1;e>=0;e-=1)t.step(n.steps[e].invert(n.docs[e]));if(o.text){const n=t.doc.resolve(o.from).marks();t.replaceWith(o.from,o.to,e.schema.text(o.text,n))}else t.delete(o.from,o.to)}return!0}}return!1},unsetAllMarks:()=>({tr:e,dispatch:t})=>{const{selection:n}=e,{empty:i,ranges:r}=n;return i||t&&r.forEach((t=>{e.removeMark(t.$from.pos,t.$to.pos)})),!0},unsetMark:(e,t={})=>({tr:n,state:i,dispatch:r})=>{var o;const{extendEmptyMarkRange:a=!1}=t,{selection:s}=n,c=Om(e,i.schema),{$from:u,empty:l,ranges:d}=s;if(!r)return!0;if(l&&a){let{from:e,to:t}=s;const i=null===(o=u.marks().find((e=>e.type===c)))||void 0===o?void 0:o.attrs,r=Lm(u,c,i);r&&(e=r.from,t=r.to),n.removeMark(e,t,c)}else d.forEach((e=>{n.removeMark(e.$from.pos,e.$to.pos,c)}));return n.removeStoredMark(c),!0},updateAttributes:(e,t={})=>({tr:n,state:i,dispatch:r})=>{let o=null,a=null;const s=Bm("string"==typeof e?e:e.name,i.schema);return!!s&&("node"===s&&(o=om(e,i.schema)),"mark"===s&&(a=Om(e,i.schema)),r&&n.selection.ranges.forEach((e=>{const r=e.$from.pos,s=e.$to.pos;i.doc.nodesBetween(r,s,((e,i)=>{o&&o===e.type&&n.setNodeMarkup(i,void 0,{...e.attrs,...t}),a&&e.marks.length&&e.marks.forEach((o=>{if(a===o.type){const c=Math.max(i,r),u=Math.min(i+e.nodeSize,s);n.addMark(c,u,a.create({...o.attrs,...t}))}}))}))})),!0)},wrapIn:(e,t={})=>({state:n,dispatch:i})=>function(e,t=null){return function(n,i){let{$from:r,$to:o}=n.selection,a=r.blockRange(o),s=a&&Dd(a,e,t);return!!s&&(i&&i(n.tr.wrap(a,s).scrollIntoView()),!0)}}(om(e,n.schema),t)(n,i),wrapInList:(e,t={})=>({state:n,dispatch:i})=>Xg(om(e,n.schema),t)(n,i)});const nv=Em.create({name:"commands",addCommands:()=>({...tv})}),iv=Em.create({name:"editable",addProseMirrorPlugins(){return[new gp({key:new _p("editable"),props:{editable:()=>this.editor.options.editable}})]}}),rv=Em.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:e}=this;return[new gp({key:new _p("focusEvents"),props:{handleDOMEvents:{focus:(t,n)=>{e.isFocused=!0;const i=e.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return t.dispatch(i),!1},blur:(t,n)=>{e.isFocused=!1;const i=e.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return t.dispatch(i),!1}}}})]}}),ov=Em.create({name:"keymap",addKeyboardShortcuts(){const e=()=>this.editor.commands.first((({commands:e})=>[()=>e.undoInputRule(),()=>e.command((({tr:t})=>{const{selection:n,doc:i}=t,{empty:r,$anchor:o}=n,{pos:a,parent:s}=o,c=Jd.atStart(i).from===a;return!(!(r&&c&&s.type.isTextblock)||s.textContent.length)&&e.clearNodes()})),()=>e.deleteSelection(),()=>e.joinBackward(),()=>e.selectNodeBackward()])),t=()=>this.editor.commands.first((({commands:e})=>[()=>e.deleteSelection(),()=>e.deleteCurrentNode(),()=>e.joinForward(),()=>e.selectNodeForward()])),n={Enter:()=>this.editor.commands.first((({commands:e})=>[()=>e.newlineInCode(),()=>e.createParagraphNear(),()=>e.liftEmptyBlock(),()=>e.splitBlock()])),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:e,"Mod-Backspace":e,"Shift-Backspace":e,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},r={...n,"Ctrl-h":e,"Alt-Backspace":e,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return xm()||Vm()?r:i},addProseMirrorPlugins(){return[new gp({key:new _p("clearDocument"),appendTransaction:(e,t,n)=>{if(!(e.some((e=>e.docChanged))&&!t.doc.eq(n.doc)))return;const{empty:i,from:r,to:o}=t.selection,a=Jd.atStart(t.doc).from,s=Jd.atEnd(t.doc).to;if(i||!(r===a&&o===s))return;if(!(0===n.doc.textBetween(0,n.doc.content.size," "," ").length))return;const c=n.tr,u=Qg({state:n,transaction:c}),{commands:l}=new em({editor:this.editor,state:u});return l.clearNodes(),c.steps.length?c:void 0}})]}}),av=Em.create({name:"tabindex",addProseMirrorPlugins(){return[new gp({key:new _p("tabindex"),props:{attributes:this.editor.isEditable?{tabindex:"0"}:{}}})]}});var sv=Object.freeze({__proto__:null,ClipboardTextSerializer:Dm,Commands:nv,Editable:iv,FocusEvents:rv,Keymap:ov,Tabindex:av});let cv=class extends tm{constructor(e={}){super(),this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout((()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))}),0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=function(e,t){const n=document.querySelector("style[data-tiptap-style]");if(null!==n)return n;const i=document.createElement("style");return t&&i.setAttribute("nonce",t),i.setAttribute("data-tiptap-style",""),i.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(i),i}('.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  white-space: break-spaces;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n  font-feature-settings: "liga" 0; /* the above doesn\'t seem to work in Edge */\n}\n\n.ProseMirror [contenteditable="false"] {\n  white-space: normal;\n}\n\n.ProseMirror [contenteditable="false"] [contenteditable="true"] {\n  white-space: pre-wrap;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\nimg.ProseMirror-separator {\n  display: inline !important;\n  border: none !important;\n  margin: 0 !important;\n  width: 1px !important;\n  height: 1px !important;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  margin: 0;\n}\n\n.ProseMirror-gapcursor:after {\n  content: "";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}\n\n.tippy-box[data-animation=fade][data-state=hidden] {\n  opacity: 0\n}',this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},this.view&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,t=!0){this.setOptions({editable:e}),t&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,t){const n=cm(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],i=this.state.reconfigure({plugins:n});this.view.updateState(i)}unregisterPlugin(e){if(this.isDestroyed)return;const t="string"==typeof e?`${e}$`:e.key,n=this.state.reconfigure({plugins:this.state.plugins.filter((e=>!e.key.startsWith(t)))});this.view.updateState(n)}createExtensionManager(){const e=[...this.options.enableCoreExtensions?Object.values(sv):[],...this.options.extensions].filter((e=>["extension","node","mark"].includes(null==e?void 0:e.type)));this.extensionManager=new Tm(e,this)}createCommandManager(){this.commandManager=new em({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){const e=jm(this.options.content,this.schema,this.options.parseOptions),t=Um(e,this.options.autofocus);this.view=new Sg(this.options.element,{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:hp.create({doc:e,selection:t||void 0})});const n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.createNodeViews();this.view.dom.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction)return this.capturedTransaction?void e.steps.forEach((e=>{var t;return null===(t=this.capturedTransaction)||void 0===t?void 0:t.step(e)})):void(this.capturedTransaction=e);const t=this.state.apply(e),n=!this.state.selection.eq(t.selection);this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e}),n&&this.emit("selectionUpdate",{editor:this,transaction:e});const i=e.getMeta("focus"),r=e.getMeta("blur");i&&this.emit("focus",{editor:this,event:i.event,transaction:e}),r&&this.emit("blur",{editor:this,event:r.event,transaction:e}),e.docChanged&&!e.getMeta("preventUpdate")&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return Wm(this.state,e)}isActive(e,t){const n="string"==typeof e?e:null,i="string"==typeof e?t:e;return function(e,t,n={}){if(!t)return qm(e,null,n)||$m(e,null,n);const i=Bm(t,e.schema);return"node"===i?qm(e,t,n):"mark"===i&&$m(e,t,n)}(this.state,n,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return function(e,t){const n=sd.fromSchema(t).serializeFragment(e),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(n),i.innerHTML}(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t="\n\n",textSerializers:n={}}=e||{};return function(e,t){return km(e,{from:0,to:e.content.size},t)}(this.state.doc,{blockSeparator:t,textSerializers:{...bm(this.schema),...n}})}get isEmpty(){return function(e){var t;const n=null===(t=e.type.createAndFill())||void 0===t?void 0:t.toJSON(),i=e.toJSON();return JSON.stringify(n)===JSON.stringify(i)}(this.state.doc)}getCharacterCount(){return this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var e;return!(null===(e=this.view)||void 0===e?void 0:e.docView)}};class uv{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions,this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=um(nm(this,"addOptions",{name:this.name}))),this.storage=um(nm(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new uv(e)}configure(e={}){const t=this.extend();return t.options=Sm(this.options,e),t.storage=um(nm(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new uv(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions,t.options=um(nm(t,"addOptions",{name:t.name})),t.storage=um(nm(t,"addStorage",{name:t.name,options:t.options})),t}static handleExit({editor:e,mark:t}){const{tr:n}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const r=i.marks();if(!!!r.find((e=>(null==e?void 0:e.type.name)===t.name)))return!1;const o=r.find((e=>(null==e?void 0:e.type.name)===t.name));return o&&n.removeStoredMark(o),n.insertText(" ",i.pos),e.view.dispatch(n),!0}return!1}}class lv{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions,this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=um(nm(this,"addOptions",{name:this.name}))),this.storage=um(nm(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new lv(e)}configure(e={}){const t=this.extend();return t.options=Sm(this.options,e),t.storage=um(nm(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new lv(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions,t.options=um(nm(t,"addOptions",{name:t.name})),t.storage=um(nm(t,"addStorage",{name:t.name,options:t.options})),t}}var dv="top",pv="bottom",hv="right",fv="left",gv="auto",mv=[dv,pv,hv,fv],vv="start",_v="end",yv="clippingParents",Iv="viewport",Mv="popper",Tv="reference",Cv=mv.reduce((function(e,t){return e.concat([t+"-"+vv,t+"-"+_v])}),[]),Sv=[].concat(mv,[gv]).reduce((function(e,t){return e.concat([t,t+"-"+vv,t+"-"+_v])}),[]),Ev=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function kv(e){return e?(e.nodeName||"").toLowerCase():null}function bv(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Dv(e){return e instanceof bv(e).Element||e instanceof Element}function wv(e){return e instanceof bv(e).HTMLElement||e instanceof HTMLElement}function Av(e){return"undefined"!=typeof ShadowRoot&&(e instanceof bv(e).ShadowRoot||e instanceof ShadowRoot)}const Rv={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var n=t.styles[e]||{},i=t.attributes[e]||{},r=t.elements[e];wv(r)&&kv(r)&&(Object.assign(r.style,n),Object.keys(i).forEach((function(e){var t=i[e];!1===t?r.removeAttribute(e):r.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach((function(e){var i=t.elements[e],r=t.attributes[e]||{},o=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce((function(e,t){return e[t]="",e}),{});wv(i)&&kv(i)&&(Object.assign(i.style,o),Object.keys(r).forEach((function(e){i.removeAttribute(e)})))}))}},requires:["computeStyles"]};function Lv(e){return e.split("-")[0]}var Ov=Math.max,Nv=Math.min,Pv=Math.round;function Uv(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function xv(){return!/^((?!chrome|android).)*safari/i.test(Uv())}function Gv(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var i=e.getBoundingClientRect(),r=1,o=1;t&&wv(e)&&(r=e.offsetWidth>0&&Pv(i.width)/e.offsetWidth||1,o=e.offsetHeight>0&&Pv(i.height)/e.offsetHeight||1);var a=(Dv(e)?bv(e):window).visualViewport,s=!xv()&&n,c=(i.left+(s&&a?a.offsetLeft:0))/r,u=(i.top+(s&&a?a.offsetTop:0))/o,l=i.width/r,d=i.height/o;return{width:l,height:d,top:u,right:c+l,bottom:u+d,left:c,x:c,y:u}}function Fv(e){var t=Gv(e),n=e.offsetWidth,i=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-i)<=1&&(i=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:i}}function Vv(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&Av(n)){var i=t;do{if(i&&e.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function qv(e){return bv(e).getComputedStyle(e)}function Bv(e){return["table","td","th"].indexOf(kv(e))>=0}function Hv(e){return((Dv(e)?e.ownerDocument:e.document)||window.document).documentElement}function jv(e){return"html"===kv(e)?e:e.assignedSlot||e.parentNode||(Av(e)?e.host:null)||Hv(e)}function Kv(e){return wv(e)&&"fixed"!==qv(e).position?e.offsetParent:null}function zv(e){for(var t=bv(e),n=Kv(e);n&&Bv(n)&&"static"===qv(n).position;)n=Kv(n);return n&&("html"===kv(n)||"body"===kv(n)&&"static"===qv(n).position)?t:n||function(e){var t=/firefox/i.test(Uv());if(/Trident/i.test(Uv())&&wv(e)&&"fixed"===qv(e).position)return null;var n=jv(e);for(Av(n)&&(n=n.host);wv(n)&&["html","body"].indexOf(kv(n))<0;){var i=qv(n);if("none"!==i.transform||"none"!==i.perspective||"paint"===i.contain||-1!==["transform","perspective"].indexOf(i.willChange)||t&&"filter"===i.willChange||t&&i.filter&&"none"!==i.filter)return n;n=n.parentNode}return null}(e)||t}function Wv(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function Yv(e,t,n){return Ov(e,Nv(t,n))}function $v(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function Jv(e,t){return t.reduce((function(t,n){return t[n]=e,t}),{})}function Xv(e){return e.split("-")[1]}var Zv={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Qv(e){var t,n=e.popper,i=e.popperRect,r=e.placement,o=e.variation,a=e.offsets,s=e.position,c=e.gpuAcceleration,u=e.adaptive,l=e.roundOffsets,d=e.isFixed,p=a.x,h=void 0===p?0:p,f=a.y,g=void 0===f?0:f,m="function"==typeof l?l({x:h,y:g}):{x:h,y:g};h=m.x,g=m.y;var v=a.hasOwnProperty("x"),_=a.hasOwnProperty("y"),y=fv,I=dv,M=window;if(u){var T=zv(n),C="clientHeight",S="clientWidth";if(T===bv(n)&&"static"!==qv(T=Hv(n)).position&&"absolute"===s&&(C="scrollHeight",S="scrollWidth"),r===dv||(r===fv||r===hv)&&o===_v)I=pv,g-=(d&&T===M&&M.visualViewport?M.visualViewport.height:T[C])-i.height,g*=c?1:-1;if(r===fv||(r===dv||r===pv)&&o===_v)y=hv,h-=(d&&T===M&&M.visualViewport?M.visualViewport.width:T[S])-i.width,h*=c?1:-1}var E,k=Object.assign({position:s},u&&Zv),b=!0===l?function(e,t){var n=e.x,i=e.y,r=t.devicePixelRatio||1;return{x:Pv(n*r)/r||0,y:Pv(i*r)/r||0}}({x:h,y:g},bv(n)):{x:h,y:g};return h=b.x,g=b.y,c?Object.assign({},k,((E={})[I]=_?"0":"",E[y]=v?"0":"",E.transform=(M.devicePixelRatio||1)<=1?"translate("+h+"px, "+g+"px)":"translate3d("+h+"px, "+g+"px, 0)",E)):Object.assign({},k,((t={})[I]=_?g+"px":"",t[y]=v?h+"px":"",t.transform="",t))}var e_={passive:!0};var t_={left:"right",right:"left",bottom:"top",top:"bottom"};function n_(e){return e.replace(/left|right|bottom|top/g,(function(e){return t_[e]}))}var i_={start:"end",end:"start"};function r_(e){return e.replace(/start|end/g,(function(e){return i_[e]}))}function o_(e){var t=bv(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function a_(e){return Gv(Hv(e)).left+o_(e).scrollLeft}function s_(e){var t=qv(e),n=t.overflow,i=t.overflowX,r=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+r+i)}function c_(e){return["html","body","#document"].indexOf(kv(e))>=0?e.ownerDocument.body:wv(e)&&s_(e)?e:c_(jv(e))}function u_(e,t){var n;void 0===t&&(t=[]);var i=c_(e),r=i===(null==(n=e.ownerDocument)?void 0:n.body),o=bv(i),a=r?[o].concat(o.visualViewport||[],s_(i)?i:[]):i,s=t.concat(a);return r?s:s.concat(u_(jv(a)))}function l_(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function d_(e,t,n){return t===Iv?l_(function(e,t){var n=bv(e),i=Hv(e),r=n.visualViewport,o=i.clientWidth,a=i.clientHeight,s=0,c=0;if(r){o=r.width,a=r.height;var u=xv();(u||!u&&"fixed"===t)&&(s=r.offsetLeft,c=r.offsetTop)}return{width:o,height:a,x:s+a_(e),y:c}}(e,n)):Dv(t)?function(e,t){var n=Gv(e,!1,"fixed"===t);return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}(t,n):l_(function(e){var t,n=Hv(e),i=o_(e),r=null==(t=e.ownerDocument)?void 0:t.body,o=Ov(n.scrollWidth,n.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),a=Ov(n.scrollHeight,n.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),s=-i.scrollLeft+a_(e),c=-i.scrollTop;return"rtl"===qv(r||n).direction&&(s+=Ov(n.clientWidth,r?r.clientWidth:0)-o),{width:o,height:a,x:s,y:c}}(Hv(e)))}function p_(e,t,n,i){var r="clippingParents"===t?function(e){var t=u_(jv(e)),n=["absolute","fixed"].indexOf(qv(e).position)>=0&&wv(e)?zv(e):e;return Dv(n)?t.filter((function(e){return Dv(e)&&Vv(e,n)&&"body"!==kv(e)})):[]}(e):[].concat(t),o=[].concat(r,[n]),a=o[0],s=o.reduce((function(t,n){var r=d_(e,n,i);return t.top=Ov(r.top,t.top),t.right=Nv(r.right,t.right),t.bottom=Nv(r.bottom,t.bottom),t.left=Ov(r.left,t.left),t}),d_(e,a,i));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function h_(e){var t,n=e.reference,i=e.element,r=e.placement,o=r?Lv(r):null,a=r?Xv(r):null,s=n.x+n.width/2-i.width/2,c=n.y+n.height/2-i.height/2;switch(o){case dv:t={x:s,y:n.y-i.height};break;case pv:t={x:s,y:n.y+n.height};break;case hv:t={x:n.x+n.width,y:c};break;case fv:t={x:n.x-i.width,y:c};break;default:t={x:n.x,y:n.y}}var u=o?Wv(o):null;if(null!=u){var l="y"===u?"height":"width";switch(a){case vv:t[u]=t[u]-(n[l]/2-i[l]/2);break;case _v:t[u]=t[u]+(n[l]/2-i[l]/2)}}return t}function f_(e,t){void 0===t&&(t={});var n=t,i=n.placement,r=void 0===i?e.placement:i,o=n.strategy,a=void 0===o?e.strategy:o,s=n.boundary,c=void 0===s?yv:s,u=n.rootBoundary,l=void 0===u?Iv:u,d=n.elementContext,p=void 0===d?Mv:d,h=n.altBoundary,f=void 0!==h&&h,g=n.padding,m=void 0===g?0:g,v=$v("number"!=typeof m?m:Jv(m,mv)),_=p===Mv?Tv:Mv,y=e.rects.popper,I=e.elements[f?_:p],M=p_(Dv(I)?I:I.contextElement||Hv(e.elements.popper),c,l,a),T=Gv(e.elements.reference),C=h_({reference:T,element:y,strategy:"absolute",placement:r}),S=l_(Object.assign({},y,C)),E=p===Mv?S:T,k={top:M.top-E.top+v.top,bottom:E.bottom-M.bottom+v.bottom,left:M.left-E.left+v.left,right:E.right-M.right+v.right},b=e.modifiersData.offset;if(p===Mv&&b){var D=b[r];Object.keys(k).forEach((function(e){var t=[hv,pv].indexOf(e)>=0?1:-1,n=[dv,pv].indexOf(e)>=0?"y":"x";k[e]+=D[n]*t}))}return k}function g_(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function m_(e){return[dv,hv,pv,fv].some((function(t){return e[t]>=0}))}function v_(e,t,n){void 0===n&&(n=!1);var i,r,o=wv(t),a=wv(t)&&function(e){var t=e.getBoundingClientRect(),n=Pv(t.width)/e.offsetWidth||1,i=Pv(t.height)/e.offsetHeight||1;return 1!==n||1!==i}(t),s=Hv(t),c=Gv(e,a,n),u={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(o||!o&&!n)&&(("body"!==kv(t)||s_(s))&&(u=(i=t)!==bv(i)&&wv(i)?{scrollLeft:(r=i).scrollLeft,scrollTop:r.scrollTop}:o_(i)),wv(t)?((l=Gv(t,!0)).x+=t.clientLeft,l.y+=t.clientTop):s&&(l.x=a_(s))),{x:c.left+u.scrollLeft-l.x,y:c.top+u.scrollTop-l.y,width:c.width,height:c.height}}function __(e){var t=new Map,n=new Set,i=[];function r(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!n.has(e)){var i=t.get(e);i&&r(i)}})),i.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){n.has(e.name)||r(e)})),i}var y_={placement:"bottom",modifiers:[],strategy:"absolute"};function I_(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function M_(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,i=void 0===n?[]:n,r=t.defaultOptions,o=void 0===r?y_:r;return function(e,t,n){void 0===n&&(n=o);var r,a,s={placement:"bottom",orderedModifiers:[],options:Object.assign({},y_,o),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},c=[],u=!1,l={state:s,setOptions:function(n){var r="function"==typeof n?n(s.options):n;d(),s.options=Object.assign({},o,s.options,r),s.scrollParents={reference:Dv(e)?u_(e):e.contextElement?u_(e.contextElement):[],popper:u_(t)};var a,u,p=function(e){var t=__(e);return Ev.reduce((function(e,n){return e.concat(t.filter((function(e){return e.phase===n})))}),[])}((a=[].concat(i,s.options.modifiers),u=a.reduce((function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e}),{}),Object.keys(u).map((function(e){return u[e]}))));return s.orderedModifiers=p.filter((function(e){return e.enabled})),s.orderedModifiers.forEach((function(e){var t=e.name,n=e.options,i=void 0===n?{}:n,r=e.effect;if("function"==typeof r){var o=r({state:s,name:t,instance:l,options:i}),a=function(){};c.push(o||a)}})),l.update()},forceUpdate:function(){if(!u){var e=s.elements,t=e.reference,n=e.popper;if(I_(t,n)){s.rects={reference:v_(t,zv(n),"fixed"===s.options.strategy),popper:Fv(n)},s.reset=!1,s.placement=s.options.placement,s.orderedModifiers.forEach((function(e){return s.modifiersData[e.name]=Object.assign({},e.data)}));for(var i=0;i<s.orderedModifiers.length;i++)if(!0!==s.reset){var r=s.orderedModifiers[i],o=r.fn,a=r.options,c=void 0===a?{}:a,d=r.name;"function"==typeof o&&(s=o({state:s,options:c,name:d,instance:l})||s)}else s.reset=!1,i=-1}}},update:(r=function(){return new Promise((function(e){l.forceUpdate(),e(s)}))},function(){return a||(a=new Promise((function(e){Promise.resolve().then((function(){a=void 0,e(r())}))}))),a}),destroy:function(){d(),u=!0}};if(!I_(e,t))return l;function d(){c.forEach((function(e){return e()})),c=[]}return l.setOptions(n).then((function(e){!u&&n.onFirstUpdate&&n.onFirstUpdate(e)})),l}}var T_=M_({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,i=e.options,r=i.scroll,o=void 0===r||r,a=i.resize,s=void 0===a||a,c=bv(t.elements.popper),u=[].concat(t.scrollParents.reference,t.scrollParents.popper);return o&&u.forEach((function(e){e.addEventListener("scroll",n.update,e_)})),s&&c.addEventListener("resize",n.update,e_),function(){o&&u.forEach((function(e){e.removeEventListener("scroll",n.update,e_)})),s&&c.removeEventListener("resize",n.update,e_)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=h_({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,i=n.gpuAcceleration,r=void 0===i||i,o=n.adaptive,a=void 0===o||o,s=n.roundOffsets,c=void 0===s||s,u={placement:Lv(t.placement),variation:Xv(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:r,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,Qv(Object.assign({},u,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a,roundOffsets:c})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,Qv(Object.assign({},u,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},Rv,{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,i=e.name,r=n.offset,o=void 0===r?[0,0]:r,a=Sv.reduce((function(e,n){return e[n]=function(e,t,n){var i=Lv(e),r=[fv,dv].indexOf(i)>=0?-1:1,o="function"==typeof n?n(Object.assign({},t,{placement:e})):n,a=o[0],s=o[1];return a=a||0,s=(s||0)*r,[fv,hv].indexOf(i)>=0?{x:s,y:a}:{x:a,y:s}}(n,t.rects,o),e}),{}),s=a[t.placement],c=s.x,u=s.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=u),t.modifiersData[i]=a}},{name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,i=e.name;if(!t.modifiersData[i]._skip){for(var r=n.mainAxis,o=void 0===r||r,a=n.altAxis,s=void 0===a||a,c=n.fallbackPlacements,u=n.padding,l=n.boundary,d=n.rootBoundary,p=n.altBoundary,h=n.flipVariations,f=void 0===h||h,g=n.allowedAutoPlacements,m=t.options.placement,v=Lv(m),_=c||(v===m||!f?[n_(m)]:function(e){if(Lv(e)===gv)return[];var t=n_(e);return[r_(e),t,r_(t)]}(m)),y=[m].concat(_).reduce((function(e,n){return e.concat(Lv(n)===gv?function(e,t){void 0===t&&(t={});var n=t,i=n.placement,r=n.boundary,o=n.rootBoundary,a=n.padding,s=n.flipVariations,c=n.allowedAutoPlacements,u=void 0===c?Sv:c,l=Xv(i),d=l?s?Cv:Cv.filter((function(e){return Xv(e)===l})):mv,p=d.filter((function(e){return u.indexOf(e)>=0}));0===p.length&&(p=d);var h=p.reduce((function(t,n){return t[n]=f_(e,{placement:n,boundary:r,rootBoundary:o,padding:a})[Lv(n)],t}),{});return Object.keys(h).sort((function(e,t){return h[e]-h[t]}))}(t,{placement:n,boundary:l,rootBoundary:d,padding:u,flipVariations:f,allowedAutoPlacements:g}):n)}),[]),I=t.rects.reference,M=t.rects.popper,T=new Map,C=!0,S=y[0],E=0;E<y.length;E++){var k=y[E],b=Lv(k),D=Xv(k)===vv,w=[dv,pv].indexOf(b)>=0,A=w?"width":"height",R=f_(t,{placement:k,boundary:l,rootBoundary:d,altBoundary:p,padding:u}),L=w?D?hv:fv:D?pv:dv;I[A]>M[A]&&(L=n_(L));var O=n_(L),N=[];if(o&&N.push(R[b]<=0),s&&N.push(R[L]<=0,R[O]<=0),N.every((function(e){return e}))){S=k,C=!1;break}T.set(k,N)}if(C)for(var P=function(e){var t=y.find((function(t){var n=T.get(t);if(n)return n.slice(0,e).every((function(e){return e}))}));if(t)return S=t,"break"},U=f?3:1;U>0;U--){if("break"===P(U))break}t.placement!==S&&(t.modifiersData[i]._skip=!0,t.placement=S,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},{name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,i=e.name,r=n.mainAxis,o=void 0===r||r,a=n.altAxis,s=void 0!==a&&a,c=n.boundary,u=n.rootBoundary,l=n.altBoundary,d=n.padding,p=n.tether,h=void 0===p||p,f=n.tetherOffset,g=void 0===f?0:f,m=f_(t,{boundary:c,rootBoundary:u,padding:d,altBoundary:l}),v=Lv(t.placement),_=Xv(t.placement),y=!_,I=Wv(v),M="x"===I?"y":"x",T=t.modifiersData.popperOffsets,C=t.rects.reference,S=t.rects.popper,E="function"==typeof g?g(Object.assign({},t.rects,{placement:t.placement})):g,k="number"==typeof E?{mainAxis:E,altAxis:E}:Object.assign({mainAxis:0,altAxis:0},E),b=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,D={x:0,y:0};if(T){if(o){var w,A="y"===I?dv:fv,R="y"===I?pv:hv,L="y"===I?"height":"width",O=T[I],N=O+m[A],P=O-m[R],U=h?-S[L]/2:0,x=_===vv?C[L]:S[L],G=_===vv?-S[L]:-C[L],F=t.elements.arrow,V=h&&F?Fv(F):{width:0,height:0},q=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},B=q[A],H=q[R],j=Yv(0,C[L],V[L]),K=y?C[L]/2-U-j-B-k.mainAxis:x-j-B-k.mainAxis,z=y?-C[L]/2+U+j+H+k.mainAxis:G+j+H+k.mainAxis,W=t.elements.arrow&&zv(t.elements.arrow),Y=W?"y"===I?W.clientTop||0:W.clientLeft||0:0,$=null!=(w=null==b?void 0:b[I])?w:0,J=O+z-$,X=Yv(h?Nv(N,O+K-$-Y):N,O,h?Ov(P,J):P);T[I]=X,D[I]=X-O}if(s){var Z,Q="x"===I?dv:fv,ee="x"===I?pv:hv,te=T[M],ne="y"===M?"height":"width",ie=te+m[Q],re=te-m[ee],oe=-1!==[dv,fv].indexOf(v),ae=null!=(Z=null==b?void 0:b[M])?Z:0,se=oe?ie:te-C[ne]-S[ne]-ae+k.altAxis,ce=oe?te+C[ne]+S[ne]-ae-k.altAxis:re,ue=h&&oe?(de=Yv(se,te,le=ce))>le?le:de:Yv(h?se:ie,te,h?ce:re);T[M]=ue,D[M]=ue-te}var le,de;t.modifiersData[i]=D}},requiresIfExists:["offset"]},{name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n=e.state,i=e.name,r=e.options,o=n.elements.arrow,a=n.modifiersData.popperOffsets,s=Lv(n.placement),c=Wv(s),u=[fv,hv].indexOf(s)>=0?"height":"width";if(o&&a){var l=function(e,t){return $v("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:Jv(e,mv))}(r.padding,n),d=Fv(o),p="y"===c?dv:fv,h="y"===c?pv:hv,f=n.rects.reference[u]+n.rects.reference[c]-a[c]-n.rects.popper[u],g=a[c]-n.rects.reference[c],m=zv(o),v=m?"y"===c?m.clientHeight||0:m.clientWidth||0:0,_=f/2-g/2,y=l[p],I=v-d[u]-l[h],M=v/2-d[u]/2+_,T=Yv(y,M,I),C=c;n.modifiersData[i]=((t={})[C]=T,t.centerOffset=T-M,t)}},effect:function(e){var t=e.state,n=e.options.element,i=void 0===n?"[data-popper-arrow]":n;null!=i&&("string"!=typeof i||(i=t.elements.popper.querySelector(i)))&&Vv(t.elements.popper,i)&&(t.elements.arrow=i)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,i=t.rects.reference,r=t.rects.popper,o=t.modifiersData.preventOverflow,a=f_(t,{elementContext:"reference"}),s=f_(t,{altBoundary:!0}),c=g_(a,i),u=g_(s,r,o),l=m_(c),d=m_(u);t.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:u,isReferenceHidden:l,hasPopperEscaped:d},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":l,"data-popper-escaped":d})}}]}),C_="tippy-content",S_="tippy-backdrop",E_="tippy-arrow",k_="tippy-svg-arrow",b_={passive:!0,capture:!0},D_=function(){return document.body};function w_(e,t,n){if(Array.isArray(e)){var i=e[t];return null==i?Array.isArray(n)?n[t]:n:i}return e}function A_(e,t){var n={}.toString.call(e);return 0===n.indexOf("[object")&&n.indexOf(t+"]")>-1}function R_(e,t){return"function"==typeof e?e.apply(void 0,t):e}function L_(e,t){return 0===t?e:function(i){clearTimeout(n),n=setTimeout((function(){e(i)}),t)};var n}function O_(e){return[].concat(e)}function N_(e,t){-1===e.indexOf(t)&&e.push(t)}function P_(e){return[].slice.call(e)}function U_(e){return Object.keys(e).reduce((function(t,n){return void 0!==e[n]&&(t[n]=e[n]),t}),{})}function x_(){return document.createElement("div")}function G_(e){return["Element","Fragment"].some((function(t){return A_(e,t)}))}function F_(e){return G_(e)?[e]:function(e){return A_(e,"NodeList")}(e)?P_(e):Array.isArray(e)?e:P_(document.querySelectorAll(e))}function V_(e,t){e.forEach((function(e){e&&(e.style.transitionDuration=t+"ms")}))}function q_(e,t){e.forEach((function(e){e&&e.setAttribute("data-state",t)}))}function B_(e,t,n){var i=t+"EventListener";["transitionend","webkitTransitionEnd"].forEach((function(t){e[i](t,n)}))}function H_(e,t){for(var n=t;n;){var i;if(e.contains(n))return!0;n=null==n.getRootNode||null==(i=n.getRootNode())?void 0:i.host}return!1}var j_={isTouch:!1},K_=0;function z_(){j_.isTouch||(j_.isTouch=!0,window.performance&&document.addEventListener("mousemove",W_))}function W_(){var e=performance.now();e-K_<20&&(j_.isTouch=!1,document.removeEventListener("mousemove",W_)),K_=e}function Y_(){var e,t=document.activeElement;if((e=t)&&e._tippy&&e._tippy.reference===e){var n=t._tippy;t.blur&&!n.state.isVisible&&t.blur()}}var $_=!!("undefined"!=typeof window&&"undefined"!=typeof document)&&!!window.msCrypto,J_=Object.assign({appendTo:D_,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),X_=Object.keys(J_);function Z_(e){var t=(e.plugins||[]).reduce((function(t,n){var i,r=n.name,o=n.defaultValue;r&&(t[r]=void 0!==e[r]?e[r]:null!=(i=J_[r])?i:o);return t}),{});return Object.assign({},e,t)}function Q_(e,t){var n=Object.assign({},t,{content:R_(t.content,[e])},t.ignoreAttributes?{}:function(e,t){return(t?Object.keys(Z_(Object.assign({},J_,{plugins:t}))):X_).reduce((function(t,n){var i=(e.getAttribute("data-tippy-"+n)||"").trim();if(!i)return t;if("content"===n)t[n]=i;else try{t[n]=JSON.parse(i)}catch(ok){t[n]=i}return t}),{})}(e,t.plugins));return n.aria=Object.assign({},J_.aria,n.aria),n.aria={expanded:"auto"===n.aria.expanded?t.interactive:n.aria.expanded,content:"auto"===n.aria.content?t.interactive?null:"describedby":n.aria.content},n}var ey=function(){return"innerHTML"};function ty(e,t){e[ey()]=t}function ny(e){var t=x_();return!0===e?t.className=E_:(t.className=k_,G_(e)?t.appendChild(e):ty(t,e)),t}function iy(e,t){G_(t.content)?(ty(e,""),e.appendChild(t.content)):"function"!=typeof t.content&&(t.allowHTML?ty(e,t.content):e.textContent=t.content)}function ry(e){var t=e.firstElementChild,n=P_(t.children);return{box:t,content:n.find((function(e){return e.classList.contains(C_)})),arrow:n.find((function(e){return e.classList.contains(E_)||e.classList.contains(k_)})),backdrop:n.find((function(e){return e.classList.contains(S_)}))}}function oy(e){var t=x_(),n=x_();n.className="tippy-box",n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var i=x_();function r(n,i){var r=ry(t),o=r.box,a=r.content,s=r.arrow;i.theme?o.setAttribute("data-theme",i.theme):o.removeAttribute("data-theme"),"string"==typeof i.animation?o.setAttribute("data-animation",i.animation):o.removeAttribute("data-animation"),i.inertia?o.setAttribute("data-inertia",""):o.removeAttribute("data-inertia"),o.style.maxWidth="number"==typeof i.maxWidth?i.maxWidth+"px":i.maxWidth,i.role?o.setAttribute("role",i.role):o.removeAttribute("role"),n.content===i.content&&n.allowHTML===i.allowHTML||iy(a,e.props),i.arrow?s?n.arrow!==i.arrow&&(o.removeChild(s),o.appendChild(ny(i.arrow))):o.appendChild(ny(i.arrow)):s&&o.removeChild(s)}return i.className=C_,i.setAttribute("data-state","hidden"),iy(i,e.props),t.appendChild(n),n.appendChild(i),r(e.props,e.props),{popper:t,onUpdate:r}}oy.$$tippy=!0;var ay=1,sy=[],cy=[];function uy(e,t){var n,i,r,o,a,s,c,u,l=Q_(e,Object.assign({},J_,Z_(U_(t)))),d=!1,p=!1,h=!1,f=!1,g=[],m=L_(W,l.interactiveDebounce),v=ay++,_=(u=l.plugins).filter((function(e,t){return u.indexOf(e)===t})),y={id:v,reference:e,popper:x_(),popperInstance:null,props:l,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:_,clearDelayTimeouts:function(){clearTimeout(n),clearTimeout(i),cancelAnimationFrame(r)},setProps:function(t){if(y.state.isDestroyed)return;O("onBeforeUpdate",[y,t]),K();var n=y.props,i=Q_(e,Object.assign({},n,U_(t),{ignoreAttributes:!0}));y.props=i,j(),n.interactiveDebounce!==i.interactiveDebounce&&(U(),m=L_(W,i.interactiveDebounce));n.triggerTarget&&!i.triggerTarget?O_(n.triggerTarget).forEach((function(e){e.removeAttribute("aria-expanded")})):i.triggerTarget&&e.removeAttribute("aria-expanded");P(),L(),T&&T(n,i);y.popperInstance&&(X(),Q().forEach((function(e){requestAnimationFrame(e._tippy.popperInstance.forceUpdate)})));O("onAfterUpdate",[y,t])},setContent:function(e){y.setProps({content:e})},show:function(){var e=y.state.isVisible,t=y.state.isDestroyed,n=!y.state.isEnabled,i=j_.isTouch&&!y.props.touch,r=w_(y.props.duration,0,J_.duration);if(e||t||n||i)return;if(D().hasAttribute("disabled"))return;if(O("onShow",[y],!1),!1===y.props.onShow(y))return;y.state.isVisible=!0,b()&&(M.style.visibility="visible");L(),V(),y.state.isMounted||(M.style.transition="none");if(b()){var o=A();V_([o.box,o.content],0)}s=function(){var e;if(y.state.isVisible&&!f){if(f=!0,M.offsetHeight,M.style.transition=y.props.moveTransition,b()&&y.props.animation){var t=A(),n=t.box,i=t.content;V_([n,i],r),q_([n,i],"visible")}N(),P(),N_(cy,y),null==(e=y.popperInstance)||e.forceUpdate(),O("onMount",[y]),y.props.animation&&b()&&function(e,t){B(e,t)}(r,(function(){y.state.isShown=!0,O("onShown",[y])}))}},function(){var e,t=y.props.appendTo,n=D();e=y.props.interactive&&t===D_||"parent"===t?n.parentNode:R_(t,[n]);e.contains(M)||e.appendChild(M);y.state.isMounted=!0,X()}()},hide:function(){var e=!y.state.isVisible,t=y.state.isDestroyed,n=!y.state.isEnabled,i=w_(y.props.duration,1,J_.duration);if(e||t||n)return;if(O("onHide",[y],!1),!1===y.props.onHide(y))return;y.state.isVisible=!1,y.state.isShown=!1,f=!1,d=!1,b()&&(M.style.visibility="hidden");if(U(),q(),L(!0),b()){var r=A(),o=r.box,a=r.content;y.props.animation&&(V_([o,a],i),q_([o,a],"hidden"))}N(),P(),y.props.animation?b()&&function(e,t){B(e,(function(){!y.state.isVisible&&M.parentNode&&M.parentNode.contains(M)&&t()}))}(i,y.unmount):y.unmount()},hideWithInteractivity:function(e){w().addEventListener("mousemove",m),N_(sy,m),m(e)},enable:function(){y.state.isEnabled=!0},disable:function(){y.hide(),y.state.isEnabled=!1},unmount:function(){y.state.isVisible&&y.hide();if(!y.state.isMounted)return;Z(),Q().forEach((function(e){e._tippy.unmount()})),M.parentNode&&M.parentNode.removeChild(M);cy=cy.filter((function(e){return e!==y})),y.state.isMounted=!1,O("onHidden",[y])},destroy:function(){if(y.state.isDestroyed)return;y.clearDelayTimeouts(),y.unmount(),K(),delete e._tippy,y.state.isDestroyed=!0,O("onDestroy",[y])}};if(!l.render)return y;var I=l.render(y),M=I.popper,T=I.onUpdate;M.setAttribute("data-tippy-root",""),M.id="tippy-"+y.id,y.popper=M,e._tippy=y,M._tippy=y;var C=_.map((function(e){return e.fn(y)})),S=e.hasAttribute("aria-expanded");return j(),P(),L(),O("onCreate",[y]),l.showOnCreate&&ee(),M.addEventListener("mouseenter",(function(){y.props.interactive&&y.state.isVisible&&y.clearDelayTimeouts()})),M.addEventListener("mouseleave",(function(){y.props.interactive&&y.props.trigger.indexOf("mouseenter")>=0&&w().addEventListener("mousemove",m)})),y;function E(){var e=y.props.touch;return Array.isArray(e)?e:[e,0]}function k(){return"hold"===E()[0]}function b(){var e;return!(null==(e=y.props.render)||!e.$$tippy)}function D(){return c||e}function w(){var e,t,n=D().parentNode;return n?null!=(t=O_(n)[0])&&null!=(e=t.ownerDocument)&&e.body?t.ownerDocument:document:document}function A(){return ry(M)}function R(e){return y.state.isMounted&&!y.state.isVisible||j_.isTouch||o&&"focus"===o.type?0:w_(y.props.delay,e?0:1,J_.delay)}function L(e){void 0===e&&(e=!1),M.style.pointerEvents=y.props.interactive&&!e?"":"none",M.style.zIndex=""+y.props.zIndex}function O(e,t,n){var i;(void 0===n&&(n=!0),C.forEach((function(n){n[e]&&n[e].apply(n,t)})),n)&&(i=y.props)[e].apply(i,t)}function N(){var t=y.props.aria;if(t.content){var n="aria-"+t.content,i=M.id;O_(y.props.triggerTarget||e).forEach((function(e){var t=e.getAttribute(n);if(y.state.isVisible)e.setAttribute(n,t?t+" "+i:i);else{var r=t&&t.replace(i,"").trim();r?e.setAttribute(n,r):e.removeAttribute(n)}}))}}function P(){!S&&y.props.aria.expanded&&O_(y.props.triggerTarget||e).forEach((function(e){y.props.interactive?e.setAttribute("aria-expanded",y.state.isVisible&&e===D()?"true":"false"):e.removeAttribute("aria-expanded")}))}function U(){w().removeEventListener("mousemove",m),sy=sy.filter((function(e){return e!==m}))}function x(t){if(!j_.isTouch||!h&&"mousedown"!==t.type){var n=t.composedPath&&t.composedPath()[0]||t.target;if(!y.props.interactive||!H_(M,n)){if(O_(y.props.triggerTarget||e).some((function(e){return H_(e,n)}))){if(j_.isTouch)return;if(y.state.isVisible&&y.props.trigger.indexOf("click")>=0)return}else O("onClickOutside",[y,t]);!0===y.props.hideOnClick&&(y.clearDelayTimeouts(),y.hide(),p=!0,setTimeout((function(){p=!1})),y.state.isMounted||q())}}}function G(){h=!0}function F(){h=!1}function V(){var e=w();e.addEventListener("mousedown",x,!0),e.addEventListener("touchend",x,b_),e.addEventListener("touchstart",F,b_),e.addEventListener("touchmove",G,b_)}function q(){var e=w();e.removeEventListener("mousedown",x,!0),e.removeEventListener("touchend",x,b_),e.removeEventListener("touchstart",F,b_),e.removeEventListener("touchmove",G,b_)}function B(e,t){var n=A().box;function i(e){e.target===n&&(B_(n,"remove",i),t())}if(0===e)return t();B_(n,"remove",a),B_(n,"add",i),a=i}function H(t,n,i){void 0===i&&(i=!1),O_(y.props.triggerTarget||e).forEach((function(e){e.addEventListener(t,n,i),g.push({node:e,eventType:t,handler:n,options:i})}))}function j(){var e;k()&&(H("touchstart",z,{passive:!0}),H("touchend",Y,{passive:!0})),(e=y.props.trigger,e.split(/\s+/).filter(Boolean)).forEach((function(e){if("manual"!==e)switch(H(e,z),e){case"mouseenter":H("mouseleave",Y);break;case"focus":H($_?"focusout":"blur",$);break;case"focusin":H("focusout",$)}}))}function K(){g.forEach((function(e){var t=e.node,n=e.eventType,i=e.handler,r=e.options;t.removeEventListener(n,i,r)})),g=[]}function z(e){var t,n=!1;if(y.state.isEnabled&&!J(e)&&!p){var i="focus"===(null==(t=o)?void 0:t.type);o=e,c=e.currentTarget,P(),!y.state.isVisible&&A_(e,"MouseEvent")&&sy.forEach((function(t){return t(e)})),"click"===e.type&&(y.props.trigger.indexOf("mouseenter")<0||d)&&!1!==y.props.hideOnClick&&y.state.isVisible?n=!0:ee(e),"click"===e.type&&(d=!n),n&&!i&&te(e)}}function W(e){var t=e.target,n=D().contains(t)||M.contains(t);"mousemove"===e.type&&n||function(e,t){var n=t.clientX,i=t.clientY;return e.every((function(e){var t=e.popperRect,r=e.popperState,o=e.props.interactiveBorder,a=r.placement.split("-")[0],s=r.modifiersData.offset;if(!s)return!0;var c="bottom"===a?s.top.y:0,u="top"===a?s.bottom.y:0,l="right"===a?s.left.x:0,d="left"===a?s.right.x:0,p=t.top-i+c>o,h=i-t.bottom-u>o,f=t.left-n+l>o,g=n-t.right-d>o;return p||h||f||g}))}(Q().concat(M).map((function(e){var t,n=null==(t=e._tippy.popperInstance)?void 0:t.state;return n?{popperRect:e.getBoundingClientRect(),popperState:n,props:l}:null})).filter(Boolean),e)&&(U(),te(e))}function Y(e){J(e)||y.props.trigger.indexOf("click")>=0&&d||(y.props.interactive?y.hideWithInteractivity(e):te(e))}function $(e){y.props.trigger.indexOf("focusin")<0&&e.target!==D()||y.props.interactive&&e.relatedTarget&&M.contains(e.relatedTarget)||te(e)}function J(e){return!!j_.isTouch&&k()!==e.type.indexOf("touch")>=0}function X(){Z();var t=y.props,n=t.popperOptions,i=t.placement,r=t.offset,o=t.getReferenceClientRect,a=t.moveTransition,c=b()?ry(M).arrow:null,u=o?{getBoundingClientRect:o,contextElement:o.contextElement||D()}:e,l=[{name:"offset",options:{offset:r}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!a}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(e){var t=e.state;if(b()){var n=A().box;["placement","reference-hidden","escaped"].forEach((function(e){"placement"===e?n.setAttribute("data-placement",t.placement):t.attributes.popper["data-popper-"+e]?n.setAttribute("data-"+e,""):n.removeAttribute("data-"+e)})),t.attributes.popper={}}}}];b()&&c&&l.push({name:"arrow",options:{element:c,padding:3}}),l.push.apply(l,(null==n?void 0:n.modifiers)||[]),y.popperInstance=T_(u,M,Object.assign({},n,{placement:i,onFirstUpdate:s,modifiers:l}))}function Z(){y.popperInstance&&(y.popperInstance.destroy(),y.popperInstance=null)}function Q(){return P_(M.querySelectorAll("[data-tippy-root]"))}function ee(e){y.clearDelayTimeouts(),e&&O("onTrigger",[y,e]),V();var t=R(!0),i=E(),r=i[0],o=i[1];j_.isTouch&&"hold"===r&&o&&(t=o),t?n=setTimeout((function(){y.show()}),t):y.show()}function te(e){if(y.clearDelayTimeouts(),O("onUntrigger",[y,e]),y.state.isVisible){if(!(y.props.trigger.indexOf("mouseenter")>=0&&y.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(e.type)>=0&&d)){var t=R(!1);t?i=setTimeout((function(){y.state.isVisible&&y.hide()}),t):r=requestAnimationFrame((function(){y.hide()}))}}else q()}}function ly(e,t){void 0===t&&(t={});var n=J_.plugins.concat(t.plugins||[]);document.addEventListener("touchstart",z_,b_),window.addEventListener("blur",Y_);var i=Object.assign({},t,{plugins:n}),r=F_(e).reduce((function(e,t){var n=t&&uy(t,i);return n&&e.push(n),e}),[]);return G_(e)?r[0]:r}ly.defaultProps=J_,ly.setDefaultProps=function(e){Object.keys(e).forEach((function(t){J_[t]=e[t]}))},ly.currentInput=j_,Object.assign({},Rv,{effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow)}}),ly.setDefaultProps({render:oy});class dy{constructor({editor:e,element:t,view:n,tippyOptions:i={},updateDelay:r=250,shouldShow:o}){this.preventHide=!1,this.shouldShow=({view:e,state:t,from:n,to:i})=>{const{doc:r,selection:o}=t,{empty:a}=o,s=!r.textBetween(n,i).length&&Nm(t.selection),c=this.element.contains(document.activeElement);return!(!e.hasFocus()&&!c||a||s||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout((()=>this.update(this.editor.view)))},this.blurHandler=({event:e})=>{var t;this.preventHide?this.preventHide=!1:(null==e?void 0:e.relatedTarget)&&(null===(t=this.element.parentNode)||void 0===t?void 0:t.contains(e.relatedTarget))||this.hide()},this.tippyBlurHandler=e=>{this.blurHandler({event:e})},this.handleDebouncedUpdate=(e,t)=>{const n=!(null==t?void 0:t.selection.eq(e.state.selection)),i=!(null==t?void 0:t.doc.eq(e.state.doc));(n||i)&&(this.updateDebounceTimer&&clearTimeout(this.updateDebounceTimer),this.updateDebounceTimer=window.setTimeout((()=>{this.updateHandler(e,n,i,t)}),this.updateDelay))},this.updateHandler=(e,t,n,i)=>{var r,o,a;const{state:s,composing:c}=e,{selection:u}=s;if(c||!t&&!n)return;this.createTooltip();const{ranges:l}=u,d=Math.min(...l.map((e=>e.$from.pos))),p=Math.max(...l.map((e=>e.$to.pos)));(null===(r=this.shouldShow)||void 0===r?void 0:r.call(this,{editor:this.editor,view:e,state:s,oldState:i,from:d,to:p}))?(null===(o=this.tippy)||void 0===o||o.setProps({getReferenceClientRect:(null===(a=this.tippyOptions)||void 0===a?void 0:a.getReferenceClientRect)||(()=>{if(s.selection instanceof np){let t=e.nodeDOM(d);const n=t.dataset.nodeViewWrapper?t:t.querySelector("[data-node-view-wrapper]");if(n&&(t=n.firstChild),t)return t.getBoundingClientRect()}return Xm(e,d,p)})}),this.show()):this.hide()},this.editor=e,this.element=t,this.view=n,this.updateDelay=r,o&&(this.shouldShow=o),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=i,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,t=!!e.parentElement;!this.tippy&&t&&(this.tippy=ly(e,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(e,t){const{state:n}=e,i=n.selection.$from.pos!==n.selection.$to.pos;if(this.updateDelay>0&&i)return void this.handleDebouncedUpdate(e,t);const r=!(null==t?void 0:t.selection.eq(e.state.selection)),o=!(null==t?void 0:t.doc.eq(e.state.doc));this.updateHandler(e,r,o,t)}show(){var e;null===(e=this.tippy)||void 0===e||e.show()}hide(){var e;null===(e=this.tippy)||void 0===e||e.hide()}destroy(){var e,t;(null===(e=this.tippy)||void 0===e?void 0:e.popper.firstChild)&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),null===(t=this.tippy)||void 0===t||t.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const py=e=>new gp({key:"string"==typeof e.pluginKey?new _p(e.pluginKey):e.pluginKey,view:t=>new dy({view:t,...e})});Em.create({name:"bubbleMenu",addOptions:()=>({element:null,tippyOptions:{},pluginKey:"bubbleMenu",updateDelay:void 0,shouldShow:null}),addProseMirrorPlugins(){return this.options.element?[py({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,updateDelay:this.options.updateDelay,shouldShow:this.options.shouldShow})]:[]}});class hy{constructor({editor:e,element:t,view:n,tippyOptions:i={},shouldShow:r}){this.preventHide=!1,this.shouldShow=({view:e,state:t})=>{const{selection:n}=t,{$anchor:i,empty:r}=n,o=1===i.depth,a=i.parent.isTextblock&&!i.parent.type.spec.code&&!i.parent.textContent;return!!(e.hasFocus()&&r&&o&&a&&this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout((()=>this.update(this.editor.view)))},this.blurHandler=({event:e})=>{var t;this.preventHide?this.preventHide=!1:(null==e?void 0:e.relatedTarget)&&(null===(t=this.element.parentNode)||void 0===t?void 0:t.contains(e.relatedTarget))||this.hide()},this.tippyBlurHandler=e=>{this.blurHandler({event:e})},this.editor=e,this.element=t,this.view=n,r&&(this.shouldShow=r),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=i,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,t=!!e.parentElement;!this.tippy&&t&&(this.tippy=ly(e,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(e,t){var n,i,r;const{state:o}=e,{doc:a,selection:s}=o,{from:c,to:u}=s;if(t&&t.doc.eq(a)&&t.selection.eq(s))return;this.createTooltip();(null===(n=this.shouldShow)||void 0===n?void 0:n.call(this,{editor:this.editor,view:e,state:o,oldState:t}))?(null===(i=this.tippy)||void 0===i||i.setProps({getReferenceClientRect:(null===(r=this.tippyOptions)||void 0===r?void 0:r.getReferenceClientRect)||(()=>Xm(e,c,u))}),this.show()):this.hide()}show(){var e;null===(e=this.tippy)||void 0===e||e.show()}hide(){var e;null===(e=this.tippy)||void 0===e||e.hide()}destroy(){var e,t;(null===(e=this.tippy)||void 0===e?void 0:e.popper.firstChild)&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),null===(t=this.tippy)||void 0===t||t.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const fy=e=>new gp({key:"string"==typeof e.pluginKey?new _p(e.pluginKey):e.pluginKey,view:t=>new hy({view:t,...e})});function gy(e){return re(((t,n)=>({get:()=>(t(),e),set(t){e=t,requestAnimationFrame((()=>{requestAnimationFrame((()=>{n()}))}))}})))}Em.create({name:"floatingMenu",addOptions:()=>({element:null,tippyOptions:{},pluginKey:"floatingMenu",shouldShow:null}),addProseMirrorPlugins(){return this.options.element?[fy({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}}),S({name:"BubbleMenu",props:{pluginKey:{type:[String,Object],default:"bubbleMenu"},editor:{type:Object,required:!0},updateDelay:{type:Number,default:void 0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(e,{slots:t}){const n=f(null);return d((()=>{const{updateDelay:t,editor:i,pluginKey:r,shouldShow:o,tippyOptions:a}=e;i.registerPlugin(py({updateDelay:t,editor:i,element:n.value,pluginKey:r,shouldShow:o,tippyOptions:a}))})),te((()=>{const{pluginKey:t,editor:n}=e;n.unregisterPlugin(t)})),()=>{var e;return u("div",{ref:n},null===(e=t.default)||void 0===e?void 0:e.call(t))}}});class vy extends cv{constructor(e={}){return super(e),this.vueRenderers=E(new Map),this.contentComponent=null,this.reactiveState=gy(this.view.state),this.reactiveExtensionStorage=gy(this.extensionStorage),this.on("transaction",(()=>{this.reactiveState.value=this.view.state,this.reactiveExtensionStorage.value=this.extensionStorage})),ie(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(e,t){super.registerPlugin(e,t),this.reactiveState.value=this.view.state}unregisterPlugin(e){super.unregisterPlugin(e),this.reactiveState.value=this.view.state}}const _y=S({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(e){const t=f(),n=y();return k((()=>{const i=e.editor;i&&i.options.element&&t.value&&N((()=>{if(!t.value||!i.options.element.firstChild)return;const e=H(t.value);t.value.append(...i.options.element.childNodes),i.contentComponent=n.ctx._,i.setOptions({element:e}),i.createNodeViews()}))})),te((()=>{const t=e.editor;if(!t)return;if(t.isDestroyed||t.view.setProps({nodeViews:{}}),t.contentComponent=null,!t.options.element.firstChild)return;const n=document.createElement("div");n.append(...t.options.element.childNodes),t.setOptions({element:n})})),{rootEl:t}},render(){const e=[];return this.editor&&this.editor.vueRenderers.forEach((t=>{const n=u(ne,{to:t.teleportElement,key:t.id},u(t.component,{ref:t.id,...t.props}));e.push(n)})),u("div",{ref:e=>{this.rootEl=e}},...e)}});S({name:"FloatingMenu",props:{pluginKey:{type:null,default:"floatingMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(e,{slots:t}){const n=f(null);return d((()=>{const{pluginKey:t,editor:i,tippyOptions:r,shouldShow:o}=e;i.registerPlugin(fy({pluginKey:t,editor:i,element:n.value,tippyOptions:r,shouldShow:o}))})),te((()=>{const{pluginKey:t,editor:n}=e;n.unregisterPlugin(t)})),()=>{var e;return u("div",{ref:n},null===(e=t.default)||void 0===e?void 0:e.call(t))}}}),S({props:{as:{type:String,default:"div"}},render(){return u(this.as,{style:{whiteSpace:"pre-wrap"},"data-node-view-content":""})}}),S({props:{as:{type:String,default:"div"}},inject:["onDragStart","decorationClasses"],render(){var e,t;return u(this.as,{class:this.decorationClasses,style:{whiteSpace:"normal"},"data-node-view-wrapper":"",onDragstart:this.onDragStart},null===(t=(e=this.$slots).default)||void 0===t?void 0:t.call(e))}});const yy=lv.create({name:"doc",topNode:!0,content:"block+"}),Iy=lv.create({name:"paragraph",priority:1e3,addOptions:()=>({HTMLAttributes:{}}),group:"block",content:"inline*",parseHTML:()=>[{tag:"p"}],renderHTML({HTMLAttributes:e}){return["p",am(this.options.HTMLAttributes,e),0]},addCommands(){return{setParagraph:()=>({commands:e})=>e.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),My=Em.create({name:"placeholder",addOptions:()=>({emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}),addProseMirrorPlugins(){return[new gp({key:new _p("placeholder"),props:{decorations:({doc:e,selection:t})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:i}=t,r=[];if(!n)return null;const o=e.type.createAndFill(),a=(null==o?void 0:o.sameMarkup(e))&&null===o.content.findDiffStart(e.content);return e.descendants(((e,t)=>{const n=i>=t&&i<=t+e.nodeSize,o=!e.isLeaf&&!e.childCount;if((n||!this.options.showOnlyCurrent)&&o){const i=[this.options.emptyNodeClass];a&&i.push(this.options.emptyEditorClass);const o=Qf.node(t,t+e.nodeSize,{class:i.join(" "),"data-placeholder":"function"==typeof this.options.placeholder?this.options.placeholder({editor:this.editor,node:e,pos:t,hasAnchor:n}):this.options.placeholder});r.push(o)}return this.options.includeChildren})),ng.create(e,r)}}})]}}),Ty=lv.create({name:"text",group:"inline"});const Cy=new _p("suggestion");function Sy({pluginKey:e=Cy,editor:t,char:n="@",allowSpaces:i=!1,allowedPrefixes:r=[" "],startOfLine:o=!1,decorationTag:a="span",decorationClass:s="suggestion",command:c=(()=>null),items:u=(()=>[]),render:l=(()=>({})),allow:d=(()=>!0)}){let p;const h=null==l?void 0:l(),f=new gp({key:e,view(){return{update:async(e,n)=>{var i,r,o,a,s,l,d;const f=null===(i=this.key)||void 0===i?void 0:i.getState(n),g=null===(r=this.key)||void 0===r?void 0:r.getState(e.state),m=f.active&&g.active&&f.range.from!==g.range.from,v=!f.active&&g.active,_=f.active&&!g.active,y=v||m,I=!v&&!_&&f.query!==g.query&&!m,M=_||m;if(!y&&!I&&!M)return;const T=M&&!y?f:g,C=e.dom.querySelector(`[data-decoration-id="${T.decorationId}"]`);p={editor:t,range:T.range,query:T.query,text:T.text,items:[],command:e=>{c({editor:t,range:T.range,props:e})},decorationNode:C,clientRect:C?()=>{var n;const{decorationId:i}=null===(n=this.key)||void 0===n?void 0:n.getState(t.state),r=e.dom.querySelector(`[data-decoration-id="${i}"]`);return(null==r?void 0:r.getBoundingClientRect())||null}:null},y&&(null===(o=null==h?void 0:h.onBeforeStart)||void 0===o||o.call(h,p)),I&&(null===(a=null==h?void 0:h.onBeforeUpdate)||void 0===a||a.call(h,p)),(I||y)&&(p.items=await u({editor:t,query:T.query})),M&&(null===(s=null==h?void 0:h.onExit)||void 0===s||s.call(h,p)),I&&(null===(l=null==h?void 0:h.onUpdate)||void 0===l||l.call(h,p)),y&&(null===(d=null==h?void 0:h.onStart)||void 0===d||d.call(h,p))},destroy:()=>{var e;p&&(null===(e=null==h?void 0:h.onExit)||void 0===e||e.call(h,p))}}},state:{init:()=>({active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}),apply(e,a,s,c){const{isEditable:u}=t,{composing:l}=t.view,{selection:p}=e,{empty:h,from:f}=p,g={...a};if(g.composing=l,u&&(h||t.view.composing)){!(f<a.range.from||f>a.range.to)||l||a.composing||(g.active=!1);const e=function(e){var t;const{char:n,allowSpaces:i,allowedPrefixes:r,startOfLine:o,$position:a}=e,s=n.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),c=new RegExp(`\\s${s}$`),u=o?"^":"",l=i?new RegExp(`${u}${s}.*?(?=\\s${s}|$)`,"gm"):new RegExp(`${u}(?:^)?${s}[^\\s${s}]*`,"gm"),d=(null===(t=a.nodeBefore)||void 0===t?void 0:t.isText)&&a.nodeBefore.text;if(!d)return null;const p=a.pos-d.length,h=Array.from(d.matchAll(l)).pop();if(!h||void 0===h.input||void 0===h.index)return null;const f=h.input.slice(Math.max(0,h.index-1),h.index),g=new RegExp(`^[${null==r?void 0:r.join("")}\0]?$`).test(f);if(null!==r&&!g)return null;const m=p+h.index;let v=m+h[0].length;return i&&c.test(d.slice(v-1,v+1))&&(h[0]+=" ",v+=1),m<a.pos&&v>=a.pos?{range:{from:m,to:v},query:h[0].slice(n.length),text:h[0]}:null}({char:n,allowSpaces:i,allowedPrefixes:r,startOfLine:o,$position:p.$from}),s=`id_${Math.floor(4294967295*Math.random())}`;e&&d({editor:t,state:c,range:e.range})?(g.active=!0,g.decorationId=a.decorationId?a.decorationId:s,g.range=e.range,g.query=e.query,g.text=e.text):g.active=!1}else g.active=!1;return g.active||(g.decorationId=null,g.range={from:0,to:0},g.query=null,g.text=null),g}},props:{handleKeyDown(e,t){var n;const{active:i,range:r}=f.getState(e.state);return i&&(null===(n=null==h?void 0:h.onKeyDown)||void 0===n?void 0:n.call(h,{view:e,event:t,range:r}))||!1},decorations(e){const{active:t,range:n,decorationId:i}=f.getState(e);return t?ng.create(e.doc,[Qf.inline(n.from,n.to,{nodeName:a,class:s,"data-decoration-id":i})]):null}}});return f}const Ey=new _p("mention"),ky=lv.create({name:"mention",addOptions(){return{HTMLAttributes:{},renderLabel({options:e,node:t}){var n;return`${e.suggestion.char}${null!==(n=t.attrs.label)&&void 0!==n?n:t.attrs.id}`},suggestion:{char:"@",pluginKey:Ey,command:({editor:e,range:t,props:n})=>{var i,r;const o=e.view.state.selection.$to.nodeAfter;(null===(i=null==o?void 0:o.text)||void 0===i?void 0:i.startsWith(" "))&&(t.to+=1),e.chain().focus().insertContentAt(t,[{type:this.name,attrs:n},{type:"text",text:" "}]).run(),null===(r=window.getSelection())||void 0===r||r.collapseToEnd()},allow:({state:e,range:t})=>{const n=e.doc.resolve(t.from),i=e.schema.nodes[this.name];return!!n.parent.type.contentMatch.matchType(i)}}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes:()=>({id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}}}),parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:e,HTMLAttributes:t}){return["span",am({"data-type":this.name},this.options.HTMLAttributes,t),this.options.renderLabel({options:this.options,node:e})]},renderText({node:e}){return this.options.renderLabel({options:this.options,node:e})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command((({tr:e,state:t})=>{let n=!1;const{selection:i}=t,{empty:r,anchor:o}=i;return!!r&&(t.doc.nodesBetween(o-1,o,((t,i)=>{if(t.type.name===this.name)return n=!0,e.insertText(this.options.suggestion.char||"",i,i+t.nodeSize),!1})),n)}))}},addProseMirrorPlugins(){return[Sy({editor:this.editor,...this.options.suggestion})]}}),by=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,Dy=lv.create({name:"image",addOptions:()=>({inline:!1,allowBase64:!1,HTMLAttributes:{}}),inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes:()=>({src:{default:null},alt:{default:null},title:{default:null}}),parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:e}){return["img",am(this.options.HTMLAttributes,e)]},addCommands(){return{setImage:e=>({commands:t})=>t.insertContent({type:this.name,attrs:e})}},addInputRules(){return[(e={find:by,type:this.type,getAttributes:e=>{const[,,t,n,i]=e;return{src:n,alt:t,title:i}}},new mm({find:e.find,handler:({state:t,range:n,match:i})=>{const r=um(e.getAttributes,void 0,i)||{},{tr:o}=t,a=n.from;let s=n.to;if(i[1]){let t=a+i[0].lastIndexOf(i[1]);t>s?t=s:s=t+i[1].length;const n=i[0][i[0].length-1];o.insertText(n,a+i[0].length-1),o.replaceWith(t,s,e.type.create(r))}else i[0]&&o.replaceWith(a,s,e.type.create(r))}}))];var e}}),wy=Dy.extend({name:"custom-image",addAttributes:()=>({...Dy.config.addAttributes(),class:{default:"image",rendered:!1}}),addCommands(){return{setImage:e=>({tr:t,commands:n})=>{var i,r,o;return"custom-image"==(null==(o=null==(r=null==(i=t.selection)?void 0:i.node)?void 0:r.type)?void 0:o.name)?n.updateAttributes("custom-image",e):n.insertContent({type:this.name,attrs:e})}}},renderHTML({node:e,HTMLAttributes:t}){return t.class="custom-image-"+e.attrs.class,["img",am(this.options.HTMLAttributes,t)]}}),Ay=f(),Ry=f(!1),Ly=f(),Oy=f(),Ny=f({left:0,top:0}),Py=f(),Uy=f(0),xy=f(),Gy=f(!1),Fy=()=>{var e,t,n,i;(null==(e=null==Oy?void 0:Oy.value)?void 0:e.length)&&(Uy.value=(Uy.value+(null==(t=null==Oy?void 0:Oy.value)?void 0:t.length)-1)%(null==(n=null==Oy?void 0:Oy.value)?void 0:n.length),null==(i=null==xy?void 0:xy.value[Uy.value])||i.scrollIntoView(!1))},Vy=()=>{var e,t,n;(null==(e=null==Oy?void 0:Oy.value)?void 0:e.length)&&(Uy.value=(Uy.value+1)%(null==(t=null==Oy?void 0:Oy.value)?void 0:t.length),null==(n=null==xy?void 0:xy.value[Uy.value])||n.scrollIntoView(!1))},qy=()=>{By(Uy.value)},By=e=>{var t;if(!(null==(t=null==Ly?void 0:Ly.value)?void 0:t.length))return;const n=null==Ly?void 0:Ly.value[e];n&&Py.value&&Py.value({id:null==n?void 0:n.userID,label:(null==n?void 0:n.nick)||(null==n?void 0:n.userID)})},Hy=S({props:{memberList:{type:Array,default:()=>[]},isGroup:{type:Boolean,default:!1},selfInfo:{type:Object,default:()=>({})},isH5:{type:Boolean,default:!1}},setup(e){const{memberList:t,isGroup:n,selfInfo:i}=b(e),r={userID:Qi.TYPES.MSG_AT_ALL,nick:"所有人",isAll:!0,avatar:"/assets/at-d87bb6b4.svg"},o=f();k((()=>{Ry.value=Ry.value&&n.value,Gy.value=e.isH5})),v((()=>t.value),(()=>{var e,n,o;(null==(e=null==t?void 0:t.value[0])?void 0:e.isAll)||null==(n=null==t?void 0:t.value)||n.unshift(r);const a=null==(o=null==t?void 0:t.value)?void 0:o.filter((e=>{var t;return(null==e?void 0:e.userID)!==(null==(t=null==i?void 0:i.value)?void 0:t.userID)}));Ly.value=a,Oy.value=a}),{deep:!0,immediate:!0}),v((()=>[Ny.value,null==Ay?void 0:Ay.value]),(()=>{var e;!Gy.value&&(null==Ay?void 0:Ay.value)&&(null==(e=null==Ay?void 0:Ay.value)?void 0:e.style)&&(Ay.value.style.left=Ny.value.left+"px",Ay.value.style.top=Ny.value.top-Ay.value.clientHeight+"px")}),{deep:!0,immediate:!0});const a=()=>{Ry.value=!1,Oy.value=Ly.value,Ny.value={left:0,top:0}};return Pa(o,(()=>{a()})),{selectedIndex:Uy,selectItem:By,showAtList:Ry,closeAt:a,showMemberList:Oy,allMemberList:Ly,MessageInputAt:Ay,memberListItems:xy,dialog:o}}}),jy={class:"memberList",ref:"dialog"},Ky={key:0,class:"memberList-title"},zy={class:"title"},Wy={class:"memberList-box"},Yy=["onClick"],$y=["src"];const Jy=D(Hy,[["render",function(e,t,n,i,r,o){return e.showAtList?(w(),A("div",{key:0,class:G(["message-input-at",[e.isH5&&"message-input-at-h5"]]),ref:"MessageInputAt"},[P("div",jy,[e.isH5?(w(),A("header",Ky,[P("span",zy,L(e.$t("TUIChat.选择提醒的人")),1),P("i",{class:"icon icon-close close",onClick:t[0]||(t[0]=(...t)=>e.closeAt&&e.closeAt(...t))})])):O("",!0),P("ul",Wy,[(w(!0),A(_,null,R(e.showMemberList,((t,n)=>(w(),A("li",{class:G(["memberList-box-body",[n===e.selectedIndex&&"selected"]]),key:n,onClick:t=>e.selectItem(n),ref_for:!0,ref:"memberListItems"},[P("img",{src:(null==t?void 0:t.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png"},null,8,$y),P("span",null,L((null==t?void 0:t.nick)?null==t?void 0:t.nick:null==t?void 0:t.userID),1)],10,Yy)))),128))])],512)],2)):O("",!0)}],["__scopeId","data-v-09795d68"]]),Xy=S({__name:"message-input-editor",props:{placeholder:{type:String,default:"this is placeholder"},replayOrReferenceMessage:{type:Object,default:()=>({})},isMute:{type:Boolean,default:!0},muteText:{type:String,default:""},enableInput:{type:Boolean,default:!0},enableAt:{type:Boolean,default:!0},enableDragUpload:{type:Boolean,default:!0},enableTyping:{type:Boolean,default:!0},isH5:{type:Boolean,default:!0},isGroup:{type:Boolean,default:!1}},emits:["sendMessage","onTyping"],setup(e,{expose:t,emit:n}){const i=e,{placeholder:r,isH5:o,enableAt:a,enableDragUpload:s,isGroup:c,enableTyping:u}=b(i),l=f(!0),p=f(!0),g=((e={})=>{const t=h();return d((()=>{t.value=new vy(e)})),te((()=>{var e;null===(e=t.value)||void 0===e||e.destroy()})),t})({extensions:[yy,Iy,Ty,My.configure({emptyEditorClass:"is-editor-empty",placeholder:r.value}),ky.configure({HTMLAttributes:{class:"mention"},suggestion:a.value&&{allowedPrefixes:null,items:e=>{var t;const n=null==(t=null==Ly?void 0:Ly.value)?void 0:t.filter((t=>{var n,i,r,o,a,s;return(null==(r=null==(n=null==t?void 0:t.nick)?void 0:n.toLowerCase())?void 0:r.startsWith(null==(i=null==e?void 0:e.query)?void 0:i.toLowerCase()))||(null==(s=null==(o=null==t?void 0:t.userID)?void 0:o.toLowerCase())?void 0:s.startsWith(null==(a=null==e?void 0:e.query)?void 0:a.toLowerCase()))}));return Oy.value=(null==n?void 0:n.length)?n:Ly.value,Oy.value},render:()=>({onStart:e=>{if(Ry.value=!0,!(null==e?void 0:e.clientRect))return;const t=null==e?void 0:e.clientRect();(null==t?void 0:t.left)&&(null==t?void 0:t.top)&&!Gy.value&&(Ny.value={left:null==t?void 0:t.left,top:null==t?void 0:t.top}),Py.value=e.command},onUpdate(e){if(!(null==e?void 0:e.clientRect))return;const t=null==e?void 0:e.clientRect();(null==t?void 0:t.left)&&(null==t?void 0:t.top)&&!Gy.value&&(Ny.value={left:null==t?void 0:t.left,top:null==t?void 0:t.top})},onKeyDown(e){var t,n;return"Enter"===e.event.key&&(null==(t=e.event)||t.stopPropagation(),null==(n=e.event)||n.preventDefault()),"Escape"===e.event.key?(Ry.value=!1,Oy.value=Ly.value,!0):"ArrowUp"===(null==e?void 0:e.event.key)?(Fy(),!0):"ArrowDown"===(null==e?void 0:e.event.key)?(Vy(),!0):"Enter"===(null==e?void 0:e.event.key)&&(qy(),!0)},onExit(e){Ry.value=!1,Oy.value=Ly.value,Ny.value={left:0,top:0}}})}}),wy.configure({inline:!0,allowBase64:!0,HTMLAttributes:{class:"custom-image"}})],autofocus:!0,editable:!0,injectCSS:!1,onUpdate({editor:e,transaction:t}){var i,r;u.value&&!c.value&&(p.value=!e.isFocused,(null==(r=null==(i=null==t?void 0:t.doc)?void 0:i.content)?void 0:r.size)>2?l.value=!1:l.value=!0,n("onTyping",l.value,p.value))},onFocus(){var e;if(o.value&&(null==(e=null==document?void 0:document.getElementById("app"))?void 0:e.style)){const e=document.body.scrollHeight-window.innerHeight;document.getElementById("app").style.marginBottom=`${e}px`,document.getElementById("app").style.height=`calc(100% - ${e}px)`}u.value&&!c.value&&(p.value=!0,n("onTyping",l.value,p.value))},onBlur(){var e;o.value&&(null==(e=null==document?void 0:document.getElementById("app"))?void 0:e.style)&&(document.getElementById("app").style.marginBottom="",document.getElementById("app").style.height="100%"),u.value&&!c.value&&(p.value=!0,n("onTyping",l.value,p.value))}}),m=f(),v=e=>{var t,i;(null==o?void 0:o.value)||(null==e||e.preventDefault(),null==e||e.stopPropagation(),13===e.keyCode&&e.ctrlKey?null==(i=null==(t=null==g?void 0:g.value)?void 0:t.commands)||i.insertContent("<p></p>"):13===e.keyCode&&n("sendMessage"))},_=new Map,y=async(e,t)=>{var n,i,r,a;if(e.preventDefault(),e.stopPropagation(),!o.value&&((null==s?void 0:s.value)||"drop"!==t)&&("drop"===t&&e.dataTransfer||"paste"===t&&e.clipboardData)){const o="drop"===t?null==(n=null==e?void 0:e.dataTransfer)?void 0:n.files:null==(i=null==e?void 0:e.clipboardData)?void 0:i.files;for(let e=0;e<o.length;e++){const t=o[e],n=t.type.startsWith("image/"),i=n?URL.createObjectURL(t):await T(t);null==(a=null==(r=null==g?void 0:g.value)?void 0:r.commands)||a.insertContent({type:"custom-image",attrs:{src:i,alt:null==t?void 0:t.name,title:null==t?void 0:t.name,class:n?"normal":"file"}}),_.set(i,t),e===o.length-1&&setTimeout((()=>{var e,t,n,i;null==(t=null==(e=null==g?void 0:g.value)?void 0:e.commands)||t.focus("end"),null==(i=null==(n=null==g?void 0:g.value)?void 0:n.commands)||i.scrollIntoView()}),10)}}},I=new Map,T=async e=>{const{name:t,type:n}=e,i=document.createElement("canvas");i.style.width="160px",i.style.height="50px";var r=window.devicePixelRatio;i.width=Math.floor(160*r),i.height=Math.floor(50*r);const o=i.getContext("2d");if(!o)return"";o.scale(r,r);const{iconSrc:a,iconType:s}=C(n),c=await((e,t)=>new Promise(((n,i)=>{if(I.has(t))n(I.get(t));else{let r=new Image;r.crossOrigin="anonymous",r.onload=()=>{I.set(t,r),n(r)},r.onerror=i,r.src=e}})))(a,s);null==o||o.drawImage(c,10,10,30,30);const u=S(t);o.fillText(u,45,22);return i.toDataURL()},C=e=>{const t="https://web.sdk.qcloud.com/component/TUIKit/assets/file-";let n="",i="";return["image","pdf","text","ppt","presentation","sheet","zip","word","video","unknown"].forEach((r=>{e.includes(r)&&(n=t+r+".svg",i=r)})),{iconSrc:n||t+"unknown.svg",iconType:i||"unknown"}},S=e=>{if(!e)return e;let t="",n=0;for(let i=0;i<(null==e?void 0:e.length);i++){if(n>16){t+="...";break}t+=e[i],/[a-z]|[0-9]|[,;.!@#-+/\\$%^*()<>?:"'{}~]/i.test(e[i])?n+=1:n+=2}return t},E=()=>{var e;const t=null==(e=null==g?void 0:g.value)?void 0:e.getJSON(),n=[],i=e=>{if(e&&e.type)return"text"!==e.type&&"custom-image"!==e.type&&"mention"!==e.type?("paragraph"===e.type&&r(e),void(e.content&&e.content.length&&e.content.forEach((e=>{i(e)})))):void r(e)},r=e=>{var t,i,r,o,a,s,c,u,l,d,p,h,f,g,m,v,y,I;if("paragraph"===e.type)n.length>0&&n[n.length-1]&&"text"===(null==(t=n[n.length-1])?void 0:t.type)&&(n[n.length-1].payload.text+="\n");else if("text"===e.type||"custom-image"===e.type&&"emoji"===(null==(i=null==e?void 0:e.attrs)?void 0:i.class)){const t="text"===e.type?null==e?void 0:e.text:null==(r=null==e?void 0:e.attrs)?void 0:r.alt;n.length>0&&n[n.length-1]&&"text"===(null==(o=n[n.length-1])?void 0:o.type)?n[n.length-1].payload.text+=t:n.push({type:"text",payload:{text:t}})}else if("custom-image"===e.type&&"normal"===(null==(a=null==e?void 0:e.attrs)?void 0:a.class))n.push({type:"image",payload:{file:null==_?void 0:_.get(null==(s=null==e?void 0:e.attrs)?void 0:s.src)}});else if("custom-image"===e.type&&"file"===(null==(c=null==e?void 0:e.attrs)?void 0:c.class)){const t=null==_?void 0:_.get(null==(u=null==e?void 0:e.attrs)?void 0:u.src);n.push({type:(null==(l=null==t?void 0:t.type)?void 0:l.includes("video"))?"video":"file",payload:{file:t}})}else if("mention"===e.type){const t="@"+(null==(d=null==e?void 0:e.attrs)?void 0:d.label)+" ";n.length>0&&n[n.length-1]&&"text"===(null==(p=n[n.length-1])?void 0:p.type)?n[n.length-1].payload.text+=t:n.push({type:"text",payload:{text:t}}),(null==(f=null==(h=n[n.length-1])?void 0:h.payload)?void 0:f.atUserList)?null==(y=null==(m=null==(g=n[n.length-1])?void 0:g.payload)?void 0:m.atUserList)||y.push(null==(v=null==e?void 0:e.attrs)?void 0:v.id):n[n.length-1].payload.atUserList=[null==(I=null==e?void 0:e.attrs)?void 0:I.id]}};return i(t),n};return t({getEditorContent:()=>E(),addEmoji:e=>{var t,n,i,r,o;null==(n=null==(t=null==g?void 0:g.value)?void 0:t.commands)||n.insertContent({type:"custom-image",attrs:{src:null==e?void 0:e.url,alt:null==e?void 0:e.name,title:null==e?void 0:e.name,class:"emoji"}}),null==(i=null==g?void 0:g.value)||i.commands.focus("end"),null==(o=null==(r=null==g?void 0:g.value)?void 0:r.commands)||o.scrollIntoView()},resetEditor:()=>{var e,t,n,i;null==(t=null==(e=null==g?void 0:g.value)?void 0:e.commands)||t.clearContent(!0),null==_||_.clear(),null==(i=null==(n=null==g?void 0:g.value)?void 0:n.commands)||i.focus("end"),p.value=!0,l.value=!0},setEditorContent:e=>{var t,n;null==(n=null==(t=null==g?void 0:g.value)?void 0:t.commands)||n.insertContent(e)}}),(t,n)=>(w(),A("div",{class:G(["message-input-container",H(o)&&"message-input-container-h5"])},[z(P("div",{class:"message-input-mute"},L(t.$t(`TUIChat.${e.muteText}`)),513),[[W,e.isMute]]),z(M(H(_y),{editor:H(g),class:"message-input-area",ref_key:"editorContainer",ref:m,onDrop:n[0]||(n[0]=e=>y(e,"drop")),onPaste:n[1]||(n[1]=e=>y(e,"paste")),onKeydown:Q(v,["enter"])},null,8,["editor","onKeydown"]),[[W,!e.isMute&&e.enableInput]])],2))}}),Zy=D(Xy,[["__scopeId","data-v-13001fe1"]]),Qy={class:"message-input-button-hover"},eI=D(S({__name:"message-input-button",props:{enableSend:{type:Boolean,default:!0},messages:{type:Array,default:()=>[]},isH5:{type:Boolean,default:!0}},emits:["sendMessage"],setup(e,{emit:t}){const n=e,{enableSend:i}=b(n),r=()=>{t("sendMessage")};return(t,n)=>(w(),A("div",{class:G(["message-input-button",e.isH5&&"message-input-button-h5"])},[H(i)?(w(),A("button",{key:0,class:"message-input-button-cont","data-type":"text",onClick:r,disabled:!1},[P("p",Qy,L(t.$t("TUIChat.按Enter发送，Ctrl+Enter换行")),1),oe(" "+L(t.$t("发送")),1)])):O("",!0)],2))}}),[["__scopeId","data-v-ac8acbd0"]]),tI={key:0,class:"reference"},nI={class:"reference-box"},iI={class:"reference-box-show"},rI={class:"reference-box-show-name"},oI={key:1,class:"reply"},aI={class:"reply-box"},sI=(e=>(F("data-v-8b9b1da8"),e=e(),V(),e))((()=>P("i",null,null,-1))),cI={class:"reply-box-show"},uI=D(S({__name:"message-input-reference-or-reply",props:{replyOrReference:{type:Object,default:()=>({})},isH5:{type:Boolean,default:!1}},emits:["resetReplyOrReference"],setup(e,{emit:t}){const n=e,{replyOrReference:i,isH5:r}=b(n),o=()=>{t("resetReplyOrReference")};return(e,t)=>{var n,a,s,c,u,l,d,p,h,f,g,m,v,_,y,I,M,T,C,S,E;return(null==(n=H(i))?void 0:n.show)?(w(),A("div",{key:0,class:G(["reference"===(null==(a=H(i))?void 0:a.show)&&"message-input-reference","reply"===(null==(s=H(i))?void 0:s.show)&&"message-input-reply",H(r)&&"reference"===(null==(c=H(i))?void 0:c.show)&&"message-input-reference-h5",H(r)&&"reply"===(null==(u=H(i))?void 0:u.show)&&"message-input-reply-h5"])},["reference"===(null==(l=H(i))?void 0:l.show)?(w(),A("div",tI,[P("div",nI,[P("div",iI,[P("span",rI,L((null==(p=null==(d=H(i))?void 0:d.message)?void 0:p.nick)?null==(f=null==(h=H(i))?void 0:h.message)?void 0:f.nick:null==(m=null==(g=H(i))?void 0:g.message)?void 0:m.from)+": ",1),P("span",null,L(null==(v=H(i))?void 0:v.content),1)]),P("label",{class:"icon icon-cancel",onClick:o})])])):"reply"===(null==(_=H(i))?void 0:_.show)?(w(),A("div",oI,[P("div",aI,[sI,P("div",cI,[P("span",null,L((null==(I=null==(y=H(i))?void 0:y.message)?void 0:I.nick)?null==(T=null==(M=H(i))?void 0:M.message)?void 0:T.nick:null==(S=null==(C=H(i))?void 0:C.message)?void 0:S.from)+L(H(r)?":":""),1),P("span",null,L(null==(E=H(i))?void 0:E.content),1)]),P("label",{class:"icon icon-cancel",onClick:o})])])):O("",!0)],2)):O("",!0)}}}),[["__scopeId","data-v-8b9b1da8"]]),lI=D(S({__name:"index",props:{placeholder:{type:String,default:"this is placeholder"},conversation:{type:Object,default:()=>({})},replyOrReference:{type:Object,default:()=>({})},isGroup:{type:Boolean,default:!1},memberList:{type:Array,default:()=>[]},isMute:{type:Boolean,default:!0},muteText:{type:String,default:""},enableInput:{type:Boolean,default:!0},enableAt:{type:Boolean,default:!0},enableDragUpload:{type:Boolean,default:!0},enableTyping:{type:Boolean,default:!0},env:{type:Object,default:()=>({})}},emits:["sendMessage","resetReplyOrReference","onTyping"],setup(e,{expose:t,emit:n}){var i;const r=e,{placeholder:o,isGroup:a,memberList:s,conversation:c,replyOrReference:u,env:l,enableTyping:d}=b(r),p=f(),h=f(null==(i=null==r?void 0:r.env)?void 0:i.isH5);v((()=>c.value),((e,t)=>{var n;(null==e?void 0:e.conversationID)!==(null==t?void 0:t.conversationID)&&(null==(n=null==p?void 0:p.value)||n.resetEditor())}),{immediate:!0});const g=async()=>{var e,t,i,r;const o=null==(t=null==(e=null==window?void 0:window.TUIKitTUICore)?void 0:e.TUIServer)?void 0:t.TUIChat,a=null==(i=null==p?void 0:p.value)?void 0:i.getEditorContent(),s=u.value;await(null==a?void 0:a.forEach((async e=>{var t,i,r,a,c,u,d,p;try{let l,h;switch(l=_(l),null==e?void 0:e.type){case"text":l=y(l),h=(null==(t=null==e?void 0:e.payload)?void 0:t.atUserList)?await(null==o?void 0:o.sendTextAtMessage({text:JSON.parse(JSON.stringify(null==(i=null==e?void 0:e.payload)?void 0:i.text)),atUserList:null==(r=null==e?void 0:e.payload)?void 0:r.atUserList},l)):await(null==o?void 0:o.sendTextMessage(JSON.parse(JSON.stringify(null==(a=null==e?void 0:e.payload)?void 0:a.text)),l)),"reply"===(null==s?void 0:s.show)&&await o.replyMessage(null==(c=null==h?void 0:h.data)?void 0:c.message);break;case"image":await(null==o?void 0:o.sendImageMessage(null==(u=null==e?void 0:e.payload)?void 0:u.file));break;case"video":await(null==o?void 0:o.sendVideoMessage(null==(d=null==e?void 0:e.payload)?void 0:d.file));break;case"file":await(null==o?void 0:o.sendFileMessage(null==(p=null==e?void 0:e.payload)?void 0:p.file))}n("sendMessage")}catch(h){ns(h,l.value)}}))),null==(r=null==p?void 0:p.value)||r.resetEditor(),I()},m=(e,t)=>{n("onTyping",e,t)},_=e=>(d.value&&(e||(e={}),e.messageFeature={needTyping:1,version:1}),e),y=e=>{var t,n,i,r,o,a,s,c,l,d,p,h,f,g,m,v,_,y,I,M;if("reply"!==(null==(t=null==u?void 0:u.value)?void 0:t.show)&&"reference"!==(null==(n=null==u?void 0:u.value)?void 0:n.show))return e;if(e||(e={}),e.messageReply={messageAbstract:null==(i=null==u?void 0:u.value)?void 0:i.content,messageSender:(null==(o=null==(r=null==u?void 0:u.value)?void 0:r.message)?void 0:o.nick)||(null==(s=null==(a=null==u?void 0:u.value)?void 0:a.message)?void 0:s.from),messageID:null==(l=null==(c=null==u?void 0:u.value)?void 0:c.message)?void 0:l.ID,messageType:null==(d=null==u?void 0:u.value)?void 0:d.type,version:1},"reply"===(null==(p=null==u?void 0:u.value)?void 0:p.show))try{if(e.messageReply.messageRootID=null==(f=null==(h=null==u?void 0:u.value)?void 0:h.message)?void 0:f.ID,null==(m=null==(g=null==u?void 0:u.value)?void 0:g.message)?void 0:m.cloudCustomData){const t=vr(null==(_=null==(v=null==u?void 0:u.value)?void 0:v.message)?void 0:_.cloudCustomData);e.messageReply.messageRootID=(null==(y=null==t?void 0:t.messageReply)?void 0:y.messageRootID)||(null==(M=null==(I=null==u?void 0:u.value)?void 0:I.message)?void 0:M.ID)}}catch(T){}return e},I=()=>{n("resetReplyOrReference")};return t({addEmoji:e=>{var t;null==(t=null==p?void 0:p.value)||t.addEmoji(e)},reEdit:e=>{var t,n;null==(t=null==p?void 0:p.value)||t.resetEditor(),I(),null==(n=null==p?void 0:p.value)||n.setEditorContent(e)}}),(t,n)=>{var i,r;return w(),A("div",{class:G(["message-input",h.value&&"message-input-h5"])},[M(Zy,{ref_key:"editor",ref:p,isH5:h.value,placeholder:H(o),isGroup:H(a),isMute:e.isMute,muteText:e.muteText,enableInput:e.enableInput,enableAt:e.enableAt,enableTyping:H(d),enableDragUpload:e.enableDragUpload,onSendMessage:g,onOnTyping:m},null,8,["isH5","placeholder","isGroup","isMute","muteText","enableInput","enableAt","enableTyping","enableDragUpload"]),e.isMute?O("",!0):(w(),j(eI,{key:0,isH5:h.value,onSendMessage:g},null,8,["isH5"])),e.enableAt?(w(),j(Jy,{key:1,memberList:H(s),isGroup:H(a),selfInfo:null==(r=null==(i=H(c))?void 0:i.groupProfile)?void 0:r.selfInfo,isH5:h.value},null,8,["memberList","isGroup","selfInfo","isH5"])):O("",!0),M(uI,{replyOrReference:H(u),isH5:h.value,onResetReplyOrReference:I},null,8,["replyOrReference","isH5"])],2)}}}),[["__scopeId","data-v-6549a835"]]),dI=S({name:"TUIChat",components:{MessageSystem:Zs,MessageTimestamp:gc,Manage:nl,MessageInput:lI,MessageItem:fc},props:{isMsgNeedReadReceipt:{type:Boolean,default:!1},isNeedTyping:{type:Boolean,default:!0},isNeedEmojiReact:{type:Boolean,default:!0}},setup(e){var t,n,i,r,o,a;const{TUIServer:s}=dI;null==(n=null==(t=null==s?void 0:s.TUICore)?void 0:t.TUIServer)||n.TUIGroup,null==(r=null==(i=null==s?void 0:s.TUICore)?void 0:i.TUIServer)||r.TUIProfile;const c=s.TUICore.isOfficial&&Co&&Co()||{},{t:u}=window.TUIKitTUICore.config.i18n.useI18n(),l=E({messageList:[],conversation:{},text:"",atText:"",types:s.TUICore.TIM.TYPES,currentMessage:{},dialogID:"",forwardStatus:!1,receiptDialogStatus:!1,repliesDialogStatus:!1,showImagePreview:!1,currentImagePreview:{},isCompleted:!1,userInfoView:!1,userInfo:{isGroup:!1,list:[]},selfInfo:{},messageComponents:RT("message"),isShow:!1,muteText:"您已被管理员禁言",isFirstSend:!0,isFirstRender:!0,showGroupMemberList:!1,reference:{message:{},content:"",type:0,show:""},historyReference:!1,referenceID:"",allMemberList:[],env:s.TUICore.TUIEnv,showResend:!1,resendMessage:{},inputBlur:!1,inputComposition:!1,inputCompositionCont:"",needTyping:e.isNeedTyping,needReadReceipt:!1,peerNeedReceipt:!1,needToBottom:!1,toBottomTipCont:"",messageInView:[],readSet:new Set,isUserAction:!1,scroll:{scrollTop:0,scrollHeight:0,scrollTopMin:1/0,scrollTopMax:0},isMsgNeedReadReceipt:!1,isNeedEmojiReact:!1,dropDownRef:null,typingRef:null}),p=!!ae().default,h=async e=>{var t,n,i;e&&await(null==(i=null==(n=null==(t=null==s?void 0:s.TUICore)?void 0:t.TUIServer)?void 0:n.TUIConversation)?void 0:i.setMessageRead(e))},m=async e=>{var t;const n=e.filter((e=>"in"===(null==e?void 0:e.flow)&&(null==e?void 0:e.needReadReceipt)&&!l.readSet.has(null==e?void 0:e.ID)));n.length&&await(null==s?void 0:s.sendMessageReadReceipt(n).then((()=>{n.forEach((e=>l.readSet.add(null==e?void 0:e.ID)))}))),await h(null==(t=null==l?void 0:l.conversation)?void 0:t.conversationID)},_=[];Object.keys(RT("send")).forEach((e=>{_.push(e)})),nl.TUIServer=s,nl.GroupServer=null==(a=null==(o=null==s?void 0:s.TUICore)?void 0:o.TUIServer)?void 0:a.TUIGroup;const y=f(),I=f(),M=f(),T=f(),C=f();s.bind(l);const S={list:[],handleAvatar:tr,handleName:nr},D=f();Pa(D,(()=>{l.showGroupMemberList=!1}));const w=g((()=>{const{conversation:e}=l;return(null==e?void 0:e.conversationID)?(null==e?void 0:e.type)===s.TUICore.TIM.TYPES.CONV_SYSTEM?"system":"chat":""})),A=g((()=>{var e,t,n;const{conversation:i}=l;if((null==i?void 0:i.type)===s.TUICore.TIM.TYPES.CONV_GROUP){if((null==(e=null==i?void 0:i.groupProfile)?void 0:e.selfInfo.role)===s.TUICore.TIM.TYPES.GRP_MBR_ROLE_MEMBER&&(null==(t=null==i?void 0:i.groupProfile)?void 0:t.muteAllMembers))return!0;const r=(new Date).getTime();if(1e3*(null==(n=l.selfInfo)?void 0:n.muteUntil)-r>0)return!0}return!1}));k((()=>{l.isMsgNeedReadReceipt=e.isMsgNeedReadReceipt,l.needReadReceipt=l.isMsgNeedReadReceipt,l.needTyping=e.isNeedTyping,l.isNeedEmojiReact=e.isNeedEmojiReact})),v((()=>{var e;return null==(e=null==l?void 0:l.conversation)?void 0:e.conversationID}),((e,t)=>{e!==t&&(l.scroll.scrollTop=0,l.scroll.scrollHeight=0,l.scroll.scrollTopMin=1/0,l.scroll.scrollTopMax=0,l.text="",l.atText="",l.reference={message:{},content:"",type:0,show:""})}),{deep:!0}),v(A,((e,t)=>{var n,i,r;const{conversation:o}=l;if(e&&(null==o?void 0:o.type)===s.TUICore.TIM.TYPES.CONV_GROUP){(null==(n=null==o?void 0:o.groupProfile)?void 0:n.selfInfo.role)===s.TUICore.TIM.TYPES.GRP_MBR_ROLE_MEMBER&&(null==(i=null==o?void 0:o.groupProfile)?void 0:i.muteAllMembers)&&(l.muteText="管理员开启全员禁言");const e=(new Date).getTime();1e3*(null==(r=l.selfInfo)?void 0:r.muteUntil)-e>0&&(l.muteText="您已被管理员禁言")}}));const R=g((()=>{const{conversation:e}=l;return nr(e)})),L=g((()=>l.messageList.filter((e=>!e.isDeleted&&!_r(e))))),O=g((()=>{var e;return null==(e=null==L?void 0:L.value)?void 0:e.filter((e=>!e.isRevoked&&e.type===l.types.MSG_IMAGE))})),P=g((()=>{const{conversation:e,needReadReceipt:t}=l;return!((null==e?void 0:e.type)!==s.TUICore.TIM.TYPES.CONV_C2C&&!t)}));v(L,((e,t)=>{var n,i;if(N((()=>{var n,i;const r=(null==(n=e[e.length-1])?void 0:n.ID)===(null==(i=t[t.length-1])?void 0:i.ID);0===e.length||r||x()})),l.currentMessage){const t=null==(n=l.currentMessage)?void 0:n.ID,i=e.find((e=>e.ID===t));i&&(l.currentMessage=yr(i))}if(l.historyReference){for(let e=0;e<L.value.length;e++)(null==(i=null==L?void 0:L.value[e])?void 0:i.ID)===(null==l?void 0:l.referenceID)&&(G("target",M.value[e]),M.value[e].getElementsByClassName("content")[0].classList.add("reference-content"));l.historyReference=!1}}),{deep:!0}),v((()=>l.scroll.scrollTop),(e=>{setTimeout((()=>{var t;e===(null==(t=null==y?void 0:y.value)?void 0:t.scrollTop)&&(l.scroll.scrollTopMin!==1/0&&0!==l.scroll.scrollTopMax&&B("scroll"),l.scroll.scrollTopMin=1/0,l.scroll.scrollTopMax=0)}),20)}),{deep:!0}),d((()=>{v((()=>null==y?void 0:y.value),(()=>{(null==y?void 0:y.value)&&y.value.addEventListener("scroll",V)}),{deep:!0})}));const U=(e,t)=>{let n=function(e){var t;const n={referenceMessageForShow:"",referenceMessageType:0};if(!e||!(null==e?void 0:e.ID)||!(null==e?void 0:e.type))return n;switch(e.type){case Qi.TYPES.MSG_TEXT:n.referenceMessageForShow=null==(t=null==e?void 0:e.payload)?void 0:t.text,n.referenceMessageType=1;break;case Qi.TYPES.MSG_CUSTOM:n.referenceMessageForShow="[自定义消息]",n.referenceMessageType=2;break;case Qi.TYPES.MSG_IMAGE:n.referenceMessageForShow="[图片]",n.referenceMessageType=3;break;case Qi.TYPES.MSG_AUDIO:n.referenceMessageForShow="[语音]",n.referenceMessageType=4;break;case Qi.TYPES.MSG_VIDEO:n.referenceMessageForShow="[视频]",n.referenceMessageType=5;break;case Qi.TYPES.MSG_FILE:n.referenceMessageForShow="[文件]",n.referenceMessageType=6;break;case Qi.TYPES.MSG_FACE:n.referenceMessageForShow="[表情]",n.referenceMessageType=8}return n}(e);l.reference={message:e,content:null==n?void 0:n.referenceMessageForShow,type:null==n?void 0:n.referenceMessageType,show:t}},x=()=>{var e;if(l.isFirstRender)return l.needToBottom=!1,G("bottom"),void(l.isFirstRender=!1);if(y.value){const{scrollHeight:t,scrollTop:n,clientHeight:i}=y.value;t-(n+i)<=i||"out"===(null==(e=L.value[L.value.length-1])?void 0:e.flow)?G("bottom"):q(!0)}},G=(e,t)=>{var n;switch(null==(n=null==y?void 0:y.value)||n.removeEventListener("scroll",V),l.isUserAction=!0,e){case er.scrollType.toBottom:l.needToBottom=!1,N((()=>{var e,t,n;(null==(e=null==l?void 0:l.env)?void 0:e.isH5)?F():null==(n=null==(t=null==y?void 0:y.value)?void 0:t.lastElementChild)||n.scrollIntoView(!1),gr(null==y?void 0:y.value,"message-img",(async()=>{var e,t,n;(null==(e=null==l?void 0:l.env)?void 0:e.isH5)?F():null==(n=null==(t=null==y?void 0:y.value)?void 0:t.lastElementChild)||n.scrollIntoView(!1),y.value.addEventListener("scroll",V),await B("page")}))}));break;case er.scrollType.toTarget:N((()=>{null==t||t.scrollIntoView(!1),gr(null==y?void 0:y.value,"message-img",(async()=>{null==t||t.scrollIntoView(!1),y.value.addEventListener("scroll",V),await B("page")}))}))}},F=()=>{var e;(null==(e=null==document?void 0:document.getElementById("app"))?void 0:e.style)&&(document.getElementById("app").style.marginBottom="",document.getElementById("app").style.height="100%"),y.value.scrollTop=y.value.scrollHeight},V=()=>{const{scrollHeight:e,scrollTop:t,clientHeight:n}=y.value;P.value&&(l.scroll.scrollHeight=e,l.scroll.scrollTop=t,l.scroll.scrollTopMin=l.isUserAction?l.scroll.scrollTopMin:Math.min(l.scroll.scrollTopMin,l.scroll.scrollTop),l.scroll.scrollTopMax=l.isUserAction?l.scroll.scrollTopMax:Math.max(l.scroll.scrollTopMax,l.scroll.scrollTop)),q(e-(t+n)>n),l.isUserAction=!1},q=e=>{var t,n,i;if(!0===e)l.needToBottom=!0,(null==(t=null==l?void 0:l.conversation)?void 0:t.unreadCount)&&(null==(n=null==l?void 0:l.conversation)?void 0:n.unreadCount)>0?l.toBottomTipCont=`${null==(i=null==l?void 0:l.conversation)?void 0:i.unreadCount} ${u("TUIChat.条新消息")}`:l.toBottomTipCont=u("TUIChat.回到最新位置");else l.needToBottom=!1},B=async e=>{var t,n,i,r;if(!P.value)return void h(null==(t=null==l?void 0:l.conversation)?void 0:t.conversationID);l.messageInView.length&&(l.messageInView=[]);let o=0,a=0;switch(e){case er.inViewType.page:o=l.scroll.scrollTop,a=l.scroll.scrollTop+(null==(n=null==y?void 0:y.value)?void 0:n.clientHeight);break;case er.inViewType.scroll:o=l.scroll.scrollTopMin,a=l.scroll.scrollTopMax+(null==(i=null==y?void 0:y.value)?void 0:i.clientHeight)}for(let s=0;s<(null==(r=null==M?void 0:M.value)?void 0:r.length);s++)if(H(e,null==M?void 0:M.value[s],o,a)){const e=L.value[s];l.messageInView.push(e)}await m(l.messageInView)},H=(e,t,n,i)=>{const r=y.value.getBoundingClientRect().top,o=y.value.getBoundingClientRect().bottom,{top:a,bottom:s}=t.getBoundingClientRect(),{offsetTop:c,clientHeight:u}=t;switch(e){case er.inViewType.page:return Math.round(a)>=Math.round(r)&&Math.round(s)<=Math.round(o);case er.inViewType.scroll:return Math.round(c)>=Math.round(n)&&Math.round(c+u)<=Math.round(i);default:return!1}};return{...b(l),conversationType:w,messages:L,messageEle:y,inputEle:I,messageInput:C,messageAimID:M,conversationData:S,conversationName:R,constant:er,reportMessageSend:async e=>{l.isFirstSend&&(Mo.getInstance().reportEvent({name:"sendMessage",ext1:"sendMessage-success"}),l.isFirstSend=!1),l.reference.show="",s.TUICore.isOfficial&&(null==c?void 0:c.commit)&&(null==c||c.commit("handleTask",0))},handleTyping:(e,t)=>{var n;null==(n=null==l?void 0:l.typingRef)||n.onTyping(e,t)},handleItem:e=>{l.currentMessage=e,l.dialogID=e.ID},handleEdit:e=>{var t,n,i;(null==(t=null==e?void 0:e.payload)?void 0:t.text)&&(null==(i=null==C?void 0:C.value)||i.reEdit(null==(n=null==e?void 0:e.payload)?void 0:n.text))},handleEditor:(e,t)=>{var n,i,r;if(e&&t)switch(t){case"reference":case"reply":U(e,t);break;case"reedit":(null==(n=null==e?void 0:e.payload)?void 0:n.text)&&(null==(r=null==C?void 0:C.value)||r.reEdit(null==(i=null==e?void 0:e.payload)?void 0:i.text))}},getHistoryMessageList:async()=>{await s.getHistoryMessageList().then((()=>{var e;G("target",null==(e=null==y?void 0:y.value)?void 0:e.firstElementChild)}))},handleApplication:e=>{s.handleGroupApplication(e)},pluginComponentList:_,handleSend:e=>{var t;null==(t=null==C?void 0:C.value)||t.addEmoji(e)},closeDialog:async e=>{if(e)switch(e){case"receipt":l.currentMessage={},l.receiptDialogStatus=!1;break;case"replies":l.currentMessage={},l.repliesDialogStatus=!1}},isMute:A,pasting:e=>{e.clipboardData.files[0]&&s.sendImageMessage(e.clipboardData.files[0])},setMessageRead:h,sendMessageReadReceipt:m,dialog:D,jumpID:e=>{var t,n;l.referenceID=e;const i=[];for(let r=0;r<L.value.length;r++)i.push(null==(t=null==L?void 0:L.value[r])?void 0:t.ID),-1!==i.indexOf(e)&&(null==(n=L.value[r])?void 0:n.ID)===e&&(G("target",M.value[r]),M.value[r].getElementsByClassName("content")[0].classList.remove("reference-content"),N((()=>{M.value[r].getElementsByClassName("content")[0].classList.add("reference-content")})));-1===i.indexOf(e)&&s.getHistoryMessageList().then((()=>{l.historyReference=!0}))},back:()=>{s.TUICore.TUIServer.TUIConversation.handleCurrentConversation()},slotDefault:p,toggleshowGroupMemberList:()=>{l.showGroupMemberList=!l.showGroupMemberList},resendMessage:e=>{l.env.isH5?(l.showResend=!0,l.resendMessage=e):(s.resendMessage(e).catch((e=>{ns(e,l.env)})),Mo.getInstance().reportEvent({name:"messageOptions",ext1:"messageResend"}))},submit:()=>{s.resendMessage(l.resendMessage).then((()=>{l.showResend=!1})).catch((e=>{ns(e,l.env),l.showResend=!1})),Mo.getInstance().reportEvent({name:"messageOptions",ext1:"messageResend"})},Link:il,openLink:e=>{window.open(e.url),Mo.getInstance().reportEvent({name:"openLink",ext1:e.label})},readReceiptDialog:T,scrollToTarget:G,needGroupReceipt:P,handleDropDownOpen:e=>{l.dropDownRef&&l.dropDownRef.removeChild(l.dropDownRef.children[0]),l.dropDownRef=e},isMessageTip:Ir,showDialog:async(e,t)=>{var n;if((null==e?void 0:e.ID)&&t)switch(t){case"receipt":if(e.conversationType!==s.TUICore.TIM.TYPES.CONV_GROUP||0===(null==(n=e.readReceiptInfo)?void 0:n.unreadCount))return;l.currentMessage=e,l.receiptDialogStatus=!0;break;case"replies":l.currentMessage=e,l.repliesDialogStatus=!0;break;case"forward":l.currentMessage=e,S.list=s.TUICore.getStore().TUIConversation.conversationList,l.forwardStatus=!0;break;case"previewImage":l.showImagePreview=!l.showImagePreview,l.currentImagePreview=e}},forwardMessage:e=>{l.currentMessage=e,S.list=s.TUICore.getStore().TUIConversation.conversationList,l.forwardStatus=!0},referOrReplyMessage:U,handleUploadingImageOrVideo:()=>{G("bottom")},handleImagePreview:e=>{l.showImagePreview=!l.showImagePreview,l.currentImagePreview=e},imageList:O,resetReplyOrReference:()=>{l.reference={message:{},content:"",type:0,show:""}}}}}),pI=e=>(F("data-v-22442866"),e=e(),V(),e),hI={class:"TUIChat-header"},fI={class:"setting"},gI={class:"TUIChat-main"},mI={class:"TUIChat-safe-tips"},vI=["id"],_I=pI((()=>P("i",{class:"icon icon-bottom-double"},null,-1))),yI={class:"to-bottom-tip-cont"},II={key:0,class:"dialog dialog-conversation"},MI=["src"],TI={class:"name"},CI=["src"],SI={key:0,class:"name"},EI={class:"dialog dialog-conversation"},kI={class:"func",id:"func"},bI={class:"func-main"},DI={class:"mask-main"},wI=pI((()=>P("i",null,null,-1))),AI={key:1,class:"TUIChat"},RI={class:"TUIChat-header"};const LI=D(dI,[["render",function(e,t,n,i,r,o){var a;const s=J("TypingHeader"),c=J("Manage"),u=J("Replies"),l=J("MessageTimestamp"),d=J("MessageItem"),p=J("ReadReceiptDialog"),h=J("imagePreviewer"),f=J("MessageInput"),g=J("MessageSystem");return"chat"===e.conversationType?(w(),A("div",{key:0,class:G(["TUIChat",[e.env.isH5?"TUIChat-H5":""]])},[P("header",hI,[e.env.isH5?(w(),A("i",{key:0,class:"icon icon-back",onClick:t[0]||(t[0]=(...t)=>e.back&&e.back(...t))})):O("",!0),M(s,{needTyping:e.needTyping,conversation:e.conversation,messageList:e.messageList,ref:"typingRef"},null,8,["needTyping","conversation","messageList"]),P("aside",fI,[e.conversation.groupProfile?(w(),j(c,{key:0,conversation:e.conversation,userInfo:e.userInfo,isH5:e.env.isH5},null,8,["conversation","userInfo","isH5"])):O("",!0),M(u,{message:e.currentMessage,conversation:e.conversation,show:e.repliesDialogStatus,isH5:e.env.isH5,messageList:e.messageList,onCloseDialog:e.closeDialog,ref:"repliesDialog"},null,8,["message","conversation","show","isH5","messageList","onCloseDialog"])])]),P("div",gI,[P("div",mI,[P("span",null,L(e.$t("TUIChat.安全提示")),1),P("a",{onClick:t[1]||(t[1]=t=>e.openLink(e.Link.complaint))},L(e.$t("TUIChat.点此投诉")),1)]),P("ul",{class:"TUI-message-list",onClick:t[4]||(t[4]=t=>e.dialogID=""),ref:"messageEle",id:"messageEle"},[e.isCompleted?O("",!0):(w(),A("p",{key:0,class:"message-more",onClick:t[2]||(t[2]=(...t)=>e.getHistoryMessageList&&e.getHistoryMessageList(...t))},L(e.$t("TUIChat.查看更多")),1)),(w(!0),A(_,null,R(e.messages,((t,n)=>{var i;return w(),A("li",{key:n,id:null==t?void 0:t.ID,ref_for:!0,ref:"messageAimID"},[M(l,{currTime:null==t?void 0:t.time,prevTime:n>0?null==(i=e.messages[n-1])?void 0:i.time:0},null,8,["currTime","prevTime"]),M(d,{message:t,env:e.env,types:e.types,displayGroupMessageReadReceipt:e.needGroupReceipt,displayEmojiReactions:e.isNeedEmojiReact,messageList:e.messages,onHandleEditor:e.handleEditor,onShowDialog:e.showDialog,onUploading:e.handleUploadingImageOrVideo,onJumpID:e.jumpID,onResendMessage:e.resendMessage},null,8,["message","env","types","displayGroupMessageReadReceipt","displayEmojiReactions","messageList","onHandleEditor","onShowDialog","onUploading","onJumpID","onResendMessage"])],8,vI)})),128)),e.needToBottom?(w(),A("div",{key:1,class:"to-bottom-tip",onClick:t[3]||(t[3]=t=>e.scrollToTarget("bottom"))},[_I,P("div",yI,[P("span",null,L(e.toBottomTipCont),1)])])):O("",!0)],512),e.forwardStatus&&e.messageComponents.Forward?(w(),A("div",II,[(w(),j(se("Forward"),{list:e.conversationData.list,message:e.currentMessage,show:e.forwardStatus,isH5:e.env.isH5,"onUpdate:show":t[5]||(t[5]=t=>e.forwardStatus=t)},{left:K((({data:t})=>[P("img",{class:"avatar",src:e.conversationData.handleAvatar(t)},null,8,MI),P("label",TI,L(e.conversationData.handleName(t)),1)])),right:K((({data:t})=>[P("img",{class:"avatar",src:e.conversationData.handleAvatar(t)},null,8,CI),e.env.isH5?O("",!0):(w(),A("label",SI,L(e.conversationData.handleName(t)),1))])),_:1},40,["list","message","show","isH5"]))])):O("",!0),P("div",EI,[M(p,{message:e.currentMessage,conversation:e.conversation,show:e.receiptDialogStatus,isH5:e.env.isH5,onCloseDialog:e.closeDialog,ref:"readReceiptDialog"},null,8,["message","conversation","show","isH5","onCloseDialog"])]),e.showImagePreview?(w(),j(h,{key:1,currentImage:e.currentImagePreview,imageList:e.imageList,onClose:t[6]||(t[6]=t=>e.showImagePreview=!1)},null,8,["currentImage","imageList"])):O("",!0)]),P("div",{class:G(["TUIChat-footer",[e.isMute&&"disabled",e.env.isH5&&"TUIChat-H5-footer"]])},[P("div",kI,[P("main",bI,[(w(!0),A(_,null,R(e.pluginComponentList,((t,n)=>(w(),j(se(t),{key:n,isMute:e.isMute,isH5:e.env.isH5,conversation:e.conversation,parentID:"func",onSend:e.handleSend},null,40,["isMute","isH5","conversation","onSend"])))),128))])]),M(f,{ref:"messageInput",conversation:e.conversation,memberList:e.allMemberList,env:e.env,isGroup:null==(a=e.userInfo)?void 0:a.isGroup,replyOrReference:e.reference,isMute:e.isMute,muteText:e.muteText,placeholder:e.$t("TUIChat.请输入消息"),onSendMessage:e.reportMessageSend,onResetReplyOrReference:e.resetReplyOrReference,onOnTyping:e.handleTyping},null,8,["conversation","memberList","env","isGroup","replyOrReference","isMute","muteText","placeholder","onSendMessage","onResetReplyOrReference","onOnTyping"])],2),z(P("div",{class:"mask",onClick:t[9]||(t[9]=t=>e.showResend=!1)},[P("div",DI,[P("header",null,L(e.$t("TUIChat.确认重发该消息？")),1),P("footer",null,[P("p",{onClick:t[7]||(t[7]=t=>e.showResend=!1)},L(e.$t("TUIChat.取消")),1),wI,P("p",{onClick:t[8]||(t[8]=(...t)=>e.submit&&e.submit(...t))},L(e.$t("TUIChat.确定")),1)])])],512),[[W,e.showResend]])],2)):"system"===e.conversationType?(w(),A("div",AI,[P("header",RI,[P("h1",null,L(e.conversationName),1)]),M(g,{data:e.messages,types:e.types,onApplication:e.handleApplication},null,8,["data","types","onApplication"])])):e.slotDefault?X(e.$slots,"default",{key:2},void 0,!0):O("",!0)}],["__scopeId","data-v-22442866"]]),OI=S({props:{show:{type:Boolean,default:()=>!1},isMute:{type:Boolean,default:()=>!1},isH5:{type:Boolean,default:()=>!1},parentID:{type:String,default:()=>""}},setup(e,t){var n;const i=E({emojiUrl:Yi,emojiMap:$i,emojiName:Ji,faceUrl:"https://web.sdk.qcloud.com/im/assets/face-elem/",bigEmojiList:(null==(n=null==window?void 0:window.TUIKitTUICore)?void 0:n.isOfficial)&&Xi||[],show:!1,currentIndex:0,isMute:!1,transDom:!1}),r=f();k((()=>{i.show=e.show,i.isMute=e.isMute}));const o=()=>{const e=document.getElementsByClassName("face-main")[0];i.isMute||(e.style.display="none"===e.style.display?"flex":"none"),"none"===e.style.display&&c(0),a()},a=()=>{const t=document.getElementById(e.parentID),n=document.getElementsByClassName("face-H5-main")[0];e.isH5&&(null==t||t.appendChild(n))};Pa(r,(()=>{const e=document.getElementsByClassName("face-main")[0];e&&(e.style.display="none")}));const s=g((()=>{const e=[i.emojiName];for(let t=0;t<i.bigEmojiList.length;t++)e.push(i.bigEmojiList[t].list);return e})),c=e=>{i.currentIndex=e};return{...b(i),toggleShow:o,select:async(n,r)=>{const a={name:n};if(0===i.currentIndex)return a.type="emo",a.url=Yi+$i[n],a.template=`<img src="${Yi+$i[n]}">`,e.isH5||o(),t.emit("send",a);try{await OI.TUIServer.sendFaceMessage({index:i.bigEmojiList[i.currentIndex-1].icon,data:i.bigEmojiList[i.currentIndex-1].list[r]}),Mo.getInstance().reportEvent({name:"messageType",ext1:"typeFace"})}catch(s){ns(s,e)}e.isH5||o()},selectFace:c,list:s,dialog:r}}}),NI={class:"face",id:"face"},PI=["onClick"],UI=["src"],xI=["src"],GI={class:"face-tab"},FI=[(e=>(F("data-v-d700f74b"),e=e(),V(),e))((()=>P("i",{class:"icon icon-face"},null,-1)))],VI=["onClick"],qI=["src"];const BI=D(OI,[["render",function(e,t,n,i,r,o){return w(),A("div",NI,[P("i",{class:"icon icon-face",title:"表情",onClick:t[0]||(t[0]=(...t)=>e.toggleShow&&e.toggleShow(...t))}),z(P("main",{class:G(["face-main",[e.isH5&&"face-H5-main"]]),ref:"dialog"},[(w(!0),A(_,null,R(e.list,((t,n)=>z((w(),A("ul",{class:"face-list",key:n},[(w(!0),A(_,null,R(t,((t,i)=>(w(),A("li",{class:"face-list-item",key:i,onClick:n=>e.select(t,i)},[0===n?(w(),A("img",{key:0,src:e.emojiUrl+e.emojiMap[t]},null,8,UI)):(w(),A("img",{key:1,class:"face-img",src:e.faceUrl+t+"@2x.png"},null,8,xI))],8,PI)))),128))])),[[W,e.currentIndex===n]]))),128)),P("ul",GI,[P("li",{class:"face-tab-item",onClick:t[1]||(t[1]=t=>e.selectFace(0))},FI),(w(!0),A(_,null,R(e.bigEmojiList,((t,n)=>(w(),A("li",{class:"face-tab-item",key:n,onClick:t=>e.selectFace(n+1)},[P("img",{src:e.faceUrl+t.list[0]+"@2x.png"},null,8,qI)],8,VI)))),128))])],2),[[W,e.show]])])}],["__scopeId","data-v-d700f74b"]]),HI=S({props:{show:{type:Boolean,default:()=>!1},isMute:{type:Boolean,default:()=>!1},isH5:{type:Boolean,default:()=>!1}},setup(e,t){const n=E({isMute:!1});k((()=>{n.isMute=e.isMute}));return{...b(n),sendUploadMessage:async t=>{if(t.target.files.length>0)try{await HI.TUIServer.sendImageMessage(t.target),Mo.getInstance().reportEvent({name:"messageType",ext1:"typeImage"})}catch(n){ns(n,e)}t.target.value=""}}}}),jI={class:"upload-btn icon icon-image"};const KI=D(HI,[["render",function(e,t,n,i,r,o){return w(),A("span",jI,[e.isMute?O("",!0):(w(),A("input",{key:0,title:"图片",type:"file","data-type":"image",accept:"image/*",onChange:t[0]||(t[0]=(...t)=>e.sendUploadMessage&&e.sendUploadMessage(...t))},null,32)),X(e.$slots,"default",{},void 0,!0)])}],["__scopeId","data-v-b48bdf1d"]]),zI=S({props:{show:{type:Boolean,default:()=>!1},isMute:{type:Boolean,default:()=>!1},isH5:{type:Boolean,default:()=>!1}},setup(e,t){const n=E({isMute:!1});k((()=>{n.isMute=e.isMute}));return{...b(n),sendUploadMessage:async t=>{if(t.target.files.length>0)try{await zI.TUIServer.sendVideoMessage(t.target),Mo.getInstance().reportEvent({name:"messageType",ext1:"typeVideo"})}catch(n){ns(n,e)}t.target.value=""}}}}),WI={class:"upload-btn icon icon-video"};const YI=D(zI,[["render",function(e,t,n,i,r,o){return w(),A("span",WI,[e.isMute?O("",!0):(w(),A("input",{key:0,title:"视频",type:"file","data-type":"video",accept:"video/*",onChange:t[0]||(t[0]=(...t)=>e.sendUploadMessage&&e.sendUploadMessage(...t))},null,32)),X(e.$slots,"default",{},void 0,!0)])}],["__scopeId","data-v-6a9064d8"]]),$I=S({props:{show:{type:Boolean,default:()=>!1},isMute:{type:Boolean,default:()=>!1},isH5:{type:Boolean,default:()=>!1}},setup(e,t){const n=E({isMute:!1});k((()=>{n.isMute=e.isMute}));return{...b(n),sendUploadMessage:async t=>{if(t.target.files.length>0)try{await $I.TUIServer.sendFileMessage(t.target),Mo.getInstance().reportEvent({name:"messageType",ext1:"typeFile"})}catch(n){ns(n,e)}t.target.value=""}}}}),JI={class:"upload-btn icon icon-files"};const XI=D($I,[["render",function(e,t,n,i,r,o){return w(),A("span",JI,[e.isMute?O("",!0):(w(),A("input",{key:0,title:"文件",type:"file","data-type":"file",accept:"*",onChange:t[0]||(t[0]=(...t)=>e.sendUploadMessage&&e.sendUploadMessage(...t))},null,32)),X(e.$slots,"default",{},void 0,!0)])}],["__scopeId","data-v-0872deec"]]),ZI=S({components:{Transfer:xc},name:"转发",props:{list:{type:Array,default:()=>[]},message:{type:Object,default:()=>({})},show:{type:Boolean,default:()=>!1},isH5:{type:Boolean,default:()=>!1}},setup(e,t){const n=E({list:[],show:!1,to:-1}),i=f();k((()=>{n.list=e.list,n.show=e.show}));const r=()=>{n.show=!n.show,n.show||(t.emit("update:show",n.show),n.to=-1)};Pa(i,(()=>{n.show=!1,t.emit("update:show",n.show),n.to=-1}));return{...b(n),toggleShow:r,handleForWordMessage:async t=>{t.map((async t=>{try{await ZI.TUIServer.forwardMessage(e.message,t)}catch(n){ns(n,e)}})),r()},dialog:i}}});const QI=D(ZI,[["render",function(e,t,n,i,r,o){const a=J("Transfer");return w(),A("div",null,[e.show?(w(),A("div",{key:0,class:G(["forward",[e.isH5?"forward-h5":""]]),ref:"dialog"},[M(a,{title:"转发",list:e.list,isSearch:!1,isH5:e.isH5,isCustomItem:!0,resultShow:!0,onSubmit:e.handleForWordMessage,onCancel:e.toggleShow},{left:K((({data:t})=>[X(e.$slots,"left",{data:t},void 0,!0)])),right:K((({data:t})=>[X(e.$slots,"right",{data:t},void 0,!0)])),_:3},8,["list","isH5","onSubmit","onCancel"])],2)):O("",!0)])}],["__scopeId","data-v-dbbafe8f"]]),eM=S({type:"custom",props:{show:{type:Boolean,default:()=>!1},isMute:{type:Boolean,default:()=>!1},isH5:{type:Boolean,default:()=>!1}},setup(e,t){const{t:n}=window.TUIKitTUICore.config.i18n.useI18n(),i=[{value:"在吗？在吗？在吗？重要的话说三遍。"},{value:"好久没聊天了，快来和我说说话～"},{value:"好的，就这么说定了。"},{value:"感恩的心，感谢有你。"},{value:"糟糕！是心动的感觉！"},{value:"心疼地抱抱自己，我太难了！"},{value:"没关系，别在意，事情过去就过去了。"},{value:"早上好，今天也是让人期待的一天呢！"},{value:"熬夜有什么用，又没人陪你聊天，早点休息吧。"}],r=E({list:[],show:!1,isMute:!1,locale:Ki.getInstance().i18n.global.locale}),o=f();v((()=>r.locale),((e,t)=>{r.list=i.map((e=>({value:n(`Words.${e.value}`)})))})),k((()=>{r.show=e.show,r.isMute=e.isMute}));const a=()=>{r.show=!r.show,r.show&&(r.list=i.map((e=>({value:n(`Words.${e.value}`)}))))};Pa(o,(()=>{r.show=!1}));return{...b(r),toggleShow:a,select:(e,t)=>{const n=e.value;a(),eM.TUIServer.sendTextMessage(n)},dialog:o}}}),tM={class:"words-main-content",ref:"dialog"},nM={class:"words-list"},iM=["onClick"];const rM=D(eM,[["render",function(e,t,n,i,r,o){return w(),A("div",{class:G(["words",[e.isH5?"words-H5":""]])},[P("i",{class:"icon icon-words",title:"快速回复",onClick:t[0]||(t[0]=(...t)=>e.toggleShow&&e.toggleShow(...t))}),z(P("main",{class:G(["words-main",[e.isH5?"words-H5-main":""]])},[P("div",tM,[P("header",null,[P("aside",null,[P("h1",null,L(e.$t("Words.常用语-快捷回复工具")),1)]),e.isH5?(w(),A("span",{key:0,class:"close",onClick:t[1]||(t[1]=(...t)=>e.toggleShow&&e.toggleShow(...t))},"关闭")):O("",!0)]),P("ul",nM,[(w(!0),A(_,null,R(e.list,((t,n)=>(w(),A("li",{class:"words-list-item",key:n,onClick:n=>e.select(t)},[P("label",null,L(t.value),1)],8,iM)))),128))])],512)],2),[[W,e.show&&!e.isMute]])],2)}],["__scopeId","data-v-ae70d08c"]]),oM=S({type:"custom",props:{show:{type:Boolean,default:()=>!1},isMute:{type:Boolean,default:()=>!1},isH5:{type:Boolean,default:()=>!1}},setup(e,t){const n=E({link:"https://web.sdk.qcloud.com/im/doc/zh-cn//SDK.html#createCustomMessage",list:5,show:!1,isMute:!1,options:{data:{businessID:er.typeEvaluate,version:1,score:"",comment:""},description:"对本次的服务评价",extension:"对本次的服务评价"},num:0}),i=f();Pa(i,(()=>{n.show=!1})),k((()=>{n.show=e.show,n.isMute=e.isMute}));const r=()=>{var e,t,i;n.show=!n.show,n.show&&(n.options={data:{...(e=er.typeEvaluate,t=1,i={score:"",comment:""},{businessID:e,version:t,...i})},description:"对本次的服务评价",extension:"对本次的服务评价"},n.num=0)};return{...b(n),toggleShow:r,select:(e,t)=>{n.num=t+1,n.options.data.score=`${n.num}`},submit:()=>{oM.TUIServer.sendCustomMessage(n.options),Mo.getInstance().reportEvent({name:"messageType",ext1:"typeCustom"}),r()},dialog:i,Link:il,openLink:e=>{window.open(e.url),Mo.getInstance().reportEvent({name:"openLink",ext1:e.label})}}}}),aM={key:0,class:"evaluate-main"},sM={class:"evaluate-main-content",ref:"dialog"},cM={key:0},uM={class:"evaluate-content"},lM={class:"evaluate-list"},dM=["onClick"],pM={key:0,class:"icon icon-star-light"},hM={key:1,class:"icon icon-star"},fM={class:"evaluate-main-footer"},gM={key:0};const mM=D(oM,[["render",function(e,t,n,i,r,o){return w(),A("div",{class:G(["evaluate",[e.isH5&&"evaluate-H5"]])},[P("i",{class:"icon icon-evaluate",title:"服务评价",onClick:t[0]||(t[0]=x(((...t)=>e.toggleShow&&e.toggleShow(...t)),["stop"]))}),e.show&&!e.isMute?(w(),A("main",aM,[P("div",sM,[P("header",null,[P("aside",null,[P("h1",null,L(e.$t("Evaluate.请对本次服务进行评价")),1),e.isH5?(w(),A("p",cM,[oe(L(e.$t("Evaluate.服务评价工具"))+"（"+L(e.$t("Evaluate.使用")),1),P("a",{onClick:t[1]||(t[1]=t=>e.openLink(e.Link.customMessage))},L(e.$t(`Evaluate.${e.Link.customMessage.label}`)),1),oe(L(e.$t("Evaluate.搭建"))+"） ",1)])):O("",!0)]),e.isH5?(w(),A("span",{key:0,class:"close",onClick:t[2]||(t[2]=x(((...t)=>e.toggleShow&&e.toggleShow(...t)),["stop"]))},"关闭")):O("",!0)]),P("div",uM,[P("ul",lM,[(w(!0),A(_,null,R(e.list,((t,n)=>(w(),A("li",{class:G(["evaluate-list-item",[n<e.num&&"small-padding",e.isH5&&"evaluate-item"]]),key:n,onClick:x((i=>e.select(t,n)),["stop"])},[n<e.num?(w(),A("i",pM)):(w(),A("i",hM))],10,dM)))),128))]),z(P("textarea",{"onUpdate:modelValue":t[3]||(t[3]=t=>e.options.data.comment=t)},null,512),[[ee,e.options.data.comment]]),P("div",fM,[P("button",{class:"btn",onClick:t[4]||(t[4]=(...t)=>e.submit&&e.submit(...t))},L(e.$t("Evaluate.提交评价")),1)])]),e.isH5?O("",!0):(w(),A("footer",gM,[oe(L(e.$t("Evaluate.服务评价工具"))+"（"+L(e.$t("Evaluate.使用")),1),P("a",{onClick:t[5]||(t[5]=t=>e.openLink(e.Link.customMessage))},L(e.$t(`Evaluate.${e.Link.customMessage.label}`)),1),oe(L(e.$t("Evaluate.搭建"))+"） ",1)]))],512)])):O("",!0)],2)}],["__scopeId","data-v-7a3aa1c4"]]),vM=S({props:{needTyping:{type:Boolean,default:!1},conversation:{type:Object,default:()=>({})},messageList:{type:Array,default:()=>[]}},setup(e,t){const n=E({messageList:[],conversation:{},title:"",timeValid:0,myTypingStatus:0,otherTypingStatus:0,needTyping:!1,lastOtherMessageTime:0,lastMyTypingTime:0,lastOtherTypingTime:0,options:{data:{businessID:er.typeUserTyping,typingStatus:0,version:1,userAction:0,actionParam:er.typeInputStatusEnd},description:"",extension:""}});k((()=>{n.messageList=e.messageList,n.conversation=e.conversation,n.needTyping=e.needTyping}));const i=g((()=>{const{conversation:e}=n;return(null==e?void 0:e.conversationID)?e.conversationID:""})),r=g((()=>{const{conversation:e}=n;return nr(e)})),o=g((()=>{const{conversation:e}=n;return(null==e?void 0:e.type)?null==e?void 0:e.type:""})),a=g((()=>n.needTyping&&n.otherTypingStatus?"对方正在输入":null==r?void 0:r.value));v(i,((e,t)=>{e!==t&&(n.needTyping=!1,n.timeValid=0)})),v((()=>n.needTyping),((e,t)=>{e||(n.myTypingStatus=0,n.otherTypingStatus=0,n.lastOtherMessageTime=0)})),v((()=>n.messageList),((e,t)=>{N((()=>{var t,i;0!==e.length&&"C2C"===o.value&&(n.lastOtherMessageTime=u(e),"in"===(null==(t=e[e.length-1])?void 0:t.flow)&&(_r(e[e.length-1])?(n.otherTypingStatus=s(e[e.length-1]),d()):(n.lastOtherMessageTime=null==(i=e[e.length-1])?void 0:i.time,n.otherTypingStatus=0)))}))}),{deep:!0});const s=e=>{var t;try{const{typingStatus:n,actionParam:i}=vr(null==(t=null==e?void 0:e.payload)?void 0:t.data);return 1===n&&i===er.typeInputStatusIng?1:0}catch{return 0}},c=e=>{n.options={data:{businessID:er.typeUserTyping,typingStatus:e?1:0,version:1,userAction:e?14:0,actionParam:e?er.typeInputStatusIng:er.typeInputStatusEnd},description:"",extension:""},vM.TUIServer.sendTypingMessage(n.options),Mo.getInstance().reportEvent({name:"messageType",ext1:"typeCustom"})},u=e=>{if(!e)return 0;for(let t=e.length-1;t>=0;t--)if(!_r(e[t])&&"in"===e[t].flow)return e[t].time;return 0},l=(e,t=2e3)=>{let n;return function(){n&&clearTimeout(n),n=setTimeout(e,t)}},d=l((()=>{n.otherTypingStatus=0}),5e3);return{...b(n),conversationID:i,conversationName:r,conversationType:o,title:a,isTypingMessage:_r,sendTypingMessage:c,handleTypingMessageStatus:s,getLastOtherMessageTime:u,debounce:l,waitTypingEnd:d,onTyping:(e,t)=>{if(n.needTyping&&"C2C"===o.value&&((new Date).getTime()/1e3-n.lastOtherMessageTime<30&&(n.timeValid=1),n.timeValid))if(e||t)n.myTypingStatus=0,n.lastMyTypingTime=0,c(n.myTypingStatus);else{n.myTypingStatus=1;const e=(new Date).getTime();e-n.lastMyTypingTime>4e3&&(n.lastMyTypingTime=e,c(n.myTypingStatus))}}}}});const _M=D(vM,[["render",function(e,t,n,i,r,o){return w(),A("h1",null,L("对方正在输入"===e.title?e.$t("TUIChat.对方正在输入"):e.title),1)}],["__scopeId","data-v-9ca7abad"]]),yM=S({type:"custom",props:{message:{type:Object,default:()=>({})},isH5:{type:Boolean,default:!1},show:{type:Boolean,default:()=>!1}},setup(e,t){const{t:n}=window.TUIKitTUICore.config.i18n.useI18n(),i=E({message:{},isGroup:!1,show:!1,isH5:!1,messageInfo:{isImg:!1,content:""},readReceiptList:[{label:e.isH5?n("TUIChat.人已读"):n("TUIChat.已读"),count:0,userList:[],isCompleted:!0,cursor:"",show:!0},{label:e.isH5?n("TUIChat.人未读"):n("TUIChat.未读"),count:0,userList:[],isCompleted:!0,cursor:"",show:!0},{label:e.isH5?n("TUIChat.人关闭阅读状态"):n("TUIChat.关闭阅读状态"),count:0,userList:[],isCompleted:!0,cursor:"",show:!1}],showListNow:0,isMenuOpen:!0,env:zi()}),r=f();k((()=>{i.show=e.show,i.isH5=e.isH5})),v((()=>{e.message,i.show}),(async()=>{var t,n,r,s;i.show&&(d(),i.message=e.message,c(),l(),i.readReceiptList[0].count=(null==(n=null==(t=i.message)?void 0:t.readReceiptInfo)?void 0:n.readCount)||i.readReceiptList[0].count,i.readReceiptList[1].count=(null==(s=null==(r=i.message)?void 0:r.readReceiptInfo)?void 0:s.unreadCount)||i.readReceiptList[1].count,o(),a())}),{deep:!0});Pa(r,(()=>{i.show=!1,t.emit("closeDialog","receipt"),u()}));const o=async(e=!1)=>{var t,r;if(i.isGroup&&i.message&&0!==Object.keys(i.message).length)try{const n=await yM.TUIServer.getGroupReadMemberList(i.message,e?i.readReceiptList[0].cursor:"");i.readReceiptList[0].isCompleted=null==(t=null==n?void 0:n.data)?void 0:t.isCompleted,i.readReceiptList[0].cursor=(null==(r=null==n?void 0:n.data)?void 0:r.cursor)||"";const o=n.data.readUserIDList,a=await s(o);i.readReceiptList[0].userList=e?[...i.readReceiptList[0].userList,...a]:a}catch(o){if(o&&10062===(null==o?void 0:o.code)){ns(n("TUIChat.您当前购买使用的套餐包暂未开通群消息已读回执功能"),i.env)}}},a=async(e=!1)=>{var t;if(!i.isGroup||!i.message||0===Object.keys(i.message).length)return;const n=await yM.TUIServer.getGroupUnreadMemberList(i.message,e?i.readReceiptList[1].cursor:"");i.readReceiptList[1].isCompleted=null==n?void 0:n.data.isCompleted,i.readReceiptList[1].cursor=(null==(t=null==n?void 0:n.data)?void 0:t.cursor)||"";const r=n.data.unreadUserIDList,o=await s(r);i.readReceiptList[1].userList=e?[...i.readReceiptList[1].userList,...o]:o},s=async e=>{const t=[];if(e.length&&i.isGroup){(await yM.TUIServer.getUserProfile(e)).data.forEach((e=>{t.push({nick:null==e?void 0:e.nick,avatar:null==e?void 0:e.avatar,userID:null==e?void 0:e.userID})}))}return t},c=()=>{var e;(null==(e=i.message)?void 0:e.conversationType)===yM.TUIServer.TUICore.TIM.TYPES.CONV_GROUP?i.isGroup=!0:i.isGroup=!1},u=()=>{i.message={},i.readReceiptList=[{label:e.isH5?n("TUIChat.人已读"):n("TUIChat.已读"),count:0,userList:[],isCompleted:!0,cursor:"",show:!0},{label:e.isH5?n("TUIChat.人未读"):n("TUIChat.未读"),count:0,userList:[],isCompleted:!0,cursor:"",show:!0},{label:e.isH5?n("TUIChat.人关闭阅读状态"):n("TUIChat.关闭阅读状态"),count:0,userList:[],isCompleted:!0,cursor:"",show:!1}],i.showListNow=0,i.messageInfo={isImg:!1,content:""}},l=()=>{var e,t,r,o,a,s,c;if(i.message&&i.isH5)switch(i.message.type){case yM.TUIServer.TUICore.TIM.TYPES.MSG_TEXT:i.messageInfo.content=null==(t=null==(e=i.message)?void 0:e.payload)?void 0:t.text,i.messageInfo.isImg=!1;break;case yM.TUIServer.TUICore.TIM.TYPES.MSG_CUSTOM:i.messageInfo.content=n("TUIChat.自定义"),i.messageInfo.isImg=!1;break;case yM.TUIServer.TUICore.TIM.TYPES.MSG_IMAGE:i.messageInfo.content=null==(r=sr(i.message))?void 0:r.url,i.messageInfo.isImg=!0;break;case yM.TUIServer.TUICore.TIM.TYPES.MSG_AUDIO:i.messageInfo.content=n("TUIChat.语音"),i.messageInfo.isImg=!1;break;case yM.TUIServer.TUICore.TIM.TYPES.MSG_VIDEO:i.messageInfo.content=null==(o=cr(i.message))?void 0:o.snapshotUrl,i.messageInfo.isImg=!0;break;case yM.TUIServer.TUICore.TIM.TYPES.MSG_FILE:i.messageInfo.content=n("TUIChat.文件")+(null==(s=null==(a=i.message)?void 0:a.payload)?void 0:s.fileName),i.messageInfo.isImg=!1;break;case yM.TUIServer.TUICore.TIM.TYPES.MSG_FACE:i.messageInfo.content=null==(c=or(i.message))?void 0:c.url,i.messageInfo.isImg=!0}},d=()=>{var e;i.isMenuOpen=!!(null==(e=null==document?void 0:document.getElementsByClassName("home-menu"))?void 0:e.length)};return{...b(i),dialog:r,toggleShow:()=>{i.show=!i.show,i.show||(t.emit("closeDialog","receipt"),u())},getReadList:o,getUnreadList:a,isGroup:c,handleAvatarAndName:s,close:u,getMoreList:()=>{switch(i.showListNow){case 0:o(!0);break;case 1:a(!0)}},showMessage:l,caculateTimeago:es,handleDialogPosition:d}}}),IM={class:"header"},MM={class:"header-back"},TM={class:"header-title"},CM={class:"header-close"},SM={class:"body"},EM={key:0,class:"body-message"},kM={class:"message"},bM={class:"message-info"},DM={class:"message-cont"},wM=["src"],AM={key:1},RM={class:"body-tab"},LM=["onClick"],OM={class:"tab-item-title"},NM={class:"tab-item-count"},PM={class:"body-list"},UM=["src"],xM={class:"name"};const GM=D(yM,[["render",function(e,t,n,i,r,o){return e.show?(w(),A("div",{key:0,class:G(["read-receipt",[e.isH5?"read-receipt-H5":"",e.isMenuOpen?"read-receipt-menu-open":""]]),ref:"dialog"},[P("div",IM,[P("div",MM,[e.isH5?(w(),A("i",{key:0,class:"icon icon-back",onClick:t[0]||(t[0]=(...t)=>e.toggleShow&&e.toggleShow(...t))})):O("",!0)]),P("div",TM,[P("span",null,L(e.$t("TUIChat.消息详情")),1)]),P("div",CM,[e.isH5?O("",!0):(w(),A("i",{key:0,class:"icon icon-close",onClick:t[1]||(t[1]=(...t)=>e.toggleShow&&e.toggleShow(...t))}))])]),P("div",SM,[e.isH5?(w(),A("div",EM,[P("div",kM,[P("div",bM,[P("span",null,L(e.message.from),1),P("span",null,L(e.caculateTimeago(1e3*e.message.time)),1)]),P("div",DM,[e.messageInfo.isImg?(w(),A("img",{key:0,class:"message-cont-img",src:e.messageInfo.content},null,8,wM)):(w(),A("p",AM,L(e.messageInfo.content),1))])])])):O("",!0),P("div",RM,[(w(!0),A(_,null,R(e.readReceiptList,((t,n)=>(w(),A(_,null,[t.show?(w(),A("div",{class:G(["tab-item",n===e.showListNow&&"tab-item-now"]),key:n,onClick:t=>e.showListNow=n},[P("div",OM,L(null==t?void 0:t.label),1),P("div",NM,L(null==t?void 0:t.count),1)],10,LM)):O("",!0)],64)))),256))]),P("div",PM,[P("ul",null,[(w(!0),A(_,null,R(e.readReceiptList[e.showListNow].userList,((e,t)=>(w(),A("li",{key:t,class:"body-list-item"},[P("img",{class:"avatar",src:(null==e?void 0:e.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,UM),P("div",xM,L((null==e?void 0:e.nick)||(null==e?void 0:e.userID)),1)])))),128))]),e.readReceiptList[e.showListNow].isCompleted?O("",!0):(w(),A("div",{key:0,class:"more",onClick:t[2]||(t[2]=(...t)=>e.getMoreList&&e.getMoreList(...t))},"查看更多"))])])],2)):O("",!0)}],["__scopeId","data-v-eea5b6e2"]]),FM=S({props:{message:{type:Object,default:()=>({})},isH5:{type:Boolean,default:!1},isRoot:{type:Boolean,default:!1}},components:{MessageText:Dr,MessageEmojiReact:Ls},setup(e,t){const n=E({message:{},isH5:!1,url:"",isRoot:!1,constant:er,TIM:Qi});return k((()=>{var t,i;n.message=e.message,n.isH5=e.isH5,n.isRoot=e.isRoot,n.message.type===Qi.TYPES.MSG_FACE&&(n.url=`https://web.sdk.qcloud.com/im/assets/face-elem/${null==(i=null==(t=n.message)?void 0:t.payload)?void 0:i.data}@2x.png`)})),{...b(n),handleTextMessageShowContext:rr,handleCustomMessageShowContext:hr,handleFileMessageShowContext:lr,caculateTimeago:es}}}),VM=e=>(F("data-v-51ae9411"),e=e(),V(),e),qM={class:"message-bubble",ref:"htmlRefHook"},BM=["src"],HM={class:"message-area"},jM={class:"message-area-title"},KM={class:"name"},zM={class:"time"},WM={class:"content content-in"},YM={key:1},$M=["src"],JM=VM((()=>P("i",{class:"icon icon-voice"},null,-1))),XM={key:4,class:"message-video-cover"},ZM=["src"],QM=["src"],eT={key:6,class:"message-file"},tT=VM((()=>P("i",{class:"icon icon-files"},null,-1))),nT={class:"message-file-content"};const iT=S({type:"custom",components:{RepliesItem:D(FM,[["render",function(e,t,n,i,r,o){var a,s,c,u,l,d,p,h,f,g,m,v,_,y,I,T,C,S,E,k;const b=J("MessageText"),D=J("MessageEmojiReact");return w(),A("div",{class:G(["replies-item",e.isRoot?"":"replies-item-normal"])},[P("div",qM,[P("img",{class:"avatar",src:(null==(a=e.message)?void 0:a.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,BM),P("main",HM,[P("div",jM,[P("label",KM,L(e.isRoot?e.message.nameCard||e.message.nick||e.message.from:e.message.messageSender),1),P("label",zM,L(e.caculateTimeago(1e3*(e.isRoot?null==(s=e.message)?void 0:s.time:null==(c=e.message)?void 0:c.messageTime))),1)]),P("div",WM,[e.message.messageType!==e.constant.typeText&&e.message.type!==e.TIM.TYPES.MSG_TEXT&&e.isRoot?O("",!0):(w(),j(b,{key:0,data:e.handleTextMessageShowContext(e.isRoot?e.message:{payload:{text:null==(u=e.message)?void 0:u.messageAbstract}})},null,8,["data"])),e.message.messageType===e.constant.typeCustom||e.message.type===e.TIM.TYPES.MSG_CUSTOM?(w(),A("span",YM,L(null==(l=e.handleCustomMessageShowContext(e.message))?void 0:l.custom),1)):O("",!0),e.message.messageType===e.constant.typeImage||e.message.type===e.TIM.TYPES.MSG_IMAGE?(w(),A("img",{key:2,class:"message-img",src:null==(p=null==(d=e.message)?void 0:d.payload)?void 0:p.imageInfoArray[1].url},null,8,$M)):O("",!0),e.message.messageType===e.constant.typeAudio||e.message.type===e.TIM.TYPES.MSG_AUDIO?(w(),A("div",{key:3,class:"message-audio",style:U(`width: ${10*(null==(f=null==(h=e.message)?void 0:h.payload)?void 0:f.second)+40}px`)},[JM,P("label",null,L(null==(m=null==(g=e.message)?void 0:g.payload)?void 0:m.second)+"s",1)],4)):O("",!0),e.message.messageType===e.constant.typeVideo||e.message.type===e.TIM.TYPES.MSG_VIDEO?(w(),A("div",XM,[P("img",{class:"message-videoimg",src:(null==(_=null==(v=e.message)?void 0:v.payload)?void 0:_.snapshotUrl)||(null==(I=null==(y=e.message)?void 0:y.payload)?void 0:I.thumbUrl)},null,8,ZM)])):O("",!0),e.message.messageType===e.constant.typeFace||e.message.type===e.TIM.TYPES.MSG_FACE?(w(),A("img",{key:5,class:"message-img",src:e.url},null,8,QM)):O("",!0),e.message.messageType===e.constant.typeFile||e.message.type===e.TIM.TYPES.MSG_FILE?(w(),A("div",eT,[tT,P("div",nT,[P("label",null,L(null==(C=null==(T=e.message)?void 0:T.payload)?void 0:C.fileName),1),P("span",null,L((null==(S=e.handleFileMessageShowContext(e.message))?void 0:S.size)||(null==(k=null==(E=e.message)?void 0:E.payload)?void 0:k.fileSize)),1)])])):O("",!0),M(D,{message:e.message,type:"content"},null,8,["message"])])])],512)],2)}],["__scopeId","data-v-51ae9411"]])},props:{message:{type:Object,default:()=>({})},isH5:{type:Boolean,default:!1},show:{type:Boolean,default:()=>!1},url:{type:String,default:""},messageList:{type:Array,default:()=>[]}},setup(e,t){const n=E({message:{},isGroup:!1,show:!1,isH5:!1,url:"",showListNow:0,isMenuOpen:!0,replies:[],messageList:[],TIM:Qi}),i=f();k((()=>{n.message=e.message,n.show=e.show,n.isH5=e.isH5,n.url=e.url,n.messageList=e.messageList})),v((()=>{n.message,n.messageList}),(()=>{n.message=e.message,n.messageList=e.messageList,r(n.message)}),{deep:!0});Pa(i,(()=>{n.show=!1,t.emit("closeDialog","replies"),o()}));const r=e=>{var t,i;try{const{cloudCustomData:r}=e;if(!r)return;const o=vr(r);n.replies=null==(t=null==o?void 0:o.messageReplies)?void 0:t.replies,null==(i=null==n?void 0:n.replies)||i.forEach((e=>{const{messageID:t,messageSender:i}=e,r=n.messageList.find((e=>e.ID===t||e.from===i));e.avatar=r?null==r?void 0:r.avatar:""}))}catch(r){}},o=()=>{n.message={}};return{...b(n),dialog:i,toggleShow:()=>{n.show=!n.show,n.show||(t.emit("closeDialog","replies"),o())},close:o,caculateTimeago:es,handleDialogPosition:()=>{var e;n.isMenuOpen=!!(null==(e=null==document?void 0:document.getElementsByClassName("home-menu"))?void 0:e.length)}}}}),rT={class:"header"},oT={class:"header-back"},aT={class:"header-title"},sT={class:"header-close"},cT={class:"body"},uT={class:"body-message"},lT={class:"body-list"};const dT=D(iT,[["render",function(e,t,n,i,r,o){const a=J("RepliesItem");return e.show?(w(),A("div",{key:0,class:G(["replies",[e.isH5?"replies-H5":"",e.isMenuOpen?"replies-menu-open":""]]),ref:"dialog"},[P("div",rT,[P("div",oT,[e.isH5?(w(),A("i",{key:0,class:"icon icon-back",onClick:t[0]||(t[0]=(...t)=>e.toggleShow&&e.toggleShow(...t))})):O("",!0)]),P("div",aT,[P("span",null,L(e.$t("TUIChat.回复详情")),1)]),P("div",sT,[e.isH5?O("",!0):(w(),A("i",{key:0,class:"icon icon-close",onClick:t[1]||(t[1]=(...t)=>e.toggleShow&&e.toggleShow(...t))}))])]),P("div",cT,[P("div",uT,[M(a,{message:e.message,isH5:e.isH5,isRoot:!0},null,8,["message","isH5"])]),P("div",lT,[P("ul",null,[(w(!0),A(_,null,R(e.replies,((t,n)=>(w(),A("li",{key:n,class:"body-list-item"},[M(a,{message:t,isH5:e.isH5,isRoot:!1},null,8,["message","isH5"])])))),128))])])])],2)):O("",!0)}],["__scopeId","data-v-ec83ba51"]]),pT=S({props:{show:{type:Boolean,default:()=>!1},isMute:{type:Boolean,default:()=>!1},isH5:{type:Boolean,default:()=>!1},conversation:{type:Object,default:()=>({})}},components:{Dialog:wu,Transfer:xc},setup(e,t){var n;const{t:i}=pT.TUIServer.TUICore.config.i18n.useI18n(),r=(null==(n=null==window?void 0:window.TUIKitTUICore)?void 0:n.isOfficial)&&Co&&Co()||{},o=E({showSelectDialog:!1,showCall:!1,showGroupUserDialog:!1,isH5:!1,isMute:!1,isHomeMenuOpen:!1,conversation:{},showTitle:"",searchUserList:[],memberList:[],mediaType:0,showUnsupportDialog:!1,errorContent:"",errorLink:{}}),a=f();k((()=>{o.showSelectDialog=e.show,o.isMute=e.isMute,o.isH5=e.isH5,o.conversation=e.conversation})),v((()=>o.showCall),((e,t)=>{e!==t&&o.showCall&&s()}));Pa(a,(()=>{o.showSelectDialog=!1}));const s=()=>{var e;o.isHomeMenuOpen=!!(null==(e=null==document?void 0:document.getElementsByClassName("home-menu"))?void 0:e.length)},c=async(e,t,n=[])=>{var i,r;switch(e.type){case pT.TUIServer.TUICore.TIM.TYPES.CONV_C2C:try{await pT.TUIServer.TUICore.TUIServer.TUICallKit.call({userID:null==(i=null==e?void 0:e.userProfile)?void 0:i.userID,type:t})}catch(o){l(o)}break;case pT.TUIServer.TUICore.TIM.TYPES.CONV_GROUP:try{await pT.TUIServer.TUICore.TUIServer.TUICallKit.groupCall({userIDList:n,groupID:null==(r=null==e?void 0:e.groupProfile)?void 0:r.groupID,type:t})}catch(o){l(o)}}},u=e=>{var t,n,r,a,s,c,u;o.showGroupUserDialog=!0,o.showTitle=i(1===e?"TUIChat.发起群语音":"TUIChat.发起群视频");const l={groupID:null==(n=null==(t=null==o?void 0:o.conversation)?void 0:t.groupProfile)?void 0:n.groupID,count:100,offset:0};null==(u=null==(c=null==(s=null==(a=null==(r=null==pT?void 0:pT.TUIServer)?void 0:r.TUICore)?void 0:a.TUIServer)?void 0:s.TUIGroup)?void 0:c.getGroupMemberList(l))||u.then((e=>{var t,n,i,r,a,s,c;const u=null==(i=null==(n=null==(t=o.conversation)?void 0:t.groupProfile)?void 0:n.selfInfo)?void 0:i.userID;let l=[];if(null==(a=null==(r=null==o?void 0:o.conversation)?void 0:r.groupProfile)?void 0:a.muteAllMembers)l=[];else{const t=(new Date).getTime();l=e.data.memberList.filter((e=>(null==e?void 0:e.userID)!==u&&(!(1e3*(null==e?void 0:e.muteUntil)-t>0)&&e)))}(null==(c=null==(s=null==o?void 0:o.conversation)?void 0:s.groupProfile)?void 0:c.muteAllMembers)&&(l=[]),o.memberList=l,o.searchUserList=l}))},l=e=>{var t;e?(null==(t=null==e?void 0:e.message)?void 0:t.indexOf("The package you purchased does not support this ability."))>=0?(o.showUnsupportDialog=!0,o.errorContent=i("TUIChat.您当前购买使用的套餐包暂未开通此功能"),o.errorLink=il.purchase):(o.errorContent=(null==e?void 0:e.message)||e,o.showUnsupportDialog=!1,o.errorLink={}):(o.showUnsupportDialog=!0,o.errorContent=i("TUIChat.检测到您暂未集成TUICallKit，无法体验音视频通话功能"),o.errorLink=il.implement)};return{...b(o),toggleShowSelectDialog:()=>{o.isMute||(o.showSelectDialog=!0)},dialog:a,onClickCall:e=>{var t,n,i,a,s;if(o.showSelectDialog=!1,o.mediaType=e,!(null==(i=null==(n=null==(t=null==pT?void 0:pT.TUIServer)?void 0:t.TUICore)?void 0:n.TUIServer)?void 0:i.TUICallKit))return l(),void Mo.getInstance().reportEvent({name:"callOptions",ext1:"call-uninstall"});switch(Mo.getInstance().reportEvent({name:"callOptions",ext1:"clickCall-success"}),(null==(a=null==window?void 0:window.TUIKitTUICore)?void 0:a.isOfficial)&&(null==r?void 0:r.commit)&&(null==r||r.commit("handleTask",6)),null==(s=o.conversation)?void 0:s.type){case pT.TUIServer.TUICore.TIM.TYPES.CONV_C2C:c(o.conversation,e),Mo.getInstance().reportEvent({name:"callOptions",ext1:"call-c2c"});break;case pT.TUIServer.TUICore.TIM.TYPES.CONV_GROUP:u(e),Mo.getInstance().reportEvent({name:"callOptions",ext1:"call-group"})}},handleCallDialogPosition:s,handleCall:c,handleGroupDialog:u,handleSearch:async e=>{var t;const n=null==(t=o.memberList)?void 0:t.filter((t=>(null==t?void 0:t.userID)===e));o.searchUserList=(null==n?void 0:n.length)?n:o.memberList},submit:e=>{o.searchUserList=o.memberList,o.showGroupUserDialog=!1;const t=null==e?void 0:e.map((e=>null==e?void 0:e.userID));c(o.conversation,o.mediaType,t)},cancle:()=>{o.showGroupUserDialog=!1,o.mediaType=0},handleShowCallIcon:(e,t)=>{var n,i,r,o,a,s,c;return(e.type!==pT.TUIServer.TUICore.TIM.TYPES.CONV_C2C||(null==(n=null==e?void 0:e.userProfile)?void 0:n.userID)!==(null==(c=null==(s=null==(a=null==(o=null==(r=null==(i=null==pT?void 0:pT.TUIServer)?void 0:i.TUICore)?void 0:r.TUIServer)?void 0:o.TUIProfile)?void 0:a.currentStore)?void 0:s.profile)?void 0:c.userID))&&(Mo.getInstance().reportEvent({name:"callOptions",ext1:"clickCall"}),!0)},openLink:e=>{e&&(window.open(e),Mo.getInstance().reportEvent({name:"openLink",ext1:"callkit-doc"}))},handleUnsupportDialog:l}}}),hT=e=>(F("data-v-ae509285"),e=e(),V(),e),fT={key:0,class:"call",id:"call"},gT=[hT((()=>P("i",{class:"icon icon-call",title:"通话"},null,-1))),hT((()=>P("i",{class:"icon icon-down-arrow",title:"通话"},null,-1)))],mT={class:"call-main-content",ref:"dialog"},vT={key:0,class:"icon icon-call-voice"},_T={key:0,class:"icon icon-call-video"},yT={class:"uncall-dialog-body"};const IT=D(pT,[["render",function(e,t,n,i,r,o){const a=J("Transfer"),s=J("Dialog");return e.handleShowCallIcon(e.conversation,e.isH5)?(w(),A("div",fT,[P("div",{class:"call-icon",onClick:t[0]||(t[0]=(...t)=>e.toggleShowSelectDialog&&e.toggleShowSelectDialog(...t))},gT),z(P("div",{class:G(["call-main",[e.isH5&&"call-main-h5"]])},[P("div",mT,[P("div",{class:"call-main-voice",onClick:t[1]||(t[1]=t=>e.onClickCall(1))},[e.isH5?(w(),A("i",vT)):O("",!0),oe(" "+L(e.$t("TUIChat.语音通话")),1)]),P("div",{class:"call-main-video",onClick:t[2]||(t[2]=t=>e.onClickCall(2))},[e.isH5?(w(),A("i",_T)):O("",!0),oe(" "+L(e.$t("TUIChat.视频通话")),1)]),P("footer",null,[e.isH5?(w(),A("span",{key:0,class:"close",onClick:t[3]||(t[3]=x((t=>e.showSelectDialog=!1),["stop"]))},L(e.$t("TUIChat.取消")),1)):O("",!0)])],512)],2),[[W,e.showSelectDialog]]),M(s,{show:e.showGroupUserDialog,isH5:e.isH5,isHeaderShow:!1,isFooterShow:!1,background:!1,"onUpdate:show":t[4]||(t[4]=t=>e.showGroupUserDialog=t)},{default:K((()=>{var t;return[M(a,{isSearch:!0,title:e.showTitle,list:e.searchUserList,isH5:e.isH5,isRadio:"isC2C"===(null==(t=e.conversation)?void 0:t.type),onSearch:e.handleSearch,onSubmit:e.submit,onCancel:e.cancle},null,8,["title","list","isH5","isRadio","onSearch","onSubmit","onCancel"])]})),_:1},8,["show","isH5"]),M(s,{show:e.showUnsupportDialog,isH5:e.isH5,isHeaderShow:!0,isFooterShow:!0,background:!0,title:e.$t("TUIChat.欢迎使用TUICallKit"),"onUpdate:show":t[6]||(t[6]=t=>e.showUnsupportDialog=t)},{default:K((()=>{var n;return[P("div",null,[P("div",yT,[P("p",null,L(e.errorContent),1),z(P("p",null,[oe(L(e.$t("TUIChat.请点击"))+" ",1),P("a",{onClick:t[5]||(t[5]=t=>{var n;return e.openLink(null==(n=e.errorLink)?void 0:n.url)})},L(e.$t(`TUIChat.${null==(n=e.errorLink)?void 0:n.label}`)),1),oe(" "+L(e.$t("TUIChat.进行体验")),1)],512),[[W,Object.keys(e.errorLink).length>0]])])])]})),_:1},8,["show","isH5","title"])])):O("",!0)}],["__scopeId","data-v-ae509285"]]),MT=e=>(F("data-v-ad0034e6"),e=e(),V(),e),TT=["src"],CT=[MT((()=>P("i",{class:"icon icon-left-arrow"},null,-1)))],ST=[MT((()=>P("i",{class:"icon icon-right-arrow"},null,-1)))],ET={class:"actions-bar"},kT={class:"image-counter"},bT=S({__name:"imagePreviewer",props:{imageList:{type:Array,default:()=>[]},currentImage:{type:Object,default:()=>({})}},emits:["close"],setup(e,{emit:t}){const n=e,i=f(1),r=f(0),o=f(.1),a=f(0),s=f(),c=f(),{isH5:u}=zi();let l=0,h={},g=!1,m=!1,v=null;k((()=>{a.value=n.imageList.findIndex((e=>e.ID===n.currentImage.ID))}));const y=e=>{e.preventDefault(),S(e),E(e)},I=e=>{e.preventDefault(),g=!0,e.touches&&2===e.touches.length&&(m=!0,b(e))},M=e=>{var t;e.preventDefault();let n=0,i=0;if(m)v||(m=!1,delete h.pageX2,delete h.pageY2,v=setTimeout((()=>{v=null}),200));else if(null===v){switch(g){case!0:n=null==(t=null==e?void 0:e.changedTouches[0])?void 0:t.pageX,i=n-l,i>100?B():i<-100&&q();break;case!1:x()}v=setTimeout((()=>{v=null}),200)}},T=e=>{m=!1,delete h.pageX1,delete h.pageY1},C=e=>{if(e.preventDefault(),0!==Math.abs(e.deltaX)&&0!==Math.abs(e.deltaY))return;let t=i.value;t+=e.deltaY*(e.ctrlKey?-.01:.002),t=Math.min(Math.max(.125,t),4),i.value=t},S=e=>{var t;l=null==(t=null==e?void 0:e.changedTouches[0])?void 0:t.pageX,g=!1},E=e=>{let t=null==e?void 0:e.touches[0],n=null==e?void 0:e.touches[1];h.pageX1=null==t?void 0:t.pageX,h.pageY1=null==t?void 0:t.pageY,n&&(h.pageX2=null==n?void 0:n.pageX,h.pageY2=null==n?void 0:n.pageY)},b=e=>{let t=null==e?void 0:e.touches[0],n=null==e?void 0:e.touches[1];n&&(Da(h.pageX2)||(h.pageX2=n.pageX),Da(h.pageY2)||(h.pageY2=n.pageY));const r=(e,t,n,i)=>Math.hypot(n-e,i-t);if(!(Da(h.pageX1)&&Da(h.pageY1)&&Da(h.pageX2)&&Da(h.pageY2)))return;let o=r(t.pageX,t.pageY,n.pageX,n.pageY)/r(h.pageX1,h.pageY1,h.pageX2,h.pageY2);i.value=Math.min(Math.max(.5,i.value*o),4)};d((()=>{var e,t,n,i,r;null==(e=null==s?void 0:s.value)||e.addEventListener("touchstart",y),null==(t=null==s?void 0:s.value)||t.addEventListener("touchmove",I),null==(n=null==s?void 0:s.value)||n.addEventListener("touchend",M),null==(i=null==s?void 0:s.value)||i.addEventListener("touchcancel;",T),null==(r=null==s?void 0:s.value)||r.addEventListener("wheel",C),null==document||document.addEventListener("keydown",D)}));const D=e=>{e.preventDefault(),27===(null==e?void 0:e.keyCode)&&x()},O=()=>{i.value+=.1},N=()=>{i.value=i.value-.1>o.value?i.value-.1:o.value},x=()=>{t("close")},F=()=>{r.value-=90},V=()=>{r.value+=90},q=()=>{c.value.style.transition="0.5s",a.value<n.imageList.length-1&&a.value++,j()},B=()=>{c.value.style.transition="0.5s",a.value>0&&a.value--,j()},j=()=>{i.value=1,r.value=0};return p((()=>{var e,t,n,i,r;null==(e=null==s?void 0:s.value)||e.removeEventListener("touchstart",y),null==(t=null==s?void 0:s.value)||t.removeEventListener("touchmove",I),null==(n=null==s?void 0:s.value)||n.removeEventListener("touchend",M),null==(i=null==s?void 0:s.value)||i.removeEventListener("touchcancel;",T),null==(r=null==s?void 0:s.value)||r.removeEventListener("wheel",C),null==document||document.removeEventListener("keydown",D)})),(t,n)=>{var o;return w(),A("div",{class:G(["image-previewer",[H(u)&&"image-previewer-h5"]])},[P("div",{class:"image-wrapper",ref_key:"image",ref:s},[P("ul",{class:"image-list",style:U({width:100*e.imageList.length+"%",transform:`translateX(-${100*a.value/e.imageList.length}%)`}),ref_key:"ul",ref:c},[(w(!0),A(_,null,R(e.imageList,((e,t)=>{var n,o;return w(),A("li",{class:"image-item",key:t},[P("img",{class:"image-preview",style:U({transform:`scale(${i.value}) rotate(${r.value}deg)`}),src:null==(o=null==(n=null==e?void 0:e.payload)?void 0:n.imageInfoArray[0])?void 0:o.url},null,12,TT)])})),128))],4)],512),z(P("i",{class:"icon icon-close",onClick:x},null,512),[[W,!H(u)]]),z(P("div",{class:"image-button image-button-left",onClick:B},CT,512),[[W,!H(u)&&a.value>0]]),z(P("div",{class:"image-button image-button-right",onClick:q},ST,512),[[W,!H(u)&&a.value<(null==(o=e.imageList)?void 0:o.length)-1]]),P("div",ET,[P("i",{class:"icon icon-zoom-in",onClick:O}),P("i",{class:"icon icon-zoom-out",onClick:N}),P("i",{class:"icon icon-refresh-left",onClick:F}),P("i",{class:"icon icon-refresh-right",onClick:V}),P("span",kT,L(a.value+1)+" / "+L(e.imageList.length),1)])],2)}}});let DT={Face:BI,Image:KI,Video:YI,File:XI,Evaluate:mM,Words:rM,Call:IT};const wT={Forward:QI},AT={TypingHeader:_M,ReadReceiptDialog:GM,Replies:dT,ImagePreviewer:D(bT,[["__scopeId","data-v-ad0034e6"]]),MessageInput:lI};function RT(e){let t={};switch(e){case"send":t=DT;break;case"message":t=wT;break;case"other":t=AT}return t}const LT={name:"TUIChat",component:LI,server:Sr,sendComponents:DT,messageComponents:wT,otherComponents:AT,install:e=>{const t={...DT,...wT,...AT};Object.keys(t).forEach((e=>{t[e].TUIServer=LT.server})),LI.TUIServer=LT.server,LI.components={...LI.components,...t},e.component(LT.name,LI)},plugin:e=>(LT.server=new Sr(e),e.component(LT.name,LT),LT),setPluginComponents:e=>{DT={...DT,...e}},removePluginComponents:e=>{e.map((e=>(delete DT[e],e)))}};class OT extends Cr{constructor(e){super(),this.currentStore={},this.TUICore=e,this.bindTIMEvent(),this.store=e.setComponentStore("TUIConversation",{},this.updateStore.bind(this))}destroyed(){this.unbindTIMEvent()}updateStore(e,t){var n,i,r;(null==(n=null==this?void 0:this.currentStore)?void 0:n.conversationData)&&(this.currentStore.conversationData.list=e.conversationList,null==(i=null==e?void 0:e.conversationList)||i.filter((e=>{var t,n;(null==(t=null==e?void 0:e.userProfile)?void 0:t.userID)&&this.currentStore.userIDList.add(null==(n=null==e?void 0:e.userProfile)?void 0:n.userID)})),this.currentStore.userStatusList=null==(r=this.TUICore.TUIServer.TUIContact.currentStore)?void 0:r.userStatusList)}handlePromiseCallback(e){return new Promise(((t,n)=>{const i="TUIConversation",r=()=>{e&&e(t,n)};this.TUICore.setAwaitFunc(i,r)}))}bindTIMEvent(){this.TUICore.tim.on(this.TUICore.TIM.EVENT.CONVERSATION_LIST_UPDATED,this.handleConversationListUpdate,this),this.TUICore.tim.on(this.TUICore.TIM.EVENT.NET_STATE_CHANGE,this.handleNetStateChange,this)}unbindTIMEvent(){this.TUICore.tim.off(this.TUICore.TIM.EVENT.CONVERSATION_LIST_UPDATED,this.handleConversationListUpdate),this.TUICore.tim.off(this.TUICore.TIM.EVENT.NET_STATE_CHANGE,this.handleNetStateChange)}handleConversationListUpdate(e){this.handleFilterSystem(e.data)}handleNetStateChange(e){var t;this.currentStore.netWork=(null==(t=null==e?void 0:e.data)?void 0:t.state)||""}handleFilterSystem(e){const t={allConversationList:e,conversationList:[]};return 0===e.filter((e=>{var t;return(null==e?void 0:e.conversationID)===(null==(t=null==this?void 0:this.currentStore)?void 0:t.currentConversationID)})).length&&this.handleCurrentConversation({}),t.conversationList=e.filter((e=>e.type!==this.TUICore.TIM.TYPES.CONV_SYSTEM)),this.store.allConversationList=t.allConversationList,this.store.conversationList=t.conversationList,t}async setMessageRead(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.setMessageRead({conversationID:e}))}catch(i){n(i)}}))}async deleteConversation(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.deleteConversation(e))}catch(i){n(i)}}))}async pinConversation(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.pinConversation(e))}catch(i){n(i)}}))}async muteConversation(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.setMessageRemindType(e))}catch(i){n(i)}}))}async getConversationProfile(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.getConversationProfile(e))}catch(i){n(i)}}))}async getConversationList(){return this.handlePromiseCallback((async(e,t)=>{try{const t=await this.TUICore.tim.getConversationList();this.handleFilterSystem(t.data.conversationList),e(t)}catch(n){t(n)}}))}async getUserProfile(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.getUserProfile({userIDList:e}))}catch(i){n(i)}}))}async bind(e){var t;return this.currentStore=e,await this.getConversationList(),this.currentStore.userStatusList=null==(t=this.TUICore.TUIServer.TUIContact.currentStore)?void 0:t.userStatusList,this.currentStore}handleCurrentConversation(e){this.TUICore.getStore().TUIChat.conversation=e||{},(null==e?void 0:e.conversationID)?(this.currentStore.currentConversationID===(null==e?void 0:e.conversationID)&&(this.currentStore.currentConversationID=""),this.currentStore.currentConversationID&&this.setMessageRead(this.currentStore.currentConversationID),this.currentStore.currentConversationID=null==e?void 0:e.conversationID,this.setMessageRead(e.conversationID)):this.currentStore.currentConversationID=""}}const NT=S({props:{conversation:{type:Object,default:()=>({})},handleConversation:{type:Object,default:()=>({})},currentID:{type:String,default:()=>""},toggleID:{type:String,default:()=>""},isH5:{type:Boolean,default:()=>!1},displayOnlineStatus:{type:Boolean,default:()=>!1},userStatusList:{type:Map,default:()=>new Map},types:{type:Object,default:()=>({})}},setup(e,t){const n=E({conversation:{},currentID:"",currentConversation:{},toggle:!1,currentuserID:"",conversationType:"",loop:0,displayOnlineStatus:!1,userStatusList:new Map}),i=f(),r=f();Pa(r,(()=>{!0===n.toggle&&t.emit("toggle","")})),k((()=>{n.conversation=e.conversation,n.currentID=e.currentID,n.toggle=!1,n.displayOnlineStatus=e.displayOnlineStatus,n.userStatusList=e.userStatusList,e.toggleID===e.conversation.conversationID&&(n.toggle=!0)})),v((()=>n.toggle),(e=>{e&&N((()=>{var e;const t=ja(i),n=ja(null==(e=null==r?void 0:r.value)?void 0:e.offsetParent);t.top.value-n.top.value-t.height.value-30>0&&(i.value.style.top="auto",i.value.style.bottom="30px")}))}));return{...b(n),handleListItem:e=>{t.emit("open",e),t.emit("toggle","")},handleItem:e=>{t.emit("handle",{name:e,conversation:n.conversation}),t.emit("toggle","")},dialog:i,content:r,toggleDialog:e=>{var i;(null==(i=null==e?void 0:e.target)?void 0:i.oncontextmenu)&&(e.target.oncontextmenu=function(){return!1}),t.emit("toggle",n.conversation.conversationID)},showUserOnlineStatus:()=>{var t;return!(!n.displayOnlineStatus||(null==(t=n.conversation)?void 0:t.type)!==e.types.CONV_C2C)}}}}),PT=["id"],UT={class:"left"},xT=["src"],GT={key:1,class:"num"},FT={key:2,class:"num-notify"},VT={class:"content"},qT={class:"content-header"},BT={class:"name"},HT={class:"middle-box"},jT={key:0,class:"middle-box-at"},KT={class:"content-footer"},zT={class:"time"},WT={key:0,class:"mute-icon",src:"/assets/mute-94c8513a.svg"},YT=(e=>(F("data-v-a8eb5a31"),e=e(),V(),e))((()=>P("i",null,null,-1))),$T={key:0,class:"dialog dialog-item",ref:"dialog"};const JT=S({props:{data:{type:Object,default:()=>({})},currentID:{type:String,default:()=>""},isH5:{type:Boolean,default:()=>!1},displayOnlineStatus:{type:Boolean,default:()=>!1},userStatusList:{type:Map,default:()=>new Map}},components:{LiteItem:D(NT,[["render",function(e,t,n,i,r,o){var a,s,c,u,l,d,p,h,f;const g=ce("TUILongPress");return w(),A("li",{ref:"content",class:G(["TUI-conversation-content",[e.currentID===e.conversation.conversationID&&"selected",e.conversation.isPinned&&"pinned",e.isH5?"list-item-h5":""]]),id:e.conversation.conversationID},[z((w(),A("div",{class:"TUI-conversation-item",onClick:t[0]||(t[0]=x((t=>e.handleListItem(e.conversation)),["prevent","stop"])),onContextmenu:t[1]||(t[1]=x(((...t)=>e.toggleDialog&&e.toggleDialog(...t)),["prevent","right"]))},[P("aside",UT,[P("img",{class:"avatar",src:null==(a=e.handleConversation)?void 0:a.avator(e.conversation)},null,8,xT),e.showUserOnlineStatus()?(w(),A("div",{key:0,class:G(["online-status",1===(null==(l=null==(u=e.userStatusList)?void 0:u.get(null==(c=null==(s=e.conversation)?void 0:s.userProfile)?void 0:c.userID))?void 0:l.statusType)?"online-status-online":"online-status-offline"])},null,2)):O("",!0),e.conversation.unreadCount>0&&"AcceptNotNotify"!==e.conversation.messageRemindType?(w(),A("span",GT,L(e.conversation.unreadCount>99?"99+":e.conversation.unreadCount),1)):O("",!0),e.conversation.unreadCount>0&&"AcceptNotNotify"===e.conversation.messageRemindType?(w(),A("span",FT)):O("",!0)]),P("div",VT,[P("div",qT,[P("label",null,[P("p",BT,L(null==(d=e.handleConversation)?void 0:d.name(e.conversation)),1)]),P("div",HT,["GROUP"===e.conversation.type&&e.conversation.groupAtInfoList.length>0?(w(),A("span",jT,L(null==(p=e.handleConversation)?void 0:p.showAt(e.conversation)),1)):O("",!0),P("p",null,L(null==(h=e.handleConversation)?void 0:h.showMessage(e.conversation)),1)])]),P("div",KT,[P("span",zT,L(null==(f=e.handleConversation)?void 0:f.time(e.conversation.lastMessage.lastTime)),1),"AcceptNotNotify"===e.conversation.messageRemindType?(w(),A("img",WT)):O("",!0),YT])])],32)),[[g,e.toggleDialog,void 0,{self:!0}]]),e.toggle?(w(),A("div",$T,[P("p",{class:"conversation-options",onClick:t[2]||(t[2]=x((t=>e.handleItem("delete")),["stop"]))},L(e.$t("TUIConversation.删除会话")),1),e.conversation.isPinned?O("",!0):(w(),A("p",{key:0,class:"conversation-options",onClick:t[3]||(t[3]=x((t=>e.handleItem("ispinned")),["stop"]))},L(e.$t("TUIConversation.置顶会话")),1)),e.conversation.isPinned?(w(),A("p",{key:1,class:"conversation-options",onClick:t[4]||(t[4]=x((t=>e.handleItem("dispinned")),["stop"]))},L(e.$t("TUIConversation.取消置顶")),1)):O("",!0),""===e.conversation.messageRemindType||"AcceptAndNotify"===e.conversation.messageRemindType?(w(),A("p",{key:2,class:"conversation-options",onClick:t[5]||(t[5]=x((t=>e.handleItem("mute")),["stop"]))},L(e.$t("TUIConversation.消息免打扰")),1)):O("",!0),"AcceptNotNotify"===e.conversation.messageRemindType?(w(),A("p",{key:3,class:"conversation-options",onClick:t[6]||(t[6]=x((t=>e.handleItem("notMute")),["stop"]))},L(e.$t("TUIConversation.取消免打扰")),1)):O("",!0)],512)):O("",!0)],10,PT)}],["__scopeId","data-v-a8eb5a31"]])},setup(e,t){const n=null==JT?void 0:JT.TUIServer,i=E({data:{},currentID:"",toggleID:"",displayOnlineStatus:!1,userStatusList:new Map,types:n.TUICore.TIM.TYPES}),r=f();k((()=>{i.data=e.data,i.currentID=e.currentID,i.displayOnlineStatus=e.displayOnlineStatus,i.userStatusList=e.userStatusList})),v((()=>e.userStatusList),(()=>{i.userStatusList=e.userStatusList}),{deep:!0});const o=e=>{n.deleteConversation(e.conversationID).then((e=>{Mo.getInstance().reportEvent({name:"conversationOptions",ext1:"conversationDelete"});const{conversationID:t}=e.data,{conversation:i}=n.TUICore.getStore().TUIChat;i.conversationID===t&&(n.TUICore.getStore().TUIChat.conversation={conversationID:""})}))},a=(e,t)=>{const i={conversationID:t.conversationID,isPinned:!0};"dispinned"===e&&(i.isPinned=!1),n.pinConversation(i)},s=(e,t)=>{const i={messageRemindType:n.TUICore.TIM.TYPES.MSG_REMIND_ACPT_NOT_NOTE};t.type===n.TUICore.TIM.TYPES.CONV_C2C?i.userIDList=[t.userProfile.userID]:t.type===n.TUICore.TIM.TYPES.CONV_GROUP&&(i.groupID=t.groupProfile.groupID),"notMute"===e&&(i.messageRemindType=n.TUICore.TIM.TYPES.MSG_REMIND_ACPT_AND_NOTE),n.muteConversation(i)};return{...b(i),handleListItem:e=>{t.emit("handleItem",e)},handleItem:e=>{const{name:t,conversation:n}=e;switch(Mo.getInstance().reportEvent({name:"conversationOptions",ext1:"conversationOptions"}),t){case"delete":o(n);break;case"ispinned":case"dispinned":a(t,n);break;case"mute":case"notMute":s(t,n)}},handleToggleListItem:e=>{i.toggleID=e},list:r,scrollChange:()=>{i.toggleID&&(i.toggleID="")}}}});const XT=D(JT,[["render",function(e,t,n,i,r,o){const a=J("LiteItem");return w(),A("ul",{class:G(["TUI-conversation-list",[e.isH5?"list-h5":""]]),ref:"list",onMousewheel:t[0]||(t[0]=(...t)=>e.scrollChange&&e.scrollChange(...t)),onScroll:t[1]||(t[1]=(...t)=>e.scrollChange&&e.scrollChange(...t))},[(w(!0),A(_,null,R(e.data.list,((t,n)=>(w(),j(a,{isH5:e.isH5,key:n,currentID:e.currentID,conversation:t,toggleID:e.toggleID,handleConversation:{avator:e.data.handleItemAvator,name:e.data.handleItemName,showAt:e.data.handleShowAt,showMessage:e.data.handleShowMessage,time:e.data.handleItemTime,userID:e.data.handleItemUserID},displayOnlineStatus:e.displayOnlineStatus,userStatusList:e.userStatusList,onToggle:e.handleToggleListItem,onOpen:e.handleListItem,onHandle:e.handleItem,types:e.types},null,8,["isH5","currentID","conversation","toggleID","handleConversation","displayOnlineStatus","userStatusList","onToggle","onOpen","onHandle","types"])))),128))],34)}],["__scopeId","data-v-87a5f969"]]),ZT=S({name:"TUIConversation",components:{TUIConversationList:XT},props:{displayOnlineStatus:{type:Boolean,default:!1}},setup(e,t){var n,i;const r=null==ZT?void 0:ZT.TUIServer,o=E({currentConversationID:"",conversationData:{list:[],handleItemAvator:e=>tr(e),handleItemName:e=>nr(e),handleShowAt:e=>function(e){const{t:t}=window.TUIKitTUICore.config.i18n.useI18n(),n=[`[${t("TUIConversation.有人@我")}]`,`[${t("TUIConversation.@所有人")}]`,`[${t("TUIConversation.@所有人")}][${t("TUIConversation.有人@我")}]`];let i="";for(let r=0;r<e.groupAtInfoList.length;r++)e.groupAtInfoList[r].atTypeArray[0]&&e.unreadCount>0&&(i=n[e.groupAtInfoList[r].atTypeArray[0]-1]);return i}(e),handleShowMessage:e=>function(e){var t;const{t:n}=window.TUIKitTUICore.config.i18n.useI18n(),{lastMessage:i}=e,r=e;let o="",a="";const s=r.unreadCount>0&&r.messageRemindType===Qi.TYPES.MSG_REMIND_ACPT_NOT_NOTE?`[${r.unreadCount>99?"99+":r.unreadCount}${n("TUIConversation.条")}] `:"";if(r.type===Qi.TYPES.CONV_GROUP&&(o=i.fromAccount===r.groupProfile.selfInfo.userID?n("TUIConversation.我"):i.nameCard||i.nick||i.fromAccount),i.type===Qi.TYPES.MSG_TEXT)a=i.payload.text;else if(i.type===Qi.TYPES.MSG_CUSTOM){const e=vr(null==(t=null==i?void 0:i.payload)?void 0:t.data);if(1===(null==e?void 0:e.businessID))return a=pr(i),a;a=i.messageForShow}else a=i.messageForShow;return i.isRevoked&&(a=n("TUIChat.撤回了一条消息")),r.type===Qi.TYPES.CONV_GROUP&&i.type===Qi.TYPES.MSG_GRP_TIP?a:`${s}${o?`${o}:`:""}${a}`}(e),handleItemTime:e=>e>0?es(1e3*e):""},userIDList:new Set,netWork:"",env:r.TUICore.TUIEnv,displayOnlineStatus:!1,userStatusList:null==(i=null==(n=r.TUICore.TUIServer.TUIContact)?void 0:n.currentStore)?void 0:i.userStatusList});r.bind(o),XT.TUIServer=r,v((()=>o.currentConversationID),(e=>{t.emit("current",e)}),{deep:!0}),v((()=>e.displayOnlineStatus),(async(e,t)=>{var n,i;e!==t&&(o.displayOnlineStatus=e,r.TUICore.TUIServer.TUIContact.handleUserStatus(o.displayOnlineStatus,[...o.userIDList]),o.userStatusList=null==(i=null==(n=r.TUICore.TUIServer.TUIContact)?void 0:n.currentStore)?void 0:i.userStatusList)}),{immediate:!0}),v((()=>[...o.userIDList]),(async(e,t)=>{is(e,t)||r.TUICore.TUIServer.TUIContact.handleUserStatus(o.displayOnlineStatus,[...o.userIDList])}),{deep:!0});const a=g((()=>{const e=o.netWork===r.TUICore.TIM.TYPES.NET_STATE_DISCONNECTED,t=o.netWork===r.TUICore.TIM.TYPES.NET_STATE_CONNECTING;return e||t}));return{...b(o),handleCurrentConversation:e=>{r.handleCurrentConversation(e)},isNetwork:a}}}),QT={class:"TUI-conversation"},eC={key:0,class:"network"},tC=(e=>(F("data-v-3da5acc8"),e=e(),V(),e))((()=>P("i",{class:"icon icon-error"},"!",-1))),nC={class:"TUI-conversation-list"};const iC=D(ZT,[["render",function(e,t,n,i,r,o){const a=J("TUIConversationList");return w(),A("div",QT,[e.isNetwork?(w(),A("div",eC,[tC,P("p",null,"️"+L(e.$t("TUIConversation.网络异常，请您检查网络设置")),1)])):O("",!0),P("main",nC,[M(a,{currentID:e.currentConversationID,data:e.conversationData,onHandleItem:e.handleCurrentConversation,isH5:e.env.isH5,displayOnlineStatus:e.displayOnlineStatus,userStatusList:e.userStatusList},null,8,["currentID","data","onHandleItem","isH5","displayOnlineStatus","userStatusList"])])])}],["__scopeId","data-v-3da5acc8"]]),rC={name:"TUIConversation",component:iC,server:OT,install:e=>{iC.TUIServer=rC.server,e.component(rC.name,iC)},plugin:e=>(rC.server=new OT(e),e.component(rC.name,rC),rC)},oC={profile:{}};class aC extends Cr{constructor(e){super(),this.currentStore={},this.TUICore=e,this.bindTIMEvent(),this.store=e.setComponentStore("TUIProfile",oC,this.updateStore.bind(this)),this.getMyProfile()}destroyed(){this.unbindTIMEvent()}updateStore(e,t){this.currentStore.profile=JSON.parse(JSON.stringify(e.profile))}bindTIMEvent(){this.TUICore.tim.on(this.TUICore.TIM.EVENT.PROFILE_UPDATED,this.handleProfileUpdated,this)}unbindTIMEvent(){this.TUICore.tim.off(this.TUICore.TIM.EVENT.PROFILE_UPDATED,this.handleProfileUpdated)}handleProfileUpdated(e){e.data.map((e=>(e.userID===this.store.profile.userID&&(this.store.profile={},this.store.profile=e),e)))}handlePromiseCallback(e){return new Promise(((t,n)=>{const i="TUIProfile",r=()=>{e&&e(t,n)};this.TUICore.setAwaitFunc(i,r)}))}async getMyProfile(){return this.handlePromiseCallback((async(e,t)=>{try{const t=await this.TUICore.tim.getMyProfile();this.store.profile=t.data,this.currentStore.profile=JSON.parse(JSON.stringify(this.store.profile)),e(t)}catch(n){t(n)}}))}async getUserProfile(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.getUserProfile({userIDList:e}))}catch(i){n(i)}}))}async updateMyProfile(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=await this.TUICore.tim.updateMyProfile(e);this.store.profile=n.data,t(n)}catch(i){n(i)}}))}async bind(e){return this.currentStore=e,this.getMyProfile(),this.currentStore}setEdit(e){return this.currentStore.isEdit=e,this.currentStore.isEdit}}var sC=Object.defineProperty,cC=Object.defineProperties,uC=Object.getOwnPropertyDescriptors,lC=Object.getOwnPropertySymbols,dC=Object.prototype.hasOwnProperty,pC=Object.prototype.propertyIsEnumerable,hC=(e,t,n)=>t in e?sC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,fC=(e,t)=>{for(var n in t||(t={}))dC.call(t,n)&&hC(e,n,t[n]);if(lC)for(var n of lC(t))pC.call(t,n)&&hC(e,n,t[n]);return e},gC=(e,t)=>cC(e,uC(t)),mC=(e,t)=>{const n=e.__vccOpts||e;for(const[i,r]of t)n[i]=r;return n};const vC={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32",class:"dp__icon"},_C=[P("path",{d:"M29.333 8c0-2.208-1.792-4-4-4h-18.667c-2.208 0-4 1.792-4 4v18.667c0 2.208 1.792 4 4 4h18.667c2.208 0 4-1.792 4-4v-18.667zM26.667 8v18.667c0 0.736-0.597 1.333-1.333 1.333 0 0-18.667 0-18.667 0-0.736 0-1.333-0.597-1.333-1.333 0 0 0-18.667 0-18.667 0-0.736 0.597-1.333 1.333-1.333 0 0 18.667 0 18.667 0 0.736 0 1.333 0.597 1.333 1.333z"},null,-1),P("path",{d:"M20 2.667v5.333c0 0.736 0.597 1.333 1.333 1.333s1.333-0.597 1.333-1.333v-5.333c0-0.736-0.597-1.333-1.333-1.333s-1.333 0.597-1.333 1.333z"},null,-1),P("path",{d:"M9.333 2.667v5.333c0 0.736 0.597 1.333 1.333 1.333s1.333-0.597 1.333-1.333v-5.333c0-0.736-0.597-1.333-1.333-1.333s-1.333 0.597-1.333 1.333z"},null,-1),P("path",{d:"M4 14.667h24c0.736 0 1.333-0.597 1.333-1.333s-0.597-1.333-1.333-1.333h-24c-0.736 0-1.333 0.597-1.333 1.333s0.597 1.333 1.333 1.333z"},null,-1)];var yC=mC({},[["render",function(e,t){return w(),A("svg",vC,_C)}]]);const IC={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32",class:"dp__icon"},MC=[P("path",{d:"M23.057 7.057l-16 16c-0.52 0.52-0.52 1.365 0 1.885s1.365 0.52 1.885 0l16-16c0.52-0.52 0.52-1.365 0-1.885s-1.365-0.52-1.885 0z"},null,-1),P("path",{d:"M7.057 8.943l16 16c0.52 0.52 1.365 0.52 1.885 0s0.52-1.365 0-1.885l-16-16c-0.52-0.52-1.365-0.52-1.885 0s-0.52 1.365 0 1.885z"},null,-1)];var TC=mC({},[["render",function(e,t){return w(),A("svg",IC,MC)}]]);const CC={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32",class:"dp__icon"},SC=[P("path",{d:"M20.943 23.057l-7.057-7.057c0 0 7.057-7.057 7.057-7.057 0.52-0.52 0.52-1.365 0-1.885s-1.365-0.52-1.885 0l-8 8c-0.521 0.521-0.521 1.365 0 1.885l8 8c0.52 0.52 1.365 0.52 1.885 0s0.52-1.365 0-1.885z"},null,-1)];var EC=mC({},[["render",function(e,t){return w(),A("svg",CC,SC)}]]);const kC={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32",class:"dp__icon"},bC=[P("path",{d:"M12.943 24.943l8-8c0.521-0.521 0.521-1.365 0-1.885l-8-8c-0.52-0.52-1.365-0.52-1.885 0s-0.52 1.365 0 1.885l7.057 7.057c0 0-7.057 7.057-7.057 7.057-0.52 0.52-0.52 1.365 0 1.885s1.365 0.52 1.885 0z"},null,-1)];var DC=mC({},[["render",function(e,t){return w(),A("svg",kC,bC)}]]);const wC={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32",class:"dp__icon"},AC=[P("path",{d:"M16 1.333c-8.095 0-14.667 6.572-14.667 14.667s6.572 14.667 14.667 14.667c8.095 0 14.667-6.572 14.667-14.667s-6.572-14.667-14.667-14.667zM16 4c6.623 0 12 5.377 12 12s-5.377 12-12 12c-6.623 0-12-5.377-12-12s5.377-12 12-12z"},null,-1),P("path",{d:"M14.667 8v8c0 0.505 0.285 0.967 0.737 1.193l5.333 2.667c0.658 0.329 1.46 0.062 1.789-0.596s0.062-1.46-0.596-1.789l-4.596-2.298c0 0 0-7.176 0-7.176 0-0.736-0.597-1.333-1.333-1.333s-1.333 0.597-1.333 1.333z"},null,-1)];var RC=mC({},[["render",function(e,t){return w(),A("svg",wC,AC)}]]);const LC={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32",class:"dp__icon"},OC=[P("path",{d:"M24.943 19.057l-8-8c-0.521-0.521-1.365-0.521-1.885 0l-8 8c-0.52 0.52-0.52 1.365 0 1.885s1.365 0.52 1.885 0l7.057-7.057c0 0 7.057 7.057 7.057 7.057 0.52 0.52 1.365 0.52 1.885 0s0.52-1.365 0-1.885z"},null,-1)];var NC=mC({},[["render",function(e,t){return w(),A("svg",LC,OC)}]]);const PC={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32",class:"dp__icon"},UC=[P("path",{d:"M7.057 12.943l8 8c0.521 0.521 1.365 0.521 1.885 0l8-8c0.52-0.52 0.52-1.365 0-1.885s-1.365-0.52-1.885 0l-7.057 7.057c0 0-7.057-7.057-7.057-7.057-0.52-0.52-1.365-0.52-1.885 0s-0.52 1.365 0 1.885z"},null,-1)];var xC=mC({},[["render",function(e,t){return w(),A("svg",PC,UC)}]]);const GC=(e,t)=>{const n=Se(e,t.slice(0,e.length),new Date);return Ee(n)&&ke(n)?n:null},FC=e=>{let t=new Date(JSON.parse(JSON.stringify(e)));return t=be(t,0),t=De(t,0),t=we(t,0),t=je(t,0),t},VC=e=>Array.isArray(e)?Ee(e[0])&&(!e[1]||Ee(e[1])):!!e&&Ee(e),qC=(e,t,n,i)=>{let r=e?new Date(e):new Date;return(t||0===t)&&(r=be(r,+t)),(n||0===n)&&(r=De(r,+n)),(i||0===i)&&(r=we(r,+i)),je(r,0)},BC=e=>{const t=i(e,1);return{month:ye(t),year:_e(t)}},HC=(e,t,n)=>{let i=e?new Date(e):new Date;return(t||0===t)&&(i=ve(i,t)),n&&(i=me(i,n)),i},jC=(e,t)=>e?"HH:mm"+(t?":ss":""):`hh:mm${t?":ss":""} aa`,KC=(e,t,n,i,r,o,a,s)=>e||(i?"MM/yyyy":r?jC(t,n):o?"MM/dd/yyyy":a?"yyyy":s?`MM/dd/yyyy, ${jC(t,n)}`:"MM/dd/yyyy"),zC=e=>{const t=e||new Date;return{hours:Ie(t),minutes:Me(t),seconds:Te(t)}},WC=e=>({month:ye(e),year:_e(e)}),YC=e=>Array.isArray(e)?[WC(e[0]),e[1]?WC(e[1]):null]:WC(e),$C=e=>Array.isArray(e)?[zC(e[0]),zC(e[1])]:zC(e),JC=(e,t,n)=>n?Ae(e,t,{locale:n}):Ae(e,t),XC=(e,t,n,i)=>Array.isArray(e)?`${JC(e[0],t,n)} ${i||"-"} ${e[1]?JC(e[1],t,n):""}`:JC(e,t,n),ZC=(e,t)=>!(!e||!t)&&Be(FC(e),FC(t)),QC=(e,t)=>!(!e||!t)&&He(FC(e),FC(t)),eS=(t,i)=>!(!t||!i)&&function(t,i){e(2,arguments);var r=n(t),o=n(i);return r.getTime()===o.getTime()}(FC(t),FC(i)),tS=(e,t)=>Ge(Ce(new Date,e),t),nS=(e,t)=>We(Ce(new Date,e),t),iS=e=>Ce(new Date,{hours:Ie(e),minutes:Me(e),seconds:Te(e)}),rS=e=>Ce(new Date,{hours:+e.hours||0,minutes:+e.minutes||0,seconds:+e.seconds||0}),oS=(e,t,n)=>{let i=!0;if(!e)return!0;const r=Array.isArray(e)?[e[0]?iS(e[0]):null,e[1]?iS(e[1]):null]:iS(e);if(t){const e=rS(t);i=Array.isArray(r)?(!r[0]||r[0].getTime()<=e.getTime())&&(!r[1]||r[1].getTime()<=e.getTime()):r.getTime()<=e.getTime()}if(n){const e=rS(n);i=Array.isArray(r)?(!r[0]||r[0].getTime()>=e.getTime())&&(!r[1]||r[1].getTime()>=e.getTime())&&i:r.getTime()>=e.getTime()&&i}return i},aS=e=>{const t=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());return new Date(t).toISOString()},sS=(e,t,n)=>e&&e[0]&&e[1]?ZC(n,e[0])&&QC(n,e[1]):!!(e&&e[0]&&t)&&(ZC(n,e[0])&&QC(n,t)||QC(n,e[0])&&ZC(n,t)),cS=(i,r)=>[Fe(i,{weekStartsOn:r}),function(i,r){var a,s,c,u,l,d,p,h;e(1,arguments);var f=o(),g=t(null!==(a=null!==(s=null!==(c=null!==(u=null==r?void 0:r.weekStartsOn)&&void 0!==u?u:null==r||null===(l=r.locale)||void 0===l||null===(d=l.options)||void 0===d?void 0:d.weekStartsOn)&&void 0!==c?c:f.weekStartsOn)&&void 0!==s?s:null===(p=f.locale)||void 0===p||null===(h=p.options)||void 0===h?void 0:h.weekStartsOn)&&void 0!==a?a:0);if(!(g>=0&&g<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var m=n(i),v=m.getDay(),_=6+(v<g?-7:0)-(v-g);return m.setDate(m.getDate()+_),m.setHours(23,59,59,999),m}(i,{weekStartsOn:r})],uS=(e,t,n,i,r,o,a)=>({validate:s=>((e,t,n,i,r,o,a,s)=>{const c=!!n&&ZC(aS(e),aS(new Date(n))),u=!!t&&QC(aS(e),aS(new Date(t))),l="function"==typeof i?i(e):i.some((t=>eS(aS(new Date(t)),aS(e)))),d=(o.months.length?o.months.map((e=>+e)):[]).includes(ye(e)),p=!!a.length&&a.some((t=>+t===Re(e))),h=!!r.length&&!r.some((t=>eS(aS(new Date(t)),aS(e)))),f=_e(e),g=f<+s[0]||f>+s[1];return!(c||u||l||d||g||p||h)})(s,e,t,n,i,r,o,a)}),lS=(e,t,n,i)=>{const o=[],a=new Date(t,e),s=new Date(t,e+1,0),c=Fe(a,{weekStartsOn:n}),u=t=>{const n=((e,t,n)=>{const i=new Date(JSON.parse(JSON.stringify(e))),o=[];for(let a=0;a<7;a++){const e=r(i,a),s=ye(e)!==t;o.push({text:n&&s?"":e.getDate(),value:e,current:!s})}return o})(t,e,i);if(o.push({days:n}),!o[o.length-1].days.some((e=>eS(FC(e.value),FC(s))))){const e=r(t,7);u(e)}};return u(c),o},dS=e=>function(t){let n="";const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let e=0;e<t;e++)n+=i.charAt(Math.floor(62*Math.random()));return n+e}(5),pS=e=>{var t;const n=H(e);return null!=(t=null==n?void 0:n.$el)?t:n},hS=e=>Object.assign({menuAppear:"dp-menu-appear",open:"dp-slide-down",close:"dp-slide-up",next:"calendar-next",previous:"calendar-prev",vNext:"dp-slide-up",vPrevious:"dp-slide-down"},e),fS=Symbol(),gS=Symbol(),mS=Symbol(),vS=Symbol(),_S=Symbol(),yS=Symbol(),IS={disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},autoApply:{type:Boolean,default:!1},inline:{type:Boolean,default:!1},textInput:{type:Boolean,default:!1}},MS={range:{type:Boolean,default:!1},uid:{type:String,default:null}},TS={enableSeconds:{type:Boolean,default:!1},is24:{type:Boolean,default:!0},noHoursOverlay:{type:Boolean,default:!1},noMinutesOverlay:{type:Boolean,default:!1},noSecondsOverlay:{type:Boolean,default:!1},hoursGridIncrement:{type:[String,Number],default:1},minutesGridIncrement:{type:[String,Number],default:5},secondsGridIncrement:{type:[String,Number],default:5},hoursIncrement:{type:[Number,String],default:1},minutesIncrement:{type:[Number,String],default:1},secondsIncrement:{type:[Number,String],default:1}},CS=gC(fC({},TS),{fixedStart:{type:Boolean,default:!1},fixedEnd:{type:Boolean,default:!1},timePicker:{type:Boolean,default:!1}}),SS={name:{type:String,default:null},placeholder:{type:String,default:""},hideInputIcon:{type:Boolean,default:!1},clearable:{type:Boolean,default:!0},state:{type:Boolean,default:null},required:{type:Boolean,default:!1},autocomplete:{type:String,default:"off"},inputClassName:{type:String,default:null},inlineWithInput:{type:Boolean,default:!1},textInputOptions:{type:Object,default:()=>null},openMenuOnFocus:{type:Boolean,default:!0}},ES={minTime:{type:Object,default:null},maxTime:{type:Object,default:null}},kS={minDate:{type:[Date,String],default:null},maxDate:{type:[Date,String],default:null}},bS=fC({selectText:{type:String,default:"Select"},cancelText:{type:String,default:"Cancel"},previewFormat:{type:[String,Function],default:()=>""},multiDates:{type:Boolean,default:!1}},ES),DS={monthPicker:{type:Boolean,default:!1},customProps:{type:Object,default:null},yearPicker:{type:Boolean,default:!1}},wS={locale:{type:String,default:"en-Us"},weekNumName:{type:String,default:"W"},weekStart:{type:[Number,String],default:1},weekNumbers:{type:Boolean,default:!1},calendarClassName:{type:String,default:null},noSwipe:{type:Boolean,default:!1}},AS=gC(fC(fC(fC(fC(fC(fC({},CS),bS),DS),kS),wS),MS),{vertical:{type:Boolean,default:!1},disableMonthYearSelect:{type:Boolean,default:!1},menuClassName:{type:String,default:null},yearRange:{type:Array,default:()=>[1900,2100]},multiCalendarsSolo:{type:Boolean,default:!1},calendarCellClassName:{type:String,default:null},enableTimePicker:{type:Boolean,default:!0},autoApply:{type:Boolean,default:!1},disabledDates:{type:[Array,Function],default:()=>[]},monthNameFormat:{type:String,default:"short"},startDate:{type:[Date,String],default:null},startTime:{type:[Object,Array],default:null},monthYearComponent:{type:Object,default:null},timePickerComponent:{type:Object,default:null},actionRowComponent:{type:Object,default:null},hideOffsetDates:{type:Boolean,default:!1},autoRange:{type:[Number,String],default:null},noToday:{type:Boolean,default:!1},disabledWeekDays:{type:Array,default:()=>[]},allowedDates:{type:Array,default:()=>[]},showNowButton:{type:Boolean,default:!1},nowButtonLabel:{type:String,default:"Now"},monthChangeOnScroll:{type:[Boolean,String],default:!0},markers:{type:Array,default:()=>[]},modeHeight:{type:[Number,String],default:255},escClose:{type:Boolean,default:!0},spaceConfirm:{type:Boolean,default:!0},monthChangeOnArrows:{type:Boolean,default:!0},presetRanges:{type:Array,default:()=>[]},flow:{type:Array,default:()=>[]},preventMinMaxNavigation:{type:Boolean,default:!1},minRange:{type:[Number,String],default:null},maxRange:{type:[Number,String],default:null},multiDatesLimit:{type:[Number,String],default:null},reverseYears:{type:Boolean,default:!1},keepActionRow:{type:Boolean,default:!1},weekPicker:{type:Boolean,default:!1},filters:{type:Object,default:()=>({})},arrowNavigation:{type:Boolean,default:!1},multiStatic:{type:Boolean,default:!0}}),RS=gC(fC(fC(fC({},SS),IS),AS),{multiCalendars:{type:[Boolean,Number,String],default:null},modelValue:{type:[String,Date,Array,Object,Number],default:null},position:{type:String,default:"center"},dark:{type:Boolean,default:!1},format:{type:[String,Function],default:()=>null},closeOnScroll:{type:Boolean,default:!1},autoPosition:{type:Boolean,default:!0},closeOnAutoApply:{type:Boolean,default:!0},teleport:{type:[String,Object],default:"body"},altPosition:{type:[Boolean,Function],default:!1},partialRange:{type:Boolean,default:!0},transitions:{type:[Boolean,Object],default:!0},formatLocale:{type:Object,default:null},utc:{type:Boolean,default:!1},ariaLabels:{type:Object,default:()=>({})}}),LS={range:{type:Boolean,default:!1},multiCalendars:{type:Number,default:0},internalModelValue:{type:[Date,Array],default:null}},OS=gC(fC(fC({},DS),LS),{vertical:{type:Boolean,default:!1},month:{type:Number,default:0},year:{type:Number,default:0},instance:{type:Number,default:1}}),NS=E({menuFocused:!1,shiftKeyInMenu:!1}),PS=()=>({setMenuFocused:e=>{NS.menuFocused=e},getStore:()=>NS,setShiftKey:e=>{NS.shiftKeyInMenu!==e&&(NS.shiftKeyInMenu=e)}}),US=["aria-label","aria-disabled","aria-readonly"],xS={key:1,class:"dp__input_wrap"},GS=["id","name","placeholder","disabled","readonly","required","value","autocomplete","onKeydown"],FS={key:4,class:"dp__clear_icon"},VS=S({props:gC(fC(fC(fC({},SS),IS),MS),{inputValue:{type:String,default:""},inline:{type:Boolean,default:!1},isMenuOpen:{type:Boolean,default:!1},pattern:{type:String,default:""}}),emits:["clear","open","update:inputValue","setInputDate","close","selectDate","setEmptyDate","toggle","focus-prev"],setup(e,{expose:t,emit:n}){const i=e,r=f(),o=f(null),a=f(!1),s=l(fS),c=ae(),{getStore:u}=PS(),d=g((()=>({dp__pointer:!i.disabled&&!i.readonly&&!i.textInput,dp__disabled:i.disabled,dp__input:!0,dp__input_icon_pad:!i.hideInputIcon,dp__input_valid:i.state,dp__input_invalid:!1===i.state,dp__input_focus:a.value||i.isMenuOpen,[i.inputClassName]:!!i.inputClassName}))),p=e=>{const{value:t}=e.target,{format:o,rangeSeparator:a}=i.textInputOptions;if(""!==t){if(i.range){const[e,n]=t.split(`${a}`);if(e&&n){const t=GC(e.trim(),o||i.pattern),a=GC(n.trim(),o||i.pattern);r.value=t&&a?[t,a]:null}}else r.value=GC(t,o||i.pattern);n("setInputDate",r.value)}else n("setInputDate",null),i.autoApply&&(n("setEmptyDate"),r.value=null);n("update:inputValue",t)},h=()=>{var e,t;(null==(e=i.textInputOptions)?void 0:e.enterSubmit)&&VC(r.value)&&""!==i.inputValue?(n("setInputDate",r.value,!0),r.value=null):(null==(t=i.textInputOptions)?void 0:t.enterSubmit)&&""===i.inputValue&&(r.value=null,n("clear"))},m=()=>{var e,t;(null==(e=i.textInputOptions)?void 0:e.tabSubmit)&&VC(r.value)&&""!==i.inputValue?(n("setInputDate",r.value,!0),r.value=null):(null==(t=i.textInputOptions)?void 0:t.tabSubmit)&&""===i.inputValue&&(r.value=null,n("clear")),n("close")},v=()=>{var e;if(u().shiftKeyInMenu&&i.openMenuOnFocus)return n("close"),n("focus-prev");!i.inline&&(!i.textInput||i.textInput&&(null==(e=i.textInputOptions)?void 0:e.openMenu))&&(a.value=!0,i.openMenuOnFocus&&!i.isMenuOpen?n("open"):i.isMenuOpen&&!u().menuFocused&&(M(),n("close")))},_=()=>{var e;!i.openMenuOnFocus||c["dp-input"]||c.trigger?i.textInput&&(null==(e=i.textInputOptions)?void 0:e.openMenu)&&!i.isMenuOpen?n("open"):i.textInput||n("toggle"):i.textInput||a.value&&n("toggle")},y=()=>{a.value=!1,i.autoApply&&i.textInput&&r.value&&(n("setInputDate",r.value),n("selectDate"),r.value=null)},I=()=>{n("clear")},M=()=>{a.value=!1;const e=pS(o);e&&e.blur()};return t({unFocus:M}),(t,i)=>(w(),A("div",{onClick:_,"aria-label":H(s).input,role:"textbox","aria-multiline":"false","aria-disabled":t.disabled,"aria-readonly":t.readonly},[!t.$slots.trigger||t.$slots["dp-input"]||e.inline?O("",!0):X(t.$slots,"trigger",{key:0}),t.$slots.trigger||e.inline&&!t.inlineWithInput?O("",!0):(w(),A("div",xS,[!t.$slots["dp-input"]||t.$slots.trigger||e.inline?O("",!0):X(t.$slots,"dp-input",{key:0,value:e.inputValue,onInput:p,onEnter:h,onTab:m,onClear:I}),t.$slots["dp-input"]?O("",!0):(w(),A("input",{key:1,ref_key:"inputRef",ref:o,id:t.uid?`dp-input-${t.uid}`:void 0,name:t.name,class:G(H(d)),placeholder:t.placeholder,disabled:t.disabled,readonly:t.readonly||!t.textInput,required:t.required,value:e.inputValue,autocomplete:t.autocomplete,onInput:p,onKeydown:[Q(h,["enter"]),Q(m,["tab"])],onBlur:y,onFocus:v},null,42,GS)),t.$slots["input-icon"]&&!t.hideInputIcon?(w(),A("span",{key:2,class:"dp__input_icon",onClick:i[0]||(i[0]=e=>n("toggle"))},[X(t.$slots,"input-icon")])):O("",!0),t.$slots["input-icon"]||t.hideInputIcon||t.$slots["dp-input"]?O("",!0):(w(),j(H(yC),{key:3,class:"dp__input_icon dp__input_icons",onClick:i[1]||(i[1]=e=>n("toggle"))})),t.$slots["clear-icon"]&&e.inputValue&&t.clearable&&!t.disabled&&!t.readonly?(w(),A("span",FS,[X(t.$slots,"clear-icon",{clear:I})])):O("",!0),!t.clearable||t.$slots["clear-icon"]||!e.inputValue||t.disabled||t.readonly?O("",!0):(w(),j(H(TC),{key:5,class:"dp__clear_icon dp__input_icons",onClick:x(I,["stop","prevent"])},null,8,["onClick"]))]))],8,US))}}),qS=E({monthYear:[],calendar:[],time:[],actionRow:[],selectionGrid:[],timePicker:{0:[],1:[]},monthPicker:[]}),BS=f(null),HS=f(!1),jS=f(!1),KS=f(!1),zS=f(!1),WS=f(0),YS=f(0),$S=()=>{const e=g((()=>HS.value?[...qS.selectionGrid,qS.actionRow].filter((e=>e.length)):jS.value?[...qS.timePicker[0],...qS.timePicker[1],zS.value?[]:[BS.value],qS.actionRow].filter((e=>e.length)):KS.value?[...qS.monthPicker,qS.actionRow]:[qS.monthYear,...qS.calendar,qS.time,qS.actionRow].filter((e=>e.length)))),t=t=>{WS.value=t?WS.value+1:WS.value-1;let n=null;e.value[YS.value]&&(n=e.value[YS.value][WS.value]),n||(WS.value=t?WS.value-1:WS.value+1)},n=t=>{0===YS.value&&!t||YS.value===e.value.length&&t||(YS.value=t?YS.value+1:YS.value-1,e.value[YS.value]?e.value[YS.value]&&!e.value[YS.value][WS.value]&&0!==WS.value&&(WS.value=e.value[YS.value].length-1):YS.value=t?YS.value-1:YS.value+1)},i=t=>{let n=null;e.value[YS.value]&&(n=e.value[YS.value][WS.value]),n?n.focus({preventScroll:!HS.value}):WS.value=t?WS.value-1:WS.value+1},r=()=>{WS.value=0,YS.value=0};return{buildMatrix:(e,t)=>{qS[t]=e},buildMultiLevelMatrix:(e,t)=>{qS[t]=e},setTimePickerBackRef:e=>{BS.value=e},setSelectionGrid:e=>{HS.value=e,r(),e||(qS.selectionGrid=[])},setTimePicker:(e,t=!1)=>{jS.value=e,zS.value=t,r(),e||(qS.timePicker[0]=[],qS.timePicker[1]=[])},setTimePickerElements:(e,t=0)=>{qS.timePicker[t]=e},arrowRight:()=>{t(!0),i(!0)},arrowLeft:()=>{t(!1),i(!1)},arrowUp:()=>{n(!1),i(!0)},arrowDown:()=>{n(!0),i(!0)},clearArrowNav:()=>{qS.monthYear=[],qS.calendar=[],qS.time=[],qS.actionRow=[],qS.selectionGrid=[],qS.timePicker[0]=[],qS.timePicker[1]=[],HS.value=!1,jS.value=!1,zS.value=!1,KS.value=!1,r(),BS.value=null},setMonthPicker:e=>{KS.value=e,r()}}},JS=["aria-label"],XS={class:"dp__calendar_header",role:"row"},ZS={key:0,class:"dp__calendar_header_item",role:"gridcell"},QS=P("div",{class:"dp__calendar_header_separator"},null,-1),eE=["aria-label"],tE={key:0,role:"gridcell",class:"dp__calendar_item dp__week_num"},nE={class:"dp__cell_inner"},iE=["aria-selected","aria-disabled","onClick","onKeydown","onMouseover"],rE=P("div",{class:"dp__arrow_bottom_tp"},null,-1),oE=S({props:gC(fC(fC({},OS),wS),{mappedDates:{type:Array,default:()=>[]},getWeekNum:{type:Function,default:()=>""},modeHeight:{type:[Number,String],default:255},specificMode:{type:Boolean,default:!1}}),emits:["selectDate","setHoverDate","handleScroll","mount","handleSwipe"],setup(e,{expose:t,emit:n}){const i=e,r=f(null),o=f({bottom:"",left:"",transform:""}),a=f([]),s=f(null),c=f(!0),u=l(gS),p=l(fS),h=l(yS),m=f(""),v=f({startX:0,endX:0,startY:0,endY:0}),y=g((()=>((e,t)=>{const n=[1,2,3,4,5,6,7].map((t=>new Intl.DateTimeFormat(e,{weekday:"short",timeZone:"UTC"}).format(new Date(`2017-01-0${t}T00:00:00+00:00`)).slice(0,2))),i=n.slice(0,t),r=n.slice(t+1,n.length);return[n[t]].concat(...r).concat(...i)})(i.locale,+i.weekStart))),{buildMultiLevelMatrix:I}=$S();d((()=>{n("mount",{cmp:"calendar",refs:a}),i.noSwipe||s.value&&(s.value.addEventListener("touchstart",D),s.value.addEventListener("touchend",F),s.value.addEventListener("touchmove",V))}));const T=g((()=>({dp__calendar_wrap:!0,[i.calendarClassName]:!!i.calendarClassName}))),C=g((()=>e=>{const t=(e=>Object.assign({type:"dot"},e))(e);return{dp__marker_dot:"dot"===t.type,dp__marker_line:"line"===t.type}})),S=g((()=>e=>eS(e,r.value))),E=g((()=>({dp__calendar:!0,dp__calendar_next:i.multiCalendars>0&&0!==i.instance}))),k=g((()=>i.specificMode?{height:`${i.modeHeight}px`}:null)),b=()=>{r.value=null},D=e=>{v.value.startX=e.changedTouches[0].screenX,v.value.startY=e.changedTouches[0].screenY},F=e=>{v.value.endX=e.changedTouches[0].screenX,v.value.endY=e.changedTouches[0].screenY,q()},V=e=>{e.preventDefault()},q=()=>{const e=i.vertical?"Y":"X";Math.abs(v.value[`start${e}`]-v.value[`end${e}`])>10&&n("handleSwipe",v.value[`start${e}`]>v.value[`end${e}`]?"right":"left")};return t({triggerTransition:(e,t)=>{if(null!=u&&u.value){const n=FC(HC(new Date,i.month,i.year));m.value=ZC(FC(HC(new Date,e,t)),n)?u.value[i.vertical?"vNext":"next"]:u.value[i.vertical?"vPrevious":"previous"],c.value=!1,N((()=>{c.value=!0}))}}}),(t,i)=>(w(),A("div",{class:G(H(E))},[P("div",{style:U(H(k))},[e.specificMode?O("",!0):(w(),A("div",{key:0,ref_key:"calendarWrapRef",ref:s,class:G(H(T)),role:"grid","aria-label":H(p).calendarWrap,onWheel:i[1]||(i[1]=x((e=>t.$emit("handleScroll",e)),["prevent"]))},[P("div",XS,[t.weekNumbers?(w(),A("div",ZS,L(t.weekNumName),1)):O("",!0),(w(!0),A(_,null,R(H(y),((e,n)=>(w(),A("div",{class:"dp__calendar_header_item",role:"gridcell",key:n},[t.$slots["calendar-header"]?X(t.$slots,"calendar-header",{key:0,day:e,index:n}):O("",!0),t.$slots["calendar-header"]?O("",!0):(w(),A(_,{key:1},[oe(L(e),1)],64))])))),128))]),QS,M(Y,{name:m.value,css:!!H(u)},{default:K((()=>[c.value?(w(),A("div",{key:0,class:"dp__calendar",role:"grid","aria-label":H(p).calendarDays},[(w(!0),A(_,null,R(e.mappedDates,((s,c)=>(w(),A("div",{class:"dp__calendar_row",role:"row",key:c},[t.weekNumbers?(w(),A("div",tE,[P("div",nE,L(e.getWeekNum(s.days)),1)])):O("",!0),(w(!0),A(_,null,R(s.days,((e,s)=>(w(),A("div",{role:"gridcell",class:"dp__calendar_item",ref_for:!0,ref:e=>((e,t,n)=>{e&&(Array.isArray(a.value[t])?a.value[t][n]=e:a.value[t]=[e]),null!=h&&h.value&&I(a.value,"calendar")})(e,c,s),key:s+c,"aria-selected":e.classData.dp__active_date||e.classData.dp__range_start||e.classData.dp__range_start,"aria-disabled":e.classData.dp__cell_disabled,tabindex:"0",onClick:x((n=>t.$emit("selectDate",e)),["stop","prevent"]),onKeydown:Q((n=>t.$emit("selectDate",e)),["enter"]),onMouseover:t=>((e,t,i)=>{var s,c;if(n("setHoverDate",e),null!=(c=null==(s=e.marker)?void 0:s.tooltip)&&c.length){const n=pS(a.value[t][i]);if(n){const{width:t,height:i}=n.getBoundingClientRect();o.value={bottom:`${i}px`,left:t/2+"px",transform:"translateX(-50%)"},r.value=e.value}}})(e,c,s),onMouseleave:b},[P("div",{class:G(["dp__cell_inner",e.classData])},[t.$slots.day?X(t.$slots,"day",{key:0,day:+e.text,date:e.value}):O("",!0),t.$slots.day?O("",!0):(w(),A(_,{key:1},[oe(L(e.text),1)],64)),e.marker?(w(),A("div",{key:2,class:G(H(C)(e.marker)),style:U(e.marker.color?{backgroundColor:e.marker.color}:{})},null,6)):O("",!0),H(S)(e.value)?(w(),A("div",{key:3,class:"dp__marker_tooltip",style:U(o.value)},[P("div",{class:"dp__tooltip_content",onClick:i[0]||(i[0]=x((()=>{}),["stop"]))},[(w(!0),A(_,null,R(e.marker.tooltip,((n,i)=>(w(),A("div",{key:i,class:"dp__tooltip_text"},[t.$slots["marker-tooltip"]?X(t.$slots,"marker-tooltip",{key:0,tooltop:n,day:e.value}):O("",!0),t.$slots["marker-tooltip"]?O("",!0):(w(),A(_,{key:1},[P("div",{class:"dp__tooltip_mark",style:U(n.color?{backgroundColor:n.color}:{})},null,4),P("div",null,L(n.text),1)],64))])))),128)),rE])],4)):O("",!0)],2)],40,iE)))),128))])))),128))],8,eE)):O("",!0)])),_:3},8,["name","css"])],42,JS))],4)],2))}}),aE=(e,t)=>t,sE=e=>Array.isArray(e),cE=e=>Array.isArray(e),uE=e=>Array.isArray(e)&&2===e.length,lE=e=>"string"==typeof e,dE={class:"dp__selection_preview"},pE={class:"dp__action_buttons"},hE=["onKeydown"],fE=S({props:gC(fC(fC(fC(fC(fC({},bS),kS),ES),DS),LS),{inline:{type:Boolean,default:!1},timePicker:{type:Boolean,default:!1},calendarWidth:{type:Number,default:0},menuMount:{type:Boolean,default:!1},enableTimePicker:{type:Boolean,default:!0}}),emits:["closePicker","selectDate"],setup(e,{emit:t}){const n=e,{buildMatrix:i}=$S(),r=l(_S),o=l(yS),a=f(null),s=f(null);d((()=>{null!=o&&o.value&&i([pS(a),pS(s)],"actionRow")}));const c=g((()=>({dp__action:!0,dp__select:!0,dp__action_disabled:!u.value||!p.value}))),u=g((()=>!n.enableTimePicker||oS(n.internalModelValue,n.maxTime,n.minTime))),p=g((()=>!n.monthPicker||((e,t,n)=>{let i=!0;return t&&n&&(i=ZC(new Date(e),new Date(t))&&QC(new Date(e),new Date(n))),t&&(i=ZC(new Date(e),new Date(t))),n&&(i=QC(new Date(e),new Date(n))),i})(n.internalModelValue,n.minDate,n.maxDate))),h=e=>XC(e,n.previewFormat,null==r?void 0:r.value),m=g((()=>n.internalModelValue&&n.menuMount?"string"==typeof n.previewFormat?sE(n.internalModelValue)?2===n.internalModelValue.length&&n.internalModelValue[1]?n.multiCalendars>0?`${h(n.internalModelValue[0])} - ${h(n.internalModelValue[1])}`:[h(n.internalModelValue[0]),h(n.internalModelValue[1])]:n.multiDates?n.internalModelValue.map((e=>`${h(e)}`)):`${h(n.internalModelValue[0])} -`:XC(n.internalModelValue,n.previewFormat,null==r?void 0:r.value):n.timePicker?n.previewFormat($C(n.internalModelValue)):n.monthPicker?n.previewFormat(WC(n.internalModelValue)):n.previewFormat(n.internalModelValue):"")),v=()=>{u.value&&p.value&&t("selectDate")};return(t,n)=>(w(),A("div",{class:"dp__action_row",style:U(e.calendarWidth?{width:`${e.calendarWidth}px`}:{})},[P("div",dE,[t.$slots["action-preview"]?X(t.$slots,"action-preview",{key:0,value:t.internalModelValue}):O("",!0),t.$slots["action-preview"]?O("",!0):(w(),A(_,{key:1},[Array.isArray(H(m))?O("",!0):(w(),A(_,{key:0},[oe(L(H(m)),1)],64)),Array.isArray(H(m))?(w(!0),A(_,{key:1},R(H(m),((e,t)=>(w(),A("div",{key:t},L(e),1)))),128)):O("",!0)],64))]),P("div",pE,[t.$slots["action-select"]?X(t.$slots,"action-select",{key:0,value:t.internalModelValue}):O("",!0),t.$slots["action-select"]?O("",!0):(w(),A(_,{key:1},[e.inline?O("",!0):(w(),A("span",{key:0,class:"dp__action dp__cancel",ref_key:"cancelButtonRef",ref:a,tabindex:"0",onClick:n[0]||(n[0]=e=>t.$emit("closePicker")),onKeydown:n[1]||(n[1]=Q((e=>t.$emit("closePicker")),["enter"]))},L(t.cancelText),545)),P("span",{class:G(H(c)),tabindex:"0",onKeydown:Q(v,["enter"]),onClick:v,ref_key:"selectButtonRef",ref:s},L(t.selectText),43,hE)],64))])],4))}}),gE={class:"dp__overlay_container",role:"grid"},mE={class:"dp__selection_grid_header"},vE=["aria-selected","aria-disabled","onClick","onKeydown","onMouseover"],_E=["aria-label","onKeydown"],yE=S({props:{items:{type:Array,default:()=>[]},modelValue:{type:[String,Number],default:null},multiModelValue:{type:Array,default:()=>[]},disabledValues:{type:Array,default:()=>[]},minValue:{type:[Number,String],default:null},maxValue:{type:[Number,String],default:null},year:{type:Number,default:0},skipActive:{type:Boolean,default:!1},headerRefs:{type:Array,default:()=>[]},skipButtonRef:{type:Boolean,default:!1}},emits:["update:modelValue","selected","toggle","reset-flow"],setup(e,{expose:t,emit:n}){const i=e,r=f(!1),o=f(null),a=f(null),s=f([]),c=l(mS,!1),u=l(vS,f(!1)),h=l(fS),m=l(yS),v=f(),y=f(),{setSelectionGrid:I,buildMultiLevelMatrix:M,setMonthPicker:T}=$S();ue((()=>{o.value=null})),d((()=>{N().then((()=>x())),S(),C(!0)})),p((()=>C(!1)));const C=e=>{var t;null!=m&&m.value&&(null!=(t=i.headerRefs)&&t.length?T(e):I(e))},S=()=>{const e=pS(a);e&&(u.value||e.focus({preventScroll:!0}),r.value=e.clientHeight<e.scrollHeight)},E=g((()=>({dp__overlay:!0}))),k=g((()=>({dp__overlay_col:!0}))),b=g((()=>i.items.map((e=>e.filter((e=>e)).map((e=>{var t,n,r;const o=i.disabledValues.some((t=>t===e.value))||U(e.value),a=null!=(t=i.multiModelValue)&&t.length?null==(n=i.multiModelValue)?void 0:n.some((t=>eS(t,me(ve(new Date,e.value),i.year)))):!i.skipActive&&e.value===i.modelValue;return gC(fC({},e),{className:{dp__overlay_cell_active:a,dp__overlay_cell:!a,dp__overlay_cell_disabled:o,dp__overlay_cell_active_disabled:o&&a,dp__overlay_cell_pad:!0,dp__cell_in_between:!(null==(r=i.multiModelValue)||!r.length)&&V(e.value)}})})))))),D=g((()=>({dp__button:!0,dp__overlay_action:!0,dp__over_action_scroll:r.value,dp__button_bottom:c}))),U=e=>{const t=!!i.maxValue&&+e>+i.maxValue,n=!!i.minValue&&+e<+i.minValue;return t||n},x=()=>{const e=pS(o);if(e){const t=pS(a);t&&(t.scrollTop=e.offsetTop-t.offsetTop-(t.getBoundingClientRect().height/2-e.getBoundingClientRect().height))}},F=e=>{!i.disabledValues.some((t=>t===e))&&(!i.minValue||+i.minValue<=e)&&(!i.maxValue||+i.maxValue>=e)&&(n("update:modelValue",e),n("selected"))},V=e=>sS(i.multiModelValue,me(ve(new Date,v.value||0),i.year),me(ve(new Date,e),i.year)),q=()=>{n("toggle"),n("reset-flow")};return t({focusGrid:S}),(t,n)=>(w(),A("div",{ref_key:"gridWrapRef",ref:a,class:G(H(E)),role:"dialog",tabindex:"0"},[P("div",gE,[P("div",mE,[X(t.$slots,"header")]),(w(!0),A(_,null,R(H(b),((n,r)=>(w(),A("div",{class:"dp__overlay_row",key:H(dS)(r),role:"row"},[(w(!0),A(_,null,R(n,((n,a)=>(w(),A("div",{role:"gridcell",class:G(H(k)),key:n.value,"aria-selected":n.value===e.modelValue&&!e.disabledValues.includes(n.value),"aria-disabled":n.className.dp__overlay_cell_disabled,ref_for:!0,ref:e=>((e,t,n,r)=>{var a,c;if(e&&(t.value===+i.modelValue&&!i.disabledValues.includes(t.value)&&(o.value=e),null!=m&&m.value)){Array.isArray(s.value[n])?s.value[n][r]=e:s.value[n]=[e];const t=null!=(a=i.headerRefs)&&a.length?[i.headerRefs].concat(s.value):s.value.concat([i.skipButtonRef?[]:[y.value]]);M(t,null!=(c=i.headerRefs)&&c.length?"monthPicker":"selectionGrid")}})(e,n,r,a),tabindex:"0",onClick:e=>F(n.value),onKeydown:Q((e=>F(n.value)),["enter"]),onMouseover:e=>v.value=n.value},[P("div",{class:G(n.className)},[t.$slots.item?X(t.$slots,"item",{key:0,item:n}):O("",!0),t.$slots.item?O("",!0):(w(),A(_,{key:1},[oe(L(n.text),1)],64))],2)],42,vE)))),128))])))),128)),t.$slots["button-icon"]?(w(),A("div",{key:0,role:"button","aria-label":H(h).toggleOverlay,class:G(H(D)),tabindex:"0",ref_key:"toggleButton",ref:y,onClick:q,onKeydown:Q(q,["enter"])},[X(t.$slots,"button-icon")],42,_E)):O("",!0)])],2))}}),IE=()=>{const e=l(gS);return{transitionName:g((()=>t=>null!=e&&e.value?t?e.value.open:e.value.close:"")),showTransition:!(null==e||!e.value)}},ME={key:0,class:"dp__time_input"},TE=oe(" : "),CE=["aria-label","onKeydown","onClick"],SE=["aria-label","onKeydown","onClick"],EE=["aria-label","onKeydown","onClick"],kE={key:0},bE=["aria-label","onKeydown"],DE=S({props:gC(fC({},TS),{hours:{type:Number,default:0},minutes:{type:Number,default:0},seconds:{type:Number,default:0},filters:{type:Object,default:()=>({})},disabled:{type:Boolean,default:!1},closeTimePickerBtn:{type:Object,default:null},order:{type:Number,default:0}}),emits:["setHours","setMinutes","update:hours","update:minutes","update:seconds","reset-flow","mounted","overlay-closed"],setup(e,{expose:t,emit:n}){const i=e,r=E({hours:!1,minutes:!1,seconds:!1}),o=f("AM"),a=f(null),s=l(fS),c=l(yS),u=f([]),{transitionName:p,showTransition:h}=IE(),{setTimePickerElements:m,setTimePickerBackRef:v}=$S();d((()=>{n("mounted")}));const y=g((()=>({dp__time_col:!0,dp__time_col_reg:!i.enableSeconds&&i.is24,dp__time_col_reg_with_button:!i.enableSeconds&&!i.is24,dp__time_col_sec:i.enableSeconds&&i.is24,dp__time_col_sec_with_button:i.enableSeconds&&!i.is24}))),I=g((()=>{const e=[{type:"hours"},"separator",{type:"minutes"}];return i.enableSeconds?e.concat(["separator",{type:"seconds"}]):e})),M=g((()=>I.value.filter((e=>"string"!=typeof e)))),T=g((()=>e=>{if("hours"===e){const e=D(i.hours);return{text:e<10?`0${e}`:`${e}`,value:e}}return{text:i[e]<10?`0${i[e]}`:`${i[e]}`,value:i[e]}})),C=e=>{const t="hours"===e?i.is24?24:12:60,n=+i[`${e}GridIncrement`],r=[];for(let i=0;i<t;i+=n)r.push({value:i,text:i<10?`0${i}`:`${i}`});return((e,t=3)=>{const n=[];for(let i=0;i<e.length;i+=t)n.push([e[i],e[i+1],e[i+2]]);return n})(r)},S=e=>i[`no${e[0].toUpperCase()+e.slice(1)}Overlay`],k=e=>{S(e)||(r[e]=!r[e],r[e]||n("overlay-closed"))},b=(e,t=!0)=>{n(`update:${e}`,("hours"===e?Ie:"minutes"===e?Me:Te)((t?tS:nS)({[e]:+i[e]},{[e]:+i[`${e}Increment`]})))},D=e=>i.is24?e:(o.value=e>=12?"PM":"AM",(e=>[12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11][e])(e)),N=()=>{"PM"===o.value?(o.value="AM",n("update:hours",i.hours-12)):(o.value="PM",n("update:hours",i.hours+12))},U=(e,t,n)=>{if(e&&(null==c?void 0:c.value)){Array.isArray(u.value[t])?u.value[t][n]=e:u.value[t]=[e];let r=u.value.reduce(((e,t)=>t.map(((n,i)=>[...e[i]||[],t[i]]))),[]);v(i.closeTimePickerBtn),a.value&&(r[1]=r[1].concat(a.value)),m(r,i.order)}};return t({openChildCmp:e=>{r[e]=!0}}),(t,c)=>e.disabled?O("",!0):(w(),A("div",ME,[(w(!0),A(_,null,R(H(I),((e,n)=>(w(),A("div",{key:n,class:G(H(y))},["separator"===e?(w(),A(_,{key:0},[TE],64)):(w(),A(_,{key:1},[P("div",{class:"dp__inc_dec_button",role:"button","aria-label":H(s).incrementValue(e.type),tabindex:"0",onKeydown:Q((t=>b(e.type)),["enter"]),onClick:t=>b(e.type),ref_for:!0,ref:e=>U(e,n,0)},[t.$slots["arrow-up"]?X(t.$slots,"arrow-up",{key:0}):O("",!0),t.$slots["arrow-up"]?O("",!0):(w(),j(H(NC),{key:1}))],40,CE),P("div",{role:"button","aria-label":H(s).openTpOverlay(e.type),class:G(S(e.type)?"":"dp__time_display"),tabindex:"0",onKeydown:Q((t=>k(e.type)),["enter"]),onClick:t=>k(e.type),ref_for:!0,ref:e=>U(e,n,1)},[t.$slots[e.type]?X(t.$slots,e.type,{key:0,text:H(T)(e.type).text,value:H(T)(e.type).value}):O("",!0),t.$slots[e.type]?O("",!0):(w(),A(_,{key:1},[oe(L(H(T)(e.type).text),1)],64))],42,SE),P("div",{class:"dp__inc_dec_button",role:"button","aria-label":H(s).decrementValue(e.type),tabindex:"0",onKeydown:Q((t=>b(e.type,!1)),["enter"]),onClick:t=>b(e.type,!1),ref_for:!0,ref:e=>U(e,n,2)},[t.$slots["arrow-down"]?X(t.$slots,"arrow-down",{key:0}):O("",!0),t.$slots["arrow-down"]?O("",!0):(w(),j(H(xC),{key:1}))],40,EE)],64))],2)))),128)),t.is24?O("",!0):(w(),A("div",kE,[t.$slots["am-pm-button"]?X(t.$slots,"am-pm-button",{key:0,toggle:N,value:o.value}):O("",!0),t.$slots["am-pm-button"]?O("",!0):(w(),A("button",{key:1,ref_key:"amPmButton",ref:a,type:"button",class:"dp__pm_am_button",role:"button","aria-label":H(s).amPmButton,tabindex:"0",onClick:N,onKeydown:Q(x(N,["prevent"]),["enter"])},L(o.value),41,bE))])),(w(!0),A(_,null,R(H(M),((a,s)=>(w(),j(Y,{key:s,name:H(p)(H(r)[a.type]),css:H(h)},{default:K((()=>[H(r)[a.type]?(w(),j(yE,{key:0,items:C(a.type),"disabled-values":e.filters.times[a.type],"onUpdate:modelValue":e=>((e,t)=>"hours"!==e||i.is24?n(`update:${e}`,t):n(`update:${e}`,"PM"===o.value?t+12:t))(a.type,e),onSelected:e=>k(a.type),onToggle:e=>k(a.type),onResetFlow:c[0]||(c[0]=e=>t.$emit("reset-flow"))},le({"button-icon":K((()=>[t.$slots["clock-icon"]?X(t.$slots,"clock-icon",{key:0}):O("",!0),t.$slots["clock-icon"]?O("",!0):(w(),j(H(RC),{key:1}))])),_:2},[t.$slots[`${a.type}-overlay`]?{name:"item",fn:K((({item:e})=>[X(t.$slots,`${a.type}-overlay`,{text:e.text,value:e.value})]))}:void 0]),1032,["items","disabled-values","onUpdate:modelValue","onSelected","onToggle"])):O("",!0)])),_:2},1032,["name","css"])))),128))]))}}),wE=[{name:"clock-icon",use:["time","calendar"]},{name:"arrow-left",use:["month-year","calendar"]},{name:"arrow-right",use:["month-year","calendar"]},{name:"arrow-up",use:["time","calendar"]},{name:"arrow-down",use:["time","calendar"]},{name:"calendar-icon",use:["month-year","time","calendar"]},{name:"day",use:["calendar"]},{name:"month-overlay",use:["calendar","month-year"]},{name:"year-overlay",use:["calendar","month-year"]},{name:"hours-overlay",use:["calendar","time"]},{name:"minutes-overlay",use:["calendar","time"]},{name:"seconds-overlay",use:["calendar","time"]},{name:"hours",use:["calendar","time"]},{name:"minutes",use:["calendar","time"]},{name:"month",use:["calendar","month-year"]},{name:"year",use:["calendar","month-year"]},{name:"action-select",use:["action"]},{name:"action-preview",use:["action"]},{name:"calendar-header",use:["calendar"]},{name:"marker-tooltip",use:["calendar"]},{name:"now-button",use:[]},{name:"time-picker-overlay",use:["calendar","time"]},{name:"am-pm-button",use:["calendar","time"]}],AE=[{name:"trigger"},{name:"input-icon"},{name:"clear-icon"},{name:"dp-input"}],RE={all:()=>wE,monthYear:()=>wE.filter((e=>e.use.includes("month-year"))),input:()=>AE,timePicker:()=>wE.filter((e=>e.use.includes("time"))),action:()=>wE.filter((e=>e.use.includes("action"))),calendar:()=>wE.filter((e=>e.use.includes("calendar")))},LE=(e,t)=>{const n=[];return RE[t]().forEach((t=>{e[t.name]&&n.push(t.name)})),n},OE=["aria-label"],NE={class:"dp__overlay_container"},PE={key:1,class:"dp__overlay_row"},UE=["aria-label"],xE=S({props:gC(fC({},CS),{range:{type:Boolean,default:!1},filters:{type:Object,default:()=>({})},hours:{type:[Number,Array],default:0},minutes:{type:[Number,Array],default:0},seconds:{type:[Number,Array],default:0},customProps:{type:Object,default:null}}),emits:["update:hours","update:minutes","update:seconds","mount","reset-flow","overlay-closed"],setup(e,{expose:t,emit:n}){const i=e,r=ae(),o=f(null),a=f(null),s=l(mS,!1),c=f([]),u=f(null),p=l(fS),h=l(yS),{transitionName:m,showTransition:v}=IE(),{buildMatrix:y,setTimePicker:I}=$S();d((()=>{n("mount"),!i.timePicker&&(null==h?void 0:h.value)?y([pS(o.value)],"time"):I(!0,i.timePicker)}));const T=f(!1),C=e=>({hours:Array.isArray(i.hours)?i.hours[e]:i.hours,minutes:Array.isArray(i.minutes)?i.minutes[e]:i.minutes,seconds:Array.isArray(i.seconds)?i.seconds[e]:i.seconds}),S=g((()=>{const e=[];if(i.range)for(let t=0;t<2;t++)e.push(C(t));else e.push(C(0));return e})),E=(e,t=!1,i="")=>{t||n("reset-flow"),T.value=e,null!=h&&h.value&&(I(e),e||n("overlay-closed")),N((()=>{""!==i&&c.value[0]&&c.value[0].openChildCmp(i)}))},k=g((()=>({dp__button:!0,dp__button_bottom:s}))),b=LE(r,"timePicker"),D=(e,t,n)=>i.range?0===t?[e,S.value[1][n]]:[S.value[0][n],e]:e,L=e=>{n("update:hours",e)},U=e=>{n("update:minutes",e)},x=e=>{n("update:seconds",e)},F=()=>{u.value&&(null==h?void 0:h.value)&&u.value.focus({preventScroll:!0})};return t({toggleTimePicker:E}),(t,n)=>(w(),A("div",null,[t.timePicker?O("",!0):(w(),A("div",{key:0,class:G(H(k)),role:"button","aria-label":H(p).openTimePicker,tabindex:"0",ref_key:"openTimePickerBtn",ref:o,onKeydown:n[0]||(n[0]=Q((e=>E(!0)),["enter"])),onClick:n[1]||(n[1]=e=>E(!0))},[t.$slots["clock-icon"]?X(t.$slots,"clock-icon",{key:0}):O("",!0),t.$slots["clock-icon"]?O("",!0):(w(),j(H(RC),{key:1}))],42,OE)),M(Y,{name:H(m)(T.value),css:H(v)},{default:K((()=>[T.value||t.timePicker?(w(),A("div",{key:0,class:"dp__overlay",ref_key:"overlayRef",ref:u,tabindex:"0"},[P("div",NE,[t.$slots["time-picker-overlay"]?X(t.$slots,"time-picker-overlay",{key:0,range:e.range,hours:e.hours,minutes:e.minutes,seconds:e.seconds,setHours:L,setMinutes:U,setSeconds:x}):O("",!0),t.$slots["time-picker-overlay"]?O("",!0):(w(),A("div",PE,[(w(!0),A(_,null,R(H(S),((n,i)=>(w(),j(DE,he({key:i,disabled:0===i?t.fixedStart:t.fixedEnd,hours:n.hours,minutes:n.minutes,seconds:n.seconds,filters:e.filters,ref_for:!0,ref_key:"timeInputRefs",ref:c},{is24:t.is24,hoursGridIncrement:t.hoursGridIncrement,minutesGridIncrement:t.minutesGridIncrement,secondsGridIncrement:t.secondsGridIncrement,hoursIncrement:t.hoursIncrement,minutesIncrement:t.minutesIncrement,secondsIncrement:t.secondsIncrement,filters:e.filters,noHoursOverlay:t.noHoursOverlay,noMinutesOverlay:t.noMinutesOverlay,noSecondsOverlay:t.noSecondsOverlay,enableSeconds:t.enableSeconds,closeTimePickerBtn:a.value,order:i},{"onUpdate:hours":e=>L(D(e,i,"hours")),"onUpdate:minutes":e=>U(D(e,i,"minutes")),"onUpdate:seconds":e=>x(D(e,i,"seconds")),onMounted:F,onOverlayClosed:F}),le({_:2},[R(H(b),((e,n)=>({name:e,fn:K((n=>[X(t.$slots,e,de(pe(n)))]))})))]),1040,["disabled","hours","minutes","seconds","filters","onUpdate:hours","onUpdate:minutes","onUpdate:seconds"])))),128))])),t.timePicker?O("",!0):(w(),A("div",{key:2,ref_key:"closeTimePickerBtn",ref:a,class:G(H(k)),role:"button","aria-label":H(p).closeTimePicker,tabindex:"0",onKeydown:n[2]||(n[2]=Q((e=>E(!1)),["enter"])),onClick:n[3]||(n[3]=e=>E(!1))},[t.$slots["calendar-icon"]?X(t.$slots,"calendar-icon",{key:0}):O("",!0),t.$slots["calendar-icon"]?O("",!0):(w(),j(H(yC),{key:1}))],42,UE))])],512)):O("",!0)])),_:3},8,["name","css"])]))}}),GE=["aria-label"],FE=S({props:{ariaLabel:{type:String,default:""}},emits:["activate","setRef"],setup(e,{emit:t}){const n=f(null);return d((()=>t("setRef",n))),(t,i)=>(w(),A("div",{class:"dp__month_year_col_nav",onClick:i[0]||(i[0]=e=>t.$emit("activate")),onKeydown:i[1]||(i[1]=Q((e=>t.$emit("activate")),["enter"])),tabindex:"0",ref_key:"elRef",ref:n},[P("div",{class:"dp__inner_nav",role:"button","aria-label":e.ariaLabel},[X(t.$slots,"default")],8,GE)],544))}}),VE=["aria-label"],qE=S({props:{ariaLabel:{type:String,default:""},showSelectionGrid:{type:Boolean,default:!1},modelValue:{type:Number,default:null},items:{type:Array,default:()=>[]},disabledValues:{type:Array,default:()=>[]},minValue:{type:Number,default:null},maxValue:{type:Number,default:null},slotName:{type:String,default:""},headerRefs:{type:Array,default:()=>[]}},emits:["update:model-value","toggle","setRef"],setup(e,{emit:t}){const{transitionName:n,showTransition:i}=IE(),r=f(null);return d((()=>t("setRef",r))),(t,o)=>(w(),A(_,null,[P("div",{class:"dp__month_year_select",onClick:o[0]||(o[0]=e=>t.$emit("toggle")),onKeydown:o[1]||(o[1]=Q((e=>t.$emit("toggle")),["enter"])),role:"button","aria-label":e.ariaLabel,tabindex:"0",ref_key:"elRef",ref:r},[X(t.$slots,"default")],40,VE),M(Y,{name:H(n)(e.showSelectionGrid),css:H(i)},{default:K((()=>[e.showSelectionGrid?(w(),j(yE,he({key:0},{modelValue:e.modelValue,items:e.items,disabledValues:e.disabledValues,minValue:e.minValue,maxValue:e.maxValue},{"header-refs":[],"onUpdate:modelValue":o[2]||(o[2]=e=>t.$emit("update:model-value",e)),onToggle:o[3]||(o[3]=e=>t.$emit("toggle"))}),le({"button-icon":K((()=>[t.$slots["calendar-icon"]?X(t.$slots,"calendar-icon",{key:0}):O("",!0),t.$slots["calendar-icon"]?O("",!0):(w(),j(H(yC),{key:1}))])),_:2},[t.$slots[e.slotName]?{name:"item",fn:K((({item:n})=>[X(t.$slots,e.slotName,{item:n})]))}:void 0]),1040)):O("",!0)])),_:3},8,["name","css"])],64))}}),BE=(e,t,n)=>[Ce(new Date(e),{date:1}),Ce(new Date,{month:t,year:n,date:1})],HE=(e,t,n)=>QC(...BE(e,t,n))||eS(...BE(e,t,n)),jE=(e,t,n)=>ZC(...BE(e,t,n))||eS(...BE(e,t,n)),KE=(e,t,n,i,r,o)=>{let a=!1;return o?e&&t?(t&&r&&jE(t,n,i)&&(a=!0),e&&!r&&HE(e,n,i)&&(a=!0)):(e&&HE(e,n,i)||t&&jE(t,n,i))&&(a=!0):a=!0,a},zE=(n,r)=>{const o=(e,t)=>{let r=e;return n.filters.months.includes(ye(r))?(r=t?i(e,1):Ke(e,1),o(r,t)):r},a=(i,r)=>{let o=i;return n.filters.years.includes(_e(o))?(o=r?c(i,1):function(n,i){e(2,arguments);var r=t(i);return c(n,-r)}(i,1),a(o,r)):o},s=(e,t)=>{r("update:month",e),r("update:year",t)};return{handleMonthYearChange:e=>{const t=Ce(new Date,{month:n.month,year:n.year});let r=e?i(t,1):Ke(t,1),c=ye(r),u=_e(r);n.filters.months.includes(c)&&(r=o(r,e),c=ye(r),u=_e(r)),n.filters.years.includes(u)&&(r=a(r,e),u=_e(r)),KE(n.minDate,n.maxDate,c,u,e,n.preventMinMaxNavigation)&&s(c,u)}}},WE={class:"dp__month_year_row"},YE={class:"dp__month_picker_header"},$E=["aria-label"],JE=["aria-label","onKeydown"],XE=["aria-label"],ZE=S({props:gC(fC(fC({},OS),kS),{preventMinMaxNavigation:{type:Boolean,default:!1},reverseYears:{type:Boolean,default:!1},years:{type:Array,default:()=>[]},months:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},multiCalendarsSolo:{type:Boolean,default:!1},yearPicker:{type:Boolean,default:!1}}),emits:["update:month","update:year","monthYearSelect","mount","reset-flow","overlay-closed"],setup(e,{expose:t,emit:n}){const i=e,{transitionName:r,showTransition:o}=IE(),{buildMatrix:a}=$S(),s=f(!1),c=f(!1),u=f([null,null,null,null]),p=f(null),h=f(null),m=f(null),v=l(fS),y=l(yS),{handleMonthYearChange:T}=zE(i,n);d((()=>{n("mount")}));const C=e=>({get:()=>i[e],set:t=>{n(`update:${e}`,t),n("monthYearSelect","year"===e),"month"===e?z(!0):W(!0)}}),S=g(C("month")),E=g(C("year")),k=g((()=>e=>{const t="month"===e;return{showSelectionGrid:(t?s:c).value,items:(t?F:V).value,disabledValues:i.filters[t?"months":"years"],minValue:(t?R:b).value,maxValue:(t?N:D).value,headerRefs:t&&i.monthPicker?[p.value,h.value,m.value]:[]}})),b=g((()=>i.minDate?_e(new Date(i.minDate)):null)),D=g((()=>i.maxDate?_e(new Date(i.maxDate)):null)),R=g((()=>{if(i.minDate&&b.value){if(b.value>i.year)return 12;if(b.value===i.year)return ye(new Date(i.minDate))}return null})),N=g((()=>{if(i.maxDate&&D.value){if(D.value<i.year)return-1;if(D.value===i.year)return ye(new Date(i.maxDate))}return null})),U=g((()=>i.range&&i.internalModelValue&&i.monthPicker?i.internalModelValue:[])),x=(e,t=!1)=>{const n=[];for(let i=0;i<e.length;i+=3){const r=[e[i],e[i+1],e[i+2]];n.push(t?r.reverse():r)}return t?n.reverse():n},G=g((()=>i.months.find((e=>e.value===i.month))||{text:"",value:0})),F=g((()=>x(i.months))),V=g((()=>x(i.years,i.reverseYears))),q=g((()=>!i.multiCalendars||(!!i.multiCalendarsSolo||0===i.instance))),B=g((()=>!i.multiCalendars||(!!i.multiCalendarsSolo||i.instance===i.multiCalendars-1))),z=(e=!1)=>{$(e),s.value=!s.value,s.value||n("overlay-closed")},W=(e=!1)=>{$(e),c.value=!c.value,c.value||n("overlay-closed")},$=e=>{e||n("reset-flow")},J=(e=!1)=>{n("update:year",e?i.year+1:i.year-1)},Z=(e,t)=>{null!=y&&y.value&&(u.value[t]=pS(e),a(u.value,"monthYear"))};return t({toggleMonthPicker:z,toggleYearPicker:W}),(t,n)=>(w(),A("div",WE,[t.monthPicker||e.yearPicker?O("",!0):(w(),A(_,{key:0},[H(q)&&!t.vertical?(w(),j(FE,{key:0,"aria-label":H(v).prevMonth,onActivate:n[0]||(n[0]=e=>H(T)(!1)),onSetRef:n[1]||(n[1]=e=>Z(e,0))},{default:K((()=>[t.$slots["arrow-left"]?X(t.$slots,"arrow-left",{key:0}):O("",!0),t.$slots["arrow-left"]?O("",!0):(w(),j(H(EC),{key:1}))])),_:3},8,["aria-label"])):O("",!0),M(qE,he({"aria-label":H(v).openMonthsOverlay,"slot-name":"month-overlay",modelValue:H(S),"onUpdate:modelValue":n[2]||(n[2]=e=>I(S)?S.value=e:null)},H(k)("month"),{onToggle:z,onSetRef:n[3]||(n[3]=e=>Z(e,1))}),le({default:K((()=>[t.$slots.month?X(t.$slots,"month",de(he({key:0},H(G)))):O("",!0),t.$slots.month?O("",!0):(w(),A(_,{key:1},[oe(L(H(G).text),1)],64))])),_:2},[t.$slots["calendar-icon"]?{name:"calendar-icon",fn:K((()=>[X(t.$slots,"calendar-icon")]))}:void 0,t.$slots["month-overlay"]?{name:"month-overlay",fn:K((({item:e})=>[X(t.$slots,"month-overlay",{text:e.text,value:e.value})]))}:void 0]),1040,["aria-label","modelValue"]),M(qE,he({"aria-label":H(v).openYearsOverlay,"slot-name":"year-overlay",modelValue:H(E),"onUpdate:modelValue":n[4]||(n[4]=e=>I(E)?E.value=e:null)},H(k)("year"),{onToggle:W,onSetRef:n[5]||(n[5]=e=>Z(e,2))}),le({default:K((()=>[t.$slots.year?X(t.$slots,"year",{key:0,year:t.year}):O("",!0),t.$slots.year?O("",!0):(w(),A(_,{key:1},[oe(L(t.year),1)],64))])),_:2},[t.$slots["calendar-icon"]?{name:"calendar-icon",fn:K((()=>[X(t.$slots,"calendar-icon")]))}:void 0,t.$slots["year-overlay"]?{name:"year-overlay",fn:K((({item:e})=>[X(t.$slots,"year-overlay",{text:e.text,value:e.value})]))}:void 0]),1040,["aria-label","modelValue"]),H(q)&&t.vertical?(w(),j(FE,{key:1,"aria-label":H(v).prevMonth,onActivate:n[6]||(n[6]=e=>H(T)(!1))},{default:K((()=>[t.$slots["arrow-up"]?X(t.$slots,"arrow-up",{key:0}):O("",!0),t.$slots["arrow-up"]?O("",!0):(w(),j(H(NC),{key:1}))])),_:3},8,["aria-label"])):O("",!0),H(B)?(w(),j(FE,{key:2,"arial-label":H(v).nextMonth,onActivate:n[7]||(n[7]=e=>H(T)(!0)),ref:"rightIcon",onSetRef:n[8]||(n[8]=e=>Z(e,3))},{default:K((()=>[t.$slots[t.vertical?"arrow-down":"arrow-right"]?X(t.$slots,t.vertical?"arrow-down":"arrow-right",{key:0}):O("",!0),t.$slots[t.vertical?"arrow-down":"arrow-right"]?O("",!0):(w(),j(se(t.vertical?H(xC):H(DC)),{key:1}))])),_:3},8,["arial-label"])):O("",!0)],64)),t.monthPicker?(w(),j(yE,he({key:1},H(k)("month"),{"skip-active":i.range,year:t.year,"multi-model-value":H(U),modelValue:H(S),"onUpdate:modelValue":n[15]||(n[15]=e=>I(S)?S.value=e:null),onToggle:z,onSelected:n[16]||(n[16]=e=>t.$emit("overlay-closed"))}),le({header:K((()=>[P("div",YE,[P("div",{class:"dp__month_year_col_nav",tabindex:"0",ref_key:"mpPrevIconRef",ref:p,onClick:n[9]||(n[9]=e=>J(!1)),onKeydown:n[10]||(n[10]=Q((e=>J(!1)),["enter"]))},[P("div",{class:"dp__inner_nav",role:"button","aria-label":H(v).prevMonth},[t.$slots["arrow-left"]?X(t.$slots,"arrow-left",{key:0}):O("",!0),t.$slots["arrow-left"]?O("",!0):(w(),j(H(EC),{key:1}))],8,$E)],544),P("div",{class:"dp__pointer",role:"button",ref_key:"mpYearButtonRef",ref:h,"aria-label":H(v).openYearsOverlay,tabindex:"0",onClick:W,onKeydown:Q(W,["enter"])},[t.$slots.year?X(t.$slots,"year",{key:0,year:t.year}):O("",!0),t.$slots.year?O("",!0):(w(),A(_,{key:1},[oe(L(t.year),1)],64))],40,JE),P("div",{class:"dp__month_year_col_nav",tabindex:"0",ref_key:"mpNextIconRef",ref:m,onClick:n[11]||(n[11]=e=>J(!0)),onKeydown:n[12]||(n[12]=Q((e=>J(!0)),["enter"]))},[P("div",{class:"dp__inner_nav",role:"button","aria-label":H(v).nextMonth},[t.$slots["arrow-right"]?X(t.$slots,"arrow-right",{key:0}):O("",!0),t.$slots["arrow-right"]?O("",!0):(w(),j(H(DC),{key:1}))],8,XE)],544)]),M(Y,{name:H(r)(c.value),css:H(o)},{default:K((()=>[c.value?(w(),j(yE,he({key:0},H(k)("year"),{modelValue:H(E),"onUpdate:modelValue":n[13]||(n[13]=e=>I(E)?E.value=e:null),onToggle:W,onSelected:n[14]||(n[14]=e=>t.$emit("overlay-closed"))}),le({"button-icon":K((()=>[t.$slots["calendar-icon"]?X(t.$slots,"calendar-icon",{key:0}):O("",!0),t.$slots["calendar-icon"]?O("",!0):(w(),j(H(yC),{key:1}))])),_:2},[t.$slots["year-overlay"]?{name:"item",fn:K((({item:e})=>[X(t.$slots,"year-overlay",{text:e.text,value:e.value})]))}:void 0]),1040,["modelValue"])):O("",!0)])),_:3},8,["name","css"])])),_:2},[t.$slots["month-overlay"]?{name:"item",fn:K((({item:e})=>[X(t.$slots,"month-overlay",{text:e.text,value:e.value})]))}:void 0]),1040,["skip-active","year","multi-model-value","modelValue"])):O("",!0),e.yearPicker?(w(),j(yE,he({key:2},H(k)("year"),{modelValue:H(E),"onUpdate:modelValue":n[17]||(n[17]=e=>I(E)?E.value=e:null),"skip-button-ref":"",onToggle:W,onSelected:n[18]||(n[18]=e=>t.$emit("overlay-closed"))}),le({_:2},[t.$slots["year-overlay"]?{name:"item",fn:K((({item:e})=>[X(t.$slots,"year-overlay",{text:e.text,value:e.value})]))}:void 0]),1040,["modelValue"])):O("",!0)]))}}),QE=(t,o,c,u)=>{const l=f(new Date),p=f(),h=f([{month:ye(new Date),year:_e(new Date)}]),m=f(t.range?[Ie(new Date),Ie(new Date)]:Ie(new Date)),_=f(t.range?[Me(new Date),Me(new Date)]:Me(new Date)),y=f(t.range?[0,0]:0);v(h,(()=>{setTimeout((()=>{t.openOnTop&&o("dpOpen")}),0)}),{deep:!0}),d((()=>{L(),b.value||(t.startDate&&(h.value[0].month=ye(new Date(t.startDate)),h.value[0].year=_e(new Date(t.startDate)),t.multiCalendars&&x(0)),t.startTime&&k())}));const I=g((()=>e=>h.value[e]?h.value[e].month:0)),M=g((()=>e=>h.value[e]?h.value[e].year:0)),T=(e,t,n)=>{h.value[e].month=t,h.value[e].year=n},C=(e,t)=>h.value[e].month=t,S=(e,t)=>h.value[e].year=t,E=(e=!0)=>t.enableSeconds?Array.isArray(y.value)?e?y.value[0]:y.value[1]:y.value:0,k=()=>{t.startTime&&((e=>Array.isArray(e))(t.startTime)?(m.value=[+t.startTime[0].hours,+t.startTime[1].hours],_.value=[+t.startTime[0].minutes,+t.startTime[1].minutes],t.enableSeconds&&(y.value=[+t.startTime[0].seconds,+t.startTime[1].seconds])):(m.value=+t.startTime.hours,_.value=+t.startTime.minutes,t.enableSeconds&&(y.value=+t.startTime.seconds)))},b=g({get:()=>t.internalModelValue,set:e=>{!t.readonly&&!t.disabled&&o("update:internalModelValue",e)}});v(b,(()=>L()));const D=e=>{const{validate:n}=uS(t.minDate,t.maxDate,t.disabledDates,t.allowedDates,t.filters,t.disabledWeekDays,t.yearRange);return!n(e)},w=e=>!(!b.value||t.hideOffsetDates&&!e.current||t.range)&&(t.multiDates&&Array.isArray(b.value)?b.value.some((t=>eS(t,e.value))):eS(e.value,b.value?b.value:l.value)),A=e=>{if((!t.multiCalendars||!t.multiStatic)&&(C(0,ye(e)),S(0,_e(e))),t.multiCalendars)for(let n=1;n<=t.multiCalendars;n++){const e=Ge(Ce(new Date,{month:I.value(n-1),year:M.value(n-1)}),{months:1});h.value[n]={month:ye(e),year:_e(e)}}},R=e=>{A(e),m.value=Ie(e),_.value=Me(e),y.value=Te(e)},L=()=>{if(b.value)if(sE(b.value)){if(2!==b.value.length||t.multiDates){if(sE(b.value)&&t.multiDates){const e=b.value[b.value.length-1];e&&R(e)}}else A(b.value[0]),m.value=[Ie(b.value[0]),b.value[1]?Ie(b.value[1]):Ie(new Date)],_.value=[Me(b.value[0]),b.value[1]?Me(b.value[1]):Me(new Date)],y.value=[Te(b.value[0]),b.value[1]?Te(b.value[1]):Te(new Date)];t.multiCalendars&&t.multiCalendarsSolo&&(()=>{if(Array.isArray(b.value)&&2===b.value.length){const e=new Date(b.value[1]?b.value[1]:i(b.value[0],1)),[n,r]=[ye(b.value[0]),_e(b.value[0])],[o,a]=[ye(b.value[1]),_e(b.value[1])];(n!==o||n===o&&r!==a)&&t.multiCalendarsSolo&&(C(1,ye(e)),S(1,_e(e)))}})()}else R(b.value);else t.timePicker?(k(),t.range?cE(m.value)&&cE(_.value)&&(b.value=[qC(new Date,m.value[0],_.value[0],E()),qC(new Date,m.value[1],_.value[1],E(!1))]):b.value=qC(new Date,m.value,_.value,E())):t.monthPicker&&!t.range?b.value=HC(new Date,I.value(0),M.value(0)):t.multiCalendars?A(new Date):t.yearPicker&&(b.value=new Date)},O=n=>{if(Array.isArray(b.value)&&b.value[0]){const i=function(t,n){e(2,arguments);var i=a(t),r=a(n),o=i.getTime()-s(i),c=r.getTime()-s(r);return Math.round((o-c)/864e5)}(n,b.value[0]),r=Math.abs(i<0?i+1:i-1);if(t.minRange&&t.maxRange)return r>=+t.minRange&&r<=+t.maxRange;if(t.minRange)return r>=+t.minRange;if(t.maxRange)return r<=+t.maxRange}return!0},P=()=>{t.autoApply&&o("autoApply")},U=t=>!function(t,i){var r;e(1,arguments);var o=t||{},a=n(o.start),s=n(o.end).getTime();if(!(a.getTime()<=s))throw new RangeError("Invalid interval");var c=[],u=a;u.setHours(0,0,0,0);var l=Number(null!==(r=null==i?void 0:i.step)&&void 0!==r?r:1);if(l<1||isNaN(l))throw new RangeError("`options.step` must be a number greater than 1");for(;u.getTime()<=s;)c.push(n(u)),u.setDate(u.getDate()+l),u.setHours(0,0,0,0);return c}({start:t[0],end:t[1]}).some((e=>D(e))),x=e=>{for(let t=e-1;t>=0;t--){const e=Ke(Ce(new Date,{month:I.value(t+1),year:M.value(t+1)}),1);T(t,ye(e),_e(e))}for(let n=e+1;n<=t.multiCalendars-1;n++){const e=i(Ce(new Date,{month:I.value(n-1),year:M.value(n-1)}),1);T(n,ye(e),_e(e))}},G=e=>HC(new Date,I.value(e),M.value(e)),F=e=>qC(e,m.value,_.value,E()),V=e=>{sE(e)&&sE(b.value)&&cE(m.value)&&cE(_.value)?(e[0]&&b.value[0]&&(b.value[0]=qC(e[0],m.value[0],_.value[0],E())),e[1]&&b.value[1]&&(b.value[1]=qC(e[1],m.value[1],_.value[1],E(!1)))):t.multiDates&&Array.isArray(b.value)?b.value[b.value.length-1]=F(e):!t.range&&!uE(e)&&(b.value=F(e)),o("timeUpdate")},q=(e,n=!0)=>(t.range||t.weekPicker)&&uE(b.value)?!(t.hideOffsetDates&&!e.current)&&eS(new Date(e.value),b.value[n?0:1]):!!t.range&&(eS(new Date(e.value),b.value&&Array.isArray(b.value)?n?b.value[0]||null:b.value[1]:null)&&(!n||!QC(p.value||null,Array.isArray(b.value)?b.value[0]:null))||eS(e.value,Array.isArray(b.value)?b.value[0]:null)&&(e=>!(aE(b.value,t.range)&&b.value[0]&&p.value)||(e?ZC(p.value,b.value[0]):QC(p.value,b.value[0])))(n)),B=(e,n)=>{const r=Ce(new Date,{month:I.value(n),year:M.value(n)}),o=e<0?i(r,1):Ke(r,1);KE(t.minDate,t.maxDate,ye(o),_e(o),e<0,t.preventMinMaxNavigation)&&(T(n,ye(o),_e(o)),t.multiCalendars&&!t.multiCalendarsSolo&&x(n),j())},H=(e,t)=>{B("right"===e?-1:1,t)},j=e=>{e||0===e?u.value[e].triggerTransition(I.value(e),M.value(e)):u.value.forEach(((e,t)=>e.triggerTransition(I.value(t),M.value(t))))};return{today:l,hours:m,minutes:_,seconds:y,month:I,year:M,monthYearSelect:(e=!1)=>{e&&t.yearPicker&&(b.value=me(new Date,h.value[0].year),t.autoApply&&o("autoApply")),t.autoApply&&t.monthPicker&&N().then((()=>{t.range?o("autoApply",e||!b.value||1===b.value.length):o("autoApply",e)}))},isDisabled:D,updateTime:(e,n=!0,i=!1)=>{const r=n?e:m.value,o=n||i?_.value:e,a=i?e:y.value;if(t.range&&uE(b.value)&&cE(r)&&cE(o)&&cE(a)){const e=e=>qC(b.value[e],r[e],o[e],a[e]),t=e=>je(b.value[e],0);if(eS(b.value[0],b.value[1])&&(Be(e(0),t(1))||He(e(1),t(0))))return}if(m.value=r,_.value=o,y.value=a,b.value)if(t.multiDates){const e=Array.isArray(b.value)&&b.value.length?b.value[b.value.length-1]:null;e&&V(e)}else V(b.value);else t.timePicker&&V(t.range?[new Date,new Date]:new Date);c()},setHoverDate:e=>{!e.current&&t.hideOffsetDates||(p.value=e.value)},getWeekNum:t=>{const i=t.find((e=>e.current));return i?function(t){e(1,arguments);var i=n(t),r=Ve(i).getTime()-qe(i).getTime();return Math.round(r/6048e5)+1}(i.value):""},selectDate:(e,n=!1)=>{if(!D(e.value)&&(e.current||!t.hideOffsetDates)){if(t.weekPicker)return b.value=cS(new Date(e.value),+t.weekStart),P();if(t.range||cE(m.value)||cE(_.value)){if(cE(m.value)&&cE(_.value)&&!t.multiDates){let i=b.value?b.value.slice():[];if(2===i.length&&!(t.fixedStart||t.fixedEnd)&&(i=[]),t.autoRange){const o=[new Date(e.value),r(new Date(e.value),+t.autoRange)];U(o)&&(n&&(e=>{const n=ye(new Date(e)),i=_e(new Date(e));if(C(0,n),S(0,i),t.multiCalendars>0)for(let r=1;r<t.multiCalendars;r++){const t=BC(Ce(new Date(e),{year:I.value(r-1),month:M.value(r-1)}));C(r,t.month),S(r,t.year)}})(e.value),i=o)}else t.fixedStart||t.fixedEnd?i=(e=>Array.isArray(b.value)&&2===b.value.length?t.fixedStart&&(ZC(e,b.value[0])||eS(e,b.value[0]))?[b.value[0],e]:t.fixedEnd&&(QC(e,b.value[1])||eS(e,b.value[1]))?[e,b.value[1]]:b.value:[])(new Date(e.value)):i[0]?O(new Date(e.value))&&(QC(new Date(e.value),new Date(i[0]))?i.unshift(new Date(e.value)):i[1]=new Date(e.value)):i[0]=new Date(e.value);i.length&&(i[0]&&!i[1]?i[0]=qC(i[0],m.value[0],_.value[0],E()):(i[0]=qC(i[0],m.value[0],_.value[0],E()),i[1]=qC(i[1],m.value[1],_.value[1],E(!1)),c()),b.value=i,i[0]&&i[1]&&t.autoApply&&o("autoApply"))}}else{const n=qC(new Date(e.value),m.value,_.value,E());t.multiDates?(e=>{if(b.value&&Array.isArray(b.value))if(b.value.some((t=>eS(e,t)))){const t=b.value.filter((t=>!eS(t,e)));b.value=t.length?t:null}else(t.multiDatesLimit&&+t.multiDatesLimit>b.value.length||!t.multiDatesLimit)&&b.value.push(e);else b.value=[e]})(n):b.value=n,c(),P()}}},rangeActive:e=>sS(b.value,p.value,e.value),isActiveDate:w,updateMonthYear:(e,n,i=!0)=>{if(i?C(e,n):S(e,n),t.multiCalendars&&!t.multiCalendarsSolo&&x(e),t.monthPicker)if(t.range){if(i){let t=b.value?b.value.slice():[];2===t.length&&null!==t[1]&&(t=[]),t.length?QC(G(e),t[0])?t.unshift(G(e)):t[1]=G(e):t=[G(e)],b.value=t}}else b.value=G(e);c(),o("updateMonthYear",{instance:e,value:n,isMonth:i}),j(t.multiCalendarsSolo?e:void 0)},isHoverRangeEnd:e=>{if(t.autoRange||t.weekPicker){if(p.value){if(t.hideOffsetDates&&!e.current)return!1;const n=r(p.value,+t.autoRange),i=cS(new Date(p.value),+t.weekStart);return t.weekPicker?eS(i[1],new Date(e.value)):eS(n,new Date(e.value))}return!1}return!1},isAutoRangeInBetween:e=>{if(t.autoRange||t.weekPicker){if(p.value){const n=r(p.value,+t.autoRange);if(t.hideOffsetDates&&!e.current)return!1;const i=cS(new Date(p.value),+t.weekStart);return t.weekPicker?ZC(e.value,i[0])&&QC(e.value,i[1]):ZC(e.value,p.value)&&QC(e.value,n)}return!1}return!1},isAutoRangeStart:e=>{if(t.autoRange||t.weekPicker){if(p.value){if(t.hideOffsetDates&&!e.current)return!1;const n=cS(new Date(p.value),+t.weekStart);return t.weekPicker?eS(n[0],e.value):eS(p.value,e.value)}return!1}return!1},clearHoverDate:()=>{p.value=null},rangeActiveStartEnd:q,handleScroll:(e,n)=>{t.monthChangeOnScroll&&B("inverse"!==t.monthChangeOnScroll?-e.deltaY:e.deltaY,n)},getMarker:e=>t.markers.find((t=>eS(aS(new Date(e.value)),aS(new Date(t.date))))),handleArrow:(e,n,i=!1)=>{t.monthChangeOnArrows&&t.vertical===i&&H(e,n)},handleSwipe:H,selectCurrentDate:()=>{t.range?aE(b.value,t.range)&&(b.value&&b.value[0]?b.value=QC(new Date,b.value[0])?[new Date,b.value[0]]:[b.value[0],new Date]:b.value=[new Date]):o("update:internalModelValue",new Date),t.autoApply&&o("selectDate")},isHoverDate:(e,n)=>!(Array.isArray(t.internalModelValue)&&t.internalModelValue.length||t.weekPicker)&&!(e||w(n)||!n.current&&t.hideOffsetDates||t.range&&(q(n)||q(n,!1))),isHoverDateStartEnd:(e,n,i)=>!(!Array.isArray(t.internalModelValue)||!t.internalModelValue[0]||1!==t.internalModelValue.length)&&(!e&&(i?ZC(t.internalModelValue[0],n.value):QC(t.internalModelValue[0],n.value))),presetDateRange:e=>{e.length&&e.length<=2&&t.range&&(b.value=e.map((e=>new Date(e))),t.autoApply&&o("selectDate"))}}},ek=["id","aria-label","onKeydown"],tk={key:0,class:"dp__preset_ranges"},nk=["onClick"],ik={key:1,class:"dp__now_wrap"},rk=S({props:gC(fC(fC(fC({},AS),MS),IS),{internalModelValue:{type:[Date,Array],default:null},multiCalendars:{type:Number,default:0},openOnTop:{type:Boolean,default:!1}}),emits:["update:internalModelValue","closePicker","selectDate","dpOpen","autoApply","timeUpdate","flow-step","updateMonthYear"],setup(e,{emit:t}){const n=e,i=ae(),r=f(null),o=E({timePicker:!(n.enableTimePicker&&!n.timePicker&&!n.monthPicker),monthYearInput:!!n.timePicker,calendar:!1}),a=f([]),s=f([]),c=f(null),u=f(null),h=f(0),m=f(!1),v=f(0),y=l(gS),I=l(fS),T=l(yS),{setMenuFocused:C,setShiftKey:S}=PS();d((()=>{var e;m.value=!0,null!=(e=n.presetRanges)&&e.length||Oe();const t=pS(u);if(t&&!n.textInput&&!n.inline&&(C(!0),U()),t){const e=e=>{e.stopImmediatePropagation(),e.stopPropagation()};t.addEventListener("pointerdown",e),t.addEventListener("mousedown",e)}document.addEventListener("resize",Oe)})),p((()=>{document.removeEventListener("resize",Oe)}));const{arrowRight:k,arrowLeft:b,arrowDown:D,arrowUp:N}=$S(),U=()=>{const e=pS(u);e&&e.focus({preventScroll:!0})},F=()=>{v.value=-1},{updateTime:V,updateMonthYear:q,today:B,month:z,year:W,hours:$,minutes:J,seconds:Z,isDisabled:ee,isActiveDate:te,selectDate:ne,getWeekNum:ie,setHoverDate:re,isHoverRangeEnd:oe,isAutoRangeInBetween:ce,isAutoRangeStart:ue,rangeActive:fe,clearHoverDate:ge,rangeActiveStartEnd:me,monthYearSelect:ve,handleScroll:_e,handleArrow:ye,handleSwipe:Ie,getMarker:Me,selectCurrentDate:Te,isHoverDateStartEnd:Ce,isHoverDate:Se,presetDateRange:Ee}=QE(n,t,(()=>{var e;(null==(e=n.flow)?void 0:e.length)&&-1!==v.value&&(v.value+=1,t("flow-step",v.value),$e())}),s),ke=LE(i,"calendar"),be=LE(i,"action"),De=LE(i,"timePicker"),we=LE(i,"monthYear"),Ae=g((()=>n.openOnTop?"dp__arrow_bottom":"dp__arrow_top")),Re=g((()=>(e=>{const t=[];for(let n=+e[0];n<=+e[1];n++)t.push({value:+n,text:`${n}`});return t})(n.yearRange))),Le=g((()=>((e,t)=>{const n=new Intl.DateTimeFormat(e,{month:t,timeZone:"UTC"});return[1,2,3,4,5,6,7,8,9,10,11,12].map((e=>new Date(`2017-${e<10?`0${e}`:e}-01T00:00:00+00:00`))).map(((e,t)=>({text:n.format(e),value:t})))})(n.locale,n.monthNameFormat))),Oe=()=>{const e=pS(r);e&&(h.value=e.getBoundingClientRect().width)},Ne=g((()=>e=>lS(z.value(e),W.value(e),+n.weekStart,n.hideOffsetDates))),Pe=g((()=>n.multiCalendars>0&&n.range?[...Array(n.multiCalendars).keys()]:[0])),Ue=g((()=>e=>1===e)),xe=g((()=>n.monthPicker||n.timePicker||n.yearPicker)),Ge=g((()=>({dp__flex_display:n.multiCalendars>0}))),Fe=g((()=>({dp__instance_calendar:n.multiCalendars>0}))),Ve=g((()=>({dp__menu_disabled:n.disabled,dp__menu_readonly:n.readonly}))),qe=g((()=>e=>je(Ne,e))),Be=g((()=>({locale:n.locale,weekNumName:n.weekNumName,weekStart:n.weekStart,weekNumbers:n.weekNumbers,customProps:n.customProps,calendarClassName:n.calendarClassName,specificMode:xe.value,getWeekNum:ie,multiCalendars:n.multiCalendars,modeHeight:n.modeHeight,internalModelValue:n.internalModelValue,noSwipe:n.noSwipe,vertical:n.vertical}))),He=g((()=>({dp__menu:!0,dp__menu_index:!n.inline,dp__relative:n.inline,[n.menuClassName]:!!n.menuClassName}))),je=(e,t)=>e.value(t).map((e=>gC(fC({},e),{days:e.days.map((e=>{const t=ee(e.value),i=Se(t,e),r=!(!n.range&&!n.weekPicker||n.multiCalendars>0&&!e.current||t||!e.current&&n.hideOffsetDates||te(e))&&fe(e);return e.marker=Me(e),e.classData={dp__cell_offset:!e.current,dp__pointer:!(t||!e.current&&n.hideOffsetDates),dp__active_date:!n.range&&te(e),dp__date_hover:i,dp__date_hover_start:Ce(i,e,!0),dp__date_hover_end:Ce(i,e,!1),dp__range_between:r&&!n.weekPicker,dp__range_between_week:r&&n.weekPicker,dp__today:!n.noToday&&eS(e.value,B.value)&&e.current,dp__cell_disabled:t,dp__cell_auto_range:ce(e),dp__cell_auto_range_start:ue(e),dp__cell_auto_range_end:oe(e),dp__range_start:n.multiCalendars>0?e.current&&me(e):me(e),dp__range_end:n.multiCalendars>0?e.current&&me(e,!1):me(e,!1),[n.calendarCellClassName]:!!n.calendarCellClassName},e}))}))),Ke=e=>{e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation()},ze=()=>{n.escClose&&t("closePicker")},We=e=>{e.stopImmediatePropagation(),e.preventDefault(),n.spaceConfirm&&t("selectDate")},Ye=e=>{var t;null!=(t=n.flow)&&t.length&&(o[e]=!0,Object.keys(o).filter((e=>!o[e])).length||$e())},$e=()=>{"month"===n.flow[v.value]&&a.value[0]&&a.value[0].toggleMonthPicker(!0),"year"===n.flow[v.value]&&a.value&&a.value[0].toggleYearPicker(!0),"calendar"===n.flow[v.value]&&c.value&&c.value.toggleTimePicker(!1,!0),"time"===n.flow[v.value]&&c.value&&c.value.toggleTimePicker(!0,!0);const e=n.flow[v.value];("hours"===e||"minutes"===e||"seconds"===e)&&c.value&&c.value.toggleTimePicker(!0,!0,e)},Je=e=>{if(null!=T&&T.value){if("up"===e)return N();if("down"===e)return D();if("left"===e)return b();if("right"===e)return k()}else"left"===e||"up"===e?ye("left",0,"up"===e):ye("right",0,"down"===e)},Xe=e=>{S(e.shiftKey)};return(t,n)=>(w(),j(Y,{appear:"",name:H(y).menuAppear,mode:"out-in",css:!!H(y)},{default:K((()=>[P("div",{id:t.uid?`dp-menu-${t.uid}`:void 0,tabindex:"0",ref_key:"dpMenuRef",ref:u,role:"dialog","aria-label":H(I).menu,class:G(H(He)),onMouseleave:n[11]||(n[11]=(...e)=>H(ge)&&H(ge)(...e)),onClick:Ke,onKeydown:[Q(ze,["esc"]),Q(We,["space"]),n[12]||(n[12]=Q(x((e=>Je("left")),["prevent"]),["left"])),n[13]||(n[13]=Q(x((e=>Je("up")),["prevent"]),["up"])),n[14]||(n[14]=Q(x((e=>Je("down")),["prevent"]),["down"])),n[15]||(n[15]=Q(x((e=>Je("right")),["prevent"]),["right"])),Xe]},[(t.disabled||t.readonly)&&t.inline?(w(),A("div",{key:0,class:G(H(Ve))},null,2)):O("",!0),t.inline?O("",!0):(w(),A("div",{key:1,class:G(H(Ae))},null,2)),P("div",{class:G(t.presetRanges.length?"dp__menu_content_wrapper":null)},[t.presetRanges.length?(w(),A("div",tk,[(w(!0),A(_,null,R(t.presetRanges,((e,t)=>(w(),A("div",{key:t,class:"dp__preset_range",onClick:t=>H(Ee)(e.range)},L(e.label),9,nk)))),128))])):O("",!0),P("div",{class:"dp__instance_calendar",ref_key:"calendarWrapperRef",ref:r,role:"document"},[P("div",{class:G(H(Ge))},[(w(!0),A(_,null,R(H(Pe),((i,r)=>(w(),A("div",{key:i,class:G(H(Fe))},[t.disableMonthYearSelect||t.timePicker?O("",!0):(w(),j(se(t.monthYearComponent?t.monthYearComponent:ZE),he({key:0,ref_for:!0,ref:e=>{e&&(a.value[r]=e)}},{months:H(Le),years:H(Re),filters:t.filters,monthPicker:t.monthPicker,month:H(z)(i),year:H(W)(i),customProps:t.customProps,multiCalendars:e.multiCalendars,multiCalendarsSolo:t.multiCalendarsSolo,instance:i,minDate:t.minDate,maxDate:t.maxDate,preventMinMaxNavigation:t.preventMinMaxNavigation,internalModelValue:e.internalModelValue,range:t.range,reverseYears:t.reverseYears,vertical:t.vertical,yearPicker:t.yearPicker},{onMount:n[0]||(n[0]=e=>Ye("monthYearInput")),onResetFlow:F,"onUpdate:month":e=>H(q)(i,e,!0),"onUpdate:year":e=>H(q)(i,e,!1),onMonthYearSelect:H(ve),onOverlayClosed:U}),le({_:2},[R(H(we),((e,n)=>({name:e,fn:K((n=>[X(t.$slots,e,de(pe(n)))]))})))]),1040,["onUpdate:month","onUpdate:year","onMonthYearSelect"])),M(oE,he({ref_for:!0,ref:e=>{e&&(s.value[r]=e)}},H(Be),{"flow-step":v.value,"onUpdate:flow-step":n[1]||(n[1]=e=>v.value=e),instance:i,"mapped-dates":H(qe)(i),month:H(z)(i),year:H(W)(i),onSelectDate:e=>H(ne)(e,!H(Ue)(i)),onSetHoverDate:n[2]||(n[2]=e=>H(re)(e)),onHandleScroll:e=>H(_e)(e,i),onHandleSwipe:e=>H(Ie)(e,i),onMount:n[3]||(n[3]=e=>Ye("calendar")),onResetFlow:F}),le({_:2},[R(H(ke),((e,n)=>({name:e,fn:K((n=>[X(t.$slots,e,de(pe(fC({},n))))]))})))]),1040,["flow-step","instance","mapped-dates","month","year","onSelectDate","onHandleScroll","onHandleSwipe"])],2)))),128))],2),P("div",null,[!t.enableTimePicker||t.monthPicker||t.weekPicker?O("",!0):(w(),j(se(t.timePickerComponent?t.timePickerComponent:xE),he({key:0,ref_key:"timePickerRef",ref:c},{is24:t.is24,hoursIncrement:t.hoursIncrement,minutesIncrement:t.minutesIncrement,hoursGridIncrement:t.hoursGridIncrement,secondsIncrement:t.secondsIncrement,minutesGridIncrement:t.minutesGridIncrement,secondsGridIncrement:t.secondsGridIncrement,noHoursOverlay:t.noHoursOverlay,noMinutesOverlay:t.noMinutesOverlay,noSecondsOverlay:t.noSecondsOverlay,range:t.range,filters:t.filters,timePicker:t.timePicker,hours:H($),minutes:H(J),seconds:H(Z),customProps:t.customProps,enableSeconds:t.enableSeconds,fixedStart:t.fixedStart,fixedEnd:t.fixedEnd},{onMount:n[4]||(n[4]=e=>Ye("timePicker")),"onUpdate:hours":n[5]||(n[5]=e=>H(V)(e)),"onUpdate:minutes":n[6]||(n[6]=e=>H(V)(e,!1)),"onUpdate:seconds":n[7]||(n[7]=e=>H(V)(e,!1,!0)),onResetFlow:F,onOverlayClosed:U}),le({_:2},[R(H(De),((e,n)=>({name:e,fn:K((n=>[X(t.$slots,e,de(pe(n)))]))})))]),1040))])],512),t.showNowButton?(w(),A("div",ik,[t.$slots["now-button"]?X(t.$slots,"now-button",{key:0,selectCurrentDate:H(Te)}):O("",!0),t.$slots["now-button"]?O("",!0):(w(),A("button",{key:1,type:"button",role:"button",class:"dp__now_button",onClick:n[8]||(n[8]=(...e)=>H(Te)&&H(Te)(...e))},L(t.nowButtonLabel),1))])):O("",!0)],2),!t.autoApply||t.keepActionRow?(w(),j(se(t.actionRowComponent?t.actionRowComponent:fE),he({key:2},{calendarWidth:h.value,selectText:t.selectText,cancelText:t.cancelText,internalModelValue:e.internalModelValue,range:t.range,previewFormat:t.previewFormat,inline:t.inline,monthPicker:t.monthPicker,timePicker:t.timePicker,customProps:t.customProps,multiCalendars:e.multiCalendars,menuMount:m.value,maxTime:t.maxTime,minTime:t.minTime,enableTimePicker:t.enableTimePicker,minDate:t.minDate,maxDate:t.maxDate,multiDates:t.multiDates},{onClosePicker:n[9]||(n[9]=e=>t.$emit("closePicker")),onSelectDate:n[10]||(n[10]=e=>t.$emit("selectDate"))}),le({_:2},[R(H(be),((e,n)=>({name:e,fn:K((n=>[X(t.$slots,e,de(pe(fC({},n))))]))})))]),1040)):O("",!0)],42,ek)])),_:3},8,["name","css"]))}});var ok,ak=((ok=ak||{}).center="center",ok.left="left",ok.right="right",ok);const sk=(e,t,n,i,r,o,a,s,c,u,l,d,p,h,g)=>{const m=f(""),_=f();v(_,(()=>{g("internalModelChange",_.value)}));const y=()=>{if(_.value)if(e&&"string"!=typeof e)m.value=e(t?$C(_.value):n?YC(_.value):_.value);else{const i=KC(e,o,s,n,t,d,p,a);Array.isArray(_.value)&&u?m.value=_.value.map((e=>XC(e,i,null==c?void 0:c.value))).join("; "):m.value=XC(_.value,i,null==c?void 0:c.value,null==h?void 0:h.rangeSeparator)}else m.value=""};return{parseExternalModelValue:e=>{let o=null;e?t?(e=>Array.isArray(e)&&2===e.length)(e)&&"hours"in e[0]&&"minutes"in e[0]?o=[qC(null,+e[0].hours,+e[0].minutes,+e[0].seconds),qC(null,+e[1].hours,+e[1].minutes,+e[1].seconds)]:(e=>"object"==typeof e)(e)&&(o=qC(null,+e.hours,+e.minutes,+e.seconds)):n?(e=>Array.isArray(e))(e)&&"month"in e[0]&&"year"in e[0]?(o=[HC(null,+e[0].month,+e[0].year)],e[1]?o[1]=HC(null,+e[1].month,+e[1].year):!e[1]&&r&&(o[1]=null)):(e=>"object"==typeof e)(e)&&"month"in e&&"year"in e&&(o=HC(null,+e.month,+e.year)):p?o=me(new Date,e):u&&Array.isArray(e)?o=e.map((e=>new Date(e))):d&&Array.isArray(e)?o=[new Date(e[0]),new Date(e[1])]:i?((e,t)=>t?Array.isArray(e):uE(e))(e,r)&&(o=[new Date(e[0]),e[1]?new Date(e[1]):null]):(e=>"string"==typeof e||"object"==typeof e)(e)&&(o=new Date(e)):o=null,VC(o)?(_.value=o,y()):(_.value=null,m.value="")},formatInputValue:y,internalModelValue:_,inputValue:m,emitModelValue:()=>{if(n)g("update:modelValue",YC(_.value));else if(t)g("update:modelValue",$C(_.value));else if(d)g("update:modelValue",_.value);else if(p)g("update:modelValue",_e(_.value));else{_.value&&i&&r&&1===_.value.length&&_.value.push(null);const e=l?Array.isArray(_.value)?_.value.map((e=>e&&aS(e))):aS(_.value):_.value;g("update:modelValue",e)}y()},checkBeforeEmit:()=>!!_.value&&(i?r?_.value.length>=1:2===_.value.length:!!_.value)}},ck=typeof window<"u"?window:void 0,uk=()=>{},lk=(e,t,n,i)=>{if(!e)return uk;let r=uk;const o=v((()=>H(e)),(e=>{r(),e&&(e.addEventListener(t,n,i),r=()=>{e.removeEventListener(t,n,i),r=uk})}),{immediate:!0,flush:"post"}),a=()=>{o(),r()};return(e=>{!!q()&&B(e)})(a),a},dk=S({props:fC({},RS),emits:["update:modelValue","textSubmit","closed","cleared","open","focus","blur","internalModelChange","recalculatePosition","flow-step","focus-prev","updateMonthYear"],setup(e,{expose:t,emit:n}){const i=e,r=ae(),o=f(!1),a=fe(i,"modelValue"),s=f(null),c=f(null),u=f(null),l=f(null);ge(mS,i.autoApply);const h=g((()=>i.formatLocale));ge(_S,h),ge(vS,fe(i,"textInput")),ge(yS,fe(i,"arrowNavigation")),d((()=>{D(i.modelValue),i.inline||(window.addEventListener("scroll",ie),window.addEventListener("resize",re)),i.inline&&(o.value=!0)})),p((()=>{i.inline||(window.removeEventListener("scroll",ie),window.removeEventListener("resize",re))}));const m=LE(r,"all"),_=LE(r,"input");v(a,(()=>{D(a.value)}),{deep:!0});const{openOnTop:y,menuPosition:T,setMenuPosition:C,recalculatePosition:S,setInitialPosition:E}=((e,t,n,i,r,o,a)=>{const s=f({top:"0",left:"0",transform:"none"}),c=f(!1),u=e=>{const t=e.getBoundingClientRect();return{left:t.left+window.scrollX,top:t.top+window.scrollY}},l=e=>{const t=e.getBoundingClientRect();let n=0,i=0;for(;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)n+=e.offsetLeft-e.scrollLeft,i=t.top+e.scrollTop,e=e.offsetParent;return{top:i,left:n}},d=(e,t)=>{s.value.left=`${e+t}px`,s.value.transform="translateX(-100%)"},p=e=>{s.value.left=`${e}px`,s.value.transform="translateX(0)"},h=(t,n)=>{e===ak.left&&p(t),e===ak.right&&d(t,n),e===ak.center&&(s.value.left=`${t+n/2}px`,s.value.transform="translateX(-50%)")},g=(e=!0)=>{if(!o){const i=pS(r);if(t&&"boolean"!=typeof t)s.value=t(i);else if(i){const{left:r,width:o,height:a}=i.getBoundingClientRect(),{top:c}=t?l(i):u(i);s.value.top=`${a+c+10}px`,h(r,o),e&&n&&m()}}},m=()=>{const e=pS(r);if(e&&n&&!o){const{height:n,top:r,left:o,width:a}=e.getBoundingClientRect(),{top:h}=t?l(e):u(e),f=window.innerHeight-r-n,m=pS(i);if(m){const{height:e,left:t,right:i}=m.getBoundingClientRect(),u=e+n;u>r&&u>f?r<f&&(g(!1),c.value=!1):u>f?(s.value.top=h-e-10+"px",c.value=!0):(g(!1),c.value=!1),t<0?p(o):i>document.documentElement.clientWidth&&d(o,a)}}a("recalculatePosition")};return{openOnTop:c,menuPosition:s,setMenuPosition:g,setInitialPosition:()=>{const e=pS(r);if(e){const n=window.innerHeight,{top:i}=t?l(e):u(e),{left:r,width:o,top:a,height:c}=e.getBoundingClientRect(),d=n-a-c;s.value.top=a>d?i-390+"px":`${i}px`,h(r,o)}},recalculatePosition:m}})(i.position,i.altPosition,i.autoPosition,s,c,i.inline,n),{internalModelValue:k,inputValue:b,parseExternalModelValue:D,emitModelValue:L,checkBeforeEmit:U,formatInputValue:x}=sk(i.format,i.timePicker,i.monthPicker,i.range,i.partialRange,i.is24,i.enableTimePicker,i.enableSeconds,h,i.multiDates,i.utc,i.weekPicker,i.yearPicker,i.textInputOptions,n),{clearArrowNav:F}=$S(),{setMenuFocused:V,setShiftKey:q}=PS(),B=g((()=>({dp__main:!0,dp__theme_dark:i.dark,dp__theme_light:!i.dark,dp__flex_display:i.inline,dp__flex_display_with_input:i.inlineWithInput}))),z=g((()=>lE(i.format)?i.format:KC(null,i.is24,i.enableSeconds,i.monthPicker,i.timePicker,i.weekPicker,i.yearPicker,i.enableTimePicker))),W=g((()=>i.previewFormat?i.previewFormat:lE(z.value)?z.value:i.format)),Y=g((()=>"boolean"==typeof i.transitions?!!i.transitions&&hS({}):hS(i.transitions)));ge(gS,Y);const $=g((()=>i.dark?"dp__theme_dark":"dp__theme_light")),J=g((()=>Object.assign({enterSubmit:!0,tabSubmit:!0,openMenu:!0,rangeSeparator:" - "},i.textInputOptions))),Z=g((()=>(e=>Object.assign({toggleOverlay:"Toggle overlay",menu:"Datepicker menu",input:"Datepicker input",calendarWrap:"Calendar wrapper",calendarDays:"Calendar days",openTimePicker:"Open time picker",closeTimePicker:"Close time Picker",incrementValue:e=>`Increment ${e}`,decrementValue:e=>`Decrement ${e}`,openTpOverlay:e=>`Open ${e} overlay`,amPmButton:"Switch AM/PM mode",openYearsOverlay:"Open years overlay",openMonthsOverlay:"Open months overlay",nextMonth:"Next month",prevMonth:"Previous month"},e))(i.ariaLabels)));ge(fS,Z);const Q=g((()=>(e=>Object.assign({months:[],years:[],times:{hours:[],minutes:[],seconds:[]}},e))(i.filters))),ee=g((()=>{const e=e=>{const t={hours:Ie(new Date),minutes:Me(new Date),seconds:Te(new Date)};return Object.assign(t,e)};return i.range?i.startTime&&Array.isArray(i.startTime)?[e(i.startTime[0]),e(i.startTime[1])]:null:i.startTime&&!Array.isArray(i.startTime)?e(i.startTime):null})),te=g((()=>null===i.multiCalendars?0:"boolean"==typeof i.multiCalendars?i.multiCalendars?2:0:+i.multiCalendars>=2?+i.multiCalendars:2)),ie=()=>{o.value&&(i.closeOnScroll?ye():i.autoPosition?C():window.removeEventListener("scroll",ie))},re=()=>{o.value&&C()},oe=()=>{!i.disabled&&!i.readonly&&(E(),o.value=!0,N().then((()=>{C(),o.value&&(n("open"),n("focus"))})),o.value||_e(),D(i.modelValue))},se=()=>{b.value="",_e(),n("update:modelValue",null),n("cleared"),ye()},ce=()=>{const{validate:e}=uS(i.minDate,i.maxDate,i.disabledDates,i.allowedDates,Q.value,i.disabledWeekDays,i.yearRange),t=k.value;return!(Array.isArray(t)||!e(t))||!!Array.isArray(t)&&(!(2!==t.length||!e(t[0])||!e(t[1]))||!!e(t[0]))},ue=()=>{U()&&ce()&&(L(),ye())},me=e=>{L(),i.closeOnAutoApply&&!e&&ye()},ve=(e=!1)=>{i.autoApply&&(!i.enableTimePicker||i.monthPicker||i.yearPicker||oS(k.value,i.maxTime,i.minTime))&&ce()&&(i.range&&Array.isArray(k.value)?(i.partialRange||2===k.value.length)&&me(e):me(e))},_e=()=>{k.value=null},ye=()=>{i.inline||(o.value&&(o.value=!1,V(!1),q(!1),F(),n("closed"),n("blur"),E(),b.value&&D(a.value)),_e(),c.value&&c.value.unFocus(),Ee())},Ce=(e,t)=>{e?(k.value=e,t&&(ue(),n("textSubmit"))):k.value=null},Se=()=>{i.autoApply&&oS(k.value,i.maxTime,i.minTime)&&L()},Ee=()=>{u.value&&u.value.focus({preventScroll:!0})},ke=()=>o.value?ye():oe();return((e,t,n,i={})=>{const{window:r=ck,event:o="pointerdown"}=i;r&&lk(r,o,(i=>{const r=pS(e),o=pS(t);!r||!o||r===i.target||i.composedPath().includes(r)||i.composedPath().includes(o)||n(i)}),{passive:!0})})(s,c,ye),t({closeMenu:ye,selectDate:ue,clearValue:se,openMenu:oe,onScroll:ie,formatInputValue:x}),(e,t)=>(w(),A("div",{class:G(H(B))},[P("span",{tabindex:"-1",ref_key:"focusRefBefore",ref:l},null,512),M(VS,he({ref_key:"inputRef",ref:c},{placeholder:e.placeholder,hideInputIcon:e.hideInputIcon,readonly:e.readonly,disabled:e.disabled,inputClassName:e.inputClassName,clearable:e.clearable,state:e.state,inline:e.inline,inlineWithInput:e.inlineWithInput,textInput:e.textInput,textInputOptions:H(J),range:e.range,isMenuOpen:o.value,pattern:H(z),autoApply:e.autoApply,uid:e.uid,openMenuOnFocus:e.openMenuOnFocus,required:e.required,name:e.name,autocomplete:e.autocomplete},{"input-value":H(b),"onUpdate:input-value":t[0]||(t[0]=e=>I(b)?b.value=e:null),onClear:se,onOpen:oe,onSetInputDate:Ce,onSetEmptyDate:H(L),onSelectDate:ue,onToggle:ke,onClose:ye,onFocusPrev:t[1]||(t[1]=t=>e.$emit("focus-prev"))}),le({_:2},[R(H(_),((t,n)=>({name:t,fn:K((n=>[X(e.$slots,t,de(pe(n)))]))})))]),1040,["input-value","onSetEmptyDate"]),P("span",{tabindex:"-1",ref_key:"focusRef",ref:u},null,512),o.value?(w(),j(ne,{key:0,to:e.teleport,disabled:e.inline},[o.value?(w(),j(rk,he({key:0,ref_key:"dpMenuRef",ref:s,class:H($),style:H(T)},{weekNumbers:e.weekNumbers,weekStart:e.weekStart,disableMonthYearSelect:e.disableMonthYearSelect,menuClassName:e.menuClassName,calendarClassName:e.calendarClassName,yearRange:e.yearRange,range:e.range,multiCalendars:H(te),multiCalendarsSolo:e.multiCalendarsSolo,multiStatic:e.multiStatic,calendarCellClassName:e.calendarCellClassName,enableTimePicker:e.enableTimePicker,is24:e.is24,hoursIncrement:e.hoursIncrement,minutesIncrement:e.minutesIncrement,hoursGridIncrement:e.hoursGridIncrement,minutesGridIncrement:e.minutesGridIncrement,minDate:e.minDate,maxDate:e.maxDate,autoApply:e.autoApply,selectText:e.selectText,cancelText:e.cancelText,previewFormat:H(W),locale:e.locale,weekNumName:e.weekNumName,disabledDates:e.disabledDates,filters:H(Q),minTime:e.minTime,maxTime:e.maxTime,inline:e.inline,openOnTop:H(y),monthPicker:e.monthPicker,timePicker:e.timePicker,monthNameFormat:e.monthNameFormat,startDate:e.startDate,startTime:H(ee),monthYearComponent:e.monthYearComponent,timePickerComponent:e.timePickerComponent,actionRowComponent:e.actionRowComponent,customProps:e.customProps,hideOffsetDates:e.hideOffsetDates,autoRange:e.autoRange,noToday:e.noToday,noHoursOverlay:e.noHoursOverlay,noMinutesOverlay:e.noMinutesOverlay,disabledWeekDays:e.disabledWeekDays,allowedDates:e.allowedDates,showNowButton:e.showNowButton,nowButtonLabel:e.nowButtonLabel,monthChangeOnScroll:e.monthChangeOnScroll,markers:e.markers,uid:e.uid,modeHeight:e.modeHeight,enableSeconds:e.enableSeconds,secondsIncrement:e.secondsIncrement,secondsGridIncrement:e.secondsGridIncrement,noSecondsOverlay:e.noSecondsOverlay,escClose:e.escClose,spaceConfirm:e.spaceConfirm,monthChangeOnArrows:e.monthChangeOnArrows,textInput:e.textInput,disabled:e.disabled,readonly:e.readonly,multiDates:e.multiDates,presetRanges:e.presetRanges,flow:e.flow,preventMinMaxNavigation:e.preventMinMaxNavigation,minRange:e.minRange,maxRange:e.maxRange,fixedStart:e.fixedStart,fixedEnd:e.fixedEnd,multiDatesLimit:e.multiDatesLimit,reverseYears:e.reverseYears,keepActionRow:e.keepActionRow,weekPicker:e.weekPicker,noSwipe:e.noSwipe,vertical:e.vertical,arrowNavigation:e.arrowNavigation,yearPicker:e.yearPicker},{internalModelValue:H(k),"onUpdate:internalModelValue":t[2]||(t[2]=e=>I(k)?k.value=e:null),onClosePicker:ye,onSelectDate:ue,onDpOpen:H(S),onAutoApply:ve,onTimeUpdate:Se,onFlowStep:t[3]||(t[3]=t=>e.$emit("flow-step",t)),onUpdateMonthYear:t[4]||(t[4]=t=>e.$emit("updateMonthYear",t))}),le({_:2},[R(H(m),((t,n)=>({name:t,fn:K((n=>[X(e.$slots,t,de(pe(fC({},n))))]))})))]),1040,["class","style","internalModelValue","onDpOpen"])):O("",!0)],8,["to","disabled"])):O("",!0)],2))}});var pk=(()=>{const e=dk;return e.install=t=>{t.component("Vue3DatePicker",e)},e})(),hk=Object.freeze(Object.defineProperty({__proto__:null,default:pk},Symbol.toStringTag,{value:"Module"}));Object.entries(hk).forEach((([e,t])=>{"default"!==e&&(pk[e]=t)}));const fk=S({props:{userInfo:{type:Object,default:()=>({})},isH5:{type:Boolean,default:()=>!1}},components:{Datepicker:pk},setup(e,t){const n=null==fk?void 0:fk.TUIServer,i=E({profile:{},isEdit:!1,avatarList:[{name:"avatar_01",avatar:" https://im.sdk.qcloud.com/download/tuikit-resource/avatar/avatar_1.png"},{name:"avatar_02",avatar:" https://im.sdk.qcloud.com/download/tuikit-resource/avatar/avatar_2.png"},{name:"avatar_03",avatar:" https://im.sdk.qcloud.com/download/tuikit-resource/avatar/avatar_3.png"},{name:"avatar_04",avatar:" https://im.sdk.qcloud.com/download/tuikit-resource/avatar/avatar_4.png"},{name:"avatar_05",avatar:" https://im.sdk.qcloud.com/download/tuikit-resource/avatar/avatar_5.png"},{name:"avatar_06",avatar:" https://im.sdk.qcloud.com/download/tuikit-resource/avatar/avatar_6.png"}],type:[{label:"男",type:n.TUICore.TIM.TYPES.GENDER_MALE},{label:"女",type:n.TUICore.TIM.TYPES.GENDER_FEMALE}],genderLabel:{[n.TUICore.TIM.TYPES.GENDER_MALE]:"男",[n.TUICore.TIM.TYPES.GENDER_FEMALE]:"女",[n.TUICore.TIM.TYPES.GENDER_UNKNOWN]:"不显示"},setName:"",editConfig:{title:"",list:[],type:"",subText:"",placeholder:"",value:""}}),r=e=>{const t=e.getDate()>9?e.getDate():`0${e.getDate()}`,n=e.getMonth()>8?e.getMonth()+1:`0${e.getMonth()+1}`;return`${e.getFullYear()}${n}${t}`};k((()=>{i.profile=JSON.parse(JSON.stringify(e.userInfo))}));const o=g((()=>{let t=i.profile.birthday;return"birthday"===i.setName&&e.isH5&&(t=i.editConfig.value),a(t)})),a=e=>{const t=`${e}`;if(8===t.length){return`${t.slice(0,4)}-${t.slice(4,6)}-${t.slice(-2)}`}return""},s=()=>{i.setName="",i.editConfig={title:"",list:[],type:"",subText:"",placeholder:"",value:""}};return{...b(i),showChooseGender:e=>{i.profile.gender=e.type},chooseAvatar:e=>{i.profile.avatar=e.avatar},showBirthday:t=>{e.isH5?i.editConfig.value=t?Number(r(t)):0:i.profile.birthday=t?Number(r(t)):0},birthday:o,submit:()=>{e.isH5&&(i.profile[i.setName]=i.editConfig.value,s()),t.emit("submit",i.profile)},cancel:()=>{t.emit("cancel",i.profile)},setProfile:e=>{switch(i.editConfig.value=`${i.profile[e]}`,i.setName=e,e){case"avatar":i.editConfig.title="选择头像",i.editConfig.list=i.avatarList,i.editConfig.type="select";break;case"nick":i.editConfig.title="设置昵称",i.editConfig.subText="仅限中文、字母、数字和下划线，2-20个字",i.editConfig.placeholder="请输入昵称",i.editConfig.type="text";break;case"gender":i.editConfig.title="性别选择",i.editConfig.list=i.type,i.editConfig.type="select";break;case"selfSignature":i.editConfig.title="个性签名",i.editConfig.type="textarea",i.editConfig.placeholder="请输入内容";break;case"birthday":i.editConfig.title="出生年月",i.editConfig.type="date",i.editConfig.placeholder="请选择出生日期"}},choose:e=>{i.editConfig.value=(null==e?void 0:e.avatar)||(null==e?void 0:e.type)},closeMask:s,format:r}}}),gk={class:"edit-header"},mk={class:"edit-header-title"},vk={class:"edit-list"},_k={class:"edit-list-item space-top"},yk={key:0},Ik=["src"],Mk={key:1,class:"avatar-list"},Tk=["onClick"],Ck=["src"],Sk={key:0,class:"icon icon-right"},Ek={class:"edit-list-item space-top"},kk={key:0},bk={key:0,class:"icon icon-right"},Dk={class:"edit-list-item"},wk={class:"edit-list-item-content"},Ak={class:"edit-list-item space-top"},Rk={key:0},Lk={key:0,class:"icon icon-right"},Ok={class:"edit-list-item"},Nk={key:0},Pk={key:1,class:"gender-list"},Uk=["onClick"],xk={class:"name"},Gk={key:0,class:"icon icon-right"},Fk={class:"edit-list-item"},Vk={key:0},qk={key:0,class:"icon icon-right"},Bk={key:0,class:"edit-footer"},Hk={class:"mask-main"},jk={class:"edit-h5-header"},Kk={class:"edit-h5-main"},zk={key:0,class:"list"},Wk=["onClick"],Yk=["src"],$k={key:1,class:"input"},Jk=["placeholder"],Xk=["type","placeholder"],Zk={key:2},Qk={class:"edit-h5-footer"},eb=["disabled"];const tb=D(fk,[["render",function(e,t,n,i,r,o){const a=J("Datepicker");return w(),A("div",{class:G(["edit",[e.isH5?"edit-h5":""]])},[P("header",gk,[e.isH5?(w(),A("i",{key:0,class:"icon icon-back",onClick:t[0]||(t[0]=(...t)=>e.cancel&&e.cancel(...t))})):O("",!0),P("h1",mk,L(e.$t("TUIProfile.资料设置")),1)]),P("ul",vk,[P("li",_k,[P("main",{class:"edit-list-item-content",onClick:t[1]||(t[1]=t=>e.setProfile("avatar"))},[P("label",null,L(e.$t("TUIProfile.头像")),1),e.isH5?(w(),A("span",yk,[P("img",{src:e.profile.avatar?e.profile.avatar:"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,Ik)])):(w(),A("ul",Mk,[(w(!0),A(_,null,R(e.avatarList,((t,n)=>(w(),A("li",{class:"avatar-list-item",key:n,onClick:n=>e.chooseAvatar(t)},[P("img",{class:G([e.profile.avatar===t.avatar&&"selected"]),src:t.avatar},null,10,Ck)],8,Tk)))),128))]))]),e.isH5?(w(),A("i",Sk)):O("",!0)]),P("li",Ek,[P("main",{class:"edit-list-item-content",onClick:t[3]||(t[3]=t=>e.setProfile("nick"))},[P("label",null,L(e.$t("TUIProfile.昵称")),1),e.isH5?(w(),A("span",kk,L(e.profile.nick),1)):z((w(),A("input",{key:1,type:"text","onUpdate:modelValue":t[2]||(t[2]=t=>e.profile.nick=t)},null,512)),[[ee,e.profile.nick]])]),e.isH5?(w(),A("i",bk)):O("",!0)]),P("li",Dk,[P("main",wk,[P("label",null,L(e.$t("TUIProfile.账号")),1),P("span",null,L(e.profile.userID),1)])]),P("li",Ak,[P("main",{class:"edit-list-item-content",onClick:t[5]||(t[5]=t=>e.setProfile("selfSignature"))},[P("label",null,L(e.$t("TUIProfile.个性签名")),1),e.isH5?(w(),A("span",Rk,L(e.profile.selfSignature),1)):z((w(),A("input",{key:1,type:"text","onUpdate:modelValue":t[4]||(t[4]=t=>e.profile.selfSignature=t)},null,512)),[[ee,e.profile.selfSignature]])]),e.isH5?(w(),A("i",Lk)):O("",!0)]),P("li",Ok,[P("main",{class:"edit-list-item-content",onClick:t[6]||(t[6]=t=>e.setProfile("gender"))},[P("label",null,L(e.$t("TUIProfile.性别")),1),e.isH5?(w(),A("span",Nk,L(e.profile.gender?e.$t(`TUIProfile.${e.genderLabel[e.profile.gender]}`):""),1)):(w(),A("ul",Pk,[(w(!0),A(_,null,R(e.type,((t,n)=>(w(),A("li",{class:"gender-list-item",key:n,onClick:n=>e.showChooseGender(t)},[P("i",{class:G(["gender",[e.profile.gender===t.type&&"gender-selected"]])},null,2),P("p",xk,L(e.$t(`TUIProfile.${t.label}`)),1)],8,Uk)))),128))]))]),e.isH5?(w(),A("i",Gk)):O("",!0)]),P("li",Fk,[P("main",{class:"edit-list-item-content",onClick:t[7]||(t[7]=t=>e.setProfile("birthday"))},[P("label",null,L(e.$t("TUIProfile.出生年月")),1),e.isH5?(w(),A("span",Vk,L(e.profile.birthday),1)):(w(),j(a,{key:1,placeholder:e.$t("TUIProfile.请选择出生日期"),enableTimePicker:!1,format:e.format,previewFormat:e.format,modelValue:e.birthday,"onUpdate:modelValue":e.showBirthday},null,8,["placeholder","format","previewFormat","modelValue","onUpdate:modelValue"]))]),e.isH5?(w(),A("i",qk)):O("",!0)])]),e.isH5?O("",!0):(w(),A("footer",Bk,[P("button",{class:"btn-default",onClick:t[8]||(t[8]=(...t)=>e.cancel&&e.cancel(...t))},L(e.$t("TUIProfile.取消")),1),P("button",{class:"btn-submit",onClick:t[9]||(t[9]=(...t)=>e.submit&&e.submit(...t))},L(e.$t("TUIProfile.保存")),1)])),e.setName&&e.isH5?(w(),A("div",{key:1,class:"mask",onClick:t[14]||(t[14]=x(((...t)=>e.closeMask&&e.closeMask(...t)),["self"]))},[P("div",Hk,[P("header",jk,[P("h1",null,L(e.$t(`TUIProfile.${e.editConfig.title}`)),1),P("span",{class:"close",onClick:t[10]||(t[10]=(...t)=>e.closeMask&&e.closeMask(...t))},L(e.$t("关闭")),1)]),P("main",Kk,["select"===e.editConfig.type?(w(),A("ul",zk,[(w(!0),A(_,null,R(e.editConfig.list,((t,n)=>(w(),A("li",{class:"list-item",key:n,onClick:n=>e.choose(t)},[(null==t?void 0:t.avatar)?(w(),A("img",{key:0,class:G([e.editConfig.value===t.avatar&&"selected"]),src:t.avatar},null,10,Yk)):(w(),A("span",{key:1,class:G([e.editConfig.value===t.type&&"selected"])},L(e.$t(`TUIProfile.${t.label}`)),3))],8,Wk)))),128))])):(w(),A("div",$k,["textarea"===e.editConfig.type?z((w(),A("textarea",{key:0,placeholder:e.editConfig.placeholder,"onUpdate:modelValue":t[11]||(t[11]=t=>e.editConfig.value=t)},null,8,Jk)),[[ee,e.editConfig.value]]):"date"===e.editConfig.type?(w(),j(a,{key:1,class:"datePicker",placeholder:e.$t("TUIProfile.请选择出生日期"),enableTimePicker:!1,format:e.format,previewFormat:e.format,modelValue:e.birthday,"onUpdate:modelValue":e.showBirthday},null,8,["placeholder","format","previewFormat","modelValue","onUpdate:modelValue"])):z((w(),A("input",{key:2,type:e.editConfig.type,placeholder:e.$t(`TUIProfile.${e.editConfig.placeholder}`),"onUpdate:modelValue":t[12]||(t[12]=t=>e.editConfig.value=t)},null,8,Xk)),[[Le,e.editConfig.value]])])),e.editConfig.subText?(w(),A("sub",Zk,L(e.$t(`TUIProfile.${e.editConfig.subText}`)),1)):O("",!0)]),P("footer",Qk,[P("button",{class:"btn btn-submit",disabled:!e.editConfig.value,onClick:t[13]||(t[13]=(...t)=>e.submit&&e.submit(...t))},L(e.$t("确定")),9,eb)])])])):O("",!0)],2)}],["__scopeId","data-v-ad7146ad"]]),nb=S({name:"TUIProfile",components:{TUIProfileEdit:tb},setup(e,t){var n;const i=null==nb?void 0:nb.TUIServer,r=E({profile:{},isEdit:!1,genderLabel:{[i.TUICore.TIM.TYPES.GENDER_MALE]:"男",[i.TUICore.TIM.TYPES.GENDER_FEMALE]:"女",[i.TUICore.TIM.TYPES.GENDER_UNKNOWN]:"不显示"},env:i.TUICore.TUIEnv});tb.TUIServer=i,i.bind(r);const o=(null==(n=null==window?void 0:window.TUIKitTUICore)?void 0:n.isOfficial)&&Co&&Co()||{},a=()=>{r.env.isH5?r.isEdit=!1:s()},s=()=>{t.emit("changeStatus")};return{...b(r),submit:async e=>{var t;const n={nick:e.nick,avatar:e.avatar,gender:e.gender||i.TUICore.TIM.TYPES.GENDER_UNKNOWN,selfSignature:e.selfSignature,birthday:e.birthday};i.TUICore.getStore().TUIProfile.profile.nick!==e.nick&&(null==(t=null==window?void 0:window.TUIKitTUICore)?void 0:t.isOfficial)&&(null==o?void 0:o.commit)&&(null==o||o.commit("handleTask",2));try{await i.updateMyProfile(n),Mo.getInstance().reportEvent({name:"changeProfile",ext1:"changeProfile"})}catch(s){}r.env.isH5||a()},cancel:a,changeStatus:s,toggleEdit:()=>{r.env.isH5&&(r.isEdit=!0)}}}}),ib={class:"profile-header"},rb={class:"profile-avatar"},ob=["src"],ab={class:"profile-main"},sb={class:"profile-main-item"},cb={class:"profile-main-name"},ub={key:0,class:"gender"},lb={class:"profile-main-item"},db={class:"profile-main-label"},pb={key:0,class:"profile-main-item"},hb={class:"profile-main-label"},fb={key:0,class:"profile-main"},gb={class:"profile-main-item"},mb={class:"profile-main-label"},vb={class:"profile-main-item"},_b={class:"profile-main-label"},yb={key:1,class:"icon icon-right"};const Ib=D(nb,[["render",function(e,t,n,i,r,o){const a=J("TUIProfileEdit");return w(),A("div",{class:G(["TUI-profile",[e.env.isH5?"TUI-profile-h5":""]])},[e.isEdit?(w(),j(a,{key:1,userInfo:e.profile,isH5:e.env.isH5,onSubmit:e.submit,onCancel:e.cancel},null,8,["userInfo","isH5","onSubmit","onCancel"])):(w(),A("div",{key:0,class:"profile",onClick:t[0]||(t[0]=(...t)=>e.toggleEdit&&e.toggleEdit(...t))},[P("header",ib,[P("aside",rb,[P("img",{class:"avatar",src:e.profile.avatar?e.profile.avatar:"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,ob)]),P("ul",ab,[P("li",sb,[P("h1",cb,L(e.profile.nick||"-"),1),e.env.isH5?O("",!0):(w(),A("p",ub,L(e.profile.gender?e.$t(`TUIProfile.${e.genderLabel[e.profile.gender]}`):""),1))]),P("li",lb,[P("label",db,L(e.$t("TUIProfile.用户ID"))+":",1),P("span",null,L(e.profile.userID),1)]),e.env.isH5?(w(),A("li",pb,[P("label",hb,L(e.$t("TUIProfile.个性签名"))+":",1),P("span",null,L(e.profile.selfSignature||e.$t("TUIProfile.暂未设置")),1)])):O("",!0)])]),e.env.isH5?O("",!0):(w(),A("ul",fb,[P("li",gb,[P("label",mb,L(e.$t("TUIProfile.个性签名")),1),P("span",null,L(e.profile.selfSignature||e.$t("TUIProfile.暂未设置")),1)]),P("li",vb,[P("label",_b,L(e.$t("TUIProfile.出生年月")),1),P("span",null,L(e.profile.birthday?e.profile.birthday:e.$t("TUIProfile.暂未设置")),1)])])),e.env.isH5?(w(),A("i",yb)):O("",!0)]))],2)}],["__scopeId","data-v-ea4b91a0"]]),Mb={name:"TUIProfile",component:Ib,server:aC,install:e=>{Ib.TUIServer=Mb.server,e.component(Mb.name,Ib)},plugin:e=>(Mb.server=new aC(e),e.component(Mb.name,Mb),Mb)},Tb={};class Cb extends Cr{constructor(e){super(),this.currentStore={},this.TUICore=e,this.bindTIMEvent(),this.store=e.setComponentStore("TUIGroup",Tb,this.updateStore.bind(this))}destroyed(){this.unbindTIMEvent()}updateStore(e,t){this.currentStore.groupList=e.groupList,this.currentStore.searchGroup=e.searchGroup}bindTIMEvent(){this.TUICore.tim.on(this.TUICore.TIM.EVENT.GROUP_LIST_UPDATED,this.handleGroupListUpdated,this),this.TUICore.tim.on(this.TUICore.TIM.EVENT.GROUP_ATTRIBUTES_UPDATED,this.handleGroupAttributesUpdated,this)}unbindTIMEvent(){this.TUICore.tim.off(this.TUICore.TIM.EVENT.GROUP_LIST_UPDATED,this.handleGroupListUpdated),this.TUICore.tim.off(this.TUICore.TIM.EVENT.GROUP_ATTRIBUTES_UPDATED,this.handleGroupAttributesUpdated)}handleGroupListUpdated(e){this.store.groupList=e.data}handleGroupAttributesUpdated(e){const{groupID:t,groupAttributes:n}=e.data}handlePromiseCallback(e){return new Promise(((t,n)=>{const i="TUIGroup",r=()=>{e&&e(t,n)};this.TUICore.setAwaitFunc(i,r)}))}async getGroupList(e){return this.handlePromiseCallback((async(t,n)=>{try{let n={};n=e?await this.TUICore.tim.getGroupList(e):await this.TUICore.tim.getGroupList(),this.store.groupList=n.data.groupList,t(n)}catch(i){n(i)}}))}getGroupProfile(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=await this.TUICore.tim.getGroupProfile(e);this.store.groupList=n.data.groupList,t(n)}catch(i){n(i)}}))}createGroup(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.createGroup(e))}catch(i){n(i)}}))}dismissGroup(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=await this.TUICore.tim.dismissGroup(e);this.store.groupProfile=n.data.group,t(n)}catch(i){n(i)}}))}updateGroupProfile(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=await this.TUICore.tim.updateGroupProfile(e);this.store.groupProfile=n.data.group,t(n)}catch(i){n(i)}}))}joinGroup(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.joinGroup(e))}catch(i){n(i)}}))}quitGroup(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.quitGroup(e))}catch(i){n(i)}}))}searchGroupByID(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=await this.TUICore.tim.searchGroupByID(e);this.store.searchGroup=n.data.group,t(n)}catch(i){n(i)}}))}getGroupOnlineMemberCount(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.getGroupOnlineMemberCount(e))}catch(i){n(i)}}))}changeGroupOwner(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.changeGroupOwner(e))}catch(i){n(i)}}))}handleGroupApplication(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.handleGroupApplication(e))}catch(i){n(i)}}))}initGroupAttributes(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.initGroupAttributes(e))}catch(i){n(i)}}))}setGroupAttributes(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.setGroupAttributes(e))}catch(i){n(i)}}))}deleteGroupAttributes(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.deleteGroupAttributes(e))}catch(i){n(i)}}))}getGroupAttributes(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.getGroupAttributes(e))}catch(i){n(i)}}))}getGroupMemberList(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.getGroupMemberList(e))}catch(i){n(i)}}))}addGroupMember(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.addGroupMember(e))}catch(i){n(i)}}))}deleteGroupMember(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.deleteGroupMember(e))}catch(i){n(i)}}))}setGroupMemberMuteTime(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.setGroupMemberMuteTime(e))}catch(i){n(i)}}))}setGroupMemberRole(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.setGroupMemberRole(e))}catch(i){n(i)}}))}setGroupMemberNameCard(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.setGroupMemberNameCard(e))}catch(i){n(i)}}))}getGroupMemberProfile(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.getGroupMemberProfile(e))}catch(i){n(i)}}))}async bind(e){return this.currentStore=e,await this.getGroupList(),this.currentStore}}const Sb=S({name:"TUIGroup",components:{},setup(e){const t=Sb.TUIServer,n=E({groupList:[],searchGroup:[],searchID:"",currentGroup:null});return t.bind(n),{...b(n)}}}),Eb={class:"TUI-group"};const kb=D(Sb,[["render",function(e,t,n,i,r,o){return w(),A("div",Eb,"TUIGroup")}],["__scopeId","data-v-e47b4ea7"]]),bb={name:"TUIGroup",component:kb,server:Cb,install:e=>{kb.TUIServer=bb.server,e.component(bb.name,kb)},plugin:e=>(bb.server=new Cb(e),e.component(bb.name,bb),bb)},Db={};class wb extends Cr{constructor(e){super(),this.currentStore={},this.TUICore=e,this.bindTIMEvent(),this.store=e.setComponentStore("TUIContact",Db,this.updateStore.bind(this))}destroyed(){this.unbindTIMEvent()}updateStore(e,t){this.currentStore.groupList=e.groupList,this.currentStore.searchGroup=e.searchGroup,this.currentStore.systemConversation=e.systemConversation,this.currentStore.systemMessageList=e.systemMessageList}bindTIMEvent(){this.TUICore.tim.on(this.TUICore.TIM.EVENT.GROUP_LIST_UPDATED,this.handleGroupListUpdated,this),this.TUICore.tim.on(this.TUICore.TIM.EVENT.GROUP_ATTRIBUTES_UPDATED,this.handleGroupAttributesUpdated,this),this.TUICore.tim.on(this.TUICore.TIM.EVENT.CONVERSATION_LIST_UPDATED,this.handleConversationListUpdate,this),this.TUICore.tim.on(this.TUICore.TIM.EVENT.FRIEND_LIST_UPDATED,this.handleFriendListUpdated,this),this.TUICore.tim.on(this.TUICore.TIM.EVENT.USER_STATUS_UPDATED,this.handleUserStatusUpdated,this)}unbindTIMEvent(){this.TUICore.tim.off(this.TUICore.TIM.EVENT.GROUP_LIST_UPDATED,this.handleGroupListUpdated),this.TUICore.tim.off(this.TUICore.TIM.EVENT.GROUP_ATTRIBUTES_UPDATED,this.handleGroupAttributesUpdated),this.TUICore.tim.off(this.TUICore.TIM.EVENT.CONVERSATION_LIST_UPDATED,this.handleConversationListUpdate),this.TUICore.tim.off(this.TUICore.TIM.EVENT.FRIEND_LIST_UPDATED,this.handleFriendListUpdated),this.TUICore.tim.off(this.TUICore.TIM.EVENT.USER_STATUS_UPDATED,this.handleUserStatusUpdated)}handleGroupListUpdated(e){this.store.groupList=e.data}handleGroupAttributesUpdated(e){const{groupID:t,groupAttributes:n}=e.data}handleConversationListUpdate(e){this.handleFilterSystem(e.data)}handleFriendListUpdated(e){this.currentStore.friendList=e.data,this.currentStore.userIDList=this.currentStore.friendList.map((e=>e.userID))}handleUserStatusUpdated(e){e.data.forEach((e=>{var t,n;const{userID:i,statusType:r,customStatus:o}=e;null==(n=null==(t=this.currentStore)?void 0:t.userStatusList)||n.set(i,{statusType:r,customStatus:o})}))}handlePromiseCallback(e){return new Promise(((t,n)=>{const i="TUIContact",r=()=>{e&&e(t,n)};this.TUICore.setAwaitFunc(i,r)}))}handleFilterSystem(e){const t={allConversationList:e,systemConversationList:[]};t.systemConversationList=e.filter((e=>e.type===this.TUICore.TIM.TYPES.CONV_SYSTEM)),this.store.allConversationList=t.allConversationList,this.store.systemConversationList=t.systemConversationList;const[n]=t.systemConversationList;return this.store.systemConversation=n,t}async getConversationList(){return this.handlePromiseCallback((async(e,t)=>{try{const t=await this.TUICore.tim.getConversationList();this.handleFilterSystem(t.data.conversationList),e(t)}catch(n){t(n)}}))}async getSystemMessageList(){const e={conversationID:this.store.systemConversation.conversationID,count:15};return this.handlePromiseCallback((async(t,n)=>{try{const n=await this.TUICore.tim.getMessageList(e);this.store.systemMessageList=n.data.messageList,t(n)}catch(i){n(i)}}))}async setMessageRead(){return this.handlePromiseCallback((async(e,t)=>{try{e(await this.TUICore.tim.setMessageRead({conversationID:this.store.systemConversation.conversationID}))}catch(n){t(n)}}))}async getGroupList(e){return this.handlePromiseCallback((async(t,n)=>{try{let n={};n=e?await this.TUICore.tim.getGroupList(e):await this.TUICore.tim.getGroupList(),this.store.groupList=n.data.groupList,t(n)}catch(i){n(i)}}))}getGroupProfile(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=await this.TUICore.tim.getGroupProfile(e);this.store.groupList=n.data.groupList,t(n)}catch(i){n(i)}}))}dismissGroup(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=await this.TUICore.tim.dismissGroup(e);this.store.groupProfile=n.data.group,t(n)}catch(i){n(i)}}))}updateGroupProfile(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=await this.TUICore.tim.updateGroupProfile(e);this.store.groupProfile=n.data.group,t(n)}catch(i){n(i)}}))}joinGroup(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.joinGroup(e))}catch(i){n(i)}}))}quitGroup(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.quitGroup(e))}catch(i){n(i)}}))}searchGroupByID(e){return this.handlePromiseCallback((async(t,n)=>{try{const n=await this.TUICore.tim.searchGroupByID(e);this.store.searchGroup=n.data.group,t(n)}catch(i){this.store.searchGroup={},n(i)}}))}handleGroupApplication(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.handleGroupApplication(e))}catch(i){n(i)}}))}async getFriendList(){return this.handlePromiseCallback((async(e,t)=>{try{const t=await this.TUICore.tim.getFriendList();this.currentStore.friendList=t.data,this.currentStore.userIDList=this.currentStore.friendList.map((e=>e.userID))||[],e(t)}catch(n){t(n)}}))}async getUserStatus(e){return this.handlePromiseCallback((async(t,n)=>{var i,r;try{if(!e.length)return;const n=await this.TUICore.tim.getUserStatus({userIDList:e});null==(r=null==(i=null==n?void 0:n.data)?void 0:i.successUserList)||r.forEach((e=>{var t,n;e&&(null==e?void 0:e.userID)&&(null==(n=null==(t=this.currentStore)?void 0:t.userStatusList)||n.set(null==e?void 0:e.userID,{statusType:null==e?void 0:e.statusType,customStatus:null==e?void 0:e.customStatus}))})),t(n)}catch(o){n(o)}}))}async subscribeUserStatus(e){return this.handlePromiseCallback((async(t,n)=>{try{if(!e.length)return;t(await this.TUICore.tim.subscribeUserStatus({userIDList:e}))}catch(i){n(i)}}))}async unsubscribeUserStatus(e){return this.handlePromiseCallback((async(t,n)=>{var i,r;try{if(e&&!e.length)return;const n=await this.TUICore.tim.unsubscribeUserStatus({userIDList:e});null==(r=null==(i=this.currentStore)?void 0:i.userStatusList)||r.clear(),t(n)}catch(o){n(o)}}))}async handleUserStatus(e,t){return this.handlePromiseCallback((async(n,i)=>{try{setTimeout((async()=>{e?(await this.subscribeUserStatus(t),await this.getUserStatus(t)):await this.unsubscribeUserStatus(t)}),1e3)}catch(r){i(r)}}))}async bind(e){return this.currentStore=e,await this.getGroupList(),await this.getConversationList(),await this.getFriendList(),this.currentStore}}const Ab=S({props:{data:{type:Array,default:()=>[]},types:{type:Object,default:()=>({})},isH5:{type:Boolean,default:!1}},setup(e,t){const n=E({messageList:[],types:{},isHandle:!1});k((()=>{n.messageList=e.data,n.types=e.types}));return{...b(n),translateGroupSystemNotice:ts,handleApplication:(e,n)=>{const i={handleAction:e,message:n};t.emit("application",i),n.isHandle=!0}}}}),Rb={class:"list"},Lb=(e=>(F("data-v-2cb661e5"),e=e(),V(),e))((()=>P("i",{class:"icon icon-system"},null,-1))),Ob={key:0,class:"btn-box"},Nb=["onClick"],Pb=["onClick"],Ub={key:2};const xb=S({name:"TUIContact",components:{MessageSystem:D(Ab,[["render",function(e,t,n,i,r,o){return w(),A("div",{class:G(["message-system",[e.isH5?"message-system-h5":""]])},[P("ul",Rb,[(w(!0),A(_,null,R(e.messageList,((t,n)=>{var i;return w(),A("li",{key:n},[t.type===e.types.MSG_GRP_TIP||t.type===e.types.MSG_GRP_SYS_NOTICE?(w(),A(_,{key:0},[Lb,P("span",null,L(e.translateGroupSystemNotice(t)),1),1===(null==(i=null==t?void 0:t.payload)?void 0:i.operationType)?(w(),A("div",Ob,[t.isHandle?O("",!0):(w(),A("button",{key:0,class:"btn btn-default",onClick:n=>e.handleApplication("Agree",t)},L(e.$t("TUIContact.接受")),9,Nb)),t.isHandle?(w(),A("span",Ub,L(e.$t("TUIContact.已处理")),1)):(w(),A("button",{key:1,class:"btn btn-cancel",onClick:n=>e.handleApplication("Reject",t)},L(e.$t("TUIContact.拒绝")),9,Pb))])):O("",!0)],64)):O("",!0)])})),128))])],2)}],["__scopeId","data-v-2cb661e5"]])},props:{displayOnlineStatus:{type:Boolean,default:!1}},setup(e,t){const n=xb.TUIServer,{t:i}=n.TUICore.config.i18n.useI18n(),r=E({groupList:[],searchGroup:{},searchID:"",currentGroup:null,systemConversation:{unreadCount:0},systemMessageList:[],columnName:"",types:n.TUICore.TIM.TYPES,isSearch:!1,env:n.TUICore.TUIEnv,friendList:[],userIDList:[],currentFriend:{},displayOnlineStatus:!1,onlineStatus:!1,userStatusList:new Map});n.bind(r),v((()=>e.displayOnlineStatus),(async(e,t)=>{e!==t&&(r.displayOnlineStatus=e,n.handleUserStatus(r.displayOnlineStatus,r.userIDList))}),{immediate:!0}),v((()=>r.userIDList),((e,t)=>{is(e,t)||n.handleUserStatus(r.displayOnlineStatus,r.userIDList)}));const o=g((()=>{const e=r.currentGroup.selfInfo.userID,t=r.currentGroup.joinOption===n.TUICore.TIM.TYPES.JOIN_OPTIONS_NEED_PERMISSION;return!e&&t})),a=()=>{r.currentGroup={},r.currentFriend={},r.columnName=""};return{...b(r),handleListItem:async e=>{switch(r.columnName){case"group":r.currentGroup=e;break;case"friend":r.currentFriend=e}r.isSearch&&(r.currentGroup=e)},handleSearchGroup:async e=>{if(r.currentGroup=null,r.searchID.trim())try{await n.searchGroupByID(r.searchID.trim())}catch(t){ns(i("TUIContact.该群组不存在"),r.env)}},join:async e=>{const t={groupID:e.groupID,applyMessage:e.applyMessage||i("TUIContact.加群"),type:null==e?void 0:e.type};await n.joinGroup(t),r.currentGroup.apply=!0},quit:async e=>{await n.quitGroup(e.groupID),r.currentGroup=null},dismiss:e=>{n.dismissGroup(e.groupID),r.currentGroup=null},isNeedPermission:o,select:async e=>{var t;"system"!==r.columnName&&"system"===e&&(null==(t=r.systemConversation)?void 0:t.conversationID)&&(await n.getSystemMessageList(),await n.setMessageRead()),r.currentGroup={},"group"===r.columnName||"group"!==e||r.env.isH5?r.currentGroup={}:r.currentGroup=r.groupList[0],r.searchID="",r.columnName=r.columnName===e?"":e},handleGroupApplication:e=>{n.handleGroupApplication(e)},toggleSearch:()=>{r.isSearch=!r.isSearch,r.columnName="",r.searchID="",r.searchGroup={},r.currentGroup={}},init:()=>{r.isSearch=!1,r.columnName="",r.searchID="",r.searchGroup={},r.currentGroup={}},back:a,enter:async(e,t)=>{const i=`${t}${e}`;n.TUICore.TUIServer.TUIConversation.getConversationProfile(i).then((e=>{n.TUICore.TUIServer.TUIConversation.handleCurrentConversation(e.data.conversation),a()}))},getUserStatusList:e=>{n.TUICore.getUserStatusList(e)}}}}),Gb=e=>(F("data-v-1286992a"),e=e(),V(),e),Fb={class:"TUI-contact-left"},Vb={class:"TUI-contact-left-header"},qb={class:"search"},Bb=Gb((()=>P("i",{class:"plus"},null,-1))),Hb={key:1,class:"search-box"},jb={class:"input-box"},Kb=["placeholder"],zb={key:0,class:"TUI-contact-column"},Wb={class:"TUI-contact-column-item"},Yb={key:0,class:"num"},$b={key:0,class:"TUI-contact-list"},Jb={class:"TUI-contact-list-item selected not-aside"},Xb={key:0,class:"num"},Zb={class:"TUI-contact-column-item"},Qb={class:"TUI-contact-list"},eD=["onClick"],tD={class:"left"},nD=["src"],iD={class:"content"},rD={class:"name"},oD={class:"ID"},aD=Gb((()=>P("label",null,"ID：",-1))),sD={class:"type"},cD={class:"TUI-contact-column-item"},uD={class:"TUI-contact-list"},lD=["onClick"],dD={class:"left"},pD=["src"],hD={class:"content"},fD={class:"name"},gD={key:1,class:"TUI-contact-list"},mD={class:"left"},vD=["src"],_D={class:"content"},yD={class:"name"},ID={class:"ID"},MD=Gb((()=>P("label",null,"ID：",-1))),TD={class:"type"},CD={class:"TUI-contact-main"},SD={key:0,class:"TUI-contact-main-h5-title"},ED={key:1,class:"TUI-contact-main-info"},kD={class:"TUI-contact-main-info-header"},bD={class:"list"},DD=["src"],wD={key:0,class:"TUI-contact-main-info-main"},AD=["disabled"],RD={class:"TUI-contact-main-info-footer"},LD={key:0},OD={key:1},ND={key:2,class:"TUI-contact-main-info"},PD={class:"TUI-contact-main-info-header"},UD={class:"list"},xD=Gb((()=>P("label",null,"ID：",-1))),GD=["src"],FD={class:"TUI-contact-main-info-footer"},VD={key:3,class:"TUI-contact-system"},qD={key:0,class:"TUI-contact-system-header"};const BD=D(xb,[["render",function(e,t,n,i,r,o){const a=J("MessageSystem");return w(),j(Y,{onBeforeLeave:e.init},{default:K((()=>{var n,i,r,o,s,c,u,l,d,p,h,f,g,m,v,y,I,T,C,S,E,k,b,D,N;return[P("div",{class:G(["TUI-contact",[e.env.isH5?"TUI-contact-H5":""]])},[P("aside",Fb,[P("header",Vb,[P("div",qb,[e.isSearch?(w(),A("div",Hb,[P("div",jb,[z(P("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=t=>e.searchID=t),placeholder:e.$t("TUIContact.输入群ID，按回车搜索"),onKeyup:t[2]||(t[2]=Q(((...t)=>e.handleSearchGroup&&e.handleSearchGroup(...t)),["enter"])),enterkeyhint:"search"},null,40,Kb),[[ee,e.searchID]]),e.searchID?(w(),A("i",{key:0,class:"icon icon-cancel",onClick:t[3]||(t[3]=t=>e.searchID="")})):O("",!0)]),P("span",{class:"search-cancel",onClick:t[4]||(t[4]=(...t)=>e.toggleSearch&&e.toggleSearch(...t))},L(e.$t("取消")),1)])):(w(),A("div",{key:0,class:"search-box",onClick:t[0]||(t[0]=(...t)=>e.toggleSearch&&e.toggleSearch(...t))},[Bb,P("h1",null,L(e.$t("TUIContact.添加群聊")),1)]))])]),e.isSearch?(w(),A("ul",gD,[(null==(n=e.searchGroup)?void 0:n.groupID)?(w(),A("li",{key:0,class:G(["TUI-contact-list-item",[(null==(i=e.currentGroup)?void 0:i.groupID)===(null==(r=e.searchGroup)?void 0:r.groupID)&&"selected"]]),onClick:t[8]||(t[8]=t=>e.handleListItem(e.searchGroup))},[P("aside",mD,[P("img",{class:"avatar",src:(null==(o=e.searchGroup)?void 0:o.avatar)||"https://web.sdk.qcloud.com/im/demo/TUIkit/web/img/constomer.svg",onerror:"this.src='https://web.sdk.qcloud.com/im/demo/TUIkit/web/img/constomer.svg'"},null,8,vD)]),P("main",_D,[P("ul",null,[P("li",yD,L(null==(s=e.searchGroup)?void 0:s.name),1),P("li",ID,[MD,P("span",null,L(null==(c=e.searchGroup)?void 0:c.groupID),1)])]),P("span",TD,L(null==(u=e.searchGroup)?void 0:u.type),1)])],2)):O("",!0)])):(w(),A("ul",zb,[P("li",Wb,[P("header",{onClick:t[5]||(t[5]=t=>e.select("system"))},[P("i",{class:G(["icon icon-right",["system"===e.columnName&&"icon-down"]])},null,2),P("main",null,[P("label",null,L(e.$t("TUIContact.群聊通知")),1),e.systemConversation&&e.systemConversation.unreadCount>0?(w(),A("span",Yb,L(e.systemConversation.unreadCount),1)):O("",!0)])]),"system"===e.columnName?(w(),A("ul",$b,[P("li",Jb,[P("label",null,L(e.$t("TUIContact.系统通知")),1),e.systemConversation&&e.systemConversation.unreadCount>0?(w(),A("span",Xb,L(e.systemConversation.unreadCount),1)):O("",!0)])])):O("",!0)]),P("li",Zb,[P("header",{onClick:t[6]||(t[6]=t=>e.select("group"))},[P("i",{class:G(["icon icon-right",["group"===e.columnName&&"icon-down"]])},null,2),P("main",null,[P("label",null,L(e.$t("TUIContact.我的群聊")),1)])]),z(P("ul",Qb,[(w(!0),A(_,null,R(e.groupList,((t,n)=>{var i;return w(),A("li",{class:G(["TUI-contact-list-item",[(null==(i=e.currentGroup)?void 0:i.groupID)===(null==t?void 0:t.groupID)&&"selected"]]),key:n,onClick:n=>e.handleListItem(t)},[P("aside",tD,[P("img",{class:"avatar",src:(null==t?void 0:t.avatar)||"https://web.sdk.qcloud.com/im/demo/TUIkit/web/img/constomer.svg",onerror:"this.src='https://web.sdk.qcloud.com/im/demo/TUIkit/web/img/constomer.svg'"},null,8,nD)]),P("main",iD,[P("ul",null,[P("li",rD,L(null==t?void 0:t.name),1),P("li",oD,[aD,P("span",null,L(null==t?void 0:t.groupID),1)])]),P("span",sD,L(null==t?void 0:t.type),1)])],10,eD)})),128))],512),[[W,"group"===e.columnName]])]),P("li",cD,[P("header",{onClick:t[7]||(t[7]=t=>e.select("friend"))},[P("i",{class:G(["icon icon-right",["friend"===e.columnName&&"icon-down"]])},null,2),P("main",null,[P("label",null,L(e.$t("TUIContact.我的好友")),1)])]),z(P("ul",uD,[(w(!0),A(_,null,R(e.friendList,((t,n)=>{var i,r,o,a;return w(),A("li",{class:G(["TUI-contact-list-item",[(null==(i=e.currentFriend)?void 0:i.userID)===(null==t?void 0:t.userID)&&"selected"]]),key:n,onClick:n=>e.handleListItem(t)},[P("aside",dD,[P("img",{class:"avatar",src:(null==(r=null==t?void 0:t.profile)?void 0:r.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,pD),e.displayOnlineStatus?(w(),A("div",{key:0,class:G(["online-status",1===(null==(o=e.userStatusList.get(null==t?void 0:t.userID))?void 0:o.statusType)?"online-status-online":"online-status-offline"])},null,2)):O("",!0)]),P("main",hD,[P("ul",null,[P("li",fD,L((null==(a=null==t?void 0:t.profile)?void 0:a.nick)||(null==t?void 0:t.userID)),1)])])],10,lD)})),128))],512),[[W,"friend"===e.columnName]])])]))]),z(P("main",CD,[e.env.isH5?(w(),A("header",SD,[P("i",{class:"icon icon-back",onClick:t[9]||(t[9]=(...t)=>e.back&&e.back(...t))}),P("h1",null,L((null==(l=e.currentGroup)?void 0:l.name)||e.$t("TUIContact.系统通知")),1)])):O("",!0),(null==(d=e.currentGroup)?void 0:d.groupID)?(w(),A("div",ED,[P("header",kD,[P("ul",bD,[P("h1",null,L(null==(p=e.currentGroup)?void 0:p.name),1),P("li",null,[P("label",null,L(e.$t("TUIContact.群ID"))+"：",1),P("span",null,L(null==(h=e.currentGroup)?void 0:h.groupID),1)]),P("li",null,[P("label",null,L(e.$t("TUIContact.群类型"))+"：",1),P("span",null,L(null==(f=e.currentGroup)?void 0:f.type),1)])]),P("img",{class:"avatar",src:(null==(g=e.currentGroup)?void 0:g.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/group_avatar.png",onerror:"this.src='https://web.sdk.qcloud.com/im/demo/TUIkit/web/img/constomer.svg'"},null,8,DD)]),e.isNeedPermission?(w(),A("main",wD,[P("label",null,L(e.$t("TUIContact.请填写验证信息")),1),z(P("textarea",{"onUpdate:modelValue":t[10]||(t[10]=t=>e.currentGroup.applyMessage=t),disabled:e.currentGroup.apply},null,8,AD),[[ee,e.currentGroup.applyMessage]])])):O("",!0),P("footer",RD,[e.currentGroup.apply&&"AVChatRoom"===e.currentGroup.type?(w(),A("p",LD,L(e.$t("TUIContact.已加入")),1)):e.currentGroup.apply?(w(),A("p",OD,L(e.$t("TUIContact.已申请")),1)):e.isNeedPermission?(w(),A("button",{key:2,class:"btn btn-default",onClick:t[11]||(t[11]=t=>e.join(e.currentGroup))},L(e.$t("TUIContact.申请加入")),1)):e.currentGroup.selfInfo.userID?e.currentGroup.selfInfo.userID&&"Owner"===e.currentGroup.selfInfo.role&&"Private"!==e.currentGroup.type?(w(),A("button",{key:4,class:"btn btn-cancel",onClick:t[13]||(t[13]=t=>e.dismiss(e.currentGroup))},L(e.$t("TUIContact.解散群聊")),1)):(w(),A("button",{key:5,class:"btn btn-cancel",onClick:t[14]||(t[14]=t=>e.quit(e.currentGroup))},L(e.$t("TUIContact.退出群聊")),1)):(w(),A("button",{key:3,class:"btn btn-default",onClick:t[12]||(t[12]=t=>e.join(e.currentGroup))},L(e.$t("TUIContact.加入群聊")),1)),e.currentGroup.selfInfo.userID?(w(),A("button",{key:6,class:"btn btn-default",onClick:t[15]||(t[15]=t=>e.enter(e.currentGroup.groupID,"GROUP"))},L(e.$t("TUIContact.进入群聊")),1)):O("",!0)])])):(null==(m=e.currentFriend)?void 0:m.userID)&&"friend"===e.columnName?(w(),A("div",ND,[P("header",PD,[P("ul",UD,[P("h1",null,L((null==(y=null==(v=e.currentFriend)?void 0:v.profile)?void 0:y.nick)||(null==(I=e.currentFriend)?void 0:I.userID)),1),P("li",null,[xD,P("span",null,L(null==(C=null==(T=e.currentFriend)?void 0:T.profile)?void 0:C.userID),1)]),P("li",null,[P("label",null,L(e.$t("TUIContact.个性签名"))+"：",1),P("span",null,L(null==(E=null==(S=e.currentFriend)?void 0:S.profile)?void 0:E.selfSignature),1)])]),P("img",{class:"avatar",src:(null==(b=null==(k=e.currentFriend)?void 0:k.profile)?void 0:b.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,GD)]),P("footer",FD,[P("button",{class:"btn btn-default",onClick:t[16]||(t[16]=t=>e.enter(e.currentFriend.userID,"C2C"))},L(e.$t("TUIContact.发送消息")),1)])])):"system"===e.columnName?(w(),A("div",VD,[e.env.isH5?O("",!0):(w(),A("header",qD,[P("h1",null,L(e.$t("TUIContact.系统通知")),1)])),M(a,{isH5:e.env.isH5,data:e.systemMessageList,types:e.types,onApplication:e.handleGroupApplication},null,8,["isH5","data","types","onApplication"])])):X(e.$slots,"default",{key:4},void 0,!0)],512),[[W,!!(null==(D=e.currentGroup)?void 0:D.groupID)||!!(null==(N=e.currentFriend)?void 0:N.userID)||"system"===e.columnName]])],2)]})),_:3},8,["onBeforeLeave"])}],["__scopeId","data-v-1286992a"]]),HD={name:"TUIContact",component:BD,server:wb,install:e=>{BD.TUIServer=HD.server,e.component(HD.name,BD)},plugin:e=>(HD.server=new wb(e),e.component(HD.name,HD),HD)};class jD extends Cr{constructor(e){super(),this.currentStore={},this.TUICore=e,this.bindTIMEvent(),this.store=e.setComponentStore("TUISearch",{},this.updateStore.bind(this))}destroyed(){this.unbindTIMEvent()}updateStore(e,t){var n,i;(null==(i=null==(n=null==this?void 0:this.currentStore)?void 0:n.conversationData)?void 0:i.list)&&(this.currentStore.conversationData.list=e.conversationList)}handlePromiseCallback(e){return new Promise(((t,n)=>{const i="TUISearch",r=()=>{e&&e(t,n)};this.TUICore.setAwaitFunc(i,r)}))}bindTIMEvent(){this.TUICore.tim.on(this.TUICore.TIM.EVENT.FRIEND_LIST_UPDATED,this.handleFriendListUpdated,this)}unbindTIMEvent(){this.TUICore.tim.off(this.TUICore.TIM.EVENT.FRIEND_LIST_UPDATED,this.handleFriendListUpdated)}handleFriendListUpdated(e){this.currentStore.searchUserList=e.data.map((e=>null==e?void 0:e.profile)),this.currentStore.allUserList=e.data.map((e=>null==e?void 0:e.profile))}async getConversationProfile(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.getConversationProfile(e))}catch(i){n(i)}}))}async getUserProfile(e){return this.handlePromiseCallback((async(t,n)=>{try{t(await this.TUICore.tim.getUserProfile({userIDList:e}))}catch(i){n(i)}}))}async getFriendList(){return this.handlePromiseCallback((async(e,t)=>{try{const t=await this.TUICore.tim.getFriendList();this.currentStore.searchUserList=t.data.map((e=>null==e?void 0:e.profile)),this.currentStore.allUserList=t.data.map((e=>null==e?void 0:e.profile)),e(t)}catch(n){t(n)}}))}async bind(e){return this.currentStore=e,await this.getFriendList(),this.currentStore}}const KD=S({name:"group",props:{isH5:{type:Boolean,default:()=>!1}},setup(e,t){const n=E({profile:{groupID:"",name:"",type:"",avatar:"",introduction:"",notification:"",joinOption:""},editConfig:{title:"",value:"",key:"",type:"",placeholder:""},isEdit:!1,type:[{icon:"https://web.sdk.qcloud.com/im/assets/images/Public.svg",label:"陌生人社交群（Public）",type:KD.TUIServer.TUICore.TIM.TYPES.GRP_PUBLIC,detail:"类似 QQ 群，创建后群主可以指定群管理员，用户搜索群 ID 发起加群申请后，需要群主或管理员审批通过才能入群。详见",src:"产品文档"},{icon:"https://web.sdk.qcloud.com/im/assets/images/Meeting.svg",label:"临时会议群（Meeting）",type:KD.TUIServer.TUICore.TIM.TYPES.GRP_MEETING,detail:"创建后可以随意进出，且支持查看入群前消息；适合用于音视频会议场景、在线教育场景等与实时音视频产品结合的场景。详见",src:"产品文档"},{icon:"https://web.sdk.qcloud.com/im/assets/images/Work.svg",label:"好友工作群（Work）",type:KD.TUIServer.TUICore.TIM.TYPES.GRP_WORK,detail:"类似普通微信群，创建后仅支持已在群内的好友邀请加群，且无需被邀请方同意或群主神奇。详见",src:"产品文档"},{icon:"https://web.sdk.qcloud.com/im/assets/images/AVChatroom.svg",label:"直播群（AVChatroom）",type:KD.TUIServer.TUICore.TIM.TYPES.GRP_AVCHATROOM,detail:"创建后可以随意进出，没有群成员数量上限，但不支持历史消息存储；适合与直播产品结合，用于弹幕聊天场景。详见",src:"产品文档"}]});n.profile.type=n.type[0].type,n.profile.avatar=n.type[0].icon;const i=g((()=>n.type.filter((e=>e.type===n.profile.type))[0]));return{...b(n),selected:e=>{n.profile.type!==e.type&&(n.profile.type=e.type,n.profile.avatar=e.icon)},submit:e=>{if(n.isEdit)return n.profile[n.editConfig.key]=n.editConfig.value,n.isEdit=!n.isEdit;const i={name:e.name,type:e.type,groupID:e.groupID,avatar:e.avatar};t.emit("submit",i)},cancel:()=>{if(n.isEdit)return n.isEdit=!n.isEdit;t.emit("cancel")},Link:il,edit:e=>{switch(n.isEdit=!n.isEdit,n.editConfig.key=e,n.editConfig.value=n.profile[e],e){case"name":n.editConfig.title="设置群名称",n.editConfig.placeholder="请输入群名称",n.editConfig.type="input";break;case"groupID":n.editConfig.title="设置群ID",n.editConfig.placeholder="请输入群ID",n.editConfig.type="input";break;case"type":n.editConfig.title="选择群类型",n.editConfig.type="select"}},selectedEdit:e=>{n.editConfig.value!==e.type&&(n.editConfig.value=e.type)},groupTypeDetail:i}}}),zD=e=>(F("data-v-55cd6086"),e=e(),V(),e),WD={class:"group-box"},YD={key:0},$D={key:1},JD={key:0,class:"group-list"},XD={class:"group-list-item"},ZD=["src"],QD={class:"group-list-item"},ew={class:"content"},tw=zD((()=>P("i",{class:"icon icon-right"},null,-1))),nw={class:"group-list-item"},iw={class:"content"},rw=zD((()=>P("i",{class:"icon icon-right"},null,-1))),ow={class:"group-list-introduction"},aw={class:"group-list-item"},sw={key:0,class:"select"},cw=["onClick"],uw={class:"select-item-header"},lw={class:"left"},dw=["src"],pw={class:"select-item-label"},hw={key:0,class:"icon icon-selected"},fw={class:"select-item-detail"},gw=["href"],mw={class:"content"},vw=zD((()=>P("i",{class:"icon icon-right"},null,-1))),_w={key:0,class:"group-h5-list-item-introduction"},yw={class:"introduction-name"},Iw={class:"introduction-detail"},Mw=["href"],Tw={key:1,class:"group-list group-list-edit"},Cw=["placeholder"],Sw={key:1,class:"select"},Ew=["onClick"],kw={class:"select-item-header"},bw={class:"left"},Dw=["src"],ww={class:"select-item-label"},Aw={key:0,class:"icon icon-selected"},Rw={class:"select-item-detail"},Lw=["href"],Ow={class:"group-profile-footer"},Nw=["disabled"];const Pw=D(KD,[["render",function(e,t,n,i,r,o){return w(),A("div",{class:G(["group",[e.isH5?"group-h5":""]])},[P("div",WD,[P("header",null,[e.isEdit?(w(),A("h1",$D,L(e.$t(`TUISearch.${e.editConfig.title}`)),1)):(w(),A("h1",YD,L(e.$t("TUISearch.发起群聊")),1)),P("i",{class:G(["icon",[e.isH5?"icon-back":"icon-close"]]),onClick:t[0]||(t[0]=(...t)=>e.cancel&&e.cancel(...t))},null,2)]),e.isEdit?(w(),A("div",Tw,["input"===e.editConfig.type?z((w(),A("input",{key:0,type:"text","onUpdate:modelValue":t[6]||(t[6]=t=>e.editConfig.value=t),placeholder:e.$t(`TUISearch.${e.editConfig.placeholder}`)},null,8,Cw)),[[ee,e.editConfig.value]]):(w(),A("ul",Sw,[(w(!0),A(_,null,R(e.type,((t,n)=>(w(),A("li",{class:G(["select-item",[e.editConfig.value===t.type&&"selected"]]),key:n,onClick:n=>e.selectedEdit(t)},[P("main",null,[P("div",kw,[P("aside",bw,[P("img",{class:"icon",src:t.icon},null,8,Dw),P("span",ww,L(t.label),1)]),e.editConfig.value===t.type?(w(),A("i",Aw)):O("",!0)]),P("span",Rw,L(e.$t(`TUISearch.${t.detail}`)),1),P("a",{href:e.Link.product.url,target:"view_window"},L(e.$t(`TUISearch.${t.src}`)),9,Lw)])],10,Ew)))),128))]))])):(w(),A("ul",JD,[P("li",XD,[P("label",null,L(e.$t("TUISearch.群头像")),1),P("img",{class:"icon",src:e.profile.avatar},null,8,ZD)]),P("ul",null,[P("li",QD,[P("label",null,L(e.$t("TUISearch.群名称")),1),e.isH5?(w(),A("span",{key:1,class:"group-h5-list-item-content",onClick:t[2]||(t[2]=t=>e.edit("name"))},[P("p",ew,L(e.profile.name),1),tw])):z((w(),A("input",{key:0,type:"text","onUpdate:modelValue":t[1]||(t[1]=t=>e.profile.name=t),placeholder:"请输入群名称"},null,512)),[[ee,e.profile.name]])]),P("li",nw,[P("label",null,[oe(L(e.$t("TUISearch.群ID")),1),P("text",null,"("+L(e.$t("TUISearch.选填"))+")",1)]),e.isH5?(w(),A("span",{key:1,class:"group-h5-list-item-content",onClick:t[4]||(t[4]=t=>e.edit("groupID"))},[P("p",iw,L(e.profile.groupID),1),rw])):z((w(),A("input",{key:0,type:"text","onUpdate:modelValue":t[3]||(t[3]=t=>e.profile.groupID=t)},null,512)),[[ee,e.profile.groupID]])]),P("li",ow,[P("div",aw,[P("label",null,L(e.$t("TUISearch.群类型")),1),e.isH5?(w(),A("span",{key:1,class:"group-h5-list-item-content",onClick:t[5]||(t[5]=t=>e.edit("type"))},[P("p",mw,L(e.groupTypeDetail.label),1),vw])):(w(),A("ul",sw,[(w(!0),A(_,null,R(e.type,((t,n)=>(w(),A("li",{class:G(["select-item",[e.profile.type===t.type&&"selected"]]),key:n,onClick:n=>e.selected(t)},[P("main",null,[P("div",uw,[P("aside",lw,[P("img",{class:"icon",src:t.icon},null,8,dw),P("span",pw,L(t.label),1)]),e.profile.type===t.type?(w(),A("i",hw)):O("",!0)]),P("span",fw,L(e.$t(`TUISearch.${t.detail}`)),1),P("a",{href:e.Link.product.url,target:"view_window"},L(e.$t(`TUISearch.${t.src}`)),9,gw)])],10,cw)))),128))]))]),e.isH5?(w(),A("article",_w,[P("label",yw,L(e.groupTypeDetail.label)+"：",1),P("span",Iw,L(e.$t(`TUISearch.${e.groupTypeDetail.detail}`)),1),P("a",{href:e.Link.product.url,target:"view_window"},L(e.$t(`TUISearch.${e.groupTypeDetail.src}`)),9,Mw)])):O("",!0)])])])),P("footer",Ow,[e.isEdit||e.isH5?O("",!0):(w(),A("button",{key:0,class:"btn-default",onClick:t[7]||(t[7]=(...t)=>e.cancel&&e.cancel(...t))},L(e.$t("TUISearch.取消")),1)),P("button",{class:"btn-submit",onClick:t[8]||(t[8]=t=>e.submit(e.profile)),disabled:""===e.profile.name&&!e.isEdit},L(e.$t("TUISearch.创建")),9,Nw)])])],2)}],["__scopeId","data-v-55cd6086"]]),Uw=S({name:"TUISearch",components:{Transfer:xc,Dialog:wu,CreateGroup:Pw},setup(e){var t,n,i;const r=null==Uw?void 0:Uw.TUIServer,{t:o}=r.TUICore.config.i18n.useI18n(),a=E({open:!1,searchUserID:"",selectedList:[],allUserList:[],searchUserList:[],step:1,group:{groupID:"",name:"",type:"",avatar:"",introduction:"",notification:"",joinOption:"",memberList:[{userID:""}]},showTitle:"",createConversationType:"",env:r.TUICore.TUIEnv,optionalShow:!r.TUICore.TUIEnv.isH5,needSearch:!r.TUICore.isOfficial});r.bind(a);const s=null==(n=null==(t=null==r?void 0:r.TUICore)?void 0:t.TUIServer)?void 0:n.TUIGroup;Pw.TUIServer=r;const c=(null==(i=null==window?void 0:window.TUIKitTUICore)?void 0:i.isOfficial)&&Co&&Co()||{},u=f();Pa(u,(()=>{a.env.isH5&&(a.optionalShow=!1,a.searchUserList=[...a.allUserList])}));const l=()=>{a.group={groupID:"",name:"",type:"",avatar:"",introduction:"",notification:"",joinOption:"",memberList:[{userID:""}]}},d=()=>{a.open=!a.open,a.open||(a.searchUserID="",a.step=1,l())},p=(e,t)=>{const n=`${t}${e}`;r.getConversationProfile(n).then((e=>{r.TUICore.TUIServer.TUIConversation.handleCurrentConversation(e.data.conversation),Mo.getInstance().reportEvent({name:"conversationType",ext1:"C2C"===t?"TypeC2C-success":"TypeGroup-success"})}))};return{...b(a),toggleOpen:d,handleSearch:async e=>{try{const t=await r.getUserProfile([e]);if(!t.data.length)return ns(o("TUISearch.该用户不存在"),a.env),void(a.searchUserList=[...a.allUserList]);a.searchUserList=t.data;const n=a.allUserList.filter((e=>e.userID===t.data[0].userID));a.allUserList=n.length?a.allUserList:[...a.allUserList,...a.searchUserList]}catch(t){return ns(o("TUISearch.该用户不存在"),a.env),void(a.searchUserList=[...a.allUserList])}},submit:e=>{if(a.createConversationType===er.typeC2C){const{userID:t}=e[0];p(t,"C2C"),d()}else{if(!Pw.TUIServer){ns(o("TUISearch.创建群聊，请注册 TUIGroup 模块"),a.env)}l(),a.group.memberList=e.map((e=>({userID:e.userID}))),a.step=2}a.searchUserList=[...a.allUserList]},create:async e=>{var t;e.type===r.TUICore.TIM.TYPES.GRP_PUBLIC&&(a.group.joinOption=r.TUICore.TIM.TYPES.JOIN_OPTIONS_NEED_PERMISSION);const n={...a.group,...e};e.type===r.TUICore.TIM.TYPES.GRP_AVCHATROOM&&(delete n.memberList,delete n.joinOption);try{const l=await s.createGroup(n),h=o("TUISearch.创建成功");i=h,u=a.env,Za({message:i,isH5:!!(null==u?void 0:u.isH5),type:"success"}),(null==(t=null==window?void 0:window.TUIKitTUICore)?void 0:t.isOfficial)&&(null==c?void 0:c.commit)&&(null==c||c.commit("handleTask",3)),d(),e.type===r.TUICore.TIM.TYPES.GRP_AVCHATROOM&&s.joinGroup({groupID:l.data.group.groupID,applyMessage:"",type:l.data.group.type}),p(l.data.group.groupID,"GROUP")}catch(l){ns(l,a.env)}var i,u},showOpen:e=>{switch(a.open=!0,Mo.getInstance().reportEvent({name:"conversationType",ext1:"createConversation"}),a.searchUserList=[...a.allUserList],e){case"isC2C":return a.createConversationType=er.typeC2C,a.showTitle=o("TUISearch.发起单聊"),Mo.getInstance().reportEvent({name:"conversationType",ext1:"createConversation-c2c"}),a.showTitle;case"isGroup":return a.createConversationType=er.typeGroup,a.showTitle=o("TUISearch.发起群聊"),Mo.getInstance().reportEvent({name:"conversationType",ext1:"createConversation-group"}),a.showTitle}},toggleOptionalShow:()=>{a.env.isH5&&(a.optionalShow=!a.optionalShow)},dialog:u}}}),xw=e=>(F("data-v-762821f8"),e=e(),V(),e),Gw=xw((()=>P("i",{class:"plus"},null,-1))),Fw={key:0},Vw={key:0,class:"icon icon-c2c"},qw=xw((()=>P("i",{class:"icon icon-group"},null,-1)));const Bw=D(Uw,[["render",function(e,t,n,i,r,o){const a=J("Transfer"),s=J("CreateGroup"),c=J("Dialog");return w(),A("div",{class:G(["TUI-search",[e.env.isH5?"TUI-search-H5":""]]),ref:"dialog"},[P("header",{onClick:t[2]||(t[2]=(...t)=>e.toggleOptionalShow&&e.toggleOptionalShow(...t))},[Gw,e.env.isH5?(w(),A("h1",Fw,L(e.$t("TUISearch.发起会话")),1)):O("",!0),z(P("ul",null,[P("li",null,[e.env.isH5?(w(),A("i",Vw)):O("",!0),P("h1",{onClick:t[0]||(t[0]=t=>e.showOpen("isC2C"))},L(e.$t("TUISearch.发起单聊")),1)]),P("li",null,[qw,P("h1",{onClick:t[1]||(t[1]=t=>e.showOpen("isGroup"))},L(e.$t("TUISearch.ai")),1)])],512),[[W,e.optionalShow]])]),M(c,{show:e.open,isH5:e.env.isH5,isHeaderShow:!1,isFooterShow:!1,background:!1,"onUpdate:show":t[3]||(t[3]=t=>e.open=t)},{default:K((()=>[1===e.step?(w(),j(a,{key:0,isSearch:e.needSearch,title:e.showTitle,list:e.searchUserList,isH5:e.env.isH5,isRadio:"isC2C"===e.createConversationType,onSearch:e.handleSearch,onSubmit:e.submit,onCancel:e.toggleOpen},null,8,["isSearch","title","list","isH5","isRadio","onSearch","onSubmit","onCancel"])):(w(),j(s,{key:1,onSubmit:e.create,onCancel:e.toggleOpen,isH5:e.env.isH5},null,8,["onSubmit","onCancel","isH5"]))])),_:1},8,["show","isH5"])],2)}],["__scopeId","data-v-762821f8"]]),Hw={name:"TUISearch",component:Bw,server:jD,install:e=>{Bw.TUIServer=Hw.server,e.component(Hw.name,Bw)},plugin:e=>(Hw.server=new jD(e),e.component(Hw.name,Hw),Hw)},jw=[LT,rC,Mb,bb,HD,Hw],Kw={name:"TUIComponents",version:"1.0.0",TUIChat:LT,TUIConversation:rC,TUIProfile:Mb,TUIGroup:bb,TUIContact:HD,TUISearch:Hw,install:e=>{jw.forEach((t=>{t.install(e)}))},plugin:e=>{jw.forEach((t=>{t.plugin(e)}))}};var zw={},Ww={get exports(){return zw},set exports(e){zw=e}};!function(e,t){var n;n=function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){a(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),c="undefined"!=typeof qq&&"function"==typeof qq.getSystemInfoSync&&Boolean(qq.getSystemInfoSync().fontSizeSetting),u="undefined"!=typeof tt&&"function"==typeof tt.getSystemInfoSync&&Boolean(tt.getSystemInfoSync().fontSizeSetting),l="undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync&&Boolean(swan.getSystemInfoSync().fontSizeSetting),d="undefined"!=typeof my&&"function"==typeof my.getSystemInfoSync&&Boolean(my.getSystemInfoSync().fontSizeSetting),p="undefined"!=typeof uni&&"undefined"==typeof window&&"function"==typeof uni.requireNativePlugin,h=p&&"ios"===uni.getDeviceInfo().platform.toLocaleLowerCase(),f=(p&&uni.getDeviceInfo().platform.toLocaleLowerCase(),s||c||u||l||d||p),g=c?qq:u?tt:l?swan:d?my:s?wx:p?uni:{},m=function(e){if("object"!==n(e)||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var i=t;null!==Object.getPrototypeOf(i);)i=Object.getPrototypeOf(i);return t===i};function v(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(m(e)){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}return!1}var _=function(){function e(){i(this,e)}return o(e,[{key:"request",value:function(e,t){var n=this,i=e.downloadUrl||"",r=(e.method||"PUT").toUpperCase(),o=e.url;if(e.qs){var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"&",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"=";return v(e)?"":m(e)?Object.keys(e).map((function(i){var r=encodeURIComponent(i)+n;return Array.isArray(e[i])?e[i].map((function(e){return r+encodeURIComponent(e)})).join(t):r+encodeURIComponent(e[i])})).filter(Boolean).join(t):void 0}(e.qs);a&&(o+="".concat(-1===o.indexOf("?")?"?":"&").concat(a))}var s=new XMLHttpRequest;s.open(r,o,!0),s.responseType=e.dataType||"text";var c=e.headers||{};if(!v(c))for(var u in c)c.hasOwnProperty(u)&&"content-length"!==u.toLowerCase()&&"user-agent"!==u.toLowerCase()&&"origin"!==u.toLowerCase()&&"host"!==u.toLowerCase()&&s.setRequestHeader(u,c[u]);return s.onload=function(){if(200===s.status)t(null,n._xhrRes(s,n._xhrBody(s,i)));else{var e={code:s.status,message:JSON.stringify(s.responseText)};t(e,n._xhrRes(s,n._xhrBody(s)))}},s.onerror=function(e){var i=n._xhrBody(s),r={code:s.status,message:JSON.stringify(s.responseText)};i||s.statusText||0!==s.status||(e.message="CORS blocked or network error"),t(r,n._xhrRes(s,i)),r=null},e.onProgress&&s.upload&&(s.upload.onprogress=function(t){var n=t.total,i=t.loaded,r=Math.floor(100*i/n);e.onProgress({total:n,loaded:i,percent:(r>=100?100:r)/100})}),s.send(e.resources),s}},{key:"_xhrRes",value:function(e,t){var n={};return e.getAllResponseHeaders().trim().split("\n").forEach((function(e){if(e){var t=e.indexOf(":"),i=e.substr(0,t).trim().toLowerCase(),r=e.substr(t+1).trim();n[i]=r}})),{statusCode:e.status,statusMessage:e.statusText,headers:n,data:t}}},{key:"_xhrBody",value:function(e,t){return 200===e.status&&t?{location:t}:{response:e.responseText}}}]),e}(),y=["unknown","image","video","audio","log"],I=["name"],M=function(){function e(){i(this,e)}return o(e,[{key:"request",value:function(e,n){var i=this,r=e.resources,o=void 0===r?"":r,a=e.headers,s=void 0===a?{}:a,c=e.url,u=e.downloadUrl,l=void 0===u?"":u,p=c,f=null,m=l.match(/^(https?:\/\/[^/]+\/)([^/]*\/?)(.*)$/),v=decodeURIComponent(m[3]),_={key:v.indexOf("?")>-1?v.split("?")[0]:v,success_action_status:200,"Content-Type":""},M={};if(h){var T=c.split("?sign=");if(T.length>1){var C=T[1];p="".concat(T[0],"?sign=").concat(encodeURIComponent("".concat(C))),M.sign=decodeURIComponent(C),M.signature=decodeURIComponent(C)}}var S={url:p,header:s,name:"file",filePath:o,formData:t(t({},_),M),timeout:e.timeout||3e5};if(d){var E=S;E.name,S=t(t({},function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(E,I)),{},{fileName:"file",fileType:y[e.fileType]})}return(f=g.uploadFile(t(t({},S),{},{success:function(e){i._handleResponse({response:e,downloadUrl:l,callback:n})},fail:function(e){i._handleResponse({response:e,downloadUrl:l,callback:n})}}))).onProgressUpdate&&f.onProgressUpdate((function(t){e.onProgress&&e.onProgress({total:t.totalBytesExpectedToSend,loaded:t.totalBytesSent,percent:Math.floor(t.progress)/100})})),f}},{key:"_handleResponse",value:function(e){var n=e.downloadUrl,i=e.response,r=e.callback,o=i.header,a={};if(o)for(var s in o)o.hasOwnProperty(s)&&(a[s.toLowerCase()]=o[s]);var c=+i.statusCode;200===c?r(null,{statusCode:c,headers:a,data:t(t({},i.data),{},{location:n})}):r({code:c,message:JSON.stringify(i.data)},{statusCode:c,headers:a,data:void 0})}}]),e}();return function(){function e(){i(this,e),this.retry=1,this.tryCount=0,this.systemClockOffset=0,this.httpRequest=f?new M:new _}return o(e,[{key:"uploadFile",value:function(e,t){var n=this;return this.httpRequest.request(e,(function(i,r){i&&n.tryCount<n.retry&&n.allowRetry(i)?(n.tryCount++,n.uploadFile(e,t)):(n.tryCount=0,t(i,r))}))}},{key:"allowRetry",value:function(e){var t=!1,n=!1;if(e){var i=e.headers&&(e.headers.date||e.headers.Date)||e.error&&e.error.ServerTime;try{var r=e.error&&e.error.Code,o=e.error&&e.error.Message;("RequestTimeTooSkewed"===r||"AccessDenied"===r&&"Request has expired"===o)&&(n=!0)}catch(c){}if(n&&i){var a=Date.now(),s=Date.parse(i);Math.abs(a+this.systemClockOffset-s)>=3e4&&(this.systemClockOffset=s-a,t=!0)}else 5===Math.floor(e.statusCode/100)&&(t=!0)}return t}}]),e}()},Ww.exports=n()}();var Yw={};({get exports(){return Yw},set exports(e){Yw=e}}).exports=function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);a=!0);}catch(c){s=!0,r=c}finally{try{a||null==n.return||n.return()}finally{if(s)throw r}}return o}}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=o(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw a}}}}var c,u,l=function(){for(var e=" \t\r\n~!@#$%^&*()_+-=【】、{}|;':\"，。、《》？αβγδεζηθικλμνξοπρστυφχψωΑΒΓΔΕΖΗΘΙΚΛΜΝΞΟΠΡΣΤΥΦΧΨΩ。，、；：？！…—·ˉ¨‘’“”々～‖∶＂＇｀｜〃〔〕〈〉《》「」『』．〖〗【】（）［］｛｝ⅠⅡⅢⅣⅤⅥⅦⅧⅨⅩⅪⅫ⒈⒉⒊⒋⒌⒍⒎⒏⒐⒑⒒⒓⒔⒕⒖⒗⒘⒙⒚⒛㈠㈡㈢㈣㈤㈥㈦㈧㈨㈩①②③④⑤⑥⑦⑧⑨⑩⑴⑵⑶⑷⑸⑹⑺⑻⑼⑽⑾⑿⒀⒁⒂⒃⒄⒅⒆⒇≈≡≠＝≤≥＜＞≮≯∷±＋－×÷／∫∮∝∞∧∨∑∏∪∩∈∵∴⊥∥∠⌒⊙≌∽√§№☆★○●◎◇◆□℃‰€■△▲※→←↑↓〓¤°＃＆＠＼︿＿￣―♂♀┌┍┎┐┑┒┓─┄┈├┝┞┟┠┡┢┣│┆┊┬┭┮┯┰┱┲┳┼┽┾┿╀╁╂╃└┕┖┗┘┙┚┛━┅┉┤┥┦┧┨┩┪┫┃┇┋┴┵┶┷┸┹┺┻╋╊╉╈╇╆╅╄",t=new Map,n=0,i=e.length;n<i;n++)t.set(e.charCodeAt(0),!0);return t}(),d=function(){function t(n){e(this,t);var i,o=n.input,a=n.isArray,s=n.isMap;this._trieTree={},a(o)?i=o:s(o)&&(i=r(o.keys()),this._map=o);for(var c=0,u=i.length;c<u;c++)if(i[c]){for(var l=this._trieTree,d=i[c],p=0,h=d.length;p<h;p++)l[d[p]]||(l[d[p]]={}),l=l[d[p]];l.isEnd=!0}}return n(t,[{key:"filter",value:function(e){var t=e.text,n=e.replacingEnabled;if(0===Object.keys(this._trieTree).length)return{isMatched:!1,modifiedText:t};for(var i=this._trieTree,r=t,o=!1,a=t.length,s=0;s<a;s++)if(!0!==l.get(t.charCodeAt(s))){for(var c=0,u="",d=!1,p=s;p<a;p++){if(!i[t[p]]){i=this._trieTree;break}if(u+=t[p],i[t[p]].isEnd){d=!0,c=p-s,i=this._trieTree;break}i=i[t[p]]}if(c>1&&(s+=c),d){if(o=!0,!n)break;var h=this._map.get(u)||"*";r=r.replace(new RegExp(u,"g"),h)}}return{isMatched:o,modifiedText:r}}},{key:"reset",value:function(){this._trieTree={},this._map=null}}]),t}(),p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==C?C:"undefined"!=typeof self?self:{},h={},f=(c=function(e,t){var n,i,r,o,a,s,c,u,l,d,f,g,m;e.exports=(s=s||function(e,t){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==p&&p.crypto&&(n=p.crypto),!n)try{n=h}catch(v){}var i=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(v){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(v){}}throw new Error("Native crypto module could not be used to get secure random number.")},r=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),o={},a=o.lib={},s=a.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes,r=e.sigBytes;if(this.clamp(),i%4)for(var o=0;o<r;o++){var a=n[o>>>2]>>>24-o%4*8&255;t[i+o>>>2]|=a<<24-(i+o)%4*8}else for(o=0;o<r;o+=4)t[i+o>>>2]=n[o>>>2];return this.sigBytes+=r,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(i());return new c.init(t,e)}}),u=o.enc={},l=u.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var o=t[r>>>2]>>>24-r%4*8&255;i.push((o>>>4).toString(16)),i.push((15&o).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new c.init(n,t/2)}},d=u.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var o=t[r>>>2]>>>24-r%4*8&255;i.push(String.fromCharCode(o))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new c.init(n,t)}},f=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},g=a.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,i=this._data,r=i.words,o=i.sigBytes,a=this.blockSize,s=o/(4*a),u=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,l=e.min(4*u,o);if(u){for(var d=0;d<u;d+=a)this._doProcessBlock(r,d);n=r.splice(0,u),i.sigBytes-=l}return new c.init(n,l)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),m=(a.Hasher=g.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new m.HMAC.init(e,n).finalize(t)}}}),o.algo={});return o}(Math),a=(o=s).lib.WordArray,o.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp();for(var r=[],o=0;o<n;o+=3)for(var a=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,s=0;s<4&&o+.75*s<n;s++)r.push(i.charAt(a>>>6*(3-s)&63));var c=i.charAt(64);if(c)for(;r.length%4;)r.push(c);return r.join("")},parse:function(e){var t=e.length,n=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var r=0;r<n.length;r++)i[n.charCodeAt(r)]=r}var o=n.charAt(64);if(o){var s=e.indexOf(o);-1!==s&&(t=s)}return function(e,t,n){for(var i=[],r=0,o=0;o<t;o++)if(o%4){var s=n[e.charCodeAt(o-1)]<<o%4*2|n[e.charCodeAt(o)]>>>6-o%4*2;i[r>>>2]|=s<<24-r%4*8,r++}return a.create(i,r)}(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){var t=s,n=t.lib,i=n.WordArray,r=n.Hasher,o=t.algo,a=[];!function(){for(var t=0;t<64;t++)a[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=o.MD5=r.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var i=t+n,r=e[i];e[i]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var o=this._hash.words,s=e[t+0],c=e[t+1],h=e[t+2],f=e[t+3],g=e[t+4],m=e[t+5],v=e[t+6],_=e[t+7],y=e[t+8],I=e[t+9],M=e[t+10],T=e[t+11],C=e[t+12],S=e[t+13],E=e[t+14],k=e[t+15],b=o[0],D=o[1],w=o[2],A=o[3];b=u(b,D,w,A,s,7,a[0]),A=u(A,b,D,w,c,12,a[1]),w=u(w,A,b,D,h,17,a[2]),D=u(D,w,A,b,f,22,a[3]),b=u(b,D,w,A,g,7,a[4]),A=u(A,b,D,w,m,12,a[5]),w=u(w,A,b,D,v,17,a[6]),D=u(D,w,A,b,_,22,a[7]),b=u(b,D,w,A,y,7,a[8]),A=u(A,b,D,w,I,12,a[9]),w=u(w,A,b,D,M,17,a[10]),D=u(D,w,A,b,T,22,a[11]),b=u(b,D,w,A,C,7,a[12]),A=u(A,b,D,w,S,12,a[13]),w=u(w,A,b,D,E,17,a[14]),b=l(b,D=u(D,w,A,b,k,22,a[15]),w,A,c,5,a[16]),A=l(A,b,D,w,v,9,a[17]),w=l(w,A,b,D,T,14,a[18]),D=l(D,w,A,b,s,20,a[19]),b=l(b,D,w,A,m,5,a[20]),A=l(A,b,D,w,M,9,a[21]),w=l(w,A,b,D,k,14,a[22]),D=l(D,w,A,b,g,20,a[23]),b=l(b,D,w,A,I,5,a[24]),A=l(A,b,D,w,E,9,a[25]),w=l(w,A,b,D,f,14,a[26]),D=l(D,w,A,b,y,20,a[27]),b=l(b,D,w,A,S,5,a[28]),A=l(A,b,D,w,h,9,a[29]),w=l(w,A,b,D,_,14,a[30]),b=d(b,D=l(D,w,A,b,C,20,a[31]),w,A,m,4,a[32]),A=d(A,b,D,w,y,11,a[33]),w=d(w,A,b,D,T,16,a[34]),D=d(D,w,A,b,E,23,a[35]),b=d(b,D,w,A,c,4,a[36]),A=d(A,b,D,w,g,11,a[37]),w=d(w,A,b,D,_,16,a[38]),D=d(D,w,A,b,M,23,a[39]),b=d(b,D,w,A,S,4,a[40]),A=d(A,b,D,w,s,11,a[41]),w=d(w,A,b,D,f,16,a[42]),D=d(D,w,A,b,v,23,a[43]),b=d(b,D,w,A,I,4,a[44]),A=d(A,b,D,w,C,11,a[45]),w=d(w,A,b,D,k,16,a[46]),b=p(b,D=d(D,w,A,b,h,23,a[47]),w,A,s,6,a[48]),A=p(A,b,D,w,_,10,a[49]),w=p(w,A,b,D,E,15,a[50]),D=p(D,w,A,b,m,21,a[51]),b=p(b,D,w,A,C,6,a[52]),A=p(A,b,D,w,f,10,a[53]),w=p(w,A,b,D,M,15,a[54]),D=p(D,w,A,b,c,21,a[55]),b=p(b,D,w,A,y,6,a[56]),A=p(A,b,D,w,k,10,a[57]),w=p(w,A,b,D,v,15,a[58]),D=p(D,w,A,b,S,21,a[59]),b=p(b,D,w,A,g,6,a[60]),A=p(A,b,D,w,T,10,a[61]),w=p(w,A,b,D,h,15,a[62]),D=p(D,w,A,b,I,21,a[63]),o[0]=o[0]+b|0,o[1]=o[1]+D|0,o[2]=o[2]+w|0,o[3]=o[3]+A|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;n[r>>>5]|=128<<24-r%32;var o=e.floor(i/4294967296),a=i;n[15+(r+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),n[14+(r+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(n.length+1),this._process();for(var s=this._hash,c=s.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return s},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,n,i,r,o,a){var s=e+(t&n|~t&i)+r+a;return(s<<o|s>>>32-o)+t}function l(e,t,n,i,r,o,a){var s=e+(t&i|n&~i)+r+a;return(s<<o|s>>>32-o)+t}function d(e,t,n,i,r,o,a){var s=e+(t^n^i)+r+a;return(s<<o|s>>>32-o)+t}function p(e,t,n,i,r,o,a){var s=e+(n^(t|~i))+r+a;return(s<<o|s>>>32-o)+t}t.MD5=r._createHelper(c),t.HmacMD5=r._createHmacHelper(c)}(Math),u=(c=s).lib,l=u.WordArray,d=u.Hasher,f=c.algo,g=[],m=f.SHA1=d.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],c=0;c<80;c++){if(c<16)g[c]=0|e[t+c];else{var u=g[c-3]^g[c-8]^g[c-14]^g[c-16];g[c]=u<<1|u>>>31}var l=(i<<5|i>>>27)+s+g[c];l+=c<20?1518500249+(r&o|~r&a):c<40?1859775393+(r^o^a):c<60?(r&o|r&a|o&a)-1894007588:(r^o^a)-899497514,s=a,a=o,o=r<<30|r>>>2,r=i,i=l}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(i+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=d.clone.call(this);return e._hash=this._hash.clone(),e}}),c.SHA1=d._createHelper(m),c.HmacSHA1=d._createHmacHelper(m),function(e){var t=s,n=t.lib,i=n.WordArray,r=n.Hasher,o=t.algo,a=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),i=2;i<=n;i++)if(!(t%i))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var i=2,r=0;r<64;)t(i)&&(r<8&&(a[r]=n(e.pow(i,.5))),c[r]=n(e.pow(i,1/3)),r++),i++}();var u=[],l=o.SHA256=r.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],d=n[6],p=n[7],h=0;h<64;h++){if(h<16)u[h]=0|e[t+h];else{var f=u[h-15],g=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,m=u[h-2],v=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;u[h]=g+u[h-7]+v+u[h-16]}var _=i&r^i&o^r&o,y=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),I=p+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&l^~s&d)+c[h]+u[h];p=d,d=l,l=s,s=a+I|0,a=o,o=r,r=i,i=I+(y+_)|0}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0,n[5]=n[5]+l|0,n[6]=n[6]+d|0,n[7]=n[7]+p|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;return n[r>>>5]|=128<<24-r%32,n[14+(r+64>>>9<<4)]=e.floor(i/4294967296),n[15+(r+64>>>9<<4)]=i,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=r._createHelper(l),t.HmacSHA256=r._createHmacHelper(l)}(Math),function(){var e=s,t=e.lib.WordArray,n=e.enc;function i(e){return e<<8&4278255360|e>>>8&16711935}n.Utf16=n.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r+=2){var o=t[r>>>2]>>>16-r%4*8&65535;i.push(String.fromCharCode(o))}return i.join("")},parse:function(e){for(var n=e.length,i=[],r=0;r<n;r++)i[r>>>1]|=e.charCodeAt(r)<<16-r%2*16;return t.create(i,2*n)}},n.Utf16LE={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o+=2){var a=i(t[o>>>2]>>>16-o%4*8&65535);r.push(String.fromCharCode(a))}return r.join("")},parse:function(e){for(var n=e.length,r=[],o=0;o<n;o++)r[o>>>1]|=i(e.charCodeAt(o)<<16-o%2*16);return t.create(r,2*n)}}}(),function(){if("function"==typeof ArrayBuffer){var e=s.lib.WordArray,t=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var n=e.byteLength,i=[],r=0;r<n;r++)i[r>>>2]|=e[r]<<24-r%4*8;t.call(this,i,n)}else t.apply(this,arguments)}).prototype=e}}(),
/** @preserve
            (c) 2012 by C��dric Mesnil. All rights reserved.
              Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
                  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
                - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
              THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
            */
function(e){var t=s,n=t.lib,i=n.WordArray,r=n.Hasher,o=t.algo,a=i.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=i.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),u=i.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),l=i.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),d=i.create([0,1518500249,1859775393,2400959708,2840853838]),p=i.create([1352829926,1548603684,1836072691,2053994217,0]),h=o.RIPEMD160=r.extend({_doReset:function(){this._hash=i.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var i=t+n,r=e[i];e[i]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var o,s,h,I,M,T,C,S,E,k,b,D=this._hash.words,w=d.words,A=p.words,R=a.words,L=c.words,O=u.words,N=l.words;for(T=o=D[0],C=s=D[1],S=h=D[2],E=I=D[3],k=M=D[4],n=0;n<80;n+=1)b=o+e[t+R[n]]|0,b+=n<16?f(s,h,I)+w[0]:n<32?g(s,h,I)+w[1]:n<48?m(s,h,I)+w[2]:n<64?v(s,h,I)+w[3]:_(s,h,I)+w[4],b=(b=y(b|=0,O[n]))+M|0,o=M,M=I,I=y(h,10),h=s,s=b,b=T+e[t+L[n]]|0,b+=n<16?_(C,S,E)+A[0]:n<32?v(C,S,E)+A[1]:n<48?m(C,S,E)+A[2]:n<64?g(C,S,E)+A[3]:f(C,S,E)+A[4],b=(b=y(b|=0,N[n]))+k|0,T=k,k=E,E=y(S,10),S=C,C=b;b=D[1]+h+E|0,D[1]=D[2]+I+k|0,D[2]=D[3]+M+T|0,D[3]=D[4]+o+C|0,D[4]=D[0]+s+S|0,D[0]=b},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var r=this._hash,o=r.words,a=0;a<5;a++){var s=o[a];o[a]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}return r},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});function f(e,t,n){return e^t^n}function g(e,t,n){return e&t|~e&n}function m(e,t,n){return(e|~t)^n}function v(e,t,n){return e&n|t&~n}function _(e,t,n){return e^(t|~n)}function y(e,t){return e<<t|e>>>32-t}t.RIPEMD160=r._createHelper(h),t.HmacRIPEMD160=r._createHmacHelper(h)}(),function(){var e=s,t=e.lib.Base,n=e.enc.Utf8;e.algo.HMAC=t.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var i=e.blockSize,r=4*i;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),a=this._iKey=t.clone(),s=o.words,c=a.words,u=0;u<i;u++)s[u]^=1549556828,c[u]^=909522486;o.sigBytes=a.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})}(),function(){var e=s,t=e.lib,n=t.Base,i=t.WordArray,r=e.algo,o=r.SHA1,a=r.HMAC,c=r.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:o,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,r=a.create(n.hasher,e),o=i.create(),s=i.create([1]),c=o.words,u=s.words,l=n.keySize,d=n.iterations;c.length<l;){var p=r.update(t).finalize(s);r.reset();for(var h=p.words,f=h.length,g=p,m=1;m<d;m++){g=r.finalize(g),r.reset();for(var v=g.words,_=0;_<f;_++)h[_]^=v[_]}o.concat(p),u[0]++}return o.sigBytes=4*l,o}});e.PBKDF2=function(e,t,n){return c.create(n).compute(e,t)}}(),function(){var e=s,t=e.lib,n=t.Base,i=t.WordArray,r=e.algo,o=r.MD5,a=r.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:o,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n,r=this.cfg,o=r.hasher.create(),a=i.create(),s=a.words,c=r.keySize,u=r.iterations;s.length<c;){n&&o.update(n),n=o.update(e).finalize(t),o.reset();for(var l=1;l<u;l++)n=o.finalize(n),o.reset();a.concat(n)}return a.sigBytes=4*c,a}});e.EvpKDF=function(e,t,n){return a.create(n).compute(e,t)}}(),function(){var e=s,t=e.lib.WordArray,n=e.algo,i=n.SHA256,r=n.SHA224=i.extend({_doReset:function(){this._hash=new t.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=i._doFinalize.call(this);return e.sigBytes-=4,e}});e.SHA224=i._createHelper(r),e.HmacSHA224=i._createHmacHelper(r)}(),function(e){var t=s,n=t.lib,i=n.Base,r=n.WordArray,o=t.x64={};o.Word=i.extend({init:function(e,t){this.high=e,this.low=t}}),o.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],i=0;i<t;i++){var o=e[i];n.push(o.high),n.push(o.low)}return r.create(n,this.sigBytes)},clone:function(){for(var e=i.clone.call(this),t=e.words=this.words.slice(0),n=t.length,r=0;r<n;r++)t[r]=t[r].clone();return e}})}(),function(e){var t=s,n=t.lib,i=n.WordArray,r=n.Hasher,o=t.x64.Word,a=t.algo,c=[],u=[],l=[];!function(){for(var e=1,t=0,n=0;n<24;n++){c[e+5*t]=(n+1)*(n+2)/2%64;var i=(2*e+3*t)%5;e=t%5,t=i}for(e=0;e<5;e++)for(t=0;t<5;t++)u[e+5*t]=t+(2*e+3*t)%5*5;for(var r=1,a=0;a<24;a++){for(var s=0,d=0,p=0;p<7;p++){if(1&r){var h=(1<<p)-1;h<32?d^=1<<h:s^=1<<h-32}128&r?r=r<<1^113:r<<=1}l[a]=o.create(s,d)}}();var d=[];!function(){for(var e=0;e<25;e++)d[e]=o.create()}();var p=a.SHA3=r.extend({cfg:r.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new o.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,i=this.blockSize/2,r=0;r<i;r++){var o=e[t+2*r],a=e[t+2*r+1];o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),(D=n[r]).high^=a,D.low^=o}for(var s=0;s<24;s++){for(var p=0;p<5;p++){for(var h=0,f=0,g=0;g<5;g++)h^=(D=n[p+5*g]).high,f^=D.low;var m=d[p];m.high=h,m.low=f}for(p=0;p<5;p++){var v=d[(p+4)%5],_=d[(p+1)%5],y=_.high,I=_.low;for(h=v.high^(y<<1|I>>>31),f=v.low^(I<<1|y>>>31),g=0;g<5;g++)(D=n[p+5*g]).high^=h,D.low^=f}for(var M=1;M<25;M++){var T=(D=n[M]).high,C=D.low,S=c[M];S<32?(h=T<<S|C>>>32-S,f=C<<S|T>>>32-S):(h=C<<S-32|T>>>64-S,f=T<<S-32|C>>>64-S);var E=d[u[M]];E.high=h,E.low=f}var k=d[0],b=n[0];for(k.high=b.high,k.low=b.low,p=0;p<5;p++)for(g=0;g<5;g++){var D=n[M=p+5*g],w=d[M],A=d[(p+1)%5+5*g],R=d[(p+2)%5+5*g];D.high=w.high^~A.high&R.high,D.low=w.low^~A.low&R.low}D=n[0];var L=l[s];D.high^=L.high,D.low^=L.low}},_doFinalize:function(){var t=this._data,n=t.words,r=(this._nDataBytes,8*t.sigBytes),o=32*this.blockSize;n[r>>>5]|=1<<24-r%32,n[(e.ceil((r+1)/o)*o>>>5)-1]|=128,t.sigBytes=4*n.length,this._process();for(var a=this._state,s=this.cfg.outputLength/8,c=s/8,u=[],l=0;l<c;l++){var d=a[l],p=d.high,h=d.low;p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),u.push(h),u.push(p)}return new i.init(u,s)},clone:function(){for(var e=r.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});t.SHA3=r._createHelper(p),t.HmacSHA3=r._createHmacHelper(p)}(Math),function(){var e=s,t=e.lib.Hasher,n=e.x64,i=n.Word,r=n.WordArray,o=e.algo;function a(){return i.create.apply(i,arguments)}var c=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],u=[];!function(){for(var e=0;e<80;e++)u[e]=a()}();var l=o.SHA512=t.extend({_doReset:function(){this._hash=new r.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],d=n[6],p=n[7],h=i.high,f=i.low,g=r.high,m=r.low,v=o.high,_=o.low,y=a.high,I=a.low,M=s.high,T=s.low,C=l.high,S=l.low,E=d.high,k=d.low,b=p.high,D=p.low,w=h,A=f,R=g,L=m,O=v,N=_,P=y,U=I,x=M,G=T,F=C,V=S,q=E,B=k,H=b,j=D,K=0;K<80;K++){var z,W,Y=u[K];if(K<16)W=Y.high=0|e[t+2*K],z=Y.low=0|e[t+2*K+1];else{var $=u[K-15],J=$.high,X=$.low,Z=(J>>>1|X<<31)^(J>>>8|X<<24)^J>>>7,Q=(X>>>1|J<<31)^(X>>>8|J<<24)^(X>>>7|J<<25),ee=u[K-2],te=ee.high,ne=ee.low,ie=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,re=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),oe=u[K-7],ae=oe.high,se=oe.low,ce=u[K-16],ue=ce.high,le=ce.low;W=(W=(W=Z+ae+((z=Q+se)>>>0<Q>>>0?1:0))+ie+((z+=re)>>>0<re>>>0?1:0))+ue+((z+=le)>>>0<le>>>0?1:0),Y.high=W,Y.low=z}var de,pe=x&F^~x&q,he=G&V^~G&B,fe=w&R^w&O^R&O,ge=A&L^A&N^L&N,me=(w>>>28|A<<4)^(w<<30|A>>>2)^(w<<25|A>>>7),ve=(A>>>28|w<<4)^(A<<30|w>>>2)^(A<<25|w>>>7),_e=(x>>>14|G<<18)^(x>>>18|G<<14)^(x<<23|G>>>9),ye=(G>>>14|x<<18)^(G>>>18|x<<14)^(G<<23|x>>>9),Ie=c[K],Me=Ie.high,Te=Ie.low,Ce=H+_e+((de=j+ye)>>>0<j>>>0?1:0),Se=ve+ge;H=q,j=B,q=F,B=V,F=x,V=G,x=P+(Ce=(Ce=(Ce=Ce+pe+((de+=he)>>>0<he>>>0?1:0))+Me+((de+=Te)>>>0<Te>>>0?1:0))+W+((de+=z)>>>0<z>>>0?1:0))+((G=U+de|0)>>>0<U>>>0?1:0)|0,P=O,U=N,O=R,N=L,R=w,L=A,w=Ce+(me+fe+(Se>>>0<ve>>>0?1:0))+((A=de+Se|0)>>>0<de>>>0?1:0)|0}f=i.low=f+A,i.high=h+w+(f>>>0<A>>>0?1:0),m=r.low=m+L,r.high=g+R+(m>>>0<L>>>0?1:0),_=o.low=_+N,o.high=v+O+(_>>>0<N>>>0?1:0),I=a.low=I+U,a.high=y+P+(I>>>0<U>>>0?1:0),T=s.low=T+G,s.high=M+x+(T>>>0<G>>>0?1:0),S=l.low=S+V,l.high=C+F+(S>>>0<V>>>0?1:0),k=d.low=k+B,d.high=E+q+(k>>>0<B>>>0?1:0),D=p.low=D+j,p.high=b+H+(D>>>0<j>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[30+(i+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(i+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(l),e.HmacSHA512=t._createHmacHelper(l)}(),function(){var e=s,t=e.x64,n=t.Word,i=t.WordArray,r=e.algo,o=r.SHA512,a=r.SHA384=o.extend({_doReset:function(){this._hash=new i.init([new n.init(3418070365,3238371032),new n.init(1654270250,914150663),new n.init(2438529370,812702999),new n.init(355462360,4144912697),new n.init(1731405415,4290775857),new n.init(2394180231,1750603025),new n.init(3675008525,1694076839),new n.init(1203062813,3204075428)])},_doFinalize:function(){var e=o._doFinalize.call(this);return e.sigBytes-=16,e}});e.SHA384=o._createHelper(a),e.HmacSHA384=o._createHmacHelper(a)}(),s.lib.Cipher||function(e){var t=s,n=t.lib,i=n.Base,r=n.WordArray,o=n.BufferedBlockAlgorithm,a=t.enc,c=(a.Utf8,a.Base64),u=t.algo.EvpKDF,l=n.Cipher=o.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?y:v}return function(t){return{encrypt:function(n,i,r){return e(i).encrypt(t,n,i,r)},decrypt:function(n,i,r){return e(i).decrypt(t,n,i,r)}}}}()}),d=(n.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),t.mode={}),p=n.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),h=d.CBC=function(){var e=p.extend();function t(e,t,n){var i,r=this._iv;r?(i=r,this._iv=void 0):i=this._prevBlock;for(var o=0;o<n;o++)e[t+o]^=i[o]}return e.Encryptor=e.extend({processBlock:function(e,n){var i=this._cipher,r=i.blockSize;t.call(this,e,n,r),i.encryptBlock(e,n),this._prevBlock=e.slice(n,n+r)}}),e.Decryptor=e.extend({processBlock:function(e,n){var i=this._cipher,r=i.blockSize,o=e.slice(n,n+r);i.decryptBlock(e,n),t.call(this,e,n,r),this._prevBlock=o}}),e}(),f=(t.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,i=n-e.sigBytes%n,o=i<<24|i<<16|i<<8|i,a=[],s=0;s<i;s+=4)a.push(o);var c=r.create(a,i);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},g=(n.BlockCipher=l.extend({cfg:l.cfg.extend({mode:h,padding:f}),reset:function(){var e;l.reset.call(this);var t=this.cfg,n=t.iv,i=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=i.createEncryptor:(e=i.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,n&&n.words):(this._mode=e.call(i,this,n&&n.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),n.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),m=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;return(n?r.create([1398893684,1701076831]).concat(n).concat(t):t).toString(c)},parse:function(e){var t,n=c.parse(e),i=n.words;return 1398893684==i[0]&&1701076831==i[1]&&(t=r.create(i.slice(2,4)),i.splice(0,4),n.sigBytes-=16),g.create({ciphertext:n,salt:t})}},v=n.SerializableCipher=i.extend({cfg:i.extend({format:m}),encrypt:function(e,t,n,i){i=this.cfg.extend(i);var r=e.createEncryptor(n,i),o=r.finalize(t),a=r.cfg;return g.create({ciphertext:o,key:n,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:i.format})},decrypt:function(e,t,n,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),e.createDecryptor(n,i).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),_=(t.kdf={}).OpenSSL={execute:function(e,t,n,i){i||(i=r.random(8));var o=u.create({keySize:t+n}).compute(e,i),a=r.create(o.words.slice(t),4*n);return o.sigBytes=4*t,g.create({key:o,iv:a,salt:i})}},y=n.PasswordBasedCipher=v.extend({cfg:v.cfg.extend({kdf:_}),encrypt:function(e,t,n,i){var r=(i=this.cfg.extend(i)).kdf.execute(n,e.keySize,e.ivSize);i.iv=r.iv;var o=v.encrypt.call(this,e,t,r.key,i);return o.mixIn(r),o},decrypt:function(e,t,n,i){i=this.cfg.extend(i),t=this._parse(t,i.format);var r=i.kdf.execute(n,e.keySize,e.ivSize,t.salt);return i.iv=r.iv,v.decrypt.call(this,e,t,r.key,i)}})}(),s.mode.CFB=function(){var e=s.lib.BlockCipherMode.extend();function t(e,t,n,i){var r,o=this._iv;o?(r=o.slice(0),this._iv=void 0):r=this._prevBlock,i.encryptBlock(r,0);for(var a=0;a<n;a++)e[t+a]^=r[a]}return e.Encryptor=e.extend({processBlock:function(e,n){var i=this._cipher,r=i.blockSize;t.call(this,e,n,r,i),this._prevBlock=e.slice(n,n+r)}}),e.Decryptor=e.extend({processBlock:function(e,n){var i=this._cipher,r=i.blockSize,o=e.slice(n,n+r);t.call(this,e,n,r,i),this._prevBlock=o}}),e}(),s.mode.ECB=((r=s.lib.BlockCipherMode.extend()).Encryptor=r.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),r.Decryptor=r.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),r),s.pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,i=4*t,r=i-n%i,o=n+r-1;e.clamp(),e.words[o>>>2]|=r<<24-o%4*8,e.sigBytes+=r},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},s.pad.Iso10126={pad:function(e,t){var n=4*t,i=n-e.sigBytes%n;e.concat(s.lib.WordArray.random(i-1)).concat(s.lib.WordArray.create([i<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},s.pad.Iso97971={pad:function(e,t){e.concat(s.lib.WordArray.create([2147483648],1)),s.pad.ZeroPadding.pad(e,t)},unpad:function(e){s.pad.ZeroPadding.unpad(e),e.sigBytes--}},s.mode.OFB=(i=(n=s.lib.BlockCipherMode.extend()).Encryptor=n.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,r=this._iv,o=this._keystream;r&&(o=this._keystream=r.slice(0),this._iv=void 0),n.encryptBlock(o,0);for(var a=0;a<i;a++)e[t+a]^=o[a]}}),n.Decryptor=i,n),s.pad.NoPadding={pad:function(){},unpad:function(){}},function(e){var t=s,n=t.lib.CipherParams,i=t.enc.Hex;t.format.Hex={stringify:function(e){return e.ciphertext.toString(i)},parse:function(e){var t=i.parse(e);return n.create({ciphertext:t})}}}(),function(){var e=s,t=e.lib.BlockCipher,n=e.algo,i=[],r=[],o=[],a=[],c=[],u=[],l=[],d=[],p=[],h=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var n=0,s=0;for(t=0;t<256;t++){var f=s^s<<1^s<<2^s<<3^s<<4;f=f>>>8^255&f^99,i[n]=f,r[f]=n;var g=e[n],m=e[g],v=e[m],_=257*e[f]^16843008*f;o[n]=_<<24|_>>>8,a[n]=_<<16|_>>>16,c[n]=_<<8|_>>>24,u[n]=_,_=16843009*v^65537*m^257*g^16843008*n,l[f]=_<<24|_>>>8,d[f]=_<<16|_>>>16,p[f]=_<<8|_>>>24,h[f]=_,n?(n=g^e[e[e[v^g]]],s^=e[e[s]]):n=s=1}}();var f=[0,1,2,4,8,16,32,64,128,27,54],g=n.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,r=4*((this._nRounds=n+6)+1),o=this._keySchedule=[],a=0;a<r;a++)a<n?o[a]=t[a]:(u=o[a-1],a%n?n>6&&a%n==4&&(u=i[u>>>24]<<24|i[u>>>16&255]<<16|i[u>>>8&255]<<8|i[255&u]):(u=i[(u=u<<8|u>>>24)>>>24]<<24|i[u>>>16&255]<<16|i[u>>>8&255]<<8|i[255&u],u^=f[a/n|0]<<24),o[a]=o[a-n]^u);for(var s=this._invKeySchedule=[],c=0;c<r;c++){if(a=r-c,c%4)var u=o[a];else u=o[a-4];s[c]=c<4||a<=4?u:l[i[u>>>24]]^d[i[u>>>16&255]]^p[i[u>>>8&255]]^h[i[255&u]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,a,c,u,i)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,d,p,h,r),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,i,r,o,a,s){for(var c=this._nRounds,u=e[t]^n[0],l=e[t+1]^n[1],d=e[t+2]^n[2],p=e[t+3]^n[3],h=4,f=1;f<c;f++){var g=i[u>>>24]^r[l>>>16&255]^o[d>>>8&255]^a[255&p]^n[h++],m=i[l>>>24]^r[d>>>16&255]^o[p>>>8&255]^a[255&u]^n[h++],v=i[d>>>24]^r[p>>>16&255]^o[u>>>8&255]^a[255&l]^n[h++],_=i[p>>>24]^r[u>>>16&255]^o[l>>>8&255]^a[255&d]^n[h++];u=g,l=m,d=v,p=_}g=(s[u>>>24]<<24|s[l>>>16&255]<<16|s[d>>>8&255]<<8|s[255&p])^n[h++],m=(s[l>>>24]<<24|s[d>>>16&255]<<16|s[p>>>8&255]<<8|s[255&u])^n[h++],v=(s[d>>>24]<<24|s[p>>>16&255]<<16|s[u>>>8&255]<<8|s[255&l])^n[h++],_=(s[p>>>24]<<24|s[u>>>16&255]<<16|s[l>>>8&255]<<8|s[255&d])^n[h++],e[t]=g,e[t+1]=m,e[t+2]=v,e[t+3]=_},keySize:8});e.AES=t._createHelper(g)}(),function(){var e=s,t=e.lib,n=t.WordArray,i=t.BlockCipher,r=e.algo,o=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],u=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],l=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=r.DES=i.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;n<56;n++){var i=o[n]-1;t[n]=e[i>>>5]>>>31-i%32&1}for(var r=this._subKeys=[],s=0;s<16;s++){var u=r[s]=[],l=c[s];for(n=0;n<24;n++)u[n/6|0]|=t[(a[n]-1+l)%28]<<31-n%6,u[4+(n/6|0)]|=t[28+(a[n+24]-1+l)%28]<<31-n%6;for(u[0]=u[0]<<1|u[0]>>>31,n=1;n<7;n++)u[n]=u[n]>>>4*(n-1)+3;u[7]=u[7]<<5|u[7]>>>27}var d=this._invSubKeys=[];for(n=0;n<16;n++)d[n]=r[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,n){this._lBlock=e[t],this._rBlock=e[t+1],p.call(this,4,252645135),p.call(this,16,65535),h.call(this,2,858993459),h.call(this,8,16711935),p.call(this,1,1431655765);for(var i=0;i<16;i++){for(var r=n[i],o=this._lBlock,a=this._rBlock,s=0,c=0;c<8;c++)s|=u[c][((a^r[c])&l[c])>>>0];this._lBlock=a,this._rBlock=o^s}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,p.call(this,1,1431655765),h.call(this,8,16711935),h.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function p(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function h(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}e.DES=i._createHelper(d);var f=r.TripleDES=i.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),i=e.length<4?e.slice(0,2):e.slice(2,4),r=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=d.createEncryptor(n.create(t)),this._des2=d.createEncryptor(n.create(i)),this._des3=d.createEncryptor(n.create(r))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=i._createHelper(f)}(),function(){var e=s,t=e.lib.StreamCipher,n=e.algo,i=n.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,i=this._S=[],r=0;r<256;r++)i[r]=r;r=0;for(var o=0;r<256;r++){var a=r%n,s=t[a>>>2]>>>24-a%4*8&255;o=(o+i[r]+s)%256;var c=i[r];i[r]=i[o],i[o]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=r.call(this)},keySize:8,ivSize:0});function r(){for(var e=this._S,t=this._i,n=this._j,i=0,r=0;r<4;r++){n=(n+e[t=(t+1)%256])%256;var o=e[t];e[t]=e[n],e[n]=o,i|=e[(e[t]+e[n])%256]<<24-8*r}return this._i=t,this._j=n,i}e.RC4=t._createHelper(i);var o=n.RC4Drop=i.extend({cfg:i.cfg.extend({drop:192}),_doReset:function(){i._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)r.call(this)}});e.RC4Drop=t._createHelper(o)}(),
/** @preserve
             * Counter block mode compatible with  Dr Brian Gladman fileenc.c
             * derived from CryptoJS.mode.CTR
             * Jan Hruby jhruby.web@gmail.com
             */
s.mode.CTRGladman=function(){var e=s.lib.BlockCipherMode.extend();function t(e){if(255==(e>>24&255)){var t=e>>16&255,n=e>>8&255,i=255&e;255===t?(t=0,255===n?(n=0,255===i?i=0:++i):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=i}else e+=1<<24;return e}var n=e.Encryptor=e.extend({processBlock:function(e,n){var i,r=this._cipher,o=r.blockSize,a=this._iv,s=this._counter;a&&(s=this._counter=a.slice(0),this._iv=void 0),0===((i=s)[0]=t(i[0]))&&(i[1]=t(i[1]));var c=s.slice(0);r.encryptBlock(c,0);for(var u=0;u<o;u++)e[n+u]^=c[u]}});return e.Decryptor=n,e}(),function(){var e=s,t=e.lib.StreamCipher,n=e.algo,i=[],r=[],o=[],a=n.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,n=0;n<4;n++)e[n]=16711935&(e[n]<<8|e[n]>>>24)|4278255360&(e[n]<<24|e[n]>>>8);var i=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],r=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,n=0;n<4;n++)c.call(this);for(n=0;n<8;n++)r[n]^=i[n+4&7];if(t){var o=t.words,a=o[0],s=o[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),d=u>>>16|4294901760&l,p=l<<16|65535&u;for(r[0]^=u,r[1]^=d,r[2]^=l,r[3]^=p,r[4]^=u,r[5]^=d,r[6]^=l,r[7]^=p,n=0;n<4;n++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),i[0]=n[0]^n[5]>>>16^n[3]<<16,i[1]=n[2]^n[7]>>>16^n[5]<<16,i[2]=n[4]^n[1]>>>16^n[7]<<16,i[3]=n[6]^n[3]>>>16^n[1]<<16;for(var r=0;r<4;r++)i[r]=16711935&(i[r]<<8|i[r]>>>24)|4278255360&(i[r]<<24|i[r]>>>8),e[t+r]^=i[r]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)r[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<r[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<r[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<r[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<r[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<r[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<r[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<r[6]>>>0?1:0)|0,this._b=t[7]>>>0<r[7]>>>0?1:0,n=0;n<8;n++){var i=e[n]+t[n],a=65535&i,s=i>>>16,c=((a*a>>>17)+a*s>>>15)+s*s,u=((4294901760&i)*i|0)+((65535&i)*i|0);o[n]=c^u}e[0]=o[0]+(o[7]<<16|o[7]>>>16)+(o[6]<<16|o[6]>>>16)|0,e[1]=o[1]+(o[0]<<8|o[0]>>>24)+o[7]|0,e[2]=o[2]+(o[1]<<16|o[1]>>>16)+(o[0]<<16|o[0]>>>16)|0,e[3]=o[3]+(o[2]<<8|o[2]>>>24)+o[1]|0,e[4]=o[4]+(o[3]<<16|o[3]>>>16)+(o[2]<<16|o[2]>>>16)|0,e[5]=o[5]+(o[4]<<8|o[4]>>>24)+o[3]|0,e[6]=o[6]+(o[5]<<16|o[5]>>>16)+(o[4]<<16|o[4]>>>16)|0,e[7]=o[7]+(o[6]<<8|o[6]>>>24)+o[5]|0}e.Rabbit=t._createHelper(a)}(),s.mode.CTR=function(){var e=s.lib.BlockCipherMode.extend(),t=e.Encryptor=e.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,r=this._iv,o=this._counter;r&&(o=this._counter=r.slice(0),this._iv=void 0);var a=o.slice(0);n.encryptBlock(a,0),o[i-1]=o[i-1]+1|0;for(var s=0;s<i;s++)e[t+s]^=a[s]}});return e.Decryptor=t,e}(),function(){var e=s,t=e.lib.StreamCipher,n=e.algo,i=[],r=[],o=[],a=n.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],i=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var r=0;r<4;r++)c.call(this);for(r=0;r<8;r++)i[r]^=n[r+4&7];if(t){var o=t.words,a=o[0],s=o[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),d=u>>>16|4294901760&l,p=l<<16|65535&u;for(i[0]^=u,i[1]^=d,i[2]^=l,i[3]^=p,i[4]^=u,i[5]^=d,i[6]^=l,i[7]^=p,r=0;r<4;r++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),i[0]=n[0]^n[5]>>>16^n[3]<<16,i[1]=n[2]^n[7]>>>16^n[5]<<16,i[2]=n[4]^n[1]>>>16^n[7]<<16,i[3]=n[6]^n[3]>>>16^n[1]<<16;for(var r=0;r<4;r++)i[r]=16711935&(i[r]<<8|i[r]>>>24)|4278255360&(i[r]<<24|i[r]>>>8),e[t+r]^=i[r]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)r[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<r[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<r[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<r[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<r[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<r[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<r[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<r[6]>>>0?1:0)|0,this._b=t[7]>>>0<r[7]>>>0?1:0,n=0;n<8;n++){var i=e[n]+t[n],a=65535&i,s=i>>>16,c=((a*a>>>17)+a*s>>>15)+s*s,u=((4294901760&i)*i|0)+((65535&i)*i|0);o[n]=c^u}e[0]=o[0]+(o[7]<<16|o[7]>>>16)+(o[6]<<16|o[6]>>>16)|0,e[1]=o[1]+(o[0]<<8|o[0]>>>24)+o[7]|0,e[2]=o[2]+(o[1]<<16|o[1]>>>16)+(o[0]<<16|o[0]>>>16)|0,e[3]=o[3]+(o[2]<<8|o[2]>>>24)+o[1]|0,e[4]=o[4]+(o[3]<<16|o[3]>>>16)+(o[2]<<16|o[2]>>>16)|0,e[5]=o[5]+(o[4]<<8|o[4]>>>24)+o[3]|0,e[6]=o[6]+(o[5]<<16|o[5]>>>16)+(o[4]<<16|o[4]>>>16)|0,e[7]=o[7]+(o[6]<<8|o[6]>>>24)+o[5]|0}e.RabbitLegacy=t._createHelper(a)}(),s.pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){var t=e.words,n=e.sigBytes-1;for(n=e.sigBytes-1;n>=0;n--)if(t[n>>>2]>>>24-n%4*8&255){e.sigBytes=n+1;break}}},s)},c(u={exports:{}},u.exports),u.exports);return function(){function t(n){e(this,t);var i=n.logger,r=n.isArray,o=n.isMap,a=n.isDevMode;this._isArray=r,this._isMap=o,this._isDevMode=a,i.log("TIMProfanityFilterPlugin.VERSION:".concat("0.9.0")),this._interceptProfanityList=[],this._interceptFilter=null,this._interceptRegExpList=[],this._replacingProfanityMap=new Map,this._replacingFilter=null,this._replacingRegExpMap=new Map,this._key="",this._iv="",this._decryptOptions=void 0}return n(t,[{key:"onToken",value:function(e){this._key=f.enc.Utf8.parse(e.slice(0,32)),this._iv=this._key,this._decryptOptions={iv:this._iv,mode:f.mode.CBC,padding:f.pad.Pkcs7}}},{key:"onLexiconSliced",value:function(e){if(this._isArray(e)&&0!==e.length){var t,n,i,r=s(e);try{for(r.s();!(i=r.n()).done;){var o=i.value,a=o.filterType,c=o.profanityType,u=o.profanity,l=o.replacement;t=this._getDecryptedString(u),n=this._getDecryptedString(l),1===a?1===c?this._interceptProfanityList.push(t):2===c&&this._interceptRegExpList.push(t):2===a&&(1===c?this._replacingProfanityMap.set(t,n):2===c&&this._replacingRegExpMap.set(t,n))}}catch(d){r.e(d)}finally{r.f()}}}},{key:"_getDecryptedString",value:function(e){var t=f.AES.decrypt(e,this._key,this._decryptOptions);return f.enc.Utf8.stringify(t).toLowerCase()}},{key:"onLexiconCompleted",value:function(e){this.onLexiconSliced(e),this._interceptFilter=new d({input:this._interceptProfanityList,isArray:this._isArray,isMap:this._isMap}),this._replacingFilter=new d({input:this._replacingProfanityMap,isArray:this._isArray,isMap:this._isMap}),this._isDevMode}},{key:"filter",value:function(e){var t={type:0,modifiedText:e};if(!0===this._interceptFilter.filter({text:e,replacingEnabled:!1}).isMatched)return t.type=1,t;for(var n=!1,r=0,o=this._interceptRegExpList.length;r<o;r++)if(new RegExp(this._interceptRegExpList[r],"g").test(e)){n=!0;break}if(n)return t.type=1,t;var a=this._replacingFilter.filter({text:e,replacingEnabled:!0});!0===a.isMatched&&(t.type=2,t.modifiedText=a.modifiedText);var c,u=t.modifiedText,l=null,d=s(this._replacingRegExpMap);try{for(d.s();!(c=d.n()).done;){var p=i(c.value,2),h=p[0],f=p[1];l=new RegExp(h,"g"),u=u.replace(l,f)}}catch(g){d.e(g)}finally{d.f()}return u!==e&&(t.type=2,t.modifiedText=u),t}},{key:"reset",value:function(){this._isArray=null,this._isMap=null,this._interceptProfanityList.length=0,this._interceptRegExpList.length=0,this._replacingProfanityMap.clear(),this._replacingRegExpMap.clear(),this._key="",this._iv="",this._decryptOptions={},this._interceptFilter&&this._interceptFilter.reset(),this._replacingFilter&&this._replacingFilter.reset()}}]),t}()}();class $w{static init(e){}install(e){}getInstance(){}login(e){return new Promise(((e,t)=>{}))}destroyed(){}component(e,t){}use(e,t){}setAwaitFunc(e,t){}setCommonStore(e){}setComponentStore(e,t,n){}getStore(){}storeCommonListener(e,t){}}class Jw{setCommonStore(e){}setComponentStore(e,t,n){}storeCommonListener(e,t){}}class Xw extends Jw{constructor(){super(),this.storeListener={keys:[],callback:()=>{}},this.store={};this.store.common=new Proxy({},{get:(e,t)=>e[t],set:(e,t,n)=>{const i={};return Object.assign(i,e),e[t]=n,e[t]!==i[t]&&this.storeListener.keys.indexOf(t)>=0&&this.storeListener.callback(e[t],i[t]),e[t]}})}setCommonStore(e){return Object.keys(e).forEach((t=>{if(t in this.store.common)return new Error(`${t} 在公共数据已存在，请重新设置`);this.store.common[t]=e[t]})),this.store}setComponentStore(e,t,n){return e in this.store?new Error(`${e} 该数据模块已存在，请重新设置`):this.store[e]=new Proxy(t,{get:(e,t)=>e[t],set:(e,t,i)=>{const r={};return Object.assign(r,e),e[t]=i,e[t]!==r[t]&&n&&n(e,r),e}})}storeCommonListener(e,t){this.storeListener={keys:e,callback:t}}}const Zw=e=>"function"==typeof e,Qw=class extends $w{constructor(e){super(),this.isOfficial=!1,this.isIntl=!1,this.isSDKReady=!1,this.installedPlugins=new Set,this.config={},this.TUIComponents=new Set,this.loginResolveRejectCache=[],this.SDKAppID=e.SDKAppID,this.TUIServer={},this.store=new Xw,this.TIM=Qi,window.TIM=Qi,e.tim?window.TUIKit=e.tim:window.TUIKit=Qi.create({SDKAppID:this.SDKAppID}),this.tim=window.TUIKit,this.tim.registerPlugin({"tim-upload-plugin":zw}),this.tim.registerPlugin({"tim-profanity-filter-plugin":Yw}),this.bindTIMEvent(),this.TUIEnv=zi(),this.isOfficial=1400187352===this.SDKAppID||1400188366===this.SDKAppID}static init(e){const t=Mo.getInstance();Qw.instance||(Qw.instance=new Qw(e));const{isH5:n}=zi();return t.reportEvent({name:"SDKAppID",ext1:n?"IMTUIKitH5External":"IMTUIKitWebExternal",ext2:n?"IMTUIKitH5External":"IMTUIKitWebExternal",ext3:e.SDKAppID}),t.reportEvent({name:"time",ext1:"firstRunTime"}),window.TUIKitTUICore=Qw.instance,Qw.instance.use(rt),Qw.instance.use(Ki),Qw.instance}install(e){e.config.globalProperties.$TUIKit=this.getInstance();let t=!0;this.installedPlugins.forEach((n=>{e.use(n),"TUIComponents"===n.name&&(t=!1)})),t&&this.TUIComponents.forEach((t=>{e.component(t.name,t.component)})),(e=>{Wi.map((t=>{e.directive(t.name,{beforeMount:t.callback})}))})(e)}getInstance(){return Qw.instance}login(e){return new Promise(((t,n)=>{this.tim.login(e).then((()=>{var i,r,o,a,s;return this.loginResolveRejectCache.push({resolve:t,reject:n}),Qw.isLogin=!0,window._isTIMCallKit=!0,null==(o=null==(r=null==(i=null==Qw?void 0:Qw.instance)?void 0:i.TUIServer)?void 0:r.TUICallKit)||o.init({SDKAppID:this.SDKAppID,userID:e.userID,userSig:e.userSig,tim:this.tim}),(null==(s=null==(a=null==Qw?void 0:Qw.instance)?void 0:a.TUIServer)?void 0:s.TUICallKit)&&Mo.getInstance().reportEvent({name:"SDKAppID",ext1:"IMTUIKitWebExternal-call",ext2:"IMTUIKitWebExternal-call",ext3:this.SDKAppID}),null})).catch((e=>{n(e)}))}))}logout(){return new Promise(((e,t)=>{this.tim.logout().then((t=>{this.isSDKReady=!1,Qw.isLogin=!1,e(t)})).catch((e=>{t(e)}))}))}bindTIMEvent(){this.tim.on(Qi.EVENT.SDK_READY,this.handleSDKReady,this)}unbindTIMEvent(){this.tim.off(Qi.EVENT.SDK_READY,this.handleSDKReady)}handleSDKReady(){this.isSDKReady=!0,this.handelAwaitFunc(Qw.TUIServerFunMap),this.loginResolveRejectCache.forEach((({resolve:e})=>{e({msg:"登录成功，且SDK Ready"})}))}handelAwaitFunc(e){const t=Object.keys(this.TUIServer);for(let n=0;n<t.length;n++){const i=(null==e?void 0:e.get(t[n]))||[];i.length>0&&i.map((e=>e())),null==e||e.delete(t[n])}return e}destroyed(){this.unbindTIMEvent(),this.isSDKReady=!1}component(e,t){const n=this.getInstance();return this.TUIServer||(this.TUIServer={}),this.TUIServer[e]=t.server,this.TUIComponents.has(t)||this.TUIComponents.add(t),n}use(e,t){const n=this.getInstance();return this.installedPlugins.has(e)||(e&&Zw(null==e?void 0:e.plugin)?(this.installedPlugins.add(e),null==e||e.plugin(n,t)):Zw(e)&&(this.installedPlugins.add(e),e(n,t))),n}usePlugin(e){let t={};return this.installedPlugins.forEach((n=>{n.name===e&&(t=n)})),t}setAwaitFunc(e,t){if(this.isSDKReady)t();else{Qw.TUIServerFunMap||(Qw.TUIServerFunMap=new Map);const n=Qw.TUIServerFunMap.get(e)||[];n.push(t),Qw.TUIServerFunMap.set(e,n)}}setCommonStore(e){return this.store.setCommonStore(e)}setComponentStore(e,t,n){return this.store.setComponentStore(e,t,n)}getStore(){return this.store.store}storeCommonListener(e,t){return this.store.storeCommonListener(e,t)}};let eA=Qw;eA.isLogin=!1;var tA="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},nA=[],iA=[],rA="undefined"!=typeof Uint8Array?Uint8Array:Array,oA=!1;function aA(){oA=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0;t<64;++t)nA[t]=e[t],iA[e.charCodeAt(t)]=t;iA["-".charCodeAt(0)]=62,iA["_".charCodeAt(0)]=63}function sA(e,t,n){for(var i,r,o=[],a=t;a<n;a+=3)i=(e[a]<<16)+(e[a+1]<<8)+e[a+2],o.push(nA[(r=i)>>18&63]+nA[r>>12&63]+nA[r>>6&63]+nA[63&r]);return o.join("")}function cA(e){var t;oA||aA();for(var n=e.length,i=n%3,r="",o=[],a=0,s=n-i;a<s;a+=16383)o.push(sA(e,a,a+16383>s?s:a+16383));return 1===i?(t=e[n-1],r+=nA[t>>2],r+=nA[t<<4&63],r+="=="):2===i&&(t=(e[n-2]<<8)+e[n-1],r+=nA[t>>10],r+=nA[t>>4&63],r+=nA[t<<2&63],r+="="),o.push(r),o.join("")}function uA(e,t,n,i,r){var o,a,s=8*r-i-1,c=(1<<s)-1,u=c>>1,l=-7,d=n?r-1:0,p=n?-1:1,h=e[t+d];for(d+=p,o=h&(1<<-l)-1,h>>=-l,l+=s;l>0;o=256*o+e[t+d],d+=p,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=i;l>0;a=256*a+e[t+d],d+=p,l-=8);if(0===o)o=1-u;else{if(o===c)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,i),o-=u}return(h?-1:1)*a*Math.pow(2,o-i)}function lA(e,t,n,i,r,o){var a,s,c,u=8*o-r-1,l=(1<<u)-1,d=l>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,h=i?0:o-1,f=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+d>=1?p/c:p*Math.pow(2,1-d))*c>=2&&(a++,c/=2),a+d>=l?(s=0,a=l):a+d>=1?(s=(t*c-1)*Math.pow(2,r),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,r),a=0));r>=8;e[n+h]=255&s,h+=f,s/=256,r-=8);for(a=a<<r|s,u+=r;u>0;e[n+h]=255&a,h+=f,a/=256,u-=8);e[n+h-f]|=128*g}var dA={}.toString,pA=Array.isArray||function(e){return"[object Array]"==dA.call(e)};function hA(){return gA.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function fA(e,t){if(hA()<t)throw new RangeError("Invalid typed array length");return gA.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=gA.prototype:(null===e&&(e=new gA(t)),e.length=t),e}function gA(e,t,n){if(!(gA.TYPED_ARRAY_SUPPORT||this instanceof gA))return new gA(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return _A(this,e)}return mA(this,e,t,n)}function mA(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i),gA.TYPED_ARRAY_SUPPORT?(e=t).__proto__=gA.prototype:e=yA(e,t),e}(e,t,n,i):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!gA.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|TA(t,n),r=(e=fA(e,i)).write(t,n);return r!==i&&(e=e.slice(0,r)),e}(e,t,n):function(e,t){if(MA(t)){var n=0|IA(t.length);return 0===(e=fA(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?fA(e,0):yA(e,t);if("Buffer"===t.type&&pA(t.data))return yA(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function vA(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function _A(e,t){if(vA(t),e=fA(e,t<0?0:0|IA(t)),!gA.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function yA(e,t){var n=t.length<0?0:0|IA(t.length);e=fA(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function IA(e){if(e>=hA())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+hA().toString(16)+" bytes");return 0|e}function MA(e){return!(null==e||!e._isBuffer)}function TA(e,t){if(MA(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return $A(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return JA(e).length;default:if(i)return $A(e).length;t=(""+t).toLowerCase(),i=!0}}function CA(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return GA(this,t,n);case"utf8":case"utf-8":return NA(this,t,n);case"ascii":return UA(this,t,n);case"latin1":case"binary":return xA(this,t,n);case"base64":return OA(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return FA(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function SA(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function EA(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=gA.from(t,i)),MA(t))return 0===t.length?-1:kA(e,t,n,i,r);if("number"==typeof t)return t&=255,gA.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):kA(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function kA(e,t,n,i,r){var o,a=1,s=e.length,c=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;a=2,s/=2,c/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(r){var l=-1;for(o=n;o<s;o++)if(u(e,o)===u(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===c)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(n+c>s&&(n=s-c),o=n;o>=0;o--){for(var d=!0,p=0;p<c;p++)if(u(e,o+p)!==u(t,p)){d=!1;break}if(d)return o}return-1}function bA(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var a=0;a<i;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function DA(e,t,n,i){return XA($A(t,e.length-n),e,n,i)}function wA(e,t,n,i){return XA(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function AA(e,t,n,i){return wA(e,t,n,i)}function RA(e,t,n,i){return XA(JA(t),e,n,i)}function LA(e,t,n,i){return XA(function(e,t){for(var n,i,r,o=[],a=0;a<e.length&&!((t-=2)<0);++a)i=(n=e.charCodeAt(a))>>8,r=n%256,o.push(r),o.push(i);return o}(t,e.length-n),e,n,i)}function OA(e,t,n){return 0===t&&n===e.length?cA(e):cA(e.slice(t,n))}function NA(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var o,a,s,c,u=e[r],l=null,d=u>239?4:u>223?3:u>191?2:1;if(r+d<=n)switch(d){case 1:u<128&&(l=u);break;case 2:128==(192&(o=e[r+1]))&&(c=(31&u)<<6|63&o)>127&&(l=c);break;case 3:o=e[r+1],a=e[r+2],128==(192&o)&&128==(192&a)&&(c=(15&u)<<12|(63&o)<<6|63&a)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:o=e[r+1],a=e[r+2],s=e[r+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(c=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(l=c)}null===l?(l=65533,d=1):l>65535&&(l-=65536,i.push(l>>>10&1023|55296),l=56320|1023&l),i.push(l),r+=d}return function(e){var t=e.length;if(t<=PA)return String.fromCharCode.apply(String,e);for(var n="",i=0;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=PA));return n}(i)}gA.TYPED_ARRAY_SUPPORT=void 0===tA.TYPED_ARRAY_SUPPORT||tA.TYPED_ARRAY_SUPPORT,gA.poolSize=8192,gA._augment=function(e){return e.__proto__=gA.prototype,e},gA.from=function(e,t,n){return mA(null,e,t,n)},gA.TYPED_ARRAY_SUPPORT&&(gA.prototype.__proto__=Uint8Array.prototype,gA.__proto__=Uint8Array),gA.alloc=function(e,t,n){return i=null,o=t,a=n,vA(r=e),r<=0?fA(i,r):void 0!==o?"string"==typeof a?fA(i,r).fill(o,a):fA(i,r).fill(o):fA(i,r);var i,r,o,a},gA.allocUnsafe=function(e){return _A(null,e)},gA.allocUnsafeSlow=function(e){return _A(null,e)},gA.isBuffer=ZA,gA.compare=function(e,t){if(!MA(e)||!MA(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},gA.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},gA.concat=function(e,t){if(!pA(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return gA.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=gA.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var o=e[n];if(!MA(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r),r+=o.length}return i},gA.byteLength=TA,gA.prototype._isBuffer=!0,gA.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)SA(this,t,t+1);return this},gA.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)SA(this,t,t+3),SA(this,t+1,t+2);return this},gA.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)SA(this,t,t+7),SA(this,t+1,t+6),SA(this,t+2,t+5),SA(this,t+3,t+4);return this},gA.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?NA(this,0,e):CA.apply(this,arguments)},gA.prototype.equals=function(e){if(!MA(e))throw new TypeError("Argument must be a Buffer");return this===e||0===gA.compare(this,e)},gA.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},gA.prototype.compare=function(e,t,n,i,r){if(!MA(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(r>>>=0)-(i>>>=0),a=(n>>>=0)-(t>>>=0),s=Math.min(o,a),c=this.slice(i,r),u=e.slice(t,n),l=0;l<s;++l)if(c[l]!==u[l]){o=c[l],a=u[l];break}return o<a?-1:a<o?1:0},gA.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},gA.prototype.indexOf=function(e,t,n){return EA(this,e,t,n,!0)},gA.prototype.lastIndexOf=function(e,t,n){return EA(this,e,t,n,!1)},gA.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return bA(this,e,t,n);case"utf8":case"utf-8":return DA(this,e,t,n);case"ascii":return wA(this,e,t,n);case"latin1":case"binary":return AA(this,e,t,n);case"base64":return RA(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return LA(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},gA.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var PA=4096;function UA(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function xA(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function GA(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",o=t;o<n;++o)r+=YA(e[o]);return r}function FA(e,t,n){for(var i=e.slice(t,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function VA(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function qA(e,t,n,i,r,o){if(!MA(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function BA(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,o=Math.min(e.length-n,2);r<o;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function HA(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,o=Math.min(e.length-n,4);r<o;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function jA(e,t,n,i,r,o){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function KA(e,t,n,i,r){return r||jA(e,0,n,4),lA(e,t,n,i,23,4),n+4}function zA(e,t,n,i,r){return r||jA(e,0,n,8),lA(e,t,n,i,52,8),n+8}gA.prototype.slice=function(e,t){var n,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),gA.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=gA.prototype;else{var r=t-e;n=new gA(r,void 0);for(var o=0;o<r;++o)n[o]=this[o+e]}return n},gA.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||VA(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i},gA.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||VA(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},gA.prototype.readUInt8=function(e,t){return t||VA(e,1,this.length),this[e]},gA.prototype.readUInt16LE=function(e,t){return t||VA(e,2,this.length),this[e]|this[e+1]<<8},gA.prototype.readUInt16BE=function(e,t){return t||VA(e,2,this.length),this[e]<<8|this[e+1]},gA.prototype.readUInt32LE=function(e,t){return t||VA(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},gA.prototype.readUInt32BE=function(e,t){return t||VA(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},gA.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||VA(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},gA.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||VA(e,t,this.length);for(var i=t,r=1,o=this[e+--i];i>0&&(r*=256);)o+=this[e+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},gA.prototype.readInt8=function(e,t){return t||VA(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},gA.prototype.readInt16LE=function(e,t){t||VA(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},gA.prototype.readInt16BE=function(e,t){t||VA(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},gA.prototype.readInt32LE=function(e,t){return t||VA(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},gA.prototype.readInt32BE=function(e,t){return t||VA(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},gA.prototype.readFloatLE=function(e,t){return t||VA(e,4,this.length),uA(this,e,!0,23,4)},gA.prototype.readFloatBE=function(e,t){return t||VA(e,4,this.length),uA(this,e,!1,23,4)},gA.prototype.readDoubleLE=function(e,t){return t||VA(e,8,this.length),uA(this,e,!0,52,8)},gA.prototype.readDoubleBE=function(e,t){return t||VA(e,8,this.length),uA(this,e,!1,52,8)},gA.prototype.writeUIntLE=function(e,t,n,i){e=+e,t|=0,n|=0,i||qA(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,o=0;for(this[t]=255&e;++o<n&&(r*=256);)this[t+o]=e/r&255;return t+n},gA.prototype.writeUIntBE=function(e,t,n,i){e=+e,t|=0,n|=0,i||qA(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+n},gA.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||qA(this,e,t,1,255,0),gA.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},gA.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||qA(this,e,t,2,65535,0),gA.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):BA(this,e,t,!0),t+2},gA.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||qA(this,e,t,2,65535,0),gA.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):BA(this,e,t,!1),t+2},gA.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||qA(this,e,t,4,4294967295,0),gA.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):HA(this,e,t,!0),t+4},gA.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||qA(this,e,t,4,4294967295,0),gA.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):HA(this,e,t,!1),t+4},gA.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);qA(this,e,t,n,r-1,-r)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},gA.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);qA(this,e,t,n,r-1,-r)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},gA.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||qA(this,e,t,1,127,-128),gA.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},gA.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||qA(this,e,t,2,32767,-32768),gA.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):BA(this,e,t,!0),t+2},gA.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||qA(this,e,t,2,32767,-32768),gA.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):BA(this,e,t,!1),t+2},gA.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||qA(this,e,t,4,2147483647,-2147483648),gA.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):HA(this,e,t,!0),t+4},gA.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||qA(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),gA.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):HA(this,e,t,!1),t+4},gA.prototype.writeFloatLE=function(e,t,n){return KA(this,e,t,!0,n)},gA.prototype.writeFloatBE=function(e,t,n){return KA(this,e,t,!1,n)},gA.prototype.writeDoubleLE=function(e,t,n){return zA(this,e,t,!0,n)},gA.prototype.writeDoubleBE=function(e,t,n){return zA(this,e,t,!1,n)},gA.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,o=i-n;if(this===e&&n<t&&t<i)for(r=o-1;r>=0;--r)e[r+t]=this[r+n];else if(o<1e3||!gA.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},gA.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!gA.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=MA(e)?e:$A(new gA(e,i).toString()),s=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var WA=/[^+\/0-9A-Za-z-_]/g;function YA(e){return e<16?"0"+e.toString(16):e.toString(16)}function $A(e,t){var n;t=t||1/0;for(var i=e.length,r=null,o=[],a=0;a<i;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function JA(e){return function(e){var t,n,i,r,o,a;oA||aA();var s=e.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===e[s-2]?2:"="===e[s-1]?1:0,a=new rA(3*s/4-o),i=o>0?s-4:s;var c=0;for(t=0,n=0;t<i;t+=4,n+=3)r=iA[e.charCodeAt(t)]<<18|iA[e.charCodeAt(t+1)]<<12|iA[e.charCodeAt(t+2)]<<6|iA[e.charCodeAt(t+3)],a[c++]=r>>16&255,a[c++]=r>>8&255,a[c++]=255&r;return 2===o?(r=iA[e.charCodeAt(t)]<<2|iA[e.charCodeAt(t+1)]>>4,a[c++]=255&r):1===o&&(r=iA[e.charCodeAt(t)]<<10|iA[e.charCodeAt(t+1)]<<4|iA[e.charCodeAt(t+2)]>>2,a[c++]=r>>8&255,a[c++]=255&r),a}(function(e){if((e=(t=e,t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(WA,"")).length<2)return"";for(var t;e.length%4!=0;)e+="=";return e}(e))}function XA(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function ZA(e){return null!=e&&(!!e._isBuffer||QA(e)||"function"==typeof(t=e).readFloatLE&&"function"==typeof t.slice&&QA(t.slice(0,0)));var t}function QA(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function eR(e,t){return e(t={exports:{}},t.exports),t.exports}var tR=eR((function(e,t){var n,i,r,o,a,s,c,u,l,d,p,h,f;e.exports=(n=n||(i=Math,r=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),a=(o={}).lib={},s=a.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes,r=e.sigBytes;if(this.clamp(),i%4)for(var o=0;o<r;o++){var a=n[o>>>2]>>>24-o%4*8&255;t[i+o>>>2]|=a<<24-(i+o)%4*8}else for(o=0;o<r;o+=4)t[i+o>>>2]=n[o>>>2];return this.sigBytes+=r,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=i.ceil(t/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t,n=[],r=function(e){var t=987654321,n=4294967295;return function(){var r=((t=36969*(65535&t)+(t>>16)&n)<<16)+(e=18e3*(65535&e)+(e>>16)&n)&n;return r/=4294967296,(r+=.5)*(i.random()>.5?1:-1)}},o=0;o<e;o+=4){var a=r(4294967296*(t||i.random()));t=987654071*a(),n.push(4294967296*a()|0)}return new c.init(n,e)}}),u=o.enc={},l=u.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var o=t[r>>>2]>>>24-r%4*8&255;i.push((o>>>4).toString(16)),i.push((15&o).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new c.init(n,t/2)}},d=u.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var o=t[r>>>2]>>>24-r%4*8&255;i.push(String.fromCharCode(o))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new c.init(n,t)}},p=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},h=a.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,r=t.sigBytes,o=this.blockSize,a=r/(4*o),s=(a=e?i.ceil(a):i.max((0|a)-this._minBufferSize,0))*o,u=i.min(4*s,r);if(s){for(var l=0;l<s;l+=o)this._doProcessBlock(n,l);var d=n.splice(0,s);t.sigBytes-=u}return new c.init(d,u)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),a.Hasher=h.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}}),f=o.algo={},o),n)})),nR=(eR((function(e,t){var n,i,r,o,a,s;e.exports=(r=(i=n=tR).lib,o=r.Base,a=r.WordArray,(s=i.x64={}).Word=o.extend({init:function(e,t){this.high=e,this.low=t}}),s.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],i=0;i<t;i++){var r=e[i];n.push(r.high),n.push(r.low)}return a.create(n,this.sigBytes)},clone:function(){for(var e=o.clone.call(this),t=e.words=this.words.slice(0),n=t.length,i=0;i<n;i++)t[i]=t[i].clone();return e}}),n)})),eR((function(e,t){var n;e.exports=(n=tR,function(){if("function"==typeof ArrayBuffer){var e=n.lib.WordArray,t=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var n=e.byteLength,i=[],r=0;r<n;r++)i[r>>>2]|=e[r]<<24-r%4*8;t.call(this,i,n)}else t.apply(this,arguments)}).prototype=e}}(),n.lib.WordArray)})),eR((function(e,t){var n;e.exports=(n=tR,function(){var e=n,t=e.lib.WordArray,i=e.enc;function r(e){return e<<8&4278255360|e>>>8&16711935}i.Utf16=i.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r+=2){var o=t[r>>>2]>>>16-r%4*8&65535;i.push(String.fromCharCode(o))}return i.join("")},parse:function(e){for(var n=e.length,i=[],r=0;r<n;r++)i[r>>>1]|=e.charCodeAt(r)<<16-r%2*16;return t.create(i,2*n)}},i.Utf16LE={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],o=0;o<n;o+=2){var a=r(t[o>>>2]>>>16-o%4*8&65535);i.push(String.fromCharCode(a))}return i.join("")},parse:function(e){for(var n=e.length,i=[],o=0;o<n;o++)i[o>>>1]|=r(e.charCodeAt(o)<<16-o%2*16);return t.create(i,2*n)}}}(),n.enc.Utf16)})),eR((function(e,t){var n,i,r;e.exports=(r=(i=n=tR).lib.WordArray,i.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp();for(var r=[],o=0;o<n;o+=3)for(var a=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,s=0;s<4&&o+.75*s<n;s++)r.push(i.charAt(a>>>6*(3-s)&63));var c=i.charAt(64);if(c)for(;r.length%4;)r.push(c);return r.join("")},parse:function(e){var t=e.length,n=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var o=0;o<n.length;o++)i[n.charCodeAt(o)]=o}var a=n.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(t=s)}return function(e,t,n){for(var i=[],o=0,a=0;a<t;a++)if(a%4){var s=n[e.charCodeAt(a-1)]<<a%4*2,c=n[e.charCodeAt(a)]>>>6-a%4*2;i[o>>>2]|=(s|c)<<24-o%4*8,o++}return r.create(i,o)}(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)})),eR((function(e,t){var n;e.exports=(n=tR,function(e){var t=n,i=t.lib,r=i.WordArray,o=i.Hasher,a=t.algo,s=[];!function(){for(var t=0;t<64;t++)s[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=a.MD5=o.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var i=t+n,r=e[i];e[i]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var o=this._hash.words,a=e[t+0],c=e[t+1],h=e[t+2],f=e[t+3],g=e[t+4],m=e[t+5],v=e[t+6],_=e[t+7],y=e[t+8],I=e[t+9],M=e[t+10],T=e[t+11],C=e[t+12],S=e[t+13],E=e[t+14],k=e[t+15],b=o[0],D=o[1],w=o[2],A=o[3];b=u(b,D,w,A,a,7,s[0]),A=u(A,b,D,w,c,12,s[1]),w=u(w,A,b,D,h,17,s[2]),D=u(D,w,A,b,f,22,s[3]),b=u(b,D,w,A,g,7,s[4]),A=u(A,b,D,w,m,12,s[5]),w=u(w,A,b,D,v,17,s[6]),D=u(D,w,A,b,_,22,s[7]),b=u(b,D,w,A,y,7,s[8]),A=u(A,b,D,w,I,12,s[9]),w=u(w,A,b,D,M,17,s[10]),D=u(D,w,A,b,T,22,s[11]),b=u(b,D,w,A,C,7,s[12]),A=u(A,b,D,w,S,12,s[13]),w=u(w,A,b,D,E,17,s[14]),b=l(b,D=u(D,w,A,b,k,22,s[15]),w,A,c,5,s[16]),A=l(A,b,D,w,v,9,s[17]),w=l(w,A,b,D,T,14,s[18]),D=l(D,w,A,b,a,20,s[19]),b=l(b,D,w,A,m,5,s[20]),A=l(A,b,D,w,M,9,s[21]),w=l(w,A,b,D,k,14,s[22]),D=l(D,w,A,b,g,20,s[23]),b=l(b,D,w,A,I,5,s[24]),A=l(A,b,D,w,E,9,s[25]),w=l(w,A,b,D,f,14,s[26]),D=l(D,w,A,b,y,20,s[27]),b=l(b,D,w,A,S,5,s[28]),A=l(A,b,D,w,h,9,s[29]),w=l(w,A,b,D,_,14,s[30]),b=d(b,D=l(D,w,A,b,C,20,s[31]),w,A,m,4,s[32]),A=d(A,b,D,w,y,11,s[33]),w=d(w,A,b,D,T,16,s[34]),D=d(D,w,A,b,E,23,s[35]),b=d(b,D,w,A,c,4,s[36]),A=d(A,b,D,w,g,11,s[37]),w=d(w,A,b,D,_,16,s[38]),D=d(D,w,A,b,M,23,s[39]),b=d(b,D,w,A,S,4,s[40]),A=d(A,b,D,w,a,11,s[41]),w=d(w,A,b,D,f,16,s[42]),D=d(D,w,A,b,v,23,s[43]),b=d(b,D,w,A,I,4,s[44]),A=d(A,b,D,w,C,11,s[45]),w=d(w,A,b,D,k,16,s[46]),b=p(b,D=d(D,w,A,b,h,23,s[47]),w,A,a,6,s[48]),A=p(A,b,D,w,_,10,s[49]),w=p(w,A,b,D,E,15,s[50]),D=p(D,w,A,b,m,21,s[51]),b=p(b,D,w,A,C,6,s[52]),A=p(A,b,D,w,f,10,s[53]),w=p(w,A,b,D,M,15,s[54]),D=p(D,w,A,b,c,21,s[55]),b=p(b,D,w,A,y,6,s[56]),A=p(A,b,D,w,k,10,s[57]),w=p(w,A,b,D,v,15,s[58]),D=p(D,w,A,b,S,21,s[59]),b=p(b,D,w,A,g,6,s[60]),A=p(A,b,D,w,T,10,s[61]),w=p(w,A,b,D,h,15,s[62]),D=p(D,w,A,b,I,21,s[63]),o[0]=o[0]+b|0,o[1]=o[1]+D|0,o[2]=o[2]+w|0,o[3]=o[3]+A|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;n[r>>>5]|=128<<24-r%32;var o=e.floor(i/4294967296),a=i;n[15+(r+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),n[14+(r+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(n.length+1),this._process();for(var s=this._hash,c=s.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return s},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,n,i,r,o,a){var s=e+(t&n|~t&i)+r+a;return(s<<o|s>>>32-o)+t}function l(e,t,n,i,r,o,a){var s=e+(t&i|n&~i)+r+a;return(s<<o|s>>>32-o)+t}function d(e,t,n,i,r,o,a){var s=e+(t^n^i)+r+a;return(s<<o|s>>>32-o)+t}function p(e,t,n,i,r,o,a){var s=e+(n^(t|~i))+r+a;return(s<<o|s>>>32-o)+t}t.MD5=o._createHelper(c),t.HmacMD5=o._createHmacHelper(c)}(Math),n.MD5)})),eR((function(e,t){var n,i,r,o,a,s,c,u;e.exports=(r=(i=n=tR).lib,o=r.WordArray,a=r.Hasher,s=i.algo,c=[],u=s.SHA1=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],u=0;u<80;u++){if(u<16)c[u]=0|e[t+u];else{var l=c[u-3]^c[u-8]^c[u-14]^c[u-16];c[u]=l<<1|l>>>31}var d=(i<<5|i>>>27)+s+c[u];d+=u<20?1518500249+(r&o|~r&a):u<40?1859775393+(r^o^a):u<60?(r&o|r&a|o&a)-1894007588:(r^o^a)-899497514,s=a,a=o,o=r<<30|r>>>2,r=i,i=d}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(i+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),i.SHA1=a._createHelper(u),i.HmacSHA1=a._createHmacHelper(u),n.SHA1)})),eR((function(e,t){var n;e.exports=(n=tR,function(e){var t=n,i=t.lib,r=i.WordArray,o=i.Hasher,a=t.algo,s=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),i=2;i<=n;i++)if(!(t%i))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var i=2,r=0;r<64;)t(i)&&(r<8&&(s[r]=n(e.pow(i,.5))),c[r]=n(e.pow(i,1/3)),r++),i++}();var u=[],l=a.SHA256=o.extend({_doReset:function(){this._hash=new r.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],d=n[6],p=n[7],h=0;h<64;h++){if(h<16)u[h]=0|e[t+h];else{var f=u[h-15],g=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,m=u[h-2],v=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;u[h]=g+u[h-7]+v+u[h-16]}var _=i&r^i&o^r&o,y=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),I=p+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&l^~s&d)+c[h]+u[h];p=d,d=l,l=s,s=a+I|0,a=o,o=r,r=i,i=I+(y+_)|0}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0,n[5]=n[5]+l|0,n[6]=n[6]+d|0,n[7]=n[7]+p|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;return n[r>>>5]|=128<<24-r%32,n[14+(r+64>>>9<<4)]=e.floor(i/4294967296),n[15+(r+64>>>9<<4)]=i,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(l),t.HmacSHA256=o._createHmacHelper(l)}(Math),n.SHA256)})),eR((function(e,t){var n,i,r,o,a,s;e.exports=(r=(i=n=tR).lib.WordArray,o=i.algo,a=o.SHA256,s=o.SHA224=a.extend({_doReset:function(){this._hash=new r.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=a._doFinalize.call(this);return e.sigBytes-=4,e}}),i.SHA224=a._createHelper(s),i.HmacSHA224=a._createHmacHelper(s),n.SHA224)})),eR((function(e,t){var n;e.exports=(n=tR,function(){var e=n,t=e.lib.Hasher,i=e.x64,r=i.Word,o=i.WordArray,a=e.algo;function s(){return r.create.apply(r,arguments)}var c=[s(1116352408,3609767458),s(1899447441,602891725),s(3049323471,3964484399),s(3921009573,2173295548),s(961987163,4081628472),s(1508970993,3053834265),s(2453635748,2937671579),s(2870763221,3664609560),s(3624381080,2734883394),s(310598401,1164996542),s(607225278,1323610764),s(1426881987,3590304994),s(1925078388,4068182383),s(2162078206,991336113),s(2614888103,633803317),s(3248222580,3479774868),s(3835390401,2666613458),s(4022224774,944711139),s(264347078,2341262773),s(604807628,2007800933),s(770255983,1495990901),s(1249150122,1856431235),s(1555081692,3175218132),s(1996064986,2198950837),s(2554220882,3999719339),s(2821834349,766784016),s(2952996808,2566594879),s(3210313671,3203337956),s(3336571891,1034457026),s(3584528711,2466948901),s(113926993,3758326383),s(338241895,168717936),s(666307205,1188179964),s(773529912,1546045734),s(1294757372,1522805485),s(1396182291,2643833823),s(1695183700,2343527390),s(1986661051,1014477480),s(2177026350,1206759142),s(2456956037,344077627),s(2730485921,1290863460),s(2820302411,3158454273),s(3259730800,3505952657),s(3345764771,106217008),s(3516065817,3606008344),s(3600352804,1432725776),s(4094571909,1467031594),s(275423344,851169720),s(430227734,3100823752),s(506948616,1363258195),s(659060556,3750685593),s(883997877,3785050280),s(958139571,3318307427),s(1322822218,3812723403),s(1537002063,2003034995),s(1747873779,3602036899),s(1955562222,1575990012),s(2024104815,1125592928),s(2227730452,2716904306),s(2361852424,442776044),s(2428436474,593698344),s(2756734187,3733110249),s(3204031479,2999351573),s(3329325298,3815920427),s(3391569614,3928383900),s(3515267271,566280711),s(3940187606,3454069534),s(4118630271,4000239992),s(116418474,1914138554),s(174292421,2731055270),s(289380356,3203993006),s(460393269,320620315),s(685471733,587496836),s(852142971,1086792851),s(1017036298,365543100),s(1126000580,2618297676),s(1288033470,3409855158),s(1501505948,4234509866),s(1607167915,987167468),s(1816402316,1246189591)],u=[];!function(){for(var e=0;e<80;e++)u[e]=s()}();var l=a.SHA512=t.extend({_doReset:function(){this._hash=new o.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],d=n[6],p=n[7],h=i.high,f=i.low,g=r.high,m=r.low,v=o.high,_=o.low,y=a.high,I=a.low,M=s.high,T=s.low,C=l.high,S=l.low,E=d.high,k=d.low,b=p.high,D=p.low,w=h,A=f,R=g,L=m,O=v,N=_,P=y,U=I,x=M,G=T,F=C,V=S,q=E,B=k,H=b,j=D,K=0;K<80;K++){var z=u[K];if(K<16)var W=z.high=0|e[t+2*K],Y=z.low=0|e[t+2*K+1];else{var $=u[K-15],J=$.high,X=$.low,Z=(J>>>1|X<<31)^(J>>>8|X<<24)^J>>>7,Q=(X>>>1|J<<31)^(X>>>8|J<<24)^(X>>>7|J<<25),ee=u[K-2],te=ee.high,ne=ee.low,ie=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,re=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),oe=u[K-7],ae=oe.high,se=oe.low,ce=u[K-16],ue=ce.high,le=ce.low;W=(W=(W=Z+ae+((Y=Q+se)>>>0<Q>>>0?1:0))+ie+((Y+=re)>>>0<re>>>0?1:0))+ue+((Y+=le)>>>0<le>>>0?1:0),z.high=W,z.low=Y}var de,pe=x&F^~x&q,he=G&V^~G&B,fe=w&R^w&O^R&O,ge=A&L^A&N^L&N,me=(w>>>28|A<<4)^(w<<30|A>>>2)^(w<<25|A>>>7),ve=(A>>>28|w<<4)^(A<<30|w>>>2)^(A<<25|w>>>7),_e=(x>>>14|G<<18)^(x>>>18|G<<14)^(x<<23|G>>>9),ye=(G>>>14|x<<18)^(G>>>18|x<<14)^(G<<23|x>>>9),Ie=c[K],Me=Ie.high,Te=Ie.low,Ce=H+_e+((de=j+ye)>>>0<j>>>0?1:0),Se=ve+ge;H=q,j=B,q=F,B=V,F=x,V=G,x=P+(Ce=(Ce=(Ce=Ce+pe+((de+=he)>>>0<he>>>0?1:0))+Me+((de+=Te)>>>0<Te>>>0?1:0))+W+((de+=Y)>>>0<Y>>>0?1:0))+((G=U+de|0)>>>0<U>>>0?1:0)|0,P=O,U=N,O=R,N=L,R=w,L=A,w=Ce+(me+fe+(Se>>>0<ve>>>0?1:0))+((A=de+Se|0)>>>0<de>>>0?1:0)|0}f=i.low=f+A,i.high=h+w+(f>>>0<A>>>0?1:0),m=r.low=m+L,r.high=g+R+(m>>>0<L>>>0?1:0),_=o.low=_+N,o.high=v+O+(_>>>0<N>>>0?1:0),I=a.low=I+U,a.high=y+P+(I>>>0<U>>>0?1:0),T=s.low=T+G,s.high=M+x+(T>>>0<G>>>0?1:0),S=l.low=S+V,l.high=C+F+(S>>>0<V>>>0?1:0),k=d.low=k+B,d.high=E+q+(k>>>0<B>>>0?1:0),D=p.low=D+j,p.high=b+H+(D>>>0<j>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[30+(i+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(i+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(l),e.HmacSHA512=t._createHmacHelper(l)}(),n.SHA512)})),eR((function(e,t){var n,i,r,o,a,s,c,u;e.exports=(r=(i=n=tR).x64,o=r.Word,a=r.WordArray,s=i.algo,c=s.SHA512,u=s.SHA384=c.extend({_doReset:function(){this._hash=new a.init([new o.init(3418070365,3238371032),new o.init(1654270250,914150663),new o.init(2438529370,812702999),new o.init(355462360,4144912697),new o.init(1731405415,4290775857),new o.init(2394180231,1750603025),new o.init(3675008525,1694076839),new o.init(1203062813,3204075428)])},_doFinalize:function(){var e=c._doFinalize.call(this);return e.sigBytes-=16,e}}),i.SHA384=c._createHelper(u),i.HmacSHA384=c._createHmacHelper(u),n.SHA384)})),eR((function(e,t){var n;e.exports=(n=tR,function(e){var t=n,i=t.lib,r=i.WordArray,o=i.Hasher,a=t.x64.Word,s=t.algo,c=[],u=[],l=[];!function(){for(var e=1,t=0,n=0;n<24;n++){c[e+5*t]=(n+1)*(n+2)/2%64;var i=(2*e+3*t)%5;e=t%5,t=i}for(e=0;e<5;e++)for(t=0;t<5;t++)u[e+5*t]=t+(2*e+3*t)%5*5;for(var r=1,o=0;o<24;o++){for(var s=0,d=0,p=0;p<7;p++){if(1&r){var h=(1<<p)-1;h<32?d^=1<<h:s^=1<<h-32}128&r?r=r<<1^113:r<<=1}l[o]=a.create(s,d)}}();var d=[];!function(){for(var e=0;e<25;e++)d[e]=a.create()}();var p=s.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new a.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,i=this.blockSize/2,r=0;r<i;r++){var o=e[t+2*r],a=e[t+2*r+1];o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),(D=n[r]).high^=a,D.low^=o}for(var s=0;s<24;s++){for(var p=0;p<5;p++){for(var h=0,f=0,g=0;g<5;g++)h^=(D=n[p+5*g]).high,f^=D.low;var m=d[p];m.high=h,m.low=f}for(p=0;p<5;p++){var v=d[(p+4)%5],_=d[(p+1)%5],y=_.high,I=_.low;for(h=v.high^(y<<1|I>>>31),f=v.low^(I<<1|y>>>31),g=0;g<5;g++)(D=n[p+5*g]).high^=h,D.low^=f}for(var M=1;M<25;M++){var T=(D=n[M]).high,C=D.low,S=c[M];S<32?(h=T<<S|C>>>32-S,f=C<<S|T>>>32-S):(h=C<<S-32|T>>>64-S,f=T<<S-32|C>>>64-S);var E=d[u[M]];E.high=h,E.low=f}var k=d[0],b=n[0];for(k.high=b.high,k.low=b.low,p=0;p<5;p++)for(g=0;g<5;g++){var D=n[M=p+5*g],w=d[M],A=d[(p+1)%5+5*g],R=d[(p+2)%5+5*g];D.high=w.high^~A.high&R.high,D.low=w.low^~A.low&R.low}D=n[0];var L=l[s];D.high^=L.high,D.low^=L.low}},_doFinalize:function(){var t=this._data,n=t.words,i=(this._nDataBytes,8*t.sigBytes),o=32*this.blockSize;n[i>>>5]|=1<<24-i%32,n[(e.ceil((i+1)/o)*o>>>5)-1]|=128,t.sigBytes=4*n.length,this._process();for(var a=this._state,s=this.cfg.outputLength/8,c=s/8,u=[],l=0;l<c;l++){var d=a[l],p=d.high,h=d.low;p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),u.push(h),u.push(p)}return new r.init(u,s)},clone:function(){for(var e=o.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});t.SHA3=o._createHelper(p),t.HmacSHA3=o._createHmacHelper(p)}(Math),n.SHA3)})),eR((function(e,t){var n;e.exports=(n=tR,function(e){var t=n,i=t.lib,r=i.WordArray,o=i.Hasher,a=t.algo,s=r.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=r.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),u=r.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),l=r.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),d=r.create([0,1518500249,1859775393,2400959708,2840853838]),p=r.create([1352829926,1548603684,1836072691,2053994217,0]),h=a.RIPEMD160=o.extend({_doReset:function(){this._hash=r.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var i=t+n,r=e[i];e[i]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var o,a,h,I,M,T,C,S,E,k,b,D=this._hash.words,w=d.words,A=p.words,R=s.words,L=c.words,O=u.words,N=l.words;for(T=o=D[0],C=a=D[1],S=h=D[2],E=I=D[3],k=M=D[4],n=0;n<80;n+=1)b=o+e[t+R[n]]|0,b+=n<16?f(a,h,I)+w[0]:n<32?g(a,h,I)+w[1]:n<48?m(a,h,I)+w[2]:n<64?v(a,h,I)+w[3]:_(a,h,I)+w[4],b=(b=y(b|=0,O[n]))+M|0,o=M,M=I,I=y(h,10),h=a,a=b,b=T+e[t+L[n]]|0,b+=n<16?_(C,S,E)+A[0]:n<32?v(C,S,E)+A[1]:n<48?m(C,S,E)+A[2]:n<64?g(C,S,E)+A[3]:f(C,S,E)+A[4],b=(b=y(b|=0,N[n]))+k|0,T=k,k=E,E=y(S,10),S=C,C=b;b=D[1]+h+E|0,D[1]=D[2]+I+k|0,D[2]=D[3]+M+T|0,D[3]=D[4]+o+C|0,D[4]=D[0]+a+S|0,D[0]=b},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var r=this._hash,o=r.words,a=0;a<5;a++){var s=o[a];o[a]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}return r},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function f(e,t,n){return e^t^n}function g(e,t,n){return e&t|~e&n}function m(e,t,n){return(e|~t)^n}function v(e,t,n){return e&n|t&~n}function _(e,t,n){return e^(t|~n)}function y(e,t){return e<<t|e>>>32-t}t.RIPEMD160=o._createHelper(h),t.HmacRIPEMD160=o._createHmacHelper(h)}(),n.RIPEMD160)})),eR((function(e,t){var n,i,r,o;e.exports=(i=(n=tR).lib.Base,r=n.enc,o=r.Utf8,void(n.algo.HMAC=i.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=o.parse(t));var n=e.blockSize,i=4*n;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var r=this._oKey=t.clone(),a=this._iKey=t.clone(),s=r.words,c=a.words,u=0;u<n;u++)s[u]^=1549556828,c[u]^=909522486;r.sigBytes=a.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})))})),eR((function(e,t){var n,i,r,o,a,s,c,u,l;e.exports=(o=(r=(i=n=tR).lib).Base,a=r.WordArray,c=(s=i.algo).SHA1,u=s.HMAC,l=s.PBKDF2=o.extend({cfg:o.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,i=u.create(n.hasher,e),r=a.create(),o=a.create([1]),s=r.words,c=o.words,l=n.keySize,d=n.iterations;s.length<l;){var p=i.update(t).finalize(o);i.reset();for(var h=p.words,f=h.length,g=p,m=1;m<d;m++){g=i.finalize(g),i.reset();for(var v=g.words,_=0;_<f;_++)h[_]^=v[_]}r.concat(p),c[0]++}return r.sigBytes=4*l,r}}),i.PBKDF2=function(e,t,n){return l.create(n).compute(e,t)},n.PBKDF2)})),eR((function(e,t){var n,i,r,o,a,s,c,u;e.exports=(o=(r=(i=n=tR).lib).Base,a=r.WordArray,c=(s=i.algo).MD5,u=s.EvpKDF=o.extend({cfg:o.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,i=n.hasher.create(),r=a.create(),o=r.words,s=n.keySize,c=n.iterations;o.length<s;){u&&i.update(u);var u=i.update(e).finalize(t);i.reset();for(var l=1;l<c;l++)u=i.finalize(u),i.reset();r.concat(u)}return r.sigBytes=4*s,r}}),i.EvpKDF=function(e,t,n){return u.create(n).compute(e,t)},n.EvpKDF)})),eR((function(e,t){var n,i,r,o,a,s,c,u,l,d,p,h,f,g,m,v,_,y,I,M,T,C,S;e.exports=void((n=tR).lib.Cipher||(i=n,r=i.lib,o=r.Base,a=r.WordArray,s=r.BufferedBlockAlgorithm,c=i.enc,c.Utf8,u=c.Base64,l=i.algo,d=l.EvpKDF,p=r.Cipher=s.extend({cfg:o.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?S:M}return function(t){return{encrypt:function(n,i,r){return e(i).encrypt(t,n,i,r)},decrypt:function(n,i,r){return e(i).decrypt(t,n,i,r)}}}}()}),r.StreamCipher=p.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),h=i.mode={},f=r.BlockCipherMode=o.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),g=h.CBC=function(){var e=f.extend();function t(e,t,n){var i=this._iv;if(i){var r=i;this._iv=undefined}else r=this._prevBlock;for(var o=0;o<n;o++)e[t+o]^=r[o]}return e.Encryptor=e.extend({processBlock:function(e,n){var i=this._cipher,r=i.blockSize;t.call(this,e,n,r),i.encryptBlock(e,n),this._prevBlock=e.slice(n,n+r)}}),e.Decryptor=e.extend({processBlock:function(e,n){var i=this._cipher,r=i.blockSize,o=e.slice(n,n+r);i.decryptBlock(e,n),t.call(this,e,n,r),this._prevBlock=o}}),e}(),m=i.pad={},v=m.Pkcs7={pad:function(e,t){for(var n=4*t,i=n-e.sigBytes%n,r=i<<24|i<<16|i<<8|i,o=[],s=0;s<i;s+=4)o.push(r);var c=a.create(o,i);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},r.BlockCipher=p.extend({cfg:p.cfg.extend({mode:g,padding:v}),reset:function(){p.reset.call(this);var e=this.cfg,t=e.iv,n=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var i=n.createEncryptor;else{i=n.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==i?this._mode.init(this,t&&t.words):(this._mode=i.call(n,this,t&&t.words),this._mode.__creator=i)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else{t=this._process(!0);e.unpad(t)}return t},blockSize:4}),_=r.CipherParams=o.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),y=i.format={},I=y.OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;if(n)var i=a.create([1398893684,1701076831]).concat(n).concat(t);else i=t;return i.toString(u)},parse:function(e){var t=u.parse(e),n=t.words;if(1398893684==n[0]&&1701076831==n[1]){var i=a.create(n.slice(2,4));n.splice(0,4),t.sigBytes-=16}return _.create({ciphertext:t,salt:i})}},M=r.SerializableCipher=o.extend({cfg:o.extend({format:I}),encrypt:function(e,t,n,i){i=this.cfg.extend(i);var r=e.createEncryptor(n,i),o=r.finalize(t),a=r.cfg;return _.create({ciphertext:o,key:n,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:i.format})},decrypt:function(e,t,n,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),e.createDecryptor(n,i).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),T=i.kdf={},C=T.OpenSSL={execute:function(e,t,n,i){i||(i=a.random(8));var r=d.create({keySize:t+n}).compute(e,i),o=a.create(r.words.slice(t),4*n);return r.sigBytes=4*t,_.create({key:r,iv:o,salt:i})}},S=r.PasswordBasedCipher=M.extend({cfg:M.cfg.extend({kdf:C}),encrypt:function(e,t,n,i){var r=(i=this.cfg.extend(i)).kdf.execute(n,e.keySize,e.ivSize);i.iv=r.iv;var o=M.encrypt.call(this,e,t,r.key,i);return o.mixIn(r),o},decrypt:function(e,t,n,i){i=this.cfg.extend(i),t=this._parse(t,i.format);var r=i.kdf.execute(n,e.keySize,e.ivSize,t.salt);return i.iv=r.iv,M.decrypt.call(this,e,t,r.key,i)}})))})),eR((function(e,t){var n;e.exports=((n=tR).mode.CFB=function(){var e=n.lib.BlockCipherMode.extend();function t(e,t,n,i){var r=this._iv;if(r){var o=r.slice(0);this._iv=void 0}else o=this._prevBlock;i.encryptBlock(o,0);for(var a=0;a<n;a++)e[t+a]^=o[a]}return e.Encryptor=e.extend({processBlock:function(e,n){var i=this._cipher,r=i.blockSize;t.call(this,e,n,r,i),this._prevBlock=e.slice(n,n+r)}}),e.Decryptor=e.extend({processBlock:function(e,n){var i=this._cipher,r=i.blockSize,o=e.slice(n,n+r);t.call(this,e,n,r,i),this._prevBlock=o}}),e}(),n.mode.CFB)})),eR((function(e,t){var n,i,r;e.exports=((n=tR).mode.CTR=(r=(i=n.lib.BlockCipherMode.extend()).Encryptor=i.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,r=this._iv,o=this._counter;r&&(o=this._counter=r.slice(0),this._iv=void 0);var a=o.slice(0);n.encryptBlock(a,0),o[i-1]=o[i-1]+1|0;for(var s=0;s<i;s++)e[t+s]^=a[s]}}),i.Decryptor=r,i),n.mode.CTR)})),eR((function(e,t){var n;e.exports=((n=tR).mode.CTRGladman=function(){var e=n.lib.BlockCipherMode.extend();function t(e){if(255==(e>>24&255)){var t=e>>16&255,n=e>>8&255,i=255&e;255===t?(t=0,255===n?(n=0,255===i?i=0:++i):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=i}else e+=1<<24;return e}var i=e.Encryptor=e.extend({processBlock:function(e,n){var i,r=this._cipher,o=r.blockSize,a=this._iv,s=this._counter;a&&(s=this._counter=a.slice(0),this._iv=void 0),0===((i=s)[0]=t(i[0]))&&(i[1]=t(i[1]));var c=s.slice(0);r.encryptBlock(c,0);for(var u=0;u<o;u++)e[n+u]^=c[u]}});return e.Decryptor=i,e}(),n.mode.CTRGladman)})),eR((function(e,t){var n,i,r;e.exports=((n=tR).mode.OFB=(r=(i=n.lib.BlockCipherMode.extend()).Encryptor=i.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,r=this._iv,o=this._keystream;r&&(o=this._keystream=r.slice(0),this._iv=void 0),n.encryptBlock(o,0);for(var a=0;a<i;a++)e[t+a]^=o[a]}}),i.Decryptor=r,i),n.mode.OFB)})),eR((function(e,t){var n,i;e.exports=((n=tR).mode.ECB=((i=n.lib.BlockCipherMode.extend()).Encryptor=i.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),i.Decryptor=i.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),i),n.mode.ECB)})),eR((function(e,t){var n;e.exports=((n=tR).pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,i=4*t,r=i-n%i,o=n+r-1;e.clamp(),e.words[o>>>2]|=r<<24-o%4*8,e.sigBytes+=r},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Ansix923)})),eR((function(e,t){var n;e.exports=((n=tR).pad.Iso10126={pad:function(e,t){var i=4*t,r=i-e.sigBytes%i;e.concat(n.lib.WordArray.random(r-1)).concat(n.lib.WordArray.create([r<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Iso10126)})),eR((function(e,t){var n;e.exports=((n=tR).pad.Iso97971={pad:function(e,t){e.concat(n.lib.WordArray.create([2147483648],1)),n.pad.ZeroPadding.pad(e,t)},unpad:function(e){n.pad.ZeroPadding.unpad(e),e.sigBytes--}},n.pad.Iso97971)})),eR((function(e,t){var n;e.exports=((n=tR).pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){for(var t=e.words,n=e.sigBytes-1;!(t[n>>>2]>>>24-n%4*8&255);)n--;e.sigBytes=n+1}},n.pad.ZeroPadding)})),eR((function(e,t){var n;e.exports=((n=tR).pad.NoPadding={pad:function(){},unpad:function(){}},n.pad.NoPadding)})),eR((function(e,t){var n,i,r,o;e.exports=(r=(i=n=tR).lib.CipherParams,o=i.enc.Hex,i.format.Hex={stringify:function(e){return e.ciphertext.toString(o)},parse:function(e){var t=o.parse(e);return r.create({ciphertext:t})}},n.format.Hex)})),eR((function(e,t){var n;e.exports=(n=tR,function(){var e=n,t=e.lib.BlockCipher,i=e.algo,r=[],o=[],a=[],s=[],c=[],u=[],l=[],d=[],p=[],h=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var n=0,i=0;for(t=0;t<256;t++){var f=i^i<<1^i<<2^i<<3^i<<4;f=f>>>8^255&f^99,r[n]=f,o[f]=n;var g=e[n],m=e[g],v=e[m],_=257*e[f]^16843008*f;a[n]=_<<24|_>>>8,s[n]=_<<16|_>>>16,c[n]=_<<8|_>>>24,u[n]=_,_=16843009*v^65537*m^257*g^16843008*n,l[f]=_<<24|_>>>8,d[f]=_<<16|_>>>16,p[f]=_<<8|_>>>24,h[f]=_,n?(n=g^e[e[e[v^g]]],i^=e[e[i]]):n=i=1}}();var f=[0,1,2,4,8,16,32,64,128,27,54],g=i.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,i=4*((this._nRounds=n+6)+1),o=this._keySchedule=[],a=0;a<i;a++)if(a<n)o[a]=t[a];else{var s=o[a-1];a%n?n>6&&a%n==4&&(s=r[s>>>24]<<24|r[s>>>16&255]<<16|r[s>>>8&255]<<8|r[255&s]):(s=r[(s=s<<8|s>>>24)>>>24]<<24|r[s>>>16&255]<<16|r[s>>>8&255]<<8|r[255&s],s^=f[a/n|0]<<24),o[a]=o[a-n]^s}for(var c=this._invKeySchedule=[],u=0;u<i;u++)a=i-u,s=u%4?o[a]:o[a-4],c[u]=u<4||a<=4?s:l[r[s>>>24]]^d[r[s>>>16&255]]^p[r[s>>>8&255]]^h[r[255&s]]}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,s,c,u,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,d,p,h,o),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,i,r,o,a,s){for(var c=this._nRounds,u=e[t]^n[0],l=e[t+1]^n[1],d=e[t+2]^n[2],p=e[t+3]^n[3],h=4,f=1;f<c;f++){var g=i[u>>>24]^r[l>>>16&255]^o[d>>>8&255]^a[255&p]^n[h++],m=i[l>>>24]^r[d>>>16&255]^o[p>>>8&255]^a[255&u]^n[h++],v=i[d>>>24]^r[p>>>16&255]^o[u>>>8&255]^a[255&l]^n[h++],_=i[p>>>24]^r[u>>>16&255]^o[l>>>8&255]^a[255&d]^n[h++];u=g,l=m,d=v,p=_}g=(s[u>>>24]<<24|s[l>>>16&255]<<16|s[d>>>8&255]<<8|s[255&p])^n[h++],m=(s[l>>>24]<<24|s[d>>>16&255]<<16|s[p>>>8&255]<<8|s[255&u])^n[h++],v=(s[d>>>24]<<24|s[p>>>16&255]<<16|s[u>>>8&255]<<8|s[255&l])^n[h++],_=(s[p>>>24]<<24|s[u>>>16&255]<<16|s[l>>>8&255]<<8|s[255&d])^n[h++],e[t]=g,e[t+1]=m,e[t+2]=v,e[t+3]=_},keySize:8});e.AES=t._createHelper(g)}(),n.AES)})),eR((function(e,t){var n;e.exports=(n=tR,function(){var e=n,t=e.lib,i=t.WordArray,r=t.BlockCipher,o=e.algo,a=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],s=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],u=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],l=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=o.DES=r.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;n<56;n++){var i=a[n]-1;t[n]=e[i>>>5]>>>31-i%32&1}for(var r=this._subKeys=[],o=0;o<16;o++){var u=r[o]=[],l=c[o];for(n=0;n<24;n++)u[n/6|0]|=t[(s[n]-1+l)%28]<<31-n%6,u[4+(n/6|0)]|=t[28+(s[n+24]-1+l)%28]<<31-n%6;for(u[0]=u[0]<<1|u[0]>>>31,n=1;n<7;n++)u[n]=u[n]>>>4*(n-1)+3;u[7]=u[7]<<5|u[7]>>>27}var d=this._invSubKeys=[];for(n=0;n<16;n++)d[n]=r[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,n){this._lBlock=e[t],this._rBlock=e[t+1],p.call(this,4,252645135),p.call(this,16,65535),h.call(this,2,858993459),h.call(this,8,16711935),p.call(this,1,1431655765);for(var i=0;i<16;i++){for(var r=n[i],o=this._lBlock,a=this._rBlock,s=0,c=0;c<8;c++)s|=u[c][((a^r[c])&l[c])>>>0];this._lBlock=a,this._rBlock=o^s}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,p.call(this,1,1431655765),h.call(this,8,16711935),h.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function p(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function h(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}e.DES=r._createHelper(d);var f=o.TripleDES=r.extend({_doReset:function(){var e=this._key.words;this._des1=d.createEncryptor(i.create(e.slice(0,2))),this._des2=d.createEncryptor(i.create(e.slice(2,4))),this._des3=d.createEncryptor(i.create(e.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=r._createHelper(f)}(),n.TripleDES)})),eR((function(e,t){var n;e.exports=(n=tR,function(){var e=n,t=e.lib.StreamCipher,i=e.algo,r=i.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,i=this._S=[],r=0;r<256;r++)i[r]=r;r=0;for(var o=0;r<256;r++){var a=r%n,s=t[a>>>2]>>>24-a%4*8&255;o=(o+i[r]+s)%256;var c=i[r];i[r]=i[o],i[o]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=o.call(this)},keySize:8,ivSize:0});function o(){for(var e=this._S,t=this._i,n=this._j,i=0,r=0;r<4;r++){n=(n+e[t=(t+1)%256])%256;var o=e[t];e[t]=e[n],e[n]=o,i|=e[(e[t]+e[n])%256]<<24-8*r}return this._i=t,this._j=n,i}e.RC4=t._createHelper(r);var a=i.RC4Drop=r.extend({cfg:r.cfg.extend({drop:192}),_doReset:function(){r._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)o.call(this)}});e.RC4Drop=t._createHelper(a)}(),n.RC4)})),eR((function(e,t){var n;e.exports=(n=tR,function(){var e=n,t=e.lib.StreamCipher,i=e.algo,r=[],o=[],a=[],s=i.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,n=0;n<4;n++)e[n]=16711935&(e[n]<<8|e[n]>>>24)|4278255360&(e[n]<<24|e[n]>>>8);var i=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],r=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,n=0;n<4;n++)c.call(this);for(n=0;n<8;n++)r[n]^=i[n+4&7];if(t){var o=t.words,a=o[0],s=o[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),d=u>>>16|4294901760&l,p=l<<16|65535&u;for(r[0]^=u,r[1]^=d,r[2]^=l,r[3]^=p,r[4]^=u,r[5]^=d,r[6]^=l,r[7]^=p,n=0;n<4;n++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),r[0]=n[0]^n[5]>>>16^n[3]<<16,r[1]=n[2]^n[7]>>>16^n[5]<<16,r[2]=n[4]^n[1]>>>16^n[7]<<16,r[3]=n[6]^n[3]>>>16^n[1]<<16;for(var i=0;i<4;i++)r[i]=16711935&(r[i]<<8|r[i]>>>24)|4278255360&(r[i]<<24|r[i]>>>8),e[t+i]^=r[i]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)o[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<o[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<o[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<o[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<o[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<o[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<o[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<o[6]>>>0?1:0)|0,this._b=t[7]>>>0<o[7]>>>0?1:0,n=0;n<8;n++){var i=e[n]+t[n],r=65535&i,s=i>>>16,c=((r*r>>>17)+r*s>>>15)+s*s,u=((4294901760&i)*i|0)+((65535&i)*i|0);a[n]=c^u}e[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,e[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,e[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,e[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,e[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,e[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,e[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,e[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}e.Rabbit=t._createHelper(s)}(),n.Rabbit)})),eR((function(e,t){var n;e.exports=(n=tR,function(){var e=n,t=e.lib.StreamCipher,i=e.algo,r=[],o=[],a=[],s=i.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],i=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var r=0;r<4;r++)c.call(this);for(r=0;r<8;r++)i[r]^=n[r+4&7];if(t){var o=t.words,a=o[0],s=o[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),d=u>>>16|4294901760&l,p=l<<16|65535&u;for(i[0]^=u,i[1]^=d,i[2]^=l,i[3]^=p,i[4]^=u,i[5]^=d,i[6]^=l,i[7]^=p,r=0;r<4;r++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),r[0]=n[0]^n[5]>>>16^n[3]<<16,r[1]=n[2]^n[7]>>>16^n[5]<<16,r[2]=n[4]^n[1]>>>16^n[7]<<16,r[3]=n[6]^n[3]>>>16^n[1]<<16;for(var i=0;i<4;i++)r[i]=16711935&(r[i]<<8|r[i]>>>24)|4278255360&(r[i]<<24|r[i]>>>8),e[t+i]^=r[i]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)o[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<o[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<o[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<o[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<o[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<o[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<o[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<o[6]>>>0?1:0)|0,this._b=t[7]>>>0<o[7]>>>0?1:0,n=0;n<8;n++){var i=e[n]+t[n],r=65535&i,s=i>>>16,c=((r*r>>>17)+r*s>>>15)+s*s,u=((4294901760&i)*i|0)+((65535&i)*i|0);a[n]=c^u}e[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,e[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,e[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,e[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,e[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,e[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,e[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,e[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}e.RabbitLegacy=t._createHelper(s)}(),n.RabbitLegacy)})),eR((function(e,t){e.exports=tR})));function iR(){throw new Error("setTimeout has not been defined")}function rR(){throw new Error("clearTimeout has not been defined")}var oR=iR,aR=rR;function sR(e){if(oR===setTimeout)return setTimeout(e,0);if((oR===iR||!oR)&&setTimeout)return oR=setTimeout,setTimeout(e,0);try{return oR(e,0)}catch(t){try{return oR.call(null,e,0)}catch(n){return oR.call(this,e,0)}}}"function"==typeof tA.setTimeout&&(oR=setTimeout),"function"==typeof tA.clearTimeout&&(aR=clearTimeout);var cR,uR=[],lR=!1,dR=-1;function pR(){lR&&cR&&(lR=!1,cR.length?uR=cR.concat(uR):dR=-1,uR.length&&hR())}function hR(){if(!lR){var e=sR(pR);lR=!0;for(var t=uR.length;t;){for(cR=uR,uR=[];++dR<t;)cR&&cR[dR].run();dR=-1,t=uR.length}cR=null,lR=!1,function(e){if(aR===clearTimeout)return clearTimeout(e);if((aR===rR||!aR)&&clearTimeout)return aR=clearTimeout,clearTimeout(e);try{aR(e)}catch(t){try{return aR.call(null,e)}catch(n){return aR.call(this,e)}}}(e)}}function fR(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];uR.push(new gR(e,t)),1!==uR.length||lR||sR(hR)}function gR(e,t){this.fun=e,this.array=t}gR.prototype.run=function(){this.fun.apply(null,this.array)};var mR=tA.performance||{};function vR(){}function _R(){_R.init.call(this)}function yR(e){return void 0===e._maxListeners?_R.defaultMaxListeners:e._maxListeners}function IR(e,t,n,i){var r,o,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]):(o=e._events=new vR,e._eventsCount=0),a){if("function"==typeof a?a=o[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),!a.warned&&(r=yR(e))&&r>0&&a.length>r){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=a.length,s,console.warn}}else a=o[t]=n,++e._eventsCount;return e}function MR(e,t,n){var i=!1;function r(){e.removeListener(t,r),i||(i=!0,n.apply(e,arguments))}return r.listener=n,r}function TR(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function CR(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}mR.now||mR.mozNow||mR.msNow||mR.oNow||mR.webkitNow,vR.prototype=Object.create(null),_R.EventEmitter=_R,_R.usingDomains=!1,_R.prototype.domain=void 0,_R.prototype._events=void 0,_R.prototype._maxListeners=void 0,_R.defaultMaxListeners=10,_R.init=function(){this.domain=null,_R.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new vR,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},_R.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},_R.prototype.getMaxListeners=function(){return yR(this)},_R.prototype.emit=function(e){var t,n,i,r,o,a,s,c="error"===e;if(a=this._events)c=c&&null==a.error;else if(!c)return!1;if(s=this.domain,c){if(t=arguments[1],!s){if(t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=a[e]))return!1;var l="function"==typeof n;switch(i=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var i=e.length,r=CR(e,i),o=0;o<i;++o)r[o].call(n)}(n,l,this);break;case 2:!function(e,t,n,i){if(t)e.call(n,i);else for(var r=e.length,o=CR(e,r),a=0;a<r;++a)o[a].call(n,i)}(n,l,this,arguments[1]);break;case 3:!function(e,t,n,i,r){if(t)e.call(n,i,r);else for(var o=e.length,a=CR(e,o),s=0;s<o;++s)a[s].call(n,i,r)}(n,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,i,r,o){if(t)e.call(n,i,r,o);else for(var a=e.length,s=CR(e,a),c=0;c<a;++c)s[c].call(n,i,r,o)}(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),o=1;o<i;o++)r[o-1]=arguments[o];!function(e,t,n,i){if(t)e.apply(n,i);else for(var r=e.length,o=CR(e,r),a=0;a<r;++a)o[a].apply(n,i)}(n,l,this,r)}return!0},_R.prototype.addListener=function(e,t){return IR(this,e,t,!1)},_R.prototype.on=_R.prototype.addListener,_R.prototype.prependListener=function(e,t){return IR(this,e,t,!0)},_R.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,MR(this,e,t)),this},_R.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,MR(this,e,t)),this},_R.prototype.removeListener=function(e,t){var n,i,r,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new vR:(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){a=n[o].listener,r=o;break}if(r<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new vR,this;delete i[e]}else!function(e,t){for(var n=t,i=n+1,r=e.length;i<r;n+=1,i+=1)e[n]=e[i];e.pop()}(n,r);i.removeListener&&this.emit("removeListener",e,a||t)}return this},_R.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new vR,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new vR:delete n[e]),this;if(0===arguments.length){for(var i,r=Object.keys(n),o=0;o<r.length;++o)"removeListener"!==(i=r[o])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new vR,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},_R.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},_R.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):TR.call(e,t)},_R.prototype.listenerCount=TR,_R.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var SR="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},ER=/%[sdj%]/g;function kR(e){if(!GR(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(AR(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,r=i.length,o=String(e).replace(ER,(function(e){if("%%"===e)return"%";if(n>=r)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(t){return"[Circular]"}default:return e}})),a=i[n];n<r;a=i[++n])xR(a)||!qR(a)?o+=" "+a:o+=" "+AR(a);return o}function bR(e,t){if(FR(tA.process))return function(){return bR(e,t).apply(this,arguments)};var n=!1;return function(){return n||(n=!0),e.apply(this,arguments)}}var DR,wR={};function AR(e,t){var n={seen:[],stylize:LR};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),UR(t)?n.showHidden=t:t&&function(e,t){if(!t||!qR(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]]}(n,t),FR(n.showHidden)&&(n.showHidden=!1),FR(n.depth)&&(n.depth=2),FR(n.colors)&&(n.colors=!1),FR(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=RR),OR(n,e,n.depth)}function RR(e,t){var n=AR.styles[t];return n?"["+AR.colors[n][0]+"m"+e+"["+AR.colors[n][1]+"m":e}function LR(e,t){return e}function OR(e,t,n){if(e.customInspect&&t&&jR(t.inspect)&&t.inspect!==AR&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return GR(i)||(i=OR(e,i,n)),i}var r=function(e,t){if(FR(t))return e.stylize("undefined","undefined");if(GR(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return"number"==typeof t?e.stylize(""+t,"number"):UR(t)?e.stylize(""+t,"boolean"):xR(t)?e.stylize("null","null"):void 0}(e,t);if(r)return r;var o,a=Object.keys(t),s=(o={},a.forEach((function(e,t){o[e]=!0})),o);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),HR(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return NR(t);if(0===a.length){if(jR(t)){var c=t.name?": "+t.name:"";return e.stylize("[Function"+c+"]","special")}if(VR(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(BR(t))return e.stylize(Date.prototype.toString.call(t),"date");if(HR(t))return NR(t)}var u,l,d="",p=!1,h=["{","}"];return u=t,Array.isArray(u)&&(p=!0,h=["[","]"]),jR(t)&&(d=" [Function"+(t.name?": "+t.name:"")+"]"),VR(t)&&(d=" "+RegExp.prototype.toString.call(t)),BR(t)&&(d=" "+Date.prototype.toUTCString.call(t)),HR(t)&&(d=" "+NR(t)),0!==a.length||p&&0!=t.length?n<0?VR(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),l=p?function(e,t,n,i,r){for(var o=[],a=0,s=t.length;a<s;++a)zR(t,String(a))?o.push(PR(e,t,n,i,String(a),!0)):o.push("");return r.forEach((function(r){r.match(/^\d+$/)||o.push(PR(e,t,n,i,r,!0))})),o}(e,t,n,s,a):a.map((function(i){return PR(e,t,n,s,i,p)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(l,d,h)):h[0]+d+h[1]}function NR(e){return"["+Error.prototype.toString.call(e)+"]"}function PR(e,t,n,i,r,o){var a,s,c;if((c=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?s=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(s=e.stylize("[Setter]","special")),zR(i,r)||(a="["+r+"]"),s||(e.seen.indexOf(c.value)<0?(s=xR(n)?OR(e,c.value,null):OR(e,c.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),FR(a)){if(o&&r.match(/^\d+$/))return s;(a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function UR(e){return"boolean"==typeof e}function xR(e){return null===e}function GR(e){return"string"==typeof e}function FR(e){return void 0===e}function VR(e){return qR(e)&&"[object RegExp]"===KR(e)}function qR(e){return"object"==typeof e&&null!==e}function BR(e){return qR(e)&&"[object Date]"===KR(e)}function HR(e){return qR(e)&&("[object Error]"===KR(e)||e instanceof Error)}function jR(e){return"function"==typeof e}function KR(e){return Object.prototype.toString.call(e)}function zR(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function WR(){this.head=null,this.tail=null,this.length=0}AR.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},AR.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},WR.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},WR.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},WR.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},WR.prototype.clear=function(){this.head=this.tail=null,this.length=0},WR.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},WR.prototype.concat=function(e){if(0===this.length)return gA.alloc(0);if(1===this.length)return this.head.data;for(var t=gA.allocUnsafe(e>>>0),n=this.head,i=0;n;)n.data.copy(t,i),i+=n.data.length,n=n.next;return t};var YR=gA.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function $R(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!YR(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=XR;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=ZR;break;default:return void(this.write=JR)}this.charBuffer=new gA(6),this.charReceived=0,this.charLength=0}function JR(e){return e.toString(this.encoding)}function XR(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function ZR(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}$R.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(e=e.slice(n,e.length),!((i=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&i<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i,r=e.length;if(this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,r),r-=this.charReceived),r=(t+=e.toString(this.encoding,0,r)).length-1,(i=t.charCodeAt(r))>=55296&&i<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,r)}return t},$R.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},$R.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,i=this.charBuffer,r=this.encoding;t+=i.slice(0,n).toString(r)}return t},tL.ReadableState=eL;var QR=function(e){return FR(DR)&&(DR=""),e=e.toUpperCase(),wR[e]||(new RegExp("\\b"+e+"\\b","i").test(DR)?wR[e]=function(){kR.apply(null,arguments)}:wR[e]=function(){}),wR[e]}("stream");function eL(e,t){e=e||{},this.objectMode=!!e.objectMode,t instanceof wL&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:i,this.highWaterMark=~~this.highWaterMark,this.buffer=new WR,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new $R(e.encoding),this.encoding=e.encoding)}function tL(e){if(!(this instanceof tL))return new tL(e);this._readableState=new eL(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),_R.call(this)}function nL(e,t,n,i,r){var o,a,s,c=(o=t,s=null,ZA(a=n)||"string"==typeof a||null==a||o.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s);if(c)e.emit("error",c);else if(null===n)t.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,oL(e)}}(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!r){var u=new Error("stream.push() after EOF");e.emit("error",u)}else if(t.endEmitted&&r){var l=new Error("stream.unshift() after end event");e.emit("error",l)}else{var d;!t.decoder||r||i||(n=t.decoder.write(n),d=!t.objectMode&&0===n.length),r||(t.reading=!1),d||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&oL(e))),function(e,t){t.readingMore||(t.readingMore=!0,fR(sL,e,t))}(e,t)}else r||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}SR(tL,_R),tL.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding)!==n.encoding&&(e=gA.from(e,t),t=""),nL(this,n,e,t,!1)},tL.prototype.unshift=function(e){return nL(this,this._readableState,e,"",!0)},tL.prototype.isPaused=function(){return!1===this._readableState.flowing},tL.prototype.setEncoding=function(e){return this._readableState.decoder=new $R(e),this._readableState.encoding=e,this};var iL=8388608;function rL(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=((n=e)>=iL?n=iL:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var n}function oL(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(QR("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?fR(aL,e):aL(e))}function aL(e){QR("emit readable"),e.emit("readable"),lL(e)}function sL(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(QR("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function cL(e){QR("readable nexttick read 0"),e.read(0)}function uL(e,t){t.reading||(QR("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),lL(e),t.flowing&&!t.reading&&e.read(0)}function lL(e){var t=e._readableState;for(QR("flow",t.flowing);t.flowing&&null!==e.read(););}function dL(e,t){return 0===t.length?null:(t.objectMode?a=t.buffer.shift():!e||e>=t.length?(a=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):(n=e,i=t.buffer,r=t.decoder,n<i.head.data.length?(o=i.head.data.slice(0,n),i.head.data=i.head.data.slice(n)):o=n===i.head.data.length?i.shift():r?function(e,t){var n=t.head,i=1,r=n.data;for(e-=r.length;n=n.next;){var o=n.data,a=e>o.length?o.length:e;if(a===o.length?r+=o:r+=o.slice(0,e),0==(e-=a)){a===o.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(a));break}++i}return t.length-=i,r}(n,i):function(e,t){var n=gA.allocUnsafe(e),i=t.head,r=1;for(i.data.copy(n),e-=i.data.length;i=i.next;){var o=i.data,a=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,a),0==(e-=a)){a===o.length?(++r,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=o.slice(a));break}++r}return t.length-=r,n}(n,i),a=o),a);var n,i,r,o,a}function pL(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,fR(hL,t,e))}function hL(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function fL(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}function gL(){}function mL(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function vL(e,t){Object.defineProperty(this,"buffer",{get:bR((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),e=e||{},this.objectMode=!!e.objectMode,t instanceof wL&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var n=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var r=!1===e.decodeStrings;this.decodeStrings=!r,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n,i=e._writableState,r=i.sync,o=i.writecb;if((n=i).writing=!1,n.writecb=null,n.length-=n.writelen,n.writelen=0,t)!function(e,t,n,i,r){--t.pendingcb,n?fR(r,i):r(i),e._writableState.errorEmitted=!0,e.emit("error",i)}(e,i,r,t,o);else{var a=TL(i);a||i.corked||i.bufferProcessing||!i.bufferedRequest||ML(e,i),r?fR(IL,e,i,a,o):IL(e,i,a,o)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new EL(this)}function _L(e){if(!(this instanceof _L||this instanceof wL))return new _L(e);this._writableState=new vL(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),_R.call(this)}function yL(e,t,n,i,r,o,a){t.writelen=i,t.writecb=a,t.writing=!0,t.sync=!0,n?e._writev(r,t.onwrite):e._write(r,o,t.onwrite),t.sync=!1}function IL(e,t,n,i){var r,o;n||(r=e,0===(o=t).length&&o.needDrain&&(o.needDrain=!1,r.emit("drain"))),t.pendingcb--,i(),SL(e,t)}function ML(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var i=t.bufferedRequestCount,r=new Array(i),o=t.corkedRequestsFree;o.entry=n;for(var a=0;n;)r[a]=n,n=n.next,a+=1;yL(e,t,!0,t.length,r,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new EL(t)}else{for(;n;){var s=n.chunk,c=n.encoding,u=n.callback;if(yL(e,t,!1,t.objectMode?1:s.length,s,c,u),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function TL(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function CL(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function SL(e,t){var n=TL(t);return n&&(0===t.pendingcb?(CL(e,t),t.finished=!0,e.emit("finish")):CL(e,t)),n}function EL(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var i=t.entry;for(t.entry=null;i;){var r=i.callback;e.pendingcb--,r(n),i=i.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}tL.prototype.read=function(e){QR("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return QR("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?pL(this):oL(this),null;if(0===(e=rL(e,t))&&t.ended)return 0===t.length&&pL(this),null;var i,r=t.needReadable;return QR("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&QR("length less than watermark",r=!0),t.ended||t.reading?QR("reading or ended",r=!1):r&&(QR("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=rL(n,t))),null===(i=e>0?dL(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&pL(this)),null!==i&&this.emit("data",i),i},tL.prototype._read=function(e){this.emit("error",new Error("not implemented"))},tL.prototype.pipe=function(e,t){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,QR("pipe count=%d opts=%j",i.pipesCount,t);var r=t&&!1===t.end?l:a;function o(e){QR("onunpipe"),e===n&&l()}function a(){QR("onend"),e.end()}i.endEmitted?fR(r):n.once("end",r),e.on("unpipe",o);var s,c=(s=n,function(){var e=s._readableState;QR("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&s.listeners("data").length&&(e.flowing=!0,lL(s))});e.on("drain",c);var u=!1;function l(){QR("cleanup"),e.removeListener("close",f),e.removeListener("finish",g),e.removeListener("drain",c),e.removeListener("error",h),e.removeListener("unpipe",o),n.removeListener("end",a),n.removeListener("end",l),n.removeListener("data",p),u=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||c()}var d=!1;function p(t){QR("ondata"),d=!1,!1!==e.write(t)||d||((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==fL(i.pipes,e))&&!u&&(QR("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,d=!0),n.pause())}function h(t){QR("onerror",t),m(),e.removeListener("error",h),0===("error",e.listeners("error").length)&&e.emit("error",t)}function f(){e.removeListener("finish",g),m()}function g(){QR("onfinish"),e.removeListener("close",f),m()}function m(){QR("unpipe"),n.unpipe(e)}return n.on("data",p),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",h),e.once("close",f),e.once("finish",g),e.emit("pipe",n),i.flowing||(QR("pipe resume"),n.resume()),e},tL.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var r=0;r<i;r++)n[r].emit("unpipe",this);return this}var o=fL(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},tL.prototype.on=function(e,t){var n=_R.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&oL(this):fR(cL,this))}return n},tL.prototype.addListener=tL.prototype.on,tL.prototype.resume=function(){var e,t,n=this._readableState;return n.flowing||(QR("resume"),n.flowing=!0,e=this,(t=n).resumeScheduled||(t.resumeScheduled=!0,fR(uL,e,t))),this},tL.prototype.pause=function(){return QR("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(QR("pause"),this._readableState.flowing=!1,this.emit("pause")),this},tL.prototype.wrap=function(e){var t=this._readableState,n=!1,i=this;for(var r in e.on("end",(function(){if(QR("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&i.push(e)}i.push(null)})),e.on("data",(function(r){QR("wrapped data"),t.decoder&&(r=t.decoder.write(r)),t.objectMode&&null==r||(t.objectMode||r&&r.length)&&(i.push(r)||(n=!0,e.pause()))})),e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));return function(e,t){for(var n=0,i=e.length;n<i;n++)t(e[n])}(["error","close","destroy","pause","resume"],(function(t){e.on(t,i.emit.bind(i,t))})),i._read=function(t){QR("wrapped _read",t),n&&(n=!1,e.resume())},i},tL._fromList=dL,_L.WritableState=vL,SR(_L,_R),vL.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},_L.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},_L.prototype.write=function(e,t,n){var i,r,o,a=this._writableState,s=!1;return"function"==typeof t&&(n=t,t=null),gA.isBuffer(e)?t="buffer":t||(t=a.defaultEncoding),"function"!=typeof n&&(n=gL),a.ended?(i=this,r=n,o=new Error("write after end"),i.emit("error",o),fR(r,o)):function(e,t,n,i){var r=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):gA.isBuffer(n)||"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),fR(i,o),r=!1),r}(this,a,e,n)&&(a.pendingcb++,s=function(e,t,n,i,r){var o,a,s;a=n,s=i,(o=t).objectMode||!1===o.decodeStrings||"string"!=typeof a||(a=gA.from(a,s)),n=a,gA.isBuffer(n)&&(i="buffer");var c=t.objectMode?1:n.length;t.length+=c;var u=t.length<t.highWaterMark;if(u||(t.needDrain=!0),t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest=new mL(n,i,r),l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else yL(e,t,!1,c,n,i,r);return u}(this,a,e,t,n)),s},_L.prototype.cork=function(){this._writableState.corked++},_L.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||ML(this,e))},_L.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},_L.prototype._write=function(e,t,n){n(new Error("not implemented"))},_L.prototype._writev=null,_L.prototype.end=function(e,t,n){var i,r,o,a=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),a.corked&&(a.corked=1,this.uncork()),a.ending||a.finished||(i=this,o=n,(r=a).ending=!0,SL(i,r),o&&(r.finished?fR(o):i.once("finish",o)),r.ended=!0,i.writable=!1)},SR(wL,tL);for(var kL=Object.keys(_L.prototype),bL=0;bL<kL.length;bL++){var DL=kL[bL];wL.prototype[DL]||(wL.prototype[DL]=_L.prototype[DL])}function wL(e){if(!(this instanceof wL))return new wL(e);tL.call(this,e),_L.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",AL)}function AL(){this.allowHalfOpen||this._writableState.ended||fR(RL,this)}function RL(e){e.end()}function LL(e){this.afterTransform=function(t,n){return function(e,t,n){var i=e._transformState;i.transforming=!1;var r=i.writecb;if(!r)return e.emit("error",new Error("no writecb in Transform class"));i.writechunk=null,i.writecb=null,null!=n&&e.push(n),r(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function OL(e){if(!(this instanceof OL))return new OL(e);wL.call(this,e),this._transformState=new LL(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e){NL(t,e)})):NL(t)}))}function NL(e,t){if(t)return e.emit("error",t);var n=e._writableState,i=e._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}function PL(e){if(!(this instanceof PL))return new PL(e);OL.call(this,e)}function UL(){_R.call(this)}SR(OL,wL),OL.prototype.push=function(e,t){return this._transformState.needTransform=!1,wL.prototype.push.call(this,e,t)},OL.prototype._transform=function(e,t,n){throw new Error("Not implemented")},OL.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},OL.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},SR(PL,OL),PL.prototype._transform=function(e,t,n){n(null,e)},SR(UL,_R),UL.Readable=tL,UL.Writable=_L,UL.Duplex=wL,UL.Transform=OL,UL.PassThrough=PL,UL.Stream=UL,UL.prototype.pipe=function(e,t){var n=this;function i(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function r(){n.readable&&n.resume&&n.resume()}n.on("data",i),e.on("drain",r),e._isStdio||t&&!1===t.end||(n.on("end",a),n.on("close",s));var o=!1;function a(){o||(o=!0,e.end())}function s(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===_R.listenerCount(this,"error"))throw e}function u(){n.removeListener("data",i),e.removeListener("drain",r),n.removeListener("end",a),n.removeListener("close",s),n.removeListener("error",c),e.removeListener("error",c),n.removeListener("end",u),n.removeListener("close",u),e.removeListener("close",u)}return n.on("error",c),e.on("error",c),n.on("end",u),n.on("close",u),e.on("close",u),e.emit("pipe",n),e};var xL={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function GL(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function FL(e,t,n,i,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),r);else for(var o=0;o<i;o++)e[r+o]=t[n+o]}var VL=Uint8Array,qL=Uint16Array,BL=Int32Array,HL=4,jL=0,KL=1,zL=2;function WL(e){for(var t=e.length;--t>=0;)e[t]=0}var YL=0,$L=1,JL=2,XL=29,ZL=256,QL=ZL+1+XL,eO=30,tO=19,nO=2*QL+1,iO=15,rO=16,oO=7,aO=256,sO=16,cO=17,uO=18,lO=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],dO=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],pO=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],hO=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fO=new Array(2*(QL+2));WL(fO);var gO=new Array(2*eO);WL(gO);var mO=new Array(512);WL(mO);var vO=new Array(256);WL(vO);var _O=new Array(XL);WL(_O);var yO,IO,MO,TO=new Array(eO);function CO(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function SO(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function EO(e){return e<256?mO[e]:mO[256+(e>>>7)]}function kO(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function bO(e,t,n){e.bi_valid>rO-n?(e.bi_buf|=t<<e.bi_valid&65535,kO(e,e.bi_buf),e.bi_buf=t>>rO-e.bi_valid,e.bi_valid+=n-rO):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function DO(e,t,n){bO(e,n[2*t],n[2*t+1])}function wO(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function AO(e,t,n){var i,r,o=new Array(iO+1),a=0;for(i=1;i<=iO;i++)o[i]=a=a+n[i-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=wO(o[s]++,s))}}function RO(e){var t;for(t=0;t<QL;t++)e.dyn_ltree[2*t]=0;for(t=0;t<eO;t++)e.dyn_dtree[2*t]=0;for(t=0;t<tO;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*aO]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function LO(e){e.bi_valid>8?kO(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function OO(e,t,n,i){var r=2*t,o=2*n;return e[r]<e[o]||e[r]===e[o]&&i[t]<=i[n]}function NO(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&OO(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!OO(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function PO(e,t,n){var i,r,o,a,s=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],r=e.pending_buf[e.l_buf+s],s++,0===i?DO(e,r,t):(DO(e,(o=vO[r])+ZL+1,t),0!==(a=lO[o])&&bO(e,r-=_O[o],a),DO(e,o=EO(--i),n),0!==(a=dO[o])&&bO(e,i-=TO[o],a))}while(s<e.last_lit);DO(e,aO,t)}function UO(e,t){var n,i,r,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=nO,n=0;n<c;n++)0!==o[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(r=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=a[2*r+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)NO(e,o,n);r=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],NO(e,o,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,o[2*r]=o[2*n]+o[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,o[2*n+1]=o[2*i+1]=r,e.heap[1]=r++,NO(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,r,o,a,s,c=t.dyn_tree,u=t.max_code,l=t.stat_desc.static_tree,d=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,f=t.stat_desc.max_length,g=0;for(o=0;o<=iO;o++)e.bl_count[o]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<nO;n++)(o=c[2*c[2*(i=e.heap[n])+1]+1]+1)>f&&(o=f,g++),c[2*i+1]=o,i>u||(e.bl_count[o]++,a=0,i>=h&&(a=p[i-h]),s=c[2*i],e.opt_len+=s*(o+a),d&&(e.static_len+=s*(l[2*i+1]+a)));if(0!==g){do{for(o=f-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[f]--,g-=2}while(g>0);for(o=f;0!==o;o--)for(i=e.bl_count[o];0!==i;)(r=e.heap[--n])>u||(c[2*r+1]!==o&&(e.opt_len+=(o-c[2*r+1])*c[2*r],c[2*r+1]=o),i--)}}(e,t),AO(o,u,e.bl_count)}function xO(e,t,n){var i,r,o=-1,a=t[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=a,a=t[2*(i+1)+1],++s<c&&r===a||(s<u?e.bl_tree[2*r]+=s:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[2*sO]++):s<=10?e.bl_tree[2*cO]++:e.bl_tree[2*uO]++,s=0,o=r,0===a?(c=138,u=3):r===a?(c=6,u=3):(c=7,u=4))}function GO(e,t,n){var i,r,o=-1,a=t[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),i=0;i<=n;i++)if(r=a,a=t[2*(i+1)+1],!(++s<c&&r===a)){if(s<u)do{DO(e,r,e.bl_tree)}while(0!=--s);else 0!==r?(r!==o&&(DO(e,r,e.bl_tree),s--),DO(e,sO,e.bl_tree),bO(e,s-3,2)):s<=10?(DO(e,cO,e.bl_tree),bO(e,s-3,3)):(DO(e,uO,e.bl_tree),bO(e,s-11,7));s=0,o=r,0===a?(c=138,u=3):r===a?(c=6,u=3):(c=7,u=4)}}WL(TO);var FO=!1;function VO(e,t,n,i){var r,o,a;bO(e,(YL<<1)+(i?1:0),3),o=t,a=n,LO(r=e),kO(r,a),kO(r,~a),FL(r.pending_buf,r.window,o,a,r.pending),r.pending+=a}function qO(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(vO[n]+ZL+1)]++,e.dyn_dtree[2*EO(t)]++),e.last_lit===e.lit_bufsize-1}function BO(e,t,n,i){for(var r=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(r=r+t[i++]|0)|0}while(--a);r%=65521,o%=65521}return r|o<<16|0}var HO=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();function jO(e,t,n,i){var r=HO,o=i+n;e^=-1;for(var a=i;a<o;a++)e=e>>>8^r[255&(e^t[a])];return-1^e}var KO,zO=-2,WO=3,YO=258,$O=YO+WO+1,JO=103,XO=113,ZO=666;function QO(e,t){return e.msg=xL[t],t}function eN(e){return(e<<1)-(e>4?9:0)}function tN(e){for(var t=e.length;--t>=0;)e[t]=0}function nN(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(FL(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function iN(e,t){(function(e,t,n,i){var r,o,a=0;e.level>0?(e.strm.data_type===zL&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return jL;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return KL;for(t=32;t<ZL;t++)if(0!==e.dyn_ltree[2*t])return KL;return jL}(e)),UO(e,e.l_desc),UO(e,e.d_desc),a=function(e){var t;for(xO(e,e.dyn_ltree,e.l_desc.max_code),xO(e,e.dyn_dtree,e.d_desc.max_code),UO(e,e.bl_desc),t=tO-1;t>=3&&0===e.bl_tree[2*hO[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),r=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=r&&(r=o)):r=o=n+5,n+4<=r&&-1!==t?VO(e,t,n,i):e.strategy===HL||o===r?(bO(e,($L<<1)+(i?1:0),3),PO(e,fO,gO)):(bO(e,(JL<<1)+(i?1:0),3),function(e,t,n,i){var r;for(bO(e,t-257,5),bO(e,n-1,5),bO(e,i-4,4),r=0;r<i;r++)bO(e,e.bl_tree[2*hO[r]+1],3);GO(e,e.dyn_ltree,t-1),GO(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),PO(e,e.dyn_ltree,e.dyn_dtree)),RO(e),i&&LO(e)})(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,nN(e.strm)}function rN(e,t){e.pending_buf[e.pending++]=t}function oN(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function aN(e,t){var n,i,r=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-$O?e.strstart-(e.w_size-$O):0,u=e.window,l=e.w_mask,d=e.prev,p=e.strstart+YO,h=u[o+a-1],f=u[o+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(n=t)+a]===f&&u[n+a-1]===h&&u[n]===u[o]&&u[++n]===u[o+1]){o+=2,n++;do{}while(u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&o<p);if(i=YO-(p-o),o=p-YO,i>a){if(e.match_start=t,a=i,i>=s)break;h=u[o+a-1],f=u[o+a]}}}while((t=d[t&l])>c&&0!=--r);return a<=e.lookahead?a:e.lookahead}function sN(e){var t,n,i,r,o,a,s,c,u,l,d=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=d+(d-$O)){FL(e.window,e.window,d,d,0),e.match_start-=d,e.strstart-=d,e.block_start-=d,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=d?i-d:0}while(--n);t=n=d;do{i=e.prev[--t],e.prev[t]=i>=d?i-d:0}while(--n);r+=d}if(0===e.strm.avail_in)break;if(a=e.strm,s=e.window,c=e.strstart+e.lookahead,u=r,l=void 0,(l=a.avail_in)>u&&(l=u),n=0===l?0:(a.avail_in-=l,FL(s,a.input,a.next_in,l,c),1===a.state.wrap?a.adler=BO(a.adler,s,l,c):2===a.state.wrap&&(a.adler=jO(a.adler,s,l,c)),a.next_in+=l,a.total_in+=l,l),e.lookahead+=n,e.lookahead+e.insert>=WO)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+WO-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<WO)););}while(e.lookahead<$O&&0!==e.strm.avail_in)}function cN(e,t){for(var n,i;;){if(e.lookahead<$O){if(sN(e),e.lookahead<$O&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=WO&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+WO-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-$O&&(e.match_length=aN(e,n)),e.match_length>=WO)if(i=qO(e,e.strstart-e.match_start,e.match_length-WO),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=WO){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+WO-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=qO(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(iN(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<WO-1?e.strstart:WO-1,4===t?(iN(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(iN(e,!1),0===e.strm.avail_out)?1:2}function uN(e,t){for(var n,i,r;;){if(e.lookahead<$O){if(sN(e),e.lookahead<$O&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=WO&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+WO-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=WO-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-$O&&(e.match_length=aN(e,n),e.match_length<=5&&(1===e.strategy||e.match_length===WO&&e.strstart-e.match_start>4096)&&(e.match_length=WO-1)),e.prev_length>=WO&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-WO,i=qO(e,e.strstart-1-e.prev_match,e.prev_length-WO),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+WO-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=WO-1,e.strstart++,i&&(iN(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=qO(e,0,e.window[e.strstart-1]))&&iN(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=qO(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<WO-1?e.strstart:WO-1,4===t?(iN(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(iN(e,!1),0===e.strm.avail_out)?1:2}function lN(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}function dN(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new qL(1146),this.dyn_dtree=new qL(122),this.bl_tree=new qL(78),tN(this.dyn_ltree),tN(this.dyn_dtree),tN(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new qL(16),this.heap=new qL(573),tN(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new qL(573),tN(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function pN(e){var t,n,i,r=(n=e)&&n.state?(n.total_in=n.total_out=0,n.data_type=2,(i=n.state).pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap?42:XO,n.adler=2===i.wrap?0:1,i.last_flush=0,function(e){FO||(function(){var e,t,n,i,r,o=new Array(iO+1);for(n=0,i=0;i<XL-1;i++)for(_O[i]=n,e=0;e<1<<lO[i];e++)vO[n++]=i;for(vO[n-1]=i,r=0,i=0;i<16;i++)for(TO[i]=r,e=0;e<1<<dO[i];e++)mO[r++]=i;for(r>>=7;i<eO;i++)for(TO[i]=r<<7,e=0;e<1<<dO[i]-7;e++)mO[256+r++]=i;for(t=0;t<=iO;t++)o[t]=0;for(e=0;e<=143;)fO[2*e+1]=8,e++,o[8]++;for(;e<=255;)fO[2*e+1]=9,e++,o[9]++;for(;e<=279;)fO[2*e+1]=7,e++,o[7]++;for(;e<=287;)fO[2*e+1]=8,e++,o[8]++;for(AO(fO,QL+1,o),e=0;e<eO;e++)gO[2*e+1]=5,gO[2*e]=wO(e,5);yO=new CO(fO,lO,ZL+1,QL,iO),IO=new CO(gO,dO,0,eO,iO),MO=new CO(new Array(0),pO,0,tO,oO)}(),FO=!0),e.l_desc=new SO(e.dyn_ltree,yO),e.d_desc=new SO(e.dyn_dtree,IO),e.bl_desc=new SO(e.bl_tree,MO),e.bi_buf=0,e.bi_valid=0,RO(e)}(i),0):QO(n,zO);return 0===r&&((t=e.state).window_size=2*t.w_size,tN(t.head),t.max_lazy_match=KO[t.level].max_lazy,t.good_match=KO[t.level].good_length,t.nice_match=KO[t.level].nice_length,t.max_chain_length=KO[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=WO-1,t.match_available=0,t.ins_h=0),r}function hN(e,t){var n,i,r,o;if(!e||!e.state||t>5||t<0)return e?QO(e,zO):zO;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===ZO&&4!==t)return QO(e,0===e.avail_out?-5:zO);if(i.strm=e,n=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,rN(i,31),rN(i,139),rN(i,8),i.gzhead?(rN(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),rN(i,255&i.gzhead.time),rN(i,i.gzhead.time>>8&255),rN(i,i.gzhead.time>>16&255),rN(i,i.gzhead.time>>24&255),rN(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),rN(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(rN(i,255&i.gzhead.extra.length),rN(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=jO(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(rN(i,0),rN(i,0),rN(i,0),rN(i,0),rN(i,0),rN(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),rN(i,3),i.status=XO);else{var a=8+(i.w_bits-8<<4)<<8;a|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(a|=32),a+=31-a%31,i.status=XO,oN(i,a),0!==i.strstart&&(oN(i,e.adler>>>16),oN(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(r=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>r&&(e.adler=jO(e.adler,i.pending_buf,i.pending-r,r)),nN(e),r=i.pending,i.pending!==i.pending_buf_size));)rN(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>r&&(e.adler=jO(e.adler,i.pending_buf,i.pending-r,r)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(e.adler=jO(e.adler,i.pending_buf,i.pending-r,r)),nN(e),r=i.pending,i.pending===i.pending_buf_size)){o=1;break}o=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,rN(i,o)}while(0!==o);i.gzhead.hcrc&&i.pending>r&&(e.adler=jO(e.adler,i.pending_buf,i.pending-r,r)),0===o&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(e.adler=jO(e.adler,i.pending_buf,i.pending-r,r)),nN(e),r=i.pending,i.pending===i.pending_buf_size)){o=1;break}o=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,rN(i,o)}while(0!==o);i.gzhead.hcrc&&i.pending>r&&(e.adler=jO(e.adler,i.pending_buf,i.pending-r,r)),0===o&&(i.status=JO)}else i.status=JO;if(i.status===JO&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&nN(e),i.pending+2<=i.pending_buf_size&&(rN(i,255&e.adler),rN(i,e.adler>>8&255),e.adler=0,i.status=XO)):i.status=XO),0!==i.pending){if(nN(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&eN(t)<=eN(n)&&4!==t)return QO(e,-5);if(i.status===ZO&&0!==e.avail_in)return QO(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&i.status!==ZO){var s=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(sN(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=qO(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(iN(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(iN(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(iN(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,i,r,o,a=e.window;;){if(e.lookahead<=YO){if(sN(e),e.lookahead<=YO&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=WO&&e.strstart>0&&(i=a[r=e.strstart-1])===a[++r]&&i===a[++r]&&i===a[++r]){o=e.strstart+YO;do{}while(i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&r<o);e.match_length=YO-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=WO?(n=qO(e,1,e.match_length-WO),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=qO(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(iN(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(iN(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(iN(e,!1),0===e.strm.avail_out)?1:2}(i,t):KO[i.level].func(i,t);if(3!==s&&4!==s||(i.status=ZO),1===s||3===s)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===s&&(1===t?function(e){var t;bO(e,$L<<1,3),DO(e,aO,fO),16===(t=e).bi_valid?(kO(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(i):5!==t&&(VO(i,0,0,!1),3===t&&(tN(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),nN(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(rN(i,255&e.adler),rN(i,e.adler>>8&255),rN(i,e.adler>>16&255),rN(i,e.adler>>24&255),rN(i,255&e.total_in),rN(i,e.total_in>>8&255),rN(i,e.total_in>>16&255),rN(i,e.total_in>>24&255)):(oN(i,e.adler>>>16),oN(i,65535&e.adler)),nN(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)}KO=[new lN(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(sN(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,iN(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-$O&&(iN(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(iN(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(iN(e,!1),e.strm.avail_out),1)})),new lN(4,4,8,4,cN),new lN(4,5,16,8,cN),new lN(4,6,32,32,cN),new lN(4,4,16,16,uN),new lN(8,16,32,32,uN),new lN(8,16,128,128,uN),new lN(8,32,128,256,uN),new lN(32,128,258,1024,uN),new lN(32,258,258,4096,uN)];var fN=30,gN=12;function mN(e,t){var n,i,r,o,a,s,c,u,l,d,p,h,f,g,m,v,_,y,I,M,T,C,S,E,k;n=e.state,i=e.next_in,E=e.input,r=i+(e.avail_in-5),o=e.next_out,k=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),c=n.dmax,u=n.wsize,l=n.whave,d=n.wnext,p=n.window,h=n.hold,f=n.bits,g=n.lencode,m=n.distcode,v=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;e:do{f<15&&(h+=E[i++]<<f,f+=8,h+=E[i++]<<f,f+=8),y=g[h&v];t:for(;;){if(h>>>=I=y>>>24,f-=I,0==(I=y>>>16&255))k[o++]=65535&y;else{if(!(16&I)){if(0==(64&I)){y=g[(65535&y)+(h&(1<<I)-1)];continue t}if(32&I){n.mode=gN;break e}e.msg="invalid literal/length code",n.mode=fN;break e}M=65535&y,(I&=15)&&(f<I&&(h+=E[i++]<<f,f+=8),M+=h&(1<<I)-1,h>>>=I,f-=I),f<15&&(h+=E[i++]<<f,f+=8,h+=E[i++]<<f,f+=8),y=m[h&_];n:for(;;){if(h>>>=I=y>>>24,f-=I,!(16&(I=y>>>16&255))){if(0==(64&I)){y=m[(65535&y)+(h&(1<<I)-1)];continue n}e.msg="invalid distance code",n.mode=fN;break e}if(T=65535&y,f<(I&=15)&&(h+=E[i++]<<f,(f+=8)<I&&(h+=E[i++]<<f,f+=8)),(T+=h&(1<<I)-1)>c){e.msg="invalid distance too far back",n.mode=fN;break e}if(h>>>=I,f-=I,T>(I=o-a)){if((I=T-I)>l&&n.sane){e.msg="invalid distance too far back",n.mode=fN;break e}if(C=0,S=p,0===d){if(C+=u-I,I<M){M-=I;do{k[o++]=p[C++]}while(--I);C=o-T,S=k}}else if(d<I){if(C+=u+d-I,(I-=d)<M){M-=I;do{k[o++]=p[C++]}while(--I);if(C=0,d<M){M-=I=d;do{k[o++]=p[C++]}while(--I);C=o-T,S=k}}}else if(C+=d-I,I<M){M-=I;do{k[o++]=p[C++]}while(--I);C=o-T,S=k}for(;M>2;)k[o++]=S[C++],k[o++]=S[C++],k[o++]=S[C++],M-=3;M&&(k[o++]=S[C++],M>1&&(k[o++]=S[C++]))}else{C=o-T;do{k[o++]=k[C++],k[o++]=k[C++],k[o++]=k[C++],M-=3}while(M>2);M&&(k[o++]=k[C++],M>1&&(k[o++]=k[C++]))}break}}break}}while(i<r&&o<s);i-=M=f>>3,h&=(1<<(f-=M<<3))-1,e.next_in=i,e.next_out=o,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=o<s?s-o+257:257-(o-s),n.hold=h,n.bits=f}var vN=15,_N=852,yN=592,IN=0,MN=1,TN=2,CN=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],SN=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],EN=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],kN=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function bN(e,t,n,i,r,o,a,s){var c,u,l,d,p,h,f,g,m,v=s.bits,_=0,y=0,I=0,M=0,T=0,C=0,S=0,E=0,k=0,b=0,D=null,w=0,A=new qL(vN+1),R=new qL(vN+1),L=null,O=0;for(_=0;_<=vN;_++)A[_]=0;for(y=0;y<i;y++)A[t[n+y]]++;for(T=v,M=vN;M>=1&&0===A[M];M--);if(T>M&&(T=M),0===M)return r[o++]=20971520,r[o++]=20971520,s.bits=1,0;for(I=1;I<M&&0===A[I];I++);for(T<I&&(T=I),E=1,_=1;_<=vN;_++)if(E<<=1,(E-=A[_])<0)return-1;if(E>0&&(e===IN||1!==M))return-1;for(R[1]=0,_=1;_<vN;_++)R[_+1]=R[_]+A[_];for(y=0;y<i;y++)0!==t[n+y]&&(a[R[t[n+y]]++]=y);if(e===IN?(D=L=a,h=19):e===MN?(D=CN,w-=257,L=SN,O-=257,h=256):(D=EN,L=kN,h=-1),b=0,y=0,_=I,p=o,C=T,S=0,l=-1,d=(k=1<<T)-1,e===MN&&k>_N||e===TN&&k>yN)return 1;for(;;){f=_-S,a[y]<h?(g=0,m=a[y]):a[y]>h?(g=L[O+a[y]],m=D[w+a[y]]):(g=96,m=0),c=1<<_-S,I=u=1<<C;do{r[p+(b>>S)+(u-=c)]=f<<24|g<<16|m|0}while(0!==u);for(c=1<<_-1;b&c;)c>>=1;if(0!==c?(b&=c-1,b+=c):b=0,y++,0==--A[_]){if(_===M)break;_=t[n+a[y]]}if(_>T&&(b&d)!==l){for(0===S&&(S=T),p+=I,E=1<<(C=_-S);C+S<M&&!((E-=A[C+S])<=0);)C++,E<<=1;if(k+=1<<C,e===MN&&k>_N||e===TN&&k>yN)return 1;r[l=b&d]=T<<24|C<<16|p-o|0}}return 0!==b&&(r[p+b]=_-S<<24|64<<16|0),s.bits=T,0}var DN=1,wN=2,AN=0,RN=-2,LN=1,ON=12,NN=30,PN=852,UN=592;function xN(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function GN(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new qL(320),this.work=new qL(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function FN(e){var t,n,i;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,(n=e)&&n.state?(i=n.state,n.total_in=n.total_out=i.total=0,n.msg="",i.wrap&&(n.adler=1&i.wrap),i.mode=LN,i.last=0,i.havedict=0,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new BL(PN),i.distcode=i.distdyn=new BL(UN),i.sane=1,i.back=-1,AN):RN):RN}var VN,qN,BN=!0;function HN(e){if(BN){var t;for(VN=new BL(512),qN=new BL(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(bN(DN,e.lens,0,288,VN,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;bN(wN,e.lens,0,32,qN,0,e.work,{bits:5}),BN=!1}e.lencode=VN,e.lenbits=9,e.distcode=qN,e.distbits=5}var jN;function KN(e){if(e<1||e>7)throw new TypeError("Bad argument");this.mode=e,this.init_done=!1,this.write_in_progress=!1,this.pending_close=!1,this.windowBits=0,this.level=0,this.memLevel=0,this.strategy=0,this.dictionary=null}function zN(e,t){for(var n=0;n<e.length;n++)this[t+n]=e[n]}KN.prototype.init=function(e,t,n,i,r){var o;switch(this.windowBits=e,this.level=t,this.memLevel=n,this.strategy=i,3!==this.mode&&4!==this.mode||(this.windowBits+=16),7===this.mode&&(this.windowBits+=32),5!==this.mode&&6!==this.mode||(this.windowBits=-this.windowBits),this.strm=new GL,this.mode){case 1:case 3:case 5:o=function(e,t,n,i,r,o){if(!e)return zO;var a=1;if(-1===t&&(t=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),r<1||r>9||i<8||i>15||t<0||t>9||o<0||o>4)return QO(e,zO);8===i&&(i=9);var s=new dN;return e.state=s,s.strm=e,s.wrap=a,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=r+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+WO-1)/WO),s.window=new VL(2*s.w_size),s.head=new qL(s.hash_size),s.prev=new qL(s.w_size),s.lit_bufsize=1<<r+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new VL(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=o,s.method=8,pN(e)}(this.strm,this.level,0,this.windowBits,this.memLevel,this.strategy);break;case 2:case 4:case 6:case 7:o=function(e,t){var n,i,r,o,a,s;return e?(i=new GN,e.state=i,i.window=null,o=t,(n=(r=e)&&r.state?(s=r.state,o<0?(a=0,o=-o):(a=1+(o>>4),o<48&&(o&=15)),o&&(o<8||o>15)?RN:(null!==s.window&&s.wbits!==o&&(s.window=null),s.wrap=a,s.wbits=o,FN(r))):RN)!==AN&&(e.state=null),n):RN}(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}0===o?(this.write_in_progress=!1,this.init_done=!0):this._error(o)},KN.prototype.params=function(){throw new Error("deflateParams Not supported")},KN.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(0===this.mode)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")},KN.prototype.write=function(e,t,n,i,r,o,a){this._writeCheck(),this.write_in_progress=!0;var s=this;return fR((function(){s.write_in_progress=!1;var c=s._write(e,t,n,i,r,o,a);s.callback(c[0],c[1]),s.pending_close&&s.close()})),this},KN.prototype.writeSync=function(e,t,n,i,r,o,a){return this._writeCheck(),this._write(e,t,n,i,r,o,a)},KN.prototype._write=function(e,t,n,i,r,o,a){if(this.write_in_progress=!0,0!==e&&1!==e&&2!==e&&3!==e&&4!==e&&5!==e)throw new Error("Invalid flush value");null==t&&(t=new gA(0),i=0,n=0),r._set?r.set=r._set:r.set=zN;var s,c=this.strm;switch(c.avail_in=i,c.input=t,c.next_in=n,c.avail_out=a,c.output=r,c.next_out=o,this.mode){case 1:case 3:case 5:s=hN(c,e);break;case 7:case 2:case 4:case 6:s=function(e,t){var n,i,r,o,a,s,c,u,l,d,p,h,f,g,m,v,_,y,I,M,T,C,S,E,k,b,D,w,A,R,L=0,O=new VL(4),N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return RN;(n=e.state).mode===ON&&(n.mode=13),a=e.next_out,r=e.output,c=e.avail_out,o=e.next_in,i=e.input,s=e.avail_in,u=n.hold,l=n.bits,d=s,p=c,C=AN;e:for(;;)switch(n.mode){case LN:if(0===n.wrap){n.mode=13;break}for(;l<16;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(2&n.wrap&&35615===u){n.check=0,O[0]=255&u,O[1]=u>>>8&255,n.check=jO(n.check,O,2,0),u=0,l=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=NN;break}if(8!=(15&u)){e.msg="unknown compression method",n.mode=NN;break}if(l-=4,T=8+(15&(u>>>=4)),0===n.wbits)n.wbits=T;else if(T>n.wbits){e.msg="invalid window size",n.mode=NN;break}n.dmax=1<<T,e.adler=n.check=1,n.mode=512&u?10:ON,u=0,l=0;break;case 2:for(;l<16;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(n.flags=u,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=NN;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=NN;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&(O[0]=255&u,O[1]=u>>>8&255,n.check=jO(n.check,O,2,0)),u=0,l=0,n.mode=3;case 3:for(;l<32;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}n.head&&(n.head.time=u),512&n.flags&&(O[0]=255&u,O[1]=u>>>8&255,O[2]=u>>>16&255,O[3]=u>>>24&255,n.check=jO(n.check,O,4,0)),u=0,l=0,n.mode=4;case 4:for(;l<16;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&(O[0]=255&u,O[1]=u>>>8&255,n.check=jO(n.check,O,2,0)),u=0,l=0,n.mode=5;case 5:if(1024&n.flags){for(;l<16;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&(O[0]=255&u,O[1]=u>>>8&255,n.check=jO(n.check,O,2,0)),u=0,l=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((h=n.length)>s&&(h=s),h&&(n.head&&(T=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),FL(n.head.extra,i,o,h,T)),512&n.flags&&(n.check=jO(n.check,i,h,o)),s-=h,o+=h,n.length-=h),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===s)break e;h=0;do{T=i[o+h++],n.head&&T&&n.length<65536&&(n.head.name+=String.fromCharCode(T))}while(T&&h<s);if(512&n.flags&&(n.check=jO(n.check,i,h,o)),s-=h,o+=h,T)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===s)break e;h=0;do{T=i[o+h++],n.head&&T&&n.length<65536&&(n.head.comment+=String.fromCharCode(T))}while(T&&h<s);if(512&n.flags&&(n.check=jO(n.check,i,h,o)),s-=h,o+=h,T)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;l<16;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=NN;break}u=0,l=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=ON;break;case 10:for(;l<32;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}e.adler=n.check=xN(u),u=0,l=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,n.hold=u,n.bits=l,2;e.adler=n.check=1,n.mode=ON;case ON:if(5===t||6===t)break e;case 13:if(n.last){u>>>=7&l,l-=7&l,n.mode=27;break}for(;l<3;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}switch(n.last=1&u,l-=1,3&(u>>>=1)){case 0:n.mode=14;break;case 1:if(HN(n),n.mode=20,6===t){u>>>=2,l-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=NN}u>>>=2,l-=2;break;case 14:for(u>>>=7&l,l-=7&l;l<32;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=NN;break}if(n.length=65535&u,u=0,l=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(h=n.length){if(h>s&&(h=s),h>c&&(h=c),0===h)break e;FL(r,i,o,h,a),s-=h,o+=h,c-=h,a+=h,n.length-=h;break}n.mode=ON;break;case 17:for(;l<14;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(n.nlen=257+(31&u),u>>>=5,l-=5,n.ndist=1+(31&u),u>>>=5,l-=5,n.ncode=4+(15&u),u>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=NN;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;l<3;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}n.lens[N[n.have++]]=7&u,u>>>=3,l-=3}for(;n.have<19;)n.lens[N[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,S={bits:n.lenbits},C=bN(0,n.lens,0,19,n.lencode,0,n.work,S),n.lenbits=S.bits,C){e.msg="invalid code lengths set",n.mode=NN;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;v=(L=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,_=65535&L,!((m=L>>>24)<=l);){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(_<16)u>>>=m,l-=m,n.lens[n.have++]=_;else{if(16===_){for(E=m+2;l<E;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(u>>>=m,l-=m,0===n.have){e.msg="invalid bit length repeat",n.mode=NN;break}T=n.lens[n.have-1],h=3+(3&u),u>>>=2,l-=2}else if(17===_){for(E=m+3;l<E;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}l-=m,T=0,h=3+(7&(u>>>=m)),u>>>=3,l-=3}else{for(E=m+7;l<E;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}l-=m,T=0,h=11+(127&(u>>>=m)),u>>>=7,l-=7}if(n.have+h>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=NN;break}for(;h--;)n.lens[n.have++]=T}}if(n.mode===NN)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=NN;break}if(n.lenbits=9,S={bits:n.lenbits},C=bN(DN,n.lens,0,n.nlen,n.lencode,0,n.work,S),n.lenbits=S.bits,C){e.msg="invalid literal/lengths set",n.mode=NN;break}if(n.distbits=6,n.distcode=n.distdyn,S={bits:n.distbits},C=bN(wN,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,S),n.distbits=S.bits,C){e.msg="invalid distances set",n.mode=NN;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(s>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,n.hold=u,n.bits=l,mN(e,p),a=e.next_out,r=e.output,c=e.avail_out,o=e.next_in,i=e.input,s=e.avail_in,u=n.hold,l=n.bits,n.mode===ON&&(n.back=-1);break}for(n.back=0;v=(L=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,_=65535&L,!((m=L>>>24)<=l);){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(v&&0==(240&v)){for(y=m,I=v,M=_;v=(L=n.lencode[M+((u&(1<<y+I)-1)>>y)])>>>16&255,_=65535&L,!(y+(m=L>>>24)<=l);){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}u>>>=y,l-=y,n.back+=y}if(u>>>=m,l-=m,n.back+=m,n.length=_,0===v){n.mode=26;break}if(32&v){n.back=-1,n.mode=ON;break}if(64&v){e.msg="invalid literal/length code",n.mode=NN;break}n.extra=15&v,n.mode=22;case 22:if(n.extra){for(E=n.extra;l<E;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;v=(L=n.distcode[u&(1<<n.distbits)-1])>>>16&255,_=65535&L,!((m=L>>>24)<=l);){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(0==(240&v)){for(y=m,I=v,M=_;v=(L=n.distcode[M+((u&(1<<y+I)-1)>>y)])>>>16&255,_=65535&L,!(y+(m=L>>>24)<=l);){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}u>>>=y,l-=y,n.back+=y}if(u>>>=m,l-=m,n.back+=m,64&v){e.msg="invalid distance code",n.mode=NN;break}n.offset=_,n.extra=15&v,n.mode=24;case 24:if(n.extra){for(E=n.extra;l<E;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=NN;break}n.mode=25;case 25:if(0===c)break e;if(h=p-c,n.offset>h){if((h=n.offset-h)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=NN;break}h>n.wnext?(h-=n.wnext,f=n.wsize-h):f=n.wnext-h,h>n.length&&(h=n.length),g=n.window}else g=r,f=a-n.offset,h=n.length;h>c&&(h=c),c-=h,n.length-=h;do{r[a++]=g[f++]}while(--h);0===n.length&&(n.mode=21);break;case 26:if(0===c)break e;r[a++]=n.length,c--,n.mode=21;break;case 27:if(n.wrap){for(;l<32;){if(0===s)break e;s--,u|=i[o++]<<l,l+=8}if(p-=c,e.total_out+=p,n.total+=p,p&&(e.adler=n.check=n.flags?jO(n.check,r,p,a-p):BO(n.check,r,p,a-p)),p=c,(n.flags?u:xN(u))!==n.check){e.msg="incorrect data check",n.mode=NN;break}u=0,l=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;l<32;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=NN;break}u=0,l=0}n.mode=29;case 29:C=1;break e;case NN:C=-3;break e;case 31:return-4;default:return RN}return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,n.hold=u,n.bits=l,(n.wsize||p!==e.avail_out&&n.mode<NN&&(n.mode<27||4!==t))&&(k=e,b=e.output,D=e.next_out,w=p-e.avail_out,null===(R=k.state).window&&(R.wsize=1<<R.wbits,R.wnext=0,R.whave=0,R.window=new VL(R.wsize)),w>=R.wsize?(FL(R.window,b,D-R.wsize,R.wsize,0),R.wnext=0,R.whave=R.wsize):((A=R.wsize-R.wnext)>w&&(A=w),FL(R.window,b,D-w,A,R.wnext),(w-=A)?(FL(R.window,b,D-w,w,0),R.wnext=w,R.whave=R.wsize):(R.wnext+=A,R.wnext===R.wsize&&(R.wnext=0),R.whave<R.wsize&&(R.whave+=A)))),d-=e.avail_in,p-=e.avail_out,e.total_in+=d,e.total_out+=p,n.total+=p,n.wrap&&p&&(e.adler=n.check=n.flags?jO(n.check,r,p,e.next_out-p):BO(n.check,r,p,e.next_out-p)),e.data_type=n.bits+(n.last?64:0)+(n.mode===ON?128:0)+(20===n.mode||15===n.mode?256:0),(0===d&&0===p||4===t)&&C===AN&&(C=-5),C}(c,e);break;default:throw new Error("Unknown mode "+this.mode)}return 1!==s&&0!==s&&this._error(s),this.write_in_progress=!1,[c.avail_in,c.avail_out]},KN.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,1===this.mode||3===this.mode||5===this.mode?function(e){var t;e&&e.state&&(42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==JO&&t!==XO&&t!==ZO?QO(e,zO):(e.state=null,t===XO&&QO(e,-3)))}(this.strm):function(e){if(!e||!e.state)return RN;var t=e.state;t.window&&(t.window=null),e.state=null}(this.strm),this.mode=0)},KN.prototype.reset=function(){switch(this.mode){case 1:case 5:jN=pN(this.strm);break;case 2:case 6:jN=FN(this.strm)}0!==jN&&this._error(jN)},KN.prototype._error=function(e){this.onerror(xL[e]+": "+this.strm.msg,e),this.write_in_progress=!1,this.pending_close&&this.close()};var WN=Object.freeze({NONE:0,DEFLATE:1,INFLATE:2,GZIP:3,GUNZIP:4,DEFLATERAW:5,INFLATERAW:6,UNZIP:7,Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8,Zlib:KN}),YN={};Object.keys(WN).forEach((function(e){YN[e]=WN[e]})),YN.Z_MIN_WINDOWBITS=8,YN.Z_MAX_WINDOWBITS=15,YN.Z_DEFAULT_WINDOWBITS=15,YN.Z_MIN_CHUNK=64,YN.Z_MAX_CHUNK=1/0,YN.Z_DEFAULT_CHUNK=16384,YN.Z_MIN_MEMLEVEL=1,YN.Z_MAX_MEMLEVEL=9,YN.Z_DEFAULT_MEMLEVEL=8,YN.Z_MIN_LEVEL=-1,YN.Z_MAX_LEVEL=9,YN.Z_DEFAULT_LEVEL=YN.Z_DEFAULT_COMPRESSION;var $N={Z_OK:YN.Z_OK,Z_STREAM_END:YN.Z_STREAM_END,Z_NEED_DICT:YN.Z_NEED_DICT,Z_ERRNO:YN.Z_ERRNO,Z_STREAM_ERROR:YN.Z_STREAM_ERROR,Z_DATA_ERROR:YN.Z_DATA_ERROR,Z_MEM_ERROR:YN.Z_MEM_ERROR,Z_BUF_ERROR:YN.Z_BUF_ERROR,Z_VERSION_ERROR:YN.Z_VERSION_ERROR};function JN(e,t){if("string"==typeof t&&(t=new gA(t)),!ZA(t))throw new TypeError("Not a string or buffer");var n=YN.Z_FINISH;return e._processChunk(t,n)}function XN(e){if(!(this instanceof XN))return new XN(e);rP.call(this,e,YN.DEFLATE)}function ZN(e){if(!(this instanceof ZN))return new ZN(e);rP.call(this,e,YN.INFLATE)}function QN(e){if(!(this instanceof QN))return new QN(e);rP.call(this,e,YN.GZIP)}function eP(e){if(!(this instanceof eP))return new eP(e);rP.call(this,e,YN.GUNZIP)}function tP(e){if(!(this instanceof tP))return new tP(e);rP.call(this,e,YN.DEFLATERAW)}function nP(e){if(!(this instanceof nP))return new nP(e);rP.call(this,e,YN.INFLATERAW)}function iP(e){if(!(this instanceof iP))return new iP(e);rP.call(this,e,YN.UNZIP)}function rP(e,t){if(this._opts=e=e||{},this._chunkSize=e.chunkSize||YN.Z_DEFAULT_CHUNK,OL.call(this,e),e.flush&&e.flush!==YN.Z_NO_FLUSH&&e.flush!==YN.Z_PARTIAL_FLUSH&&e.flush!==YN.Z_SYNC_FLUSH&&e.flush!==YN.Z_FULL_FLUSH&&e.flush!==YN.Z_FINISH&&e.flush!==YN.Z_BLOCK)throw new Error("Invalid flush flag: "+e.flush);if(this._flushFlag=e.flush||YN.Z_NO_FLUSH,e.chunkSize&&(e.chunkSize<YN.Z_MIN_CHUNK||e.chunkSize>YN.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<YN.Z_MIN_WINDOWBITS||e.windowBits>YN.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<YN.Z_MIN_LEVEL||e.level>YN.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<YN.Z_MIN_MEMLEVEL||e.memLevel>YN.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=YN.Z_FILTERED&&e.strategy!=YN.Z_HUFFMAN_ONLY&&e.strategy!=YN.Z_RLE&&e.strategy!=YN.Z_FIXED&&e.strategy!=YN.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!ZA(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._binding=new YN.Zlib(t);var n=this;this._hadError=!1,this._binding.onerror=function(e,t){n._binding=null,n._hadError=!0;var i=new Error(e);i.errno=t,i.code=YN.codes[t],n.emit("error",i)};var i=YN.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(i=e.level);var r=YN.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(r=e.strategy),this._binding.init(e.windowBits||YN.Z_DEFAULT_WINDOWBITS,i,e.memLevel||YN.Z_DEFAULT_MEMLEVEL,r,e.dictionary),this._buffer=new gA(this._chunkSize),this._offset=0,this._closed=!1,this._level=i,this._strategy=r,this.once("end",this.close)}Object.keys($N).forEach((function(e){$N[$N[e]]=e})),SR(rP,OL),rP.prototype.params=function(e,t,n){if(e<YN.Z_MIN_LEVEL||e>YN.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+e);if(t!=YN.Z_FILTERED&&t!=YN.Z_HUFFMAN_ONLY&&t!=YN.Z_RLE&&t!=YN.Z_FIXED&&t!=YN.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+t);if(this._level!==e||this._strategy!==t){var i=this;this.flush(YN.Z_SYNC_FLUSH,(function(){i._binding.params(e,t),i._hadError||(i._level=e,i._strategy=t,n&&n())}))}else fR(n)},rP.prototype.reset=function(){return this._binding.reset()},rP.prototype._flush=function(e){this._transform(new gA(0),"",e)},rP.prototype.flush=function(e,t){var n=this._writableState;if(("function"==typeof e||void 0===e&&!t)&&(t=e,e=YN.Z_FULL_FLUSH),n.ended)t&&fR(t);else if(n.ending)t&&this.once("end",t);else if(n.needDrain){var i=this;this.once("drain",(function(){i.flush(t)}))}else this._flushFlag=e,this.write(new gA(0),"",t)},rP.prototype.close=function(e){if(e&&fR(e),!this._closed){this._closed=!0,this._binding.close();var t=this;fR((function(){t.emit("close")}))}},rP.prototype._transform=function(e,t,n){var i,r=this._writableState,o=(r.ending||r.ended)&&(!e||r.length===e.length);if(null===!e&&!ZA(e))return n(new Error("invalid input"));o?i=YN.Z_FINISH:(i=this._flushFlag,e.length>=r.length&&(this._flushFlag=this._opts.flush||YN.Z_NO_FLUSH)),this._processChunk(e,i,n)},rP.prototype._processChunk=function(e,t,n){var i=e&&e.length,r=this._chunkSize-this._offset,o=0,a=this,s="function"==typeof n;if(!s){var c,u=[],l=0;this.on("error",(function(e){c=e}));do{var d=this._binding.writeSync(t,e,o,i,this._buffer,this._offset,r)}while(!this._hadError&&f(d[0],d[1]));if(this._hadError)throw c;var p=gA.concat(u,l);return this.close(),p}var h=this._binding.write(t,e,o,i,this._buffer,this._offset,r);function f(c,d){if(!a._hadError){var p=r-d;if(function(e,t){if(!e)throw new Error("have should not go down")}(p>=0),p>0){var h=a._buffer.slice(a._offset,a._offset+p);a._offset+=p,s?a.push(h):(u.push(h),l+=h.length)}if((0===d||a._offset>=a._chunkSize)&&(r=a._chunkSize,a._offset=0,a._buffer=new gA(a._chunkSize)),0===d){if(o+=i-c,i=c,!s)return!0;var g=a._binding.write(t,e,o,i,a._buffer,a._offset,a._chunkSize);return g.callback=f,void(g.buffer=e)}if(!s)return!1;n()}}h.buffer=e,h.callback=f},SR(XN,rP),SR(ZN,rP),SR(QN,rP),SR(eP,rP),SR(tP,rP),SR(nP,rP),SR(iP,rP);var oP=function(e,t){return JN(new XN(t),e)},aP=function(e,t){return JN(new ZN(t),e)};class sP{constructor(e,t,n){this.SDKAPPID=e,this.EXPIRETIME=n,this.PRIVATEKEY=t}genTestUserSig(e){return this._isNumber(this.SDKAPPID)&&this._isString(this.PRIVATEKEY)&&this._isString(e)&&this._isNumber(this.EXPIRETIME)?this.genSigWithUserbuf(e,this.EXPIRETIME,null):""}newBuffer(e,t){return gA.from?gA.from(e,t):new gA(e,t)}unescape(e){return e.replace(/_/g,"=").replace(/\-/g,"/").replace(/\*/g,"+")}escape(e){return e.replace(/\+/g,"*").replace(/\//g,"-").replace(/=/g,"_")}encode(e){return this.escape(this.newBuffer(e).toString("base64"))}decode(e){return this.newBuffer(this.unescape(e),"base64")}base64encode(e){return this.newBuffer(e).toString("base64")}base64decode(e){return this.newBuffer(e,"base64").toString()}_hmacsha256(e,t,n,i){let r="TLS.identifier:"+e+"\n";r+="TLS.sdkappid:"+this.SDKAPPID+"\n",r+="TLS.time:"+t+"\n",r+="TLS.expire:"+n+"\n",null!=i&&(r+="TLS.userbuf:"+i+"\n");let o=nR.HmacSHA256(r,this.PRIVATEKEY);return nR.enc.Base64.stringify(o)}_utc(){return Math.round(Date.now()/1e3)}_isNumber(e){return null!==e&&("number"==typeof e&&!isNaN(e-0)||"object"==typeof e&&e.constructor===Number)}_isString(e){return"string"==typeof e}genSigWithUserbuf(e,t,n){let i=this._utc(),r={"TLS.ver":"2.0","TLS.identifier":e,"TLS.sdkappid":this.SDKAPPID,"TLS.time":i,"TLS.expire":t},o="";if(null!=n){let a=this.base64encode(n);r["TLS.userbuf"]=a,o=this._hmacsha256(e,i,t,a)}else o=this._hmacsha256(e,i,t,null);r["TLS.sig"]=o;let a=JSON.stringify(r),s=oP(this.newBuffer(a)).toString("base64");return this.escape(s)}validate(e){let t=this.decode(e);aP(t)}}function cP(e){const{SDKAppID:t,secretKey:n,userID:i}=e;return{SDKAppID:t,userSig:new sP(t,n,604800).genTestUserSig(i)}}var uP,lP={},dP={},pP={get exports(){return dP},set exports(e){dP=e}};function hP(){return uP||(uP=1,pP.exports=function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){u(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function n(){n=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(b){c=function(e,t,n){return e[t]=n}}function u(e,t,n,i){var r,o,a,s,c=t&&t.prototype instanceof p?t:p,u=Object.create(c.prototype),h=new S(i||[]);return u._invoke=(r=e,o=n,a=h,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return k()}for(a.method=e,a.arg=t;;){var n=a.delegate;if(n){var i=M(n,a);if(i){if(i===d)continue;return i}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";var c=l(r,o,a);if("normal"===c.type){if(s=a.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:a.done}}"throw"===c.type&&(s="completed",a.method="throw",a.arg=c.arg)}}),u}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(b){return{type:"throw",arg:b}}}e.wrap=u;var d={};function p(){}function h(){}function f(){}var g={};c(g,o,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(E([])));v&&v!==t&&i.call(v,o)&&(g=v);var _=f.prototype=p.prototype=Object.create(g);function y(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function n(r,o,a,s){var c=l(e[r],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var r;this._invoke=function(e,i){function o(){return new t((function(t,r){n(e,i,t,r)}))}return r=r?r.then(o,o):o()}}function M(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,M(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=l(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function E(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:k}}function k(){return{value:void 0,done:!0}}return h.prototype=f,c(_,"constructor",f),c(f,"constructor",h),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},y(I.prototype),c(I.prototype,a,(function(){return this})),e.AsyncIterator=I,e.async=function(t,n,i,r,o){void 0===o&&(o=Promise);var a=new I(u(t,n,i,r),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=E,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,i){return a.type="throw",a.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;C(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t,n,i,r,o,a){try{var s=e[o](a),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(i,r)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var a=e.apply(t,n);function s(e){r(a,i,o,s,c,"next",e)}function c(e){r(a,i,o,s,c,"throw",e)}s(void 0)}))}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(ea){return!1}}function f(e,t,n){return(f=h()?Reflect.construct.bind():function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&p(r,n.prototype),r}).apply(null,arguments)}function g(e){var t="function"==typeof Map?new Map:void 0;return g=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return f(e,arguments,d(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),p(i,e)},g(e)}function m(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function v(e){var t=h();return function(){var n,i=d(e);if(t){var r=d(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return m(this,n)}}function _(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}function y(){return y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=_(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},y.apply(this,arguments)}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);a=!0);}catch(c){s=!0,r=c}finally{try{a||null==n.return||n.return()}finally{if(s)throw r}}return o}}(e,t)||T(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||T(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function E(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=T(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function k(e,t,n,i,r){var o={};return Object.keys(i).forEach((function(e){o[e]=i[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,i){return i(e,t,n)||n}),o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==C?C:"undefined"!=typeof self?self:{},D=function(e){return e&&e.Math==Math&&e},w=D("object"==typeof globalThis&&globalThis)||D("object"==typeof window&&window)||D("object"==typeof self&&self)||D("object"==typeof b&&b)||function(){return this}()||Function("return this")(),A={},R=function(e){try{return!!e()}catch(ta){return!0}},L=!R((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),O=!R((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),N=O,P=Function.prototype.call,U=N?P.bind(P):function(){return P.apply(P,arguments)},x={},G={}.propertyIsEnumerable,F=Object.getOwnPropertyDescriptor,V=F&&!G.call({1:2},1);x.f=V?function(e){var t=F(this,e);return!!t&&t.enumerable}:G;var q,B,H=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},j=O,K=Function.prototype,z=K.call,W=j&&K.bind.bind(z,z),Y=function(e){return j?W(e):function(){return z.apply(e,arguments)}},$=Y,J=$({}.toString),X=$("".slice),Z=function(e){return X(J(e),8,-1)},Q=Z,ee=Y,te=function(e){if("Function"===Q(e))return ee(e)},ne=R,ie=Z,re=Object,oe=te("".split),ae=ne((function(){return!re("z").propertyIsEnumerable(0)}))?function(e){return"String"==ie(e)?oe(e,""):re(e)}:re,se=function(e){return null==e},ce=se,ue=TypeError,le=function(e){if(ce(e))throw ue("Can't call method on "+e);return e},de=ae,pe=le,he=function(e){return de(pe(e))},fe="object"==typeof document&&document.all,ge={all:fe,IS_HTMLDDA:void 0===fe&&void 0!==fe},me=ge.all,ve=ge.IS_HTMLDDA?function(e){return"function"==typeof e||e===me}:function(e){return"function"==typeof e},_e=ve,ye=ge.all,Ie=ge.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:_e(e)||e===ye}:function(e){return"object"==typeof e?null!==e:_e(e)},Me=w,Te=ve,Ce=function(e){return Te(e)?e:void 0},Se=function(e,t){return arguments.length<2?Ce(Me[e]):Me[e]&&Me[e][t]},Ee=te({}.isPrototypeOf),ke=Se("navigator","userAgent")||"",be=w,De=ke,we=be.process,Ae=be.Deno,Re=we&&we.versions||Ae&&Ae.version,Le=Re&&Re.v8;Le&&(B=(q=Le.split("."))[0]>0&&q[0]<4?1:+(q[0]+q[1])),!B&&De&&(!(q=De.match(/Edge\/(\d+)/))||q[1]>=74)&&(q=De.match(/Chrome\/(\d+)/))&&(B=+q[1]);var Oe=B,Ne=Oe,Pe=R,Ue=!!Object.getOwnPropertySymbols&&!Pe((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ne&&Ne<41})),xe=Ue&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ge=Se,Fe=ve,Ve=Ee,qe=Object,Be=xe?function(e){return"symbol"==typeof e}:function(e){var t=Ge("Symbol");return Fe(t)&&Ve(t.prototype,qe(e))},He=String,je=function(e){try{return He(e)}catch(ta){return"Object"}},Ke=ve,ze=je,We=TypeError,Ye=function(e){if(Ke(e))return e;throw We(ze(e)+" is not a function")},$e=Ye,Je=se,Xe=function(e,t){var n=e[t];return Je(n)?void 0:$e(n)},Ze=U,Qe=ve,et=Ie,tt=TypeError,nt={exports:{}},it=w,rt=Object.defineProperty,ot=function(e,t){try{rt(it,e,{value:t,configurable:!0,writable:!0})}catch(n){it[e]=t}return t},at=ot,st="__core-js_shared__",ct=w[st]||at(st,{}),ut=ct;(nt.exports=function(e,t){return ut[e]||(ut[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.25.5",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.5/LICENSE",source:"https://github.com/zloirock/core-js"});var lt=le,dt=Object,pt=function(e){return dt(lt(e))},ht=pt,ft=te({}.hasOwnProperty),gt=Object.hasOwn||function(e,t){return ft(ht(e),t)},mt=te,vt=0,_t=Math.random(),yt=mt(1..toString),It=function(e){return"Symbol("+(void 0===e?"":e)+")_"+yt(++vt+_t,36)},Mt=w,Tt=nt.exports,Ct=gt,St=It,Et=Ue,kt=xe,bt=Tt("wks"),Dt=Mt.Symbol,wt=Dt&&Dt.for,At=kt?Dt:Dt&&Dt.withoutSetter||St,Rt=function(e){if(!Ct(bt,e)||!Et&&"string"!=typeof bt[e]){var t="Symbol."+e;Et&&Ct(Dt,e)?bt[e]=Dt[e]:bt[e]=kt&&wt?wt(t):At(t)}return bt[e]},Lt=U,Ot=Ie,Nt=Be,Pt=Xe,Ut=function(e,t){var n,i;if("string"===t&&Qe(n=e.toString)&&!et(i=Ze(n,e)))return i;if(Qe(n=e.valueOf)&&!et(i=Ze(n,e)))return i;if("string"!==t&&Qe(n=e.toString)&&!et(i=Ze(n,e)))return i;throw tt("Can't convert object to primitive value")},xt=TypeError,Gt=Rt("toPrimitive"),Ft=function(e,t){if(!Ot(e)||Nt(e))return e;var n,i=Pt(e,Gt);if(i){if(void 0===t&&(t="default"),n=Lt(i,e,t),!Ot(n)||Nt(n))return n;throw xt("Can't convert object to primitive value")}return void 0===t&&(t="number"),Ut(e,t)},Vt=Ft,qt=Be,Bt=function(e){var t=Vt(e,"string");return qt(t)?t:t+""},Ht=Ie,jt=w.document,Kt=Ht(jt)&&Ht(jt.createElement),zt=function(e){return Kt?jt.createElement(e):{}},Wt=zt,Yt=!L&&!R((function(){return 7!=Object.defineProperty(Wt("div"),"a",{get:function(){return 7}}).a})),$t=L,Jt=U,Xt=x,Zt=H,Qt=he,en=Bt,tn=gt,nn=Yt,rn=Object.getOwnPropertyDescriptor;A.f=$t?rn:function(e,t){if(e=Qt(e),t=en(t),nn)try{return rn(e,t)}catch(n){}if(tn(e,t))return Zt(!Jt(Xt.f,e,t),e[t])};var on={},an=L&&R((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),sn=Ie,cn=String,un=TypeError,ln=function(e){if(sn(e))return e;throw un(cn(e)+" is not an object")},dn=L,pn=Yt,hn=an,fn=ln,gn=Bt,mn=TypeError,vn=Object.defineProperty,_n=Object.getOwnPropertyDescriptor,yn="enumerable",In="configurable",Mn="writable";on.f=dn?hn?function(e,t,n){if(fn(e),t=gn(t),fn(n),"function"==typeof e&&"prototype"===t&&"value"in n&&Mn in n&&!n.writable){var i=_n(e,t);i&&i.writable&&(e[t]=n.value,n={configurable:In in n?n.configurable:i.configurable,enumerable:yn in n?n.enumerable:i.enumerable,writable:!1})}return vn(e,t,n)}:vn:function(e,t,n){if(fn(e),t=gn(t),fn(n),pn)try{return vn(e,t,n)}catch(i){}if("get"in n||"set"in n)throw mn("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Tn=on,Cn=H,Sn=L?function(e,t,n){return Tn.f(e,t,Cn(1,n))}:function(e,t,n){return e[t]=n,e},En={exports:{}},kn=L,bn=gt,Dn=Function.prototype,wn=kn&&Object.getOwnPropertyDescriptor,An=bn(Dn,"name"),Rn={EXISTS:An,PROPER:An&&"something"===function(){}.name,CONFIGURABLE:An&&(!kn||kn&&wn(Dn,"name").configurable)},Ln=ve,On=ct,Nn=te(Function.toString);Ln(On.inspectSource)||(On.inspectSource=function(e){return Nn(e)});var Pn,Un,xn,Gn=On.inspectSource,Fn=ve,Vn=w.WeakMap,qn=Fn(Vn)&&/native code/.test(String(Vn)),Bn=nt.exports,Hn=It,jn=Bn("keys"),Kn=function(e){return jn[e]||(jn[e]=Hn(e))},zn={},Wn=qn,Yn=w,$n=Ie,Jn=Sn,Xn=gt,Zn=ct,Qn=Kn,ei=zn,ti="Object already initialized",ni=Yn.TypeError,ii=Yn.WeakMap;if(Wn||Zn.state){var ri=Zn.state||(Zn.state=new ii);ri.get=ri.get,ri.has=ri.has,ri.set=ri.set,Pn=function(e,t){if(ri.has(e))throw ni(ti);return t.facade=e,ri.set(e,t),t},Un=function(e){return ri.get(e)||{}},xn=function(e){return ri.has(e)}}else{var oi=Qn("state");ei[oi]=!0,Pn=function(e,t){if(Xn(e,oi))throw ni(ti);return t.facade=e,Jn(e,oi,t),t},Un=function(e){return Xn(e,oi)?e[oi]:{}},xn=function(e){return Xn(e,oi)}}var ai={set:Pn,get:Un,has:xn,enforce:function(e){return xn(e)?Un(e):Pn(e,{})},getterFor:function(e){return function(t){var n;if(!$n(t)||(n=Un(t)).type!==e)throw ni("Incompatible receiver, "+e+" required");return n}}},si=R,ci=ve,ui=gt,li=L,di=Rn.CONFIGURABLE,pi=Gn,hi=ai.enforce,fi=ai.get,gi=Object.defineProperty,mi=li&&!si((function(){return 8!==gi((function(){}),"length",{value:8}).length})),vi=String(String).split("String"),_i=En.exports=function(e,t,n){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!ui(e,"name")||di&&e.name!==t)&&(li?gi(e,"name",{value:t,configurable:!0}):e.name=t),mi&&n&&ui(n,"arity")&&e.length!==n.arity&&gi(e,"length",{value:n.arity});try{n&&ui(n,"constructor")&&n.constructor?li&&gi(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(r){}var i=hi(e);return ui(i,"source")||(i.source=vi.join("string"==typeof t?t:"")),e};Function.prototype.toString=_i((function(){return ci(this)&&fi(this).source||pi(this)}),"toString");var yi=ve,Ii=on,Mi=En.exports,Ti=ot,Ci=function(e,t,n,i){i||(i={});var r=i.enumerable,o=void 0!==i.name?i.name:t;if(yi(n)&&Mi(n,o,i),i.global)r?e[t]=n:Ti(t,n);else{try{i.unsafe?e[t]&&(r=!0):delete e[t]}catch(a){}r?e[t]=n:Ii.f(e,t,{value:n,enumerable:!1,configurable:!i.nonConfigurable,writable:!i.nonWritable})}return e},Si={},Ei=Math.ceil,ki=Math.floor,bi=Math.trunc||function(e){var t=+e;return(t>0?ki:Ei)(t)},Di=function(e){var t=+e;return t!=t||0===t?0:bi(t)},wi=Di,Ai=Math.max,Ri=Math.min,Li=function(e,t){var n=wi(e);return n<0?Ai(n+t,0):Ri(n,t)},Oi=Di,Ni=Math.min,Pi=function(e){return e>0?Ni(Oi(e),9007199254740991):0},Ui=Pi,xi=function(e){return Ui(e.length)},Gi=he,Fi=Li,Vi=xi,qi=function(e){return function(t,n,i){var r,o=Gi(t),a=Vi(o),s=Fi(i,a);if(e&&n!=n){for(;a>s;)if((r=o[s++])!=r)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},Bi={includes:qi(!0),indexOf:qi(!1)},Hi=gt,ji=he,Ki=Bi.indexOf,zi=zn,Wi=te([].push),Yi=function(e,t){var n,i=ji(e),r=0,o=[];for(n in i)!Hi(zi,n)&&Hi(i,n)&&Wi(o,n);for(;t.length>r;)Hi(i,n=t[r++])&&(~Ki(o,n)||Wi(o,n));return o},$i=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ji=Yi,Xi=$i.concat("length","prototype");Si.f=Object.getOwnPropertyNames||function(e){return Ji(e,Xi)};var Zi={};Zi.f=Object.getOwnPropertySymbols;var Qi=Se,er=Si,tr=Zi,nr=ln,ir=te([].concat),rr=Qi("Reflect","ownKeys")||function(e){var t=er.f(nr(e)),n=tr.f;return n?ir(t,n(e)):t},or=gt,ar=rr,sr=A,cr=on,ur=R,lr=ve,dr=/#|\.prototype\./,pr=function(e,t){var n=fr[hr(e)];return n==mr||n!=gr&&(lr(t)?ur(t):!!t)},hr=pr.normalize=function(e){return String(e).replace(dr,".").toLowerCase()},fr=pr.data={},gr=pr.NATIVE="N",mr=pr.POLYFILL="P",vr=pr,_r=w,yr=A.f,Ir=Sn,Mr=Ci,Tr=ot,Cr=function(e,t,n){for(var i=ar(t),r=cr.f,o=sr.f,a=0;a<i.length;a++){var s=i[a];or(e,s)||n&&or(n,s)||r(e,s,o(t,s))}},Sr=vr,Er=function(e,t){var n,i,r,o,a,s=e.target,c=e.global,u=e.stat;if(n=c?_r:u?_r[s]||Tr(s,{}):(_r[s]||{}).prototype)for(i in t){if(o=t[i],r=e.dontCallGetSet?(a=yr(n,i))&&a.value:n[i],!Sr(c?i:s+(u?".":"#")+i,e.forced)&&void 0!==r){if(typeof o==typeof r)continue;Cr(o,r)}(e.sham||r&&r.sham)&&Ir(o,"sham",!0),Mr(n,i,o,e)}},kr=Ye,br=O,Dr=te(te.bind),wr=function(e,t){return kr(e),void 0===t?e:br?Dr(e,t):function(){return e.apply(t,arguments)}},Ar=Z,Rr=Array.isArray||function(e){return"Array"==Ar(e)},Lr={};Lr[Rt("toStringTag")]="z";var Or="[object z]"===String(Lr),Nr=Or,Pr=ve,Ur=Z,xr=Rt("toStringTag"),Gr=Object,Fr="Arguments"==Ur(function(){return arguments}()),Vr=Nr?Ur:function(e){var t,n,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(n){}}(t=Gr(e),xr))?n:Fr?Ur(t):"Object"==(i=Ur(t))&&Pr(t.callee)?"Arguments":i},qr=te,Br=R,Hr=ve,jr=Vr,Kr=Gn,zr=function(){},Wr=[],Yr=Se("Reflect","construct"),$r=/^\s*(?:class|function)\b/,Jr=qr($r.exec),Xr=!$r.exec(zr),Zr=function(e){if(!Hr(e))return!1;try{return Yr(zr,Wr,e),!0}catch(ta){return!1}},Qr=function(e){if(!Hr(e))return!1;switch(jr(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Xr||!!Jr($r,Kr(e))}catch(ta){return!0}};Qr.sham=!0;var eo=!Yr||Br((function(){var e;return Zr(Zr.call)||!Zr(Object)||!Zr((function(){e=!0}))||e}))?Qr:Zr,to=Rr,no=eo,io=Ie,ro=Rt("species"),oo=Array,ao=function(e){var t;return to(e)&&(t=e.constructor,(no(t)&&(t===oo||to(t.prototype))||io(t)&&null===(t=t[ro]))&&(t=void 0)),void 0===t?oo:t},so=function(e,t){return new(ao(e))(0===t?0:t)},co=wr,uo=ae,lo=pt,po=xi,ho=so,fo=te([].push),go=function(e){var t=1==e,n=2==e,i=3==e,r=4==e,o=6==e,a=7==e,s=5==e||o;return function(c,u,l,d){for(var p,h,f=lo(c),g=uo(f),m=co(u,l),v=po(g),_=0,y=d||ho,I=t?y(c,v):n||a?y(c,0):void 0;v>_;_++)if((s||_ in g)&&(h=m(p=g[_],_,f),e))if(t)I[_]=h;else if(h)switch(e){case 3:return!0;case 5:return p;case 6:return _;case 2:fo(I,p)}else switch(e){case 4:return!1;case 7:fo(I,p)}return o?-1:i||r?r:I}},mo={forEach:go(0),map:go(1),filter:go(2),some:go(3),every:go(4),find:go(5),findIndex:go(6),filterReject:go(7)},vo=R,_o=Oe,yo=Rt("species"),Io=function(e){return _o>=51||!vo((function(){var t=[];return(t.constructor={})[yo]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Mo=mo.map;Er({target:"Array",proto:!0,forced:!Io("map")},{map:function(e){return Mo(this,e,arguments.length>1?arguments[1]:void 0)}});var To=mo.filter;Er({target:"Array",proto:!0,forced:!Io("filter")},{filter:function(e){return To(this,e,arguments.length>1?arguments[1]:void 0)}});var Co=Vr,So=Or?{}.toString:function(){return"[object "+Co(this)+"]"};Or||Ci(Object.prototype,"toString",So,{unsafe:!0});var Eo=Er,ko=R,bo=he,Do=A.f,wo=L,Ao=ko((function(){Do(1)}));Eo({target:"Object",stat:!0,forced:!wo||Ao,sham:!wo},{getOwnPropertyDescriptor:function(e,t){return Do(bo(e),t)}});let Ro=!0,Lo=!0;function Oo(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function No(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);const o=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,o),r.apply(this,[e,o])};const o=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Po(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Ro=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Uo(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Lo=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function xo(){if("object"==typeof window){if(Ro)return;"undefined"!=typeof console&&console.log}}function Go(e,t){}function Fo(e){return"[object Object]"===Object.prototype.toString.call(e)}function Vo(e){return Fo(e)?Object.keys(e).reduce((function(t,n){const i=Fo(e[n]),r=i?Vo(e[n]):e[n],o=i&&!Object.keys(r).length;return void 0===r||o?t:Object.assign(t,{[n]:r})}),{}):e}function qo(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((i=>{i.endsWith("Id")?qo(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach((t=>{qo(e,e.get(t),n)}))})))}function Bo(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===i&&n.trackId===t.id&&qo(e,n,r)}))})),r}const Ho=xo;function jo(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[r("min",n)]=i.ideal,t.optional.push(e),e={},e[r("max",n)]=i.ideal,t.optional.push(e)):(e[r("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach((e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let a=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!a&&n.length&&t.includes("back")&&(a=n[n.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),Ho("chrome: "+JSON.stringify(e)),r(e)}))}e.video=i(e.video)}return Ho("chrome: "+JSON.stringify(e)),r(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{i&&i(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return r(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(o(e))))))}}}function Ko(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function zo(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)})),t.stream.getTracks().forEach((n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else No(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function Wo(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Yo(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,i]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const r=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},o=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const i=function(e){n(o(r(e)))};return t.apply(this,[i,e])}return new Promise(((e,n)=>{t.apply(this,[function(t){e(o(r(t)))},n])})).then(n,i)}}function $o(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>Bo(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),No(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>Bo(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach((n=>{n.track===e&&(t?i=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?i=!0:n=t),t.track===e))),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Jo(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),r.apply(this,arguments)}}function Xo(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Jo(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=i[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=a(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=c.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Zo(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}))}function Qo(e,t){No(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var ea,ta,na=Object.freeze({__proto__:null,shimMediaStream:Ko,shimOnTrack:zo,shimGetSendersWithDtmf:Wo,shimGetStats:Yo,shimSenderReceiverGetStats:$o,shimAddTrackRemoveTrackWithNative:Jo,shimAddTrackRemoveTrack:Xo,shimPeerConnection:Zo,fixNegotiationNeeded:Qo,shimGetUserMedia:jo,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&"function"==typeof t&&(e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const i=n.video&&n.video.width,r=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},i&&(n.video.mandatory.maxWidth=i),r&&(n.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(n)}))})}}),ia={exports:{}};ea=ia,(ta={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}}).localCName=ta.generateIdentifier(),ta.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},ta.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},ta.getDescription=function(e){var t=ta.splitSections(e);return t&&t[0]},ta.getMediaSections=function(e){var t=ta.splitSections(e);return t.shift(),t},ta.matchPrefix=function(e,t){return ta.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},ta.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:n[t[i]]=t[i+1]}return n},ta.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},ta.parseIceOptions=function(e){return e.substr(14).split(" ")},ta.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},ta.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},ta.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},ta.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},ta.parseFmtp=function(e){for(var t,n={},i=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<i.length;r++)n[(t=i[r].trim().split("="))[0].trim()]=t[1];return n},ta.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},ta.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},ta.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},ta.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substr(t+1,i-t-1),n.value=e.substr(i+1)):n.attribute=e.substr(t+1),n},ta.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},ta.getMid=function(e){var t=ta.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},ta.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},ta.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:ta.matchPrefix(e+t,"a=fingerprint:").map(ta.parseFingerprint)}},ta.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},ta.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},ta.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?ta.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},ta.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},ta.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},ta.getCryptoParameters=function(e,t){return ta.matchPrefix(e+t,"a=crypto:").map(ta.parseCryptoLine)},ta.getIceParameters=function(e,t){var n=ta.matchPrefix(e+t,"a=ice-ufrag:")[0],i=ta.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},ta.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},ta.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=ta.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var r=n[i],o=ta.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(o){var a=ta.parseRtpMap(o),s=ta.matchPrefix(e,"a=fmtp:"+r+" ");switch(a.parameters=s.length?ta.parseFmtp(s[0]):{},a.rtcpFeedback=ta.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(ta.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return ta.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(ta.parseExtmap(e))})),t},ta.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){n+=ta.writeRtpMap(e),n+=ta.writeFmtp(e),n+=ta.writeRtcpFb(e)}));var i=0;return t.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){n+=ta.writeExtmap(e)})),n},ta.parseRtpEncodingParameters=function(e){var t,n=[],i=ta.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=ta.matchPrefix(e,"a=ssrc:").map((function(e){return ta.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),s=a.length>0&&a[0].ssrc,c=ta.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));c.length>0&&c[0].length>1&&c[0][0]===s&&(t=c[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var i={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&t&&(i.rtx={ssrc:t}),n.push(i),r&&((i=JSON.parse(JSON.stringify(i))).fec={ssrc:s,mechanism:o?"red+ulpfec":"red"},n.push(i))}})),0===n.length&&s&&n.push({ssrc:s});var u=ta.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach((function(e){e.maxBitrate=u}))),n},ta.parseRtcpParameters=function(e){var t={},n=ta.matchPrefix(e,"a=ssrc:").map((function(e){return ta.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=ta.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var r=ta.matchPrefix(e,"a=rtcp-mux");return t.mux=r.length>0,t},ta.parseMsid=function(e){var t,n=ta.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var i=ta.matchPrefix(e,"a=ssrc:").map((function(e){return ta.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},ta.parseSctpDescription=function(e){var t,n=ta.parseMLine(e),i=ta.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var r=ta.matchPrefix(e,"a=sctp-port:");if(r.length>0)return{port:parseInt(r[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(ta.matchPrefix(e,"a=sctpmap:").length>0){var o=ta.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:t}}},ta.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},ta.generateSessionId=function(){return Math.random().toString().substr(2,21)},ta.writeSessionBoilerplate=function(e,t,n){var i=void 0!==t?t:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||ta.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},ta.writeMediaSection=function(e,t,n,i){var r=ta.writeRtpDescription(e.kind,t);if(r+=ta.writeIceParameters(e.iceGatherer.getLocalParameters()),r+=ta.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),r+="a=mid:"+e.mid+"\r\n",e.direction?r+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?r+="a=sendrecv\r\n":e.rtpSender?r+="a=sendonly\r\n":e.rtpReceiver?r+="a=recvonly\r\n":r+="a=inactive\r\n",e.rtpSender){var o="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";r+="a="+o,r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,r+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+ta.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+ta.localCName+"\r\n"),r},ta.getDirection=function(e,t){for(var n=ta.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?ta.getDirection(t):"sendrecv"},ta.getKind=function(e){return ta.splitLines(e)[0].split(" ")[0].substr(2)},ta.isRejected=function(e){return"0"===e.split(" ",2)[1]},ta.parseMLine=function(e){var t=ta.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},ta.parseOLine=function(e){var t=ta.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},ta.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=ta.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},ea.exports=ta;var ra=ia.exports,oa=ia.exports;function aa(e,t,n,i,r){var o=oa.writeRtpDescription(e.kind,t);if(o+=oa.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=oa.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":r||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var s="msid:"+(i?i.id:"-")+" "+a+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+oa.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+oa.localCName+"\r\n"),o}function sa(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},r=function(e,t,n,r){var o=i(e.parameters.apt,n),a=i(t.parameters.apt,r);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach((function(i){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(i.name.toLowerCase()===a.name.toLowerCase()&&i.clockRate===a.clockRate){if("rtx"===i.name.toLowerCase()&&i.parameters&&a.parameters.apt&&!r(i,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(i.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter((function(e){for(var t=0;t<i.rtcpFeedback.length;t++)if(i.rtcpFeedback[t].type===e.type&&i.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var i=0;i<t.headerExtensions.length;i++){var r=t.headerExtensions[i];if(e.uri===r.uri){n.headerExtensions.push(r);break}}})),n}function ca(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function ua(e,t){var n=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return n||e.addRemoteCandidate(t),!n}function la(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}var da=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function i(t,n,i,r){var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=r,e.setTimeout((function(){t._dispatchEvent("track",o)}))}var r=function(n){var i,r,o,a=this,s=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){a[e]=s[e].bind(s)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw la("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=(i=n.iceServers||[],r=t,o=!1,(i=JSON.parse(JSON.stringify(i))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&e.urls;var n="string"==typeof t;return n&&(t=[t]),t=t.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||o?0===e.indexOf("stun:")&&r>=14393&&-1===e.indexOf("?transport=udp"):(o=!0,!0)})),delete e.url,e.urls=n?t[0]:t,!!t.length}}))),this._iceGatherers=[],n.iceCandidatePoolSize)for(var c=n.iceCandidatePoolSize;c>0;c--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=oa.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},r.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,i={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)i.iceTransport=this.transceivers[0].iceTransport,i.dtlsTransport=this.transceivers[0].dtlsTransport;else{var r=this._createIceAndDtlsTransports();i.iceTransport=r.iceTransport,i.dtlsTransport=r.dtlsTransport}return t||this.transceivers.push(i),i},r.prototype.addTrack=function(t,n){if(this._isClosed)throw la("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var i;if(this.transceivers.find((function(e){return e.track===t})))throw la("InvalidAccessError","Track already exists.");for(var r=0;r<this.transceivers.length;r++)this.transceivers[r].track||this.transceivers[r].kind!==t.kind||(i=this.transceivers[r]);return i||(i=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),i.track=t,i.stream=n,i.rtpSender=new e.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},r.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach((function(t){n.addTrack(t,e)}));else{var i=e.clone();e.getTracks().forEach((function(e,t){var n=i.getTracks()[t];e.addEventListener("enabled",(function(e){n.enabled=e.enabled}))})),i.getTracks().forEach((function(e){n.addTrack(e,i)}))}},r.prototype.removeTrack=function(t){if(this._isClosed)throw la("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find((function(e){return e.rtpSender===t}));if(!n)throw la("InvalidAccessError","Sender was not created by this connection.");var i=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(i)&&this.localStreams.indexOf(i)>-1&&this.localStreams.splice(this.localStreams.indexOf(i),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var n=t.getSenders().find((function(t){return t.track===e}));n&&t.removeTrack(n)}))},r.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},r.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},r.prototype._createIceGatherer=function(t,n){var i=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var r=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(r,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;r.state=n?"completed":"gathering",null!==i.transceivers[t].bufferedCandidateEvents&&i.transceivers[t].bufferedCandidateEvents.push(e)},r.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),r},r.prototype._gather=function(t,n){var i=this,r=this.transceivers[n].iceGatherer;if(!r.onlocalcandidate){var o=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,r.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),r.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var a=e.candidate,s=!a||0===Object.keys(a).length;if(s)"new"!==r.state&&"gathering"!==r.state||(r.state="completed");else{"new"===r.state&&(r.state="gathering"),a.component=1,a.ufrag=r.getLocalParameters().usernameFragment;var c=oa.writeCandidate(a);o.candidate=Object.assign(o.candidate,oa.parseCandidate(c)),o.candidate.candidate=c,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var u=oa.getMediaSections(i._localDescription.sdp);u[o.candidate.sdpMLineIndex]+=s?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",i._localDescription.sdp=oa.getDescription(i._localDescription.sdp)+u.join("");var l=i.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),s||i._dispatchEvent("icecandidate",o),l&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout((function(){o.forEach((function(e){r.onlocalcandidate(e)}))}),0)}},r.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var i=new e.RTCDtlsTransport(n);return i.ondtlsstatechange=function(){t._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:i}},r.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var i=this.transceivers[e].dtlsTransport;i&&(delete i.ondtlsstatechange,delete i.onerror,delete this.transceivers[e].dtlsTransport)},r.prototype._transceive=function(e,n,i){var r=sa(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(r.encodings=e.sendEncodingParameters,r.rtcp={cname:oa.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(r.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(r)),i&&e.rtpReceiver&&r.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?r.encodings=e.recvEncodingParameters:r.encodings=[{}],r.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(r.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(r.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(r))},r.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(la("TypeError",'Unsupported type "'+e.type+'"'));if(!ca("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(la("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=oa.splitSections(e.sdp),n=t.shift(),t.forEach((function(e,t){var n=oa.parseRtpParameters(e);i.transceivers[t].localCapabilities=n})),i.transceivers.forEach((function(e,t){i._gather(e.mid,t)}));else if("answer"===e.type){t=oa.splitSections(i._remoteDescription.sdp),n=t.shift();var r=oa.matchPrefix(n,"a=ice-lite").length>0;t.forEach((function(e,t){var o=i.transceivers[t],a=o.iceGatherer,s=o.iceTransport,c=o.dtlsTransport,u=o.localCapabilities,l=o.remoteCapabilities;if(!(oa.isRejected(e)&&0===oa.matchPrefix(e,"a=bundle-only").length||o.rejected)){var d=oa.getIceParameters(e,n),p=oa.getDtlsParameters(e,n);r&&(p.role="server"),i.usingBundle&&0!==t||(i._gather(o.mid,t),"new"===s.state&&s.start(a,d,r?"controlling":"controlled"),"new"===c.state&&c.start(p));var h=sa(u,l);i._transceive(o,h.codecs.length>0,!1)}}))}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(r){var o=this;if(-1===["offer","answer"].indexOf(r.type))return Promise.reject(la("TypeError",'Unsupported type "'+r.type+'"'));if(!ca("setRemoteDescription",r.type,o.signalingState)||o._isClosed)return Promise.reject(la("InvalidStateError","Can not set remote "+r.type+" in state "+o.signalingState));var a={};o.remoteStreams.forEach((function(e){a[e.id]=e}));var s=[],c=oa.splitSections(r.sdp),u=c.shift(),l=oa.matchPrefix(u,"a=ice-lite").length>0,d=oa.matchPrefix(u,"a=group:BUNDLE ").length>0;o.usingBundle=d;var p=oa.matchPrefix(u,"a=ice-options:")[0];return o.canTrickleIceCandidates=!!p&&p.substr(14).split(" ").indexOf("trickle")>=0,c.forEach((function(i,c){var p=oa.splitLines(i),h=oa.getKind(i),f=oa.isRejected(i)&&0===oa.matchPrefix(i,"a=bundle-only").length,g=p[0].substr(2).split(" ")[2],m=oa.getDirection(i,u),v=oa.parseMsid(i),_=oa.getMid(i)||oa.generateIdentifier();if(f||"application"===h&&("DTLS/SCTP"===g||"UDP/DTLS/SCTP"===g))o.transceivers[c]={mid:_,kind:h,protocol:g,rejected:!0};else{var y,I,M,T,C,S,E,k,b;!f&&o.transceivers[c]&&o.transceivers[c].rejected&&(o.transceivers[c]=o._createTransceiver(h,!0));var D,w,A=oa.parseRtpParameters(i);f||(D=oa.getIceParameters(i,u),(w=oa.getDtlsParameters(i,u)).role="client"),E=oa.parseRtpEncodingParameters(i);var R=oa.parseRtcpParameters(i),L=oa.matchPrefix(i,"a=end-of-candidates",u).length>0,O=oa.matchPrefix(i,"a=candidate:").map((function(e){return oa.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===r.type||"answer"===r.type)&&!f&&d&&c>0&&o.transceivers[c]&&(o._disposeIceAndDtlsTransports(c),o.transceivers[c].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[c].iceTransport=o.transceivers[0].iceTransport,o.transceivers[c].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[c].rtpSender&&o.transceivers[c].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[c].rtpReceiver&&o.transceivers[c].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==r.type||f)"answer"!==r.type||f||(I=(y=o.transceivers[c]).iceGatherer,M=y.iceTransport,T=y.dtlsTransport,C=y.rtpReceiver,S=y.sendEncodingParameters,k=y.localCapabilities,o.transceivers[c].recvEncodingParameters=E,o.transceivers[c].remoteCapabilities=A,o.transceivers[c].rtcpParameters=R,O.length&&"new"===M.state&&(!l&&!L||d&&0!==c?O.forEach((function(e){ua(y.iceTransport,e)})):M.setRemoteCandidates(O)),d&&0!==c||("new"===M.state&&M.start(I,D,"controlling"),"new"===T.state&&T.start(w)),!sa(y.localCapabilities,y.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&y.sendEncodingParameters[0].rtx&&delete y.sendEncodingParameters[0].rtx,o._transceive(y,"sendrecv"===m||"recvonly"===m,"sendrecv"===m||"sendonly"===m),!C||"sendrecv"!==m&&"sendonly"!==m?delete y.rtpReceiver:(b=C.track,v?(a[v.stream]||(a[v.stream]=new e.MediaStream),n(b,a[v.stream]),s.push([b,C,a[v.stream]])):(a.default||(a.default=new e.MediaStream),n(b,a.default),s.push([b,C,a.default]))));else{(y=o.transceivers[c]||o._createTransceiver(h)).mid=_,y.iceGatherer||(y.iceGatherer=o._createIceGatherer(c,d)),O.length&&"new"===y.iceTransport.state&&(!L||d&&0!==c?O.forEach((function(e){ua(y.iceTransport,e)})):y.iceTransport.setRemoteCandidates(O)),k=e.RTCRtpReceiver.getCapabilities(h),t<15019&&(k.codecs=k.codecs.filter((function(e){return"rtx"!==e.name}))),S=y.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var N,P=!1;"sendrecv"===m||"sendonly"===m?(P=!y.rtpReceiver,C=y.rtpReceiver||new e.RTCRtpReceiver(y.dtlsTransport,h),P&&(b=C.track,v&&"-"===v.stream||(v?(a[v.stream]||(a[v.stream]=new e.MediaStream,Object.defineProperty(a[v.stream],"id",{get:function(){return v.stream}})),Object.defineProperty(b,"id",{get:function(){return v.track}}),N=a[v.stream]):(a.default||(a.default=new e.MediaStream),N=a.default)),N&&(n(b,N),y.associatedRemoteMediaStreams.push(N)),s.push([b,C,N]))):y.rtpReceiver&&y.rtpReceiver.track&&(y.associatedRemoteMediaStreams.forEach((function(t){var n,i,r=t.getTracks().find((function(e){return e.id===y.rtpReceiver.track.id}));r&&(n=r,(i=t).removeTrack(n),i.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:n})))})),y.associatedRemoteMediaStreams=[]),y.localCapabilities=k,y.remoteCapabilities=A,y.rtpReceiver=C,y.rtcpParameters=R,y.sendEncodingParameters=S,y.recvEncodingParameters=E,o._transceive(o.transceivers[c],!1,P)}}})),void 0===o._dtlsRole&&(o._dtlsRole="offer"===r.type?"active":"passive"),o._remoteDescription={type:r.type,sdp:r.sdp},"offer"===r.type?o._updateSignalingState("have-remote-offer"):o._updateSignalingState("stable"),Object.keys(a).forEach((function(t){var n=a[t];if(n.getTracks().length){if(-1===o.remoteStreams.indexOf(n)){o.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout((function(){o._dispatchEvent("addstream",r)}))}s.forEach((function(e){var t=e[0],r=e[1];n.id===e[2].id&&i(o,t,r,[n])}))}})),s.forEach((function(e){e[2]||i(o,e[0],e[1],[])})),e.setTimeout((function(){o&&o.transceivers&&o.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&e.iceTransport.addRemoteCandidate({})}))}),4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},r.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},r.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},r.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},r.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(la("InvalidStateError","Can not call createOffer after close"));var i=n.transceivers.filter((function(e){return"audio"===e.kind})).length,r=n.transceivers.filter((function(e){return"video"===e.kind})).length,o=arguments[0];if(o){if(o.mandatory||o.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==o.offerToReceiveAudio&&(i=!0===o.offerToReceiveAudio?1:!1===o.offerToReceiveAudio?0:o.offerToReceiveAudio),void 0!==o.offerToReceiveVideo&&(r=!0===o.offerToReceiveVideo?1:!1===o.offerToReceiveVideo?0:o.offerToReceiveVideo)}for(n.transceivers.forEach((function(e){"audio"===e.kind?--i<0&&(e.wantReceive=!1):"video"===e.kind&&--r<0&&(e.wantReceive=!1)}));i>0||r>0;)i>0&&(n._createTransceiver("audio"),i--),r>0&&(n._createTransceiver("video"),r--);var a=oa.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach((function(i,r){var o=i.track,a=i.kind,s=i.mid||oa.generateIdentifier();i.mid=s,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(r,n.usingBundle));var c=e.RTCRtpSender.getCapabilities(a);t<15019&&(c.codecs=c.codecs.filter((function(e){return"rtx"!==e.name}))),c.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),c.headerExtensions.forEach((function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var u=i.sendEncodingParameters||[{ssrc:1001*(2*r+1)}];o&&t>=15019&&"video"===a&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,a)),i.localCapabilities=c,i.sendEncodingParameters=u})),"max-compat"!==n._config.bundlePolicy&&(a+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n",n.transceivers.forEach((function(e,t){a+=aa(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),a+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,a+="a="+oa.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(a+="a=end-of-candidates\r\n"))}));var s=new e.RTCSessionDescription({type:"offer",sdp:a});return Promise.resolve(s)},r.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(la("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(la("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var i=oa.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(i+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),i+="a=ice-options:trickle\r\n";var r=oa.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach((function(e,o){if(!(o+1>r)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?i+="m=application 0 DTLS/SCTP 5000\r\n":i+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?i+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(i+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(i+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var a;e.stream&&("audio"===e.kind?a=e.stream.getAudioTracks()[0]:"video"===e.kind&&(a=e.stream.getVideoTracks()[0]),a&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var s=sa(e.localCapabilities,e.remoteCapabilities);!s.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,i+=aa(e,s,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(i+="a=rtcp-rsize\r\n")}}));var o=new e.RTCSessionDescription({type:"answer",sdp:i});return Promise.resolve(o)},r.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(i,r){if(!n._remoteDescription)return r(la("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<n.transceivers.length;a++)if(n.transceivers[a].mid===e.sdpMid){o=a;break}var s=n.transceivers[o];if(!s)return r(la("OperationError","Can not add ICE candidate"));if(s.rejected)return i();var c=Object.keys(e.candidate).length>0?oa.parseCandidate(e.candidate):{};if("tcp"===c.protocol&&(0===c.port||9===c.port))return i();if(c.component&&1!==c.component)return i();if((0===o||o>0&&s.iceTransport!==n.transceivers[0].iceTransport)&&!ua(s.iceTransport,c))return r(la("OperationError","Can not add ICE candidate"));var u=e.candidate.trim();0===u.indexOf("a=")&&(u=u.substr(2)),(t=oa.getMediaSections(n._remoteDescription.sdp))[o]+="a="+(c.type?u:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=oa.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var l=0;l<n.transceivers.length&&(n.transceivers[l].rejected||(n.transceivers[l].iceTransport.addRemoteCandidate({}),(t=oa.getMediaSections(n._remoteDescription.sdp))[l]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=oa.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));l++);i()}))},r.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)})),!n)throw la("InvalidAccessError","Invalid selector.");return n.getStats()}var i=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&i.push(e[t].getStats())}))})),Promise.all(i).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var i=n.prototype.getStats;n.prototype.getStats=function(){return i.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(n){var i;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(i=e[n]).type]||i.type,t.set(n,e[n])})),t}))}}}));var o=["createOffer","createAnswer"];return o.forEach((function(e){var t=r.prototype[e];r.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(o=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=r.prototype[e];r.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=r.prototype[e];r.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),r};function pa(e){const t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch((e=>{return Promise.reject({name:{PermissionDeniedError:"NotAllowedError"}[(t=e).name]||t.name,message:t.message,constraint:t.constraint,toString(){return this.name}});var t}))}}function ha(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function fa(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){const t=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set(e){t.set.call(this,e);const n=new Event("enabled");n.enabled=e,this.dispatchEvent(n)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const n=da(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=function(e,t){let n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((e=>{if(e&&(e.urls||e.url)){let t=e.urls||e.url;e.url&&!e.urls&&Go("RTCIceServer.url","RTCIceServer.urls");const i="string"==typeof t;return i&&(t=[t]),t=t.filter((e=>{if(0===e.indexOf("stun:"))return!1;const t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!n?(n=!0,!0):t&&!n})),delete e.url,e.urls=i?t[0]:t,!!t.length}}))}(e.iceServers,t.version),xo("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function ga(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}var ma=Object.freeze({__proto__:null,shimPeerConnection:fa,shimReplaceTrack:ga,shimGetUserMedia:pa,shimGetDisplayMedia:ha});function va(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){Go("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function _a(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ya(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,o]=arguments;return i.apply(this,[e||null]).then((e=>{if(t.version<53&&!r)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(i){if("TypeError"!==i.name)throw i;e.forEach(((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(r,o)}}function Ia(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Ma(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),No(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Ta(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Go("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function Ca(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Sa(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return i})}function Ea(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function ka(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function ba(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var Da=Object.freeze({__proto__:null,shimOnTrack:_a,shimPeerConnection:ya,shimSenderGetStats:Ia,shimReceiverGetStats:Ma,shimRemoveStream:Ta,shimRTCDataChannel:Ca,shimAddTransceiver:Sa,shimGetParameters:Ea,shimCreateOffer:ka,shimCreateAnswer:ba,shimGetUserMedia:va,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}});function wa(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function Aa(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function Ra(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};let s=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,n){const i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,n){const i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=s}function La(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(Oa(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function Oa(e){return e&&void 0!==e.video?Object.assign({},e,{video:Vo(e.video)}):e}function Na(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(Go("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Pa(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ua(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}}function xa(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Ga=Object.freeze({__proto__:null,shimLocalStreamsAPI:wa,shimRemoteStreamsAPI:Aa,shimCallbacksAPI:Ra,shimGetUserMedia:La,shimConstraints:Oa,shimRTCIceServerUrls:Na,shimTrackEventTransceiver:Pa,shimCreateOfferLegacy:Ua,shimAudioContext:xa});function Fa(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),i=ra.parseCandidate(e.candidate),r=Object.assign(n,i);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,No(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function Va(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=ra.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=ra.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},i=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},r=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},o=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const r=ra.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=i(arguments[0]),t=r(e),n=o(arguments[0],e);let a;a=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>a}),this._sctp=s}return a.apply(this,arguments)}}function qa(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},No(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function Ba(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function Ha(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function ja(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}var Ka=Object.freeze({__proto__:null,shimRTCIceCandidate:Fa,shimMaxMessageSize:Va,shimSendThrowTypeError:qa,shimConnectionState:Ba,removeExtmapAllowMixed:Ha,shimAddIceCandidateNullOrEmpty:ja});!function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const n=xo,i=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Oo(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=Oo(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=Oo(n.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Oo(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),r={browserDetails:i,commonShim:Ka,extractVersion:Oo,disableLog:Po,disableWarnings:Uo};switch(i.browser){case"chrome":if(!na||!Zo||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=na,ja(e,i),jo(e,i),Ko(e),Zo(e,i),zo(e),Xo(e,i),Wo(e),Yo(e),$o(e),Qo(e,i),Fa(e),Ba(e),Va(e,i),qa(e),Ha(e,i);break;case"firefox":if(!Da||!ya||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Da,ja(e,i),va(e,i),ya(e,i),_a(e),Ta(e),Ia(e),Ma(e),Ca(e),Sa(e),Ea(e),ka(e),ba(e),Fa(e),Ba(e),Va(e,i),qa(e);break;case"edge":if(!ma||!fa||!t.shimEdge)return n("MS edge shim is not included in this adapter release."),r;n("adapter.js shimming edge."),r.browserShim=ma,pa(e),ha(e),fa(e,i),ga(e),Va(e,i),qa(e);break;case"safari":if(!Ga||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Ga,ja(e,i),Na(e),Ua(e),Ra(e),wa(e),Aa(e),Pa(e),La(e),xa(e),Fa(e),Va(e,i),qa(e),Ha(e,i);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var za="4.15.6",Wa={},Ya=Yi,$a=$i,Ja=Object.keys||function(e){return Ya(e,$a)},Xa=L,Za=an,Qa=on,es=ln,ts=he,ns=Ja;Wa.f=Xa&&!Za?Object.defineProperties:function(e,t){es(e);for(var n,i=ts(t),r=ns(t),o=r.length,a=0;o>a;)Qa.f(e,n=r[a++],i[n]);return e};var is,rs=Se("document","documentElement"),os=ln,as=Wa,ss=$i,cs=zn,us=rs,ls=zt,ds=Kn("IE_PROTO"),ps=function(){},hs=function(e){return"<script>"+e+"<\/script>"},fs=function(e){e.write(hs("")),e.close();var t=e.parentWindow.Object;return e=null,t},gs=function(){try{is=new ActiveXObject("htmlfile")}catch(i){}var e,t;gs="undefined"!=typeof document?document.domain&&is?fs(is):((t=ls("iframe")).style.display="none",us.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(hs("document.F=Object")),e.close(),e.F):fs(is);for(var n=ss.length;n--;)delete gs.prototype[ss[n]];return gs()};cs[ds]=!0;var ms=Object.create||function(e,t){var n;return null!==e?(ps.prototype=os(e),n=new ps,ps.prototype=null,n[ds]=e):n=gs(),void 0===t?n:as.f(n,t)},vs=Rt,_s=ms,ys=on.f,Is=vs("unscopables"),Ms=Array.prototype;null==Ms[Is]&&ys(Ms,Is,{configurable:!0,value:_s(null)});var Ts,Cs,Ss,Es=function(e){Ms[Is][e]=!0},ks={},bs=!R((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Ds=gt,ws=ve,As=pt,Rs=bs,Ls=Kn("IE_PROTO"),Os=Object,Ns=Os.prototype,Ps=Rs?Os.getPrototypeOf:function(e){var t=As(e);if(Ds(t,Ls))return t[Ls];var n=t.constructor;return ws(n)&&t instanceof n?n.prototype:t instanceof Os?Ns:null},Us=R,xs=ve,Gs=Ie,Fs=Ps,Vs=Ci,qs=Rt("iterator"),Bs=!1;[].keys&&("next"in(Ss=[].keys())?(Cs=Fs(Fs(Ss)))!==Object.prototype&&(Ts=Cs):Bs=!0),(!Gs(Ts)||Us((function(){var e={};return Ts[qs].call(e)!==e})))&&(Ts={}),xs(Ts[qs])||Vs(Ts,qs,(function(){return this}));var Hs={IteratorPrototype:Ts,BUGGY_SAFARI_ITERATORS:Bs},js=on.f,Ks=gt,zs=Rt("toStringTag"),Ws=function(e,t,n){e&&!n&&(e=e.prototype),e&&!Ks(e,zs)&&js(e,zs,{configurable:!0,value:t})},Ys=Hs.IteratorPrototype,$s=ms,Js=H,Xs=Ws,Zs=ks,Qs=function(){return this},ec=function(e,t,n,i){var r=t+" Iterator";return e.prototype=$s(Ys,{next:Js(+!i,n)}),Xs(e,r,!1),Zs[r]=Qs,e},tc=ve,nc=String,ic=TypeError,rc=te,oc=ln,ac=function(e){if("object"==typeof e||tc(e))return e;throw ic("Can't set "+nc(e)+" as a prototype")},sc=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=rc(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch(i){}return function(n,i){return oc(n),ac(i),t?e(n,i):n.__proto__=i,n}}():void 0),cc=Er,uc=U,lc=ve,dc=ec,pc=Ps,hc=sc,fc=Ws,gc=Sn,mc=Ci,vc=ks,_c=Rn.PROPER,yc=Rn.CONFIGURABLE,Ic=Hs.IteratorPrototype,Mc=Hs.BUGGY_SAFARI_ITERATORS,Tc=Rt("iterator"),Cc="keys",Sc="values",Ec="entries",kc=function(){return this},bc=function(e,t,n,i,r,o,a){dc(n,t,i);var s,c,u,l=function(e){if(e===r&&g)return g;if(!Mc&&e in h)return h[e];switch(e){case Cc:case Sc:case Ec:return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",p=!1,h=e.prototype,f=h[Tc]||h["@@iterator"]||r&&h[r],g=!Mc&&f||l(r),m="Array"==t&&h.entries||f;if(m&&(s=pc(m.call(new e)))!==Object.prototype&&s.next&&(pc(s)!==Ic&&(hc?hc(s,Ic):lc(s[Tc])||mc(s,Tc,kc)),fc(s,d,!0)),_c&&r==Sc&&f&&f.name!==Sc&&(yc?gc(h,"name",Sc):(p=!0,g=function(){return uc(f,this)})),r)if(c={values:l(Sc),keys:o?g:l(Cc),entries:l(Ec)},a)for(u in c)(Mc||p||!(u in h))&&mc(h,u,c[u]);else cc({target:t,proto:!0,forced:Mc||p},c);return h[Tc]!==g&&mc(h,Tc,g,{name:r}),vc[t]=g,c},Dc=function(e,t){return{value:e,done:t}},wc=he,Ac=Es,Rc=ks,Lc=ai,Oc=on.f,Nc=bc,Pc=Dc,Uc=L,xc="Array Iterator",Gc=Lc.set,Fc=Lc.getterFor(xc),Vc=Nc(Array,"Array",(function(e,t){Gc(this,{type:xc,target:wc(e),index:0,kind:t})}),(function(){var e=Fc(this),t=e.target,n=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,Pc(void 0,!0)):Pc("keys"==n?i:"values"==n?t[i]:[i,t[i]],!1)}),"values"),qc=Rc.Arguments=Rc.Array;if(Ac("keys"),Ac("values"),Ac("entries"),Uc&&"values"!==qc.name)try{Oc(qc,"name",{value:"values"})}catch(oY){}var Bc={exports:{}},Hc={},jc=Bt,Kc=on,zc=H,Wc=function(e,t,n){var i=jc(t);i in e?Kc.f(e,i,zc(0,n)):e[i]=n},Yc=Li,$c=xi,Jc=Wc,Xc=Array,Zc=Math.max,Qc=function(e,t,n){for(var i=$c(e),r=Yc(t,i),o=Yc(void 0===n?i:n,i),a=Xc(Zc(o-r,0)),s=0;r<o;r++,s++)Jc(a,s,e[r]);return a.length=s,a},eu=Z,tu=he,nu=Si.f,iu=Qc,ru="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Hc.f=function(e){return ru&&"Window"==eu(e)?function(e){try{return nu(e)}catch(oY){return iu(ru)}}(e):nu(tu(e))};var ou=R((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),au=R,su=Ie,cu=Z,uu=ou,lu=Object.isExtensible,du=au((function(){lu(1)}))||uu?function(e){return!!su(e)&&(!uu||"ArrayBuffer"!=cu(e))&&(!lu||lu(e))}:lu,pu=!R((function(){return Object.isExtensible(Object.preventExtensions({}))})),hu=Er,fu=te,gu=zn,mu=Ie,vu=gt,_u=on.f,yu=Si,Iu=Hc,Mu=du,Tu=pu,Cu=!1,Su=It("meta"),Eu=0,ku=function(e){_u(e,Su,{value:{objectID:"O"+Eu++,weakData:{}}})},bu=Bc.exports={enable:function(){bu.enable=function(){},Cu=!0;var e=yu.f,t=fu([].splice),n={};n[Su]=1,e(n).length&&(yu.f=function(n){for(var i=e(n),r=0,o=i.length;r<o;r++)if(i[r]===Su){t(i,r,1);break}return i},hu({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Iu.f}))},fastKey:function(e,t){if(!mu(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!vu(e,Su)){if(!Mu(e))return"F";if(!t)return"E";ku(e)}return e[Su].objectID},getWeakData:function(e,t){if(!vu(e,Su)){if(!Mu(e))return!0;if(!t)return!1;ku(e)}return e[Su].weakData},onFreeze:function(e){return Tu&&Cu&&Mu(e)&&!vu(e,Su)&&ku(e),e}};gu[Su]=!0;var Du=ks,wu=Rt("iterator"),Au=Array.prototype,Ru=function(e){return void 0!==e&&(Du.Array===e||Au[wu]===e)},Lu=Vr,Ou=Xe,Nu=se,Pu=ks,Uu=Rt("iterator"),xu=function(e){if(!Nu(e))return Ou(e,Uu)||Ou(e,"@@iterator")||Pu[Lu(e)]},Gu=U,Fu=Ye,Vu=ln,qu=je,Bu=xu,Hu=TypeError,ju=function(e,t){var n=arguments.length<2?Bu(e):t;if(Fu(n))return Vu(Gu(n,e));throw Hu(qu(e)+" is not iterable")},Ku=U,zu=ln,Wu=Xe,Yu=function(e,t,n){var i,r;zu(e);try{if(!(i=Wu(e,"return"))){if("throw"===t)throw n;return n}i=Ku(i,e)}catch(oY){r=!0,i=oY}if("throw"===t)throw n;if(r)throw i;return zu(i),n},$u=wr,Ju=U,Xu=ln,Zu=je,Qu=Ru,el=xi,tl=Ee,nl=ju,il=xu,rl=Yu,ol=TypeError,al=function(e,t){this.stopped=e,this.result=t},sl=al.prototype,cl=function(e,t,n){var i,r,o,a,s,c,u,l=n&&n.that,d=!(!n||!n.AS_ENTRIES),p=!(!n||!n.IS_RECORD),h=!(!n||!n.IS_ITERATOR),f=!(!n||!n.INTERRUPTED),g=$u(t,l),m=function(e){return i&&rl(i,"normal",e),new al(!0,e)},v=function(e){return d?(Xu(e),f?g(e[0],e[1],m):g(e[0],e[1])):f?g(e,m):g(e)};if(p)i=e.iterator;else if(h)i=e;else{if(!(r=il(e)))throw ol(Zu(e)+" is not iterable");if(Qu(r)){for(o=0,a=el(e);a>o;o++)if((s=v(e[o]))&&tl(sl,s))return s;return new al(!1)}i=nl(e,r)}for(c=p?e.next:i.next;!(u=Ju(c,i)).done;){try{s=v(u.value)}catch(oY){rl(i,"throw",oY)}if("object"==typeof s&&s&&tl(sl,s))return s}return new al(!1)},ul=Ee,ll=TypeError,dl=function(e,t){if(ul(t,e))return e;throw ll("Incorrect invocation")},pl=Rt("iterator"),hl=!1;try{var fl=0,gl={next:function(){return{done:!!fl++}},return:function(){hl=!0}};gl[pl]=function(){return this},Array.from(gl,(function(){throw 2}))}catch(oY){}var ml=function(e,t){if(!t&&!hl)return!1;var n=!1;try{var i={};i[pl]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch(oY){}return n},vl=ve,_l=Ie,yl=sc,Il=function(e,t,n){var i,r;return yl&&vl(i=t.constructor)&&i!==n&&_l(r=i.prototype)&&r!==n.prototype&&yl(e,r),e},Ml=Er,Tl=w,Cl=te,Sl=vr,El=Ci,kl=Bc.exports,bl=cl,Dl=dl,wl=ve,Al=se,Rl=Ie,Ll=R,Ol=ml,Nl=Ws,Pl=Il,Ul=function(e,t,n){var i=-1!==e.indexOf("Map"),r=-1!==e.indexOf("Weak"),o=i?"set":"add",a=Tl[e],s=a&&a.prototype,c=a,u={},l=function(e){var t=Cl(s[e]);El(s,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(r&&!Rl(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return r&&!Rl(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(r&&!Rl(e))&&t(this,0===e?0:e)}:function(e,n){return t(this,0===e?0:e,n),this})};if(Sl(e,!wl(a)||!(r||s.forEach&&!Ll((function(){(new a).entries().next()})))))c=n.getConstructor(t,e,i,o),kl.enable();else if(Sl(e,!0)){var d=new c,p=d[o](r?{}:-0,1)!=d,h=Ll((function(){d.has(1)})),f=Ol((function(e){new a(e)})),g=!r&&Ll((function(){for(var e=new a,t=5;t--;)e[o](t,t);return!e.has(-0)}));f||((c=t((function(e,t){Dl(e,s);var n=Pl(new a,e,c);return Al(t)||bl(t,n[o],{that:n,AS_ENTRIES:i}),n}))).prototype=s,s.constructor=c),(h||g)&&(l("delete"),l("has"),i&&l("get")),(g||p)&&l(o),r&&s.clear&&delete s.clear}return u[e]=c,Ml({global:!0,constructor:!0,forced:c!=a},u),Nl(c,e),r||n.setStrong(c,e,i),c},xl=Ci,Gl=function(e,t,n){for(var i in t)xl(e,i,t[i],n);return e},Fl=Se,Vl=on,ql=L,Bl=Rt("species"),Hl=function(e){var t=Fl(e),n=Vl.f;ql&&t&&!t[Bl]&&n(t,Bl,{configurable:!0,get:function(){return this}})},jl=on.f,Kl=ms,zl=Gl,Wl=wr,Yl=dl,$l=se,Jl=cl,Xl=bc,Zl=Dc,Ql=Hl,ed=L,td=Bc.exports.fastKey,nd=ai.set,id=ai.getterFor,rd={getConstructor:function(e,t,n,i){var r=e((function(e,r){Yl(e,o),nd(e,{type:t,index:Kl(null),first:void 0,last:void 0,size:0}),ed||(e.size=0),$l(r)||Jl(r,e[i],{that:e,AS_ENTRIES:n})})),o=r.prototype,a=id(t),s=function(e,t,n){var i,r,o=a(e),s=c(e,t);return s?s.value=n:(o.last=s={index:r=td(t,!0),key:t,value:n,previous:i=o.last,next:void 0,removed:!1},o.first||(o.first=s),i&&(i.next=s),ed?o.size++:e.size++,"F"!==r&&(o.index[r]=s)),e},c=function(e,t){var n,i=a(e),r=td(t);if("F"!==r)return i.index[r];for(n=i.first;n;n=n.next)if(n.key==t)return n};return zl(o,{clear:function(){for(var e=a(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,ed?e.size=0:this.size=0},delete:function(e){var t=this,n=a(t),i=c(t,e);if(i){var r=i.next,o=i.previous;delete n.index[i.index],i.removed=!0,o&&(o.next=r),r&&(r.previous=o),n.first==i&&(n.first=r),n.last==i&&(n.last=o),ed?n.size--:t.size--}return!!i},forEach:function(e){for(var t,n=a(this),i=Wl(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:n.first;)for(i(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),zl(o,n?{get:function(e){var t=c(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),ed&&jl(o,"size",{get:function(){return a(this).size}}),r},setStrong:function(e,t,n){var i=t+" Iterator",r=id(t),o=id(i);Xl(e,t,(function(e,t){nd(this,{type:i,target:e,state:r(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?Zl("keys"==t?n.key:"values"==t?n.value:[n.key,n.value],!1):(e.target=void 0,Zl(void 0,!0))}),n?"entries":"values",!n,!0),Ql(t)}};Ul("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),rd);var od=Vr,ad=String,sd=function(e){if("Symbol"===od(e))throw TypeError("Cannot convert a Symbol value to a string");return ad(e)},cd=te,ud=Di,ld=sd,dd=le,pd=cd("".charAt),hd=cd("".charCodeAt),fd=cd("".slice),gd=function(e){return function(t,n){var i,r,o=ld(dd(t)),a=ud(n),s=o.length;return a<0||a>=s?e?"":void 0:(i=hd(o,a))<55296||i>56319||a+1===s||(r=hd(o,a+1))<56320||r>57343?e?pd(o,a):i:e?fd(o,a,a+2):r-56320+(i-55296<<10)+65536}},md={codeAt:gd(!1),charAt:gd(!0)},vd=md.charAt,_d=sd,yd=ai,Id=bc,Md=Dc,Td="String Iterator",Cd=yd.set,Sd=yd.getterFor(Td);Id(String,"String",(function(e){Cd(this,{type:Td,string:_d(e),index:0})}),(function(){var e,t=Sd(this),n=t.string,i=t.index;return i>=n.length?Md(void 0,!0):(e=vd(n,i),t.index+=e.length,Md(e,!1))}));var Ed={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},kd=zt("span").classList,bd=kd&&kd.constructor&&kd.constructor.prototype,Dd=bd===Object.prototype?void 0:bd,wd=w,Ad=Ed,Rd=Dd,Ld=Vc,Od=Sn,Nd=Rt,Pd=Nd("iterator"),Ud=Nd("toStringTag"),xd=Ld.values,Gd=function(e,t){if(e){if(e[Pd]!==xd)try{Od(e,Pd,xd)}catch(oY){e[Pd]=xd}if(e[Ud]||Od(e,Ud,t),Ad[t])for(var n in Ld)if(e[n]!==Ld[n])try{Od(e,n,Ld[n])}catch(oY){e[n]=Ld[n]}}};for(var Fd in Ad)Gd(wd[Fd]&&wd[Fd].prototype,Fd);Gd(Rd,"DOMTokenList");var Vd=O,qd=Function.prototype,Bd=qd.apply,Hd=qd.call,jd="object"==typeof Reflect&&Reflect.apply||(Vd?Hd.bind(Bd):function(){return Hd.apply(Bd,arguments)}),Kd=te([].slice),zd=TypeError,Wd=function(e,t){if(e<t)throw zd("Not enough arguments");return e},Yd=w,$d=jd,Jd=ve,Xd=Kd,Zd=Wd,Qd=/MSIE .\./.test(ke),ep=Yd.Function,tp=function(e){return Qd?function(t,n){var i=Zd(arguments.length,1)>2,r=Jd(t)?t:ep(t),o=i?Xd(arguments,2):void 0;return e(i?function(){$d(r,this,o)}:r,n)}:e},np={setTimeout:tp(Yd.setTimeout),setInterval:tp(Yd.setInterval)},ip=np.setInterval;Er({global:!0,bind:!0,forced:w.setInterval!==ip},{setInterval:ip});var rp=np.setTimeout;Er({global:!0,bind:!0,forced:w.setTimeout!==rp},{setTimeout:rp}),Ul("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),rd);var op=L,ap=Rr,sp=TypeError,cp=Object.getOwnPropertyDescriptor,up=op&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(oY){return oY instanceof TypeError}}(),lp=TypeError,dp=function(e){if(e>9007199254740991)throw lp("Maximum allowed index exceeded");return e},pp=je,hp=TypeError,fp=function(e,t){if(!delete e[t])throw hp("Cannot delete property "+pp(t)+" of "+pp(e))},gp=Er,mp=pt,vp=Li,_p=Di,yp=xi,Ip=up?function(e,t){if(ap(e)&&!cp(e,"length").writable)throw sp("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},Mp=dp,Tp=so,Cp=Wc,Sp=fp,Ep=Io("splice"),kp=Math.max,bp=Math.min;gp({target:"Array",proto:!0,forced:!Ep},{splice:function(e,t){var n,i,r,o,a,s,c=mp(this),u=yp(c),l=vp(e,u),d=arguments.length;for(0===d?n=i=0:1===d?(n=0,i=u-l):(n=d-2,i=bp(kp(_p(t),0),u-l)),Mp(u+n-i),r=Tp(c,i),o=0;o<i;o++)(a=l+o)in c&&Cp(r,o,c[a]);if(r.length=i,n<i){for(o=l;o<u-i;o++)s=o+n,(a=o+i)in c?c[s]=c[a]:Sp(c,s);for(o=u;o>u-i+n;o--)Sp(c,o-1)}else if(n>i)for(o=u-i;o>l;o--)s=o+n-1,(a=o+i-1)in c?c[s]=c[a]:Sp(c,s);for(o=0;o<n;o++)c[o+l]=arguments[o+2];return Ip(c,u-i+n),r}});var Dp=R,wp=function(e,t){var n=[][e];return!!n&&Dp((function(){n.call(null,t||function(){return 1},1)}))},Ap=mo.forEach,Rp=wp("forEach")?[].forEach:function(e){return Ap(this,e,arguments.length>1?arguments[1]:void 0)};Er({target:"Array",proto:!0,forced:[].forEach!=Rp},{forEach:Rp});var Lp=w,Op=Ed,Np=Dd,Pp=Rp,Up=Sn,xp=function(e){if(e&&e.forEach!==Pp)try{Up(e,"forEach",Pp)}catch(oY){e.forEach=Pp}};for(var Gp in Op)Op[Gp]&&xp(Lp[Gp]&&Lp[Gp].prototype);xp(Np);var Fp=Er,Vp=ae,qp=he,Bp=wp,Hp=te([].join),jp=Vp!=Object,Kp=Bp("join",",");Fp({target:"Array",proto:!0,forced:jp||!Kp},{join:function(e){return Hp(qp(this),void 0===e?",":e)}});var zp=Er,Wp=R,Yp=Rr,$p=Ie,Jp=pt,Xp=xi,Zp=dp,Qp=Wc,eh=so,th=Io,nh=Oe,ih=Rt("isConcatSpreadable"),rh=nh>=51||!Wp((function(){var e=[];return e[ih]=!1,e.concat()[0]!==e})),oh=th("concat"),ah=function(e){if(!$p(e))return!1;var t=e[ih];return void 0!==t?!!t:Yp(e)};zp({target:"Array",proto:!0,arity:1,forced:!rh||!oh},{concat:function(e){var t,n,i,r,o,a=Jp(this),s=eh(a,0),c=0;for(t=-1,i=arguments.length;t<i;t++)if(ah(o=-1===t?a:arguments[t]))for(r=Xp(o),Zp(c+r),n=0;n<r;n++,c++)n in o&&Qp(s,c,o[n]);else Zp(c+1),Qp(s,c++,o);return s.length=c,s}});var sh=te,ch=Ci,uh=Date.prototype,lh="Invalid Date",dh="toString",ph=sh(uh.toString),hh=sh(uh.getTime);String(new Date(NaN))!=lh&&ch(uh,dh,(function(){var e=hh(this);return e==e?ph(this):lh}));var fh=Di,gh=sd,mh=le,vh=RangeError,_h=function(e){var t=gh(mh(this)),n="",i=fh(e);if(i<0||1/0==i)throw vh("Wrong number of repetitions");for(;i>0;(i>>>=1)&&(t+=t))1&i&&(n+=t);return n},yh=te,Ih=Pi,Mh=sd,Th=le,Ch=yh(_h),Sh=yh("".slice),Eh=Math.ceil,kh=function(e){return function(t,n,i){var r,o,a=Mh(Th(t)),s=Ih(n),c=a.length,u=void 0===i?" ":Mh(i);return s<=c||""==u?a:((o=Ch(u,Eh((r=s-c)/u.length))).length>r&&(o=Sh(o,0,r)),e?a+o:o+a)}},bh={start:kh(!1),end:kh(!0)},Dh=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(ke),wh=bh.start;Er({target:"String",proto:!0,forced:Dh},{padStart:function(e){return wh(this,e,arguments.length>1?arguments[1]:void 0)}});var Ah=ln,Rh=function(){var e=Ah(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Lh=R,Oh=w.RegExp,Nh=Lh((function(){var e=Oh("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),Ph=Nh||Lh((function(){return!Oh("a","y").sticky})),Uh={BROKEN_CARET:Nh||Lh((function(){var e=Oh("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),MISSED_STICKY:Ph,UNSUPPORTED_Y:Nh},xh=R,Gh=w.RegExp,Fh=xh((function(){var e=Gh(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),Vh=R,qh=w.RegExp,Bh=Vh((function(){var e=qh("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),Hh=U,jh=te,Kh=sd,zh=Rh,Wh=Uh,Yh=nt.exports,$h=ms,Jh=ai.get,Xh=Fh,Zh=Bh,Qh=Yh("native-string-replace",String.prototype.replace),ef=RegExp.prototype.exec,tf=ef,nf=jh("".charAt),rf=jh("".indexOf),of=jh("".replace),af=jh("".slice),sf=function(){var e=/a/,t=/b*/g;return Hh(ef,e,"a"),Hh(ef,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),cf=Wh.BROKEN_CARET,uf=void 0!==/()??/.exec("")[1];(sf||uf||cf||Xh||Zh)&&(tf=function(e){var t,n,i,r,o,a,s,c=this,u=Jh(c),l=Kh(e),d=u.raw;if(d)return d.lastIndex=c.lastIndex,t=Hh(tf,d,l),c.lastIndex=d.lastIndex,t;var p=u.groups,h=cf&&c.sticky,f=Hh(zh,c),g=c.source,m=0,v=l;if(h&&(f=of(f,"y",""),-1===rf(f,"g")&&(f+="g"),v=af(l,c.lastIndex),c.lastIndex>0&&(!c.multiline||c.multiline&&"\n"!==nf(l,c.lastIndex-1))&&(g="(?: "+g+")",v=" "+v,m++),n=new RegExp("^(?:"+g+")",f)),uf&&(n=new RegExp("^"+g+"$(?!\\s)",f)),sf&&(i=c.lastIndex),r=Hh(ef,h?n:c,v),h?r?(r.input=af(r.input,m),r[0]=af(r[0],m),r.index=c.lastIndex,c.lastIndex+=r[0].length):c.lastIndex=0:sf&&r&&(c.lastIndex=c.global?r.index+r[0].length:i),uf&&r&&r.length>1&&Hh(Qh,r[0],n,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(r[o]=void 0)})),r&&p)for(r.groups=a=$h(null),o=0;o<p.length;o++)a[(s=p[o])[0]]=r[s[1]];return r});var lf=tf;Er({target:"RegExp",proto:!0,forced:/./.exec!==lf},{exec:lf});var df=te,pf=Ci,hf=lf,ff=R,gf=Rt,mf=Sn,vf=gf("species"),_f=RegExp.prototype,yf=function(e,t,n,i){var r=gf(e),o=!ff((function(){var t={};return t[r]=function(){return 7},7!=""[e](t)})),a=o&&!ff((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[vf]=function(){return n},n.flags="",n[r]=/./[r]),n.exec=function(){return t=!0,null},n[r](""),!t}));if(!o||!a||n){var s=df(/./[r]),c=t(r,""[e],(function(e,t,n,i,r){var a=df(e),c=t.exec;return c===hf||c===_f.exec?o&&!r?{done:!0,value:s(t,n,i)}:{done:!0,value:a(n,t,i)}:{done:!1}}));pf(String.prototype,e,c[0]),pf(_f,r,c[1])}i&&mf(_f[r],"sham",!0)},If=md.charAt,Mf=function(e,t,n){return t+(n?If(e,t).length:1)},Tf=te,Cf=pt,Sf=Math.floor,Ef=Tf("".charAt),kf=Tf("".replace),bf=Tf("".slice),Df=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,wf=/\$([$&'`]|\d{1,2})/g,Af=U,Rf=ln,Lf=ve,Of=Z,Nf=lf,Pf=TypeError,Uf=function(e,t){var n=e.exec;if(Lf(n)){var i=Af(n,e,t);return null!==i&&Rf(i),i}if("RegExp"===Of(e))return Af(Nf,e,t);throw Pf("RegExp#exec called on incompatible receiver")},xf=jd,Gf=U,Ff=te,Vf=yf,qf=R,Bf=ln,Hf=ve,jf=se,Kf=Di,zf=Pi,Wf=sd,Yf=le,$f=Mf,Jf=Xe,Xf=function(e,t,n,i,r,o){var a=n+e.length,s=i.length,c=wf;return void 0!==r&&(r=Cf(r),c=Df),kf(o,c,(function(o,c){var u;switch(Ef(c,0)){case"$":return"$";case"&":return e;case"`":return bf(t,0,n);case"'":return bf(t,a);case"<":u=r[bf(c,1,-1)];break;default:var l=+c;if(0===l)return o;if(l>s){var d=Sf(l/10);return 0===d?o:d<=s?void 0===i[d-1]?Ef(c,1):i[d-1]+Ef(c,1):o}u=i[l-1]}return void 0===u?"":u}))},Zf=Uf,Qf=Rt("replace"),eg=Math.max,tg=Math.min,ng=Ff([].concat),ig=Ff([].push),rg=Ff("".indexOf),og=Ff("".slice),ag="$0"==="a".replace(/./,"$0"),sg=!!/./[Qf]&&""===/./[Qf]("a","$0"),cg=!qf((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}));Vf("replace",(function(e,t,n){var i=sg?"$":"$0";return[function(e,n){var i=Yf(this),r=jf(e)?void 0:Jf(e,Qf);return r?Gf(r,e,i,n):Gf(t,Wf(i),e,n)},function(e,r){var o=Bf(this),a=Wf(e);if("string"==typeof r&&-1===rg(r,i)&&-1===rg(r,"$<")){var s=n(t,o,a,r);if(s.done)return s.value}var c=Hf(r);c||(r=Wf(r));var u=o.global;if(u){var l=o.unicode;o.lastIndex=0}for(var d=[];;){var p=Zf(o,a);if(null===p)break;if(ig(d,p),!u)break;""===Wf(p[0])&&(o.lastIndex=$f(a,zf(o.lastIndex),l))}for(var h,f="",g=0,m=0;m<d.length;m++){for(var v=Wf((p=d[m])[0]),_=eg(tg(Kf(p.index),a.length),0),y=[],I=1;I<p.length;I++)ig(y,void 0===(h=p[I])?h:String(h));var M=p.groups;if(c){var T=ng([v],y,_,a);void 0!==M&&ig(T,M);var C=Wf(xf(r,void 0,T))}else C=Xf(v,a,_,y,M,r);_>=g&&(f+=og(a,g,_)+C,g=_+v.length)}return f+og(a,g)}]}),!cg||!ag||sg);var ug=U,lg=gt,dg=Ee,pg=Rh,hg=RegExp.prototype,fg=function(e){var t=e.flags;return void 0!==t||"flags"in hg||lg(e,"flags")||!dg(hg,e)?t:ug(pg,e)},gg=Rn.PROPER,mg=Ci,vg=ln,_g=sd,yg=R,Ig=fg,Mg="toString",Tg=RegExp.prototype.toString,Cg=yg((function(){return"/a/b"!=Tg.call({source:"a",flags:"b"})})),Sg=gg&&Tg.name!=Mg;(Cg||Sg)&&mg(RegExp.prototype,Mg,(function(){var e=vg(this);return"/"+_g(e.source)+"/"+_g(Ig(e))}),{unsafe:!0});var Eg=R,kg=Rt("iterator"),bg=!Eg((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,i){t.delete("b"),n+=i+e})),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[kg]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),Dg=Qc,wg=Math.floor,Ag=function(e,t){var n=e.length,i=wg(n/2);return n<8?Rg(e,t):Lg(e,Ag(Dg(e,0,i),t),Ag(Dg(e,i),t),t)},Rg=function(e,t){for(var n,i,r=e.length,o=1;o<r;){for(i=o,n=e[o];i&&t(e[i-1],n)>0;)e[i]=e[--i];i!==o++&&(e[i]=n)}return e},Lg=function(e,t,n,i){for(var r=t.length,o=n.length,a=0,s=0;a<r||s<o;)e[a+s]=a<r&&s<o?i(t[a],n[s])<=0?t[a++]:n[s++]:a<r?t[a++]:n[s++];return e},Og=Ag,Ng=Er,Pg=w,Ug=U,xg=te,Gg=L,Fg=bg,Vg=Ci,qg=Gl,Bg=Ws,Hg=ec,jg=ai,Kg=dl,zg=ve,Wg=gt,Yg=wr,$g=Vr,Jg=ln,Xg=Ie,Zg=sd,Qg=ms,em=H,tm=ju,nm=xu,im=Wd,rm=Og,om=Rt("iterator"),am="URLSearchParams",sm="URLSearchParamsIterator",cm=jg.set,um=jg.getterFor(am),lm=jg.getterFor(sm),dm=Object.getOwnPropertyDescriptor,pm=function(e){if(!Gg)return Pg[e];var t=dm(Pg,e);return t&&t.value},hm=pm("fetch"),fm=pm("Request"),gm=pm("Headers"),mm=fm&&fm.prototype,vm=gm&&gm.prototype,_m=Pg.RegExp,ym=Pg.TypeError,Im=Pg.decodeURIComponent,Mm=Pg.encodeURIComponent,Tm=xg("".charAt),Cm=xg([].join),Sm=xg([].push),Em=xg("".replace),km=xg([].shift),bm=xg([].splice),Dm=xg("".split),wm=xg("".slice),Am=/\+/g,Rm=Array(4),Lm=function(e){return Rm[e-1]||(Rm[e-1]=_m("((?:%[\\da-f]{2}){"+e+"})","gi"))},Om=function(e){try{return Im(e)}catch(oY){return e}},Nm=function(e){var t=Em(e,Am," "),n=4;try{return Im(t)}catch(oY){for(;n;)t=Em(t,Lm(n--),Om);return t}},Pm=/[!'()~]|%20/g,Um={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},xm=function(e){return Um[e]},Gm=function(e){return Em(Mm(e),Pm,xm)},Fm=Hg((function(e,t){cm(this,{type:sm,iterator:tm(um(e).entries),kind:t})}),"Iterator",(function(){var e=lm(this),t=e.kind,n=e.iterator.next(),i=n.value;return n.done||(n.value="keys"===t?i.key:"values"===t?i.value:[i.key,i.value]),n}),!0),Vm=function(e){this.entries=[],this.url=null,void 0!==e&&(Xg(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===Tm(e,0)?wm(e,1):e:Zg(e)))};Vm.prototype={type:am,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,i,r,o,a,s,c=nm(e);if(c)for(n=(t=tm(e,c)).next;!(i=Ug(n,t)).done;){if(o=(r=tm(Jg(i.value))).next,(a=Ug(o,r)).done||(s=Ug(o,r)).done||!Ug(o,r).done)throw ym("Expected sequence with length 2");Sm(this.entries,{key:Zg(a.value),value:Zg(s.value)})}else for(var u in e)Wg(e,u)&&Sm(this.entries,{key:u,value:Zg(e[u])})},parseQuery:function(e){if(e)for(var t,n,i=Dm(e,"&"),r=0;r<i.length;)(t=i[r++]).length&&(n=Dm(t,"="),Sm(this.entries,{key:Nm(km(n)),value:Nm(Cm(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],i=0;i<t.length;)e=t[i++],Sm(n,Gm(e.key)+"="+Gm(e.value));return Cm(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var qm=function(){Kg(this,Bm),cm(this,new Vm(arguments.length>0?arguments[0]:void 0))},Bm=qm.prototype;if(qg(Bm,{append:function(e,t){im(arguments.length,2);var n=um(this);Sm(n.entries,{key:Zg(e),value:Zg(t)}),n.updateURL()},delete:function(e){im(arguments.length,1);for(var t=um(this),n=t.entries,i=Zg(e),r=0;r<n.length;)n[r].key===i?bm(n,r,1):r++;t.updateURL()},get:function(e){im(arguments.length,1);for(var t=um(this).entries,n=Zg(e),i=0;i<t.length;i++)if(t[i].key===n)return t[i].value;return null},getAll:function(e){im(arguments.length,1);for(var t=um(this).entries,n=Zg(e),i=[],r=0;r<t.length;r++)t[r].key===n&&Sm(i,t[r].value);return i},has:function(e){im(arguments.length,1);for(var t=um(this).entries,n=Zg(e),i=0;i<t.length;)if(t[i++].key===n)return!0;return!1},set:function(e,t){im(arguments.length,1);for(var n,i=um(this),r=i.entries,o=!1,a=Zg(e),s=Zg(t),c=0;c<r.length;c++)(n=r[c]).key===a&&(o?bm(r,c--,1):(o=!0,n.value=s));o||Sm(r,{key:a,value:s}),i.updateURL()},sort:function(){var e=um(this);rm(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=um(this).entries,i=Yg(e,arguments.length>1?arguments[1]:void 0),r=0;r<n.length;)i((t=n[r++]).value,t.key,this)},keys:function(){return new Fm(this,"keys")},values:function(){return new Fm(this,"values")},entries:function(){return new Fm(this,"entries")}},{enumerable:!0}),Vg(Bm,om,Bm.entries,{name:"entries"}),Vg(Bm,"toString",(function(){return um(this).serialize()}),{enumerable:!0}),Bg(qm,am),Ng({global:!0,constructor:!0,forced:!Fg},{URLSearchParams:qm}),!Fg&&zg(gm)){var Hm=xg(vm.has),jm=xg(vm.set),Km=function(e){if(Xg(e)){var t,n=e.body;if($g(n)===am)return t=e.headers?new gm(e.headers):new gm,Hm(t,"content-type")||jm(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Qg(e,{body:em(0,Zg(n)),headers:em(0,t)})}return e};if(zg(hm)&&Ng({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return hm(e,arguments.length>1?Km(arguments[1]):{})}}),zg(fm)){var zm=function(e){return Kg(this,mm),new fm(e,arguments.length>1?Km(arguments[1]):{})};mm.constructor=zm,zm.prototype=mm,Ng({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:zm})}}var Wm={URLSearchParams:qm,getState:um},Ym=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t},$m=U,Jm=ln,Xm=se,Zm=le,Qm=Ym,ev=sd,tv=Xe,nv=Uf;yf("search",(function(e,t,n){return[function(t){var n=Zm(this),i=Xm(t)?void 0:tv(t,e);return i?$m(i,t,n):new RegExp(t)[e](ev(n))},function(e){var i=Jm(this),r=ev(e),o=n(t,i,r);if(o.done)return o.value;var a=i.lastIndex;Qm(a,0)||(i.lastIndex=0);var s=nv(i,r);return Qm(i.lastIndex,a)||(i.lastIndex=a),null===s?-1:s.index}]})),(new Date).getTime();var iv=0,rv=function(){return(new Date).getTime()+iv},ov=function(){var e=new Date;return e.setTime(rv()),e.toLocaleString()},av=U,sv=ln,cv=se,uv=Pi,lv=sd,dv=le,pv=Xe,hv=Mf,fv=Uf;yf("match",(function(e,t,n){return[function(t){var n=dv(this),i=cv(t)?void 0:pv(t,e);return i?av(i,t,n):new RegExp(t)[e](lv(n))},function(e){var i=sv(this),r=lv(e),o=n(t,i,r);if(o.done)return o.value;if(!i.global)return fv(i,r);var a=i.unicode;i.lastIndex=0;for(var s,c=[],u=0;null!==(s=fv(i,r));){var l=lv(s[0]);c[u]=l,""===l&&(i.lastIndex=hv(r,uv(i.lastIndex),a)),u++}return 0===u?null:c}]}));var gv=Ie,mv=Z,vv=Rt("match"),_v=function(e){var t;return gv(e)&&(void 0!==(t=e[vv])?!!t:"RegExp"==mv(e))},yv=on.f,Iv=L,Mv=w,Tv=te,Cv=vr,Sv=Il,Ev=Sn,kv=Si.f,bv=Ee,Dv=_v,wv=sd,Av=fg,Rv=Uh,Lv=function(e,t,n){n in e||yv(e,n,{configurable:!0,get:function(){return t[n]},set:function(e){t[n]=e}})},Ov=Ci,Nv=R,Pv=gt,Uv=ai.enforce,xv=Hl,Gv=Fh,Fv=Bh,Vv=Rt("match"),qv=Mv.RegExp,Bv=qv.prototype,Hv=Mv.SyntaxError,jv=Tv(Bv.exec),Kv=Tv("".charAt),zv=Tv("".replace),Wv=Tv("".indexOf),Yv=Tv("".slice),$v=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,Jv=/a/g,Xv=/a/g,Zv=new qv(Jv)!==Jv,Qv=Rv.MISSED_STICKY,e_=Rv.UNSUPPORTED_Y,t_=Iv&&(!Zv||Qv||Gv||Fv||Nv((function(){return Xv[Vv]=!1,qv(Jv)!=Jv||qv(Xv)==Xv||"/a/i"!=qv(Jv,"i")})));if(Cv("RegExp",t_)){for(var n_=function(e,t){var n,i,r,o,a,s,c=bv(Bv,this),u=Dv(e),l=void 0===t,d=[],p=e;if(!c&&u&&l&&e.constructor===n_)return e;if((u||bv(Bv,e))&&(e=e.source,l&&(t=Av(p))),e=void 0===e?"":wv(e),t=void 0===t?"":wv(t),p=e,Gv&&"dotAll"in Jv&&(i=!!t&&Wv(t,"s")>-1)&&(t=zv(t,/s/g,"")),n=t,Qv&&"sticky"in Jv&&(r=!!t&&Wv(t,"y")>-1)&&e_&&(t=zv(t,/y/g,"")),Fv&&(e=(o=function(e){for(var t,n=e.length,i=0,r="",o=[],a={},s=!1,c=!1,u=0,l="";i<=n;i++){if("\\"===(t=Kv(e,i)))t+=Kv(e,++i);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:jv($v,Yv(e,i+1))&&(i+=2,c=!0),r+=t,u++;continue;case">"===t&&c:if(""===l||Pv(a,l))throw new Hv("Invalid capture group name");a[l]=!0,o[o.length]=[l,u],c=!1,l="";continue}c?l+=t:r+=t}return[r,o]}(e))[0],d=o[1]),a=Sv(qv(e,t),c?this:Bv,n_),(i||r||d.length)&&(s=Uv(a),i&&(s.dotAll=!0,s.raw=n_(function(e){for(var t,n=e.length,i=0,r="",o=!1;i<=n;i++)"\\"!==(t=Kv(e,i))?o||"."!==t?("["===t?o=!0:"]"===t&&(o=!1),r+=t):r+="[\\s\\S]":r+=t+Kv(e,++i);return r}(e),n)),r&&(s.sticky=!0),d.length&&(s.groups=d)),e!==p)try{Ev(a,"source",""===p?"(?:)":p)}catch(oY){}return a},i_=kv(qv),r_=0;i_.length>r_;)Lv(n_,qv,i_[r_++]);Bv.constructor=n_,n_.prototype=Bv,Ov(Mv,"RegExp",n_,{constructor:!0})}xv("RegExp");var o_=te(1..valueOf),a_="\t\n\v\f\r                　\u2028\u2029\ufeff",s_=le,c_=sd,u_=te("".replace),l_="[\t\n\v\f\r                　\u2028\u2029\ufeff]",d_=RegExp("^"+l_+l_+"*"),p_=RegExp(l_+l_+"*$"),h_=function(e){return function(t){var n=c_(s_(t));return 1&e&&(n=u_(n,d_,"")),2&e&&(n=u_(n,p_,"")),n}},f_={start:h_(1),end:h_(2),trim:h_(3)},g_=L,m_=w,v_=te,__=vr,y_=Ci,I_=gt,M_=Il,T_=Ee,C_=Be,S_=Ft,E_=R,k_=Si.f,b_=A.f,D_=on.f,w_=o_,A_=f_.trim,R_="Number",L_=m_.Number,O_=L_.prototype,N_=m_.TypeError,P_=v_("".slice),U_=v_("".charCodeAt),x_=function(e){var t=S_(e,"number");return"bigint"==typeof t?t:G_(t)},G_=function(e){var t,n,i,r,o,a,s,c,u=S_(e,"number");if(C_(u))throw N_("Cannot convert a Symbol value to a number");if("string"==typeof u&&u.length>2)if(u=A_(u),43===(t=U_(u,0))||45===t){if(88===(n=U_(u,2))||120===n)return NaN}else if(48===t){switch(U_(u,1)){case 66:case 98:i=2,r=49;break;case 79:case 111:i=8,r=55;break;default:return+u}for(a=(o=P_(u,2)).length,s=0;s<a;s++)if((c=U_(o,s))<48||c>r)return NaN;return parseInt(o,i)}return+u};if(__(R_,!L_(" 0o1")||!L_("0b1")||L_("+0x1"))){for(var F_,V_=function(e){var t=arguments.length<1?0:L_(x_(e)),n=this;return T_(O_,n)&&E_((function(){w_(n)}))?M_(Object(t),n,V_):t},q_=g_?k_(L_):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),B_=0;q_.length>B_;B_++)I_(L_,F_=q_[B_])&&!I_(V_,F_)&&D_(V_,F_,b_(L_,F_));V_.prototype=O_,O_.constructor=V_,y_(m_,R_,V_,{constructor:!0})}var H_=Bi.includes,j_=Es;Er({target:"Array",proto:!0,forced:R((function(){return!Array(1).includes()}))},{includes:function(e){return H_(this,e,arguments.length>1?arguments[1]:void 0)}}),j_("includes");var K_=_v,z_=TypeError,W_=function(e){if(K_(e))throw z_("The method doesn't accept regular expressions");return e},Y_=Rt("match"),$_=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[Y_]=!1,"/./"[e](t)}catch(i){}}return!1},J_=Er,X_=W_,Z_=le,Q_=sd,ey=$_,ty=te("".indexOf);J_({target:"String",proto:!0,forced:!ey("includes")},{includes:function(e){return!!~ty(Q_(Z_(this)),Q_(X_(e)),arguments.length>1?arguments[1]:void 0)}});var ny=Er,iy=Bi.indexOf,ry=wp,oy=te([].indexOf),ay=!!oy&&1/oy([1],1,-0)<0,sy=ry("indexOf");ny({target:"Array",proto:!0,forced:ay||!sy},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return ay?oy(this,e,t)||0:iy(this,e,t)}});var cy=pt,uy=Ps,ly=bs;Er({target:"Object",stat:!0,forced:R((function(){uy(1)})),sham:!ly},{getPrototypeOf:function(e){return uy(cy(e))}});var dy=jd,py=Ye,hy=ln;Er({target:"Reflect",stat:!0,forced:!R((function(){Reflect.apply((function(){}))}))},{apply:function(e,t,n){return dy(py(e),t,hy(n))}});var fy=L,gy=Rn.EXISTS,my=te,vy=on.f,_y=Function.prototype,yy=my(_y.toString),Iy=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,My=my(Iy.exec);fy&&!gy&&vy(_y,"name",{configurable:!0,get:function(){try{return My(Iy,yy(this))[1]}catch(oY){return""}}});var Ty=Er,Cy=Date,Sy=te(Cy.prototype.getTime);Ty({target:"Date",stat:!0},{now:function(){return Sy(new Cy)}});var Ey,ky,by,Dy,wy="process"==Z(w.process),Ay=eo,Ry=je,Ly=TypeError,Oy=function(e){if(Ay(e))return e;throw Ly(Ry(e)+" is not a constructor")},Ny=ln,Py=Oy,Uy=se,xy=Rt("species"),Gy=function(e,t){var n,i=Ny(e).constructor;return void 0===i||Uy(n=Ny(i)[xy])?t:Py(n)},Fy=/(?:ipad|iphone|ipod).*applewebkit/i.test(ke),Vy=w,qy=jd,By=wr,Hy=ve,jy=gt,Ky=R,zy=rs,Wy=Kd,Yy=zt,$y=Wd,Jy=Fy,Xy=wy,Zy=Vy.setImmediate,Qy=Vy.clearImmediate,eI=Vy.process,tI=Vy.Dispatch,nI=Vy.Function,iI=Vy.MessageChannel,rI=Vy.String,oI=0,aI={},sI="onreadystatechange";try{Ey=Vy.location}catch(oY){}var cI=function(e){if(jy(aI,e)){var t=aI[e];delete aI[e],t()}},uI=function(e){return function(){cI(e)}},lI=function(e){cI(e.data)},dI=function(e){Vy.postMessage(rI(e),Ey.protocol+"//"+Ey.host)};Zy&&Qy||(Zy=function(e){$y(arguments.length,1);var t=Hy(e)?e:nI(e),n=Wy(arguments,1);return aI[++oI]=function(){qy(t,void 0,n)},ky(oI),oI},Qy=function(e){delete aI[e]},Xy?ky=function(e){eI.nextTick(uI(e))}:tI&&tI.now?ky=function(e){tI.now(uI(e))}:iI&&!Jy?(Dy=(by=new iI).port2,by.port1.onmessage=lI,ky=By(Dy.postMessage,Dy)):Vy.addEventListener&&Hy(Vy.postMessage)&&!Vy.importScripts&&Ey&&"file:"!==Ey.protocol&&!Ky(dI)?(ky=dI,Vy.addEventListener("message",lI,!1)):ky=sI in Yy("script")?function(e){zy.appendChild(Yy("script")).onreadystatechange=function(){zy.removeChild(this),cI(e)}}:function(e){setTimeout(uI(e),0)});var pI,hI,fI,gI,mI,vI,_I,yI,II={set:Zy,clear:Qy},MI=w,TI=/ipad|iphone|ipod/i.test(ke)&&void 0!==MI.Pebble,CI=/web0s(?!.*chrome)/i.test(ke),SI=w,EI=wr,kI=A.f,bI=II.set,DI=Fy,wI=TI,AI=CI,RI=wy,LI=SI.MutationObserver||SI.WebKitMutationObserver,OI=SI.document,NI=SI.process,PI=SI.Promise,UI=kI(SI,"queueMicrotask"),xI=UI&&UI.value;xI||(pI=function(){var e,t;for(RI&&(e=NI.domain)&&e.exit();hI;){t=hI.fn,hI=hI.next;try{t()}catch(oY){throw hI?gI():fI=void 0,oY}}fI=void 0,e&&e.enter()},DI||RI||AI||!LI||!OI?!wI&&PI&&PI.resolve?((_I=PI.resolve(void 0)).constructor=PI,yI=EI(_I.then,_I),gI=function(){yI(pI)}):RI?gI=function(){NI.nextTick(pI)}:(bI=EI(bI,SI),gI=function(){bI(pI)}):(mI=!0,vI=OI.createTextNode(""),new LI(pI).observe(vI,{characterData:!0}),gI=function(){vI.data=mI=!mI}));var GI=xI||function(e){var t={fn:e,next:void 0};fI&&(fI.next=t),hI||(hI=t,gI()),fI=t},FI=w,VI=function(e){try{return{error:!1,value:e()}}catch(oY){return{error:!0,value:oY}}},qI=function(){this.head=null,this.tail=null};qI.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var BI=qI,HI=w.Promise,jI="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,KI=!jI&&!wy&&"object"==typeof window&&"object"==typeof document,zI=w,WI=HI,YI=ve,$I=vr,JI=Gn,XI=Rt,ZI=KI,QI=jI,eM=Oe;WI&&WI.prototype;var tM=XI("species"),nM=!1,iM=YI(zI.PromiseRejectionEvent),rM={CONSTRUCTOR:$I("Promise",(function(){var e=JI(WI),t=e!==String(WI);if(!t&&66===eM)return!0;if(!eM||eM<51||!/native code/.test(e)){var n=new WI((function(e){e(1)})),i=function(e){e((function(){}),(function(){}))};if((n.constructor={})[tM]=i,!(nM=n.then((function(){}))instanceof i))return!0}return!t&&(ZI||QI)&&!iM})),REJECTION_EVENT:iM,SUBCLASSING:nM},oM={},aM=Ye,sM=TypeError,cM=function(e){var t,n;this.promise=new e((function(e,i){if(void 0!==t||void 0!==n)throw sM("Bad Promise constructor");t=e,n=i})),this.resolve=aM(t),this.reject=aM(n)};oM.f=function(e){return new cM(e)};var uM,lM,dM,pM=Er,hM=wy,fM=w,gM=U,mM=Ci,vM=sc,_M=Ws,yM=Hl,IM=Ye,MM=ve,TM=Ie,CM=dl,SM=Gy,EM=II.set,kM=GI,bM=function(e,t){var n=FI.console;n&&n.error&&(1==arguments.length?n.error(e):n.error(e,t))},DM=VI,wM=BI,AM=ai,RM=HI,LM=oM,OM="Promise",NM=rM.CONSTRUCTOR,PM=rM.REJECTION_EVENT,UM=rM.SUBCLASSING,xM=AM.getterFor(OM),GM=AM.set,FM=RM&&RM.prototype,VM=RM,qM=FM,BM=fM.TypeError,HM=fM.document,jM=fM.process,KM=LM.f,zM=KM,WM=!!(HM&&HM.createEvent&&fM.dispatchEvent),YM="unhandledrejection",$M=function(e){var t;return!(!TM(e)||!MM(t=e.then))&&t},JM=function(e,t){var n,i,r,o=t.value,a=1==t.state,s=a?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{s?(a||(2===t.rejection&&tT(t),t.rejection=1),!0===s?n=o:(l&&l.enter(),n=s(o),l&&(l.exit(),r=!0)),n===e.promise?u(BM("Promise-chain cycle")):(i=$M(n))?gM(i,n,c,u):c(n)):u(o)}catch(oY){l&&!r&&l.exit(),u(oY)}},XM=function(e,t){e.notified||(e.notified=!0,kM((function(){for(var n,i=e.reactions;n=i.get();)JM(n,e);e.notified=!1,t&&!e.rejection&&QM(e)})))},ZM=function(e,t,n){var i,r;WM?((i=HM.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),fM.dispatchEvent(i)):i={promise:t,reason:n},!PM&&(r=fM["on"+e])?r(i):e===YM&&bM("Unhandled promise rejection",n)},QM=function(e){gM(EM,fM,(function(){var t,n=e.facade,i=e.value;if(eT(e)&&(t=DM((function(){hM?jM.emit("unhandledRejection",i,n):ZM(YM,n,i)})),e.rejection=hM||eT(e)?2:1,t.error))throw t.value}))},eT=function(e){return 1!==e.rejection&&!e.parent},tT=function(e){gM(EM,fM,(function(){var t=e.facade;hM?jM.emit("rejectionHandled",t):ZM("rejectionhandled",t,e.value)}))},nT=function(e,t,n){return function(i){e(t,i,n)}},iT=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,XM(e,!0))},rT=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw BM("Promise can't be resolved itself");var i=$M(t);i?kM((function(){var n={done:!1};try{gM(i,t,nT(rT,n,e),nT(iT,n,e))}catch(oY){iT(n,oY,e)}})):(e.value=t,e.state=1,XM(e,!1))}catch(oY){iT({done:!1},oY,e)}}};if(NM&&(qM=(VM=function(e){CM(this,qM),IM(e),gM(uM,this);var t=xM(this);try{e(nT(rT,t),nT(iT,t))}catch(oY){iT(t,oY)}}).prototype,(uM=function(e){GM(this,{type:OM,done:!1,notified:!1,parent:!1,reactions:new wM,rejection:!1,state:0,value:void 0})}).prototype=mM(qM,"then",(function(e,t){var n=xM(this),i=KM(SM(this,VM));return n.parent=!0,i.ok=!MM(e)||e,i.fail=MM(t)&&t,i.domain=hM?jM.domain:void 0,0==n.state?n.reactions.add(i):kM((function(){JM(i,n)})),i.promise})),lM=function(){var e=new uM,t=xM(e);this.promise=e,this.resolve=nT(rT,t),this.reject=nT(iT,t)},LM.f=KM=function(e){return e===VM||void 0===e?new lM(e):zM(e)},MM(RM)&&FM!==Object.prototype)){dM=FM.then,UM||mM(FM,"then",(function(e,t){var n=this;return new VM((function(e,t){gM(dM,n,e,t)})).then(e,t)}),{unsafe:!0});try{delete FM.constructor}catch(oY){}vM&&vM(FM,qM)}pM({global:!0,constructor:!0,wrap:!0,forced:NM},{Promise:VM}),_M(VM,OM,!1),yM(OM);var oT=HI,aT=rM.CONSTRUCTOR||!ml((function(e){oT.all(e).then(void 0,(function(){}))})),sT=U,cT=Ye,uT=oM,lT=VI,dT=cl;Er({target:"Promise",stat:!0,forced:aT},{all:function(e){var t=this,n=uT.f(t),i=n.resolve,r=n.reject,o=lT((function(){var n=cT(t.resolve),o=[],a=0,s=1;dT(e,(function(e){var c=a++,u=!1;s++,sT(n,t,e).then((function(e){u||(u=!0,o[c]=e,--s||i(o))}),r)})),--s||i(o)}));return o.error&&r(o.value),n.promise}});var pT=Er,hT=rM.CONSTRUCTOR,fT=HI,gT=Se,mT=ve,vT=Ci,_T=fT&&fT.prototype;if(pT({target:"Promise",proto:!0,forced:hT,real:!0},{catch:function(e){return this.then(void 0,e)}}),mT(fT)){var yT=gT("Promise").prototype.catch;_T.catch!==yT&&vT(_T,"catch",yT,{unsafe:!0})}var IT=U,MT=Ye,TT=oM,CT=VI,ST=cl;Er({target:"Promise",stat:!0,forced:aT},{race:function(e){var t=this,n=TT.f(t),i=n.reject,r=CT((function(){var r=MT(t.resolve);ST(e,(function(e){IT(r,t,e).then(n.resolve,i)}))}));return r.error&&i(r.value),n.promise}});var ET=U,kT=oM;Er({target:"Promise",stat:!0,forced:rM.CONSTRUCTOR},{reject:function(e){var t=kT.f(this);return ET(t.reject,void 0,e),t.promise}});var bT=ln,DT=Ie,wT=oM,AT=function(e,t){if(bT(e),DT(t)&&t.constructor===e)return t;var n=wT.f(e);return(0,n.resolve)(t),n.promise},RT=Er,LT=rM.CONSTRUCTOR,OT=AT;Se("Promise"),RT({target:"Promise",stat:!0,forced:LT},{resolve:function(e){return OT(this,e)}});var NT=pt,PT=Ja;Er({target:"Object",stat:!0,forced:R((function(){PT(1)}))},{keys:function(e){return PT(NT(e))}});var UT="canvas",xT="audio",GT="video",FT="screen",VT="small",qT="big",BT="auxiliary",HT="aux",jT="smallVideo",KT="user",zT="environment",WT="mute",YT="unmute",$T="ended",JT="playing",XT="pause",ZT="error",QT="loadeddata",eC="audioinput",tC="videoinput",nC="detail",iC="text",rC="main",oC="backup",aC="banned",sC="kick",cC="user_time_out",uC="room_disband",lC="sei-message",dC="PLAYING",pC="PAUSED",hC="STOPPED",fC="inactive",gC="sendonly",mC="recvonly",vC="add",_C="remove",yC="replace",IC="track",MC="wss://trtc.rtc.qq.com",TC="wss://webrtc.qq.com",CC="qcloud",SC="trtc",EC="webrtc",kC="",bC="jssdk_log",DC="jssdk_event",wC="jssdk_new_endreport",AC=function(e){return kC=e},RC=1,LC=2,OC="live",NC=20,PC=21,UC="anchor",xC="audience",GC="5Y2wZK8nANNAoVw6dSAHVjNxrD1ObBM2kBPV",FC="224d130c-7b5c-415b-aaa2-79c2eb5a6df2",VC=2,qC=rC,BC=BT,HC="unknown",jC="DISCONNECTED",KC="CONNECTING",zC="RECONNECTING",WC="CONNECTED",YC="new",$C="connecting",JC="failed",XC="closed",ZC="disconnected",QC="connected",eS="completed",tS=30,nS="join",iS="delta-join",rS="rejoin",oS="leave",aS="delta-leave",sS="publish",cS="delta-publish",uS="unpublish",lS="subscribe",dS="unsubscribe",pS="uplink-connection",hS="uplink-reconnection",fS="downlink-connection",gS="downlink-reconnection",mS="setLocalDescription",vS="setRemoteDescription",_S="iceConnectionState",yS="stream-initialize",IS="websocketConnectionState",MS="websocketReconnectionState",TS="update-stream",CS="recover-subscription",SS="start-mix-transcode",ES="stop-mix-transcode",kS="player-error",bS="schedule",DS="unsubscribe",wS="subscribe_change",AS="unified-plan",RS="plan-b",LS={MANUAL:"manual",PRESET_LAYOUT:"preset-layout"},OS={REMOTE:"$PLACE_HOLDER_REMOTE$"},NS={IT_AUDIO_VIDEO:0,IT_PICTURE:2,IT_CANVAS:3,IT_PURE_AUDIO:4,IT_PURE_VIDEO:5},PS="string",US="number",xS="boolean",GS="array",FS="object",VS={ADD:vC,REMOVE:_C},qS={unknown:0,wifi:1,"4g":2,"3g":3,"2g":4,wired:5},BS=-1,HS=0,jS=1,KS=qT,zS=VT,WS=6048e5,YS="schedule.rtc.qq.com",$S="schedule.rtc.qcloud.com",JS="schedule.rtc.tencentcloud.com",XS="schedule-ecdn.rtc.tencentcloud.com",ZS="",QS=function(e){return ZS=e},eE="TRTC",tE="Client",nE="LocalStream",iE="RemoteStream",rE="Stream",oE="web.sdk.qcloud.com",aE="web.sdk.tencent.cn",sE="web.sdk.cloud.tencent.cn",cE="https://console.cloud.tencent.com/trtc",uE="https://".concat(oE,"/trtc/webrtc/doc"),lE="".concat(uE,"/zh-cn/"),dE="trtc_error_assistance",pE="default",hE="communications",fE={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,NONE:5},gE=Object.keys(fE),mE=["normal leave","timeout leave","kick","role change"],vE=2e3,_E="ric",yE="raf",IE="interval",ME="timeout",TE="Resolution reset to 1080p, need to upgrade ability here https://cloud.tencent.com/document/product/647/85386",CE=le,SE=sd,EE=/"/g,kE=te("".replace),bE=function(e,t,n,i){var r=SE(CE(e)),o="<"+t;return""!==n&&(o+=" "+n+'="'+kE(SE(i),EE,"&quot;")+'"'),o+">"+r+"</"+t+">"},DE=R,wE=function(e){return DE((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))},AE=bE;Er({target:"String",proto:!0,forced:wE("link")},{link:function(e){return AE(this,"a","href",e)}}),Er({target:"Array",stat:!0},{isArray:Rr});var RE="AVOID_REPEATED_CALL",LE="INVALID_PARAMETER_REQUIRED",OE="INVALID_PARAMETER_TYPE",NE="INVALID_PARAMETER_EMPTY",PE="INVALID_PARAMETER_INSTANCE",UE="INVALID_PARAMETER_RANGE",xE="API_CALL_TIMEOUT",GE="SIGNAL_CHANNEL_RECONNECTION_FAILED",FE="SIGNAL_CHANNEL_SETUP_FAILED",VE="ERROR_MESSAGE",qE="EXCHANGE_SDP_TIMEOUT",BE="DOWNLINK_RECONNECTION_FAILED",HE="EXCHANGE_SDP_FAILED",jE="UPLINK_RECONNECTION_FAILED",KE="INVALID_PURE_AUDIO",zE="INVALID_STREAMID",WE="INVALID_USER_DEFINE_RECORDID",YE="INVALID_USER_DEFINE_PUSH_ARGS",$E="INVALID_PROXY",JE="INVALID_JOIN",XE="INVALID_ROOMID_STRING",ZE="INVALID_ROOMID_INTEGER",QE="JOIN_ROOM_TIMEOUT",ek="JOIN_ROOM_FAILED",tk="REJOIN_ROOM_FAILED",nk="INVALID_DESTROY",ik="INVALID_PUBLISH",rk="INVALID_UNPUBLISH",ok="INVALID_AUDIENCE",ak="INVALID_INITIALIZE",sk="INVALID_DUPLICATE_PUBLISHING",ck="INVALID_REMOTE_STREAM",uk="SUBSCRIBE_FAILED",lk="INVALID_ROLE",dk="INVALID_OPERATION_SWITCH_ROLE",pk="SWITCH_ROLE_TIMEOUT",hk="SWITCH_ROLE_FAILED",fk="CLIENT_BANNED",gk="INVALID_OPERATION_START_PUBLISH_CDN",mk="INVALID_OPERATION_STOP_PUBLISH_CDN",vk="INVALID_STREAM_ID",_k="START_PUBLISH_CDN_FAILED",yk="STOP_PUBLISH_CDN_FAILED",Ik="START_MIX_TRANSCODE",Mk="STOP_MIX_TRANSCODE",Tk="INVALID_AUDIO_VOLUME",Ck="ENABLE_SMALL_STREAM_PUBLISHED",Sk="DISABLE_SMALL_STREAM_PUBLISHED",Ek="NOT_SUPPORTED_SMALL_STREAM",kk="INVALID_SMALL_STREAM_PROFILE",bk="INVALID_PARAMETER_REMOTE_STREAM",Dk="INVALID_SWITCH_DEVICE",wk="INVALID_SWITCH_DEVICE_PUBLISHING",Ak="INVALID_REPLACE_TRACK",Rk="INVALID_INITIALIZE_LOCAL_STREAM",Lk="INVALID_ADD_TRACK_REPETITIVE",Ok="INVALID_ADD_TRACK_REMOVING",Nk="INVALID_ADD_TRACK_PUBLISHING",Pk="INVALID_STREAM_INITIALIZED",Uk="INVALID_ADD_TRACK_NUMBER",xk="INVALID_REMOVE_AUDIO_TRACK",Gk="INVALID_REMOVE_AUDIO_ADDING",Fk="INVALID_REMOVE_AUDIO_ON",Vk="INVALID_REMOVE_TRACK_PUBLISHING",qk="INVALID_REMOVE_TRACK_NOT_PUBLISHING",Bk="INVALID_REMOVE_TRACK_NUMBER",Hk="INVALID_REPLACE_TRACK_NO_TRACK",jk="REPEAT_JOIN",Kk="CLIENT_DESTROYED",zk="START_MIX_TRANSCODE_FAILED",Wk="STOP_MIX_TRANSCODE_FAILED",Yk="MIX_TRANSCODE_NOT_STARTED",$k="CANNOT_LESS_THAN_ZERO",Jk="MIX_PARAMS_VIDEO_FRAMERATE",Xk="MIX_PARAMS_VIDEO_GOP",Zk="MIX_PARAMS_AUDIO_BITRATE",Qk="MIX_PARAMS_USER_Z_ORDER",eb="MIX_PARAMS_NOT_SELF",tb="MIX_PARAMS_USER_STREAM",nb="INVALID_ELEMENT_ID",ib="INVALID_ELEMENT_ID_TYPE",rb="PLAY_FAILED",ob="INVALID_CREATE_STREAM_SOURCE",ab="INVALID_CREATE_STREAM_SCREEN",sb="INVALID_CREATE_STREAM_AUDIO",cb="INVALID_CREATE_STREAM_SCREEN_AUDIO",ub="NOT_SUPPORTED_HTTP",lb="NOT_SUPPORTED_WEBRTC",db="NOT_SUPPORTED_PROFILE",pb="NOT_SUPPORTED_H264ENCODE",hb="NOT_SUPPORTED_H264DECODE",fb="NOT_SUPPORTED_TRACK",gb="NOT_SUPPORTED_SWITCH_DEVICE",mb="NOT_SUPPORTED_CAPTURE",vb="NOT_SUPPORTED_AUX",_b="MICROPHONE_NOT_FOUND",yb="CAMERA_NOT_FOUND",Ib="SIGNAL_RESPONSE_FAILED",Mb="CATCH_HANDLER_ERROR",Tb="API_NOT_EXIST",Cb="CONNECTION_CLOSED",Sb="SUBSCRIBE_ALL_FALSE",Eb="SEI_NOT_SUPPORT",kb="SEI_DISABLED",bb="SEI_EMPTY",Db="SEI_OVERSIZE",wb="SEI_BEFORE_PUBLISH",Ab="SEI_NOT_VIDEO",Rb="CALL_FREQUENCY_LIMIT",Lb="CONNECTION_ABORTED",Ob="API_CALL_ABORTED",Nb="DUPLICATE_AUX",Pb={AVOID_REPEATED_CALL:function(e){return"previous ".concat(e.name,"() is ongoing, please avoid repeated calls.")},INVALID_PARAMETER_REQUIRED:function(e){var t=e.key,n=e.rule,i=e.fnName,r=e.value;return"'".concat(t||n.name,"' is a required param when calling ").concat(i,"(), received: ").concat(r,".")},INVALID_PARAMETER_TYPE:function(e){var t=e.key,n=e.rule,i=e.fnName,r=e.value,o="".concat(t||n.name),a="";return a=Array.isArray(n.type)?n.type.join("|"):n.type,"'".concat(o,"' must be type of ").concat(a," when calling ").concat(i,"(), received type: ").concat(Mw(r),".")},INVALID_PARAMETER_EMPTY:function(e){var t=e.key,n=e.rule,i=e.fnName,r=e.value;return"'".concat(t||n.name,"' cannot be '").concat(r,"' when calling ").concat(i,"().")},INVALID_PARAMETER_INSTANCE:function(e){var t=e.key,n=e.rule,i=e.fnName,r=e.value,o="".concat(t||n.name),a="".concat(n.instanceOf.name||n.instanceOf);return"'".concat(o,"' must be instanceof ").concat(a," when calling ").concat(i,"(), received type: ").concat(Mw(r),".")},INVALID_PARAMETER_RANGE:function(e){var t=e.key,n=e.rule,i=e.fnName,r=e.value;return"'".concat(t||n.name,"' must be one of ").concat(n.values.join("|")," when calling ").concat(i,"(), received: ").concat(r,".")},API_CALL_TIMEOUT:function(e){return"".concat(e.commandDesc||e.command," timeout observed.")},SIGNAL_CHANNEL_RECONNECTION_FAILED:"signal channel reconnection failed, please check your network.",SIGNAL_CHANNEL_SETUP_FAILED:function(e){return"SignalChannel setup failure: (errorCode: ".concat(e.errorCode,", errorMsg: ").concat(e.errorMsg," }).")},ERROR_MESSAGE:function(e){var t="".concat(e.type," failed");return e.message&&(t="".concat(t,": ").concat(e.message,".")),t},EXCHANGE_SDP_TIMEOUT:"exchange sdp timeout.",DOWNLINK_RECONNECTION_FAILED:"downlink reconnection failed, please check your network and re-join room.",EXCHANGE_SDP_FAILED:function(e){return"exchange sdp failed ".concat(e.errMsg,".")},UPDATE_OFFER_TIMEOUT:"update offer timeout observed.",UPLINK_RECONNECTION_FAILED:"uplink reconnection failed, please check your network and publish again.",INVALID_RECORDID:"recordId must be an integer number.",INVALID_PURE_AUDIO:"pureAudioPushMode must be 1 or 2.",INVALID_STREAMID:"streamId must be a sting literal within 64 bytes, and not be empty.",INVALID_USER_DEFINE_RECORDID:"userDefineRecordId must be a sting literal contains (a-zA-Z),(0-9), underline and hyphen, within 64 bytes, and not be empty.",INVALID_USER_DEFINE_PUSH_ARGS:"userDefinePushArgs must be a sting literal within 256 bytes, and not be empty.",INVALID_PROXY:'proxy server url must start with "wss://".',INVALID_JOIN:"duplicate join() called.",INVALID_ROOMID_STRING:function(e){return"'".concat(e,"' must be validate string when useStringRoomId is true.")},INVALID_ROOMID_INTEGER:function(e){return"'".concat(e,"' must be an integer between [1, 4294967294] when useStringRoomId is false.")},INVALID_SIGNAL_CHANNEL:"SignalChannel is not ready yet.",JOIN_ROOM_TIMEOUT:"join room timeout.",JOIN_ROOM_FAILED:function(e){var t=e.error,n=e.code;return"Failed to join room - ".concat(t," code: ").concat(n)},REJOIN_ROOM_FAILED:function(e){return"reJoin room: ".concat(e.roomId," failed, please check your network.")},INVALID_DESTROY:"please call leave() before destroy().",INVALID_PUBLISH:"please call join() before publish().",INVALID_UNPUBLISH:"stream has not been published yet.",INVALID_AUDIENCE:"no permission to publish() under live/".concat(xC,', please call switchRole("').concat(UC,'") firstly before publish().'),INVALID_INITIALIZE:"cannot publish stream because stream is not initialized, is switching device, or has been closed.",INVALID_DUPLICATE_PUBLISHING:function(e){return"duplicate ".concat(e," stream publishing, please unpublish your prev ").concat(e," stream and then re-publish.")},INVALID_SUBSCRIBE_UNDEFINED:"stream is undefined or null.",INVALID_SUBSCRIBE_LOCAL:"stream cannot be LocalStream.",INVALID_REMOTE_STREAM:"remoteStream does not exist because it has been unpublished by remote peer.",SUBSCRIBE_FAILED:function(e){var t=e.message,n=e.stream;return"failed to subscribe ".concat(n.getUserId()," ").concat(n.getType()," stream, reason: ").concat(t,".")},INVALID_ROLE:"switchRole can only be called in live mode.",INVALID_PARAMETER_SWITCH_ROLE:"role could only be set to a value as ".concat(UC," or ").concat(xC,"."),INVALID_OPERATION_SWITCH_ROLE:"please call join() before switchRole().",SWITCH_ROLE_TIMEOUT:"switchRole timeout.",SWITCH_ROLE_FAILED:function(e){return"switchRole failed, errCode: ".concat(e.code," errMsg: ").concat(e.message,".")},CLIENT_BANNED:function(e){return"client was banned because of "+e.message+"."},INVALID_OPERATION_START_PUBLISH_CDN:"please call startPublishCDNStream() before client join the room or after client join the room and successfully publish the local stream.",INVALID_OPERATION_STOP_PUBLISH_CDN:"please call startPublishCDNStream() before stopPublishCDNStream().",START_PUBLISH_CDN_FAILED:function(e){return"startPublishCDNStream failed, errMsg: ".concat(e.message,".")},STOP_PUBLISH_CDN_FAILED:function(e){return"stopPublishCDNStream failed, errMsg: ".concat(e.message,".")},INVALID_STREAM_ID:function(e){return"'".concat(e,"' can only consist of uppercase and lowercase english letters (a-zA-Z), numbers (0-9), hyphens and underscores.")},START_MIX_TRANSCODE:"please call startMixTranscode() after join().",STOP_MIX_TRANSCODE:"please call stopMixTranscode() after startMixTranscode().",INVALID_AUDIO_VOLUME:"interval must be a number.",ENABLE_SMALL_STREAM_PUBLISHED:"Cannot enable small stream after localStream published.",DISABLE_SMALL_STREAM_PUBLISHED:"Cannot disable small stream after localStream published.",NOT_SUPPORTED_SMALL_STREAM:"your browser does not support opening small stream.",INVALID_SMALL_STREAM_PROFILE:"small stream profile is invalid.",INVALID_PARAMETER_REMOTE_STREAM:"remoteStream is invalid.",INVALID_OPERATION_CHANGE_SMALL:"cannot switch to the small stream without subscribing to the video of remoteStream.",REMOTE_NOT_PUBLISH_SMALL_STREAM:"remote peer does not publish small stream.",INVALID_SWITCH_DEVICE:"cannot switch device on current stream.",INVALID_SWITCH_DEVICE_PUBLISHING:"cannot switch device when publishing localStream.",INVALID_REPLACE_TRACK:"cannot replace track when publishing localStream.",INVALID_INITIALIZE_LOCAL_STREAM:"local stream has not initialized yet.",INVALID_ADD_TRACK_REPETITIVE:"previous addTrack is ongoing, please avoid repetitive execution.",INVALID_ADD_TRACK_REMOVING:"cannot add track when a track is removing.",INVALID_ADD_TRACK_PUBLISHING:"cannot add track when publishing localStream.",INVALID_STREAM_INITIALIZED:"your local stream haven't been initialized yet.",INVALID_ADD_TRACK_NUMBER:"a Stream has at most one audio track and one video track.",INVALID_REMOVE_AUDIO_TRACK:"remove audio track is not supported on your browser.",INVALID_REMOVE_AUDIO_ADDING:"cannot remove track when a track is adding.",INVALID_REMOVE_AUDIO_ON:"previous removeTrack is ongoing, please avoid repetitive execution.",INVALID_REMOVE_TRACK_PUBLISHING:"cannot remove track when publishing localStream.",INVALID_REMOVE_TRACK_NOT_PUBLISHING:"the track to be removed is not being publishing.",INVALID_REMOVE_TRACK_NUMBER:"remove the only video track is not supported, please use replaceTrack or muteVideo.",INVALID_REPLACE_TRACK_NO_TRACK:function(e){return"cannot replace ".concat(e.kind," track because stream has not ").concat(e.kind," track")},START_MIX_TRANSCODE_FAILED:function(e){return"startMixTranscode failed, errMsg: ".concat(e.message,".")},STOP_MIX_TRANSCODE_FAILED:function(e){return"stopMixTranscode failed, errMsg: ".concat(e.message,".")},MIX_TRANSCODE_NOT_STARTED:"mixTranscode has not been started.",CANNOT_LESS_THAN_ZERO:function(e){var t=e.key,n=e.rule,i=e.fnName;return e.value,"'".concat(t||n.name,"' cannot be less than 0 when calling ").concat(i,"().")},MIX_PARAMS_VIDEO_FRAMERATE:"'config.videoFramerate' should be an integer between 0 and 30, excluding 0.",MIX_PARAMS_VIDEO_GOP:"'config.videoGOP' should be an integer between 1 and 8.",MIX_PARAMS_AUDIO_BITRATE:"'config.audioBitrate' should be an integer between 32 and 192.",MIX_PARAMS_USER_Z_ORDER:function(e){return"'".concat(e,"' is required and must be between 1 and 15.")},MIX_PARAMS_NOT_SELF:"'config.mixUsers' must contain self.",MIX_PARAMS_USER_STREAM:"'config.videoWidth' and 'config.videoHeight' of output stream should be contain all mix stream.",INVALID_PLAY:"duplicate play() call observed, please stop() firstly.",INVALID_ELEMENT_ID:function(e){var t=e.key,n=e.fnName;return"'".concat(t,"' is not found in the document object when calling ").concat(n,"().")},INVALID_ELEMENT_ID_TYPE:function(e){var t=e.key,n=e.fnName,i=e.type;return"the element corresponding to '".concat(t,"' must be instanceof HTMLDivElement when calling ").concat(n,"(), received: ").concat(i,".")},PLAY_FAILED:function(e){return"".concat(e.media," play failed，browser exception: ").concat(e.error.toString())},INVALID_USERID:"userId cannot be all spaces.",INVALID_CREATE_STREAM_SOURCE:"LocalStream must be created by createStream() with either audio/video or audioSource/videoSource, but can not be mixed with audio/video and audioSource/videoSource.",INVALID_CREATE_STREAM_SCREEN:"screen/video cannot be both true.",INVALID_CREATE_STREAM_AUDIO:"audio/screenAudio cannot be both true.",INVALID_CREATE_STREAM_SCREEN_AUDIO:"when screen is true, screenAudio can be configured.",NOT_SUPPORTED_HTTP:"http protocol does not support the ability to capture and publish streams, please use the https protocol.",NOT_SUPPORTED_WEBRTC:"your browser or environment does not support full WebRTC capabilities.",NOT_SUPPORTED_PROFILE:"your browser does not support setVideoProfile.",NOT_SUPPORTED_MEDIA:"your browser or environment does not support navigator.mediaDevices.",NOT_SUPPORTED_H264ENCODE:"your device does not support H.264 encoding.",NOT_SUPPORTED_H264DECODE:"your device does not support H.264 decoding.",NOT_SUPPORTED_TRACK:function(e){return"".concat(e,"Track is not supported on your browser.")},NOT_SUPPORTED_SWITCH_DEVICE:"switchDevice is not supported on your browser.",NOT_SUPPORTED_CAPTURE:"Your browser or environment does not support screen sharing, please check whether the browser version.",MICROPHONE_NOT_FOUND:"no microphone detected, please check your microphone and the configuration on TRTC.createStream.",CAMERA_NOT_FOUND:"no camera detected, please check your camera and the configuration on TRTC.createStream.",SIGNAL_RESPONSE_FAILED:function(e){return"".concat(e.signalResponse," failed, response code is ").concat(e.code," , errMsg: ").concat(e.message,".")},CATCH_HANDLER_ERROR:function(e){var t=e.name,n=e.event;return"an error was caught on ".concat(t,".on('").concat(n,"', handler), please check your code on 'handler'.")},API_NOT_EXIST:function(e){var t=e.name;return"experimental api ".concat(t," does not exist.")},REPEAT_JOIN:function(e){return"[".concat(e,"] is calling client.join api or has already joined room, please avoid repeated join.")},CONNECTION_CLOSED:"remoteStream has been unsubscribed or unpublished by remote user.",SUBSCRIBE_ALL_FALSE:"cannot subscribe when both audio & video are false, use client.unsubscribe() instead",CLIENT_DESTROYED:function(e){var t=e.funName;return"failed to call ".concat(t,"() because client was destroyed.")},SEI_NOT_SUPPORT:function(e){return"not support to sendSEIMessage".concat(!1===e?" without using h264 codec":"")},SEI_DISABLED:"SEI is disabled, to enable SEI: TRTC.createClient({ enableSEI: true })",SEI_EMPTY:"buffer cannot be empty",SEI_OVERSIZE:function(e){return"buffer size(".concat(e,") is over 1000 Bytes")},SEI_BEFORE_PUBLISH:"please call sendSEIMessage() after publish() success",SEI_NOT_VIDEO:"cannot send sei when localStream has not video.",CALL_FREQUENCY_LIMIT:function(e){var t=e.isSize,n=e.name,i=e.timesInSecond,r=e.maxSizeInSecond;return"api ".concat(n," call ").concat(t?"size":"times"," is over ").concat(t?r+" bytes":i," in a second.")},CONNECTION_ABORTED:function(e){return"connection aborted due to: "+e},API_CALL_ABORTED:function(e){return e.message.includes("REMOTE_STREAM_NOT_EXIST")?"Subscribe ".concat(e.stream.getUserId()," ").concat(e.stream.getType()," stream aborted, reason: remote user ").concat(e.stream.getUserId()," unpublished stream."):"API aborted, reason: ".concat(e.message)},DUPLICATE_AUX:"only one auxiliary stream can be published in a room.",NOT_SUPPORTED_AUX:"publish auxiliary stream is not supported on your browser."},Ub=w,xb=R,Gb=sd,Fb=f_.trim,Vb=te("".charAt),qb=Ub.parseFloat,Bb=Ub.Symbol,Hb=Bb&&Bb.iterator,jb=1/qb("\t\n\v\f\r                　\u2028\u2029\ufeff-0")!=-1/0||Hb&&!xb((function(){qb(Object(Hb))}))?function(e){var t=Fb(Gb(e)),n=qb(t);return 0===n&&"-"==Vb(t,0)?-0:n}:qb;Er({global:!0,forced:parseFloat!=jb},{parseFloat:jb});var Kb=window.navigator&&window.navigator.userAgent||"",zb=/AppleWebKit\/([\d.]+)/i.exec(Kb);zb&&parseFloat(zb.pop());var Wb=/iPad/i.test(Kb),Yb=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/Macintosh/.test(Kb),$b=/iPhone/i.test(Kb)&&!Wb,Jb=/iPod/i.test(Kb),Xb=$b||Wb||Jb||Yb,Zb=/Android/i.test(Kb);Zb&&function(){var e=Kb.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);t&&n&&parseFloat(e[1]+"."+e[2])}();var Qb=/Firefox/i.test(Kb),eD=Qb&&function(){var e=Kb.match(/Firefox\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),tD=/Edge\//i.test(Kb),nD=tD&&function(){var e=Kb.match(/Edge\/(\d+)/i);if(e&&e[1])return e[1]}(),iD=/Edg\//i.test(Kb),rD=iD&&function(){var e=Kb.match(/Edg\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),oD=/SogouMobileBrowser\//i.test(Kb),aD=oD&&function(){var e=Kb.match(/SogouMobileBrowser\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),sD=/MetaSr\s/i.test(Kb),cD=sD&&function(){var e=Kb.match(/MetaSr(\s\d+(\.\d+)+)/);return e&&e[1]?parseFloat(e[1]):null}(),uD=/TBS\/\d+/i.test(Kb),lD=uD&&function(){var e=Kb.match(/TBS\/(\d+)/i);if(e&&e[1])return e[1]}(),dD=/XWEB\/\d+/i.test(Kb),pD=dD&&function(){var e=Kb.match(/XWEB\/(\d+)/i);if(e&&e[1])return e[1]}();/MSIE\/\d+/i.test(Kb)&&function(){var e=/MSIE\s(\d+)\.\d/.exec(Kb);e&&parseFloat(e[1])}();var hD,fD,gD=/(micromessenger|webbrowser)/i.test(Kb),mD=gD&&function(){var e=Kb.match(/MicroMessenger\/(\d+)/i);if(e&&e[1])return e[1]}(),vD=!uD&&/MQQBrowser\/\d+/i.test(Kb)&&/COVC\/\d+/i.test(Kb),_D=!uD&&/MQQBrowser\/\d+/i.test(Kb)&&!/COVC\/\d+/i.test(Kb),yD=(_D||vD)&&function(){var e=Kb.match(/ MQQBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),ID=!uD&&/ QQBrowser\/\d+/i.test(Kb),MD=ID&&function(){var e=Kb.match(/ QQBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),TD=!uD&&/QQBrowserLite\/\d+/i.test(Kb),CD=TD&&function(){var e=Kb.match(/QQBrowserLite\/([\d.]+)/);return e&&e[1]?e[1]:null}(),SD=!uD&&/MQBHD\/\d+/i.test(Kb),ED=SD&&function(){var e=Kb.match(/MQBHD\/([\d.]+)/);return e&&e[1]?e[1]:null}(),kD=/Windows/i.test(Kb),bD=!Xb&&/MAC OS X/i.test(Kb),DD=!Zb&&/Linux/i.test(Kb),wD=/UCBrowser/i.test(Kb),AD=/MiuiBrowser/i.test(Kb),RD=AD&&function(){var e=Kb.match(/MiuiBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),LD=/HuaweiBrowser/i.test(Kb),OD=/Huawei/i.test(Kb),ND=LD&&function(){var e=Kb.match(/HuaweiBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),PD=/SamsungBrowser/i.test(Kb),UD=PD&&function(){var e=Kb.match(/SamsungBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),xD=/HeyTapBrowser/i.test(Kb),GD=xD&&function(){var e=Kb.match(/HeyTapBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),FD=/VivoBrowser/i.test(Kb),VD=FD&&function(){var e=Kb.match(/VivoBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),qD=function(){var e=Kb.match(/Chrome\/(\d+)/);return e&&e[1]?Number(e[1]):null},BD=/Chrome/i.test(Kb),HD=!tD&&!sD&&!oD&&!uD&&!dD&&!iD&&!ID&&!AD&&!LD&&!PD&&!xD&&!FD&&/Chrome/i.test(Kb),jD=HD&&qD(),KD=HD&&function(){var e=Kb.match(/Chrome\/([\d.]+)/);return e&&e[1]?e[1]:null}(),zD=!BD&&!_D&&!vD&&!TD&&!SD&&/Safari/i.test(Kb),WD=function(){if(zD){var e=Kb.match(/Version\/([\d.]+)/);if(e&&e[1])return e[1]}return""}(),YD=/Android.*(wv|.0.0.0)/.test(Kb),$D=function(){if(Yb)return WD;if(Xb){var e=Kb.match(/OS (\d+)_(\d+)/i);if(e&&e[1]){var t=e[1];return e[2]&&(t+=".".concat(e[2])),t}}return""}(),JD="15.1"===WD,XD="15.1"===$D,ZD=14===(hD=Number($D.split(".")[0]))||13===hD,QD="file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname,ew=function(){if(fw(fD))try{fD=window.localStorage}catch(oY){PA.warn(oY),fD=!1}return fD},tw=new Map([[Qb,["Firefox",eD]],[iD,["Edg",rD]],[HD,["Chrome",KD]],[zD,["Safari",WD]],[uD,["TBS",lD]],[dD,["XWEB",pD]],[gD&&$b,["WeChat",mD]],[ID,["QQ(Win)",MD]],[_D,["QQ(Mobile)",yD]],[vD,["QQ(Mobile X5)",yD]],[TD,["QQ(Mac)",CD]],[SD,["QQ(iPad)",ED]],[AD,["MI",RD]],[LD,["HW",ND]],[PD,["Samsung",UD]],[xD,["OPPO",GD]],[FD,["VIVO",VD]],[tD,["EDGE",nD]],[oD,["SogouMobile",aD]],[sD,["Sogou",cD]]]);function nw(){var e="unknown",t="unknown";return tw.get(!0)&&(e=tw.get(!0)[0],t=tw.get(!0)[1]),{name:e,version:t}}var iw=function(e,t){return t?uE+"/"+e+"/"+t:uE+"/"+e+"/index.html"},rw=function(){if(!ew())return!1;var e=localStorage.getItem(dE);e&&!function(e){var t=e.saveTime&&(new Date).getTime()-e.saveTime>=WS,n=!e.saveVersion||e.saveVersion!==za;return t||n}(JSON.parse(e))||(PA.info("init debug info"),function(){var e=new XMLHttpRequest;if(e.open("GET","https://web.sdk.qcloud.com/trtc/webrtc/download/error-message/0.0.3/script.js",!1),e.send(null),4===e.readyState&&200===e.status){var t=document.createElement("script");t.type="text/javascript",t.text=e.responseText,document.body.appendChild(t),localStorage.setItem(dE,JSON.stringify({message:e.responseText,saveTime:(new Date).getTime(),saveVersion:za})),document.body.removeChild(t)}}())};function ow(e){var t=e.key,n=e.data,i=e.link,r=e.addDocLink,o=void 0===r||r,a="",s="",c="";hw(Pb[t])?a=Pb[t](n):gw(Pb[t])&&(a=Pb[t]);var u=function(){if(window.TRTC_ERROR_INFO&&window.TRTC_ERROR_LINK)return{TRTC_ERROR_INFO:window.TRTC_ERROR_INFO,TRTC_ERROR_LINK:window.TRTC_ERROR_LINK};var e=localStorage.getItem(dE);if(e){e=JSON.parse(e);var t=document.createElement("script");t.type="text/javascript",t.text=e.message,document.body.appendChild(t);var n=window.TRTC_ERROR_INFO,i=window.TRTC_ERROR_LINK;return document.body.removeChild(t),{TRTC_ERROR_INFO:n,TRTC_ERROR_LINK:i}}return{}}(),l=u.TRTC_ERROR_INFO,d=u.TRTC_ERROR_LINK;i?c="".concat(i.className,".html#").concat(i.fnName):d&&d[t]&&(hw(d[t])?c=d[t](n):gw(d[t])&&(c=d[t]));var p=a;return bw()&&(l&&l[t]&&(hw(l[t])?s=l[t](n):gw(l[t])&&(s=l[t])),s&&(p=o?s+"\n请查看文档: "+iw("zh-cn",c)+"\n\n":s+"\n\n",p+=a)),o&&(p+=" \nRefer to: "+iw("en",c)+"\n"),p}var aw=function(){return function(e){var t=window.location.search.match(new RegExp("(\\?|&)"+e+"=([^&]*)(&|$)"));return t?decodeURIComponent(t[2]):""}("trtc_env")},sw=function(e){return(e=Number(e))>0&&e<14e8},cw=function(e,t){var n;n=kC?kC.includes("http")?kC:"https://"+kC:sw(e)?"https://apisgp.my-imcloud.com":"https://yun.tim.qq.com";var i=Math.floor(Math.random()*Math.pow(2,31));return"".concat(n,"/v5/AVQualityReportSvc/C2S?random=").concat(i,"&sdkappid=").concat(e,"&cmdtype=").concat(t)};function uw(){var e=navigator.userAgent,t=navigator.connection,n=e.match(/NetType\/\w+/)?e.match(/NetType\/\w+/)[0]:"";"3gnet"===(n=n.toLowerCase().replace("nettype/",""))&&(n="3g");var i=t&&t.type&&t.type.toLowerCase(),r=t&&t.effectiveType&&t.effectiveType.toLowerCase();"slow-2"===r&&(r="2g");var o=n||"unknown";if(i)switch(i){case"cellular":case"wimax":o=r||"unknown";break;case"wifi":o="wifi";break;case"ethernet":o="wired";break;case"none":case"other":case"unknown":o="unknown"}return o}var lw=function(e){if(!e||"object"!==i(e)||"[object Object]"!=Object.prototype.toString.call(e))return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Function.prototype.toString.call(n)===Function.prototype.toString.call(Object)};function dw(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e<=1?t:dw(e-1,t,(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)+t)}function pw(e){var t=Math.round(e/2)+1;return t>6?13e3:1e3*dw(t)}var hw=function(e){return"function"==typeof e},fw=function(e){return void 0===e},gw=function(e){return"string"==typeof e},mw=function(e){return"number"==typeof e},vw=function(e){return"boolean"==typeof e},_w=function(e){return"object"===Mw(e)},yw=function(e){return"array"===Mw(e)},Iw=function(e){return Mw(e)==="MediaStreamTrack".toLowerCase()};function Mw(e){return Reflect.apply(Object.prototype.toString,e,[]).replace(/^\[object\s(\w+)\]$/,"$1").toLowerCase()}function Tw(e){var t={};return t.urls="turn:".concat(e.url),fw(e.username)||fw(e.credential)||(t.username=e.username,t.credential=e.credential,t.credentialType="password",fw(e.credentialType)||(t.credentialType=e.credentialType)),t}function Cw(){return performance&&performance.now?Math.floor(performance.now()):Date.now()}function Sw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"big";if(!gw(e))return 0;var n=e.split(".");return"big"===t?(Number(n[0])<<24|Number(n[1])<<16|Number(n[2])<<8|Number(n[3]))>>>0:(Number(n[3])<<24|Number(n[2])<<16|Number(n[1])<<8|Number(n[0]))>>>0}var Ew,kw,bw=function(){var e=navigator.language||navigator.userLanguage;return"zh"===e.substr(0,2)},Dw=(Ew=!1,kw=document.visibilityState,function(){document.visibilityState!==kw&&PA.info("visibility change: ".concat(document.visibilityState)),Ew||(document.addEventListener("visibilitychange",(function(){PA.info("visibility change: "+document.visibilityState),kw=document.visibilityState})),Ew=!0)});window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;var ww=function(){return new window.AudioContext},Aw=function(){var e;return function(){return e||((e=new window.AudioContext).onstatechange=function(){PA.info("gain context state: ".concat(e.state)),"suspended"===e.state?(e.resume(),document.addEventListener("click",e.resume)):"interrupted"===e.state?e.resume():document.removeEventListener("click",e.resume)},e)}}(),Rw=!!window.AudioWorkletNode,Lw=function(e,t){var n=e.emit;return e.emit=function(){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];try{n.apply(e,r)}catch(oY){var a=ow({key:Mb,data:{name:t,event:r[0]},addDocLink:!1});PA.warn(a+"\n\n"+oY.stack)}},e},Ow=function(e){return+e<10?"0".concat(e):e},Nw=function(e){var t=e.match(/^\d+\.\d+\.\d+/)[0];if(!t)return e;var n=t.split("."),i=Ow(n[1])+Ow(n[2]);return n[1]-15>0&&(n[1]="15"),n[2]-15>0&&(n[2]="15"),n.join(".")+"."+i};function Pw(e){var t=e.url,n=e.body,i=e.method,r=e.timeout,o=new XMLHttpRequest;return new Promise((function(e,a){o.onload=function(t){if(o.status>=200&&o.status<300&&o.responseText.length>0)try{var n=JSON.parse(o.response);e({data:n})}catch(oY){e({data:o.response})}else o.status>0&&a({code:o.status,message:"request failed, readyState:".concat(o.readyState," status:").concat(o.status," loaded size:").concat(t.loaded)})};var s=function(e){a({code:o.readyState,message:"request ".concat(e.type,", readyState:").concat(o.readyState," status:").concat(o.status," loaded size:").concat(e.loaded)})};o.onerror=s,o.onabort=s,o.ontimeout=s,o.timeout=r||5e3,o.open(i||"POST",t,!0),o.send(n)}))}var Uw={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,i,o,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new r(i,o||e,a),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},s.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,o=i.length,a=new Array(o);r<o;r++)a[r]=i[r].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},s.prototype.emit=function(e,t,i,r,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,r),!0;case 5:return l.fn.call(l.context,t,i,r,o),!0;case 6:return l.fn.call(l.context,t,i,r,o,a),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,h=l.length;for(u=0;u<h;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,i);break;case 4:l[u].fn.call(l[u].context,t,i,r);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,i,r){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||r&&!s.once||i&&s.context!==i||a(this,o);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==t||r&&!s[c].once||i&&s[c].context!==i)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}(Uw);var xw=Uw.exports,Gw=new xw,Fw=1,Vw=2,qw=3,Bw=4,Hw=5,jw=20,Kw=21,zw=22,Ww=23,Yw=24,$w=27,Jw=28,Xw=29,Zw=30,Qw=33,eA=31,tA=32,nA=100,iA=101,rA=102,oA=103,aA=110,sA=111,cA=112,uA=113,lA=114,dA=115,pA=116,hA=120,fA=121,gA=122,mA=123,vA=130,_A=131,yA=132,IA=133,MA=134,TA=135,CA=136,SA=137,EA=200,kA=201,bA=300,DA=301,wA=302,AA=303;function RA(e){var t=e.retryFunction,i=e.settings,r=e.onError,a=e.onRetrying,s=e.onRetryFailed,c=e.context;return function(){for(var e=this,u=arguments.length,l=new Array(u),d=0;d<u;d++)l[d]=arguments[d];var p,h=i.retries||5,f=0,g=-1,m=0,v=(p=o(n().mark((function o(u,d){var p,_,y,I;return n().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return p=c||e,n.prev=1,n.next=4,t.apply(p,l);case 4:_=n.sent,f=0,u(_),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),y=function(){clearTimeout(g),f=0,m=2,d(n.t0)},I=function(){2!==m&&f<h?(f++,m=1,hw(a)&&a.call(p,f,y),g=setTimeout((function(){g=-1,v(u,d)}),fw(i.timeout)?1e3:i.timeout)):(y(),hw(s)&&s.call(p,n.t0))},hw(r)?r.call(p,n.t0,I,d,l):I();case 14:case"end":return n.stop()}}),o,null,[[1,9]])}))),function(e,t){return p.apply(this,arguments)});return new Promise(v)}}var LA=c((function e(t){a(this,e),this.log=t.log,this.level=t.level,this.userId=t.userId,this.sdkAppId=t.sdkAppId,this.forAllJoinedClients=t.forAllJoinedClients,this.uploaded=!1})),OA=function(){function e(t){a(this,e),this.id_=t.id,this.userId_=t.userId,this.sdkAppId_=t.sdkAppId,this.type_=t.type,this.isLocal_=!vw(t.isLocal)||t.isLocal}return c(e,[{key:"setUserId",value:function(e){this.userId_=e}},{key:"setSdkAppId",value:function(e){this.sdkAppId_=e}},{key:"log",value:function(e,t){PA.log({log:"[".concat(this.isLocal_?"↑":"↓").concat(this.id_,"] ").concat(this.type_?this.type_+" ":"").concat(t),level:e,forAllJoinedClients:fw(this.userId_),userId:this.userId_,sdkAppId:this.sdkAppId_})}},{key:"info",value:function(e){this.log(fE.INFO,e)}},{key:"debug",value:function(e){this.log(fE.DEBUG,e)}},{key:"warn",value:function(e){this.log(fE.WARN,e)}},{key:"error",value:function(e){this.log(fE.ERROR,e)}}]),e}(),NA=function(){function e(){var t=this;a(this,e),this.clients_=new Set,this.queue_=[],this.timeoutId_=-1,this.logLevel_=fE.DEBUG,this.logLevelToUpload_=fE.INFO,this.enableUploadLog_=!0,this.isAbleToUpload_=!1,this.checkURLParam(),Gw.on(Zw,(function(e){var n=e.client;-1===t.timeoutId_&&t.startUpload(),t.clients_.add(n)})),Gw.on(Qw,(function(e){var n=e.client;return t.clients_.delete(n)})),Gw.on(eA,(function(e){e&&lw(e.config)&&gE[e.config.logLevelToUpload]&&(t.logLevelToUpload_=e.config.logLevelToUpload)})),Gw.on(Bw,this.setIsAbleToUpload,this),Gw.on(Hw,this.setIsAbleToUpload,this)}var t,i;return c(e,[{key:"getIsAbleToUpload",value:function(){return this.isAbleToUpload_}},{key:"setIsAbleToUpload",value:function(){this.isAbleToUpload_=!0,Gw.off(Bw,this.setIsAbleToUpload,this),Gw.off(Hw,this.setIsAbleToUpload,this)}},{key:"startUpload",value:(i=o(n().mark((function e(){var t=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.upload();case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:this.timeoutId_=setTimeout((function(){return t.startUpload()}),2e3);case 8:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return i.apply(this,arguments)})},{key:"getLogsToUpload",value:function(){var e=this,t={map:new Map,splicedQueue:[]};if(this.queue_[0].forAllJoinedClients&&0===this.clients_.size)return t;for(var n=0,i=function(){if(50===n)return"break";var i=e.queue_[n];i.forAllJoinedClients?e.clients_.forEach((function(e){if(e.getIsJoined()){var n=e.getUserId(),r=e.getSDKAppId();t.map.has(n)?t.map.get(n).logs.push(i):t.map.set(n,{userId:n,sdkAppId:r,logs:[i]})}})):t.map.has(i.userId)?t.map.get(i.userId).logs.push(i):t.map.set(i.userId,{userId:i.userId,sdkAppId:i.sdkAppId,logs:[i]})};n<this.queue_.length&&"break"!==i();n++);return t.map.size>0&&(t.splicedQueue=this.queue_.splice(0,n)),t}},{key:"upload",value:(t=o(n().mark((function e(){var t,i,r,o,a,s,c,u,l,d;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.queue_.length&&this.isAbleToUpload_){e.next=2;break}return e.abrupt("return");case 2:if(t=this.getLogsToUpload(),i=t.map,r=t.splicedQueue,0!==i.size){e.next=5;break}return e.abrupt("return");case 5:e.prev=5,o=M(i.values()),a=0;case 8:if(!(a<o.length)){e.next=16;break}return s=o[a],c=s.userId,u=s.sdkAppId,l=s.logs,e.next=12,this.uploadLogWithRetry(JSON.stringify({timestamp:ov(),sdkAppId:String(u),userId:c,version:za,log:l.map((function(e){return e.log})).join("\n")}),u);case 12:l.forEach((function(e){return e.uploaded=!0}));case 13:a++,e.next=8;break;case 16:e.next=20;break;case 18:e.prev=18,e.t0=e.catch(5);case 20:(d=r.filter((function(e){return!e.uploaded}))).length>0&&(this.queue_=d.concat(this.queue_));case 22:case"end":return e.stop()}}),e,this,[[5,18]])}))),function(){return t.apply(this,arguments)})},{key:"uploadLogWithRetry",value:function(e,t){return RA({retryFunction:function(){return Pw({url:cw(t,bC),body:e,timeout:5e3})},settings:{retries:3,timeout:1e3},onError:function(e,t){t()}})()}},{key:"getPrefix",value:function(e){var t=new Date;return t.setTime(rv()),String.prototype.padStart?"[".concat(t.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1"),":").concat(t.getMilliseconds().toString().padStart(3,"0"),"] <").concat(gE[e],">"):"[".concat(t.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1"),":").concat(t.getMilliseconds(),"] <").concat(gE[e],">")}},{key:"getLogLevel",value:function(){return this.logLevel_}},{key:"setLogLevel",value:function(e){fw(gE[e])||(this.logLevel_!==e&&this.info("setLogLevel ".concat(e)),this.logLevel_=e)}},{key:"enableUploadLog",value:function(){this.enableUploadLog_=!0}},{key:"disableUploadLog",value:function(){this.enableUploadLog_=!1}},{key:"log",value:function(e){var t=e.log,n=e.level,i=e.forAllJoinedClients,r=void 0===i||i,o=e.userId,a=e.sdkAppId;t="".concat(this.getPrefix(n)," ").concat(t),this.enableUploadLog_&&n>=this.logLevelToUpload_&&this.queue_.push(new LA({log:t,level:n,userId:o,sdkAppId:a,forAllJoinedClients:r})),n<this.logLevel_||gE[n]&&gE[n].toLowerCase()}},{key:"debug",value:function(e){this.log({log:e,level:fE.DEBUG})}},{key:"info",value:function(e){this.log({log:e,level:fE.INFO})}},{key:"warn",value:function(e){this.log({log:e,level:fE.WARN})}},{key:"error",value:function(e){this.log({log:e,level:fE.ERROR})}},{key:"createLogger",value:function(e){return new OA(e)}},{key:"checkURLParam",value:function(){var e=new URLSearchParams(location.search).get("logLevelToUpload");gE[e]&&(this.logLevelToUpload_=e)}}]),e}(),PA=new NA,UA=!0,xA=Ie,GA=Math.floor,FA=Number.isInteger||function(e){return!xA(e)&&isFinite(e)&&GA(e)===e};Er({target:"Number",stat:!0},{isInteger:FA});var VA,qA=Er,BA=te,HA=A.f,jA=Pi,KA=sd,zA=W_,WA=le,YA=$_,$A=BA("".startsWith),JA=BA("".slice),XA=Math.min,ZA=YA("startsWith");qA({target:"String",proto:!0,forced:!(!ZA&&(VA=HA(String.prototype,"startsWith"),VA&&!VA.writable)||ZA)},{startsWith:function(e){var t=KA(WA(this));zA(e);var n=jA(XA(arguments.length>1?arguments[1]:void 0,t.length)),i=KA(e);return $A?$A(t,i,n):JA(t,n,n+i.length)===i}});var QA=L,eR=te,tR=U,nR=R,iR=Ja,rR=Zi,oR=x,aR=pt,sR=ae,cR=Object.assign,uR=Object.defineProperty,lR=eR([].concat),dR=!cR||nR((function(){if(QA&&1!==cR({b:1},cR(uR({},"a",{enumerable:!0,get:function(){uR(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach((function(e){t[e]=e})),7!=cR({},e)[n]||iR(cR({},t)).join("")!=i}))?function(e,t){for(var n=aR(e),i=arguments.length,r=1,o=rR.f,a=oR.f;i>r;)for(var s,c=sR(arguments[r++]),u=o?lR(iR(c),o(c)):iR(c),l=u.length,d=0;l>d;)s=u[d++],QA&&!tR(a,c,s)||(n[s]=c[s]);return n}:cR,pR=dR;Er({target:"Object",stat:!0,arity:2,forced:Object.assign!==pR},{assign:pR});var hR=te,fR=Ye,gR=Ie,mR=gt,vR=Kd,_R=O,yR=Function,IR=hR([].concat),MR=hR([].join),TR={},CR=function(e,t,n){if(!mR(TR,t)){for(var i=[],r=0;r<t;r++)i[r]="a["+r+"]";TR[t]=yR("C,a","return new C("+MR(i,",")+")")}return TR[t](e,n)},SR=_R?yR.bind:function(e){var t=fR(this),n=t.prototype,i=vR(arguments,1),r=function(){var n=IR(i,vR(arguments));return this instanceof r?CR(t,n.length,n):t.apply(e,n)};return gR(n)&&(r.prototype=n),r},ER=SR;Er({target:"Function",proto:!0,forced:Function.bind!==ER},{bind:ER});var kR=Er,bR=mo.findIndex,DR=Es,wR="findIndex",AR=!0;wR in[]&&Array(1).findIndex((function(){AR=!1})),kR({target:"Array",proto:!0,forced:AR},{findIndex:function(e){return bR(this,e,arguments.length>1?arguments[1]:void 0)}}),DR(wR);var RR=L,LR=te,OR=Ja,NR=he,PR=LR(x.f),UR=LR([].push),xR=function(e){return function(t){for(var n,i=NR(t),r=OR(i),o=r.length,a=0,s=[];o>a;)n=r[a++],RR&&!PR(i,n)||UR(s,e?[n,i[n]]:i[n]);return s}},GR=(xR(!0),xR(!1));Er({target:"Object",stat:!0},{values:function(e){return GR(e)}});var FR=1,VR=5,qR=2,BR=3,HR=4,jR="DISCONNECTED",KR="CONNECTING",zR="RECONNECTING",WR="CONNECTED",YR={CLIENT_BANNED:9,CHANNEL_SETUP_RESULT:19,CHANNEL_RECONNECT_RESULT:514,JOIN_ROOM_RESULT:20,PEER_JOIN:4134,PEER_LEAVE:4135,STREAM_ADDED:16,STREAM_REMOVED:18,UPLINK_NETWORK_STATS:22,UPDATE_REMOTE_MUTE_STAT:23,PUBLISH_RESULT:4098,PUBLISH_STATE_CHANGE_RESULT:4112,UNPUBLISH_RESULT:4100,SUBSCRIBE_RESULT:4102,UNSUBSCRIBE_RESULT:4104,SUBSCRIBE_CHANGE_RESULT:4106,MUTE_RESULT:4108,UPDATE_OFFER_RESULT:4128,START_PUBLISH_TENCENT_CDN_RES:1286,STOP_PUBLISH_TENCENT_CDN_RES:1288,START_PUBLISH_GIVEN_CDN_RES:777,STOP_PUBLISH_GIVEN_CDN_RES:779,START_MIX_TRANSCODE_RES:781,STOP_MIX_TRANSCODE_RES:783,USER_LIST_RES:4137,SWITCH_ROLE_RES:4110,UPDATE_CONSTRAINT_CONFIG_RES:772},$R=[YR.UPDATE_REMOTE_MUTE_STAT,YR.UPLINK_NETWORK_STATS,YR.USER_LIST_RES,YR.MUTE_RESULT],JR={CLIENT_BANNED:"client-banned",CHANNEL_SETUP_RESULT:"channel-setup-result",CHANNEL_RECONNECT_RESULT:"channel-reconnect-result",JOIN_ROOM_RESULT:"join-room-result",PEER_JOIN:"peer-join",PEER_LEAVE:"peer-leave",STREAM_ADDED:"stream-added",STREAM_REMOVED:"stream-removed",UPLINK_NETWORK_STATS:"uplink-network-stats",UPDATE_REMOTE_MUTE_STAT:"update-remote-mute-stat",PUBLISH_RESULT:"publish-result",PUBLISH_STATE_CHANGE_RESULT:"publish-state-change-result",UNPUBLISH_RESULT:"unpublish-result",SUBSCRIBE_RESULT:"subscribe-result",SUBSCRIBE_CHANGE_RESULT:"subscribe-change-result",UNSUBSCRIBE_RESULT:"unsubscribe-result",UPDATE_OFFER_RESULT:"update-offer-result",START_PUBLISH_TENCENT_CDN_RES:"start-publish-tencent-cdn-res",STOP_PUBLISH_TENCENT_CDN_RES:"stop-publish-tencent-cdn-res",START_PUBLISH_GIVEN_CDN_RES:"start-publish-given-cdn-res",STOP_PUBLISH_GIVEN_CDN_RES:"stop-publish-given-cdn-res",START_MIX_TRANSCODE_RES:"start-mix-transcode-res",STOP_MIX_TRANSCODE_RES:"stop-mix-transcode-res",USER_LIST_RES:"user-list-res",SWITCH_ROLE_RES:"switch_role_res",MUTE_RESULT:"mute-result",UPDATE_CONSTRAINT_CONFIG_RES:"update-contraint-config-res"},XR="publish_change",ZR="publish_state_change",QR="join",eL="leave",tL="quality_report",nL="mute_uplink",iL="publish",rL="unpublish",oL="subscribe",aL="unsubscribe",sL="subscribe_change",cL="start_publishing",uL="stop_publishing",lL="start_push_user_cdn",dL="stop_push_user_cdn",pL="start_mcu_mix",hL="stop_mcu_mix",fL="get_user_list",gL="change_role",mL="update_constraint_config",vL={INVALID_PARAMETER:4096,INVALID_OPERATION:4097,NOT_SUPPORTED:4098,DEVICE_NOT_FOUND:4099,INITIALIZE_FAILED:4100,SIGNAL_CHANNEL_SETUP_FAILED:16385,SIGNAL_CHANNEL_ERROR:16386,ICE_TRANSPORT_ERROR:16387,JOIN_ROOM_FAILED:16388,CREATE_OFFER_FAILED:16389,SIGNAL_CHANNEL_RECONNECTION_FAILED:16390,UPLINK_RECONNECTION_FAILED:16391,DOWNLINK_RECONNECTION_FAILED:16392,REMOTE_STREAM_NOT_EXIST:16400,CLIENT_BANNED:16448,SERVER_TIMEOUT:16449,SUBSCRIPTION_TIMEOUT:16450,PLAY_NOT_ALLOWED:16451,DEVICE_AUTO_RECOVER_FAILED:16452,START_PUBLISH_CDN_FAILED:16453,STOP_PUBLISH_CDN_FAILED:16454,START_MIX_TRANSCODE_FAILED:16455,STOP_MIX_TRANSCODE_FAILED:16456,NOT_SUPPORTED_H264:16457,SWITCH_ROLE_FAILED:16458,API_CALL_TIMEOUT:16459,SCHEDULE_FAILED:16460,API_CALL_ABORTED:16461,UNKNOWN:65535},_L=function(e){l(n,e);var t=v(n);function n(e){var i,r=e.name,o=void 0===r?"RtcError":r,s=e.message,c=e.code,u=void 0===c?vL.UNKNOWN:c,l=e.extraCode,d=void 0===l?0:l,p=e.constraint;a(this,n);var h="<".concat(function(e){for(var t in vL)if(vL[t]===e)return t;return"UNKNOWN"}(u)," 0x").concat(u.toString(16),">");return(i=t.call(this,s+"".concat(p?" constraint: ".concat(p):"")+"".concat(null!=s&&s.includes(h)?"":" "+h))).code_=u,i.extraCode_=d,i.name=o,i.message_=s,p&&(i.constraint=p),i}return c(n,[{key:"getCode",value:function(){return this.code_}},{key:"getExtraCode",value:function(){return this.extraCode_}}]),n}(g(Error)),yL=32768,IL=32769,ML=32770,TL=32771,CL=32772,SL=32773,EL=32774,kL=32775,bL=32777,DL=32778,wL=32779,AL=32780,RL=32781,LL=32782,OL=32783,NL=32784,PL=32785,UL=32786,xL=32787,GL=32788,FL=32789,VL=32790,qL=32791,BL=32792,HL=32793,jL=32794,KL=32795,zL=32796,WL=32797,YL=32798,$L=32799,JL=32800,XL=32801,ZL=32802,QL=32803,eO=32804,tO=new Map,nO=function(e,t){var n=tO.get(e);n||(tO.set(e,[]),n=tO.get(e)),n.push(t)},iO=function(e){var t=tO.get(e),n=[];return t?(tO.delete(e),n=t.map((function(e){return{uint32_event_id:e.eventId,uint64_date:e.timestamp,str_userid:e.remoteUserId,str_event_json:e.eventDesc}}))):n=[],n},rO=Object.prototype.hasOwnProperty;function oO(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(lw(e))switch(Object.prototype.toString.call(e)){case"[object File]":case"[object Map]":case"[object Set]":return 0===e.size;case"[object Object]":for(var t in e)if(rO.call(e,t))return!1;return!0}return!1}var aO=function(){function e(){a(this,e);var t=nw(),n=t.name,i=t.version;this.roomIdMap_=new Map,this.configs_={sdkAppId:"",userId:"",version:za,env:CC,browserVersion:n+i,ua:navigator.userAgent}}return c(e,[{key:"setConfig",value:function(e){var t=e.sdkAppId,n=e.env,i=e.userId,r=e.roomId;t!==this.configs_.sdkAppId&&(this.configs_.sdkAppId=String(t)),this.configs_.env=n,this.configs_.userId=i,this.roomIdMap_.set(i,String(r))}},{key:"logEvent",value:function(e){if(!QD){var n=t(t(t({},e),this.configs_),{},{userId:e.userId||this.configs_.userId});fw(n.code)&&(n.code="failed"===n.result?vL.UNKNOWN:0),this.sendRequest(cw(this.configs_.sdkAppId,DC),n)}}},{key:"logSuccessEvent",value:function(e){QD||(this.logEvent(t(t({},e),{},{result:"success",roomId:this.roomIdMap_.get(e.userId)})),this.configs_.env===CC&&this.uploadEventToKibana(t(t({},e),{},{result:"success"})))}},{key:"logFailedEvent",value:function(e){if(!QD){var n=e.eventType,i=e.code,r=e.error,o=e.userId,a={roomId:this.roomIdMap_.get(o),userId:o,eventType:n,result:"failed",code:i||(r instanceof _L?r.getExtraCode()||r.getCode():vL.UNKNOWN)};this.logEvent(a),this.configs_.env===CC&&this.uploadEventToKibana(t(t({},a),{},{error:r}))}}},{key:"uploadEventToKibana",value:function(e){var t="stat-".concat(e.eventType,"-").concat(e.result);"delta-join"!==e.eventType&&"delta-leave"!==e.eventType&&"delta-publish"!==e.eventType||(t="".concat(e.eventType,":").concat(e.delta)),this.uploadEvent({log:t,userId:e.userId}),"failed"===e.result&&(t="stat-".concat(e.eventType,"-").concat(e.result,"-").concat(e.code),this.uploadEvent({log:t,userId:e.userId,error:e.error}))}},{key:"uploadEvent",value:function(e){var t=e.log,n=e.userId,i=e.error,r={timestamp:ov(),sdkAppId:this.configs_.sdkAppId,userId:n||this.configs_.userId,version:this.configs_.version,log:t};i&&(r.errorInfo=i.message),this.sendRequest(cw(this.configs_.sdkAppId,bC),r)}},{key:"sendRequest",value:function(e,t){var n=this;PA.getIsAbleToUpload()?Pw({url:e,body:JSON.stringify(t)}).catch((function(){})):setTimeout((function(){n.sendRequest(e,t)}),1e3)}}]),e}(),sO=new aO,cO=function(){function e(t){a(this,e),this.client_=t.client,this.sdkAppId_=t.sdkAppId,this.userId_=t.userId,this.userSig_=t.userSig,this.url_=t.url,this.backupUrl_=t.backupUrl;var n="?sdkAppId=".concat(encodeURIComponent(this.sdkAppId_),"&userId=").concat(encodeURIComponent(this.userId_),"&userSig=").concat(encodeURIComponent(this.userSig_));this.urlWithParam_="".concat(this.url_).concat(n),this.backupUrlWithParam_="".concat(this.backupUrl_).concat(n),this.isConnected_=!1,this.isConnecting_=!1,this.socketInUse_=null,this.socket_=null,this.backupSocket_=null,this.backupTimer_=-1,this.signalInfo_={},this.currentState_=jR,this.reconnectionCount_=0,this.reconnectionTimer_=-1,this.lastMessageTime_=-1,this.seq_=0,this.log_=PA.createLogger({id:"ws|"+this.userId_,userId:this.userId_,sdkAppId:this.sdkAppId_}),this.emitter_=new xw}return c(e,[{key:"isOnline",get:function(){return this.currentState_===WR&&Date.now()-this.lastMessageTime_<12e3}},{key:"connect",value:function(){var e=this;return new Promise((function(t,n){e.log_.info("connect to url: ".concat(e.urlWithParam_)),e.emitConnectionStateChanged(KR),e.socket_=new WebSocket(e.urlWithParam_),e.bindSocket(e.socket_),e.backupTimer_=setTimeout((function(){e.isConnected_||(e.log_.info("trying to connect to backupUrl"),e.tryConnectBackup())}),5e3),e.once(BR,t),e.once(HR,n)}))}},{key:"tryConnectBackup",value:function(){this.backupSocket_||(this.unbindAndCloseSocket(rC),this.log_.debug("try to connect to url: ".concat(this.backupUrlWithParam_)),this.backupSocket_=new WebSocket(this.backupUrlWithParam_),this.bindSocket(this.backupSocket_))}},{key:"bindSocket",value:function(e){e.onopen=this.onopen.bind(this),e.onclose=this.onclose.bind(this),e.onerror=this.onerror.bind(this),e.onmessage=this.onmessage.bind(this)}},{key:"unbindSocket",value:function(e){e.onopen=function(){},e.onclose=function(){},e.onerror=function(){},e.onmessage=function(){}}},{key:"unbindAndCloseSocket",value:function(e){if(e===rC){if(this.socket_){this.unbindSocket(this.socket_);try{this.socket_.close(1e3)}catch(oY){}this.socket_=null}}else if(this.backupSocket_){this.unbindSocket(this.backupSocket_);try{this.backupSocket_.close(1e3)}catch(oY){}this.backupSocket_=null}}},{key:"clearBackupTimer",value:function(){-1!==this.backupTimer_&&(clearTimeout(this.backupTimer_),this.backupTimer_=-1)}},{key:"clearReconnectionTimer",value:function(){-1!==this.reconnectionTimer_&&(clearTimeout(this.reconnectionTimer_),this.reconnectionTimer_=-1)}},{key:"onopen",value:function(e){if(!this.isConnected_){this.isConnected_=!0,this.isConnecting_=!1,this.isReconnecting_&&oO(this.signalInfo_)&&this.stopReconnection(),this.clearBackupTimer(),e.target===this.socket_?(this.unbindAndCloseSocket(oC),this.socketInUse_=this.socket_):(this.unbindAndCloseSocket(rC),this.socketInUse_=this.backupSocket_);var t=e.target.url;this.log_.info("websocket[".concat(t,"] is connected")),this.currentState_===KR?this.addSignalEvent(qL,"signal channel is connected"):this.currentState_===zR&&this.addSignalEvent(KL,"signal channel reconnect success"),this.emitConnectionStateChanged(WR),this.emitter_.emit(BR)}}},{key:"onclose",value:function(e){var t=e.target.url,n=e.target===this.socketInUse_;this.log_.info("websocket[".concat(t," InUse: ").concat(n,"] is closed with code: ").concat(e.code)),e.target===this.socketInUse_&&(this.isConnected_=!1,this.emitConnectionStateChanged(jR),this.addSignalEvent(VL,"signal channel is disconnected"),e.wasClean&&1e3===e.code||(this.log_.warn("onclose code:".concat(e.code," reason:").concat(e.reason)),this.log_.warn("close current websocket and schedule a reconnect timeout"),this.socketInUse_.onclose=function(){},this.socketInUse_.close(4011),this.socket_=this.backupSocket_=this.socketInUse_=null,this.reconnect(rC)))}},{key:"onerror",value:function(e){var t=e.target.url;this.log_.error("websocket[".concat(t,"] error observed")),this.isConnected_?e.target===this.socketInUse_&&(this.isConnected_=!1,this.unbindAndCloseSocket(rC),this.unbindAndCloseSocket(oC),this.socketInUse_=null,this.reconnect(rC)):(this.isReconnecting_||sO.logFailedEvent({userId:this.client_.getUserId(),eventType:IS,code:vL.UNKNOWN}),e.target==this.socket_?(this.unbindAndCloseSocket(rC),this.reconnect(oC)):(this.unbindAndCloseSocket(oC),this.reconnect(rC))),this.isConnecting_=!1,this.isConnected_=!1}},{key:"onmessage",value:function(e){if(this.isConnected_){this.lastMessageTime_=Date.now();var t=JSON.parse(e.data),n=t.cmd,i=t.data,r=Object.values(YR),o=Object.keys(YR)[r.indexOf(n)],a=JR[o];switch($R.includes(n)||(this.log_.debug("received msg: ".concat(e.data)),this.log_.info("Received event: [ ".concat(a||"unknown cmd: "+n," ]"))),n){case YR.CHANNEL_SETUP_RESULT:if(0===t.code)this.signalInfo_.clientIp=i.clientIp,this.signalInfo_.signalIp=i.signalInnerIp,this.signalInfo_.tinyId=t.tinyId,i.svrTime&&function(e){iv=e-(new Date).getTime();var t=new Date;t.setTime(e),PA.info("baseTime from server: "+t+" offset: "+iv)}(i.svrTime),this.log_.info("ChannelSetup Success"),sO.logSuccessEvent({userId:this.userId_,eventType:IS}),this.emitter_.emit(FR,{signalInfo:this.signalInfo_});else{var s=new _L({code:vL.SIGNAL_CHANNEL_SETUP_FAILED,extraCode:t.code,message:ow({key:FE,data:{errorCode:t.code,errorMsg:t.message}})});this.log_.error("".concat(t.code,", ").concat(t.message)),this.close(),sO.logFailedEvent({userId:this.userId_,eventType:IS,error:s}),this.emitter_.emit(VR,s)}break;case YR.JOIN_ROOM_RESULT:0===t.code&&(this.signalInfo_.relayIp=i.relayOuterIp,this.signalInfo_.relayInnerIp=i.relayInnerIp,this.signalInfo_.relayPort=i.relayPort,this.log_.info("signalIp:".concat(this.signalInfo_.signalIp," clientIp:").concat(this.signalInfo_.clientIp," relayIp: ").concat(this.signalInfo_.relayIp))),this.emitter_.emit(a,{data:t});break;case YR.CHANNEL_RECONNECT_RESULT:0===t.code?(this.log_.warn("reconnect success"),this.stopReconnection(),sO.logSuccessEvent({userId:this.userId_,eventType:MS}),this.client_.syncUserList(),this.client_.checkConnectionsToReconnect()):(this.log_.warn("reconnect failed, ".concat(t.code," ").concat(t.message)),this.client_.reJoin());break;default:this.emitter_.emit(a,{data:t})}}}},{key:"addSignalEvent",value:function(e,t){nO(this.userId_,{eventId:e,eventDesc:t,timestamp:rv(),userId:this.userId_,tinyId:this.signalInfo_.tinyId})}},{key:"reconnect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rC;if(this.isConnecting_||-1!==this.reconnectionTimer_)this.log_.info("signal channel is reconnecting, ignoring current reconnection");else{if(this.reconnectionCount_>=tS){this.log_.warn("SDK has tried reconnect signal channel for ".concat(tS," times, but all failed. please check your network"));var n=new _L({code:vL.SIGNAL_CHANNEL_RECONNECTION_FAILED,message:ow({key:GE})});return sO.logFailedEvent({userId:this.client_.getUserId(),eventType:MS,error:n}),this.addSignalEvent(zL,"signal channel reconnect fail"),void this.emitter_.emit(HR,n)}this.isConnecting_=!0,this.reconnectionCount_++,this.currentState_!==zR&&(this.emitConnectionStateChanged(zR),this.addSignalEvent(jL,"signal channel is reconnecting")),this.log_.warn("reconnecting to ".concat(t," signal channel [").concat(this.reconnectionCount_,"/").concat(tS,"]"));var i=this.getReconnectionUrl(t);t===rC?(this.socket_=new WebSocket(i),this.bindSocket(this.socket_)):(this.backupSocket_=new WebSocket(i),this.bindSocket(this.backupSocket_));var r=pw(this.reconnectionCount_);this.reconnectionTimer_=setTimeout((function(){e.log_.warn("reconnect ".concat(t," signal channel timeout(").concat(r/1e3,"s), close and try again")),e.isConnecting_=!1,e.clearReconnectionTimer(),e.unbindAndCloseSocket(t),e.reconnect(t===rC?oC:rC)}),r)}}},{key:"isConnected",value:function(){return this.isConnected_}},{key:"isReconnecting_",get:function(){return-1!==this.reconnectionTimer_}},{key:"getReconnectionUrl",value:function(e){var t=e===rC?this.urlWithParam_:this.backupUrlWithParam_;if(!oO(this.signalInfo_)&&-1===t.indexOf("&rc=1")){var n=this.client_.getRoomId(),i=this.client_.getUseStringRoomId();t+="&rc=1&relayInnerIp=".concat(this.signalInfo_.relayInnerIp,"&relayOuterIp=").concat(this.signalInfo_.relayIp,"&relayPort=").concat(this.signalInfo_.relayPort,"&roomId=").concat(n,"&useStringRoomId=").concat(i)}return t}},{key:"send",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.isConnected_){var n={cmd:e,data:t,userId:this.userId_,tinyId:this.signalInfo_.tinyId,seq:++this.seq_};return this.socketInUse_.send(JSON.stringify(n)),n.seq}}},{key:"sendWaitForResponse",value:function(e){var t=this,n=e.command,i=e.data,r=e.timeout,o=void 0===r?5e3:r,a=e.responseCommand,s=e.commandDesc,c=e.enableLog,u=void 0===c||c;return new Promise((function(e,r){var c=setTimeout((function(){t.off(a,l);var e=new _L({code:vL.API_CALL_TIMEOUT,message:ow({key:xE,data:{commandDesc:s,command:n}})});u&&t.log_.warn(e),r(e)}),o),l=function n(i){i.data.seq===d&&(clearTimeout(c),t.off(a,n),e(i))};t.on(a,l);var d=t.send(n,i)}))}},{key:"sendWaitForResponseWithRetry",value:function(){var e=this,t=arguments.length<=0?void 0:arguments[0],n=t.commandDesc,i=t.command,r=t.retries,o=void 0===r?0:r,a=t.retryTimeout,s=void 0===a?0:a;return RA({retryFunction:this.sendWaitForResponse,onRetrying:function(t){e.log_.warn("".concat(n||i," timeout observed, retrying [").concat(t,"/").concat(o,"]"))},settings:{retries:o,timeout:s},context:this}).apply(void 0,arguments)}},{key:"getCurrentState",value:function(){return this.currentState_}},{key:"getSignalInfo",value:function(){return this.signalInfo_}},{key:"stopReconnection",value:function(){this.isReconnecting_&&(this.reconnectionCount_=0,this.clearReconnectionTimer())}},{key:"close",value:function(){this.log_.info("close SignalChannel"),this.clearBackupTimer(),this.stopReconnection(),this.signalInfo_={},this.isConnecting_=!1,this.isConnected_=!1,this.socketInUse_=null,this.unbindAndCloseSocket(rC),this.unbindAndCloseSocket(oC),this.emitConnectionStateChanged(jR)}},{key:"on",value:function(e,t,n){this.emitter_.on(e,t,n)}},{key:"removeListener",value:function(e,t,n){this.emitter_.removeListener(e,t,n)}},{key:"once",value:function(e,t,n){this.emitter_.once(e,t,n)}},{key:"off",value:function(e,t,n){this.emitter_.off(e,t,n)}},{key:"emitConnectionStateChanged",value:function(e){e!==this.currentState_&&(this.emitter_.emit(qR,{prevState:this.currentState_,state:e}),this.currentState_=e)}}]),e}(),uO=Er,lO=mo.find,dO=Es,pO="find",hO=!0;pO in[]&&Array(1).find((function(){hO=!1})),uO({target:"Array",proto:!0,forced:hO},{find:function(e){return lO(this,e,arguments.length>1?arguments[1]:void 0)}}),dO(pO);var fO={},gO={},mO={exports:{}},vO=mO.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(vO).forEach((function(e){vO[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var o=e.push?{}:r?n[e.name]:n;!function(e,n,i,r){if(r&&!i)n[r]=t(e[1]);else for(var o=0;o<i.length;o+=1)null!=e[o+1]&&(n[i[o]]=t(e[o+1]))}(i.match(e.reg),o,e.names,e.name),e.push&&n[e.push].push(o)},i=mO.exports,r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach((function(e){var t=e[0],r=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),a=o[o.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(r))return n(c,a,r)}})),t.media=o,t};var o=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),r=0;r<i.length;r+=3)n.push({component:i[r],ip:i[r+1],port:i[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}}))}))}}(gO);var _O=mO.exports,yO=/%[sdv%]/g,IO=function(e){var t=1,n=arguments,i=n.length;return e.replace(yO,(function(e){if(t>=i)return e;var r=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}}))},MO=function(e,t,n){var i=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var r=0;r<t.names.length;r+=1){var o=t.names[r];t.name?i.push(n[t.name][o]):i.push(n[t.names[r]])}else i.push(n[t.name]);return IO.apply(null,i)},TO=["v","o","s","i","u","e","p","c","b","t","r","z","a"],CO=["i","c","b","a"],SO=gO,EO=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var n=t.outerOrder||TO,i=t.innerOrder||CO,r=[];return n.forEach((function(t){_O[t].forEach((function(n){n.name in e&&null!=e[n.name]?r.push(MO(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){r.push(MO(t,n,e))}))}))})),e.media.forEach((function(e){r.push(MO("m",_O.m[0],e)),i.forEach((function(t){_O[t].forEach((function(n){n.name in e&&null!=e[n.name]?r.push(MO(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){r.push(MO(t,n,e))}))}))}))})),r.join("\r\n")+"\r\n"};fO.write=EO,fO.parse=SO.parse,fO.parseParams=SO.parseParams,fO.parseFmtpConfig=SO.parseFmtpConfig,fO.parsePayloads=SO.parsePayloads,fO.parseRemoteCandidates=SO.parseRemoteCandidates,fO.parseImageAttributes=SO.parseImageAttributes,fO.parseSimulcastStreamList=SO.parseSimulcastStreamList;var kO=function(e){return fO.parse(e)},bO=function(e){return fO.write(e)},DO=function(e){var t=kO(e);return t.media.forEach((function(e){e.type===xT&&e.fmtp.forEach((function(e){e.config+=";sprop-stereo=1;stereo=1"}))})),bO(t)};function wO(e){var t=kO(e);return t.media.forEach((function(e){if(e.type===GT){var t=new Set;e.rtp.forEach((function(e){var n=e.payload;return"H264"===e.codec&&t.add(n)})),e.fmtp.forEach((function(e){var n=e.payload,i=e.config.match(/apt=(\d+)/);i&&i[1]&&t.has(Number(i[1]))&&t.add(n)}));var n=function(e){var n=e.payload;return!t.has(n)};e.rtp=e.rtp.filter(n),e.rtcpFb=e.rtcpFb.filter(n),e.fmtp=e.fmtp.filter(n),e.payloads=e.payloads.split(" ").filter((function(e){return!t.has(Number(e))})).join(" ")}})),bO(t)}var AO,RO,LO,OO,NO=Er,PO=te,UO=Di,xO=o_,GO=_h,FO=R,VO=RangeError,qO=String,BO=Math.floor,HO=PO(GO),jO=PO("".slice),KO=PO(1..toFixed),zO=function(e,t,n){return 0===t?n:t%2==1?zO(e,t-1,n*e):zO(e*e,t/2,n)},WO=function(e,t,n){for(var i=-1,r=n;++i<6;)r+=t*e[i],e[i]=r%1e7,r=BO(r/1e7)},YO=function(e,t){for(var n=6,i=0;--n>=0;)i+=e[n],e[n]=BO(i/t),i=i%t*1e7},$O=function(e){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==e[t]){var i=qO(e[t]);n=""===n?i:n+HO("0",7-i.length)+i}return n};NO({target:"Number",proto:!0,forced:FO((function(){return"0.000"!==KO(8e-5,3)||"1"!==KO(.9,0)||"1.25"!==KO(1.255,2)||"1000000000000000128"!==KO(0xde0b6b3a7640080,0)}))||!FO((function(){KO({})}))},{toFixed:function(e){var t,n,i,r,o=xO(this),a=UO(e),s=[0,0,0,0,0,0],c="",u="0";if(a<0||a>20)throw VO("Incorrect fraction digits");if(o!=o)return"NaN";if(o<=-1e21||o>=1e21)return qO(o);if(o<0&&(c="-",o=-o),o>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(o*zO(2,69,1))-69)<0?o*zO(2,-t,1):o/zO(2,t,1),n*=4503599627370496,(t=52-t)>0){for(WO(s,0,n),i=a;i>=7;)WO(s,1e7,0),i-=7;for(WO(s,zO(10,i,1),0),i=t-1;i>=23;)YO(s,1<<23),i-=23;YO(s,1<<i),WO(s,1,1),YO(s,2),u=$O(s)}else WO(s,0,n),WO(s,1<<-t,0),u=$O(s)+HO("0",a);return a>0?c+((r=u.length)<=a?"0."+HO("0",a-r)+u:jO(u,0,r-a)+"."+jO(u,r-a)):c+u}});var JO=(null===(AO=window)||void 0===AO?void 0:AO.requestIdleCallback)||function(e){var t=Date.now();return setTimeout((function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})}),1e3)},XO=(null===(RO=window)||void 0===RO?void 0:RO.cancelIdleCallback)||function(e){clearTimeout(e)},ZO=(null===(LO=window)||void 0===LO?void 0:LO.cancelAnimationFrame)||(null===(OO=window)||void 0===OO?void 0:OO.mozCancelAnimationFrame),QO=function(){function e(){a(this,e)}return c(e,null,[{key:"generateTaskID",value:function(){return this.currentTaskID++}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ME,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;i=t(t({},e===IE?{delay:2e3,count:0,backgroundTask:!0}:e===_E?{delay:1e4,count:0}:e===yE?{fps:60,delay:16.6,count:0,backgroundTask:!0}:{delay:2e3,count:0,backgroundTask:!0}),i),_w(n)&&(i=t(t({},i),n)),hw(e)&&(n=e,e=ME);var r=t({taskID:this.generateTaskID(),loopCount:0,intervalID:null,timeoutID:null,rafID:null,ricID:null,taskName:e,callback:n},i);return this.taskMap.set(r.taskID,r),this[e](r),r.taskID}},{key:"interval",value:function(e){var t=this;return e.intervalID=setInterval((function(){e.callback(),e.loopCount+=1,t.isBreakLoop(e)}),e.delay)}},{key:"timeout",value:function(e){var t=this;return e.timeoutID=setTimeout((function n(){if(e.callback(),e.loopCount+=1,!t.isBreakLoop(e))return e.timeoutID=setTimeout(n,e.delay)}),e.delay)}},{key:"ric",value:function(e){var t,n=this,i=Cw();return e.ricID=JO((function r(){if((t=Cw()-i)>=e.delay&&(i=Cw()-Math.floor(t%e.delay),e.callback(),e.loopCount+=1),!n.isBreakLoop(e))return e.ricID=JO(r,{timeout:e.delay})}),{timeout:e.delay})}},{key:"raf",value:function(e){var t=this;e.delay=(1e3/e.fps).toFixed(2);var n,i=Cw(),r=function r(){if(document.hidden&&e.backgroundTask){if(n=Cw()-i,i=Cw(),e.callback(),e.loopCount+=1,t.isBreakLoop(e))return;return e.timeoutID=setTimeout(r,e.delay-Math.floor(n%e.delay))}if((n=Cw()-i)>=e.delay&&(i=Cw()-Math.floor(n%e.delay),e.callback(),e.loopCount+=1),!t.isBreakLoop(e))return e.rafID=requestAnimationFrame(r)};if(e.rafID=requestAnimationFrame(r),e.backgroundTask){var o=function(){if(document.hidden){var t=Cw()-i;t>=e.delay?r():e.timeoutID=setTimeout(r,e.delay-t)}};document.addEventListener("visibilitychange",o),e.onVisibilitychange=o,document.hidden&&o()}return e.taskID}},{key:"hasTask",value:function(e){return this.taskMap.has(e)}},{key:"clearTask",value:function(e){if(!this.taskMap.has(e))return!0;var t=this.taskMap.get(e),n=t.intervalID,i=t.timeoutID,r=t.rafID,o=t.ricID,a=t.onVisibilitychange;return n&&clearInterval(n),i&&clearTimeout(i),r&&ZO(r),o&&XO(o),a&&document.removeEventListener("visibilitychange",a),this.taskMap.delete(e),!0}},{key:"isBreakLoop",value:function(e){return!this.taskMap.has(e.taskID)||0!==e.count&&e.loopCount>=e.count&&(this.clearTask(e.taskID),!0)}}]),e}();u(QO,"taskMap",new Map),u(QO,"currentTaskID",1);var eN=function(){function e(){a(this,e),this.prefix_="TRTC",this.queue_=new Map,this.checkStorage()}return c(e,[{key:"getRealKey",value:function(e){return"".concat(this.prefix_,"_").concat(e)}},{key:"checkStorage",value:function(){var e=this;ew()&&Object.keys(localStorage).filter((function(t){if(t.startsWith(e.prefix_)){var n=JSON.parse(localStorage.getItem(t));if(n&&n.expiresIn<Date.now())return!0}return!1})).forEach((function(e){return localStorage.removeItem(e)}))}},{key:"doFlush",value:function(){if(ew())try{var e,t=E(this.queue_);try{for(t.s();!(e=t.n()).done;){var n=I(e.value,2),i=n[0],r=n[1];localStorage.setItem(i,JSON.stringify(r))}}catch(o){t.e(o)}finally{t.f()}}catch(oY){PA.warn(oY)}}},{key:"getItem",value:function(e){if(!ew())return null;try{var t=JSON.parse(localStorage.getItem(this.getRealKey(e)));return t&&t.expiresIn>=Date.now()?t.value:null}catch(oY){PA.warn(oY)}}},{key:"setItem",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(ew())try{var i={expiresIn:Date.now()+WS,value:t};n?localStorage.setItem(this.getRealKey(e),JSON.stringify(i)):(this.queue_.set(this.getRealKey(e),i),QO.hasTask(this.intervalId_)||(this.intervalId_=QO.run(_E,this.doFlush.bind(this),{count:1})))}catch(oY){PA.warn(oY)}}},{key:"deleteItem",value:function(e){if(!ew())return!1;try{return e=this.getRealKey(e),this.queue_.delete(e),localStorage.removeItem(e),!0}catch(oY){return PA.warn(oY),!1}}},{key:"clear",value:function(){if(ew())try{localStorage.clear()}catch(oY){PA.warn(oY)}}}]),e}(),tN=new eN,nN={result:!1,detail:{isBrowserSupported:!1,isWebRTCSupported:!1,isMediaDevicesSupported:!1,isH264EncodeSupported:!1,isVp8EncodeSupported:!1,isH264DecodeSupported:!1,isVp8DecodeSupported:!1}},iN="checkResult",rN=function(){return!(wD||tD||iD&&rD<80||Qb&&eD<56)},oN=function(){return["RTCPeerConnection","webkitRTCPeerConnection","RTCIceGatherer"].filter((function(e){return e in window})).length>0},aN=function(){if(!navigator.mediaDevices)return!1;var e=["getUserMedia","enumerateDevices"];return e.filter((function(e){return e in navigator.mediaDevices})).length===e.length},sN=function(){var e=o(n().mark((function e(){var t,i,r,o,a,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!nN.detail.isH264EncodeSupported||!nN.detail.isVp8EncodeSupported){e.next=2;break}return e.abrupt("return",{isH264EncodeSupported:nN.detail.isH264EncodeSupported,isVp8EncodeSupported:nN.detail.isVp8EncodeSupported});case 2:return t="",i=!1,r=!1,e.prev=5,o=new RTCPeerConnection,(a=document.createElement(UT)).getContext("2d"),s=a.captureStream(0),o.addTrack(s.getVideoTracks()[0],s),e.next=13,o.createOffer();case 13:return-1!==(t=e.sent).sdp.toLowerCase().indexOf("h264")&&(i=!0),-1!==t.sdp.toLowerCase().indexOf("vp8")&&(r=!0),o.close(),nN.detail.isH264EncodeSupported=i,nN.detail.isVp8EncodeSupported=r,e.abrupt("return",{isH264EncodeSupported:nN.detail.isH264EncodeSupported,isVp8EncodeSupported:nN.detail.isVp8EncodeSupported});case 22:return e.prev=22,e.t0=e.catch(5),e.abrupt("return",{isH264EncodeSupported:!1,isVp8EncodeSupported:!1});case 25:case"end":return e.stop()}}),e,null,[[5,22]])})));return function(){return e.apply(this,arguments)}}();function cN(){return uN.apply(this,arguments)}function uN(){return uN=o(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=o(n().mark((function e(t){var i,r,a,s,c,u,l,d,p,h,f,g,m,v;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={encode:!1,decode:!1},r=null,e.prev=2,a=document.createElement("canvas"),s=a.getContext("2d"),a.width=640,a.height=480,c=setInterval((function(){s.fillText("test",Math.floor(640*Math.random()),Math.floor(480*Math.random()))}),33),u=-1,l=-1,r=function(){clearInterval(u),clearInterval(c),clearTimeout(l),p.close(),h.close(),d.getTracks().forEach((function(e){return e.stop()}))},l=setTimeout((function(){r(),t(i)}),3e3),d=a.captureStream(),p=new RTCPeerConnection({}),h=new RTCPeerConnection({offerToReceiveAudio:!0,offerToReceiveVideo:!0}),p.addEventListener("icecandidate",(function(e){return h.addIceCandidate(e.candidate)})),h.addEventListener("icecandidate",(function(e){return p.addIceCandidate(e.candidate)})),p.addTrack(d.getVideoTracks()[0],d),e.next=20,p.createOffer();case 20:return f=e.sent,e.next=23,p.setLocalDescription(f);case 23:return e.next=25,h.setRemoteDescription(f);case 25:return e.next=27,h.createAnswer();case 27:return g=e.sent,m=kO(g.sdp),v=m.media[0].rtp.findIndex((function(e){return"H264"===e.codec})),m.media[0].rtp=[m.media[0].rtp[v]],m.media[0].fmtp=m.media[0].fmtp.filter((function(e){return e.payload===m.media[0].rtp[0].payload})),m.media[0].rtcpFb=m.media[0].rtcpFb.filter((function(e){return e.payload===m.media[0].rtp[0].payload})),g.sdp=bO(m),e.next=36,h.setLocalDescription(g);case 36:return e.next=38,p.setRemoteDescription(g);case 38:u=setInterval(o(n().mark((function e(){var o,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.encode&&i.decode&&(r(),t(i)),e.next=3,p.getStats();case 3:return o=e.sent,e.next=6,h.getStats();case 6:a=e.sent,i.encode||o.forEach((function(e){"outbound-rtp"===e.type&&e.mediaType===GT&&e.framesEncoded>0&&(i.encode=!0)})),i.decode||a.forEach((function(e){"inbound-rtp"===e.type&&e.mediaType===GT&&e.framesDecoded>0&&(i.decode=!0)}));case 9:case"end":return e.stop()}}),e)}))),500),e.next=46;break;case 41:e.prev=41,e.t0=e.catch(2),r(),PA.warn(e.t0),t(i);case 46:case"end":return e.stop()}}),e,null,[[2,41]])})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),uN.apply(this,arguments)}var lN=function(){var e=o(n().mark((function e(){var t,i,r,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!nN.detail.isH264DecodeSupported||!nN.detail.isVp8DecodeSupported){e.next=2;break}return e.abrupt("return",{isH264DecodeSupported:nN.detail.isH264DecodeSupported,isVp8DecodeSupported:nN.detail.isVp8DecodeSupported});case 2:return t="",i=!1,r=!1,e.prev=5,o=new RTCPeerConnection,e.next=9,o.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1});case 9:return-1!==(t=e.sent).sdp.toLowerCase().indexOf("h264")&&(i=!0),-1!==t.sdp.toLowerCase().indexOf("vp8")&&(r=!0),o.close(),e.abrupt("return",{isH264DecodeSupported:i,isVp8DecodeSupported:r});case 16:return e.prev=16,e.t0=e.catch(5),e.abrupt("return",{isH264DecodeSupported:!1,isVp8DecodeSupported:!1});case 19:case"end":return e.stop()}}),e,null,[[5,16]])})));return function(){return e.apply(this,arguments)}}(),dN=function(){var e=o(n().mark((function e(){var t,i,r,o,a,s,c,u,l,d,p,h,f;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(hN()){e.next=2;break}return e.abrupt("return",nN);case 2:return t=rN(),i=oN(),r=aN(),e.next=7,sN();case 7:return o=e.sent,a=o.isH264EncodeSupported,s=o.isVp8EncodeSupported,e.next=12,lN();case 12:if(c=e.sent,u=c.isH264DecodeSupported,l=c.isVp8DecodeSupported,a&&s){e.next=21;break}return e.next=18,sN();case 18:d=e.sent,a=d.isH264EncodeSupported,s=d.isVp8EncodeSupported;case 21:if(!(a&&u&&(xD||FD||YD)&&!uD&&qD()<79)){e.next=29;break}return e.next=24,cN();case 24:p=e.sent,h=p.encode,f=p.decode,a=h,u=f;case 29:return nN.result=t&&i&&r&&(a||s)&&(u||l),nN.detail.isBrowserSupported=t,nN.detail.isWebRTCSupported=i,nN.detail.isMediaDevicesSupported=r,nN.detail.isH264EncodeSupported=a,nN.detail.isVp8EncodeSupported=s,nN.detail.isH264DecodeSupported=u,nN.detail.isVp8DecodeSupported=l,fN(),tN.setItem(iN,{ua:navigator.userAgent,checkResult:nN},!0),e.abrupt("return",nN);case 40:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),pN=function(e,t){var n=null;return function(){if(n)return n;for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(n=e.apply(t||this,r)).then((function(e){return n=null,e})).catch((function(e){throw n=null,e})),n}}(dN);function hN(){return Object.keys(nN.detail).findIndex((function(e){return!nN.detail[e]}))>=0}function fN(){hN()&&(PA.warn(ow({key:lb})),PA.info("".concat(navigator.userAgent," ").concat(JSON.stringify(nN.detail))))}function gN(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)}function mN(){return"RTCPeerConnection"in window&&"getReceivers"in window.RTCPeerConnection.prototype}function vN(){return"RTCPeerConnection"in window&&"getSenders"in window.RTCPeerConnection.prototype}function _N(){return"RTCPeerConnection"in window&&"getTransceivers"in window.RTCPeerConnection.prototype}function yN(){return"RTCPeerConnection"in window&&"addTransceiver"in window.RTCPeerConnection.prototype}function IN(){return"RTCRtpSender"in window&&"replaceTrack"in window.RTCRtpSender.prototype}function MN(){return"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype&&vN()}function TN(){return!!fw(navigator.mediaDevices)&&(PA.error(Pb.NOT_SUPPORTED_MEDIA),!0)}function CN(){return"http:"===location.protocol&&!QD&&(PA.warn(ow({key:ub})),!0)}var SN="RTCRtpSender"in window&&"createEncodedStreams"in window.RTCRtpSender.prototype&&qD()>=86;function EN(e){return!("candidate-pair"!==e.type||!e.nominated||"in-progress"!==e.state&&"succeeded"!==e.state||vw(e.selected)&&!e.selected)}var kN=new Map([[Zb,"Android"],[Xb,"iOS"],[kD,"Windows"],[bD,"MacOS"],[DD,"Linux"]]);function bN(){var e="unknown";return kN.get(!0)&&(e=kN.get(!0)),e}function DN(){var e="";return screen.width&&(e+=(screen.width?screen.width*window.devicePixelRatio:"")+" * "+(screen.height?screen.height*window.devicePixelRatio:"")),e}function wN(){var e=!1;return(navigator.getUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)&&(e=!0),e}function AN(){for(var e={isSupported:!1},t=["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"],n=0;n<t.length;n++)if(t[n]in window){e.isSupported=!0;break}return e.isSupported}function RN(){return!(gD&&qD()<86||Xb&&mw($D)&&$D<15||jD&&jD<63||!rN()||!("captureStream"in HTMLCanvasElement.prototype))}var LN=window.MediaStreamTrack&&"getSettings"in MediaStreamTrack.prototype,ON=window.MediaStreamTrack&&"getCapabilities"in MediaStreamTrack.prototype,NN=function(){var e,t,n;return(null===(e=window)||void 0===e?void 0:e.OffscreenCanvas)&&(null===(t=window)||void 0===t?void 0:t.MediaStreamTrackProcessor)&&(null===(n=window)||void 0===n?void 0:n.MediaStreamTrackGenerator)};!function(){CN();var e=tN.getItem(iN);e&&e.ua===navigator.userAgent&&(nN=e.checkResult),pN()}();var PN={STREAM_ADDED:"stream-added",STREAM_REMOVED:"stream-removed",STREAM_UPDATED:"stream-updated",STREAM_PUBLISHED:"stream-published",STREAM_SUBSCRIBED:"stream-subscribed",STREAM_UNSUBSCRIBED:"stream-unsubscribed",STATE_CHANGED:"state-changed",ERROR:"error",CONNECTION_STATE_CHANGED:"connection-state-changed",SEI_MESSAGE:lC},UN={STREAM_ADDED:"stream-added",STREAM_REMOVED:"stream-removed",STREAM_UPDATED:"stream-updated",STREAM_SUBSCRIBED:"stream-subscribed",CONNECTION_STATE_CHANGED:"connection-state-changed",PEER_JOIN:"peer-join",PEER_LEAVE:"peer-leave",MUTE_AUDIO:"mute-audio",MUTE_VIDEO:"mute-video",UNMUTE_AUDIO:"unmute-audio",UNMUTE_VIDEO:"unmute-video",CLIENT_BANNED:"client-banned",NETWORK_QUALITY:"network-quality",AUDIO_VOLUME:"audio-volume",SEI_MESSAGE:lC,ERROR:"error"},xN="player-state-changed",GN="screen-sharing-stopped",FN="connection-state-changed",VN="device-auto-recovered",qN="error",BN="player-state-changed",HN=bE;Er({target:"String",proto:!0,forced:wE("small")},{small:function(){return HN(this,"small","","")}});var jN=function(){function e(t){a(this,e);var n=t.getUserId();this.log_=PA.createLogger({id:n,userId:n,sdkAppId:t.getSDKAppId()}),this.prevReportTime_=0,this.prevReport_={},this.prevEncoderImplementation_="",this.prevQualityLimitationReason_="",this.prevDecoderImplementationMap_=new Map}var t,i,r,s;return c(e,[{key:"statInterval",get:function(){return 0===this.prevReportTime_?2:(Date.now()-this.prevReportTime_)/1e3}},{key:"getSenderStats",value:(s=o(n().mark((function e(t){var i,r,o,a,s=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i={audio:{bytesSent:0,packetsSent:0,audioLevel:0,totalAudioEnergy:0},video:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0,fpsCapture:0},small:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0,fpsCapture:0},auxiliary:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0,fpsCapture:0},rtt:0},r=t.getPeerConnection(),o=t.getSSRC(),!r){e.next=15;break}return e.prev=4,e.next=7,r.getStats();case 7:e.sent.forEach((function(e){if("outbound-rtp"===e.type)if(e.mediaType===GT){if(!Qb&&0===e.bytesSent)return;e.ssrc!==o.video||fw(e.encoderImplementation)||s.prevEncoderImplementation_===e.encoderImplementation||(s.log_.info("encoderImplementation change to ".concat(e.encoderImplementation)),s.prevEncoderImplementation_=e.encoderImplementation),e.ssrc!==o.video||fw(e.qualityLimitationReason)||s.prevQualityLimitationReason_===e.qualityLimitationReason||(s.log_.info("qualityLimitationReason change to ".concat(e.qualityLimitationReason)),s.prevQualityLimitationReason_=e.qualityLimitationReason);var n=GT;e.ssrc===o.small?n=VT:e.ssrc===o.auxiliary&&(n=BT),i[n].bytesSent=e.bytesSent,i[n].packetsSent=e.packetsSent,i[n].framesEncoded=e.framesEncoded}else e.mediaType===xT&&(i.audio.bytesSent=e.bytesSent,i.audio.packetsSent=e.packetsSent);else"candidate-pair"===e.type?EN(e)&&mw(e.currentRoundTripTime)&&(i.rtt=Math.floor(1e3*e.currentRoundTripTime)):"media-source"===e.type&&(e.kind===xT?(i.audio.audioLevel=e.audioLevel||0,i.audio.totalAudioEnergy=e.totalAudioEnergy||0):e.kind===GT&&(e.trackIdentifier===t.getVideoTrackId(GT)?i.video.fpsCapture=e.framesPerSecond:e.trackIdentifier===t.getVideoTrackId(BT)?i.auxiliary.fpsCapture=e.framesPerSecond:i.small.fpsCapture=e.framesPerSecond));var r;fw(e.audioLevel)||(i.audio.audioLevel=e.audioLevel||0,i.audio.totalAudioEnergy=e.totalAudioEnergy||0),fw(e.frameWidth)||(e.trackIdentifier===t.getVideoTrackId(GT)||e.ssrc===o.video?r=GT:e.trackIdentifier===t.getVideoTrackId(BT)||e.ssrc===o.auxiliary?r=BT:e.trackIdentifier!==t.getVideoTrackId(VT)&&e.ssrc!==o.small||(r=VT),r&&(i[r].frameWidth=e.frameWidth,i[r].frameHeight=e.frameHeight,i[r].framesSent=e.framesSent))})),0===i.audio.audioLevel&&(i.audio.audioLevel=(null===(a=t.getLocalStream())||void 0===a?void 0:a.getInternalAudioLevel())||0),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),this.log_.warn("failed to getStats on sender connection "+e.t0);case 15:return e.abrupt("return",i);case 16:case"end":return e.stop()}}),e,this,[[4,12]])}))),function(e){return s.apply(this,arguments)})},{key:"getReceiverStats",value:(r=o(n().mark((function e(t){var i,r,o,a,s,c=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i={tinyId:t.getTinyId(),userId:t.getUserId(),rtt:0,hasAudio:!1,hasVideo:!1,hasAuxiliary:!1,audio:{bytesReceived:0,packetsReceived:0,packetsLost:0,jitter:0,audioLevel:0,totalAudioEnergy:0},video:{bytesReceived:0,packetsReceived:0,packetsLost:0,framesReceived:0,framesDecoded:0,frameWidth:0,frameHeight:0},auxiliary:{bytesReceived:0,packetsReceived:0,packetsLost:0,framesReceived:0,framesDecoded:0,frameWidth:0,frameHeight:0}},!(r=t.getPeerConnection())){e.next=16;break}return e.prev=3,o=t.getSSRC(),a=t.getTrackState(),e.next=8,r.getStats();case 8:e.sent.forEach((function(e){if("inbound-rtp"===e.type){if(e.mediaType===xT&&e.ssrc===o.audio&&a.audio)i.audio.packetsReceived=e.packetsReceived,i.audio.bytesReceived=e.bytesReceived,i.audio.packetsLost=e.packetsLost,i.audio.jitter=e.jitter,i.hasAudio=!0;else if(e.mediaType===GT){if(Qb&&0===e.bytesReceived)return;e.ssrc===o.video&&a.video&&(i.video.packetsReceived=e.packetsReceived,i.video.bytesReceived=e.bytesReceived,i.video.packetsLost=e.packetsLost,i.video.framesReceived=e.framesReceived,i.video.framesDecoded=e.framesDecoded,i.video.fpsDecoded=e.framesPerSecond,i.hasVideo=!0,!e.decoderImplementation||c.prevDecoderImplementationMap_.has(i.userId)&&c.prevDecoderImplementationMap_.get(i.userId)===e.decoderImplementation||(c.log_.info("".concat(i.userId," decoderImplementation change to ").concat(e.decoderImplementation)),c.prevDecoderImplementationMap_.set(i.userId,e.decoderImplementation))),e.ssrc===o.auxiliary&&a.auxiliary&&(i.auxiliary.packetsReceived=e.packetsReceived,i.auxiliary.bytesReceived=e.bytesReceived,i.auxiliary.packetsLost=e.packetsLost,i.auxiliary.framesReceived=e.framesReceived,i.auxiliary.framesDecoded=e.framesDecoded,i.auxiliary.fpsDecoded=e.framesPerSecond,i.hasAuxiliary=!0)}}else"candidate-pair"===e.type&&EN(e)&&mw(e.currentRoundTripTime)&&(i.rtt=Math.floor(1e3*e.currentRoundTripTime));fw(e.frameWidth)||(e.trackIdentifier!==t.getMainStreamVideoTrackId()&&e.ssrc!==o.video||(i.video.frameWidth=e.frameWidth,i.video.frameHeight=e.frameHeight),e.trackIdentifier!==t.getAuxStreamVideoTrackId()&&e.ssrc!==o.auxiliary||(i.auxiliary.frameWidth=e.frameWidth,i.auxiliary.frameHeight=e.frameHeight)),fw(e.audioLevel)||(i.audio.audioLevel=e.audioLevel||0,i.audio.totalAudioEnergy=e.totalAudioEnergy||0)})),0===i.audio.audioLevel&&(i.audio.audioLevel=(null===(s=t.getMainStream())||void 0===s?void 0:s.getInternalAudioLevel())||0),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),this.log_.warn("failed to getStats on receiver connection "+e.t0);case 16:return e.abrupt("return",i);case 17:case"end":return e.stop()}}),e,this,[[3,13]])}))),function(e){return r.apply(this,arguments)})},{key:"getStats",value:(i=o(n().mark((function e(t,i){var r,o,a,s,c,u,l;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={},!t){e.next=5;break}return e.next=4,this.getSenderStats(t);case 4:r=e.sent;case 5:o=[],a=E(i),e.prev=7,a.s();case 9:if((s=a.n()).done){e.next=17;break}return(c=I(s.value,2))[0],u=c[1],e.next=13,this.getReceiverStats(u);case 13:l=e.sent,o.push(l);case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(7),a.e(e.t0);case 22:return e.prev=22,a.f(),e.finish(22);case 25:return e.abrupt("return",{senderStats:r,receiverStats:o});case 26:case"end":return e.stop()}}),e,this,[[7,19,22,25]])}))),function(e,t){return i.apply(this,arguments)})},{key:"getDifferenceValue",value:function(e,t){if(oO(e))return t;var n=t-e;return n<0?0:n}},{key:"prepareReport",value:function(e){var t=this,n=e.stats,i=e.report,r=e.freezeMap;if(!oO(n.senderStats)){var o;o={uint32_audio_level:1e8*n.senderStats.audio.audioLevel,uint32_audio_energy:1e6*n.senderStats.audio.totalAudioEnergy,uint32_audio_codec_bitrate:n.senderStats.audio.bytesSent,audioLevel:n.senderStats.audio.audioLevel};var a=[],s={uint32_video_stream_type:2,uint32_video_codec_fps:n.senderStats.video.framesSent,uint32_video_capture_fps:n.senderStats.video.fpsCapture,uint32_video_width:n.senderStats.video.frameWidth,uint32_video_height:n.senderStats.video.frameHeight,uint32_video_codec_bitrate:n.senderStats.video.bytesSent,uint32_video_enc_fps:n.senderStats.video.framesEncoded};if(a.push(s),n.senderStats.small.bytesSent){var c={uint32_video_stream_type:3,uint32_video_codec_fps:n.senderStats.small.framesSent||0,uint32_video_capture_fps:n.senderStats.small.fpsCapture||0,uint32_video_width:n.senderStats.small.frameWidth||0,uint32_video_height:n.senderStats.small.frameHeight||0,uint32_video_codec_bitrate:n.senderStats.small.bytesSent,uint32_video_enc_fps:n.senderStats.small.framesEncoded||0};a.push(c)}if(n.senderStats.auxiliary.bytesSent){var u={uint32_video_stream_type:7,uint32_video_codec_fps:n.senderStats.auxiliary.framesSent||0,uint32_video_capture_fps:n.senderStats.auxiliary.fpsCapture||0,uint32_video_width:n.senderStats.auxiliary.frameWidth||0,uint32_video_height:n.senderStats.auxiliary.frameHeight||0,uint32_video_codec_bitrate:n.senderStats.auxiliary.bytesSent,uint32_video_enc_fps:n.senderStats.auxiliary.framesEncoded||0};a.push(u)}var l={uint32_bitrate:0,uint32_rtt:n.senderStats.rtt};i.msg_up_stream_info={msg_audio_status:o,msg_video_status:a,msg_network_status:l}}var d=this.statInterval;i.msg_down_stream_info=[],n.receiverStats.forEach((function(e){var t={};if(t.msg_user_info={str_identifier:e.userId,uint64_tinyid:e.tinyId},t.msg_network_status={uint32_rtt:e.rtt},t.msg_video_status={},e.hasAudio){var n={uint32_audio_codec_bitrate:e.audio.bytesReceived,uint32_audio_total_bitrate:e.audio.bytesReceived,uint32_audio_level:1e8*e.audio.audioLevel,uint32_audio_energy:1e6*e.audio.totalAudioEnergy,uint32_audio_receive:e.audio.packetsReceived,uint32_audio_origin_lost:e.audio.packetsLost,audioLevel:e.audio.audioLevel};t.msg_audio_status=n}if(t.msg_video_status=[],e.hasVideo){var o=r.get(e.userId+"_"+qC),a=o?o.duration:0,s={uint32_video_stream_type:2,uint32_video_receive_fps:e.video.framesReceived,uint32_video_width:e.video.frameWidth,uint32_video_height:e.video.frameHeight,uint32_video_codec_bitrate:e.video.bytesReceived,uint32_video_receive:e.video.packetsReceived,uint32_video_origin_lost:e.video.packetsLost,uint32_video_block_time:a,uint32_video_dec_fps:e.video.framesDecoded};t.msg_video_status.push(s)}if(e.hasAuxiliary){var c=r.get(e.userId+"_"+BC),u=c?c.duration:0,l={uint32_video_stream_type:7,uint32_video_receive_fps:e.auxiliary.framesReceived,uint32_video_width:e.auxiliary.frameWidth,uint32_video_height:e.auxiliary.frameHeight,uint32_video_codec_bitrate:e.auxiliary.bytesReceived,uint32_video_receive:e.auxiliary.packetsReceived+e.auxiliary.packetsLost,uint32_video_origin_lost:e.auxiliary.packetsLost,uint32_video_block_time:u,uint32_video_dec_fps:e.auxiliary.framesDecoded};t.msg_video_status.push(l)}i.msg_down_stream_info.push(t)}));var p=this.prevReport_;if(this.prevReport_=JSON.parse(JSON.stringify(i)),i.msg_up_stream_info.msg_audio_status&&p.msg_up_stream_info.msg_audio_status){var h=p.msg_up_stream_info.msg_audio_status,f=i.msg_up_stream_info.msg_audio_status,g=this.getDifferenceValue(h.uint32_audio_codec_bitrate,f.uint32_audio_codec_bitrate);f.uint32_audio_codec_bitrate=Math.round(8*g/d),i.msg_up_stream_info.msg_network_status.uint32_bitrate+=f.uint32_audio_codec_bitrate}var m=p.msg_up_stream_info.msg_video_status;i.msg_up_stream_info.msg_video_status.forEach((function(e){var n=m.find((function(t){return t.uint32_video_stream_type===e.uint32_video_stream_type}));if(!n||0===n.uint32_video_codec_bitrate)return e.uint32_video_codec_bitrate=0,e.uint32_video_enc_fps=0,void(e.uint32_video_codec_fps=0);var r=n.uint32_video_codec_bitrate,o=n.uint32_video_enc_fps,a=n.uint32_video_codec_fps,s=t.getDifferenceValue(r,e.uint32_video_codec_bitrate);e.uint32_video_codec_bitrate=Math.round(8*s/d),i.msg_up_stream_info.msg_network_status.uint32_bitrate+=e.uint32_video_codec_bitrate,e.uint32_video_enc_fps=Math.round(t.getDifferenceValue(o,e.uint32_video_enc_fps)/d),e.uint32_video_codec_fps=Math.round(t.getDifferenceValue(a,e.uint32_video_codec_fps)/d)}));var v=i.msg_down_stream_info,_=p.msg_down_stream_info;return v.forEach((function(e){var n=_.find((function(t){return t.msg_user_info.uint64_tinyid===e.msg_user_info.uint64_tinyid}));if(n){if(e.msg_audio_status&&n.msg_audio_status){var i=e.msg_audio_status,r=n.msg_audio_status;i.uint32_audio_origin_lost=t.getDifferenceValue(r.uint32_audio_origin_lost,i.uint32_audio_origin_lost),i.uint32_audio_receive=t.getDifferenceValue(r.uint32_audio_receive,i.uint32_audio_receive),i.uint32_audio_receive+=i.uint32_audio_origin_lost;var o=t.getDifferenceValue(r.uint32_audio_codec_bitrate,i.uint32_audio_codec_bitrate);i.uint32_audio_codec_bitrate=Math.round(8*o/d),i.uint32_audio_total_bitrate=Math.round(8*o/d)}if(e.msg_video_status&&n.msg_video_status){var a=e.msg_video_status,s=n.msg_video_status;a.forEach((function(e){var n=s.find((function(t){return t.uint32_video_stream_type===e.uint32_video_stream_type}));if(!n)return e.uint32_video_receive=0,e.uint32_video_origin_lost=0,e.uint32_video_codec_bitrate=0,e.uint32_video_receive_fps=0,void(e.uint32_video_dec_fps=0);var i=n.uint32_video_receive,r=n.uint32_video_origin_lost,o=n.uint32_video_codec_bitrate,a=n.uint32_video_receive_fps,c=n.uint32_video_dec_fps;e.uint32_video_origin_lost=t.getDifferenceValue(r,e.uint32_video_origin_lost),e.uint32_video_receive=t.getDifferenceValue(i,e.uint32_video_receive)+e.uint32_video_origin_lost;var u=t.getDifferenceValue(o,e.uint32_video_codec_bitrate);e.uint32_video_codec_bitrate=Math.round(8*u/d);var l=t.getDifferenceValue(a,e.uint32_video_receive_fps);e.uint32_video_receive_fps=Math.round(l/d),e.uint32_video_dec_fps=Math.round(t.getDifferenceValue(c,e.uint32_video_dec_fps)/d)}))}}})),i}},{key:"getStatsReport",value:(t=o(n().mark((function e(t){var i,r,o,a,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.uplinkConnection,r=t.downlinkConnections,o=t.freezeMap,a={msg_up_stream_info:{msg_audio_status:{uint32_audio_format:0,uint32_audio_sample_rate:0,uint32_audio_codec_bitrate:0,uint32_audio_receive:0,uint32_audio_origin_lost:0,uint32_audio_level:0,uint32_audio_energy:0,audioLevel:0},msg_video_status:[{uint32_video_stream_type:0,uint32_video_codec_fps:0,uint32_video_capture_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_codec_bitrate:0,uint32_video_receive:0,uint32_video_origin_lost:0,uint32_video_final_lost:0,uint32_video_enc_fps:0}],msg_network_status:{uint32_bitrate:0,uint32_rtt:0,uint32_lost:0}},msg_down_stream_info:[{msg_user_info:{str_identifier:"",uint64_tinyid:""},msg_audio_status:{uint32_audio_format:0,uint32_audio_sample_rate:0,uint32_audio_codec_bitrate:0,uint32_audio_total_bitrate:0,uint32_audio_level:0,uint32_audio_energy:0,uint32_audio_receive:0,uint32_audio_origin_lost:0,uint32_audio_final_lost:0,audioLevel:0},msg_video_status:[{uint32_video_stream_type:0,uint32_video_receive_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_codec_bitrate:0,uint32_video_receive:0,uint32_video_origin_lost:0,uint32_video_block_time:0,uint32_video_dec_fps:0}],msg_network_status:{uint32_bitrate:0,uint32_rtt:0,uint32_lost:0,uint32_jitter:0}}]},e.next=4,this.getStats(i,r);case 4:return s=e.sent,"{}"===JSON.stringify(this.prevReport_)&&(this.prevReport_=JSON.parse(JSON.stringify(a))),this.prepareReport({stats:s,report:a,freezeMap:o,uplinkConnection:i,downlinkConnections:r}),this.prevReportTime_=Date.now(),e.abrupt("return",a);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"reset",value:function(){this.prevReportTime_=0,this.prevReport_={},this.prevEncoderImplementation_="",this.prevQualityLimitationReason_="",this.prevDecoderImplementationMap_=new Map}}]),e}(),KN=function(){function e(t){var n=t.signalChannel,i=t.connections,r=t.client;a(this,e),this.client_=r,this.signalChannel_=n,this.connections_=i,this.client_=r,this.log_=PA.createLogger({id:"q|"+this.client_.getUserId(),userId:this.client_.getUserId(),sdkAppId:this.client_.getSDKAppId()}),this.uplinkConnection_=null,this.uplinkNetworkQuality_=0,this.uplinkRTT_=0,this.uplinkLoss_=0,this.downlinkNetworkQuality_=0,this.downlinkRTT_=0,this.downlinkLoss_=0,this.downlinkPrevStatMap_=new Map,this.downlinkLossAndRTTMap_=new Map,this.interval_=-1,this.emitter_=new xw,this.initialize()}var t,i;return c(e,[{key:"uplinkNetworkQuality",get:function(){return this.uplinkNetworkQuality_},set:function(e){e!==this.uplinkNetworkQuality_&&this.log_.info("uplink network quality change ".concat(this.uplinkNetworkQuality," -> ").concat(e,", rtt: ").concat(this.uplinkRTT_,", loss: ").concat(this.uplinkLoss_)),this.uplinkNetworkQuality_=e}},{key:"downlinkNetworkQuality",get:function(){return this.downlinkNetworkQuality_},set:function(e){if(e!==this.downlinkNetworkQuality_){var t=this.getAverageLossAndRTT(M(this.downlinkLossAndRTTMap_.values())),n=t.rtt,i=t.loss;this.log_.info("downlink network quality change ".concat(this.downlinkNetworkQuality," -> ").concat(e,", rtt: ").concat(n,", loss: ").concat(i))}this.downlinkNetworkQuality_=e}},{key:"initialize",value:function(){var e=this;this.signalChannel_.on(JR.UPLINK_NETWORK_STATS,(function(t){e.handleUplinkNetworkQuality(t)})),this.signalChannel_.on(qR,this.handleSignalConnectionStateChange.bind(this)),this.start()}},{key:"handleUplinkNetworkQuality",value:function(e){if(!this.uplinkConnection_)return this.uplinkNetworkQuality=0,this.uplinkLoss_=0,void(this.uplinkRTT_=0);var t=this.uplinkConnection_.getPeerConnection();if(t&&this.isPeerConnectionDisconnected(t))return this.uplinkNetworkQuality=6,this.uplinkLoss_=0,void(this.uplinkRTT_=0);if(0===e.data.code){var n=e.data.data,i=n.expectAudPkg+n.expectVidPkg,r=n.recvAudPkg+n.recvVidPkg,o=i-r,a=n.delay;if(a&&this.updateDelay(a),0===i&&0===r)return;this.uplinkLoss_=o<=0?0:Math.round(o/i*100),this.uplinkRTT_=n.rtt,this.uplinkNetworkQuality=this.getNetworkQuality(this.uplinkLoss_,this.uplinkRTT_)}}},{key:"handleDownlinkNetworkQuality",value:(i=o(n().mark((function e(){var t,i,r,o,a,s,c,u,l,d,p,h,f,g,m,v=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connections_&&0!==this.connections_.size){e.next=3;break}return this.downlinkNetworkQuality=0,e.abrupt("return");case 3:if(t=M(this.connections_.values()),i=t.filter((function(e){return e.getPeerConnection()&&e.getPeerConnection().connectionState===QC})),t.filter((function(e){return e.getPeerConnection()&&v.isPeerConnectionDisconnected(e.getPeerConnection())})).length!==t.length){e.next=9;break}return this.downlinkNetworkQuality=6,e.abrupt("return");case 9:r=0;case 10:if(!(r<i.length)){e.next=31;break}return o=i[r].getPeerConnection(),e.next=14,this.getStat(o);case 14:if(a=e.sent,s=a.rtt,c=a.totalPacketsLost,u=a.totalPacketsReceived,this.downlinkPrevStatMap_.has(o)){e.next=21;break}return this.downlinkPrevStatMap_.set(o,{totalPacketsLost:c,totalPacketsReceived:u}),e.abrupt("continue",28);case 21:l=0,d=this.downlinkPrevStatMap_.get(o),p=c-d.totalPacketsLost,h=u-d.totalPacketsReceived,l=p<=0||h<0?0:Math.round(p/(p+h)*100),this.downlinkPrevStatMap_.set(o,{totalPacketsLost:c,totalPacketsReceived:u}),this.downlinkLossAndRTTMap_.set(o,{rtt:s,loss:l,userId:i[r].getUserId()});case 28:r++,e.next=10;break;case 31:if(M(this.downlinkPrevStatMap_.keys()).forEach((function(e){v.isPeerConnectionDisconnected(e)&&(v.downlinkPrevStatMap_.delete(e),v.downlinkLossAndRTTMap_.delete(e))})),0!==this.downlinkLossAndRTTMap_.size){e.next=34;break}return e.abrupt("return");case 34:f=this.getAverageLossAndRTT(M(this.downlinkLossAndRTTMap_.values())),g=f.rtt,m=f.loss,this.downlinkRTT_=g,this.downlinkLoss_=m,this.downlinkNetworkQuality=this.getNetworkQuality(m,g);case 38:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"getStat",value:(t=o(n().mark((function e(t){var i,r,o,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i={rtt:0,totalPacketsLost:0,totalPacketsReceived:0},t&&mN()){e.next=3;break}return e.abrupt("return",i);case 3:r=t.getReceivers(),e.prev=4,o=0;case 6:if(!(o<r.length)){e.next=15;break}return a=r[o],e.next=10,a.getStats();case 10:e.sent.forEach((function(e){"candidate-pair"===e.type&&mw(e.currentRoundTripTime)&&(i.rtt=Math.round(1e3*e.currentRoundTripTime)),"inbound-rtp"!==e.type||e.mediaType!==xT&&e.mediaType!==GT||(i.totalPacketsLost+=e.packetsLost,i.totalPacketsReceived+=e.packetsReceived)}));case 12:o++,e.next=6;break;case 15:return e.abrupt("return",i);case 18:return e.prev=18,e.t0=e.catch(4),e.abrupt("return",i);case 21:case"end":return e.stop()}}),e,null,[[4,18]])}))),function(e){return t.apply(this,arguments)})},{key:"getAverageLossAndRTT",value:function(e){var t={rtt:0,loss:0};return Array.isArray(e)&&e.length>0&&(e.forEach((function(e){t.rtt+=e.rtt,t.loss+=e.loss})),Object.keys(t).forEach((function(n){t[n]=Math.round(t[n]/e.length)}))),t}},{key:"getNetworkQuality",value:function(e,t){return e>50||t>500?5:e>30||t>350?4:e>20||t>200?3:e>10||t>100?2:e>=0||t>=0?1:0}},{key:"handleSignalConnectionStateChange",value:function(e){e.state===jR?(this.uplinkRTT_=0,this.uplinkLoss_=0,this.uplinkNetworkQuality=6):e.state===WR&&6===this.uplinkNetworkQuality&&(this.uplinkNetworkQuality=5)}},{key:"handleUplinkConnectionStateChange",value:function(e){var t=e.state;t===jC?(this.uplinkLoss_=0,this.uplinkRTT_=0,this.uplinkNetworkQuality=6):t===WC&&6===this.uplinkNetworkQuality&&(this.uplinkNetworkQuality=5)}},{key:"isPeerConnectionDisconnected",value:function(e){return!(!e||e.connectionState!==ZC&&e.connectionState!==JC&&e.connectionState!==XC)}},{key:"setUplinkConnection",value:function(e){this.uplinkConnection_=e,this.uplinkConnection_?this.uplinkConnection_.on(PN.CONNECTION_STATE_CHANGED,this.handleUplinkConnectionStateChange.bind(this)):(this.uplinkNetworkQuality=0,this.uplinkRTT_=0,this.uplinkLoss_=0)}},{key:"start",value:function(){var e=this;-1===this.interval_?(this.log_.info("start network quality calculating"),this.interval_=QO.run(_E,(function(){e.handleDownlinkNetworkQuality(),Gw.emit(bA,{client:e.client_,uplinkNetworkQuality:e.uplinkNetworkQuality,downlinkNetworkQuality:e.downlinkNetworkQuality,uplinkRTT:e.uplinkRTT_,uplinkLoss:e.uplinkLoss_,downlinkRTT:e.downlinkRTT_,downlinkLoss:e.downlinkLoss_,downlinkLossAndRTTMap:e.downlinkLossAndRTTMap_}),e.emitter_.emit(UN.NETWORK_QUALITY,{uplinkNetworkQuality:e.uplinkNetworkQuality,downlinkNetworkQuality:e.downlinkNetworkQuality,uplinkRTT:e.uplinkRTT_,uplinkLoss:e.uplinkLoss_,downlinkRTT:e.downlinkRTT_,downlinkLoss:e.downlinkLoss_})}),{delay:2e3})):this.log_.info("network quality calculating is already started")}},{key:"stop",value:function(){this.log_.info("stop network quality calculating"),-1!==this.interval_&&(QO.clearTask(this.interval_),this.interval_=-1),this.downlinkLossAndRTTMap_.clear(),this.downlinkPrevStatMap_.clear()}},{key:"on",value:function(e,t){this.emitter_.on(e,t)}},{key:"updateDelay",value:function(e){var t=this;e.forEach((function(e){var n=e.srcTinyId,i=e.videoDelay,r=e.audioDelay,o=t.connections_.get(n);o&&o.setDelay({videoDelay:i,audioDelay:r})}))}}]),e}(),zN=function(){function e(t){a(this,e),this.log_=PA.createLogger({id:t.client.getUserId(),userId:t.client.getUserId(),sdkAppId:t.client.getSDKAppId()}),this.localStream_=null,this.prevDevices_=[],this.initialize()}var t,i;return c(e,[{key:"initialize",value:function(){navigator.mediaDevices&&(this.onDeviceChange=this.onDeviceChange.bind(this),navigator.mediaDevices.addEventListener("devicechange",this.onDeviceChange))}},{key:"destroy",value:function(){navigator.mediaDevices&&navigator.mediaDevices.removeEventListener("devicechange",this.onDeviceChange)}},{key:"onDeviceChange",value:(i=o(n().mark((function e(){var t,i,r,o=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.localStream_&&this.localStream_.getMediaStream()&&!this.localStream_.getScreen()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,rY.getDevices();case 4:t=e.sent,i=t.filter((function(e){return o.prevDevices_.findIndex((function(t){var n=t.deviceId;return e.deviceId===n}))<0})),r=this.prevDevices_.filter((function(e){return t.findIndex((function(t){var n=t.deviceId;return e.deviceId===n}))<0})),i.length>0&&this.handleDeviceAdded(this.prevDevices_,i),r.length>0&&this.handleDeviceRemoved(t,r),this.prevDevices_=t;case 10:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setLocalStream",value:(t=o(n().mark((function e(t){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=4;break}return e.next=3,rY.getDevices();case 3:this.prevDevices_=e.sent;case 4:this.localStream_=t;case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"handleDeviceAdded",value:function(e,t){var n,i;if(this.localStream_){this.log_.warn("devicesAdded: ".concat(JSON.stringify(t))),this.localStream_.updateDeviceIdInUse();var r=t.filter((function(e){return e.kind===tC})),o=t.filter((function(e){return e.kind===eC})),a=e.filter((function(e){return e.kind===tC})),s=e.filter((function(e){return e.kind===eC})),c=r.length>0&&0===a.length&&"live"!==(null===(n=this.localStream_.getVideoTrack())||void 0===n?void 0:n.readyState),u=o.length>0&&0===s.length&&"live"!==(null===(i=this.localStream_.getAudioTrack())||void 0===i?void 0:i.readyState);if(u&&c)return this.log_.info("new microphone and camera detected, but there was no device before."),void this.localStream_.recoverCapture({audio:!0,video:!0,cameraId:r[0].deviceId,microphoneId:o[0].deviceId});c&&(this.log_.info("new camera detected, but there was no camera before."),this.localStream_.recoverCapture({audio:!1,video:!0,cameraId:r[0].deviceId})),u&&(this.log_.info("new microphone detected, but there was no microphone before."),this.localStream_.recoverCapture({audio:!0,video:!1,microphoneId:o[0].deviceId}))}}},{key:"handleDeviceRemoved",value:function(e,t){if(this.localStream_){this.log_.warn("devicesRemoved: ".concat(JSON.stringify(t))),this.localStream_.updateDeviceIdInUse();var n=!1,i=!1,r=this.localStream_.getCameraId(),o=this.localStream_.getMicrophoneId();if(o===pE){var a=this.localStream_.getMicrophoneGroupId(),s=e.filter((function(e){return e.deviceId===pE&&e.kind===eC}))[0];s&&s.groupId!==a&&(i=!0)}if(t.forEach((function(e){var t=e.deviceId;r.length>0&&t===r?n=!0:o.length>0&&t===o&&(i=!0)})),n&&i)return this.log_.warn("current camera and microphone in use is lost, cameraId: ".concat(r,", microphoneId: ").concat(o)),void((this.localStream_.getAudio()||this.localStream_.getVideo())&&this.localStream_.recoverCapture({video:!0,audio:!0}));n&&(this.log_.warn("current camera in use is lost, deviceId: ".concat(r)),this.localStream_.getVideo()&&this.localStream_.recoverCapture({video:!0,audio:!1})),i&&(this.log_.warn("current microphone in use is lost, deviceId: ".concat(o)),this.localStream_.getAudio()&&this.localStream_.recoverCapture({video:!1,audio:!0}))}}}]),e}();function WN(){return YN.apply(this,arguments)}function YN(){return YN=o(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!CN()&&!TN()){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,navigator.mediaDevices.enumerateDevices();case 4:return t=e.sent,e.abrupt("return",t.filter((function(e){return e.kind===tC})).map((function(e,t){var n=e.label;e.label||(n="camera_"+t);var i={label:n,deviceId:e.deviceId,kind:e.kind};return e.groupId&&(i.groupId=e.groupId),e.getCapabilities&&(i.getCapabilities=function(){return e.getCapabilities()}),i})));case 6:case"end":return e.stop()}}),e)}))),YN.apply(this,arguments)}function $N(){return $N=o(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!CN()&&!TN()){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,navigator.mediaDevices.enumerateDevices();case 4:return t=e.sent,e.abrupt("return",t.filter((function(e){return e.kind===eC&&e.deviceId!==hE})).map((function(e,t){var n=e.label;e.label||(n="microphone_"+t);var i={label:n,deviceId:e.deviceId,kind:e.kind};return e.groupId&&(i.groupId=e.groupId),e.getCapabilities&&(i.getCapabilities=function(){return e.getCapabilities()}),i})));case 6:case"end":return e.stop()}}),e)}))),$N.apply(this,arguments)}function JN(){return JN=o(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!CN()&&!TN()){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,navigator.mediaDevices.enumerateDevices();case 4:return t=e.sent,e.abrupt("return",t.filter((function(e){return"audiooutput"===e.kind})).map((function(e,t){var n=e.label;e.label||(n="speaker_"+t);var i={label:n,deviceId:e.deviceId,kind:e.kind};return e.groupId&&(i.groupId=e.groupId),i})));case 6:case"end":return e.stop()}}),e)}))),JN.apply(this,arguments)}function XN(e){return ZN.apply(this,arguments)}function ZN(){return(ZN=o(n().mark((function e(t){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof CanvasCaptureMediaStreamTrack)){e.next=2;break}return e.abrupt("return",!1);case 2:if(t instanceof MediaStreamTrack){e.next=4;break}return e.abrupt("return",!1);case 4:if(!t.label.toLocaleLowerCase().includes("camera")){e.next=6;break}return e.abrupt("return",!0);case 6:return e.next=8,WN();case 8:if(!e.sent.find((function(e){var n;return e.deviceId===(null===(n=t.getSettings())||void 0===n?void 0:n.deviceId)}))){e.next=11;break}return e.abrupt("return",!0);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function QN(e){return eP.apply(this,arguments)}function eP(){return(eP=o(n().mark((function e(t){var i;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,rY.getMicrophones();case 2:if((null==(i=e.sent.find((function(e){return e.deviceId===pE})))?void 0:i.groupId)!==t){e.next=5;break}return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var tP,nP=En.exports,iP=on,rP=ln,oP=Yu,aP=wr,sP=U,cP=pt,uP=function(e,t,n,i){try{return i?t(rP(n)[0],n[1]):t(n)}catch(oY){oP(e,"throw",oY)}},lP=Ru,dP=eo,pP=xi,hP=Wc,fP=ju,gP=xu,mP=Array,vP=te,_P=2147483647,yP=/[^\0-\u007E]/,IP=/[.\u3002\uFF0E\uFF61]/g,MP="Overflow: input needs wider integers to process",TP=RangeError,CP=vP(IP.exec),SP=Math.floor,EP=String.fromCharCode,kP=vP("".charCodeAt),bP=vP([].join),DP=vP([].push),wP=vP("".replace),AP=vP("".split),RP=vP("".toLowerCase),LP=function(e){return e+22+75*(e<26)},OP=function(e,t,n){var i=0;for(e=n?SP(e/700):e>>1,e+=SP(e/t);e>455;)e=SP(e/35),i+=36;return SP(i+36*e/(e+38))},NP=function(e){var t,n,i=[],r=(e=function(e){for(var t=[],n=0,i=e.length;n<i;){var r=kP(e,n++);if(r>=55296&&r<=56319&&n<i){var o=kP(e,n++);56320==(64512&o)?DP(t,((1023&r)<<10)+(1023&o)+65536):(DP(t,r),n--)}else DP(t,r)}return t}(e)).length,o=128,a=0,s=72;for(t=0;t<e.length;t++)(n=e[t])<128&&DP(i,EP(n));var c=i.length,u=c;for(c&&DP(i,"-");u<r;){var l=_P;for(t=0;t<e.length;t++)(n=e[t])>=o&&n<l&&(l=n);var d=u+1;if(l-o>SP((_P-a)/d))throw TP(MP);for(a+=(l-o)*d,o=l,t=0;t<e.length;t++){if((n=e[t])<o&&++a>_P)throw TP(MP);if(n==o){for(var p=a,h=36;;){var f=h<=s?1:h>=s+26?26:h-s;if(p<f)break;var g=p-f,m=36-f;DP(i,EP(LP(f+g%m))),p=SP(g/m),h+=36}DP(i,EP(LP(p))),s=OP(a,d,u==c),a=0,u++}}a++,o++}return bP(i,"")},PP=Er,UP=L,xP=bg,GP=w,FP=wr,VP=te,qP=Ci,BP=function(e,t,n){return n.get&&nP(n.get,t,{getter:!0}),n.set&&nP(n.set,t,{setter:!0}),iP.f(e,t,n)},HP=dl,jP=gt,KP=dR,zP=function(e){var t=cP(e),n=dP(this),i=arguments.length,r=i>1?arguments[1]:void 0,o=void 0!==r;o&&(r=aP(r,i>2?arguments[2]:void 0));var a,s,c,u,l,d,p=gP(t),h=0;if(!p||this===mP&&lP(p))for(a=pP(t),s=n?new this(a):mP(a);a>h;h++)d=o?r(t[h],h):t[h],hP(s,h,d);else for(l=(u=fP(t,p)).next,s=n?new this:[];!(c=sP(l,u)).done;h++)d=o?uP(u,r,[c.value,h],!0):c.value,hP(s,h,d);return s.length=h,s},WP=Qc,YP=md.codeAt,$P=function(e){var t,n,i=[],r=AP(wP(RP(e),IP,"."),".");for(t=0;t<r.length;t++)n=r[t],DP(i,CP(yP,n)?"xn--"+NP(n):n);return bP(i,".")},JP=sd,XP=Ws,ZP=Wd,QP=Wm,eU=ai,tU=eU.set,nU=eU.getterFor("URL"),iU=QP.URLSearchParams,rU=QP.getState,oU=GP.URL,aU=GP.TypeError,sU=GP.parseInt,cU=Math.floor,uU=Math.pow,lU=VP("".charAt),dU=VP(/./.exec),pU=VP([].join),hU=VP(1..toString),fU=VP([].pop),gU=VP([].push),mU=VP("".replace),vU=VP([].shift),_U=VP("".split),yU=VP("".slice),IU=VP("".toLowerCase),MU=VP([].unshift),TU="Invalid scheme",CU="Invalid host",SU="Invalid port",EU=/[a-z]/i,kU=/[\d+-.a-z]/i,bU=/\d/,DU=/^0x/i,wU=/^[0-7]+$/,AU=/^\d+$/,RU=/^[\da-f]+$/i,LU=/[\0\t\n\r #%/:<>?@[\\\]^|]/,OU=/[\0\t\n\r #/:<>?@[\\\]^|]/,NU=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,PU=/[\t\n\r]/g,UU=function(e){var t,n,i,r;if("number"==typeof e){for(t=[],n=0;n<4;n++)MU(t,e%256),e=cU(e/256);return pU(t,".")}if("object"==typeof e){for(t="",i=function(e){for(var t=null,n=1,i=null,r=0,o=0;o<8;o++)0!==e[o]?(r>n&&(t=i,n=r),i=null,r=0):(null===i&&(i=o),++r);return r>n&&(t=i,n=r),t}(e),n=0;n<8;n++)r&&0===e[n]||(r&&(r=!1),i===n?(t+=n?":":"::",r=!0):(t+=hU(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},xU={},GU=KP({},xU,{" ":1,'"':1,"<":1,">":1,"`":1}),FU=KP({},GU,{"#":1,"?":1,"{":1,"}":1}),VU=KP({},FU,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),qU=function(e,t){var n=YP(e,0);return n>32&&n<127&&!jP(t,e)?e:encodeURIComponent(e)},BU={ftp:21,file:null,http:80,https:443,ws:80,wss:443},HU=function(e,t){var n;return 2==e.length&&dU(EU,lU(e,0))&&(":"==(n=lU(e,1))||!t&&"|"==n)},jU=function(e){var t;return e.length>1&&HU(yU(e,0,2))&&(2==e.length||"/"===(t=lU(e,2))||"\\"===t||"?"===t||"#"===t)},KU=function(e){return"."===e||"%2e"===IU(e)},zU={},WU={},YU={},$U={},JU={},XU={},ZU={},QU={},ex={},tx={},nx={},ix={},rx={},ox={},ax={},sx={},cx={},ux={},lx={},dx={},px={},hx=function(e,t,n){var i,r,o,a=JP(e);if(t){if(r=this.parse(a))throw aU(r);this.searchParams=null}else{if(void 0!==n&&(i=new hx(n,!0)),r=this.parse(a,null,i))throw aU(r);(o=rU(new iU)).bindURL(this),this.searchParams=o}};hx.prototype={type:"URL",parse:function(e,t,n){var i,r,o,a,s,c=this,u=t||zU,l=0,d="",p=!1,h=!1,f=!1;for(e=JP(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=mU(e,NU,"")),e=mU(e,PU,""),i=zP(e);l<=i.length;){switch(r=i[l],u){case zU:if(!r||!dU(EU,r)){if(t)return TU;u=YU;continue}d+=IU(r),u=WU;break;case WU:if(r&&(dU(kU,r)||"+"==r||"-"==r||"."==r))d+=IU(r);else{if(":"!=r){if(t)return TU;d="",u=YU,l=0;continue}if(t&&(c.isSpecial()!=jP(BU,d)||"file"==d&&(c.includesCredentials()||null!==c.port)||"file"==c.scheme&&!c.host))return;if(c.scheme=d,t)return void(c.isSpecial()&&BU[c.scheme]==c.port&&(c.port=null));d="","file"==c.scheme?u=ox:c.isSpecial()&&n&&n.scheme==c.scheme?u=$U:c.isSpecial()?u=QU:"/"==i[l+1]?(u=JU,l++):(c.cannotBeABaseURL=!0,gU(c.path,""),u=lx)}break;case YU:if(!n||n.cannotBeABaseURL&&"#"!=r)return TU;if(n.cannotBeABaseURL&&"#"==r){c.scheme=n.scheme,c.path=WP(n.path),c.query=n.query,c.fragment="",c.cannotBeABaseURL=!0,u=px;break}u="file"==n.scheme?ox:XU;continue;case $U:if("/"!=r||"/"!=i[l+1]){u=XU;continue}u=ex,l++;break;case JU:if("/"==r){u=tx;break}u=ux;continue;case XU:if(c.scheme=n.scheme,r==tP)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=WP(n.path),c.query=n.query;else if("/"==r||"\\"==r&&c.isSpecial())u=ZU;else if("?"==r)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=WP(n.path),c.query="",u=dx;else{if("#"!=r){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=WP(n.path),c.path.length--,u=ux;continue}c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=WP(n.path),c.query=n.query,c.fragment="",u=px}break;case ZU:if(!c.isSpecial()||"/"!=r&&"\\"!=r){if("/"!=r){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,u=ux;continue}u=tx}else u=ex;break;case QU:if(u=ex,"/"!=r||"/"!=lU(d,l+1))continue;l++;break;case ex:if("/"!=r&&"\\"!=r){u=tx;continue}break;case tx:if("@"==r){p&&(d="%40"+d),p=!0,o=zP(d);for(var g=0;g<o.length;g++){var m=o[g];if(":"!=m||f){var v=qU(m,VU);f?c.password+=v:c.username+=v}else f=!0}d=""}else if(r==tP||"/"==r||"?"==r||"#"==r||"\\"==r&&c.isSpecial()){if(p&&""==d)return"Invalid authority";l-=zP(d).length+1,d="",u=nx}else d+=r;break;case nx:case ix:if(t&&"file"==c.scheme){u=sx;continue}if(":"!=r||h){if(r==tP||"/"==r||"?"==r||"#"==r||"\\"==r&&c.isSpecial()){if(c.isSpecial()&&""==d)return CU;if(t&&""==d&&(c.includesCredentials()||null!==c.port))return;if(a=c.parseHost(d))return a;if(d="",u=cx,t)return;continue}"["==r?h=!0:"]"==r&&(h=!1),d+=r}else{if(""==d)return CU;if(a=c.parseHost(d))return a;if(d="",u=rx,t==ix)return}break;case rx:if(!dU(bU,r)){if(r==tP||"/"==r||"?"==r||"#"==r||"\\"==r&&c.isSpecial()||t){if(""!=d){var _=sU(d,10);if(_>65535)return SU;c.port=c.isSpecial()&&_===BU[c.scheme]?null:_,d=""}if(t)return;u=cx;continue}return SU}d+=r;break;case ox:if(c.scheme="file","/"==r||"\\"==r)u=ax;else{if(!n||"file"!=n.scheme){u=ux;continue}if(r==tP)c.host=n.host,c.path=WP(n.path),c.query=n.query;else if("?"==r)c.host=n.host,c.path=WP(n.path),c.query="",u=dx;else{if("#"!=r){jU(pU(WP(i,l),""))||(c.host=n.host,c.path=WP(n.path),c.shortenPath()),u=ux;continue}c.host=n.host,c.path=WP(n.path),c.query=n.query,c.fragment="",u=px}}break;case ax:if("/"==r||"\\"==r){u=sx;break}n&&"file"==n.scheme&&!jU(pU(WP(i,l),""))&&(HU(n.path[0],!0)?gU(c.path,n.path[0]):c.host=n.host),u=ux;continue;case sx:if(r==tP||"/"==r||"\\"==r||"?"==r||"#"==r){if(!t&&HU(d))u=ux;else if(""==d){if(c.host="",t)return;u=cx}else{if(a=c.parseHost(d))return a;if("localhost"==c.host&&(c.host=""),t)return;d="",u=cx}continue}d+=r;break;case cx:if(c.isSpecial()){if(u=ux,"/"!=r&&"\\"!=r)continue}else if(t||"?"!=r)if(t||"#"!=r){if(r!=tP&&(u=ux,"/"!=r))continue}else c.fragment="",u=px;else c.query="",u=dx;break;case ux:if(r==tP||"/"==r||"\\"==r&&c.isSpecial()||!t&&("?"==r||"#"==r)){if(".."===(s=IU(s=d))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(c.shortenPath(),"/"==r||"\\"==r&&c.isSpecial()||gU(c.path,"")):KU(d)?"/"==r||"\\"==r&&c.isSpecial()||gU(c.path,""):("file"==c.scheme&&!c.path.length&&HU(d)&&(c.host&&(c.host=""),d=lU(d,0)+":"),gU(c.path,d)),d="","file"==c.scheme&&(r==tP||"?"==r||"#"==r))for(;c.path.length>1&&""===c.path[0];)vU(c.path);"?"==r?(c.query="",u=dx):"#"==r&&(c.fragment="",u=px)}else d+=qU(r,FU);break;case lx:"?"==r?(c.query="",u=dx):"#"==r?(c.fragment="",u=px):r!=tP&&(c.path[0]+=qU(r,xU));break;case dx:t||"#"!=r?r!=tP&&("'"==r&&c.isSpecial()?c.query+="%27":c.query+="#"==r?"%23":qU(r,xU)):(c.fragment="",u=px);break;case px:r!=tP&&(c.fragment+=qU(r,GU))}l++}},parseHost:function(e){var t,n,i;if("["==lU(e,0)){if("]"!=lU(e,e.length-1))return CU;if(!(t=function(e){var t,n,i,r,o,a,s,c=[0,0,0,0,0,0,0,0],u=0,l=null,d=0,p=function(){return lU(e,d)};if(":"==p()){if(":"!=lU(e,1))return;d+=2,l=++u}for(;p();){if(8==u)return;if(":"!=p()){for(t=n=0;n<4&&dU(RU,p());)t=16*t+sU(p(),16),d++,n++;if("."==p()){if(0==n)return;if(d-=n,u>6)return;for(i=0;p();){if(r=null,i>0){if(!("."==p()&&i<4))return;d++}if(!dU(bU,p()))return;for(;dU(bU,p());){if(o=sU(p(),10),null===r)r=o;else{if(0==r)return;r=10*r+o}if(r>255)return;d++}c[u]=256*c[u]+r,2!=++i&&4!=i||u++}if(4!=i)return;break}if(":"==p()){if(d++,!p())return}else if(p())return;c[u++]=t}else{if(null!==l)return;d++,l=++u}}if(null!==l)for(a=u-l,u=7;0!=u&&a>0;)s=c[u],c[u--]=c[l+a-1],c[l+--a]=s;else if(8!=u)return;return c}(yU(e,1,-1))))return CU;this.host=t}else if(this.isSpecial()){if(e=$P(e),dU(LU,e))return CU;if(null===(t=function(e){var t,n,i,r,o,a,s,c=_U(e,".");if(c.length&&""==c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(n=[],i=0;i<t;i++){if(""==(r=c[i]))return e;if(o=10,r.length>1&&"0"==lU(r,0)&&(o=dU(DU,r)?16:8,r=yU(r,8==o?1:2)),""===r)a=0;else{if(!dU(10==o?AU:8==o?wU:RU,r))return e;a=sU(r,o)}gU(n,a)}for(i=0;i<t;i++)if(a=n[i],i==t-1){if(a>=uU(256,5-t))return null}else if(a>255)return null;for(s=fU(n),i=0;i<n.length;i++)s+=n[i]*uU(256,3-i);return s}(e)))return CU;this.host=t}else{if(dU(OU,e))return CU;for(t="",n=zP(e),i=0;i<n.length;i++)t+=qU(n[i],xU);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return jP(BU,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&HU(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,i=e.password,r=e.host,o=e.port,a=e.path,s=e.query,c=e.fragment,u=t+":";return null!==r?(u+="//",e.includesCredentials()&&(u+=n+(i?":"+i:"")+"@"),u+=UU(r),null!==o&&(u+=":"+o)):"file"==t&&(u+="//"),u+=e.cannotBeABaseURL?a[0]:a.length?"/"+pU(a,"/"):"",null!==s&&(u+="?"+s),null!==c&&(u+="#"+c),u},setHref:function(e){var t=this.parse(e);if(t)throw aU(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new fx(e.path[0]).origin}catch(oY){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+UU(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(JP(e)+":",zU)},getUsername:function(){return this.username},setUsername:function(e){var t=zP(JP(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=qU(t[n],VU)}},getPassword:function(){return this.password},setPassword:function(e){var t=zP(JP(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=qU(t[n],VU)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?UU(e):UU(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,nx)},getHostname:function(){var e=this.host;return null===e?"":UU(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,ix)},getPort:function(){var e=this.port;return null===e?"":JP(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=JP(e))?this.port=null:this.parse(e,rx))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+pU(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,cx))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=JP(e))?this.query=null:("?"==lU(e,0)&&(e=yU(e,1)),this.query="",this.parse(e,dx)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=JP(e))?("#"==lU(e,0)&&(e=yU(e,1)),this.fragment="",this.parse(e,px)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var fx=function(e){var t=HP(this,gx),n=ZP(arguments.length,1)>1?arguments[1]:void 0,i=tU(t,new hx(e,!1,n));UP||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},gx=fx.prototype,mx=function(e,t){return{get:function(){return nU(this)[e]()},set:t&&function(e){return nU(this)[t](e)},configurable:!0,enumerable:!0}};if(UP&&(BP(gx,"href",mx("serialize","setHref")),BP(gx,"origin",mx("getOrigin")),BP(gx,"protocol",mx("getProtocol","setProtocol")),BP(gx,"username",mx("getUsername","setUsername")),BP(gx,"password",mx("getPassword","setPassword")),BP(gx,"host",mx("getHost","setHost")),BP(gx,"hostname",mx("getHostname","setHostname")),BP(gx,"port",mx("getPort","setPort")),BP(gx,"pathname",mx("getPathname","setPathname")),BP(gx,"search",mx("getSearch","setSearch")),BP(gx,"searchParams",mx("getSearchParams")),BP(gx,"hash",mx("getHash","setHash"))),qP(gx,"toJSON",(function(){return nU(this).serialize()}),{enumerable:!0}),qP(gx,"toString",(function(){return nU(this).serialize()}),{enumerable:!0}),oU){var vx=oU.createObjectURL,_x=oU.revokeObjectURL;vx&&qP(fx,"createObjectURL",FP(vx,oU)),_x&&qP(fx,"revokeObjectURL",FP(_x,oU))}XP(fx,"URL"),PP({global:!0,constructor:!0,forced:!xP,sham:!UP},{URL:fx});var yx,Ix,Mx=new Blob(["class VolumeMeter extends AudioWorkletProcessor{constructor(){super();this.volume=0;this.intervalTime=200;this.tick=this.intervalTime;this.isStop=false;this.port.onmessage=event=>{const{data}=event;switch(data.name){case'setIntervalTime':this.intervalTime=data.intervalTime;break;case'stop':this.isStop=true;break}}}process(inputs){const input=inputs[0];if(this.isStop){return false}if(input.length>0){const firstChannel=input[0];let sum=0;let rms;for(let i=0;i<firstChannel.length;++i){sum+=firstChannel[i]*firstChannel[i]}rms=Math.sqrt(sum/firstChannel.length);this.volume=Math.max(rms,this.volume*0.95);this.tick-=firstChannel.length;if(this.tick<0){this.tick+=(this.intervalTime/1000)*sampleRate;this.port.postMessage({volume:this.volume})}}return true}}registerProcessor('volume-meter',VolumeMeter);"],{type:"application/javascript"}),Tx=!1,Cx=function(){function e(t){a(this,e),this.context_=t.context,this.addModuleToContext()}var t;return c(e,[{key:"addModuleToContext",value:(t=o(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.context_.audioWorklet.addModule(URL.createObjectURL(Mx));case 3:PA.info("worklet addModule success"),Gw.emit(wA),Tx=!0,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),PA.info("worklet addModule catch error. ".concat(e.t0.message)),Gw.emit(AA);case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return t.apply(this,arguments)})},{key:"initWorkletSuccess",get:function(){return Tx}}]),e}(),Sx=0,Ex=function(){function e(t){a(this,e);var n=t.track,i=t.log,r=t.stream;this.volume_=0,this.log_=i,this.track_=n,this.stream_=r,yx||(yx=ww()),this.audioCtx_=yx,this.destination_=this.audioCtx_.destination;var o=new MediaStream;o.addTrack(this.track_),this.streamSource_=this.audioCtx_.createMediaStreamSource(o),this.audioWorkletNode_=null,this.scriptProcessorNode_=null,this.interval_=200,Gw.on(DA,this.resume,this),Gw.on(tA,this.handleAudioLevelInterval,this),Rw?(Gw.on(wA,this.initAudioWorklet,this),Gw.on(AA,this.initScriptProcessor,this),this.preload()):this.initScriptProcessor(),Sx+=1}return c(e,[{key:"preload",value:function(){Ix?Ix.initWorkletSuccess&&this.initAudioWorklet():Ix=new Cx({context:yx})}},{key:"initAudioWorklet",value:function(){var e=this;if(!this.audioWorkletNode_)try{this.audioWorkletNode_=new AudioWorkletNode(this.audioCtx_,"volume-meter"),this.audioWorkletNode_.port.onmessage=function(t){e.volume_=t.data.volume||0},this.streamSource_.connect(this.audioWorkletNode_).connect(this.destination_),this.handleAudioLevelInterval({interval:this.interval_})}catch(oY){this.log_.warn("load volume meter failed, load again."),this.initScriptProcessor()}}},{key:"initScriptProcessor",value:function(){var e=this;if(!this.scriptProcessorNode_)try{this.scriptProcessorNode_=this.audioCtx_.createScriptProcessor(2048,1,1),this.scriptProcessorNode_.onaudioprocess=function(t){for(var n=t.inputBuffer.getChannelData(0),i=0,r=0;r<n.length;++r)i+=n[r]*n[r];e.volume_=Math.sqrt(i/n.length)||0},this.streamSource_.connect(this.scriptProcessorNode_),this.scriptProcessorNode_.connect(this.destination_)}catch(oY){this.log_.error("volumeMeter init script processor error: "+oY)}}},{key:"destroy",value:function(){var e;this.streamSource_&&this.streamSource_.disconnect(),this.scriptProcessorNode_&&(this.scriptProcessorNode_.onaudioprocess=null,this.scriptProcessorNode_.disconnect()),this.audioWorkletNode_&&(this.audioWorkletNode_.port.postMessage({name:"stop"}),this.audioWorkletNode_.port.onmessage=null,this.audioWorkletNode_.disconnect()),this.audioWorkletNode_=null,this.scriptProcessorNode_=null,this.audioCtx_=null,Gw.off(DA,this.resume,this),Gw.off(tA,this.handleAudioLevelInterval,this),Gw.off(wA,this.initAudioWorklet,this),Gw.off(AA,this.initScriptProcessor,this),Sx>0&&(Sx-=1),0===Sx&&(null===(e=yx)||void 0===e||e.close(),yx=null,Ix=null)}},{key:"resume",value:function(){var e;null===(e=yx)||void 0===e||e.resume()}},{key:"getInternalAudioLevel",value:function(){return this.volume_}},{key:"getCalculatedVolume",value:function(){return this.volume_.toFixed(2)}},{key:"handleAudioLevelInterval",value:function(e){var t,n=e.interval;this.interval_=n,null===(t=this.audioWorkletNode_)||void 0===t||t.port.postMessage({name:"setIntervalTime",intervalTime:n})}}]),e}(),kx=function(){function e(t){a(this,e),this.stream_=t.stream,this.userId_=t.stream.getUserId(),this.log_=this.stream_.getLogger(),this.track_=t.track,t.gainedTrack&&(this.gainedTrack_=t.gainedTrack),this.div_=t.div,this.muted_=t.muted,this.outputDeviceId_=t.outputDeviceId,this.volume_=t.volume,this.pausedRetryCount_=5,this.emitter_=new xw,this.initializeElement(),this.state_="NONE",this.volumeMeter_=new Ex({stream:this.stream_,track:this.gainedTrack_||this.track_,log:this.log_})}var t,i,r,s;return c(e,[{key:"isPlaying",get:function(){return this.state_===dC}},{key:"initializeElement",value:function(){if(this.isAudioElementInit()){var e=new MediaStream;e.addTrack(this.gainedTrack_||this.track_);var t=document.createElement(xT);t.srcObject=e,t.muted=this.muted_,t.setAttribute("id","audio_".concat(this.stream_.getId())),t.setAttribute("autoplay","autoplay"),t.setAttribute("playsinline","playsinline"),this.div_.appendChild(t),this.element_=t}this.handleEvents()}},{key:"setMuted",value:function(e){this.element_&&(this.element_.muted=e,this.muted_=e)}},{key:"play",value:(s=o(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.outputDeviceId_||!this.element_){e.next=3;break}return e.next=3,this.element_.setSinkId(this.outputDeviceId_);case 3:if(this.setVolume(this.volume_),e.prev=4,!this.element_){e.next=8;break}return e.next=8,this.element_.play();case 8:e.next=16;break;case 10:if(e.prev=10,e.t0=e.catch(4),t=ow({key:rb,data:{media:"Audio",error:e.t0}}),this.log_.warn(t),!t.includes("NotAllowedError")){e.next=16;break}throw new _L({code:vL.PLAY_NOT_ALLOWED,message:t});case 16:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(){return s.apply(this,arguments)})},{key:"handleEvents",value:function(){this.handleElementEvent=this.handleElementEvent.bind(this),this.handleTrackEvent=this.handleTrackEvent.bind(this),this.element_&&(this.element_.addEventListener(JT,this.handleElementEvent),this.element_.addEventListener($T,this.handleElementEvent),this.element_.addEventListener(XT,this.handleElementEvent),this.element_.addEventListener(ZT,this.handleElementEvent)),this.track_.addEventListener($T,this.handleTrackEvent),this.track_.addEventListener(WT,this.handleTrackEvent),this.track_.addEventListener(YT,this.handleTrackEvent),this.track_.readyState===$T&&this.handleTrackEvent({type:$T}),this.track_.muted&&this.handleTrackEvent({type:WT})}},{key:"handleElementEvent",value:(r=o(n().mark((function e(t){var i,r,o,a,s,c,u,l=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=t.type,e.t0=i,e.next=e.t0===JT?4:e.t0===$T?9:e.t0===XT?12:e.t0===ZT?21:32;break;case 4:return this.log_.info("audio player is playing"),this.state_=dC,Gw.emit(oA,{stream:this.stream_}),this.emitter_.emit(BN,{state:this.state_,reason:JT}),e.abrupt("break",32);case 9:return this.log_.info("audio player is ended"),this.state_!==hC&&(this.state_=hC,this.emitter_.emit(BN,{state:this.state_,reason:$T})),e.abrupt("break",32);case 12:return this.log_.info("audio player is paused"),this.state_=pC,this.emitter_.emit(BN,{state:this.state_,reason:XT}),(r=this.div_&&document.getElementById(this.div_.id))||this.log_.warn("audio player has been remove, element ID: ".concat(this.div_.id)),o=qD(),this.pausedRetryCount_>0&&(mw(o)&&o<=70||!r)&&(this.resume(),this.pausedRetryCount_--),Xb&&(this.interval_=QO.run((function(){l.element_&&l.state_===pC&&l.resume()}),{delay:3e3})),e.abrupt("break",32);case 21:if(!this.element_||!this.element_.error){e.next=31;break}return a="".concat(bN(),"/").concat(nw().name,"/").concat(nw().version),e.next=25,rY.getSpeakers();case 25:s=e.sent,c=s[0].label,(u=s.find((function(e){return e.deviceId===l.outputDeviceId_})))&&(c=u.label),this.log_.error("audio player error observed. code: ".concat(this.element_.error.code," message: ").concat(this.element_.error.message," deviceInfo: ").concat(a," speaker: ").concat(c)),sO.uploadEvent("stat-".concat(this.stream_.getType(),"-audio-").concat(kS,"-").concat(this.element_.error.code,"-").concat(a,"-").concat(c),this.element_.error);case 31:return e.abrupt("break",32);case 32:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"handleTrackEvent",value:function(e){var t=e.type;switch(t){case $T:this.log_.info("audio track is ended"),this.state_!==hC&&(this.state_=hC,this.emitter_.emit(BN,{state:this.state_,reason:$T})),Gw.emit(SA,{stream:this.stream_,type:t});break;case WT:this.log_.info("audio track is unable to provide media output"),this.stream_.isRemote()||Dw(),this.state_!==pC&&(this.state_=pC,this.emitter_.emit(BN,{state:this.state_,reason:WT})),Gw.emit(CA,{stream:this.stream_,type:t});break;case YT:this.log_.info("audio track is able to provide media output"),this.state_===pC&&(this.state_=dC,this.emitter_.emit(BN,{state:this.state_,reason:YT}))}}},{key:"unbindEvents",value:function(){this.element_&&(this.element_.removeEventListener(JT,this.handleElementEvent),this.element_.removeEventListener($T,this.handleElementEvent),this.element_.removeEventListener(XT,this.handleElementEvent),this.element_.removeEventListener(ZT,this.handleElementEvent)),this.track_&&(this.track_.removeEventListener($T,this.handleTrackEvent),this.track_.removeEventListener(WT,this.handleTrackEvent),this.track_.removeEventListener(YT,this.handleTrackEvent))}},{key:"setSinkId",value:(i=o(n().mark((function e(t){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.outputDeviceId_===t){e.next=5;break}if(!this.element_){e.next=4;break}return e.next=4,this.element_.setSinkId(t);case 4:this.outputDeviceId_=t;case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setVolume",value:function(e){this.element_&&(this.log_.info("audioElement setVolume to : ".concat(e)),this.element_.volume=e)}},{key:"getAudioLevel",value:function(){return this.volumeMeter_.getCalculatedVolume()}},{key:"getInternalAudioLevel",value:function(){return this.volumeMeter_.getInternalAudioLevel()}},{key:"stop",value:function(){this.unbindEvents(),this.element_&&(this.div_.removeChild(this.element_),this.element_.srcObject=null,this.element_=null),this.volumeMeter_&&(this.volumeMeter_.destroy(),this.volumeMeter_=null),this.interval_>0&&QO.clearTask(this.interval_)}},{key:"resume",value:(t=o(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.volumeMeter_&&this.volumeMeter_.resume(),!this.element_){e.next=5;break}return e.next=5,this.element_.play();case 5:e.next=13;break;case 7:if(e.prev=7,e.t0=e.catch(0),t=ow({key:rb,data:{media:"Audio",error:e.t0}}),this.log_.warn(t),!t.includes("NotAllowedError")){e.next=13;break}throw new _L({code:vL.PLAY_NOT_ALLOWED,message:t});case 13:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return t.apply(this,arguments)})},{key:"on",value:function(e,t){this.emitter_.on(e,t)}},{key:"isAudioElementInit",value:function(){return!("15.2"===$D||"15.3"===$D||"15.4"===$D)||"local"!==this.stream_.getType()||!this.muted_||(this.log_.info("audioElement is muted."),!1)}}]),e}(),bx=Rn.PROPER,Dx=R,wx=a_,Ax=f_.trim;Er({target:"String",proto:!0,forced:function(e){return Dx((function(){return!!wx[e]()||"​᠎"!=="​᠎"[e]()||bx&&wx[e].name!==e}))}("trim")},{trim:function(){return Ax(this)}});var Rx="trtc_autoplay",Lx="".concat(Rx,"_mask"),Ox="".concat(Rx,"_wrapper"),Nx="".concat(Rx,"_header"),Px="".concat(Rx,"_content"),Ux="".concat(Rx,"_action_wrapper"),xx="".concat(Rx,"_question"),Gx="".concat(Rx,"_collapse"),Fx="".concat(Rx,"_action_confirm"),Vx="".concat(Rx,"_detail"),qx="#2473E8",Bx="dialog",Hx="".concat(Bx,"-show"),jx="".concat(Bx,"-1"),Kx="".concat(Bx,"-2"),zx=!1,Wx=function(){return!!document.querySelector(".".concat(Ox))},Yx="".concat(uE,"/").concat(bw()?"zh-cn":"en","/tutorial-21-advanced-auto-play-policy.html"),$x="<br><a href='".concat(Yx,"' target='_blank'>").concat(bw()?"其他方案？":"Any other solution?","</a>"),Jx="".concat(bw()?"浏览器自动播放策略：在用户与页面产生交互（点击、触摸）之前，浏览器禁止播放有声媒体。该弹窗用于帮助用户恢复音视频播放。".concat($x):"Autoplay Policy: Before user interacts with the web page (clicking, touching), page will not be allowed to play media with sound. This Dialog is used to help users resume playback. ".concat($x)),Xx=function(){function e(){if(a(this,e),this.dialogNode_=null,this.bodyPosition_="",this.content="音视频播放被浏览器拦截，请点击“恢复播放”。",bw()||(this.content='Media playback failed. Click the "Resume" to resume playback.'),!zx){var t=document.createElement("style");t.innerHTML=".".concat(Lx,"{position:fixed;top:0;left:0;right:0;bottom:0;width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;background:rgba(0,0,0,0.5);z-index:1500;}.").concat(Lx," div:not(.").concat(Ux,"){display:block !important;}.").concat(Ox,"{padding:14px;background:#fff;border-radius:3px;box-shadow:0px 3px 15px #434343;border:1px solid #d1cfcf;max-width:500px;}.").concat(Ox," a{color:").concat(qx,";}.").concat(Nx,"{overflow:hidden;text-overflow:ellipsis;font-size:16px;font-weight:600;}.").concat(Px,"{margin:8px 0;}.").concat(Ux,"{width:100%;display:flex !important;align-items:center;justify-content:right;float:right;}.").concat(Gx,"{margin-right:auto;cursor:pointer}.").concat(xx,"{height:100%;line-height:16px;cursor:pointer;}.").concat(Fx,"{margin-left:8px;color:#fff;background:").concat(qx,";padding:4px 12px;outline:none;border:1px solid;border-radius:3px;font-weight:bold;}.").concat(Fx,":hover{opacity:0.9;}.").concat(Gx,",.").concat(Fx,",.").concat(Px,",.").concat(xx,"{font-size:14px;}@media screen and (max-width:750px){.").concat(Ox,"{width:80vw;}}"),document.head.appendChild(t),zx=!0}this.showDetail_=!1,this.isCollapseClicked_=!1,this.isQuestionClicked_=!1,this.addDiaLog()}return c(e,[{key:"createDiaLog",value:function(){var e=document.createElement("template");e.innerHTML='<div class="'.concat(Lx,"\"><div class='").concat(Ox,"'><div class='").concat(Nx,"'>").concat(location.host,"</div><div class='").concat(Px,"'>").concat(this.content,"</div><div class='").concat(Vx,'\' style="visibility:hidden;width:100%;height:0;font-size:12px;color:gray;">').concat(Jx,"</div><div class='").concat(Ux,"'></div></div></div>").trim();var t=document.createElement("button");t.className=Fx,t.innerText=bw()?"恢复播放":"Resume",t.onclick=this.onConfirm.bind(this);var n=document.createElement("div");n.className=xx,n.innerHTML='<?xml version="1.0" encoding="UTF-8"?>\n    <svg class="icon" width="18" height="18" p-id="2030" t="1639646523624" version="1.1" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">\n    <path d="m464 784.35c0 26.51 21.49 48 48 48s48-21.49 48-48-21.49-48-48-48-48 21.49-48 48z" p-id="2031"/>\n    <path d="m512 960c-247.04 0-448-200.96-448-448s200.96-448 448-448 448 200.96 448 448-200.96 448-448 448zm0-831.71c-211.58 0-383.71 172.13-383.71 383.71 0 211.55 172.13 383.71 383.71 383.71 211.55 0 383.71-172.16 383.71-383.71 0-211.58-172.16-383.71-383.71-383.71z" p-id="2032"/>\n    <path d="m512 673.7c-17.665 0-32.001-14.336-32.001-31.999v-54.112c0-52.353 40-92.352 75.328-127.65 25.887-25.92 52.672-52.672 52.672-74.017 0-53.343-43.072-96.735-95.999-96.735-53.823 0-95.999 41.536-95.999 94.559 0 17.665-14.336 31.999-32.001 31.999s-32.001-14.336-32.001-31.999c0-87.424 71.775-158.56 160-158.56s160 72.095 160 160.74c0 47.904-36.32 84.192-71.424 119.3-27.84 27.776-56.576 56.512-56.576 82.336v54.112c0 17.665-14.336 32.032-32.001 32.032z" p-id="2033"/>\n    </svg>\n    ',n.onclick=this.onQuestionClick.bind(this);var i=document.createElement("div");i.className=Gx,i.innerText="".concat(bw()?"详情 >":"Detail >"),i.onclick=this.onCollapseClick.bind(this);var r=e.content.firstChild,o=r.querySelector(".".concat(Ux));return o.appendChild(i),o.appendChild(n),o.appendChild(t),r}},{key:"addDiaLog",value:function(){Wx()||(this.dialogNode_=this.createDiaLog(),document.body.appendChild(this.dialogNode_),this.dialogNode_.onclick=this.onConfirm.bind(this),this.dialogNode_.querySelector(".".concat(Ox)).onclick=function(e){return e.stopPropagation()},this.bodyPosition_=document.body.style.position,document.body.style.position="fixed",PA.info("show autoplay dialog"),sO.uploadEvent({log:Hx}))}},{key:"deleteDiaLog",value:function(){this.dialogNode_&&(document.body.removeChild(this.dialogNode_),document.body.style.position=this.bodyPosition_,this.dialogNode_=null)}},{key:"onConfirm",value:function(){PA.warn("confirm clicked, try resume stream"),Gw.emit(DA),this.deleteDiaLog()}},{key:"onCollapseClick",value:function(){var e=this.dialogNode_.querySelector(".".concat(Vx));e.style.visibility="".concat(this.showDetail_?"hidden":"visible"),e.style.height="".concat(this.showDetail_?0:"fit-content"),this.showDetail_=!this.showDetail_,this.isCollapseClicked_||sO.uploadEvent({log:jx}),this.isCollapseClicked_=!0}},{key:"onQuestionClick",value:function(){window.open(Yx,"_blank"),this.isQuestionClicked_||sO.uploadEvent({log:Kx}),this.isQuestionClicked_=!0}}]),e}(),Zx=function(){function e(t){a(this,e),this.stream_=t.stream,this.userId_=t.stream.getUserId(),this.log_=this.stream_.getLogger(),this.track_=t.track,this.div_=t.div,this.muted_=t.muted,this.objectFit_=t.objectFit,this.mirror_=t.mirror,this.emitter_=new xw,this.initializeElement(),this.state_="NONE",this.pausedRetryCount_=5}var t;return c(e,[{key:"isPlaying",get:function(){return this.state_===dC}},{key:"initializeElement",value:function(){var e=new MediaStream;e.addTrack(this.track_);var t=document.createElement(GT);t.srcObject=e,t.muted=!0;var n="width: 100%; height: 100%; object-fit: ".concat(this.objectFit_,";");this.mirror_&&(n+="transform: scaleX(-1);"),t.setAttribute("id","video_".concat(this.stream_.getId())),t.setAttribute("style",n),t.setAttribute("autoplay","autoplay"),t.setAttribute("playsinline","playsinline"),this.div_&&this.div_.appendChild(t),this.element_=t,this.handleEvents()}},{key:"setRect",value:function(e){var t=e.width,n=e.height;this.element_&&(this.element_.style.width=t+"px",this.element_.style.height=n+"px")}},{key:"setMirror",value:function(e){this.element_&&(this.element_.style.transform=e?"scaleX(-1)":"",this.mirror_=e)}},{key:"setObjectFit",value:function(e){this.element_&&(this.element_.style.objectFit="".concat(e),this.objectFit_=e)}},{key:"play",value:(t=o(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.element_.play();case 3:e.next=11;break;case 5:if(e.prev=5,e.t0=e.catch(0),t=ow({key:rb,data:{media:"Video",error:e.t0}}),this.log_.warn(t),!t.includes("NotAllowedError")){e.next=11;break}throw new _L({code:vL.PLAY_NOT_ALLOWED,message:t});case 11:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return t.apply(this,arguments)})},{key:"handleEvents",value:function(){this.handleElementEvent=this.handleElementEvent.bind(this),this.handleTrackEvent=this.handleTrackEvent.bind(this),this.element_.addEventListener(JT,this.handleElementEvent),this.element_.addEventListener($T,this.handleElementEvent),this.element_.addEventListener(XT,this.handleElementEvent),this.element_.addEventListener(ZT,this.handleElementEvent),this.element_.addEventListener(QT,this.handleElementEvent),this.track_.addEventListener($T,this.handleTrackEvent),this.track_.addEventListener(WT,this.handleTrackEvent),this.track_.addEventListener(YT,this.handleTrackEvent),this.track_.readyState===$T&&this.handleTrackEvent({type:$T}),this.track_.muted&&this.handleTrackEvent({type:WT})}},{key:"handleElementEvent",value:function(e){var t=this;switch(e.type){case JT:this.log_.info("video player is playing"),this.state_=dC,Gw.emit(rA,{stream:this.stream_}),this.emitter_.emit(BN,{state:this.state_,reason:JT}),this.interval_&&(QO.clearTask(this.interval_),this.interval_=null);break;case $T:this.log_.info("video player is ended"),this.state_!==hC&&(this.state_=hC,this.emitter_.emit(BN,{state:this.state_,reason:$T}));break;case XT:this.log_.info("video player is paused"),this.div_&&!document.getElementById(this.div_.id)&&this.log_.warn("video player has been remove, element ID: ".concat(this.div_.id)),this.state_=pC,this.emitter_.emit(BN,{state:this.state_,reason:XT}),this.pausedRetryCount_>0&&!Wx()&&(this.log_.info("video player auto resume when video paused"),this.resume(),this.pausedRetryCount_--),Xb&&(this.interval_=QO.run((function(){t.element_&&t.state_===pC&&t.resume()}),{delay:3e3}));break;case ZT:if(this.element_&&this.element_.error){var n="".concat(bN(),"/").concat(nw().name,"/").concat(nw().version);this.log_.error("video player error observed. code: ".concat(this.element_.error.code," message: ").concat(this.element_.error.message," deviceInfo: ").concat(n)),sO.uploadEvent("stat-".concat(this.stream_.getType(),"-video-").concat(kS,"-").concat(this.element_.error.code,"-").concat(n),this.element_.error)}break;case QT:Gw.emit(IA,{stream:this.stream_})}}},{key:"handleTrackEvent",value:function(e){var t=e.type;switch(t){case $T:this.log_.info("video track is ended"),Gw.emit(TA,{stream:this.stream_,type:t}),this.state_!==hC&&(this.state_=hC,this.emitter_.emit(BN,{state:this.state_,reason:$T}));break;case WT:this.log_.info("video track is unable to provide media output"),this.stream_.isRemote()||Dw(),Gw.emit(vA,{stream:this.stream_,type:t}),this.state_!==pC&&(this.state_=pC,this.emitter_.emit(BN,{state:this.state_,reason:WT}));break;case YT:this.log_.info("video track is able to provide media output"),Gw.emit(_A,{stream:this.stream_}),this.state_===pC&&(this.state_=dC,this.emitter_.emit(BN,{state:this.state_,reason:YT}))}}},{key:"unbindEvents",value:function(){this.element_&&(this.element_.removeEventListener(JT,this.handleElementEvent),this.element_.removeEventListener($T,this.handleElementEvent),this.element_.removeEventListener(XT,this.handleElementEvent),this.element_.removeEventListener(ZT,this.handleElementEvent),this.element_.removeEventListener(QT,this.handleElementEvent)),this.track_&&(this.track_.removeEventListener($T,this.handleTrackEvent),this.track_.removeEventListener(WT,this.handleTrackEvent),this.track_.removeEventListener(YT,this.handleTrackEvent))}},{key:"stop",value:function(){this.unbindEvents(),this.div_&&this.div_.removeChild(this.element_),this.element_.srcObject=null,this.element_=null,this.interval_&&QO.clearTask(this.interval_)}},{key:"resume",value:function(){return this.play()}},{key:"getVideoFrame",value:function(){var e=document.createElement("canvas");return e.width=this.element_.videoWidth,e.height=this.element_.videoHeight,e.getContext("2d").drawImage(this.element_,0,0),e.toDataURL("image/png")}},{key:"on",value:function(e,t){this.emitter_.on(e,t)}},{key:"getElement",value:function(){return this.element_?this.element_:null}}]),e}(),Qx="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,eG=Di,tG=Pi,nG=RangeError,iG=function(e){if(void 0===e)return 0;var t=eG(e),n=tG(t);if(t!==n)throw nG("Wrong length or index");return n},rG=Array,oG=Math.abs,aG=Math.pow,sG=Math.floor,cG=Math.log,uG=Math.LN2,lG=pt,dG=Li,pG=xi,hG=function(e){for(var t=lG(this),n=pG(t),i=arguments.length,r=dG(i>1?arguments[1]:void 0,n),o=i>2?arguments[2]:void 0,a=void 0===o?n:dG(o,n);a>r;)t[r++]=e;return t},fG=w,gG=te,mG=L,vG=Qx,_G=Rn,yG=Sn,IG=Gl,MG=R,TG=dl,CG=Di,SG=Pi,EG=iG,kG={pack:function(e,t,n){var i,r,o,a=rG(n),s=8*n-t-1,c=(1<<s)-1,u=c>>1,l=23===t?aG(2,-24)-aG(2,-77):0,d=e<0||0===e&&1/e<0?1:0,p=0;for((e=oG(e))!=e||1/0===e?(r=e!=e?1:0,i=c):(i=sG(cG(e)/uG),e*(o=aG(2,-i))<1&&(i--,o*=2),(e+=i+u>=1?l/o:l*aG(2,1-u))*o>=2&&(i++,o/=2),i+u>=c?(r=0,i=c):i+u>=1?(r=(e*o-1)*aG(2,t),i+=u):(r=e*aG(2,u-1)*aG(2,t),i=0));t>=8;)a[p++]=255&r,r/=256,t-=8;for(i=i<<t|r,s+=t;s>0;)a[p++]=255&i,i/=256,s-=8;return a[--p]|=128*d,a},unpack:function(e,t){var n,i=e.length,r=8*i-t-1,o=(1<<r)-1,a=o>>1,s=r-7,c=i-1,u=e[c--],l=127&u;for(u>>=7;s>0;)l=256*l+e[c--],s-=8;for(n=l&(1<<-s)-1,l>>=-s,s+=t;s>0;)n=256*n+e[c--],s-=8;if(0===l)l=1-a;else{if(l===o)return n?NaN:u?-1/0:1/0;n+=aG(2,t),l-=a}return(u?-1:1)*n*aG(2,l-t)}},bG=Ps,DG=sc,wG=Si.f,AG=on.f,RG=hG,LG=Qc,OG=Ws,NG=_G.PROPER,PG=_G.CONFIGURABLE,UG=ai.get,xG=ai.set,GG="ArrayBuffer",FG="DataView",VG="Wrong index",qG=fG.ArrayBuffer,BG=qG,HG=BG&&BG.prototype,jG=fG.DataView,KG=jG&&jG.prototype,zG=Object.prototype,WG=fG.Array,YG=fG.RangeError,$G=gG(RG),JG=gG([].reverse),XG=kG.pack,ZG=kG.unpack,QG=function(e){return[255&e]},eF=function(e){return[255&e,e>>8&255]},tF=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},nF=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},iF=function(e){return XG(e,23,4)},rF=function(e){return XG(e,52,8)},oF=function(e,t){AG(e.prototype,t,{get:function(){return UG(this)[t]}})},aF=function(e,t,n,i){var r=EG(n),o=UG(e);if(r+t>o.byteLength)throw YG(VG);var a=UG(o.buffer).bytes,s=r+o.byteOffset,c=LG(a,s,s+t);return i?c:JG(c)},sF=function(e,t,n,i,r,o){var a=EG(n),s=UG(e);if(a+t>s.byteLength)throw YG(VG);for(var c=UG(s.buffer).bytes,u=a+s.byteOffset,l=i(+r),d=0;d<t;d++)c[u+d]=l[o?d:t-d-1]};if(vG){var cF=NG&&qG.name!==GG;if(MG((function(){qG(1)}))&&MG((function(){new qG(-1)}))&&!MG((function(){return new qG,new qG(1.5),new qG(NaN),1!=qG.length||cF&&!PG})))cF&&PG&&yG(qG,"name",GG);else{(BG=function(e){return TG(this,HG),new qG(EG(e))}).prototype=HG;for(var uF,lF=wG(qG),dF=0;lF.length>dF;)(uF=lF[dF++])in BG||yG(BG,uF,qG[uF]);HG.constructor=BG}DG&&bG(KG)!==zG&&DG(KG,zG);var pF=new jG(new BG(2)),hF=gG(KG.setInt8);pF.setInt8(0,2147483648),pF.setInt8(1,2147483649),!pF.getInt8(0)&&pF.getInt8(1)||IG(KG,{setInt8:function(e,t){hF(this,e,t<<24>>24)},setUint8:function(e,t){hF(this,e,t<<24>>24)}},{unsafe:!0})}else HG=(BG=function(e){TG(this,HG);var t=EG(e);xG(this,{bytes:$G(WG(t),0),byteLength:t}),mG||(this.byteLength=t)}).prototype,KG=(jG=function(e,t,n){TG(this,KG),TG(e,HG);var i=UG(e).byteLength,r=CG(t);if(r<0||r>i)throw YG("Wrong offset");if(r+(n=void 0===n?i-r:SG(n))>i)throw YG("Wrong length");xG(this,{buffer:e,byteLength:n,byteOffset:r}),mG||(this.buffer=e,this.byteLength=n,this.byteOffset=r)}).prototype,mG&&(oF(BG,"byteLength"),oF(jG,"buffer"),oF(jG,"byteLength"),oF(jG,"byteOffset")),IG(KG,{getInt8:function(e){return aF(this,1,e)[0]<<24>>24},getUint8:function(e){return aF(this,1,e)[0]},getInt16:function(e){var t=aF(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=aF(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return nF(aF(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return nF(aF(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return ZG(aF(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return ZG(aF(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){sF(this,1,e,QG,t)},setUint8:function(e,t){sF(this,1,e,QG,t)},setInt16:function(e,t){sF(this,2,e,eF,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){sF(this,2,e,eF,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){sF(this,4,e,tF,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){sF(this,4,e,tF,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){sF(this,4,e,iF,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){sF(this,8,e,rF,t,arguments.length>2?arguments[2]:void 0)}});OG(BG,GG),OG(jG,FG);var fF={ArrayBuffer:BG,DataView:jG},gF=Er,mF=te,vF=R,_F=ln,yF=Li,IF=Pi,MF=Gy,TF=fF.ArrayBuffer,CF=fF.DataView,SF=CF.prototype,EF=mF(TF.prototype.slice),kF=mF(SF.getUint8),bF=mF(SF.setUint8);gF({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:vF((function(){return!new TF(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(EF&&void 0===t)return EF(_F(this),e);for(var n=_F(this).byteLength,i=yF(e,n),r=yF(void 0===t?n:t,n),o=new(MF(this,TF))(IF(r-i)),a=new CF(this),s=new CF(o),c=0;i<r;)bF(s,c++,kF(a,i++));return o}}),Er({global:!0,constructor:!0,forced:!Qx},{DataView:fF.DataView});var DF=Er,wF=Rr,AF=te([].reverse),RF=[1,2];DF({target:"Array",proto:!0,forced:String(RF)===String(RF.reverse())},{reverse:function(){return wF(this)&&(this.length=this.length),AF(this)}});var LF=Ye,OF=pt,NF=ae,PF=xi,UF=TypeError,xF=function(e){return function(t,n,i,r){LF(n);var o=OF(t),a=NF(o),s=PF(o),c=e?s-1:0,u=e?-1:1;if(i<2)for(;;){if(c in a){r=a[c],c+=u;break}if(c+=u,e?c<0:s<=c)throw UF("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=u)c in a&&(r=n(r,a[c],c,o));return r}},GF={left:xF(!1),right:xF(!0)},FF=GF.left,VF=Oe,qF=wy;Er({target:"Array",proto:!0,forced:!wp("reduce")||!qF&&VF>79&&VF<83},{reduce:function(e){var t=arguments.length;return FF(this,e,t,t>1?arguments[1]:void 0)}});var BF=Hl,HF="ArrayBuffer",jF=fF.ArrayBuffer;Er({global:!0,constructor:!0,forced:w.ArrayBuffer!==jF},{ArrayBuffer:jF}),BF(HF);var KF=Er,zF=Rr,WF=eo,YF=Ie,$F=Li,JF=xi,XF=he,ZF=Wc,QF=Rt,eV=Kd,tV=Io("slice"),nV=QF("species"),iV=Array,rV=Math.max;KF({target:"Array",proto:!0,forced:!tV},{slice:function(e,t){var n,i,r,o=XF(this),a=JF(o),s=$F(e,a),c=$F(void 0===t?a:t,a);if(zF(o)&&(n=o.constructor,(WF(n)&&(n===iV||zF(n.prototype))||YF(n)&&null===(n=n[nV]))&&(n=void 0),n===iV||void 0===n))return eV(o,s,c);for(i=new(void 0===n?iV:n)(rV(c-s,0)),r=0;s<c;s++,r++)s in o&&ZF(i,r,o[s]);return i.length=r,i}});var oV=w,aV=R,sV=te,cV=sd,uV=f_.trim,lV=a_,dV=oV.parseInt,pV=oV.Symbol,hV=pV&&pV.iterator,fV=/^[+-]?0x/i,gV=sV(fV.exec),mV=8!==dV(lV+"08")||22!==dV(lV+"0x16")||hV&&!aV((function(){dV(Object(hV))}))?function(e,t){var n=uV(cV(e));return dV(n,t>>>0||(gV(fV,n)?16:10))}:dV;Er({global:!0,forced:parseInt!=mV},{parseInt:mV});var vV,_V,yV,IV={exports:{}},MV=Qx,TV=L,CV=w,SV=ve,EV=Ie,kV=gt,bV=Vr,DV=je,wV=Sn,AV=Ci,RV=on.f,LV=Ee,OV=Ps,NV=sc,PV=Rt,UV=It,xV=ai.enforce,GV=ai.get,FV=CV.Int8Array,VV=FV&&FV.prototype,qV=CV.Uint8ClampedArray,BV=qV&&qV.prototype,HV=FV&&OV(FV),jV=VV&&OV(VV),KV=Object.prototype,zV=CV.TypeError,WV=PV("toStringTag"),YV=UV("TYPED_ARRAY_TAG"),$V="TypedArrayConstructor",JV=MV&&!!NV&&"Opera"!==bV(CV.opera),XV=!1,ZV={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},QV={BigInt64Array:8,BigUint64Array:8},eq=function(e){var t=OV(e);if(EV(t)){var n=GV(t);return n&&kV(n,$V)?n.TypedArrayConstructor:eq(t)}},tq=function(e){if(!EV(e))return!1;var t=bV(e);return kV(ZV,t)||kV(QV,t)};for(vV in ZV)(yV=(_V=CV[vV])&&_V.prototype)?xV(yV).TypedArrayConstructor=_V:JV=!1;for(vV in QV)(yV=(_V=CV[vV])&&_V.prototype)&&(xV(yV).TypedArrayConstructor=_V);if((!JV||!SV(HV)||HV===Function.prototype)&&(HV=function(){throw zV("Incorrect invocation")},JV))for(vV in ZV)CV[vV]&&NV(CV[vV],HV);if((!JV||!jV||jV===KV)&&(jV=HV.prototype,JV))for(vV in ZV)CV[vV]&&NV(CV[vV].prototype,jV);if(JV&&OV(BV)!==jV&&NV(BV,jV),TV&&!kV(jV,WV))for(vV in XV=!0,RV(jV,WV,{get:function(){return EV(this)?this[YV]:void 0}}),ZV)CV[vV]&&wV(CV[vV],YV,vV);var nq={NATIVE_ARRAY_BUFFER_VIEWS:JV,TYPED_ARRAY_TAG:XV&&YV,aTypedArray:function(e){if(tq(e))return e;throw zV("Target is not a typed array")},aTypedArrayConstructor:function(e){if(SV(e)&&(!NV||LV(HV,e)))return e;throw zV(DV(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n,i){if(TV){if(n)for(var r in ZV){var o=CV[r];if(o&&kV(o.prototype,e))try{delete o.prototype[e]}catch(oY){try{o.prototype[e]=t}catch(a){}}}jV[e]&&!n||AV(jV,e,n?t:JV&&VV[e]||t,i)}},exportTypedArrayStaticMethod:function(e,t,n){var i,r;if(TV){if(NV){if(n)for(i in ZV)if((r=CV[i])&&kV(r,e))try{delete r[e]}catch(oY){}if(HV[e]&&!n)return;try{return AV(HV,e,n?t:JV&&HV[e]||t)}catch(oY){}}for(i in ZV)!(r=CV[i])||r[e]&&!n||AV(r,e,t)}},getTypedArrayConstructor:eq,isView:function(e){if(!EV(e))return!1;var t=bV(e);return"DataView"===t||kV(ZV,t)||kV(QV,t)},isTypedArray:tq,TypedArray:HV,TypedArrayPrototype:jV},iq=w,rq=R,oq=ml,aq=nq.NATIVE_ARRAY_BUFFER_VIEWS,sq=iq.ArrayBuffer,cq=iq.Int8Array,uq=!aq||!rq((function(){cq(1)}))||!rq((function(){new cq(-1)}))||!oq((function(e){new cq,new cq(null),new cq(1.5),new cq(e)}),!0)||rq((function(){return 1!==new cq(new sq(2),1,void 0).length})),lq=Di,dq=RangeError,pq=function(e){var t=lq(e);if(t<0)throw dq("The argument can't be less than 0");return t},hq=RangeError,fq=function(e,t){var n=pq(e);if(n%t)throw hq("Wrong offset");return n},gq=Vr,mq=te("".slice),vq=Ft,_q=TypeError,yq=function(e){var t=vq(e,"number");if("number"==typeof t)throw _q("Can't convert number to bigint");return BigInt(t)},Iq=wr,Mq=U,Tq=Oy,Cq=pt,Sq=xi,Eq=ju,kq=xu,bq=Ru,Dq=function(e){return"Big"===mq(gq(e),0,3)},wq=nq.aTypedArrayConstructor,Aq=yq,Rq=Er,Lq=w,Oq=U,Nq=L,Pq=uq,Uq=nq,xq=fF,Gq=dl,Fq=H,Vq=Sn,qq=FA,Bq=Pi,Hq=iG,jq=fq,Kq=Bt,zq=gt,Wq=Vr,Yq=Ie,$q=Be,Jq=ms,Xq=Ee,Zq=sc,Qq=Si.f,eB=function(e){var t,n,i,r,o,a,s,c,u=Tq(this),l=Cq(e),d=arguments.length,p=d>1?arguments[1]:void 0,h=void 0!==p,f=kq(l);if(f&&!bq(f))for(c=(s=Eq(l,f)).next,l=[];!(a=Mq(c,s)).done;)l.push(a.value);for(h&&d>2&&(p=Iq(p,arguments[2])),n=Sq(l),i=new(wq(u))(n),r=Dq(i),t=0;n>t;t++)o=h?p(l[t],t):l[t],i[t]=r?Aq(o):+o;return i},tB=mo.forEach,nB=Hl,iB=on,rB=A,oB=Il,aB=ai.get,sB=ai.set,cB=ai.enforce,uB=iB.f,lB=rB.f,dB=Math.round,pB=Lq.RangeError,hB=xq.ArrayBuffer,fB=hB.prototype,gB=xq.DataView,mB=Uq.NATIVE_ARRAY_BUFFER_VIEWS,vB=Uq.TYPED_ARRAY_TAG,_B=Uq.TypedArray,yB=Uq.TypedArrayPrototype,IB=Uq.aTypedArrayConstructor,MB=Uq.isTypedArray,TB="BYTES_PER_ELEMENT",CB="Wrong length",SB=function(e,t){IB(e);for(var n=0,i=t.length,r=new e(i);i>n;)r[n]=t[n++];return r},EB=function(e,t){uB(e,t,{get:function(){return aB(this)[t]}})},kB=function(e){var t;return Xq(fB,e)||"ArrayBuffer"==(t=Wq(e))||"SharedArrayBuffer"==t},bB=function(e,t){return MB(e)&&!$q(t)&&t in e&&qq(+t)&&t>=0},DB=function(e,t){return t=Kq(t),bB(e,t)?Fq(2,e[t]):lB(e,t)},wB=function(e,t,n){return t=Kq(t),!(bB(e,t)&&Yq(n)&&zq(n,"value"))||zq(n,"get")||zq(n,"set")||n.configurable||zq(n,"writable")&&!n.writable||zq(n,"enumerable")&&!n.enumerable?uB(e,t,n):(e[t]=n.value,e)};Nq?(mB||(rB.f=DB,iB.f=wB,EB(yB,"buffer"),EB(yB,"byteOffset"),EB(yB,"byteLength"),EB(yB,"length")),Rq({target:"Object",stat:!0,forced:!mB},{getOwnPropertyDescriptor:DB,defineProperty:wB}),IV.exports=function(e,t,n){var i=e.match(/\d+$/)[0]/8,r=e+(n?"Clamped":"")+"Array",o="get"+e,a="set"+e,s=Lq[r],c=s,u=c&&c.prototype,l={},d=function(e,t){uB(e,t,{get:function(){return e=t,(n=aB(this)).view[o](e*i+n.byteOffset,!0);var e,n},set:function(e){return r=t,o=e,s=aB(this),n&&(o=(o=dB(o))<0?0:o>255?255:255&o),void s.view[a](r*i+s.byteOffset,o,!0);var r,o,s},enumerable:!0})};mB?Pq&&(c=t((function(e,t,n,r){return Gq(e,u),oB(Yq(t)?kB(t)?void 0!==r?new s(t,jq(n,i),r):void 0!==n?new s(t,jq(n,i)):new s(t):MB(t)?SB(c,t):Oq(eB,c,t):new s(Hq(t)),e,c)})),Zq&&Zq(c,_B),tB(Qq(s),(function(e){e in c||Vq(c,e,s[e])})),c.prototype=u):(c=t((function(e,t,n,r){Gq(e,u);var o,a,s,l=0,p=0;if(Yq(t)){if(!kB(t))return MB(t)?SB(c,t):Oq(eB,c,t);o=t,p=jq(n,i);var h=t.byteLength;if(void 0===r){if(h%i)throw pB(CB);if((a=h-p)<0)throw pB(CB)}else if((a=Bq(r)*i)+p>h)throw pB(CB);s=a/i}else s=Hq(t),o=new hB(a=s*i);for(sB(e,{buffer:o,byteOffset:p,byteLength:a,length:s,view:new gB(o)});l<s;)d(e,l++)})),Zq&&Zq(c,_B),u=c.prototype=Jq(yB)),u.constructor!==c&&Vq(u,"constructor",c),cB(u).TypedArrayConstructor=c,vB&&Vq(u,vB,r);var p=c!=s;l[r]=c,Rq({global:!0,constructor:!0,forced:p,sham:!mB},l),TB in c||Vq(c,TB,i),TB in u||Vq(u,TB,i),nB(r)}):IV.exports=function(){},(0,IV.exports)("Uint8",(function(e){return function(t,n,i){return e(this,t,n,i)}}));var AB=pt,RB=Li,LB=xi,OB=fp,NB=Math.min,PB=[].copyWithin||function(e,t){var n=AB(this),i=LB(n),r=RB(e,i),o=RB(t,i),a=arguments.length>2?arguments[2]:void 0,s=NB((void 0===a?i:RB(a,i))-o,i-r),c=1;for(o<r&&r<o+s&&(c=-1,o+=s-1,r+=s-1);s-- >0;)o in n?n[r]=n[o]:OB(n,r),r+=c,o+=c;return n},UB=nq,xB=te(PB),GB=UB.aTypedArray;(0,UB.exportTypedArrayMethod)("copyWithin",(function(e,t){return xB(GB(this),e,t,arguments.length>2?arguments[2]:void 0)}));var FB=mo.every,VB=nq.aTypedArray;(0,nq.exportTypedArrayMethod)("every",(function(e){return FB(VB(this),e,arguments.length>1?arguments[1]:void 0)}));var qB=hG,BB=yq,HB=Vr,jB=U,KB=R,zB=nq.aTypedArray,WB=nq.exportTypedArrayMethod,YB=te("".slice);WB("fill",(function(e){var t=arguments.length;zB(this);var n="Big"===YB(HB(this),0,3)?BB(e):+e;return jB(qB,this,n,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),KB((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})));var $B=xi,JB=Gy,XB=nq.aTypedArrayConstructor,ZB=nq.getTypedArrayConstructor,QB=function(e){return XB(JB(e,ZB(e)))},eH=function(e,t){for(var n=0,i=$B(t),r=new e(i);i>n;)r[n]=t[n++];return r},tH=QB,nH=mo.filter,iH=function(e,t){return eH(tH(e),t)},rH=nq.aTypedArray;(0,nq.exportTypedArrayMethod)("filter",(function(e){var t=nH(rH(this),e,arguments.length>1?arguments[1]:void 0);return iH(this,t)}));var oH=mo.find,aH=nq.aTypedArray;(0,nq.exportTypedArrayMethod)("find",(function(e){return oH(aH(this),e,arguments.length>1?arguments[1]:void 0)}));var sH=mo.findIndex,cH=nq.aTypedArray;(0,nq.exportTypedArrayMethod)("findIndex",(function(e){return sH(cH(this),e,arguments.length>1?arguments[1]:void 0)}));var uH=mo.forEach,lH=nq.aTypedArray;(0,nq.exportTypedArrayMethod)("forEach",(function(e){uH(lH(this),e,arguments.length>1?arguments[1]:void 0)}));var dH=Bi.includes,pH=nq.aTypedArray;(0,nq.exportTypedArrayMethod)("includes",(function(e){return dH(pH(this),e,arguments.length>1?arguments[1]:void 0)}));var hH=Bi.indexOf,fH=nq.aTypedArray;(0,nq.exportTypedArrayMethod)("indexOf",(function(e){return hH(fH(this),e,arguments.length>1?arguments[1]:void 0)}));var gH=w,mH=R,vH=te,_H=nq,yH=Vc,IH=Rt("iterator"),MH=gH.Uint8Array,TH=vH(yH.values),CH=vH(yH.keys),SH=vH(yH.entries),EH=_H.aTypedArray,kH=_H.exportTypedArrayMethod,bH=MH&&MH.prototype,DH=!mH((function(){bH[IH].call([1])})),wH=!!bH&&bH.values&&bH[IH]===bH.values&&"values"===bH.values.name,AH=function(){return TH(EH(this))};kH("entries",(function(){return SH(EH(this))}),DH),kH("keys",(function(){return CH(EH(this))}),DH),kH("values",AH,DH||!wH,{name:"values"}),kH(IH,AH,DH||!wH,{name:"values"});var RH=nq.aTypedArray,LH=nq.exportTypedArrayMethod,OH=te([].join);LH("join",(function(e){return OH(RH(this),e)}));var NH=jd,PH=he,UH=Di,xH=xi,GH=wp,FH=Math.min,VH=[].lastIndexOf,qH=!!VH&&1/[1].lastIndexOf(1,-0)<0,BH=GH("lastIndexOf"),HH=qH||!BH?function(e){if(qH)return NH(VH,this,arguments)||0;var t=PH(this),n=xH(t),i=n-1;for(arguments.length>1&&(i=FH(i,UH(arguments[1]))),i<0&&(i=n+i);i>=0;i--)if(i in t&&t[i]===e)return i||0;return-1}:VH,jH=jd,KH=HH,zH=nq.aTypedArray;(0,nq.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return jH(KH,zH(this),t>1?[e,arguments[1]]:[e])}));var WH=mo.map,YH=QB,$H=nq.aTypedArray;(0,nq.exportTypedArrayMethod)("map",(function(e){return WH($H(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(YH(e))(t)}))}));var JH=GF.left,XH=nq.aTypedArray;(0,nq.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return JH(XH(this),e,t,t>1?arguments[1]:void 0)}));var ZH=GF.right,QH=nq.aTypedArray;(0,nq.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return ZH(QH(this),e,t,t>1?arguments[1]:void 0)}));var ej=nq.aTypedArray,tj=nq.exportTypedArrayMethod,nj=Math.floor;tj("reverse",(function(){for(var e,t=this,n=ej(t).length,i=nj(n/2),r=0;r<i;)e=t[r],t[r++]=t[--n],t[n]=e;return t}));var ij=w,rj=U,oj=nq,aj=xi,sj=fq,cj=pt,uj=R,lj=ij.RangeError,dj=ij.Int8Array,pj=dj&&dj.prototype,hj=pj&&pj.set,fj=oj.aTypedArray,gj=oj.exportTypedArrayMethod,mj=!uj((function(){var e=new Uint8ClampedArray(2);return rj(hj,e,{length:1,0:3},1),3!==e[1]})),vj=mj&&oj.NATIVE_ARRAY_BUFFER_VIEWS&&uj((function(){var e=new dj(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));gj("set",(function(e){fj(this);var t=sj(arguments.length>1?arguments[1]:void 0,1),n=cj(e);if(mj)return rj(hj,this,n,t);var i=this.length,r=aj(n),o=0;if(r+t>i)throw lj("Wrong length");for(;o<r;)this[t+o]=n[o++]}),!mj||vj);var _j=QB,yj=Kd,Ij=nq.aTypedArray;(0,nq.exportTypedArrayMethod)("slice",(function(e,t){for(var n=yj(Ij(this),e,t),i=_j(this),r=0,o=n.length,a=new i(o);o>r;)a[r]=n[r++];return a}),R((function(){new Int8Array(1).slice()})));var Mj=mo.some,Tj=nq.aTypedArray;(0,nq.exportTypedArrayMethod)("some",(function(e){return Mj(Tj(this),e,arguments.length>1?arguments[1]:void 0)}));var Cj=ke.match(/firefox\/(\d+)/i),Sj=!!Cj&&+Cj[1],Ej=/MSIE|Trident/.test(ke),kj=ke.match(/AppleWebKit\/(\d+)\./),bj=!!kj&&+kj[1],Dj=te,wj=R,Aj=Ye,Rj=Og,Lj=Sj,Oj=Ej,Nj=Oe,Pj=bj,Uj=nq.aTypedArray,xj=nq.exportTypedArrayMethod,Gj=w.Uint16Array,Fj=Gj&&Dj(Gj.prototype.sort),Vj=!(!Fj||wj((function(){Fj(new Gj(2),null)}))&&wj((function(){Fj(new Gj(2),{})}))),qj=!!Fj&&!wj((function(){if(Nj)return Nj<74;if(Lj)return Lj<67;if(Oj)return!0;if(Pj)return Pj<602;var e,t,n=new Gj(516),i=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,i[e]=e-2*t+3;for(Fj(n,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==i[e])return!0}));xj("sort",(function(e){return void 0!==e&&Aj(e),qj?Fj(this,e):Rj(Uj(this),(t=e,function(e,n){return void 0!==t?+t(e,n)||0:n!=n?-1:e!=e?1:0===e&&0===n?1/e>0&&1/n<0?1:-1:e>n}));var t}),!qj||Vj);var Bj=Pi,Hj=Li,jj=QB,Kj=nq.aTypedArray;(0,nq.exportTypedArrayMethod)("subarray",(function(e,t){var n=Kj(this),i=n.length,r=Hj(e,i);return new(jj(n))(n.buffer,n.byteOffset+r*n.BYTES_PER_ELEMENT,Bj((void 0===t?i:Hj(t,i))-r))}));var zj=jd,Wj=nq,Yj=R,$j=Kd,Jj=w.Int8Array,Xj=Wj.aTypedArray,Zj=Wj.exportTypedArrayMethod,Qj=[].toLocaleString,eK=!!Jj&&Yj((function(){Qj.call(new Jj(1))}));Zj("toLocaleString",(function(){return zj(Qj,eK?$j(Xj(this)):Xj(this),$j(arguments))}),Yj((function(){return[1,2].toLocaleString()!=new Jj([1,2]).toLocaleString()}))||!Yj((function(){Jj.prototype.toLocaleString.call([1,2])})));var tK=nq.exportTypedArrayMethod,nK=R,iK=te,rK=w.Uint8Array,oK=rK&&rK.prototype||{},aK=[].toString,sK=iK([].join);nK((function(){aK.call({})}))&&(aK=function(){return sK(this)});var cK=oK.toString!=aK;tK("toString",aK,cK);var uK=function(){function e(t,n,i){a(this,e),this.isUplink_=i,this.connection_=t,this.log_=n,this.seiMessageList_=[],this.seiPayloadType_=243,this.mainVideoSenderOrReceiver_=null,this.mainVideoAbortController_=null,this.abortMap_=new Map,this.onSEIMessage=null}return c(e,[{key:"isRunning",get:function(){return!!this.mainVideoAbortController_}},{key:"start",value:function(e){this.mainVideoSenderOrReceiver_=e;var t=e.createEncodedStreams(),n=t.readable,i=t.writable,r=new TransformStream({transform:this.isUplink_?this.encodeVideoFrame.bind(this):this.decodeVideoFrame.bind(this)});this.mainVideoAbortController_=new AbortController,n.pipeThrough(r).pipeTo(i,{signal:this.mainVideoAbortController_.signal}).catch((function(){}))}},{key:"restart",value:function(e){this.stop(),this.start(e)}},{key:"stop",value:function(){var e;null===(e=this.mainVideoAbortController_)||void 0===e||e.abort(),this.mainVideoAbortController_=null}},{key:"destroy",value:function(){this.stop(),this.abortMap_.forEach((function(e){return e.abort()})),this.abortMap_.clear(),this.log_=null,this.onSEIMessage=null,this.mainVideoSenderOrReceiver_=null,this.connection_=null}},{key:"handleEncodedStreams",value:function(){var e=this;try{var t=this.connection_.getPeerConnection();this.clearUnusedSenderOrReceiver(t),this.isUplink_?t.getSenders().forEach((function(t,n){if(1===n){if(t===e.mainVideoSenderOrReceiver_)return;e.isRunning?e.restart(t):e.start(t)}else{if(e.abortMap_.has(t))return;e.pipeSenderOrReceiver(t)}})):t.getReceivers().forEach((function(t,n){var i;e.abortMap_.has(t)||t===e.mainVideoSenderOrReceiver_||(1===n&&(null===(i=t.track)||void 0===i?void 0:i.kind)===GT?e.isRunning?e.restart(t):e.start(t):e.pipeSenderOrReceiver(t))}))}catch(oY){this.log_.warn(oY)}}},{key:"pipeSenderOrReceiver",value:function(e){var t=e.createEncodedStreams(),n=t.readable,i=t.writable,r=new AbortController;this.abortMap_.set(e,r),n.pipeTo(i,{signal:r.signal}).catch((function(){}))}},{key:"clearUnusedSenderOrReceiver",value:function(e){var t=this;this.abortMap_.forEach((function(n,i){(t.isUplink_?e.getSenders():e.getReceivers()).find((function(e){return e===i}))||(n.abort(),t.abortMap_.delete(i))}))}},{key:"push",value:function(e,t){t&&t.seiPayloadType&&(this.seiPayloadType_=t.seiPayloadType),this.seiMessageList_.push(e)}},{key:"hasSEI",value:function(e){var t=new DataView(e);return 1===t.getInt32(0)&&6===t.getInt8(4)}},{key:"isEmptyFrame",value:function(e){return"empty"===e.type||0===e.data.byteLength}},{key:"getNaluCount",value:function(e){for(var t=0,n=0,i=new DataView(e),r=0;r<e.byteLength;r++)switch(i.getUint8(r)){case 0:t++;break;case 1:2!==t&&3!==t||n++,t=0;break;default:t=0}return n}},{key:"encodeVideoFrame",value:function(e,t){try{if(this.connection_.isH264&&this.seiMessageList_.length>0&&!this.isEmptyFrame(e)){var n=9-this.getNaluCount(e.data);if(n<=0)return;for(var i=this.seiMessageList_.splice(0,n).reverse().map(this.encodeSEINalu.bind(this)),r=i.reduce((function(e,t){return e+t.dataView.byteLength}),0),o=new ArrayBuffer(r+e.data.byteLength),a=new DataView(o),s=new DataView(e.data),c=0,u=0;u<i.length;u++)for(var l=0;l<i[u].dataView.byteLength;l++)a.setInt8(c++,i[u].dataView.getInt8(l));for(var d=0;d<e.data.byteLength;d++)a.setInt8(c++,s.getInt8(d));e.data=o,this.log_.debug("".concat(i.length," sei sent"))}}catch(oY){this.log_.warn(oY)}t.enqueue(e)}},{key:"decodeVideoFrame",value:function(e,t){var n=this;try{if(this.connection_.isH264&&!this.isEmptyFrame(e)&&this.hasSEI(e.data)){for(var i=[],r=new DataView(e.data),o=0,a=-1,s=-1,c=0;c<e.data.byteLength;c++){var u=r.getUint8(c);if(0===u)o++;else if(1===u){if(2===o||3===o){var l=c-o;if(-1===a?a=l:-1===s&&(s=l,i.push(new lK(new DataView(r.buffer.slice(a,s)))),a=l,s=-1),6!==r.getUint8(c+1)){e.data=new DataView(r.buffer.slice(l)).buffer;break}}o=0}else o=0}this.log_.debug("".concat(i.length," sei received")),hw(this.onSEIMessage)&&i.reverse().forEach((function(e){n.onSEIMessage({seiPayloadType:e.seiPayloadType,data:e.seiPayload.buffer})}))}}catch(oY){this.log_.warn(oY)}t.enqueue(e)}},{key:"encodeSEINalu",value:function(e){var t=e.byteLength,n=parseInt(t/255),i=t%255,r=[];r.push(0,0,0,1,6,this.seiPayloadType_);for(var o=0;o<n;o++)r.push(255);r.push(i);var a=new DataView(e);return r.push.apply(r,M(new Uint8Array(a.buffer))),r.push(128),new lK(new DataView(new Uint8Array(r).buffer),!0)}}]),e}(),lK=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a(this,e),this.dataView=t,this.isSEI&&(n?this.addPreventionByte():this.removePreventionByte())}return c(e,[{key:"addPreventionByte",value:function(){for(var e=this.seiPayloadStartIndex,t=this.dataView.byteLength-2,n=[],i=0,r=e;r<=t;r++){var o=this.dataView.getInt8(r);switch(o){case 0:case 1:case 2:case 3:2===i&&(n.push(3),i=0),0==o?i++:i=0,n.push(o);break;default:i=0,n.push(o)}}n.push(this.dataView.getInt8(this.dataView.byteLength-1));var a=new DataView(new Uint8Array([].concat(M(new Uint8Array(this.dataView.buffer).slice(0,e)),n)).buffer);this.dataView=a}},{key:"removePreventionByte",value:function(){for(var e=this.seiPayloadStartIndex,t=this.dataView.byteLength-1,n=[],i=0,r=e;r<=t;r++)switch(this.dataView.getInt8(r)){case 0:i++,n.push(this.dataView.getInt8(r));break;case 3:2!==i&&n.push(this.dataView.getInt8(r)),i=0;break;default:n.push(this.dataView.getInt8(r)),i=0}var o=new DataView(new Uint8Array([].concat(M(new Uint8Array(this.dataView.buffer).slice(0,e)),n)).buffer);this.dataView=o}},{key:"isSEI",get:function(){return 6===this.dataView.getUint8(4)}},{key:"seiPayloadStartIndex",get:function(){for(var e=6,t=6;t<this.dataView.buffer.byteLength&&(e++,255===this.dataView.getUint8(t));t++);return e}},{key:"seiPayloadType",get:function(){return this.isSEI?this.dataView.getUint8(5):null}},{key:"seiPayload",get:function(){if(!this.isSEI)return null;for(var e=0,t=6,n=6;n<this.dataView.buffer.byteLength;n++){var i=this.dataView.getUint8(n);if(t++,255!==i){e+=i;break}e+=255}for(var r=new ArrayBuffer(e),o=new DataView(r),a=0;a<r.byteLength;a++,t++)o.setInt8(a,this.dataView.getInt8(t));return o}}]),e}(),dK=function(){function e(t){a(this,e),this.userId_=t.userId,this.tinyId_=t.tinyId,this.client_=t.client,this.sdpSemantics_=t.client.getSdpSemantics(),this.isUplink_=t.isUplink,this.log_=PA.createLogger({id:"n|"+this.userId_,userId:this.client_.getUserId(),sdkAppId:this.client_.getSDKAppId(),isLocal:this.isUplink_}),this.signalChannel_=t.signalChannel,this.peerConnection_=null,this.isErrorObserved_=!1,this.emitter_=new xw,this.currentState_=jC,this.waitForPeerConnectionConnectedPromise_=null,this.isReconnecting_=!1,this.reconnectionCount_=0,this.reconnectionTimer_=-1,this.isFirstConnection_=!0,this.delay_={audioDelay:0,videoDelay:0},this.enableSEI_=t.enableSEI,this.enableSEI_&&SN&&(this.sei_=new uK(this,this.log_,this.isUplink_))}var t;return c(e,[{key:"initialize",value:function(){var e={encodedInsertableStreams:this.enableSEI_&&SN,iceServers:this.client_.getIceServers(),iceTransportPolicy:this.client_.getIceTransportPolicy(),sdpSemantics:this.sdpSemantics_,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",tcpCandidatePolicy:"disable",IceTransportsType:"nohost"};this.peerConnection_=new RTCPeerConnection(e),this.peerConnection_.onconnectionstatechange=this.onConnectionStateChange.bind(this)}},{key:"close",value:function(){this.log_.info("closing connection"),this.closePeerConnection(),this.sei_&&(this.sei_.destroy(),this.sei_=null)}},{key:"closePeerConnection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.peerConnection_&&(this.peerConnection_.onconnectionstatechange=function(){},this.peerConnection_.close(),this.peerConnection_=null,e&&this.emitConnectionStateChangedEvent(jC))}},{key:"getDTLSTransportState",value:function(){if(!this.peerConnection_)return HC;var e=null;if(this.isUplink_){if(!vN()||0===this.peerConnection_.getSenders().length)return HC;e=this.peerConnection_.getSenders()[0].transport}else{if(!mN()||0===this.peerConnection_.getReceivers().length)return HC;e=this.peerConnection_.getReceivers()[0].transport}return e?e.state:HC}},{key:"onConnectionStateChange",value:function(e){var t=this.peerConnection_.iceConnectionState,n=this.getDTLSTransportState();if(this.log_.info("onConnectionStateChange() connectionState: "+e.target.connectionState),this.log_.info("ICE Transport state: ".concat(t,", DTLS Transport state: ").concat(n)),e.target.connectionState===$C&&this.emitConnectionStateChangedEvent(KC),e.target.connectionState===JC||e.target.connectionState===XC){var i="".concat(this.isUplink_?"uplink":"downlink"," ICE/DTLS Transport connection ").concat(e.target.connectionState,". ICE Transport state: ").concat(t,", DTLS Transport state: ").concat(n),r=new _L({message:i,code:vL.ICE_TRANSPORT_ERROR});sO.logFailedEvent({userId:this.client_.getUserId(),eventType:_S,error:r}),this.emitConnectionStateChangedEvent(jC),this.isErrorObserved_||this.emitter_.emit(PN.ERROR,r)}e.target.connectionState!==QC&&e.target.connectionState!==eS||(this.logSelectedCandidate(),sO.logSuccessEvent({userId:this.client_.getUserId(),eventType:_S}),this.emitConnectionStateChangedEvent(WC))}},{key:"emitConnectionStateChangedEvent",value:function(e){e!==this.currentState_&&(this.currentState_===zC&&e===KC||(Gw.emit(EA,{client:this.client_,connection:this,prevState:this.currentState_,state:e}),this.emitter_.emit(PN.CONNECTION_STATE_CHANGED,{prevState:this.currentState_,state:e}),this.currentState_=e))}},{key:"hitTest",value:function(e){return(0===e||"0"===e)&&this.isUplink_||e===this.tinyId_}},{key:"addEventInternal",value:function(e,t){var n=this.client_.getUserId(),i={eventId:e,eventDesc:t,timestamp:rv(),userId:n,tinyId:this.client_.getTinyId()};this.isUplink_||(i.remoteUserId=this.userId_,i.remoteTinyId=this.tinyId_),nO(n,i)}},{key:"getPeerConnection",value:function(){return this.peerConnection_}},{key:"getClient",value:function(){return this.client_}},{key:"getUserId",value:function(){return this.userId_}},{key:"getTinyId",value:function(){return this.tinyId_}},{key:"logSelectedCandidate",value:(t=o(n().mark((function e(){var t,i,r,o,a,s,c;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.peerConnection_){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.peerConnection_.getStats();case 4:t=e.sent,i=E(t),e.prev=6,i.s();case 8:if((r=i.n()).done){e.next=18;break}if((o=I(r.value,2))[0],!EN(a=o[1])){e.next=16;break}return s=t.get(a.localCandidateId),c=t.get(a.remoteCandidateId),s&&this.log_.info("local candidate: ".concat(s.candidateType," ").concat(s.protocol,":").concat(s.ip||s.address,":").concat(s.port," ").concat(s.networkType||""," ").concat("relay"===s.candidateType?"relayProtocol:"+s.relayProtocol:"")),c&&this.log_.info("remote candidate: ".concat(c.candidateType," ").concat(c.protocol,":").concat(c.ip||c.address,":").concat(c.port)),e.abrupt("break",18);case 16:e.next=8;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(6),i.e(e.t0);case 23:return e.prev=23,i.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[6,20,23,26]])}))),function(){return t.apply(this,arguments)})},{key:"getCurrentState",value:function(){return this.currentState_}},{key:"waitForPeerConnectionConnected",value:function(){var e=this;return this.waitForPeerConnectionConnectedPromise_||(this.waitForPeerConnectionConnectedPromise_=new Promise((function(t,n){if(e.currentState_===WC)return t();var i=-1,r=function(e){e.state===WC&&(clearTimeout(i),a(),t())},o=function(t){t.client===e.client_&&(clearTimeout(i),a(),n(new _L({code:vL.API_CALL_ABORTED,message:ow({key:Lb,data:"leave room"})})))},a=function(){Gw.off(zw,o,e),e.emitter_.off(PN.CONNECTION_STATE_CHANGED,r,e)};i=setTimeout((function(){a();var e=new _L({code:vL.API_CALL_TIMEOUT,message:"connection timeout"});n(e)}),1e4),Gw.on(zw,o,e),e.emitter_.on(PN.CONNECTION_STATE_CHANGED,r,e)})),this.waitForPeerConnectionConnectedPromise_=this.waitForPeerConnectionConnectedPromise_.then((function(t){return e.waitForPeerConnectionConnectedPromise_=null,t})).catch((function(t){throw e.waitForPeerConnectionConnectedPromise_=null,t}))),this.waitForPeerConnectionConnectedPromise_}},{key:"getReconnectionCount",value:function(){return this.reconnectionCount_}},{key:"startReconnection",value:function(){this.isReconnecting_=!0,this.emitConnectionStateChangedEvent(zC),this.reconnect(),this.addEventInternal(this.isUplink_?WL:JL,"".concat(this.isUplink_?"uplink":"downlink","-connection is reconnecting"))}},{key:"stopReconnection",value:function(){this.log_.info("stop reconnection"),this.isReconnecting_=!1,this.reconnectionCount_=0,this.clearReconnectionTimer(),this.signalChannel_.off(BR,this.reconnect,this)}},{key:"on",value:function(e,t,n){this.emitter_.on(e,t,n)}},{key:"off",value:function(e,t,n){this.emitter_.off(e,t,n)}},{key:"setDelay",value:function(e){var t=e.audioDelay,n=e.videoDelay;this.delay_={audioDelay:t,videoDelay:n}}},{key:"getDelay",value:function(){return this.delay_}},{key:"isH264",get:function(){var e,t;return!(null===(e=this.peerConnection_)||void 0===e||null===(t=e.remoteDescription)||void 0===t||!t.sdp.includes("H264"))}}]),e}(),pK=new(function(){function e(){a(this,e),this.set_=new Set,Gw.on(Fw,this.add,this),Gw.on(Bw,this.add,this),Gw.on(Hw,this.delete,this),Gw.on(zw,this.delete,this)}return c(e,[{key:"add",value:function(e){var t=e.client,n=e.roomId;if("rtc"!==t.getMode()){var i=this.getKey(t.getUserId(),n||t.getRoomId(),t.getSDKAppId(),t.getUseStringRoomId());this.set_.add(i)}}},{key:"delete",value:function(e){var t=e.client;if("rtc"!==t.getMode()){var n=this.getKey(t.getUserId(),t.getRoomId(),t.getSDKAppId(),t.getUseStringRoomId());this.set_.delete(n)}}},{key:"getKey",value:function(e,t,n,i){return"".concat(n,"_").concat(t,"_").concat(e,"_").concat(i)}},{key:"isJoined",value:function(e){var t=e.userId,n=e.roomId,i=e.sdkAppId,r=e.client;return"rtc"!==r.getMode()&&this.set_.has(this.getKey(t,n,i,r.getUseStringRoomId()))}}]),e}());function hK(e,t,n,i){if(this.useStringRoomId_){if(!gw(e)||!/^[A-Za-z\d\s!#$%&()+\-:;<=.>?@[\]^_{}|~,]{1,64}$/.test(e))throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:XE,data:t,link:{className:i,fnName:n}})})}else if(!(mw(e)&&/^[1-9]\d*$/.test(String(e))&&e<4294967295))throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:ZE,data:t,link:{className:i,fnName:n}})})}function fK(e,t,n,i){if(!/^[A-Za-z\d_-]*$/.test(e))throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:vk,data:t,link:{className:i,fnName:n}})})}var gK,mK,vK={createClient:{name:"clientConfig",required:!0,type:FS,properties:{sdkAppId:{required:!0,type:US,allowEmpty:!1},userId:{required:!0,type:PS,allowEmpty:!1},userSig:{required:!0,type:PS,allowEmpty:!1},mode:{required:!0,type:PS,values:["rtc",OC]},useStringRoomId:{type:xS},autoSubscribe:{type:xS},enableAutoPlayDialog:{type:xS},streamId:{type:PS},userDefineRecordId:{type:PS},pureAudioPushMode:{type:US,values:[1,2]},enableSEI:{type:xS}}},createStream:{name:"streamConfig",required:!0,type:FS,properties:{userId:{type:PS},audio:{type:xS},video:{type:xS},screen:{type:xS},screenAudio:{type:xS},microphoneId:{type:PS},cameraId:{type:PS},facingMode:{type:[PS,FS]},audioSource:{instanceOf:window.MediaStreamTrack},videoSource:{instanceOf:window.MediaStreamTrack}},validate:function(e){if(!fw(e.screen)&&e.screen&&fw(e.audio)&&(e.audio=!1),!(fw(e.audio)&&fw(e.video)||fw(e.audioSource)&&fw(e.videoSource)))throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:ob})});if(!fw(e.screen)&&!0===e.screen&&!0===e.video)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:ab})});if(e.audio&&e.screenAudio)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:sb})});if(!0!==e.screen&&!0===e.screenAudio)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:cb})});if(!fw(e.screen)&&!0===e.screen&&!this.isScreenShareSupported())throw new _L({code:vL.INVALID_OPERATION,message:ow({key:mb})})}}},_K={join:{name:"options",required:!0,type:FS,properties:{roomId:{required:!0,type:[US,PS],allowEmpty:!1,validate:hK},role:{type:[PS],values:[UC,xC]},privateMapKey:{type:[PS]}},validate:function(e){if(this.isJoined_)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:JE})});if(this.checkDestroy(),pK.isJoined({userId:this.userId_,roomId:e.roomId,sdkAppId:this.sdkAppId_,client:this}))throw new _L({code:vL.INVALID_OPERATION,message:ow({key:jk,data:this.userId_})})}},publish:[{name:"stream",required:!0,instanceOf:nE,validate:function(e){if(!this.isJoined_)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:ik})});if(this.mode_===OC&&this.role_===xC)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:ok})});if(!e.getIsReadyToPublish())throw new _L({code:vL.INVALID_OPERATION,message:ow({key:ak})});if(this.notPublishWithoutH264Supported_)throw new _L({code:vL.NOT_SUPPORTED_H264,message:ow({key:pb})})}},{name:"options",type:FS,defaultValue:{isAuxiliary:!1},properties:{isAuxiliary:{type:xS,defaultValue:!1,validate:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e&&!yN())throw new _L({code:vL.NOT_SUPPORTED,message:ow({key:vb})});if(this.uplinkConnection_&&(e&&this.uplinkConnection_.isAuxStreamPublished||!e&&this.uplinkConnection_.isMainStreamPublished))throw new _L({code:vL.INVALID_OPERATION,message:ow({key:sk,data:e?BT:"local"})});var t=this.localScreenStream_||M(this.connections_.values()).findIndex((function(e){return e.getTrackState().auxiliary}))>=0;if(!this.enableMultiAuxStream_&&e&&t)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Nb})})}}}}],unpublish:{name:"stream",required:!0,instanceOf:nE,validate:function(e){if(e!==this.localStream_&&e!==this.localAuxStream_){if(this.localStream_||this.localAuxStream_)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:rk})});this.log_.warn("Client currently has no published stream, please call publish() first.")}}},subscribe:[{name:"stream",required:!0,instanceOf:iE,validate:function(e){if(!e.getConnection())throw new _L({code:vL.INVALID_OPERATION,message:ow({key:ck})});if(this.notSubscribeWithoutH264Supported_)throw new _L({code:vL.NOT_SUPPORTED_H264,message:ow({key:hb})})}},{name:"options",type:FS,properties:{audio:{type:xS},video:{type:xS},smallVideo:{type:xS}},validate:function(e){var t=e.audio,n=e.video,i=e.smallVideo;if(!1===t&&!1===n&&(fw(i)||!1===i))throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Sb})})}}],unsubscribe:{name:"stream",required:!0,instanceOf:iE,validate:function(e){if(!e.getConnection())throw new _L({code:vL.INVALID_OPERATION,message:ow({key:ck})})}},switchRole:{name:"role",required:!0,values:[UC,xC],validate:function(){if(this.mode_!==OC)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:lk})});if(!this.isJoined_)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:dk})})}},startPublishCDNStream:{name:"options",required:!1,properties:{streamId:{type:PS,validate:fK},streamType:{type:PS,values:["main","auxiliary"]},appId:{type:US,allowEmpty:!1},bizId:{type:US,allowEmpty:!1},url:{type:PS,allowEmpty:!1}},validate:function(){if(this.isDestroyed_)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Kk,data:{funName:"startPublishCDNStream"}})})}},startMixTranscode:{name:"config",required:!0,type:FS,properties:{mode:{type:PS,values:["preset-layout","manual"]},streamId:{type:PS,validate:fK},videoWidth:{type:US,notLessThanZero:!0},videoHeight:{type:US,notLessThanZero:!0},videoBitrate:{type:US,notLessThanZero:!0,allowEmpty:!1},videoFramerate:{type:US,validate:function(e,t,n,i){if(e<=0||e>30)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:Jk,link:{className:i,fnName:n}})})}},videoGop:{type:US,validate:function(e,t,n,i){if(e<1||e>8)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:Xk,link:{className:i,fnName:n}})})}},audioSampleRate:{type:US,notLessThanZero:!0},audioBitrate:{type:US,validate:function(e,t,n,i){if(e<32||e>192)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:Zk,link:{className:i,fnName:n}})})}},audioChannels:{type:US,values:[1,2]},backgroundColor:{type:US},backgroundImage:{type:PS},mixUsers:{required:!0,type:GS,arrayItem:{require:!0,type:FS,properties:{userId:{required:!0,type:PS},roomId:{type:[PS,US],validate:hK},pureAudio:{type:xS},width:{type:US,notLessThanZero:!0},height:{type:US,notLessThanZero:!0},locationX:{type:US,notLessThanZero:!0},locationY:{type:US,notLessThanZero:!0},zOrder:{type:US},streamType:{type:PS,values:["main","auxiliary"]},renderMode:{type:US,values:[0,1,2,4]}}}}},validate:function(e,t,n,i,r){var o=0,a=0,s=e.mixUsers,c=[];if(s.forEach((function(e,t){if(c.push(e.userId),!e.pureAudio){if(!e.zOrder||e.zOrder<1||e>15)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:Qk,data:"config.mixUsers[".concat(t,"].zOrder"),link:{className:i,fnName:n}})});e.width+e.locationX>o&&(o=e.width+e.locationX),e.height+e.locationY>a&&(a=e.height+e.locationY)}})),c.indexOf(this.getUserId())<0)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:eb,link:{className:i,fnName:n}})});if(e.videoWidth<o||e.videoHeight<a)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:tb,link:{className:i,fnName:n}})})}},sendSEIMessage:[{name:"buffer",required:!0,instanceOf:ArrayBuffer,validate:function(e){if(!SN)throw new _L({code:vL.NOT_SUPPORTED,message:ow({key:Eb})});if(!this.enableSEI_)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:kb})});if(e.byteLength>1e3)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:Db,data:e.byteLength})});if(0===e.byteLength)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:bb})});if(!this.uplinkConnection_||!this.localStream_)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:wb})});if(!this.localStream_.hasVideo())throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Ab})});var t=this.uplinkConnection_.isH264;if(!t)throw new _L({code:vL.NOT_SUPPORTED,message:ow({key:Eb,data:t})})}},{name:"options",type:FS,properties:{seiPayloadType:{type:US,values:[5,243]}}}]},yK={play:[{name:"elementId",required:!0,type:[PS,"HTMLDivElement"],validate:function(e,t,n){if(gw(e)){var i=document.getElementById(e);if(!i)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:nb,data:{key:t,fnName:n}})});if(!(i instanceof HTMLDivElement))throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:ib,data:{key:t,fnName:n,type:Mw(i)}})})}}},{name:"options",type:FS,properties:{objectFit:{type:PS,values:["contain","cover","fill"]},muted:{type:xS},mirror:{type:xS}}}],addTrack:{name:IC,instanceOf:MediaStreamTrack,validate:function(e){if(this.isAddingTrack_)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Lk})});if(this.isRemovingTrack_)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Ok})});if(this.publishState_===HS)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Nk})});var t=this.getMediaStream();if(!t)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Pk})});if(e.kind===xT&&t.getAudioTracks().length>0||e.kind===GT&&t.getVideoTracks().length>0)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Uk})});if(!_N()&&!vN())throw new _L({code:vL.NOT_SUPPORTED,message:ow({key:fb,data:vC})})}},removeTrack:{name:IC,instanceOf:MediaStreamTrack,validate:function(e){if(this.isAddingTrack_)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Gk})});if(this.isRemovingTrack_)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Fk})});if(this.publishState_===HS)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Vk})});var t=this.getMediaStream();if(!t)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Pk})});if(-1===t.getTracks().indexOf(e))throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:qk})});if(!_N()){if(1===t.getTracks().length)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Bk})});if(e.kind===xT)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:xk})});if(!vN())throw new _L({code:vL.NOT_SUPPORTED,message:ow({key:fb,data:_C})})}}},replaceTrack:{name:IC,instanceOf:MediaStreamTrack,validate:function(e){var t=this.getMediaStream();if(!t)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Rk})});if(this.publishState_===HS)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Ak})});if(e.kind===xT&&t.getAudioTracks().length<=0||e.kind===GT&&t.getVideoTracks().length<=0)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:Hk,data:e})});if(!IN())throw new _L({code:vL.NOT_SUPPORTED,message:ow({key:fb,data:yC})})}}},IK={TRTC:vK,CLIENT:_K,LOCAL_STREAM:{switchDevice:[{name:"type",required:!0,type:PS,values:[xT,GT]},{name:"deviceId",required:!0,type:PS,validate:function(){if(this.screen_&&!this.audio_||this.audioSource_||this.videoSource_)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Dk})});if(this.publishState_===HS)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:wk})});if(!IN())throw new _L({code:vL.NOT_SUPPORTED,message:ow({key:gb})})}}],setAudioCaptureVolume:{name:"volume",type:US}},STREAM:yK};function MK(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,n,i){var r=i.value;return i.value=function(){for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return CK.call(this,t,i,n,this.name_),r.apply(this,i)},i}}function TK(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(e,i,r){var a=r.value;return r.value=o(n().mark((function e(){var r,o,s,c=arguments;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=c.length,o=new Array(r),s=0;s<r;s++)o[s]=c[s];return CK.call(this,t,o,i,this.name_),e.abrupt("return",a.apply(this,o));case 3:case"end":return e.stop()}}),e,this)}))),r}}function CK(e,t,n,i){try{for(var r=0;r<e.length;r++)SK.call(this,{rule:e[r],value:t[r],key:e[r].name,fnName:n,className:i})}catch(oY){throw PA.error(oY),oY}}function SK(e){var t=this,n=e.rule,i=e.value,r=e.key,o=e.fnName,a=e.className;if(fw(i)){if(n.required)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:LE,data:{key:r,rule:n,fnName:o,value:i},link:{className:a,fnName:o}})});if(fw(n.defaultValue))return;i=n.defaultValue}if(Array.isArray(n.type)){if(!n.type.map((function(e){return e.toLowerCase()})).includes(Mw(i)))throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:OE,data:{key:r,rule:n,fnName:o,value:i},link:{className:a,fnName:o}})})}else if(!fw(n.type)&&Mw(i)!==n.type)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:OE,data:{key:r,rule:n,fnName:o,value:i},link:{className:a,fnName:o}})});if(!1===n.allowEmpty){var s=mw(i)&&(0===i||Number.isNaN(i)),c=gw(i)&&""===i.trim();if(s||c)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:NE,data:{key:r,rule:n,fnName:o,value:i},link:{className:a,fnName:o}})})}if(n.notLessThanZero&&mw(i)&&i<0)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:$k,data:{key:r,rule:n,fnName:o,value:i},link:{className:a,fnName:o}})});if(gw(n.instanceOf)){if(!i||i.name_!==n.instanceOf)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:PE,data:{key:r,rule:n,fnName:o,value:i},link:{className:a,fnName:o}})})}else if(hw(n.instanceOf)&&!(i instanceof n.instanceOf))throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:PE,data:{key:r,rule:n,fnName:o,value:i},link:{className:a,fnName:o}})});if(n.values&&!n.values.includes(i))throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:UE,data:{key:r,rule:n,fnName:o,value:i},link:{className:a,fnName:o}})});var u=n.properties;lw(u)&&_w(i)&&Object.keys(u).forEach((function(e){SK.call(t,{rule:u[e],value:i&&i[e],key:"".concat(r,".").concat(e),fnName:o,className:a})}));var l=n.arrayItem;lw(l)&&yw(i)&&i.forEach((function(e,n){SK.call(t,{rule:l,value:e,key:"".concat(r,"[").concat(n,"]"),fnName:o,className:a})})),hw(n.validate)&&n.validate.call(this,i,r,o,a,this)}Er({target:"Number",stat:!0},{isNaN:function(e){return e!=e}});var EK=(gK=TK.apply(void 0,M(IK.STREAM.play)),mK=function(){function e(t){a(this,e),this.name_=rE,this.userId_=t.userId,this.isRemote_=t.isRemote,this.type_=t.type,this.log_=PA.createLogger({id:"s".concat(t.seq?t.seq:"","|").concat(this.userId_),userId:fw(t.client)?void 0:t.client.getUserId(),sdkAppId:fw(t.client)?void 0:t.client.getSDKAppId(),isLocal:!this.isRemote_,type:this.isRemote_?this.type_:""}),this.client_=null,fw(t.client)||(this.client_=t.client),this.mediaStream_=null,this.div_=null,this.isPlaying_=!1,this.connection_=null,this.audioPlayer_=null,this.videoPlayer_=null,this.muted_=!1,this.objectFit_="cover",this.mirror_=!1,this.id_="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),this.audioOutputDeviceId_=0,this.audioVolume_=1,this.emitter_=Lw(new xw,this.name_),this.connectionState_=jC,this.installEvents(),fw(t.mirror)||this.log_.warn('TRTC.createStream "mirror" option was deprecated since v4.12.1，please use localStream.play to set up preview mirror. refer to '.concat(uE,"/en/LocalStream.html#play. TRTC.createStream 接口的 mirror 选项从 v4.12.1 开始被废弃，请使用 localStream.play 设置本地流预览镜像，参考文档：").concat(uE,"/zh-cn/LocalStream.html#play。"))}var i,r,s,u,l;return c(e,[{key:"installEvents",value:function(){Gw.on(DA,this.restartPlayback,this)}},{key:"uninstallEvents",value:function(){Gw.off(DA,this.restartPlayback,this)}},{key:"getType",value:function(){return this.type_}},{key:"getLogger",value:function(){return this.log_}},{key:"isSubscribed",get:function(){return this.type_===qC&&this.connection_.isMainStreamSubscribed||this.type_===BC&&this.connection_.isAuxStreamSubscribed}},{key:"isMainVideoSubscribed",get:function(){var e=this.getSubscribedState();return this.type_===qC&&e&&e.video}},{key:"isMainAudioSubscribed",get:function(){var e=this.getSubscribedState();return this.type_===qC&&e&&e.audio}},{key:"isAuxVideoSubscribed",get:function(){var e=this.getSubscribedState();return this.type_===BC&&e&&e.auxiliary}},{key:"isSmallVideoSubscribed",get:function(){var e=this.getSubscribedState();return this.type_===qC&&e&&e.smallVideo}},{key:"emitConnectionStateChanged",value:function(e){e.state!==this.connectionState_&&(e.state!==jC&&this.isRemote_&&!this.isSubscribed||(this.emitter_.emit(FN,e),this.connectionState_=e.state))}},{key:"setConnection",value:function(e){this.connection_!==e&&(e instanceof dK?(null!==this.connection_&&this.connection_.off(PN.CONNECTION_STATE_CHANGED,this.emitConnectionStateChanged,this),e.on(PN.CONNECTION_STATE_CHANGED,this.emitConnectionStateChanged,this)):null===e&&this.connection_.off(PN.CONNECTION_STATE_CHANGED,this.emitConnectionStateChanged,this),this.connection_=e)}},{key:"getConnection",value:function(){return this.connection_}},{key:"play",value:(l=o(n().mark((function e(t,i){var r,o,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log_.info("stream ".concat(this.isPlaying_?"update":"start to"," play with elementId: ").concat(t," and options: ").concat(JSON.stringify(i),".")),!this.isPlaying_){e.next=9;break}return i&&!fw(i.muted)&&(this.muted_=i.muted),i&&!fw(i.objectFit)&&(this.objectFit_=i.objectFit),this.isScreenShare()?this.mirror_=!1:i&&!fw(i.mirror)&&(this.mirror_=i.mirror),this.audioPlayer_&&this.audioPlayer_.setMuted(this.muted_),this.videoPlayer_&&(this.videoPlayer_.setObjectFit(this.objectFit_),this.videoPlayer_.setMirror(this.mirror_)),this.elementId_!==t&&(r=t,gw(t)&&(r=document.getElementById(t)),r.appendChild(this.div_),this.elementId_=t),e.abrupt("return");case 9:return this.isPlaying_=!0,(o=document.createElement("div")).setAttribute("id","player_".concat(this.id_)),o.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"),a=t,gw(t)&&(a=document.getElementById(t)),a.appendChild(o),this.elementId_=t,this.div_=o,this.isRemote_||(this.muted_=!0),i&&!fw(i.muted)&&(this.muted_=i.muted),this.isScreenShare()&&(this.objectFit_="contain"),i&&!fw(i.objectFit)&&(this.objectFit_=i.objectFit),this.isScreenShare()?this.mirror_=!1:(this.isRemote_||(this.mirror_=!0),i&&!fw(i.mirror)&&(this.mirror_=i.mirror)),Gw.emit(yA,{stream:this}),e.next=26,Promise.all([this.playAudio(),this.playVideo()]);case 26:Gw.emit(nA,{stream:this});case 27:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"playAudio",value:(u=o(n().mark((function e(){var i,r,o=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasAudio()&&(!this.isRemote_||this.isMainAudioSubscribed)){e.next=2;break}return e.abrupt("return");case 2:if(i=this.getAudioTrack(),this.audioPlayer_||!i){e.next=17;break}return this.log_.info("create AudioPlayer and play"),this.audioPlayer_=new kx({stream:this,track:i,gainedTrack:null===(r=this.gain_)||void 0===r?void 0:r.audioTrack,div:this.div_,muted:this.muted_,outputDeviceId:this.audioOutputDeviceId_,volume:this.audioVolume_}),this.audioPlayer_.on(BN,(function(e){var n={type:xT,state:e.state,reason:e.reason};Gw.emit(iA,t({stream:o},n)),o.emitter_.emit(xN,n)})),e.prev=7,e.next=10,this.audioPlayer_.play();case 10:e.next=17;break;case 12:throw e.prev=12,e.t0=e.catch(7),this.client_&&this.client_.getEnableAutoPlayDialog()&&new Xx,this.emitter_.emit(qN,e.t0),e.t0;case 17:case"end":return e.stop()}}),e,this,[[7,12]])}))),function(){return u.apply(this,arguments)})},{key:"playVideo",value:(s=o(n().mark((function e(){var i,r=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasVideo()&&(!this.isRemote_||this.isMainVideoSubscribed||this.isAuxVideoSubscribed||this.isSmallVideoSubscribed)){e.next=2;break}return e.abrupt("return");case 2:if(i=this.getVideoTrack(),this.videoPlayer_||!i){e.next=18;break}return Gw.emit(MA,{stream:this}),this.log_.info("create VideoPlayer and play"),this.videoPlayer_=new Zx({stream:this,track:i,div:this.div_,muted:this.muted_,objectFit:this.objectFit_,mirror:this.mirror_}),this.videoPlayer_.on(BN,(function(e){var n={type:GT,state:e.state,reason:e.reason};Gw.emit(iA,t({stream:r},n)),r.emitter_.emit(xN,n)})),e.prev=8,e.next=11,this.videoPlayer_.play();case 11:e.next=18;break;case 13:throw e.prev=13,e.t0=e.catch(8),this.client_&&this.client_.getEnableAutoPlayDialog()&&new Xx,this.emitter_.emit(qN,e.t0),e.t0;case 18:case"end":return e.stop()}}),e,this,[[8,13]])}))),function(){return s.apply(this,arguments)})},{key:"stopAudio",value:function(){this.audioPlayer_&&(this.log_.info("stop AudioPlayer"),this.audioPlayer_.stop(),this.audioPlayer_=null)}},{key:"stopVideo",value:function(){this.videoPlayer_&&(this.log_.info("stop VideoPlayer"),this.videoPlayer_.stop(),this.videoPlayer_=null)}},{key:"restartPlayback",value:function(){this.audioPlayer_&&!this.audioPlayer_.isPlaying&&this.restartAudio(),this.videoPlayer_&&!this.videoPlayer_.isPlaying&&this.restartVideo()}},{key:"restartAudio",value:function(){this.isPlaying_&&(this.stopAudio(),this.playAudio().catch((function(e){})))}},{key:"restartVideo",value:function(){this.isPlaying_&&(this.stopVideo(),this.playVideo().catch((function(e){})))}},{key:"stop",value:function(){this.isPlaying_&&(this.isPlaying_=!1,this.stopAudio(),this.stopVideo(),this.div_.parentNode.removeChild(this.div_))}},{key:"resume",value:(r=o(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isPlaying_){e.next=2;break}return e.abrupt("return");case 2:if(this.log_.info("resume"),!this.audioPlayer_){e.next=6;break}return e.next=6,this.audioPlayer_.resume();case 6:if(!this.videoPlayer_){e.next=9;break}return e.next=9,this.videoPlayer_.resume();case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"close",value:function(){this.log_.info("close stream"),this.isPlaying_&&this.stop(),this.isRemote_||(this.mediaStream_&&(this.mediaStream_.preventEvent=1,this.mediaStream_.getTracks().forEach((function(e){e.stop()})),this.mediaStream_=null),this.uninstallEvents())}},{key:"muteAudio",value:function(){return this.addRemoteEvent(!0,xT),this.doEnableTrack(xT,!1)}},{key:"muteVideo",value:function(){return this.addRemoteEvent(!0,GT),this.doEnableTrack(GT,!1)}},{key:"unmuteAudio",value:function(){return this.addRemoteEvent(!1,xT),this.doEnableTrack(xT,!0)}},{key:"unmuteVideo",value:function(){return this.addRemoteEvent(!1,GT),this.doEnableTrack(GT,!0)}},{key:"addRemoteEvent",value:function(e,t){if(this.isRemote_&&this.client_){var n=this.client_.getUserId(),i="".concat(e?WT:YT," remote ").concat(t);nO(n,{eventId:t===xT?e?PL:xL:e?NL:UL,eventDesc:i,timestamp:(new Date).getTime(),userId:n,tinyId:this.client_.getTinyId(),remoteUserId:this.userId_,remoteTinyId:this.connection_.getTinyId()})}}},{key:"doEnableTrack",value:function(e,t){var n=!1;return e===xT?this.mediaStream_.getAudioTracks().forEach((function(e){n=!0,e.enabled=t})):this.mediaStream_.getVideoTracks().forEach((function(e){n=!0,e.enabled=t})),n}},{key:"getId",value:function(){return this.id_}},{key:"getUserId",value:function(){return this.userId_}},{key:"getTinyId",value:function(){return this.connection_?this.connection_.getTinyId():""}},{key:"isPlaying",value:function(){return this.isPlaying_}},{key:"setAudioOutput",value:(i=o(n().mark((function e(t){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.audioOutputDeviceId_=t,!this.audioPlayer_){e.next=4;break}return e.next=4,this.audioPlayer_.setSinkId(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setAudioVolume",value:function(e){this.audioVolume_=e,this.log_.info("setAudioVolume to ".concat(e)),this.audioPlayer_&&this.audioPlayer_.setVolume(e)}},{key:"getAudioLevel",value:function(){var e=0;return this.audioPlayer_&&(e=this.audioPlayer_.getAudioLevel()),e}},{key:"getInternalAudioLevel",value:function(){var e=0;return this.audioPlayer_&&(e=this.audioPlayer_.getInternalAudioLevel()),e}},{key:"hasAudio",value:function(){if(this.isRemote_){if(!this.connection_)return!1;var e=this.connection_.getTrackState();return this.type_===qC&&e.audio}return!!this.getAudioTrack()}},{key:"hasVideo",value:function(){if(this.isRemote_){if(!this.connection_)return!1;var e=this.connection_.getTrackState();return this.type_===BC?e.auxiliary:e.video}return!!this.getVideoTrack()}},{key:"getSubscribedState",value:function(){return this.isRemote_&&this.connection_?this.connection_.getSubscribeState():null}},{key:"getAudioTrack",value:function(){var e=null;if(this.mediaStream_){var t=this.mediaStream_.getAudioTracks();t.length>0&&(e=t[0])}return e}},{key:"getVideoTrack",value:function(){var e=null;if(this.mediaStream_){var t=this.mediaStream_.getVideoTracks();t.length>0&&(e=t[0])}return e}},{key:"getVideoFrame",value:function(){return this.videoPlayer_?this.videoPlayer_.getVideoFrame():null}},{key:"getMediaStream",value:function(){return this.mediaStream_}},{key:"setMediaStream",value:function(e){e!==this.mediaStream_&&(this.mediaStream_&&this.mediaStream_.getTracks().forEach((function(e){return e.stop()})),this.mediaStream_=e)}},{key:"updateVideoPlayingState",value:function(e){this.isPlaying_&&(e?(this.log_.info("playing state updated, play video"),this.playVideo().catch((function(e){}))):(this.log_.info("playing state updated, stop video"),this.stopVideo()))}},{key:"updateAudioPlayingState",value:function(e){this.isPlaying_&&(e?(this.log_.info("playing state updated, play audio"),this.playAudio().catch((function(e){}))):(this.log_.info("playing state updated, stop audio"),this.stopAudio()))}},{key:"on",value:function(e,t,n){this.emitter_.on(e,t,n)}},{key:"off",value:function(e,t,n){"*"===e?this.emitter_.removeAllListeners():this.emitter_.off(e,t,n)}},{key:"isRemote",value:function(){return this.isRemote_}},{key:"isScreenShare",value:function(){return!this.isRemote_&&this.screen_||this.isRemote_&&this.getType()===BT}},{key:"getDiv",value:function(){return this.div_}},{key:"getObjectFit",value:function(){return this.objectFit_}},{key:"getMuted",value:function(){return this.muted_}},{key:"getClient",value:function(){return this.client_}}]),e}(),k(mK.prototype,"play",[gK],Object.getOwnPropertyDescriptor(mK.prototype,"play"),mK.prototype),mK),kK=function(e){l(i,e);var n=v(i);function i(e){var r;a(this,i);var o={isRemote:!0,type:e.type},s=t(t({},e),o);return(r=n.call(this,s)).name_=iE,r.isStreamAddedEventEmitted_=!1,r.isAbleToCallSubscription_=!0,r}return c(i,[{key:"installEvents",value:function(){y(d(i.prototype),"installEvents",this).call(this),Gw.on(uA,this.handleStreamSubscribed,this),Gw.on(lA,this.handleStreamUnsubscribed,this)}},{key:"uninstallEvents",value:function(){y(d(i.prototype),"uninstallEvents",this).call(this),Gw.off(uA,this.handleStreamSubscribed,this),Gw.off(lA,this.handleStreamUnsubscribed,this)}},{key:"handleStreamSubscribed",value:function(e){e.client===this.client_&&e.stream===this&&this.connection_.getCurrentState()===WC&&this.emitConnectionStateChanged({prevState:jC,state:WC})}},{key:"handleStreamUnsubscribed",value:function(e){e.client===this.client_&&e.stream===this&&this.emitConnectionStateChanged({prevState:WC,state:jC})}},{key:"getType",value:function(){return y(d(i.prototype),"getType",this).call(this)}},{key:"getIsAbleToCallSubscription",value:function(){return this.isAbleToCallSubscription_}},{key:"setIsAbleToCallSubscription",value:function(e){this.isAbleToCallSubscription_=e}},{key:"setIsStreamAddedEventEmitted",value:function(e){this.isStreamAddedEventEmitted_=e}},{key:"getIsStreamAddedEventEmitted",value:function(){return this.isStreamAddedEventEmitted_}},{key:"getAudioTrack",value:function(){return this.connection_&&this.connection_.getTrackState().audio?y(d(i.prototype),"getAudioTrack",this).call(this):null}},{key:"getVideoTrack",value:function(){if(!this.connection_)return null;var e=this.connection_.getTrackState();return this.type_===qC&&!e.video||this.type_===BC&&!e.auxiliary?null:y(d(i.prototype),"getVideoTrack",this).call(this)}},{key:"close",value:function(){y(d(i.prototype),"close",this).call(this)}}]),i}(EK),bK=function(){function e(t){a(this,e),this.client_=t.client,this.subscribedStreams_=new Map,this.unsubscribedStreams_=new Map,this.subscriptedOptions_=new Map,this.autoRecoveryFlags_=new Map}var t,i,r;return c(e,[{key:"isEnabled",get:function(){return"webrtc"!==this.client_.getEnv()}},{key:"recover",value:(r=o(n().mark((function e(t){var i,r,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.getUserId(),r=t.getType(),this.hasAutoRecoveryFlag(i,r)){e.next=5;break}return e.abrupt("return");case 5:if(o=this.getUnsubscribedStream(i,r)?"unsubscribe":"subscribe",e.prev=6,PA.warn("recover() try to recover subscription [".concat(o,"][").concat(i,"][").concat(r,"]")),"subscribe"!==o){e.next=13;break}return e.next=11,this.recoverSubscription(i,t);case 11:e.next=15;break;case 13:return e.next=15,this.recoverUnsubscription(i,t);case 15:sO.logSuccessEvent({userId:this.client_.getUserId(),eventType:CS}),PA.warn("recover() recover successfully [".concat(o,"][").concat(i,"][").concat(r,"]")),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(6),PA.error("recover() recover failed [".concat(o,"][").concat(i,"][").concat(r,"]"),e.t0),sO.logFailedEvent({userId:this.client_.getUserId(),eventType:CS,error:e.t0});case 23:this.deleteAutoRecoveryFlag(i,r);case 24:case"end":return e.stop()}}),e,this,[[6,19]])}))),function(e){return r.apply(this,arguments)})},{key:"recoverSubscription",value:(i=o(n().mark((function e(t,i){var r,o,a,s,c;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getOptions(t,i.getType()),o=this.getSubscribedStream(t,i.getType()),r&&o){e.next=4;break}return e.abrupt("return");case 4:a=this.getStreamMuteState(o),s=a.isAudioMuted,c=a.isVideoMuted,this.mergeStream(o,i),this.recoverPlayingState(o),s&&o.doEnableTrack(xT,!1),c&&o.doEnableTrack(GT,!1);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"recoverUnsubscription",value:(t=o(n().mark((function e(t,i){var r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getUnsubscribedStream(t,i.getType())){e.next=3;break}return e.abrupt("return");case 3:this.mergeStream(r,i);case 4:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"getStreamMuteState",value:function(e){var t={isAudioMuted:!1,isVideoMuted:!1},n=e.getMediaStream();return n&&(t.isAudioMuted=n.getAudioTracks().map((function(e){return e.enabled})).includes(!1),t.isVideoMuted=n.getVideoTracks().map((function(e){return e.enabled})).includes(!1)),t}},{key:"recoverPlayingState",value:function(e){var t=e.isPlaying(),n=e.getDiv();if(t&&n){var i=n.parentNode;e.stop(),e.play(i,{objectFit:e.getObjectFit(),muted:e.getMuted()})}}},{key:"mergeStream",value:function(e,t){var n=t.getConnection(),i=t.getMediaStream();e.setConnection(n),n.setRemoteStream(i.id,e),e.setMediaStream(i),e.updateAudioPlayingState(t.hasAudio()),e.updateVideoPlayingState(t.hasVideo())}},{key:"addSubscriptionRecord",value:function(e,t,n){var i=t.getType();if(this.subscribedStreams_.has(e))this.subscribedStreams_.get(e).set(i,t);else{var r=new Map;r.set(t.getType(),t),this.subscribedStreams_.set(e,r)}if(this.subscriptedOptions_.has(e))this.subscriptedOptions_.get(e).set(i,n);else{var o=new Map;o.set(t.getType(),n),this.subscriptedOptions_.set(e,o)}this.deleteUnsubscriptionRecord(e,i)}},{key:"addUnsubscriptionRecord",value:function(e,t){if(this.unsubscribedStreams_.has(e))this.unsubscribedStreams_.get(e).set(t.getType(),t);else{var n=new Map;n.set(t.getType(),t),this.unsubscribedStreams_.set(e,n)}this.deleteSubscriptionRecord(e,t.getType())}},{key:"getSubscribedStream",value:function(e,t){return this.subscribedStreams_.has(e)&&this.subscribedStreams_.get(e).has(t)?this.subscribedStreams_.get(e).get(t):null}},{key:"getOptions",value:function(e,t){return this.subscriptedOptions_.has(e)&&this.subscriptedOptions_.get(e).has(t)?this.subscriptedOptions_.get(e).get(t):null}},{key:"getUnsubscribedStream",value:function(e,t){return this.unsubscribedStreams_.has(e)&&this.unsubscribedStreams_.get(e).has(t)?this.unsubscribedStreams_.get(e).get(t):null}},{key:"deleteSubscriptionRecord",value:function(e,t){this.subscribedStreams_.has(e)&&this.subscribedStreams_.get(e).delete(t),this.subscriptedOptions_.has(e)&&this.subscriptedOptions_.get(e).delete(t)}},{key:"deleteUnsubscriptionRecord",value:function(e,t){this.unsubscribedStreams_.has(e)&&this.unsubscribedStreams_.get(e).delete(t)}},{key:"markAllStream",value:function(){for(var e=0,t=M(this.subscribedStreams_.entries());e<t.length;e++)for(var n=I(t[e],2),i=n[0],r=0,o=M(n[1].entries());r<o.length;r++){var a=I(o[r],1)[0];this.setAutoRecoveryFlag(i,a)}for(var s=0,c=M(this.unsubscribedStreams_.entries());s<c.length;s++)for(var u=I(c[s],2),l=u[0],d=0,p=M(u[1].entries());d<p.length;d++){var h=I(p[d],1)[0];this.setAutoRecoveryFlag(l,h)}}},{key:"setAutoRecoveryFlag",value:function(e,t){if(PA.info("setAutoRecoveryFlag() mark [".concat(e,"][").concat(t,"]")),this.autoRecoveryFlags_.has(e))this.autoRecoveryFlags_.get(e).set(t);else{var n=new Map;n.set(t),this.autoRecoveryFlags_.set(e,n)}}},{key:"hasAutoRecoveryFlag",value:function(e,t){return!!this.isEnabled&&this.autoRecoveryFlags_.has(e)&&this.autoRecoveryFlags_.get(e).has(t)}},{key:"deleteAutoRecoveryFlag",value:function(e,t){this.autoRecoveryFlags_.has(e)&&this.autoRecoveryFlags_.get(e).delete(t)}},{key:"delete",value:function(e){this.unsubscribedStreams_.delete(e),this.subscribedStreams_.delete(e),this.subscriptedOptions_.delete(e),this.autoRecoveryFlags_.delete(e)}}]),e}(),DK=function(){function e(t){a(this,e),this.player_=t,this.canvas_=document.createElement(UT),this.canvasCtx_=this.canvas_.getContext("2d")}return c(e,[{key:"setCanvasRect",value:function(e,t){this.canvas_.width=e,this.canvas_.height=t}},{key:"drawVideoToCanvas",value:function(){var e=this.player_.getElement(),t=e.videoHeight,n=e.videoWidth,i=n*this.canvas_.height/(t*this.canvas_.width);if(i>1.05||i<.95){var r=n*t/(this.canvas_.width*this.canvas_.height);this.setCanvasRect(n/Math.sqrt(r),t/Math.sqrt(r))}this.canvasCtx_.drawImage(e,0,0,this.canvas_.width,this.canvas_.height)}},{key:"generateVideoTrackFromCanvasCapture",value:function(e){return this.canvas_.captureStream(e).getVideoTracks()[0]}},{key:"generateStreamFromTrack",value:function(e){var t=new MediaStream;return t.addTrack(e),t}},{key:"destroy",value:function(){this.player_.stop(),this.canvas_.width=0,this.canvas_.height=0,this.canvas_=null,this.canvasCtx_=null}},{key:"canvas",get:function(){return this.canvas_}},{key:"canvasCtx",get:function(){return this.canvasCtx_}},{key:"canDrawVideoToCanvas",get:function(){if(this.player_){var e=this.player_.getElement();if(e)return e.readyState===e.HAVE_ENOUGH_DATA}return!1}}]),e}(),wK=new Blob(['let t,e,a,i;onmessage=function(n){const{action:h,data:s}=n.data;switch(h){case"render":a=s.canvas,t=a.width,e=a.height,i=a.getContext("2d"),function(t,e){const n=new TransformStream({async transform(t,e){const n=t.displayWidth,h=t.displayHeight,s=n*a.height/(h*a.width);if(s>1.05||s<.95){const t=n*h/(a.width*a.height);a.width=n/Math.sqrt(t),a.height=h/Math.sqrt(t)}i.drawImage(t,0,0,a.width,a.height);const o=new VideoFrame(a,{timestamp:t.timestamp});t.close(),e.enqueue(o)}});t.pipeThrough(n).pipeTo(e)}(s.readable,s.writable)}}'],{type:"application/javascript"}),AK=function(){function e(t){a(this,e);var n=t.videoTrack;this.width=void 0,this.height=void 0,this.canvas=document.createElement("canvas"),this.offscreen=null,this.smallGenerator=new MediaStreamTrackGenerator({kind:"video"}),this.smallWritable=this.smallGenerator.writable,this.bigProcessor=new MediaStreamTrackProcessor({track:n}),this.bigReadable=this.bigProcessor.readable,this.initWorker()}return c(e,[{key:"initWorker",value:function(){try{this.worker=new Worker(URL.createObjectURL(wK)),PA.info("init worker processor success")}catch(e){PA.warn("init worker processor failed. ".concat(e.error))}}},{key:"setCanvasRect",value:function(e,t){this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t,this.offscreen=this.canvas.transferControlToOffscreen(),this.worker.postMessage({action:"render",data:{canvas:this.offscreen,readable:this.bigReadable,writable:this.smallWritable}},[this.offscreen,this.bigReadable,this.smallWritable])}},{key:"generatorVideoTrack",value:function(){var e=new MediaStream([this.smallGenerator]);return null==e?void 0:e.getTracks()[0]}},{key:"destroy",value:function(){this.worker.terminate()}}]),e}(),RK=function(){function e(t){a(this,e),this.localStream_=t,this.player_=null,this.processor_=null,this.initOffscreenSuccess_=!1}var t;return c(e,[{key:"initialize",value:(t=o(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(NN()&&(null===(t=navigator)||void 0===t?void 0:t.hardwareConcurrency)>=6)){e.next=13;break}return e.prev=1,e.next=4,this.initOffscreen();case 4:this.initOffscreenSuccess_=!0,PA.info("Initialize VideoGenerator successfully!"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.initCanvas();case 11:e.next=14;break;case 13:this.initCanvas();case 14:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(){return t.apply(this,arguments)})},{key:"generateSmallVideoTrack",value:function(e){var t,n=e.height,i=e.width,r=e.frameRate,o=this.getSmallVideoProfile(i,n);return this.initOffscreenSuccess_?(this.processor_.setCanvasRect(o.width,o.height),t=this.processor_.generatorVideoTrack()):(this.processor_.setCanvasRect(o.width,o.height),this.player_.setRect({width:o.width,height:o.height}),t=this.processor_.generateVideoTrackFromCanvasCapture(r),this.interval_=QO.run(yE,this.render.bind(this),{fps:r})),t}},{key:"render",value:function(){this.processor_.canDrawVideoToCanvas&&this.processor_.drawVideoToCanvas()}},{key:"destroy",value:function(){QO.clearTask(this.interval_),this.processor_&&this.processor_.destroy()}},{key:"initOffscreen",value:function(){this.processor_=new AK({videoTrack:this.localStream_.getVideoTrack()})}},{key:"initCanvas",value:function(){this.player_=new Zx({stream:this.localStream_,track:this.localStream_.getVideoTrack(),muted:!0,objectFit:"cover",mirror:!1}),this.player_.play().then((function(){PA.info("VideoGenerator: play local video success")})).catch((function(){PA.error("VideoGenerator: Failed to play local video")})),this.processor_=new DK(this.player_)}},{key:"getSmallVideoProfile",value:function(e,t){var n,i=this.localStream_.getVideoTrack(),r=this.localStream_.getVideoProfile();if(LN){var o=i.getSettings();o&&o.width&&o.height&&(r.width=o.width,r.height=o.height)}var a=r.width*r.height,s=e*t;return PA.info("big stream resolution: ".concat(r.width,"*").concat(r.height," small stream resolution: ").concat(e,"*").concat(t," ")),n=a>s?a/s:a/19200,{width:parseInt(r.width/Math.sqrt(n)),height:parseInt(r.height/Math.sqrt(n))}}}]),e}();function LK(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{retries:5,timeout:2e3};return function(t,n,i){var r=RA({retryFunction:i.value,settings:e,onError:e.onError,onRetrying:e.onRetrying,onRetryFailed:e.onRetryFailed});return i.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.apply(this,t)},i}}var OK=new Map,NK=function(){var e=o(n().mark((function e(t){var i,r,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!TN()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,UK(t);case 4:if(i=e.sent,PA.info("getUserMedia with constraints: "+JSON.stringify(i)),!i.audio){e.next=11;break}return e.next=9,rY.getMicrophones();case 9:r=e.sent,PA.info("microphones: ".concat(JSON.stringify(r)));case 11:if(!i.video){e.next=16;break}return e.next=14,rY.getCameras();case 14:o=e.sent,PA.info("cameras: ".concat(JSON.stringify(o)));case 16:return e.prev=16,e.next=19,navigator.mediaDevices.getUserMedia(i);case 19:return e.abrupt("return",e.sent);case 22:if(e.prev=22,e.t0=e.catch(16),"NotFoundError"!==e.t0.name){e.next=29;break}if(!o||0!==o.length){e.next=27;break}throw new _L({code:vL.DEVICE_NOT_FOUND,message:ow({key:yb})});case 27:if(!r||0!==r.length){e.next=29;break}throw new _L({code:vL.DEVICE_NOT_FOUND,message:ow({key:_b})});case 29:throw new _L({code:vL.INITIALIZE_FAILED,name:e.t0.name,message:e.t0.message,constraint:e.t0.constraint});case 30:case"end":return e.stop()}}),e,null,[[16,22]])})));return function(t){return e.apply(this,arguments)}}(),PK=RA({retryFunction:NK,settings:{retries:3,timeout:500},onError:function(e,t,n,i){PA.warn("getUserMedia error: ".concat(e)),"NotReadableError"===e.name?t():e.message.includes("deviceId")&&i[0].retryWhenExactFailed?(i[0].useExact=!1,t()):n(e)},onRetrying:function(e){PA.warn("getUserMedia retrying [".concat(e,"/3]"))}});function UK(e){return xK.apply(this,arguments)}function xK(){return(xK=o(n().mark((function e(i){var r,o,a,s,c,u;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={echoCancellation:i.echoCancellation,autoGainControl:i.autoGainControl,noiseSuppression:i.noiseSuppression},i.audio){e.next=5;break}r=!1,e.next=15;break;case 5:if(oO(i.microphoneId)){e.next=9;break}r=t({deviceId:i.useExact?{exact:i.microphoneId}:i.microphoneId,sampleRate:i.sampleRate,channelCount:i.channelCount},r),e.next=15;break;case 9:return r=t({sampleRate:i.sampleRate,channelCount:i.channelCount},r),e.next=12,rY.getMicrophones();case 12:o=e.sent,(a=o.filter((function(e){return e.deviceId.length>0}))).length>0&&(r.deviceId={exact:a[0].deviceId});case 15:return s={},c={ideal:i.width,max:i.width},u={ideal:i.height,max:i.height},Qb&&bD&&i.width*i.height<101376&&(c=i.width,u=i.height),s=!fw(i.facingMode)&&i.video?{facingMode:i.facingMode,width:c,height:u,frameRate:i.frameRate}:!oO(i.cameraId)&&i.video?{deviceId:i.useExact?{exact:i.cameraId}:i.cameraId,width:c,height:u,frameRate:i.frameRate}:!!i.video&&(!!fw(i.width)||{width:c,height:u,frameRate:i.frameRate}),e.abrupt("return",{audio:r,video:s});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var GK=function(){var e=o(n().mark((function e(t){var i,r,o,a,s,c,u,l,d;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!TN()){e.next=2;break}return e.abrupt("return");case 2:if(i=null,!(HD&&jD<74||zD)){e.next=27;break}return r=VK(t),PA.info("getDisplayMedia with constraints: "+JSON.stringify(r)),e.next=8,navigator.mediaDevices.getDisplayMedia(r);case 8:if(o=e.sent,!t.screenAudio){e.next=14;break}return PA.warn("Your browser not support capture system audio"),e.abrupt("return",o);case 14:if(!t.audio){e.next=24;break}return a=FK(t),PA.info("getUserMedia with constraints: "+JSON.stringify(a)),e.next=19,navigator.mediaDevices.getUserMedia(a);case 19:return i=e.sent,o.addTrack(i.getAudioTracks()[0]),e.abrupt("return",o);case 24:return e.abrupt("return",o);case 25:e.next=53;break;case 27:if(!t.screenAudio){e.next=37;break}return t.audioConstraints={echoCancellation:!0,noiseSuppression:!0,sampleRate:44100},s=VK(t),PA.info("getDisplayMedia with constraints: "+JSON.stringify(s)),e.next=33,navigator.mediaDevices.getDisplayMedia(s);case 33:return c=e.sent,e.abrupt("return",c);case 37:return u=VK(t),PA.info("getDisplayMedia with constraints: "+JSON.stringify(u)),e.next=41,navigator.mediaDevices.getDisplayMedia(u);case 41:if(l=e.sent,!t.audio){e.next=52;break}return d=FK(t),PA.info("getUserMedia with constraints: "+JSON.stringify(d)),e.next=47,navigator.mediaDevices.getUserMedia(d);case 47:return i=e.sent,l.addTrack(i.getAudioTracks()[0]),e.abrupt("return",l);case 52:return e.abrupt("return",l);case 53:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function FK(e){var t={echoCancellation:e.echoCancellation,autoGainControl:e.autoGainControl,noiseSuppression:e.noiseSuppression,sampleRate:e.sampleRate,channelCount:e.channelCount};return fw(e.microphoneId)||(t.deviceId=e.microphoneId),{audio:t,video:!1}}function VK(e){var t={systemAudio:"include",selfBrowserSurface:"include",surfaceSwitching:"include"},n={width:zD?{max:e.width}:{ideal:e.width,max:e.width},height:zD?{max:e.height}:{ideal:e.height,max:e.height},frameRate:e.frameRate,displaySurface:"monitor"};return t.video=n,fw(e.audioConstraints)||(t.audio=e.audioConstraints),t}var qK,BK,HK,jK,KK,zK,WK,YK,$K,JK=new Map([["120p",{width:160,height:120,frameRate:15,bitrate:200}],["120p_2",{width:160,height:120,frameRate:15,bitrate:100}],["180p",{width:320,height:180,frameRate:15,bitrate:350}],["180p_2",{width:320,height:180,frameRate:15,bitrate:150}],["240p",{width:320,height:240,frameRate:15,bitrate:400}],["240p_2",{width:320,height:240,frameRate:15,bitrate:200}],["360p",{width:640,height:360,frameRate:15,bitrate:800}],["360p_2",{width:640,height:360,frameRate:15,bitrate:400}],["480p",{width:640,height:480,frameRate:15,bitrate:900}],["480p_2",{width:640,height:480,frameRate:15,bitrate:500}],["720p",{width:1280,height:720,frameRate:15,bitrate:1500}],["1080p",{width:1920,height:1080,frameRate:15,bitrate:2e3}],["1440p",{width:2560,height:1440,frameRate:30,bitrate:4860}],["4K",{width:3840,height:2160,frameRate:30,bitrate:9e3}]]),XK=new Map([["480p",{width:640,height:480,frameRate:5,bitrate:900}],["480p_2",{width:640,height:480,frameRate:30,bitrate:1e3}],["720p",{width:1280,height:720,frameRate:5,bitrate:1200}],["720p_2",{width:1280,height:720,frameRate:30,bitrate:3e3}],["1080p",{width:1920,height:1080,frameRate:5,bitrate:1600}],["1080p_2",{width:1920,height:1080,frameRate:30,bitrate:4e3}]]),ZK=new Map([["standard",{sampleRate:48e3,channelCount:1,bitrate:40}],["standard-stereo",{sampleRate:48e3,channelCount:2,bitrate:64}],["high",{sampleRate:48e3,channelCount:1,bitrate:128}],["high-stereo",{sampleRate:48e3,channelCount:2,bitrate:192}]]),QK=(qK=TK.apply(void 0,M(IK.LOCAL_STREAM.switchDevice)),BK=TK(IK.STREAM.addTrack),HK=TK(IK.STREAM.removeTrack),jK=TK(IK.STREAM.replaceTrack),KK=LK({retries:10,timeout:3e3,onRetryFailed:function(e){sO.logFailedEvent({userId:this.client_?this.client_.getUserId():this.userId_,eventType:TS,error:e}),this.emitter_.emit(qN,new _L({code:vL.DEVICE_AUTO_RECOVER_FAILED,message:e.message}))}}),zK=MK(IK.LOCAL_STREAM.setAudioCaptureVolume),WK=function(e){l(M,e);var r,s,u,p,h,f,g,m,_,I=v(M);function M(e){var n;a(this,M);var i=t(t({},e),{isRemote:!1,type:"local"});return(n=I.call(this,i)).name_=nE,n.client_=null,n.video_=e.video,n.audio_=e.audio,n.cameraId_=e.cameraId,n.cameraGroupId_="",n.facingMode_=e.facingMode,n.microphoneId_=e.microphoneId,n.microphoneGroupId_="",n.videoSource_=e.videoSource,n.audioSource_=e.audioSource,n.screen_=e.screen,n.screenAudio_=e.screenAudio,n.audioProfile_={echoCancellation:!!fw(e.echoCancellation)||e.echoCancellation,autoGainControl:!!fw(e.autoGainControl)||e.autoGainControl,noiseSuppression:!!fw(e.noiseSuppression)||e.noiseSuppression,sampleRate:48e3,channelCount:1,bitrate:40},n.videoProfile_=JK.get("480p_2"),n.screenProfile_=XK.get("1080p"),n.videoSetting_=null,n.muteState_={video:!1,audio:!1,auxVideo:!1},n.beautyStatus_=!1,n.prevAudioRecoverTime_=0,n.prevVideoRecoverTime_=0,n.isAudioRecovering_=!1,n.isVideoRecovering_=!1,n.initState(),n.canvas_=null,n.canvasInterval_=null,n.canvasTrack_=null,n.gain_={audioTrack:null,source:null,gainNode:null},n.captureVolume_=100,n.enableAudoRecoverCapture_=!!fw(e.enableAudoRecoverCapture)||e.enableAudoRecoverCapture,n.log_.info("stream created: ".concat(n.id_," autoRecover: ").concat(n.enableAudoRecoverCapture_)),n}return c(M,[{key:"initState",value:function(){this.isAddingTrack_=!1,this.isRemovingTrack_=!1,this.setIsReadyToPublish(!1),this.setPublishState(BS)}},{key:"installEvents",value:function(){y(d(M.prototype),"installEvents",this).call(this),Gw.on(TA,this.onVideoTrackStopped,this),Gw.on(vA,this.onVideoTrackStopped,this),Gw.on(SA,this.onAudioTrackStopped,this),Gw.on(CA,this.onAudioTrackStopped,this)}},{key:"uninstallEvents",value:function(){y(d(M.prototype),"uninstallEvents",this).call(this),Gw.off(TA,this.onVideoTrackStopped,this),Gw.off(vA,this.onVideoTrackStopped,this),Gw.off(SA,this.onAudioTrackStopped,this),Gw.off(CA,this.onAudioTrackStopped,this)}},{key:"initialize",value:function(){var e=this;return new Promise((function(t,n){if(CN())n(new _L({code:vL.INVALID_OPERATION,message:ow({key:ub})}));else{if(fw(e.audio_)){var i=new MediaStream;return fw(e.audioSource_)||(i.addTrack(e.audioSource_),e.updateAudioPlayingState(!0)),fw(e.videoSource_)||(i.addTrack(e.videoSource_),e.updateVideoPlayingState(!0)),e.setMediaStream(i),sO.logSuccessEvent({userId:e.client_?e.client_.getUserId():e.userId_,eventType:yS,kind:"custom"}),e.setIsReadyToPublish(!0),t()}e.screen_?(e.log_.info("initialize stream audio: "+e.audio_+" screenAudio: "+e.screenAudio_+" screen: "+e.screen_),GK({audio:e.audio_,screenAudio:e.screenAudio_,microphoneId:e.microphoneId_,width:e.screenProfile_.width,height:e.screenProfile_.height,frameRate:e.screenProfile_.frameRate,sampleRate:e.audioProfile_.sampleRate,channelCount:e.audioProfile_.channelCount,autoGainControl:e.audioProfile_.autoGainControl,noiseSuppression:e.audioProfile_.noiseSuppression,echoCancellation:e.audioProfile_.echoCancellation}).then((function(n){e.setMediaStream(n),e.updateAudioPlayingState(e.audio_||e.screenAudio_),e.updateVideoPlayingState(!0);var i=e.getVideoTrack();return e.listenForScreenSharingStopped(i),e.setVideoContentHint(nC),e.updateDeviceIdInUse(),e.setIsReadyToPublish(!0),e.log_.info(JSON.stringify(i.getSettings())),sO.logSuccessEvent({userId:e.client_?e.client_.getUserId():e.userId_,eventType:yS,kind:"getDisplayMedia"}),t()})).catch((function(t){sO.logFailedEvent({userId:e.client_?e.client_.getUserId():e.userId_,eventType:yS,kind:"getDisplayMedia",error:t}),e.log_.error("getDisplayMedia error observed "+t),n(t instanceof _L?t:new _L({code:vL.INITIALIZE_FAILED,name:t.name,message:t.message}))}))):(Gw.emit(fA,{stream:e,audio:e.audio_,video:e.video_}),e.log_.info("initialize stream audio: "+e.audio_+" video: "+e.video_),PK({audio:e.audio_,video:e.video_,facingMode:e.facingMode_,cameraId:e.cameraId_,microphoneId:e.microphoneId_,width:e.videoProfile_.width,height:e.videoProfile_.height,frameRate:e.videoProfile_.frameRate,sampleRate:e.audioProfile_.sampleRate,channelCount:e.audioProfile_.channelCount,autoGainControl:e.audioProfile_.autoGainControl,noiseSuppression:e.audioProfile_.noiseSuppression,echoCancellation:e.audioProfile_.echoCancellation,useExact:!0,retryWhenExactFailed:!0}).then((function(n){return Gw.emit(gA,{stream:e,audio:e.audio_,video:e.video_}),e.setMediaStream(n),n.getTracks().forEach((function(t){t.kind===GT&&LN&&(e.videoSetting_=t.getSettings()),ON&&e.log_.info("".concat(t.kind," capabilities: ").concat(JSON.stringify(t.getCapabilities())))})),e.updateAudioPlayingState(e.audio_),e.updateVideoPlayingState(e.video_),e.updateDeviceIdInUse(),e.log_.info("gotStream hasAudio: "+e.hasAudio()+" hasVideo: "+e.hasVideo()),e.setIsReadyToPublish(!0),sO.logSuccessEvent({userId:e.client_?e.client_.getUserId():e.userId_,eventType:yS,kind:"getUserMedia"}),t()})).catch((function(t){Gw.emit(mA,{stream:e,audio:e.audio_,video:e.video_,error:t}),sO.logFailedEvent({userId:e.client_?e.client_.getUserId():e.userId_,eventType:yS,kind:"getUserMedia",error:t}),e.log_.error("getUserMedia error observed "+t),n(t)})))}}))}},{key:"listenForScreenSharingStopped",value:function(e){var t=this;e.addEventListener("ended",(function(e){t.log_.info("screen sharing was stopped because the video track is ended"),t.emitter_.emit(GN)}))}},{key:"muteAudio",value:function(){var e=y(d(M.prototype),"muteAudio",this).call(this);return e&&(this.log_.info("localStream mute audio"),this.sendMutedFlag(xT,!0)),e}},{key:"muteVideo",value:function(){var e=y(d(M.prototype),"muteVideo",this).call(this);return e&&(this.log_.info("localStream mute video"),this.sendMutedFlag(GT,!0)),e}},{key:"unmuteAudio",value:function(){var e=y(d(M.prototype),"unmuteAudio",this).call(this);return e&&(this.log_.info("localStream unmute audio"),this.sendMutedFlag(xT,!1)),e}},{key:"unmuteVideo",value:function(){var e=y(d(M.prototype),"unmuteVideo",this).call(this);return e&&(this.log_.info("localStream unmute video"),this.sendMutedFlag(GT,!1)),e}},{key:"sendMutedFlag",value:function(e,t){this.setMuteState(e,t);var n=this.getConnection();if(n){n.sendMutedFlag(this.muteState_,this);var i=n.getUserId(),r=n.getTinyId(),o="".concat(t?WT:YT," local ").concat(e," track");nO(i,{eventId:e===xT?t?CL:EL:t?SL:kL,eventDesc:o,timestamp:rv(),userId:i,tinyId:r})}}},{key:"setMuteState",value:function(e,t){this.muteState_[e]=t,this.log_.info("set ".concat(e," muted state: [").concat(t?"mute":"unmute","]"))}},{key:"setAudioProfile",value:function(e){var n;"object"===i(e)?n=e:void 0===(n=ZK.get(e))&&(n=ZK.get("standard")),this.log_.info("setAudioProfile: "+JSON.stringify(n)),this.audioProfile_=t(t({},this.audioProfile_),n)}},{key:"setVideoProfile",value:(_=o(n().mark((function e(i){var r,o,a,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.connection_||MN()){e.next=2;break}throw new _L({code:vL.NOT_SUPPORTED,message:ow({key:db})});case 2:if(lw(i)?o=t(t({},this.videoProfile_),i):gw(i)&&(o=JK.get(i),fw(o)&&(o=JK.get("480p_2"))),null!==(r=this.client_)&&void 0!==r&&r.get2k4kFlag()&&!(1===this.client_.get2k4kFlag())&&!this.screen_&&o.height*o.width>=3686400&&(o.width=1920,o.height=1080,this.log_.warn(TE)),o&&o.width*o.height>921600&&ZD&&(o.width=1280,o.height=720,this.log_.warn("reset to 1280 * 720 on iOS 13~14")),this.log_.info("setVideoProfile "+JSON.stringify(o)),!(a=this.getVideoTrack())){e.next=10;break}return e.next=10,a.applyConstraints(o);case 10:if(s=this.videoProfile_.bitrate!==o.bitrate,this.videoProfile_=o,!s||!this.connection_){e.next=16;break}return e.next=15,this.connection_.setBandwidth({bandwidth:o.bitrate,type:GT,videoType:qT});case 15:this.connection_.sendMediaSettings(this);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"getVideoBitrate",value:function(){return this.screen_?this.screenProfile_.bitrate:this.videoProfile_.bitrate}},{key:"getAudioBitrate",value:function(){return this.audioProfile_.bitrate}},{key:"setScreenProfile",value:function(e){var t=e;gw(e)&&(t=XK.get(e)||XK.get("1080p")),this.log_.info("setScreenProfile "+JSON.stringify(e)),this.screenProfile_=t}},{key:"getVideoProfile",value:function(){return this.screen_?this.screenProfile_:this.videoProfile_}},{key:"getAudioProfile",value:function(){return this.audioProfile_}},{key:"setVideoContentHint",value:function(e){var t=this.getVideoTrack();t&&"contentHint"in t&&(this.log_.info("set video track contentHint to: "+e),t.contentHint=e,t.contentHint!==e&&this.log_.warn("Invalid video track contentHint: "+e))}},{key:"switchDevice",value:(m=o(n().mark((function e(t,i){var r,o,a,s,c,u,l,d,p,h,f,g,m,v,_,y,I,M;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mediaStream_&&this.cameraId_!==i&&this.facingMode_!==i){e.next=2;break}return e.abrupt("return");case 2:if(o=t===GT,!(r=t===xT)||i!==this.microphoneId_){e.next=11;break}if(i===pE){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,QN(this.microphoneGroupId_);case 9:if(!e.sent){e.next=11;break}return e.abrupt("return");case 11:return this.setIsReadyToPublish(!1),this.log_.info("switchDevice "+t+" to: "+i),r&&(a=this.getAudioTrack(),s=this.getMicrophoneTrackMixed(),a&&a.stop(),s&&s.stop()),o&&((c=this.getVideoTrack())&&c.stop(),OD&&(u=this.getAudioTrack())&&(this.log_.info("stop audio track first in huawei env"),u.stop())),e.prev=15,e.next=18,PK({audio:r||OD,video:o,facingMode:i===KT||i===zT?i:void 0,cameraId:o?i:this.cameraId_,microphoneId:r?i:this.microphoneId_,width:this.videoProfile_.width,height:this.videoProfile_.height,frameRate:this.videoProfile_.frameRate,sampleRate:this.audioProfile_.sampleRate,channelCount:this.audioProfile_.channelCount,useExact:!0,retryWhenExactFailed:!1});case 18:if(l=e.sent,d=null,!r){e.next=25;break}(p=l.getAudioTracks()[0])&&this.isAudioTrackMixed()?(h=this.getAudioTrack(),f=rY.AudioMixerPlugin.getAudioTrackMap(),g=rY.AudioMixerPlugin.mix({targetTrack:p,sourceList:f.get(h.id).sourceList,trackList:f.get(h.id).trackList}),d=g):d=p,e.next=34;break;case 25:if(!(d=l.getVideoTracks()[0])||!this.isVideoTrackBeautified()){e.next=30;break}return e.next=29,this.generateBeautyTrack(d);case 29:d=e.sent;case 30:if(!(m=l.getAudioTracks()[0])||!OD){e.next=34;break}return e.next=34,this.replaceTrack(m);case 34:return e.next=36,this.replaceTrack(d);case 36:this.updateDeviceIdInUse(),(v=this.getConnection())&&(_=v.getUserId(),y=v.getTinyId(),I=AL,M="switch camera",r&&(I=RL,M="switch microphone"),nO(_,{eventId:I,eventDesc:M,timestamp:rv(),userId:_,tinyId:y})),this.log_.info("switch ".concat(r?"microphone":"camera"," success ")),r&&(this.audio_=!0),o&&(this.video_=!0,i!==zT&&i!==KT||(this.facingMode_=i)),this.setIsReadyToPublish(!0),e.next=50;break;case 45:throw e.prev=45,e.t0=e.catch(15),this.log_.error(e.t0),r?this.recoverCapture({audio:!0,video:!1,microphoneId:this.microphoneId_}):this.recoverCapture({audio:!1,video:!0,cameraId:this.cameraId_,facingMode:this.facingMode_}),e.t0;case 50:case"end":return e.stop()}}),e,this,[[15,45]])}))),function(e,t){return m.apply(this,arguments)})},{key:"addTrack",value:(g=o(n().mark((function e(t){var i,r,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.kind===GT&&LN&&(i=t.getSettings(),!this.videoSetting_||i.width===this.videoSetting_.width&&i.height===this.videoSetting_.height||this.log_.warn("video resolution of the track (".concat(i.width," x ").concat(i.height,") shall be kept the same as the previous: ").concat(this.videoSetting_.width," x ").concat(this.videoSetting_.height,". It may cause abnormal Cloud Recording."))),this.isAddingTrack_=!0,this.keepMuteState(t),this.mediaStream_.addTrack(t),!(r=this.getConnection())){e.next=11;break}return o=null,t.kind===GT&&(XD||JD)&&Iw(t)&&(o=this.getCanvasTrack()),e.next=11,r.addTrack(o||t,this);case 11:t.kind===xT?(this.audio_=!0,this.updateAudioPlayingState(!0),100!==this.captureVolume_&&this.setAudioCaptureVolume(this.captureVolume_)):(this.video_=!0,this.updateVideoPlayingState(!0)),this.isAddingTrack_=!1,e.next=20;break;case 15:throw e.prev=15,e.t0=e.catch(0),this.mediaStream_.removeTrack(t),this.isAddingTrack_=!1,e.t0;case 20:case"end":return e.stop()}}),e,this,[[0,15]])}))),function(e){return g.apply(this,arguments)})},{key:"removeTrack",value:(f=o(n().mark((function e(t){var i;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.isRemovingTrack_=!0,!(i=this.getConnection())){e.next=17;break}if(t.kind!==GT||!XD&&!JD||!this.canvasTrack_){e.next=10;break}return e.next=7,i.removeTrack(this.canvasTrack_,this);case 7:this.clearCanvas(),e.next=17;break;case 10:if(t.kind!==xT||!this.gain_.audioTrack){e.next=15;break}return e.next=13,i.removeTrack(this.gain_.audioTrack,this);case 13:e.next=17;break;case 15:return e.next=17,i.removeTrack(t,this);case 17:this.mediaStream_.removeTrack(t),t.kind===xT?(this.audio_=!1,this.updateAudioPlayingState(!1),this.stopGainNode()):(this.video_=!1,this.updateVideoPlayingState(!1)),this.isRemovingTrack_=!1,e.next=26;break;case 22:throw e.prev=22,e.t0=e.catch(0),this.isRemovingTrack_=!1,e.t0;case 26:case"end":return e.stop()}}),e,this,[[0,22]])}))),function(e){return f.apply(this,arguments)})},{key:"replaceTrack",value:(h=o(n().mark((function e(t){var i,r,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.kind===GT&&LN&&(i=t.getSettings(),!this.videoSetting_||i.width===this.videoSetting_.width&&i.height===this.videoSetting_.height||this.log_.warn("video resolution of the track (".concat(i.width," x ").concat(i.height,") shall be kept the same as the previous: ").concat(this.videoSetting_.width," x ").concat(this.videoSetting_.height,". It may cause abnormal Cloud Recording."))),this.keepMuteState(t),r=this.mediaStream_,t.kind!==xT){e.next=12;break}if(r.removeTrack(r.getAudioTracks()[0]),r.addTrack(t),y(d(M.prototype),"restartAudio",this).call(this),!this.gain_.gainNode){e.next=10;break}return this.reconnectGainNode(t),e.abrupt("return");case 10:e.next=15;break;case 12:r.removeTrack(r.getVideoTracks()[0]),r.addTrack(t),y(d(M.prototype),"restartVideo",this).call(this);case 15:if(!(o=this.getConnection())){e.next=21;break}if(t.kind!==GT||!XD&&!JD||!this.canvasTrack_){e.next=19;break}return e.abrupt("return");case 19:return e.next=21,o.replaceTrack(t,this);case 21:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"recoverCapture",value:(p=o(n().mark((function e(t){var i,r,o,a,s,c,u,l,d,p,h,f,g,m,v,_,y;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!this.mediaStream_||!this.enableAudoRecoverCapture_||t.audio&&!t.video&&this.isAudioRecovering_||t.video&&!t.audio&&this.isVideoRecovering_)){e.next=2;break}return e.abrupt("return");case 2:return t.audio&&(this.isAudioRecovering_=!0),t.video&&(this.isVideoRecovering_=!0),this.log_.warn("recoverCapture() trying "+JSON.stringify(t)),i=this.audio_&&t.audio,r=this.video_&&t.video,e.prev=7,e.next=10,rY.getCameras();case 10:return o=e.sent,e.next=13,rY.getMicrophones();case 13:if(a=e.sent,r&&0===o.length&&(r=!1,this.log_.warn("recoverCapture() video flag is true, but no camera detected, set video to false")),i&&0===a.length&&(i=!1,this.log_.warn("recoverCapture() audio flag is true, but no microphone detected, set audio to false")),i||r){e.next=19;break}return this.log_.warn("recoverCapture() both audio and video are false, aborted"),e.abrupt("return");case 19:return s=t&&o.findIndex((function(e){return e.deviceId===t.cameraId}))>=0,c=t&&a.findIndex((function(e){return e.deviceId===t.microphoneId}))>=0,i&&(null===(u=this.getAudioTrack())||void 0===u||u.stop()),r&&(null===(l=this.getVideoTrack())||void 0===l||l.stop()),e.next=25,PK({audio:i,video:r,cameraId:s?t.cameraId:void 0,microphoneId:c?t.microphoneId:void 0,facingMode:this.facingMode_,width:this.videoProfile_.width,height:this.videoProfile_.height,frameRate:this.videoProfile_.frameRate,sampleRate:this.audioProfile_.sampleRate,channelCount:this.audioProfile_.channelCount});case 25:d=e.sent,p=d.getTracks(),h=0;case 28:if(!(h<p.length)){e.next=55;break}if((f=p[h]).kind!==xT||!this.isAudioTrackMixed()){e.next=41;break}if(g=this.getAudioTrack(),m=rY.AudioMixerPlugin.getAudioTrackMap(),(v=m.get(g.id)).hasMicrophone){e.next=37;break}return f.stop(),e.abrupt("continue",52);case 37:return _=rY.AudioMixerPlugin.mix({targetTrack:f,sourceList:v.sourceList,trackList:v.trackList}),e.next=40,this.replaceTrack(_);case 40:return e.abrupt("continue",52);case 41:if(f.kind!==GT||!this.isVideoTrackBeautified()){e.next=48;break}return e.next=44,this.generateBeautyTrack(f);case 44:return y=e.sent,e.next=47,this.replaceTrack(y);case 47:return e.abrupt("continue",52);case 48:return e.next=50,this.replaceTrack(f);case 50:if("ended"!==f.readyState){e.next=52;break}throw new Error("new track is failed, muted ".concat(f.muted," readyState ").concat(f.readyState));case 52:h++,e.next=28;break;case 55:this.updateDeviceIdInUse(),sO.logSuccessEvent({userId:this.client_?this.client_.getUserId():this.userId_,eventType:TS}),t.audio&&(this.isAudioRecovering_=!1),t.video&&(this.isVideoRecovering_=!1),this.log_.warn("recoverCapture() successfully"),this.emitter_.emit(VN,{isCamera:t.video,isMicrophone:t.audio,cameraId:this.cameraId_,microphoneId:this.microphoneId_}),e.next=69;break;case 63:throw e.prev=63,e.t0=e.catch(7),t.audio&&(this.isAudioRecovering_=!1),t.video&&(this.isVideoRecovering_=!1),this.log_.warn("recoverCapture() failed, "+e.t0),e.t0;case 69:case"end":return e.stop()}}),e,this,[[7,63]])}))),function(e){return p.apply(this,arguments)})},{key:"updateDeviceIdInUse",value:function(){var e=this;if(!this.mediaStream_)return this.cameraId_="",this.cameraGroupId_="",this.microphoneId_="",void(this.microphoneGroupId_="");LN&&this.mediaStream_.getTracks().forEach((function(t){if(t.kind===xT&&e.isAudioTrackMixed()){var n=e.getMicrophoneTrackMixed();if(n){var i=n.getSettings(),r=i.deviceId,o=i.groupId;r&&(e.microphoneId_=r,e.microphoneGroupId_=o)}}else if(t.kind===GT&&e.isVideoTrackBeautified()){var a=e.getBeautyOriginTrack();if(a){var s=a.getSettings(),c=s.deviceId,u=s.groupId;c&&(e.cameraId_=c,e.cameraGroupId_=u)}}else{var l=t.getSettings(),d=l.deviceId,p=l.groupId;d&&(t.kind===xT?(e.microphoneId_=d,e.microphoneGroupId_=p):t.kind!==GT||e.screen_||(e.cameraId_=d,e.cameraGroupId_=p))}}));var t=this.mediaStream_.getAudioTracks(),n=this.mediaStream_.getVideoTracks();t&&0===t.length&&(this.microphoneId_="",this.microphoneGroupId_=""),n&&0===n.length&&(this.cameraId_="",this.cameraGroupId_="")}},{key:"isAudioTrackMixed",value:function(){if(rY.AudioMixerPlugin){var e=rY.AudioMixerPlugin.getAudioTrackMap(),t=this.getAudioTrack();if(e&&t&&e.has(t.id))return!0}return!1}},{key:"getMicrophoneTrackMixed",value:function(){if(rY.AudioMixerPlugin){var e=rY.AudioMixerPlugin.getAudioTrackMap(),t=this.getAudioTrack();if(e&&t&&e.has(t.id)){var n=e.get(t.id);return n.hasMicrophone?n.microphoneTrack:null}}return null}},{key:"isVideoTrackBeautified",value:function(){if(rY.beautyTrackMap){var e=rY.beautyTrackMap,t=this.getVideoTrack();if(t&&e.has(t.id))return!0}return!1}},{key:"getBeautyOriginTrack",value:function(){if(rY.beautyTrackMap){var e=rY.beautyTrackMap,t=this.getVideoTrack();if(t&&e.has(t.id)){var n=e.get(t.id);if(n.originTrack)return n.originTrack}}return null}},{key:"generateBeautyTrack",value:(u=o(n().mark((function e(t){var i,r,o,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null,r=this.getVideoTrack(),o=rY.beautyTrackMap.get(r.id),a=o.param,o.type){e.next=8;break}i=o.pluginInstance.generateBeautyTrack(t),e.next=22;break;case 8:e.t0=o.type,e.next="beauty"===e.t0?11:"virtual"===e.t0?13:"mixed"===e.t0?17:21;break;case 11:return i=o.pluginInstance.generateBeautyTrack(t),e.abrupt("break",22);case 13:return e.next=15,o.pluginInstance.generateVirtualTrack({videoTrack:t,type:a.type,img:a.img});case 15:case 19:return i=e.sent,e.abrupt("break",22);case 17:return e.next=19,o.pluginInstance.generateMixedTrack({videoTrack:t,type:a.type,img:a.img});case 21:return e.abrupt("break",22);case 22:return o.pluginInstance.deleteSource(r.id),this.log_.info("regenerate beauty track, track id = ".concat(t.id)),e.abrupt("return",i);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"getScreen",value:function(){return this.screen_}},{key:"hasScreenTrack",value:function(){if(this.screen_)return!0;var e=this.getVideoTrack();return!!e&&(e.contentHint===nC||e.contentHint===iC)}},{key:"getVideo",value:function(){return this.video_}},{key:"getAudio",value:function(){return this.audio_}},{key:"getCameraId",value:function(){return this.cameraId_}},{key:"getMicrophoneId",value:function(){return this.microphoneId_}},{key:"getMicrophoneGroupId",value:function(){return this.microphoneGroupId_}},{key:"getIsReadyToPublish",value:function(){return this.isReadyToPublish_}},{key:"setIsReadyToPublish",value:function(e){this.isReadyToPublish_=e}},{key:"setPublishState",value:function(e){this.publishState_=e}},{key:"setBeautyStatus",value:function(e){this.beautyStatus_=!!e}},{key:"getBeautyStatus",value:function(){return this.beautyStatus_}},{key:"syncMuteState",value:function(){var e=this.getAudioTrack(),t=this.getVideoTrack();if(e){var n=!e.enabled;this.setMuteState(xT,n)}if(t){var i=!t.enabled;this.setMuteState(GT,i)}this.connection_&&this.connection_.sendMutedFlag(this.muteState_,this)}},{key:"keepMuteState",value:function(e){e instanceof MediaStreamTrack&&this.muteState_[e.kind]&&(e.enabled=!1,this.log_.warn("prev ".concat(e.kind," track is muted, keep mute state")))}},{key:"onVideoTrackStopped",value:(s=o(n().mark((function e(t){var i,r,o=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.stream,r=t.type,e.t2=i!==this||!this.video_||!this.cameraId_,e.t2){e.next=6;break}return e.next=5,XN(this.getVideoTrack());case 5:e.t2=!e.sent;case 6:if(e.t1=e.t2,e.t1){e.next=9;break}e.t1=this.isVideoRecovering_;case 9:if(e.t0=e.t1,e.t0){e.next=12;break}e.t0=(bD&&zD||Xb&&Number($D)>=15.1)&&r===WT;case 12:if(!e.t0){e.next=14;break}return e.abrupt("return");case 14:if(!(Date.now()-this.prevVideoRecoverTime_<vE)){e.next=17;break}return setTimeout((function(){return o.onVideoTrackStopped({stream:i,type:r})}),vE),e.abrupt("return");case 17:r===WT?setTimeout((function(){var e=o.getVideoTrack();null!=e&&e.muted&&"visible"===document.visibilityState&&o.recoverVideoCapture(r)}),5e3):this.recoverVideoCapture(r);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"onAudioTrackStopped",value:(r=o(n().mark((function e(t){var i,r,o=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.stream,r=t.type,i===this&&this.audio_&&this.microphoneId_&&!this.isAudioRecovering_&&(!(bD&&zD||Xb&&Number($D)>=15.1)||r!==WT)){e.next=3;break}return e.abrupt("return");case 3:if(!(Date.now()-this.prevAudioRecoverTime_<vE)){e.next=6;break}return setTimeout((function(){return o.onAudioTrackStopped({stream:i,type:r})}),vE),e.abrupt("return");case 6:r===WT?setTimeout((function(){var e=o.getAudioTrack();null!=e&&e.muted&&"visible"===document.visibilityState&&o.recoverAudioCapture(r)}),5e3):this.recoverAudioCapture(r);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"recoverAudioCapture",value:function(e){this.prevAudioRecoverTime_=Date.now(),sO.uploadEvent({log:"stat-local-audio-".concat(e),userId:this.userId_}),this.recoverCapture({audio:!0,video:!1,microphoneId:this.microphoneId_})}},{key:"recoverVideoCapture",value:function(e){this.prevVideoRecoverTime_=Date.now(),sO.uploadEvent({log:"stat-local-video-".concat(e),userId:this.userId_}),this.recoverCapture({audio:!1,video:!0,cameraId:this.cameraId_})}},{key:"setAudioVolume",value:function(e){y(d(M.prototype),"setAudioVolume",this).call(this,e)}},{key:"clearCanvas",value:function(){this.canvasInterval_&&(QO.clearTask(this.canvasInterval_),this.canvasInterval_=null,this.canvas_=null,this.canvasTrack_=null)}},{key:"getCanvasTrack",value:function(){var e=this;if(this.canvasTrack_)return this.canvasTrack_;this.log_.info("gen canvas track");var t=this.getVideoTrack().getSettings(),n=t.width,i=t.height,r=t.frameRate;this.canvas_=document.createElement("canvas");var o=this.canvas_.getContext("2d");this.canvas_.width=n,this.canvas_.height=i,this.canvasInterval_=QO.run(yE,(function(){if(e.hasVideo()){var t=e.getVideoTrack().getSettings();t.width===e.canvas_.width&&t.height===e.canvas_.height||(e.canvas_.width=t.width,e.canvas_.height=t.height)}e.videoPlayer_&&e.videoPlayer_.element_&&o.drawImage(e.videoPlayer_.element_,0,0,e.canvas_.width,e.canvas_.height)}),{fps:Math.max(15,r)});var a=this.canvas_.captureStream();return this.canvasTrack_=a.getVideoTracks()[0],this.canvasTrack_}},{key:"setClient",value:function(e,t){e&&(this.log_.setUserId(e.getUserId()),this.log_.setSdkAppId(e.getSDKAppId()),t||this.syncMuteState()),this.client_=e}},{key:"setAudioCaptureVolume",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;if(!this.hasAudio()||t<0||!IN())return!1;if(this.captureVolume_===t)return!0;this.captureVolume_=t,this.log_.info("setCaptureVolume "+t),t/=100;var n=Aw();if(this.gain_.gainNode)this.gain_.gainNode.gain.value=t;else{var i,r=new MediaStream;r.addTrack(this.getAudioTrack());var o=n.createMediaStreamDestination(),a=n.createMediaStreamSource(r),s=n.createGain();s.gain.value=t,a.connect(s),s.connect(o);var c=o.stream.getAudioTracks()[0],u=function(t){return e.log_.info("gained audio track ".concat(t))};c.onmute=function(){return u("muted")},c.onunmute=function(){return u("unmuted")},c.onended=function(){return u("ended")},this.gain_={source:a,audioTrack:c,gainNode:s},null===(i=this.connection_)||void 0===i||i.replaceTrack(c),y(d(M.prototype),"restartAudio",this).call(this)}return!0}},{key:"getGainedTrack",value:function(){return this.gain_.audioTrack}},{key:"reconnectGainNode",value:function(e){this.log_.warn("reconnect gain node");var t=new MediaStream;t.addTrack(e);var n=Aw().createMediaStreamSource(t);n.connect(this.gain_.gainNode),this.gain_.source.disconnect(),this.gain_.source=n}},{key:"stopGainNode",value:function(){var e=this.gain_,t=e.audioTrack,n=e.source,i=e.gainNode;i&&(n.disconnect(),i.disconnect(),t.onmute=null,t.onunmute=null,t.onended=null,t.stop(),this.gain_={source:null,gainNode:null,audioTrack:null}),this.captureVolume_=100}},{key:"close",value:function(){this.setIsReadyToPublish(!1),this.stopGainNode(),y(d(M.prototype),"close",this).call(this)}}]),M}(EK),k(WK.prototype,"switchDevice",[qK],Object.getOwnPropertyDescriptor(WK.prototype,"switchDevice"),WK.prototype),k(WK.prototype,"addTrack",[BK],Object.getOwnPropertyDescriptor(WK.prototype,"addTrack"),WK.prototype),k(WK.prototype,"removeTrack",[HK],Object.getOwnPropertyDescriptor(WK.prototype,"removeTrack"),WK.prototype),k(WK.prototype,"replaceTrack",[jK],Object.getOwnPropertyDescriptor(WK.prototype,"replaceTrack"),WK.prototype),k(WK.prototype,"recoverCapture",[KK],Object.getOwnPropertyDescriptor(WK.prototype,"recoverCapture"),WK.prototype),k(WK.prototype,"setAudioCaptureVolume",[zK],Object.getOwnPropertyDescriptor(WK.prototype,"setAudioCaptureVolume"),WK.prototype),WK),ez={voiceActivityDetection:!1},tz=(YK=LK({retries:1,timeout:0,onRetrying:function(e){this.log_.warn("connection timeout, retrying [".concat(e,"]"))},onError:function(e,t,n){e.message.includes("timeout")?(this.reset(),this.initialize(),t()):n(e)}}),$K=function(e){l(R,e);var i,r,s,u,p,h,f,g,m,_,I,M,T,C,S,E,k,b,D,w,A=v(R);function R(e){var t;return a(this,R),(t=A.call(this,e)).localStream_=null,t.exchangeSDPTimeout_=-1,t.localAuxStream_=null,t.publishingStream_=null,t.isPublishingAuxStream_=!1,t.smallGenerator_=null,t.isSDPExchanging_=!1,t.ssrc_={audio:0,video:0,small:0,auxiliary:0},t.mediaSettings_={videoCodec:"",videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioCodec:"opus",audioFs:0,audioChannel:0,audioBps:0,smallVideoWidth:0,smallVideoHeight:0,smallVideoFps:0,smallVideoBps:0,auxVideoWidth:0,auxVideoHeight:0,auxVideoFps:0,auxVideoBps:0},t.mixedAudioTrack_=null,t}return c(R,[{key:"isMainStreamPublished",get:function(){return!!this.localStream_}},{key:"isAuxStreamPublished",get:function(){return!!this.localAuxStream_}},{key:"publishState",get:function(){var e=this,t={audio:!1,bigVideo:!1,smallVideo:!1,auxVideo:!1};if(this.peerConnection_){var n,i,r,o,a=this.peerConnection_.getSenders();a&&(_N()?(t.audio=!(null===(n=a[0])||void 0===n||!n.track),t.bigVideo=!(null===(i=a[1])||void 0===i||!i.track),t.smallVideo=!(null===(r=a[2])||void 0===r||!r.track),t.auxVideo=!(null===(o=a[3])||void 0===o||!o.track)):a.forEach((function(n){n.track&&(n.track.kind===xT?t.audio=!0:(t.bigVideo=!0,e.smallGenerator_&&(t.smallVideo=!0)))})))}return t}},{key:"initialize",value:function(){y(d(R.prototype),"initialize",this).call(this),this.installEvents()}},{key:"reset",value:function(){this.isReconnecting_&&this.stopReconnection(),this.closePeerConnection(),this.uninstallEvents(),this.clearExchangeSDPTimeout(),this.localStream_&&this.localStream_.clearCanvas()}},{key:"close",value:function(){y(d(R.prototype),"close",this).call(this),this.reset(),this.emitConnectionStateChangedEvent(jC),this.smallGenerator_&&(this.smallGenerator_.destroy(),this.smallGenerator_=null)}},{key:"installEvents",value:function(){this.emitter_.on(PN.ERROR,this.handleError,this),this.emitter_.on(PN.CONNECTION_STATE_CHANGED,this.handleConnectionStateChange,this)}},{key:"uninstallEvents",value:function(){this.emitter_.off(PN.ERROR,this.handleError,this),this.emitter_.off(PN.CONNECTION_STATE_CHANGED,this.handleConnectionStateChange,this)}},{key:"publish",value:(w=o(n().mark((function e(t,i){var r,o,a,s,c,u;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.publishingStream_=t,this.isPublishingAuxStream_=i,a=t.getVideoTrack(),s=null,!a||i||!this.client_.getIsEnableSmallStream()){e.next=9;break}return this.smallGenerator_=new RK(t),e.next=8,this.smallGenerator_.initialize();case 8:s=this.smallGenerator_.generateSmallVideoTrack(this.client_.smallStreamConfig_);case 9:if(null===(r=this.client_)||void 0===r||!r.get2k4kFlag()){e.next=18;break}if(c=1===this.client_.get2k4kFlag(),u=t.getVideoProfile(),c||t.getScreen()||!(u.height*u.width>=3686400)){e.next=18;break}return u.width=1920,u.height=1080,this.log_.warn(TE),e.next=18,t.setVideoProfile(u);case 18:if(this.updateMediaSettings(t,i),!yN()){e.next=24;break}return e.next=22,this.publishByTransceiver(t,s,i);case 22:e.next=26;break;case 24:return e.next=26,this.publishByAddTrack(t,s);case 26:return this.publishingStream_=null,this.isPublishingAuxStream_=!1,i?this.localAuxStream_=t:this.localStream_=t,null===(o=this.sei_)||void 0===o||o.handleEncodedStreams(),e.abrupt("return",t);case 31:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"publishByTransceiver",value:(D=o(n().mark((function e(t,i,r){var o,a,s,c,u,l,d;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log_.info("publish by transceiver"),o=t.getMediaStream(),a=t.getAudioTrack(),s=t.getVideoTrack(),c=null,(XD||JD)&&Iw(s)&&(c=t.getCanvasTrack()),0!==(u=this.peerConnection_.getTransceivers()).length){e.next=16;break}return this.peerConnection_.addTransceiver(a||xT,{direction:gC,streams:[o]}),this.peerConnection_.addTransceiver(r?GT:c||s||GT,{direction:gC,streams:[o]}),this.peerConnection_.addTransceiver(i||GT,{direction:gC,streams:[o]}),this.peerConnection_.addTransceiver(r?c||s:GT,{direction:gC,streams:[o]}),e.next=14,this.connect();case 14:e.next=46;break;case 16:if(l=[],!a){e.next=29;break}if(!u[0].sender.track){e.next=24;break}return this.mixAudioTrack(u[0].sender.track,a),e.next=22,u[0].sender.replaceTrack(this.mixedAudioTrack_);case 22:e.next=27;break;case 24:return e.next=26,u[0].sender.replaceTrack(a);case 26:l.push(0);case 27:return e.next=29,this.setBandwidth({bandwidth:t.getAudioBitrate(),type:xT});case 29:if(!s){e.next=42;break}return d=r?3:1,e.next=33,u[d].sender.replaceTrack(c||s);case 33:return e.next=35,this.setBandwidth({bandwidth:t.getVideoBitrate(),type:GT,videoType:r?BT:qT});case 35:if(l.push(d),!i){e.next=42;break}return e.next=39,u[2].sender.replaceTrack(i);case 39:return e.next=41,this.setBandwidth({bandwidth:this.client_.smallStreamConfig.bitrate,type:GT,videoType:VT});case 41:l.push(2);case 42:return e.next=44,this.setTransceiverDirection(gC,l);case 44:return e.next=46,this.doPublishChange();case 46:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return D.apply(this,arguments)})},{key:"publishByAddTrack",value:(b=o(n().mark((function e(t,i){var r,o,a,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log_.info("publish by addtrack"),r=t.getMediaStream(),o=t.getAudioTrack(),a=t.getVideoTrack(),o&&this.peerConnection_.addTrack(o,r),a&&(this.peerConnection_.addTrack(a,r),i&&((s=new MediaStream).addTrack(i),this.peerConnection_.addTrack(i,s))),e.next=8,this.connect();case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"unpublish",value:(k=o(n().mark((function e(i){var r,o,a,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_N()){e.next=2;break}return e.abrupt("return",this.doUnpublish());case 2:if(r=i.getAudioTrack(),o=i===this.localAuxStream_,a=this.peerConnection_.getSenders(),s=[],!r){e.next=17;break}if(!this.mixedAudioTrack_){e.next=14;break}return this.log_.info("has mixed audioTrack, use another audioTrack"),e.next=11,a[0].replaceTrack(o?this.localStream_.getAudioTrack():this.localAuxStream_.getAudioTrack());case 11:this.destroyMixedAudioTrack(),e.next=17;break;case 14:return e.next=16,a[0].replaceTrack(null);case 16:s.push(0);case 17:if(!o){e.next=25;break}return e.next=20,a[3].replaceTrack(null);case 20:this.localAuxStream_=null,this.mediaSettings_=t(t({},this.mediaSettings_),{},{auxVideoBps:0,auxVideoFps:0,auxVideoWidth:0,auxVideoHeight:0}),s.push(3),e.next=32;break;case 25:return e.next=27,a[1].replaceTrack(null);case 27:return e.next=29,a[2].replaceTrack(null);case 29:this.localStream_=null,this.mediaSettings_=t(t({},this.mediaSettings_),{},{videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioFs:0,audioChannel:0,audioBps:0,smallVideoWidth:0,smallVideoHeight:0,smallVideoFps:0,smallVideoBps:0}),s.push(1,2);case 32:if(!this.localStream_&&!this.localAuxStream_){e.next=39;break}return e.next=35,this.setTransceiverDirection(fC,s);case 35:return e.next=37,this.doPublishChange();case 37:e.next=41;break;case 39:return e.next=41,this.doUnpublish();case 41:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"doPublishChange",value:(E=o(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={state:this.publishState,constraintConfig:this.mediaSettings_},e.next=3,this.signalChannel_.sendWaitForResponse({command:ZR,data:t,responseCommand:JR.PUBLISH_STATE_CHANGE_RESULT});case 3:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"doUnpublish",value:function(){var e=this;return this.signalChannel_.sendWaitForResponse({command:rL,commandDesc:"unpublish",responseCommand:JR.UNPUBLISH_RESULT}).then((function(){e.close()})).catch((function(){e.close()}))}},{key:"updateMediaSettings",value:function(e,t){var n=this;this.localAuxStream_&&e===this.localAuxStream_&&(t=!0);var i=this.client_.getSystemResult().detail,r=i.isH264EncodeSupported,o=i.isVp8EncodeSupported;r?this.mediaSettings_.videoCodec="H264":o&&(this.mediaSettings_.videoCodec="VP8"),LN?e.getMediaStream().getTracks().forEach((function(i){var r=i.getSettings();if(i.kind===xT){var o=1;r.channelCount&&(o=r.channelCount),n.mediaSettings_.audioChannel=o,n.mediaSettings_.audioBps=1e3*e.getAudioBitrate(),n.mediaSettings_.audioFs=r.sampleRate}else if(i.kind===GT){if(t)return n.mediaSettings_.auxVideoWidth=r.width,n.mediaSettings_.auxVideoHeight=r.height,n.mediaSettings_.auxVideoFps=r.frameRate,void(n.mediaSettings_.auxVideoBps=1e3*e.getVideoBitrate());n.client_.getIsEnableSmallStream()&&(n.mediaSettings_.smallVideoWidth=n.client_.smallStreamConfig.width,n.mediaSettings_.smallVideoHeight=n.client_.smallStreamConfig.height,n.mediaSettings_.smallVideoFps=n.client_.smallStreamConfig.frameRate,n.mediaSettings_.smallVideoBps=1e3*n.client_.smallStreamConfig.bitrate),n.mediaSettings_.videoWidth=r.width,n.mediaSettings_.videoHeight=r.height,n.mediaSettings_.videoFps=r.frameRate,n.mediaSettings_.videoBps=1e3*e.getVideoBitrate()}})):this.updateMediaSettingsFromProfile(e),this.log_.info("updateMediaSettings: "+JSON.stringify(this.mediaSettings_))}},{key:"updateMediaSettingsFromProfile",value:function(e){if(e){if(e.hasAudio()){var t=e.getAudioProfile();this.mediaSettings_.audioChannel=t.channelCount,this.mediaSettings_.audioBps=1e3*t.bitrate,this.mediaSettings_.audioFs=t.sampleRate}if(e.hasVideo()){var n=e.getVideoProfile();this.mediaSettings_.videoWidth=n.width,this.mediaSettings_.videoHeight=n.height,this.mediaSettings_.videoFps=n.frameRate,this.mediaSettings_.videoBps=1e3*n.bitrate}}}},{key:"sendMediaSettings",value:function(e){var t=this;this.updateMediaSettings(e),this.signalChannel_.sendWaitForResponse({command:mL,data:this.mediaSettings_,responseCommand:JR.UPDATE_CONSTRAINT_CONFIG_RES}).then((function(e){0!==e.data.code&&t.log_.warn(e.data.message)})).catch(this.log_.warn)}},{key:"addTrack",value:(S=o(n().mark((function e(t,i){var r,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.peerConnection_){e.next=2;break}return e.abrupt("return");case 2:if(o=i===this.localAuxStream_,this.log_.info("is adding ".concat(t.kind," track to current published local ").concat(o?BT:rC," stream")),null===(r=this.sei_)||void 0===r||r.handleEncodedStreams(),!_N()){e.next=10;break}return e.next=8,this.addTrackByTransceiver(t,i);case 8:e.next=12;break;case 10:return e.next=12,this.addTrackBySender(t);case 12:nO(this.userId_,{eventId:t.kind===xT?IL:yL,eventDesc:"add ".concat(t.kind," track to current published stream"),timestamp:rv(),userId:this.userId_,tinyId:this.tinyId_});case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return S.apply(this,arguments)})},{key:"addTrackByTransceiver",value:(C=o(n().mark((function e(t,i){var r,o,a,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i===this.localAuxStream_,o=this.peerConnection_.getTransceivers(),t.kind!==xT){e.next=13;break}if(!o[0].sender.track){e.next=9;break}return this.mixAudioTrack(o[0].sender.track,t),e.next=7,o[0].sender.replaceTrack(this.mixedAudioTrack_);case 7:e.next=11;break;case 9:return e.next=11,o[0].sender.replaceTrack(t);case 11:e.next=26;break;case 13:return a=r?3:1,e.next=16,o[a].sender.replaceTrack(t);case 16:if(1!==a||!this.client_.getIsEnableSmallStream()){e.next=23;break}return this.smallGenerator_=new RK(this.localStream_),e.next=20,this.smallGenerator_.initialize();case 20:return s=this.smallGenerator_.generateSmallVideoTrack(this.client_.smallStreamConfig_),e.next=23,o[2].sender.replaceTrack(s);case 23:if(o[a].direction!==fC){e.next=26;break}return e.next=26,this.setTransceiverDirection(gC,[a]);case 26:return this.updateMediaSettings(i,r),e.next=29,this.doPublishChange();case 29:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"addTrackBySender",value:(T=o(n().mark((function e(t){var i,r,o,a,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(_N()&&this.peerConnection_.getTransceivers().findIndex((function(e){return"stopped"===e.direction}))>=0)){e.next=4;break}return this.log_.warn("transceiver is stopping, negotiate sdp first"),e.next=4,this.updateOffer(VS.REMOVE,t);case 4:if(!(i=this.peerConnection_.getSenders().find((function(e){return e.track&&e.track.kind===t.kind})))){e.next=11;break}return this.log_.warn("sender already exists, remove sender first"),r=i.track,this.removeSender(i),e.next=11,this.updateOffer(VS.REMOVE,r);case 11:if(o=this.localStream_.getMediaStream(),this.peerConnection_.addTrack(t,o),t.kind!==GT||!this.client_.getIsEnableSmallStream()){e.next=21;break}return this.smallGenerator_=new RK(this.localStream_),e.next=17,this.smallGenerator_.initialize();case 17:a=this.smallGenerator_.generateSmallVideoTrack(this.client_.smallStreamConfig_),(s=new MediaStream).addTrack(a),this.peerConnection_.addTrack(a,s);case 21:return e.next=23,this.updateOffer(VS.ADD,t);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"isNeedToResetOfferOrder",value:function(){if(this.sdpSemantics_===RS||!this.peerConnection_||!this.peerConnection_.localDescription)return!1;for(var e=this.peerConnection_.localDescription.sdp,t=kO(e),n=0;n<t.media.length;n++)if(0===t.media[n].mid&&t.media[n].type===GT)return!0;return!1}},{key:"removeSender",value:function(e){var t=null;_N()&&(t=this.peerConnection_.getTransceivers().find((function(t){return t.sender&&t.sender.track===e.track}))),this.peerConnection_.removeTrack(e),t&&hw(t.stop)&&(this.log_.info("stop transceiver"),t.stop())}},{key:"removeTrack",value:(M=o(n().mark((function e(t,i){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.peerConnection_){e.next=2;break}return e.abrupt("return");case 2:if(this.log_.info("is removing ".concat(t.kind," track from current published local ").concat(i===this.localAuxStream_?BT:rC," stream")),!_N()){e.next=8;break}return e.next=6,this.removeTrackByTransceiver(t,i);case 6:e.next=10;break;case 8:return e.next=10,this.removeTrackBySender(t);case 10:nO(this.userId_,{eventId:t.kind===xT?TL:ML,eventDesc:"remove ".concat(t.kind," track from current published stream"),timestamp:rv(),userId:this.userId_,tinyId:this.tinyId_});case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return M.apply(this,arguments)})},{key:"removeTrackByTransceiver",value:(I=o(n().mark((function e(t,i){var r,o,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i===this.localAuxStream_,o=this.peerConnection_.getTransceivers(),t.kind!==xT){e.next=13;break}if(!this.mixedAudioTrack_){e.next=9;break}return e.next=6,o[0].sender.replaceTrack(r?this.localStream_.getAudioTrack():this.localAuxStream_.getAudioTrack());case 6:this.destroyMixedAudioTrack(),e.next=11;break;case 9:return e.next=11,o[0].sender.replaceTrack(null);case 11:e.next=23;break;case 13:return a=r?3:1,e.next=16,o[a].sender.replaceTrack(null);case 16:if(1!==a||!this.smallGenerator_){e.next=21;break}return this.smallGenerator_.destroy(),this.smallGenerator_=null,e.next=21,o[2].sender.replaceTrack(null);case 21:return e.next=23,this.setTransceiverDirection(fC,[a]);case 23:return this.updateMediaSettings(i,r),e.next=26,this.doPublishChange();case 26:case"end":return e.stop()}}),e,this)}))),function(e,t){return I.apply(this,arguments)})},{key:"setTransceiverDirection",value:(_=o(n().mark((function e(t,i){var r,o,a,s,c,u;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Qb){e.next=2;break}return e.abrupt("return");case 2:if(r=!1,o=!1,this.log_.info("setting transceiver ".concat(i.join(",")," direction to ").concat(t)),a=this.peerConnection_.getTransceivers(),i.forEach((function(e){a[e].direction!==t&&(a[e].direction=t,r=!0)})),!r){e.next=14;break}return this.log_.info("updating offer"),e.next=11,this.peerConnection_.createOffer();case 11:return s=e.sent,e.next=14,this.peerConnection_.setLocalDescription(s);case 14:if(c=-1,u=this.peerConnection_.remoteDescription.sdp.split("\r\n").map((function(e){if(e.match(new RegExp("a=(".concat(fC,"|").concat(mC,"|").concat(gC,")")))&&c++,i.includes(c)){if(t===fC&&e.includes("a=".concat(mC)))return o=!0,"a=".concat(t);if(t===gC&&e.includes("a=".concat(fC)))return o=!0,"a=".concat(mC)}return e})).join("\r\n"),!o){e.next=20;break}return this.log_.info("updating answer"),e.next=20,this.peerConnection_.setRemoteDescription({type:"answer",sdp:u});case 20:case"end":return e.stop()}}),e,this)}))),function(e,t){return _.apply(this,arguments)})},{key:"removeTrackBySender",value:(m=o(n().mark((function e(t){var i,r,o=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.kind!==GT||!this.isNeedToResetOfferOrder()){e.next=7;break}return this.reset(),this.initialize(),null===(i=this.localStream_.getMediaStream())||void 0===i||i.removeTrack(t),e.next=6,this.publish(this.localStream_);case 6:return e.abrupt("return");case 7:return(r=this.peerConnection_.getSenders().find((function(e){return e.track===t})))&&(this.removeSender(r),t.kind===GT&&this.smallGenerator_&&(this.smallGenerator_.destroy(),this.smallGenerator_=null,this.peerConnection_.getSenders().forEach((function(e){e.track&&e.track.kind===GT&&o.removeSender(e)})))),e.next=11,this.updateOffer(VS.REMOVE,t);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"replaceTrack",value:(g=o(n().mark((function e(t,i){var r,o,a,s,c,u,l;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((o=null===(r=this.peerConnection_)||void 0===r?void 0:r.getSenders())&&0!==o.length){e.next=3;break}throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Ak})});case 3:if(a=i===this.localAuxStream_,this.log_.info("is replacing ".concat(t.kind," track to current published local ").concat(a?BT:rC," stream")),t.kind!==xT||!o[0]){e.next=16;break}if(!(this.mixedAudioTrack_&&null!==(s=this.localStream_)&&void 0!==s&&s.hasAudio()&&null!==(c=this.localAuxStream_)&&void 0!==c&&c.hasAudio())){e.next=14;break}return this.destroyMixedAudioTrack(),u=a?this.localStream_.getAudioTrack():this.localAuxStream_.getAudioTrack(),this.mixAudioTrack(t,u),e.next=12,o[0].replaceTrack(this.mixedAudioTrack_);case 12:e.next=16;break;case 14:return e.next=16,o[0].replaceTrack(t);case 16:if(t.kind!==GT){e.next=32;break}if(i!==this.localStream_||!o[1]){e.next=29;break}return e.next=20,o[1].replaceTrack(t);case 20:if(!this.smallGenerator_||!o[2]){e.next=29;break}return this.log_.info("replacing smallVideo"),this.smallGenerator_.destroy(),this.smallGenerator_=new RK(this.localStream_),e.next=26,this.smallGenerator_.initialize();case 26:return l=this.smallGenerator_.generateSmallVideoTrack(this.client_.smallStreamConfig_),e.next=29,o[2].replaceTrack(l);case 29:if(i!==this.localAuxStream_||!o[3]){e.next=32;break}return e.next=32,o[3].replaceTrack(t);case 32:nO(this.userId_,{eventId:t.kind===xT?OL:LL,eventDesc:"replace ".concat(t.kind," track from current published stream"),timestamp:rv(),userId:this.userId_,tinyId:this.tinyId_});case 33:case"end":return e.stop()}}),e,this)}))),function(e,t){return g.apply(this,arguments)})},{key:"updateOffer",value:(f=o(n().mark((function e(t,i){var r,o,a,s,c,u,l;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peerConnection_.createOffer(ez);case 3:return r=e.sent,Qb&&(r.sdp=this.setSDPDirection(r.sdp,"sendrecv")),e.next=7,this.peerConnection_.setLocalDescription(r);case 7:return o=this.updateMediaSettings(this.localStream_||this.localAuxStream_),a={action:t,trackId:i.id,kind:i.kind===GT?"bigVideo":i.kind,type:"offer",sdp:this.peerConnection_.localDescription.sdp,constraintConfig:o,state:this.publishState},this.log_.info("createOffer success, sending updated offer to remote server"),this.log_.debug("updatedOffer: "+a.sdp),e.next=13,this.signalChannel_.sendWaitForResponse({command:XR,data:a,responseCommand:JR.UPDATE_OFFER_RESULT,timeout:1e4,commandDesc:"update offer"});case 13:return s=e.sent,c=s.data,u=c.code,l=c.message,0!==u&&this.checkPublishResultCode(u,l),e.next=18,this.acceptAnswer(s.data.data);case 18:this.updateSSRC(r.sdp),sO.logSuccessEvent({userId:this.client_.getUserId(),eventType:mS,kind:"offer"}),e.next=27;break;case 22:throw e.prev=22,e.t0=e.catch(0),this.log_.error(e.t0),sO.logFailedEvent({userId:this.client_.getUserId(),eventType:mS,kind:"offer",error:e.t0}),e.t0;case 27:case"end":return e.stop()}}),e,this,[[0,22]])}))),function(e,t){return f.apply(this,arguments)})},{key:"setBandwidth",value:(h=o(n().mark((function e(t){var i,r,o,a,s,c,u,l;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.bandwidth,r=t.type,o=t.videoType,a=void 0===o?"":o,s=t.sdp,MN()||!s){e.next=3;break}return e.abrupt("return",r===GT?this.updateVideoBandwidthRestriction(s,i,a):this.updateAudioBandwidthRestriction(s,i));case 3:if(c=0,r===GT&&(c=a===VT?2:a===BT?3:1),!(u=this.peerConnection_.getSenders()[c])){e.next=22;break}return(l=u.getParameters()).encodings&&0!==l.encodings.length||(l.encodings=[{}]),"unlimited"===i?delete l.encodings[0].maxBitrate:l.encodings[0].maxBitrate=1e3*i,e.prev=10,e.next=13,u.setParameters(l);case 13:return this.log_.info(a+r+" bandwidth was set to "+i+" kbps"),e.abrupt("return",s);case 17:if(e.prev=17,e.t0=e.catch(10),this.log_.info("failed to set bandwidth by setting maxBitrate: "+e.t0),!s){e.next=22;break}return e.abrupt("return",r===GT?this.updateVideoBandwidthRestriction(s,i,a):this.updateAudioBandwidthRestriction(s,i));case 22:return e.abrupt("return",s);case 23:case"end":return e.stop()}}),e,this,[[10,17]])}))),function(e){return h.apply(this,arguments)})},{key:"updateVideoBandwidthRestriction",value:function(e,t,n){var i="AS";Qb&&(i="TIAS",t*=1e3);var r=0,o=-1;return n===VT?r=1:n===BT&&(r=2),e=e.replace(/m=video (.*)\r\nc=IN (.*)\r\n/g,(function(e){return++o===r?"".concat(e,"b=").concat(i,":").concat(t,"\r\n"):e}))}},{key:"updateAudioBandwidthRestriction",value:function(e,t){var n="AS";return Qb&&(n="TIAS",t*=1e3),e.replace(/m=audio (.*)\r\nc=IN (.*)\r\n/,"m=audio $1\r\nc=IN $2\r\nb="+n+":"+t+"\r\n")}},{key:"removeBandwidthRestriction",value:function(e){return e.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"")}},{key:"removeVideoOrientation",value:function(e){return e.replace(/urn:3gpp:video-orientation/,"")}},{key:"connect",value:(p=o(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.exchangeSDP();case 3:return e.next=5,this.waitForPeerConnectionConnected();case 5:e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(0),this.closePeerConnection(!0),e.t0;case 11:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return p.apply(this,arguments)})},{key:"exchangeSDP",value:(u=o(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.isSDPExchanging_=!0,e.next=4,this.createOffer();case 4:return this.log_.info("createOffer success, sending offer to remote server"),e.next=7,this.doExchangeSDP();case 7:this.isSDPExchanging_=!1,e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(0),this.isSDPExchanging_=!1,e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return u.apply(this,arguments)})},{key:"createOffer",value:(s=o(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peerConnection_.createOffer(ez);case 3:return t=e.sent,e.next=6,this.peerConnection_.setLocalDescription(t);case 6:this.updateSSRC(t.sdp),sO.logSuccessEvent({userId:this.client_.getUserId(),eventType:mS,kind:"offer"}),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(0),sO.logFailedEvent({userId:this.client_.getUserId(),eventType:mS,kind:"offer",error:e.t0}),e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return s.apply(this,arguments)})},{key:"doExchangeSDP",value:function(){var e=this;return new Promise((function(t,i){e.exchangeSDPTimeout_=setTimeout((function(){e.signalChannel_.off(JR.PUBLISH_RESULT,a),e.clearExchangeSDPTimeout();var t=new _L({code:vL.API_CALL_TIMEOUT,message:ow({key:qE})});i(t)}),1e4);var r,a=(r=o(n().mark((function r(o){var a,s,c;return n().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,e.clearExchangeSDPTimeout(),a=o.data,s=a.code,c=a.message,0!==s){n.next=9;break}return n.next=6,e.acceptAnswer(o.data.data);case 6:t(),n.next=10;break;case 9:e.checkPublishResultCode(s,c);case 10:n.next=15;break;case 12:n.prev=12,n.t0=n.catch(0),i(n.t0);case 15:case"end":return n.stop()}}),r,null,[[0,12]])}))),function(e){return r.apply(this,arguments)}),s={type:e.peerConnection_.localDescription.type,sdp:e.removeVideoOrientation(e.peerConnection_.localDescription.sdp),screen:(e.publishingStream_||e.localStream_).hasScreenTrack(),state:e.publishState,constraintConfig:e.mediaSettings_};e.signalChannel_.once(JR.PUBLISH_RESULT,a),e.log_.debug("sending sdp offer: "+s.sdp),e.signalChannel_.send(iL,s)}))}},{key:"setSDPDirection",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"all",i=kO(e);return i.media.forEach((function(e){"all"!==n&&e.type!==n||(e.direction=t)})),bO(i)}},{key:"acceptAnswer",value:(r=o(n().mark((function e(t){var i,r,o,a,s,c,u;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,i=this.removeVideoOrientation(t.sdp),!(r=this.publishingStream_||this.localStream_)){e.next=15;break}if(o=r.getVideoBitrate(),a=r.getAudioBitrate(),!o){e.next=11;break}return s=this.isPublishingAuxStream_?BT:qT,e.next=10,this.setBandwidth({bandwidth:o,type:GT,sdp:i,videoType:s});case 10:i=e.sent;case 11:if(!a){e.next=15;break}return e.next=14,this.setBandwidth({bandwidth:a,type:xT,sdp:i});case 14:i=e.sent;case 15:if(!this.client_.getIsEnableSmallStream()){e.next=20;break}return c=this.client_.smallStreamConfig,e.next=19,this.setBandwidth({bandwidth:c.bitrate,type:GT,videoType:VT,sdp:i});case 19:i=e.sent;case 20:return u={type:t.type,sdp:i},e.next=23,this.peerConnection_.setRemoteDescription(u);case 23:this.log_.debug("accepted answer: "+i),sO.logSuccessEvent({userId:this.client_.getUserId(),eventType:vS,kind:"answer"}),e.next=32;break;case 27:throw e.prev=27,e.t0=e.catch(0),sO.logFailedEvent({userId:this.client_.getUserId(),eventType:vS,kind:"answer",error:e.t0}),this.log_.error("failed to accept remote answer "+e.t0),e.t0;case 32:case"end":return e.stop()}}),e,this,[[0,27]])}))),function(e){return r.apply(this,arguments)})},{key:"sendMutedFlag",value:function(e,t){if(t!==this.localAuxStream_){var n={audio:e.audio,bigVideo:e.video,auxVideo:e.auxVideo};this.log_.info("send muted state: ".concat(JSON.stringify(n))),this.signalChannel_.send(nL,n)}}},{key:"getIsReconnecting",value:function(){return this.isReconnecting_}},{key:"reconnect",value:(i=o(n().mark((function e(){var t,i,r=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===this.reconnectionTimer_){e.next=3;break}return this.log_.warn("reconnect() uplink is reconnecting, ignore current reconnection"),e.abrupt("return");case 3:if(!(this.reconnectionCount_>=30)){e.next=12;break}return this.log_.warn("SDK has tried reconnect uplink for ".concat(30," times, but all failed, please check your network")),this.stopReconnection(),t=new _L({code:vL.UPLINK_RECONNECTION_FAILED,message:ow({key:jE})}),sO.logFailedEvent({userId:this.client_.getUserId(),eventType:hS,error:t}),this.addEventInternal($L,"uplink-connection reconnect fail"),this.emitConnectionStateChangedEvent(jC),this.emitter_.emit(PN.ERROR,t),e.abrupt("return");case 12:if(this.signalChannel_.getCurrentState()===WR){e.next=16;break}return this.log_.warn("reconnect() signal channel is not connected, suspend reconnection until signal is connected"),this.signalChannel_.once(BR,this.reconnect,this),e.abrupt("return");case 16:if(this.reconnectionCount_++,e.prev=17,this.log_.warn("reconnect() try to reconnect uplink [".concat(this.reconnectionCount_,"/").concat(30,"]")),i=pw(this.reconnectionCount_),this.reconnectionTimer_=setTimeout((function(){r.log_.warn("reconnect() uplink reconnect timeout(".concat(i/1e3,"s), try again")),r.clearReconnectionTimer(),r.reconnect()}),i),!(this.isSDPExchanging_||this.peerConnection_&&this.peerConnection_.connectionState===$C)){e.next=23;break}return e.abrupt("return");case 23:return e.next=25,this.signalChannel_.sendWaitForResponse({command:rL,responseCommand:JR.UNPUBLISH_RESULT,enableLog:!1});case 25:if(this.reset(),this.initialize(),!this.localStream_){e.next=30;break}return e.next=30,this.publish(this.localStream_);case 30:if(!this.localAuxStream_){e.next=33;break}return e.next=33,this.publish(this.localAuxStream_,!0);case 33:sO.logSuccessEvent({userId:this.client_.getUserId(),eventType:hS}),this.log_.warn("reconnect() uplink reconnect successfully"),this.addEventInternal(YL,"uplink-connection reconnect success"),this.stopReconnection(),this.localStream_.syncMuteState(),e.next=42;break;case 40:e.prev=40,e.t0=e.catch(17);case 42:case"end":return e.stop()}}),e,this,[[17,40]])}))),function(){return i.apply(this,arguments)})},{key:"clearExchangeSDPTimeout",value:function(){-1!==this.exchangeSDPTimeout_&&(clearTimeout(this.exchangeSDPTimeout_),this.exchangeSDPTimeout_=-1)}},{key:"clearReconnectionTimer",value:function(){-1!==this.reconnectionTimer_&&(clearTimeout(this.reconnectionTimer_),this.reconnectionTimer_=-1)}},{key:"handleError",value:function(e){e.getCode()===vL.ICE_TRANSPORT_ERROR&&(this.isFirstConnection_&&(this.isFirstConnection_=!1,sO.logFailedEvent({userId:this.client_.getUserId(),eventType:pS,error:e})),this.isReconnecting_||this.startReconnection())}},{key:"handleConnectionStateChange",value:function(e){e.state===WC&&this.isFirstConnection_&&(this.isFirstConnection_=!1,sO.logSuccessEvent({userId:this.client_.getUserId(),eventType:pS}),this.addEventInternal(BL,"uplink-connection is connected"))}},{key:"updateSSRC",value:function(e){var t=this;try{kO(e).media.forEach((function(e,n){if(e.type===xT){var i=e.ssrcs[0];i&&(t.ssrc_.audio=i.id)}else{if(t.sdpSemantics_===RS)return void e.ssrcGroups.forEach((function(e,n){var i=Number(e.ssrcs.split(" ")[0]);0===n?t.ssrc_.video=i:1===n&&(t.ssrc_.small=i)}));var r=e.ssrcs[0];if(!r)return;switch(n){case 1:t.ssrc_.video=r.id;break;case 2:t.ssrc_.small=r.id;break;case 3:t.ssrc_.auxiliary=r.id}}}))}catch(oY){}}},{key:"getVideoTrackId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:GT;if(this.peerConnection_){var t=this.peerConnection_.getSenders();if(e===GT&&t[1]&&t[1].track)return t[1].track.id;if(e===VT&&t[2]&&t[2].track)return t[2].track.id;if(e===BT&&t[3]&&t[3].track)return t[3].track.id}if(this.localStream_&&e===GT){var n=this.localStream_.getVideoTrack();if(n)return n.id}if(this.localAuxStream_&&e===BT){var i=this.localAuxStream_.getVideoTrack();if(i)return i.id}return""}},{key:"getSSRC",value:function(){return this.ssrc_}},{key:"checkPublishResultCode",value:function(e,t){if(0!==e)throw 1028===e?(this.log_.error(Pb.NOT_SUPPORTED_H264ENCODE),new _L({code:vL.NOT_SUPPORTED_H264,message:ow({key:pb})})):new _L({code:vL.UNKNOWN,message:ow({key:Ib,data:{signalResponse:JR.PUBLISH_RESULT,code:e,message:t}})})}},{key:"getLocalStream",value:function(){return this.localStream_}},{key:"sendSEI",value:function(e,t){this.sei_.push(e,t)}},{key:"mixAudioTrack",value:function(e,t){this.log_.info("mix audio track"),this.mixedAudioTrack_=function(e){var t=ww(),n=t.createMediaStreamDestination(),i=[];e.forEach((function(e){var r=new MediaStream;r.addTrack(e);var o=t.createMediaStreamSource(r);o.connect(n),i.push(o)}));var r=n.stream.getAudioTracks()[0];return OK.set(r,{destination:n,track:r,mediaStreamSourceList:i}),r}([e,t])}},{key:"destroyMixedAudioTrack",value:function(){this.mixedAudioTrack_&&(this.log_.info("destroy audio track"),function(e){if(OK.has(e)){var t=OK.get(e),n=t.destination,i=t.track,r=t.mediaStreamSourceList;i.stop(),n.disconnect(),r.forEach((function(e){e.disconnect()})),OK.delete(e)}}(this.mixedAudioTrack_),this.mixedAudioTrack_=null)}}]),R}(dK),k($K.prototype,"publish",[YK],Object.getOwnPropertyDescriptor($K.prototype,"publish"),$K.prototype),$K),nz=te,iz=Gl,rz=Bc.exports.getWeakData,oz=dl,az=ln,sz=se,cz=Ie,uz=cl,lz=gt,dz=ai.set,pz=ai.getterFor,hz=mo.find,fz=mo.findIndex,gz=nz([].splice),mz=0,vz=function(e){return e.frozen||(e.frozen=new _z)},_z=function(){this.entries=[]},yz=function(e,t){return hz(e.entries,(function(e){return e[0]===t}))};_z.prototype={get:function(e){var t=yz(this,e);if(t)return t[1]},has:function(e){return!!yz(this,e)},set:function(e,t){var n=yz(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=fz(this.entries,(function(t){return t[0]===e}));return~t&&gz(this.entries,t,1),!!~t}};var Iz,Mz={getConstructor:function(e,t,n,i){var r=e((function(e,r){oz(e,o),dz(e,{type:t,id:mz++,frozen:void 0}),sz(r)||uz(r,e[i],{that:e,AS_ENTRIES:n})})),o=r.prototype,a=pz(t),s=function(e,t,n){var i=a(e),r=rz(az(t),!0);return!0===r?vz(i).set(t,n):r[i.id]=n,e};return iz(o,{delete:function(e){var t=a(this);if(!cz(e))return!1;var n=rz(e);return!0===n?vz(t).delete(e):n&&lz(n,t.id)&&delete n[t.id]},has:function(e){var t=a(this);if(!cz(e))return!1;var n=rz(e);return!0===n?vz(t).has(e):n&&lz(n,t.id)}}),iz(o,n?{get:function(e){var t=a(this);if(cz(e)){var n=rz(e);return!0===n?vz(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return s(this,e,t)}}:{add:function(e){return s(this,e,!0)}}),r}},Tz=w,Cz=te,Sz=Gl,Ez=Bc.exports,kz=Ul,bz=Mz,Dz=Ie,wz=du,Az=ai.enforce,Rz=qn,Lz=!Tz.ActiveXObject&&"ActiveXObject"in Tz,Oz=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Nz=kz("WeakMap",Oz,bz);if(Rz&&Lz){Iz=bz.getConstructor(Oz,"WeakMap",!0),Ez.enable();var Pz=Nz.prototype,Uz=Cz(Pz.delete),xz=Cz(Pz.has),Gz=Cz(Pz.get),Fz=Cz(Pz.set);Sz(Pz,{delete:function(e){if(Dz(e)&&!wz(e)){var t=Az(this);return t.frozen||(t.frozen=new Iz),Uz(this,e)||t.frozen.delete(e)}return Uz(this,e)},has:function(e){if(Dz(e)&&!wz(e)){var t=Az(this);return t.frozen||(t.frozen=new Iz),xz(this,e)||t.frozen.has(e)}return xz(this,e)},get:function(e){if(Dz(e)&&!wz(e)){var t=Az(this);return t.frozen||(t.frozen=new Iz),xz(this,e)?Gz(this,e):t.frozen.get(e)}return Gz(this,e)},set:function(e,t){if(Dz(e)&&!wz(e)){var n=Az(this);n.frozen||(n.frozen=new Iz),xz(this,e)?Fz(this,e,t):n.frozen.set(e,t)}else Fz(this,e,t);return this}})}var Vz=Er,qz=HI,Bz=R,Hz=Se,jz=ve,Kz=Gy,zz=AT,Wz=Ci,Yz=qz&&qz.prototype;if(Vz({target:"Promise",proto:!0,real:!0,forced:!!qz&&Bz((function(){Yz.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=Kz(this,Hz("Promise")),n=jz(e);return this.then(n?function(n){return zz(t,e()).then((function(){return n}))}:e,n?function(n){return zz(t,e()).then((function(){throw n}))}:e)}}),jz(qz)){var $z=Hz("Promise").prototype.finally;Yz.finally!==$z&&Wz(Yz,"finally",$z,{unsafe:!0})}var Jz,Xz,Zz,Qz,eW,tW=new WeakMap;function nW(){return function(e,n,i){var r=i.value,o=function e(n){var i=n.fn,r=n.args,o=n.context,a=n.resolve,s=n.reject;i.apply(o,r).then(a,s).finally((function(){var n=tW.get(o);n&&(n.shift(),n[0]&&e(t({},n[0])))}))};return i.value=function(){for(var e=this,t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return new Promise((function(t,a){if(tW.has(e)){var s=tW.get(e),c=s.length;s.push({fn:r,args:i,context:e,resolve:t,reject:a,name:n}),0===c&&o({fn:r,args:i,context:e,resolve:t,reject:a})}else tW.set(e,[{fn:r,args:i,context:e,resolve:t,reject:a,name:n}]),o({fn:r,args:i,context:e,resolve:t,reject:a})}))},i}}var iW=(Jz=nW(),Xz=LK({retries:1,timeout:0,onRetrying:function(e){this.log_.warn("connection timeout, retrying [".concat(e,"]"))},onError:function(e,t,n){e.message.includes("timeout")?t():n(e)}}),Zz=nW(),Qz=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;return function(t,n,i){var r=i.value;return i.value=function(){for(var t=this,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return new Promise((function(i,a){var s=setTimeout((function(){return a(new Error("".concat(n," timeout")))}),e);r.apply(t,o).then(i,a).finally((function(){clearTimeout(s)}))}))},i}}(),eW=function(e){l(m,e);var i,r,s,u,p,h,f,g=v(m);function m(e){var t;return a(this,m),(t=g.call(this,e)).remoteStreams_=new Map,t.autoSubscribe=e.autoSubscribe,t.trackState_={audio:e.trackState.audio,video:e.trackState.video,auxiliary:e.trackState.auxiliary,smallVideo:e.trackState.smallVideo},t.ssrc_={audio:0,video:0,auxiliary:0},t.subscribeState_={audio:e.autoSubscribe,video:e.autoSubscribe,auxiliary:e.autoSubscribe,smallVideo:!1},t.isSDPExchanging_=!1,t.installEvents(),t}return c(m,[{key:"isMainStreamSubscribed",get:function(){return(this.subscribeState_.audio||this.subscribeState_.video||this.subscribeState_.smallVideo)&&(this.trackState_.audio||this.trackState_.video||this.trackState_.smallVideo)}},{key:"isAuxStreamSubscribed",get:function(){return this.subscribeState_.auxiliary&&this.trackState_.auxiliary}},{key:"isSmallStreamSubscribed",get:function(){return this.subscribeState_.smallVideo&&this.trackState_.smallVideo}},{key:"isBigStreamSubscribed",get:function(){return this.subscribeState_.video&&this.trackState_.video}},{key:"isStreamUnpublished",value:function(e){return e.getType()===rC?!this.trackState_.audio&&!this.trackState_.video:!this.trackState_.auxiliary}},{key:"initialize",value:function(){y(d(m.prototype),"initialize",this).call(this),this.peerConnection_.ontrack=this.onTrack.bind(this)}},{key:"close",value:function(){var e,t,n,i=this;y(d(m.prototype),"close",this).call(this),this.trackState_.audio=!1,this.trackState_.video=!1,this.trackState_.smallVideo=!1,this.trackState_.auxiliary=!1,this.emitConnectionStateChangedEvent(jC),e=this,t=function(e){e.fn;var t=e.args,n=e.resolve,r=e.reject,o=e.name;if("subscribe"===o){if(!i.client_.getIsJoined())return r(new _L({code:vL.API_CALL_ABORTED,message:ow({key:Ob,data:{message:"leave room",stream:t[0]}})}));if(i.isStreamUnpublished(t[0]))return r(new _L({code:vL.API_CALL_ABORTED,message:ow({key:Ob,data:{message:"remote user ".concat(i.userId_," unpublished stream"),stream:t[0]}})}))}else if("unsubscribe"===o)return n();n()},null===(n=tW.get(e))||void 0===n||n.forEach(t),tW.delete(e),this.remoteStreams_.forEach((function(e){var t=e;t.setConnection(null),t.uninstallEvents(),t.getIsStreamAddedEventEmitted()&&i.emitter_.emit(PN.STREAM_REMOVED,{stream:t})})),this.remoteStreams_.clear(),this.uninstallEvents()}},{key:"installEvents",value:function(){var e=this;Gw.on(aA,this.onRemoteStreamUpdate,this),this.emitter_.on(PN.ERROR,(function(t){t.getCode()===vL.ICE_TRANSPORT_ERROR&&(e.isFirstConnection_&&(e.isFirstConnection_=!1,sO.logFailedEvent({userId:e.client_.getUserId(),eventType:fS,error:t})),e.isReconnecting_||e.startReconnection())})),this.emitter_.on(PN.CONNECTION_STATE_CHANGED,(function(t){t.state===WC&&e.isFirstConnection_&&(e.isFirstConnection_=!1,sO.logSuccessEvent({userId:e.client_.getUserId(),eventType:fS}),e.addEventInternal(HL,"downlink-connection is connected"))}))}},{key:"uninstallEvents",value:function(){Gw.removeListener(aA,this.onRemoteStreamUpdate,this)}},{key:"onRemoteStreamUpdate",value:function(e){if(this.hitTest(e.tinyId)&&e.client===this.client_){this.updateTrackState(e.action,e.kind);var t=e.kind===BT?FC:GC,n=this.remoteStreams_.get(t);if(!n)return;e.action===VS.ADD?this.handleRemoteAddTrack(e.kind,n):this.handleRemoteRemoveTrack(e.kind,n)}}},{key:"handleRemoteAddTrack",value:function(e,t){this.log_.info("remote add ".concat(e," track")),e===xT?t.updateAudioPlayingState(this.subscribeState_.audio):t.updateVideoPlayingState(e===BT?this.subscribeState_.auxiliary:this.subscribeState_.video||this.subscribeState_.smallVideo),t.getIsStreamAddedEventEmitted()?this.emitter_.emit(PN.STREAM_UPDATED,{stream:t}):(this.emitter_.emit(PN.STREAM_ADDED,{stream:t}),this.currentState_===WC&&t.emitConnectionStateChanged({prevState:jC,state:WC}))}},{key:"handleRemoteRemoveTrack",value:function(e,t){t.getIsStreamAddedEventEmitted()&&(this.log_.info("remote remove ".concat(e," track")),e===BT||!this.trackState_.audio&&!this.trackState_.video?(this.log_.info("remote stream ".concat(t.getType()," removed")),this.currentState_===WC&&t.emitConnectionStateChanged({prevState:WC,state:jC}),this.emitter_.emit(PN.STREAM_REMOVED,{stream:t})):(e===xT?t.updateAudioPlayingState(!1):(e!==jT||this.isSmallStreamSubscribed)&&t.updateVideoPlayingState(!1),this.emitter_.emit(PN.STREAM_UPDATED,{stream:t})))}},{key:"updateTrackState",value:function(e,t){var n=e===VS.ADD;switch(t){case xT:this.trackState_.audio=n;break;case GT:this.trackState_.video=n;break;case BT:this.trackState_.auxiliary=n;break;case jT:this.trackState_.smallVideo=n}this.log_.info("trackState updated: ".concat(JSON.stringify(this.trackState_)))}},{key:"onTrack",value:function(e){var t,n,i,r=e.streams[0],o=e.track;if(this.log_.info("ontrack() kind: ".concat(o.kind," id: ").concat(o.id," streamId: ").concat(r.id)),this.sdpSemantics_===AS){var a=(t=this.peerConnection_.remoteDescription.sdp,n=fO.parse(t),i={audio:[],video:[]},n.media.forEach((function(e){if(e.ssrcs){var t=e.ssrcs[0].id>>16&255;if(e.type===xT)i.audio.push(GC);else if(e.type==GT){var n=t===VC?GC:FC;i.video.push(n)}}})),i);if(o.kind===xT){if(0===a.audio.length||r.id!==GC)return void this.log_.debug("skip this invalid audio track")}else if(-1===a.video.indexOf(r.id))return void this.log_.debug("skip this invalid video track: ".concat(o.id,"  msid: ").concat(r.id))}sO.logEvent({eventType:"ontrack",kind:o.kind});var s=!1,c=this.remoteStreams_.get(r.id),u=r.id===GC?qC:BC;if(fw(c)&&((c=new kK({type:u,userId:this.userId_,client:this.client_})).setConnection(this),this.remoteStreams_.set(r.id,c),s=!0),c.setMediaStream(r),o.kind===xT?c.updateAudioPlayingState(this.subscribeState_.audio):u===qC?c.updateVideoPlayingState(this.subscribeState_.video||this.subscribeState_.smallVideo):c.updateVideoPlayingState(this.subscribeState_.auxiliary),(u!==BC||this.trackState_.auxiliary)&&(u!==qC||this.trackState_.audio||this.trackState_.video)){var l=this.client_.getSubscriptionManager();l&&l.hasAutoRecoveryFlag(this.userId_,u)||(s?this.emitter_.emit(PN.STREAM_ADDED,{stream:c}):this.emitter_.emit(PN.STREAM_UPDATED,{stream:c}))}}},{key:"addRRTRLine",value:function(e){var t=e.split("\r\n"),n=new Map;t.forEach((function(e,i){/^a=rtcp-fb:/.test(e)&&t[i+1]&&!/^a=rtcp-fb:/.test(t[i+1])&&n.set(i+1,e.match(/^a=rtcp-fb:\d+/)[0]+" rrtr")}));for(var i=M(n),r=0;r<i.length;r++){var o=I(i[r],2),a=o[0],s=o[1];t.splice(a+r,0,s)}return t.join("\r\n")}},{key:"addSPSDescription",value:function(e){var t=kO(e);return t.media.forEach((function(e){e.type===GT&&e.fmtp.forEach((function(e){e.config+=";sps-pps-idr-in-keyframe=1"}))})),bO(t)}},{key:"removeSDESDescription",value:function(e){var t=["urn:ietf:params:rtp-hdrext:sdes:mid","urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id","urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id"],n=kO(e);return n.media.forEach((function(e){e.ext=e.ext.filter((function(e){return!t.includes(e.uri)}))})),bO(n)}},{key:"isSubscriptionStateNotChanged",value:function(e,t){return e.getType()===qC?(null==t?void 0:t.audio)===this.subscribeState_.audio&&(null==t?void 0:t.video)===this.subscribeState_.video&&this.isSubscribeSmall(t):e.getType()===BC?!fw(t.video)&&this.subscribeState_.auxiliary===t.video:void 0}},{key:"isSubscribeSmall",value:function(e){return fw(e.smallVideo)&&!this.subscribeState_.smallVideo}},{key:"subscribe",value:(f=o(n().mark((function e(t,i){var r,o,a,s,c,u;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=i.emitEvent,s=void 0===a||a,c=t.getType(),(null===(r=this.peerConnection_)||void 0===r?void 0:r.connectionState)!==YC&&(null===(o=this.peerConnection_)||void 0===o?void 0:o.connectionState)!==$C){e.next=6;break}return e.next=6,this.waitForPeerConnectionConnected();case 6:if(!this.isSubscriptionStateNotChanged(t,i)){e.next=13;break}if(this.peerConnection_){e.next=11;break}return this.initialize(),e.next=11,this.connect();case 11:return s&&fw(i.smallVideo)&&this.emitter_.emit(PN.STREAM_SUBSCRIBED,{stream:t,result:!0}),e.abrupt("return",t);case 13:if(c===rC?(fw(i.audio)||(this.subscribeState_.audio=i.audio),fw(i.video)||(this.subscribeState_.video=i.video),this.subscribeState_.smallVideo=(null==i?void 0:i.smallVideo)||!1,this.addEventInternal(this.subscribeState_.audio?bL:wL,this.subscribeState_.audio?"subscribe audio":"unsubscribe audio"),this.addEventInternal(this.subscribeState_.video?bL:wL,this.subscribeState_.video?"subscribe video":"unsubscribe video"),this.addEventInternal(this.subscribeState_.smallVideo?QL:eO,this.subscribeState_.smallVideo?"subscribe smallVideo":"unsubscribe smallVideo")):fw(i.video)||(this.subscribeState_.auxiliary=i.video),this.log_.info("subscribe ".concat(c," stream with options ").concat(JSON.stringify(i)," current state: ").concat(JSON.stringify(this.subscribeState_))),!this.peerConnection_&&!this.isSDPExchanging_){e.next=23;break}return u=wS,this.isMainStreamSubscribed||this.isAuxStreamSubscribed||(u=DS),e.next=20,this.sendSubscription(u);case 20:c===rC?(t.updateAudioPlayingState(this.subscribeState_.audio),t.updateVideoPlayingState(this.subscribeState_.video||this.subscribeState_.smallVideo)):t.updateVideoPlayingState(this.subscribeState_.auxiliary),e.next=26;break;case 23:return this.initialize(),e.next=26,this.connect();case 26:return s&&this.emitter_.emit(PN.STREAM_SUBSCRIBED,{stream:t,result:!0}),e.abrupt("return",t);case 30:if(e.prev=30,e.t0=e.catch(0),!this.client_.getIsJoined()||!this.isStreamUnpublished(t)){e.next=35;break}throw this.log_.warn("".concat(e.t0.message," ").concat(JSON.stringify(this.trackState_))),new _L({code:vL.REMOTE_STREAM_NOT_EXIST,message:"remote user ".concat(this.userId_," unpublished stream")});case 35:throw e.t0;case 36:case"end":return e.stop()}}),e,this,[[0,30]])}))),function(e,t){return f.apply(this,arguments)})},{key:"unsubscribe",value:(h=o(n().mark((function e(t){var i,r,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=t.getType())!==rC){e.next=10;break}if(this.isMainStreamSubscribed){e.next=5;break}return this.log_.info("main stream already unsubscribed"),e.abrupt("return",t);case 5:this.subscribeState_.audio=!1,this.subscribeState_.video=!1,this.subscribeState_.smallVideo=!1,e.next=14;break;case 10:if(this.isAuxStreamSubscribed){e.next=13;break}return this.log_.info("auxiliary stream already unsubscribed"),e.abrupt("return",t);case 13:this.subscribeState_.auxiliary=!1;case 14:return r=DS,(i===qC&&this.isAuxStreamSubscribed||i===BC&&this.isMainStreamSubscribed)&&(r=wS),this.log_.info("unsubscribe ".concat(i," stream with ").concat(JSON.stringify(this.subscribeState_))),e.next=19,this.sendSubscription(r);case 19:return t.updateVideoPlayingState(!1),t.updateAudioPlayingState(!1),r===DS&&((o=t.getMediaStream())&&o.getTracks().forEach((function(e){return o.removeTrack(e)})),this.closePeerConnection(),this.emitConnectionStateChangedEvent(jC)),this.addEventInternal(wL,"unsubscribe audio"),this.addEventInternal(DL,"unsubscribe video"),e.abrupt("return",t);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"sendSubscription",value:function(e){var t=this,n={srcTinyId:this.tinyId_,srcUserId:this.userId_},i=aL,r=JR.UNSUBSCRIBE_RESULT;return e===wS&&(n={audio:this.subscribeState_.audio,bigVideo:this.subscribeState_.video,auxVideo:this.subscribeState_.auxiliary,smallVideo:this.subscribeState_.smallVideo,srcTinyId:this.tinyId_},i=sL,r=JR.SUBSCRIBE_CHANGE_RESULT),this.signalChannel_.sendWaitForResponse({command:i,data:n,responseCommand:r,timeout:1e4}).then((function(n){var i=n.data;if(0!==i.code){var r=new _L({code:i.code,message:ow({key:VE,data:{type:e,message:i.message}})});throw t.log_.error(r),r}}))}},{key:"connect",value:(p=o(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.exchangeSDP();case 3:return e.next=5,this.waitForPeerConnectionConnected();case 5:e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(0),this.closePeerConnection(!0),e.t0;case 11:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return p.apply(this,arguments)})},{key:"exchangeSDP",value:(u=o(n().mark((function e(){var t,i,r,o,a,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.isSDPExchanging_=!0,e.next=4,this.createOffer();case 4:return this.log_.info("createOffer success, sending offer to remote server"),t=this.peerConnection_.localDescription,i=t.type,r=t.sdp,o={type:i,sdp:r,srcUserId:this.userId_,srcTinyId:this.tinyId_,audio:this.subscribeState_.audio,bigVideo:this.subscribeState_.video,auxVideo:this.subscribeState_.auxiliary,smallVideo:this.subscribeState_.smallVideo},Gw.emit(kA,{client:this.client_,connection:this,userId:this.userId_,tinyId:this.tinyId_,role:NC,subscribeState:this.subscribeState_,trackState:this.trackState_}),e.next=10,this.signalChannel_.sendWaitForResponse({command:oL,commandDesc:"exchange sdp",data:o,responseCommand:JR.SUBSCRIBE_RESULT,timeout:1e4});case 10:if(a=e.sent,this.peerConnection_){e.next=15;break}throw s=new _L({code:vL.INVALID_OPERATION,message:ow({key:Cb})}),this.log_.warn(s),s;case 15:return e.next=17,this.onSubscribeResult(a);case 17:this.isSDPExchanging_=!1,e.next=24;break;case 20:throw e.prev=20,e.t0=e.catch(0),this.isSDPExchanging_=!1,e.t0;case 24:case"end":return e.stop()}}),e,this,[[0,20]])}))),function(){return u.apply(this,arguments)})},{key:"createOffer",value:(s=o(n().mark((function e(){var t,i;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={voiceActivityDetection:!1},yN()&&this.sdpSemantics_===AS?(this.peerConnection_.addTransceiver(xT,{direction:"recvonly"}),this.peerConnection_.addTransceiver(GT,{direction:"recvonly"}),this.peerConnection_.addTransceiver(GT,{direction:"recvonly"})):(t.offerToReceiveAudio=!0,t.offerToReceiveVideo=!0),e.next=4,this.peerConnection_.createOffer(t);case 4:return i=e.sent,e.next=7,lN();case 7:return e.sent.isH264DecodeSupported||(this.log_.warn("remove h264 desc from sdp"),i.sdp=wO(i.sdp)),i.sdp=this.addRRTRLine(i.sdp),i.sdp=this.addSPSDescription(i.sdp),i.sdp=DO(i.sdp),this.sdpSemantics_===AS&&(i.sdp=this.removeSDESDescription(i.sdp)),e.next=16,this.peerConnection_.setLocalDescription(i);case 16:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"onSubscribeResult",value:(r=o(n().mark((function e(i){var r,o,a,s,c,u,l,d=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i&&i.data||{},o=r.code,a=r.message,s=void 0===a?"":a,c=i&&i.data&&i.data.data||{},u=c.type,l=c.sdp,77393!==o){e.next=5;break}throw this.log_.error(Pb.NOT_SUPPORTED_H264DECODE),new _L({code:vL.NOT_SUPPORTED_H264,message:ow({key:hb})});case 5:if(e.prev=5,0===o){e.next=8;break}throw new _L({code:o,message:ow({key:HE,data:{errMsg:s}})});case 8:return this.log_.debug("accept remote answer: "+l),e.next=11,this.peerConnection_.setRemoteDescription({type:u,sdp:l});case 11:this.sei_&&(this.sei_.handleEncodedStreams(),this.sei_.onSEIMessage=function(e){d.emitter_.emit(PN.SEI_MESSAGE,t(t({},e),{},{userId:d.userId_}))}),this.updateSSRC(l),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(5),this.log_.error(e.t0),e.t0;case 19:case"end":return e.stop()}}),e,this,[[5,15]])}))),function(e){return r.apply(this,arguments)})},{key:"updateSSRC",value:function(e){var t=this;try{kO(e).media.forEach((function(e){if(e.type===xT){var n=e.ssrcs.find((function(e){return e.value.includes(GC)}));n&&(t.ssrc_.audio=n.id)}else{var i=e.ssrcs.find((function(e){return e.value.includes(GC)})),r=e.ssrcs.find((function(e){return e.value.includes(FC)}));i&&(t.ssrc_.video=i.id),r&&(t.ssrc_.auxiliary=r.id)}}))}catch(oY){}}},{key:"setRemoteStream",value:function(e,t){this.remoteStreams_.set(e,t)}},{key:"getSubscribeState",value:function(){return this.subscribeState_}},{key:"getTrackState",value:function(){return this.trackState_}},{key:"getSSRC",value:function(){return this.ssrc_}},{key:"getMainStream",value:function(){return this.remoteStreams_.get(GC)}},{key:"getAuxStream",value:function(){return this.remoteStreams_.get(FC)}},{key:"getMainStreamVideoTrackId",value:function(){var e=this.getMainStream();if(e){var t=e.getVideoTrack();if(t)return t.id}return""}},{key:"getAuxStreamVideoTrackId",value:function(){var e=this.getAuxStream();if(e){var t=e.getVideoTrack();if(t)return t.id}return""}},{key:"reconnect",value:(i=o(n().mark((function e(){var t,i,r=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===this.reconnectionTimer_){e.next=3;break}return this.log_.warn("reconnect() downlink is reconnecting, ignore current reconnection"),e.abrupt("return");case 3:if(!(this.reconnectionCount_>=30)){e.next=12;break}return this.log_.warn("SDK has tried reconnect downlink [".concat(this.userId_,"] for ").concat(30," times, but all failed, please check your network")),this.stopReconnection(),t=new _L({code:vL.DOWNLINK_RECONNECTION_FAILED,message:ow({key:BE})}),sO.logFailedEvent({userId:this.client_.getUserId(),eventType:gS,error:t}),this.addEventInternal(ZL,"downlink-connection reconnect fail"),this.emitConnectionStateChangedEvent(jC),this.emitter_.emit(PN.ERROR,t),e.abrupt("return");case 12:if(this.signalChannel_.getCurrentState()===WR){e.next=16;break}return this.log_.warn("reconnect() signal channel is not connected, suspend reconnection until signal is connected"),this.signalChannel_.once(BR,this.reconnect,this),e.abrupt("return");case 16:if(this.reconnectionCount_++,this.log_.warn("reconnect() try to reconnect downlink [".concat(this.reconnectionCount_,"/").concat(30,"]")),i=pw(this.reconnectionCount_),this.reconnectionTimer_=setTimeout((function(){r.log_.warn("reconnect() downlink [".concat(r.userId_,"] reconnect timeout(").concat(i/1e3,"s), try again")),r.clearReconnectionTimer(),r.reconnect()}),i),!(this.isSDPExchanging_||this.peerConnection_&&this.peerConnection_.connectionState===$C)){e.next=22;break}return e.abrupt("return");case 22:return e.prev=22,this.closePeerConnection(),this.initialize(),e.next=27,this.connect();case 27:this.stopReconnection(),this.log_.warn("reconnect() downlink reconnect successfully"),sO.logSuccessEvent({userId:this.client_.getUserId(),eventType:gS}),this.addEventInternal(XL,"downlink-connection reconnect success"),this.recoverSubscription(),e.next=36;break;case 34:e.prev=34,e.t0=e.catch(22);case 36:case"end":return e.stop()}}),e,this,[[22,34]])}))),function(){return i.apply(this,arguments)})},{key:"recoverSubscription",value:function(){var e=this,t=this.client_.getSubscriptionManager();t&&M(this.remoteStreams_.values()).forEach((function(n){t.hasAutoRecoveryFlag(e.userId_,n.getType())&&t.recover(n)}))}},{key:"getIsReconnecting",value:function(){return this.isReconnecting_}},{key:"getSubscribedMainStream",value:function(){var e=null;return this.isMainStreamSubscribed&&(e=this.remoteStreams_.get(GC)),e}},{key:"clearReconnectionTimer",value:function(){-1!==this.reconnectionTimer_&&(clearTimeout(this.reconnectionTimer_),this.reconnectionTimer_=-1)}},{key:"startReconnection",value:function(){var e=this.client_.getSubscriptionManager();if(e){var t,n=E(this.remoteStreams_.values());try{for(n.s();!(t=n.n()).done;){var i=t.value,r=i.getType();(r===qC&&(this.trackState_.audio||this.trackState_.video)||r===BC&&this.trackState_.auxiliary)&&e.setAutoRecoveryFlag(this.userId_,i.getType())}}catch(o){n.e(o)}finally{n.f()}}y(d(m.prototype),"startReconnection",this).call(this)}},{key:"getCurrentState",value:function(){return this.currentState_}},{key:"hasMainStream",value:function(){return this.trackState_.video||this.trackState_.audio||this.trackState_.smallVideo}},{key:"hasAuxStream",value:function(){return this.trackState_.auxiliary}}]),m}(dK),k(eW.prototype,"subscribe",[Jz,Xz],Object.getOwnPropertyDescriptor(eW.prototype,"subscribe"),eW.prototype),k(eW.prototype,"unsubscribe",[Zz],Object.getOwnPropertyDescriptor(eW.prototype,"unsubscribe"),eW.prototype),k(eW.prototype,"exchangeSDP",[Qz],Object.getOwnPropertyDescriptor(eW.prototype,"exchangeSDP"),eW.prototype),eW),rW=function(){function e(){a(this,e),this.startTime=0,this.endTime=0,this.start()}return c(e,[{key:"start",value:function(){0===this.startTime&&(this.startTime=Cw())}},{key:"stop",value:function(){0===this.endTime&&(this.endTime=Cw())}},{key:"getDuration",value:function(){return 0===this.endTime?Cw()-this.startTime:this.endTime-this.startTime}}]),e}(),oW=function(){function e(t){a(this,e),this.client_=t.client,this.intervalId_=-1,this.statsCalculator_=t.stats,this.prevStats_=null,this.renderFreezeMap_=new Map,this.remoteStreamMap_=new Map,this.dataFreezeMap_=new Map,this.monitorFreezeData_=new Map}var t,i,r;return c(e,[{key:"installEvents",value:function(){Gw.on(MA,this.handlePlayVideoStart,this),Gw.on(vA,this.onVideoTrackMuted,this),Gw.on(_A,this.onVideoTrackUnmuted,this),Gw.on(pA,this.handleStreamStopped,this),Gw.on(lA,this.handleStreamStopped,this),Gw.on(rA,this.handleVideoPlaying,this)}},{key:"uninstallEvents",value:function(){Gw.off(MA,this.handlePlayVideoStart,this),Gw.off(vA,this.onVideoTrackMuted,this),Gw.off(_A,this.onVideoTrackUnmuted,this),Gw.off(pA,this.handleStreamStopped,this),Gw.off(lA,this.handleStreamStopped,this),Gw.off(rA,this.handleVideoPlaying,this)}},{key:"start",value:function(){var e=this;-1===this.intervalId_&&(this.installEvents(),this.intervalId_=QO.run(o(n().mark((function t(){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.detectFPS();case 3:t.next=7;break;case 5:t.prev=5,t.t0=t.catch(0);case 7:case"end":return t.stop()}}),t,null,[[0,5]])}))),{delay:1e3}))}},{key:"stop",value:function(){-1!==this.intervalId_&&(this.uninstallEvents(),QO.clearTask(this.intervalId_),this.intervalId_=-1,this.renderFreezeMap_.clear(),this.dataFreezeMap_.clear(),this.remoteStreamMap_.clear())}},{key:"onVideoTrackMuted",value:function(e){var t=e.stream;if(t.getClient()===this.client_&&t.isRemote()){var n=t.userId_,i=t.type_,r="".concat(n,"_").concat(i),o=this.dataFreezeMap_.get(r),a=new rW;o?o.durationItemList.push(a):this.dataFreezeMap_.set(r,{userId:n,type:i,durationItemList:[a],isFreezing:function(){var e=this.durationItemList[this.durationItemList.length-1];return e&&0===e.endTime}})}}},{key:"onVideoTrackUnmuted",value:function(e){var t=e.stream;if(t.getClient()===this.client_&&t.isRemote()){var n=t.userId_,i=t.type_,r="".concat(n,"_").concat(i);this.stopDataFreeze({key:r,userId:n,type:i})}}},{key:"handleStreamStopped",value:function(e){var t=e.client,n=e.stream;if(t===this.client_){var i=n.getUserId(),r=n.getType(),o="".concat(i,"_").concat(r);this.stopDataFreeze({key:o,userId:i,type:r})}}},{key:"stopDataFreeze",value:function(e){var t=e.key,n=e.userId,i=e.type,r=this.dataFreezeMap_.get(t);if(r&&r.isFreezing()){var o=r.durationItemList[r.durationItemList.length-1];o.stop();var a=o.getDuration();a>500?(sO.logEvent({eventType:"videoFrozenCount",delta:a}),this.monitorFreezeData_.set(t,{userId:n,type:i,duration:a})):r.durationItemList.pop()}}},{key:"getTotalDuration",value:function(e){return e.reduce((function(e,t){var n=t.getDuration();return e+Math.min(n,5e3)}),0)}},{key:"getStats",value:(r=o(n().mark((function e(){var t,i,r,o,a,s,c,u,l,d,p;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.client_.getConnections(),i={},r=E(t),e.prev=3,r.s();case 5:if((o=r.n()).done){e.next=20;break}if(a=I(o.value,2),s=a[0],(c=a[1]).getPeerConnection()){e.next=9;break}return e.abrupt("continue",18);case 9:return u=c.getSubscribeState(),l=c.getTrackState(),e.next=13,this.statsCalculator_.getReceiverStats(c);case 13:d=e.sent,(p={userId:d.userId,tinyId:s,hasVideo:l.video&&u.video,hasAuxiliary:l.auxiliary&&u.auxiliary,video:{framesDecoded:0},auxiliary:{framesDecoded:0}}).hasVideo&&(p.video.framesDecoded=d.video.framesDecoded),p.hasAuxiliary&&(p.auxiliary.framesDecoded=d.auxiliary.framesDecoded),i[d.userId]=p;case 18:e.next=5;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(3),r.e(e.t0);case 25:return e.prev=25,r.f(),e.finish(25);case 28:return e.abrupt("return",i);case 29:case"end":return e.stop()}}),e,this,[[3,22,25,28]])}))),function(){return r.apply(this,arguments)})},{key:"detectFPS",value:(i=o(n().mark((function e(){var t,i,r,o,a,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStats();case 2:if(t=e.sent,this.prevStats_){e.next=6;break}return this.prevStats_=t,e.abrupt("return");case 6:e.t0=n().keys(t);case 7:if((e.t1=e.t0()).done){e.next=17;break}if(i=e.t1.value,this.prevStats_[i]){e.next=11;break}return e.abrupt("continue",7);case 11:r=t[i].tinyId,o=this.client_.getMutedStates(),t[i].hasVideo&&this.prevStats_[i].hasVideo&&o.has(r)&&!o.get(r).videoMuted&&(a=t[i].video.framesDecoded-this.prevStats_[i].video.framesDecoded,this.handleRenderFreeze({userId:i,type:qC,fps:a})),t[i].hasAuxiliary&&this.prevStats_[i].hasAuxiliary&&(s=t[i].auxiliary.framesDecoded-this.prevStats_[i].auxiliary.framesDecoded,this.handleRenderFreeze({userId:i,type:BC,fps:s})),e.next=7;break;case 17:this.prevStats_=t;case 18:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"handleRenderFreeze",value:(t=o(n().mark((function e(t){var i,r,o,a,s,c,u,l;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=t.userId,r=t.fps,o=t.type,a="".concat(i,"_").concat(o),s=this.renderFreezeMap_.get(a),r<=2?(c=Cw(),s&&!s.isFreeze&&(s.freezeTimeline.push({startTime:c,endTime:void 0}),s.isFreeze=!0),s||this.renderFreezeMap_.set(a,{userId:i,type:o,isFreeze:!0,freezeTimeline:[{startTime:c,endTime:void 0}],renderFreezeTotal:0})):s&&s.isFreeze&&(s.isFreeze=!1,(u=s.freezeTimeline.pop()).endTime=Cw(),l=u.endTime-u.startTime,s.freezeTimeline.push(u),s.renderFreezeTotal+=Math.min(5e3,l));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"handlePlayVideoStart",value:function(e){var t=e.stream;if(t.getClient()===this.client_&&t.isRemote()&&t.hasVideo()){var n="".concat(t.getUserId(),"_").concat(t.getType());this.remoteStreamMap_.has(n)||this.remoteStreamMap_.set(n,{isPlayingFired:!1})}}},{key:"handleVideoPlaying",value:function(e){var t=e.stream;if(t.isRemote()&&t.getClient()===this.client_){var n="".concat(t.getUserId(),"_").concat(t.getType());this.remoteStreamMap_.has(n)&&(this.remoteStreamMap_.get(n).isPlayingFired=!0)}}},{key:"getDataFreezeDuration",value:function(e){var t={dataFreeze:0,count:0},n=this.dataFreezeMap_.get(e);if(n){if(n.isFreezing()){var i=n.durationItemList[n.durationItemList.length-1];i.stop(),i.getDuration()<500&&n.durationItemList.pop()}t.dataFreeze=this.getTotalDuration(n.durationItemList),t.count=n.durationItemList.length}return t}},{key:"getRenderFreezeDuration",value:function(e){var t=this.renderFreezeMap_.get(e),n=0,i=0;if(t)if(t.isFreeze){var r=Cw()-t.freezeTimeline[t.freezeTimeline.length-1].startTime;n=t.renderFreezeTotal+Math.min(r,5e3),i=t.freezeTimeline.length}else n=t.renderFreezeTotal;return{renderFreeze:n,count:i}}},{key:"getMonitorFreeze",value:function(){return this.monitorFreezeData_}},{key:"isBlackStream",value:function(e){return!!this.remoteStreamMap_.has(e)&&!this.remoteStreamMap_.get(e).isPlayingFired}},{key:"resetMonitor",value:function(){this.monitorFreezeData_.clear()}}]),e}(),aW=c((function e(t){a(this,e),this.userId=t.userId,this.tinyId=t.tinyId,this.role=t.role===NC?UC:xC})),sW={exports:{}};!function(e){!function(t){function n(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,i,r,o,a){return n((s=n(n(t,e),n(r,a)))<<(c=o)|s>>>32-c,i);var s,c}function r(e,t,n,r,o,a,s){return i(t&n|~t&r,e,t,o,a,s)}function o(e,t,n,r,o,a,s){return i(t&r|n&~r,e,t,o,a,s)}function a(e,t,n,r,o,a,s){return i(t^n^r,e,t,o,a,s)}function s(e,t,n,r,o,a,s){return i(n^(t|~r),e,t,o,a,s)}function c(e,t){var i,c,u,l,d;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var p=1732584193,h=-271733879,f=-1732584194,g=271733878;for(i=0;i<e.length;i+=16)c=p,u=h,l=f,d=g,p=r(p,h,f,g,e[i],7,-680876936),g=r(g,p,h,f,e[i+1],12,-389564586),f=r(f,g,p,h,e[i+2],17,606105819),h=r(h,f,g,p,e[i+3],22,-1044525330),p=r(p,h,f,g,e[i+4],7,-176418897),g=r(g,p,h,f,e[i+5],12,1200080426),f=r(f,g,p,h,e[i+6],17,-1473231341),h=r(h,f,g,p,e[i+7],22,-45705983),p=r(p,h,f,g,e[i+8],7,1770035416),g=r(g,p,h,f,e[i+9],12,-1958414417),f=r(f,g,p,h,e[i+10],17,-42063),h=r(h,f,g,p,e[i+11],22,-1990404162),p=r(p,h,f,g,e[i+12],7,1804603682),g=r(g,p,h,f,e[i+13],12,-40341101),f=r(f,g,p,h,e[i+14],17,-1502002290),p=o(p,h=r(h,f,g,p,e[i+15],22,1236535329),f,g,e[i+1],5,-165796510),g=o(g,p,h,f,e[i+6],9,-1069501632),f=o(f,g,p,h,e[i+11],14,643717713),h=o(h,f,g,p,e[i],20,-373897302),p=o(p,h,f,g,e[i+5],5,-701558691),g=o(g,p,h,f,e[i+10],9,38016083),f=o(f,g,p,h,e[i+15],14,-660478335),h=o(h,f,g,p,e[i+4],20,-405537848),p=o(p,h,f,g,e[i+9],5,568446438),g=o(g,p,h,f,e[i+14],9,-1019803690),f=o(f,g,p,h,e[i+3],14,-187363961),h=o(h,f,g,p,e[i+8],20,1163531501),p=o(p,h,f,g,e[i+13],5,-1444681467),g=o(g,p,h,f,e[i+2],9,-51403784),f=o(f,g,p,h,e[i+7],14,1735328473),p=a(p,h=o(h,f,g,p,e[i+12],20,-1926607734),f,g,e[i+5],4,-378558),g=a(g,p,h,f,e[i+8],11,-2022574463),f=a(f,g,p,h,e[i+11],16,1839030562),h=a(h,f,g,p,e[i+14],23,-35309556),p=a(p,h,f,g,e[i+1],4,-1530992060),g=a(g,p,h,f,e[i+4],11,1272893353),f=a(f,g,p,h,e[i+7],16,-155497632),h=a(h,f,g,p,e[i+10],23,-1094730640),p=a(p,h,f,g,e[i+13],4,681279174),g=a(g,p,h,f,e[i],11,-358537222),f=a(f,g,p,h,e[i+3],16,-722521979),h=a(h,f,g,p,e[i+6],23,76029189),p=a(p,h,f,g,e[i+9],4,-640364487),g=a(g,p,h,f,e[i+12],11,-421815835),f=a(f,g,p,h,e[i+15],16,530742520),p=s(p,h=a(h,f,g,p,e[i+2],23,-995338651),f,g,e[i],6,-198630844),g=s(g,p,h,f,e[i+7],10,1126891415),f=s(f,g,p,h,e[i+14],15,-1416354905),h=s(h,f,g,p,e[i+5],21,-57434055),p=s(p,h,f,g,e[i+12],6,1700485571),g=s(g,p,h,f,e[i+3],10,-1894986606),f=s(f,g,p,h,e[i+10],15,-1051523),h=s(h,f,g,p,e[i+1],21,-2054922799),p=s(p,h,f,g,e[i+8],6,1873313359),g=s(g,p,h,f,e[i+15],10,-30611744),f=s(f,g,p,h,e[i+6],15,-1560198380),h=s(h,f,g,p,e[i+13],21,1309151649),p=s(p,h,f,g,e[i+4],6,-145523070),g=s(g,p,h,f,e[i+11],10,-1120210379),f=s(f,g,p,h,e[i+2],15,718787259),h=s(h,f,g,p,e[i+9],21,-343485551),p=n(p,c),h=n(h,u),f=n(f,l),g=n(g,d);return[p,h,f,g]}function u(e){var t,n="",i=32*e.length;for(t=0;t<i;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function l(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var i=8*e.length;for(t=0;t<i;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function d(e){var t,n,i="0123456789abcdef",r="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),r+=i.charAt(t>>>4&15)+i.charAt(15&t);return r}function p(e){return unescape(encodeURIComponent(e))}function h(e){return u(c(l(t=p(e)),8*t.length));var t}function f(e,t){return function(e,t){var n,i,r=l(e),o=[],a=[];for(o[15]=a[15]=void 0,r.length>16&&(r=c(r,8*e.length)),n=0;n<16;n+=1)o[n]=909522486^r[n],a[n]=1549556828^r[n];return i=c(o.concat(l(t)),512+8*t.length),u(c(a.concat(i),640))}(p(e),p(t))}function g(e,t,n){return t?n?f(t,e):d(f(t,e)):n?h(e):d(h(e))}e.exports?e.exports=g:t.md5=g}(b)}(sW);var cW,uW,lW=sW.exports,dW=function(){function e(t){a(this,e),this.client_=t.client,this.signalChannel_=t.signalChannel,this.log_=PA.createLogger({id:"mix|"+this.client_.getUserId(),userId:t.client.getUserId(),sdkAppId:t.client.getSDKAppId()}),this.isMixing_=!1,this.config_=null,this.data_=null,this.remoteStreamMap_=new Map,this.installEvents()}var t,i,r,s;return c(e,[{key:"isPresetLayoutMode",get:function(){return this.config_&&this.config_.mode===LS.PRESET_LAYOUT}},{key:"installEvents",value:function(){Gw.on(uA,this.onStreamSubscribed,this),Gw.on(lA,this.onStreamUnsubscribed,this),this.client_.on("stream-removed",this.onStreamRemoved,this)}},{key:"uninstallEvents",value:function(){Gw.off(uA,this.onStreamSubscribed,this),Gw.off(lA,this.onStreamUnsubscribed,this),this.client_.off("stream-removed",this.onStreamRemoved,this)}},{key:"reset",value:function(){this.uninstallEvents(),this.isMixing_=!1,this.config_=null}},{key:"onStreamSubscribed",value:function(e){var t=e.client,n=e.stream;t===this.client_&&(this.remoteStreamMap_.set(n.getId(),{remoteStream:n,isUsed:!1}),this.isMixing_&&this.hasAvailablePlaceHolder()&&this.startMixTranscode(this.config_))}},{key:"onStreamUnsubscribed",value:function(e){var t=e.client,n=e.stream;t===this.client_&&this.onStreamRemoved({stream:n})}},{key:"onStreamRemoved",value:function(e){var t=e.stream;if(this.remoteStreamMap_.has(t.getId())){var n=this.remoteStreamMap_.get(t.getId()).isUsed;this.remoteStreamMap_.delete(t.getId()),this.isMixing_&&this.isPresetLayoutMode&&n&&this.startMixTranscode(this.config_)}}},{key:"startMixTranscode",value:(s=o(n().mark((function e(t){var i,r,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.resetIsUsedFlag(),this.config_=t,i=this.getInputParam(t,this.remoteStreamMap_),r=this.getOutputParam(t),o=this.getOutputSessionId({config:t,roomId:this.client_.getRoomId(),userId:this.client_.getUserId()}),!this.isMixing_||!this.data_||o===this.data_.outputSessionId){e.next=10;break}return this.log_.info("startMixTranscode() streamId changed, stop mixing before start"),e.next=10,this.doStopMixTranscode();case 10:return e.next=12,this.doStartMixTranscode({outputSessionId:o,inputParam:i,outputParam:r});case 12:e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(0),this.resetIsUsedFlag(),e.t0;case 18:case"end":return e.stop()}}),e,this,[[0,14]])}))),function(e){return s.apply(this,arguments)})},{key:"doStartMixTranscode",value:(r=o(n().mark((function e(t){var i,r,o,a,s,c,u,l;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.outputSessionId,r=t.inputParam,o=t.outputParam,a={roomId:String(this.client_.getRoomId()),mcuRequestTime:Date.now(),outputSessionId:i,inputParam:r,outputParam:o},this.data_=a,this.log_.info("startMixTranscode: ".concat(JSON.stringify(a))),this.isMixing_=!0,e.prev=5,e.next=8,this.signalChannel_.sendWaitForResponse({command:pL,data:a,timeout:5e3,responseCommand:JR.START_MIX_TRANSCODE_RES,commandDesc:"startMixTranscode"});case 8:if(s=e.sent,c=s.data,u=c.code,l=c.message,0===u){e.next=15;break}throw-102083===u&&(l="Please enable relayed-push in ".concat(cE," and try later, refer to ").concat(lE,"tutorial-26-advanced-publish-cdn-stream.html")),this.log_.error("startMixTranscode failed, errCode: ".concat(u," errMsg: ").concat(l)),this.isMixing_=!1,new _L({code:vL.START_MIX_TRANSCODE_FAILED,message:ow({key:zk,data:{message:l},link:{className:"Client",fnName:"startMixTranscode"}})});case 15:e.next=21;break;case 17:throw e.prev=17,e.t0=e.catch(5),this.isMixing_=!1,e.t0;case 21:case"end":return e.stop()}}),e,this,[[5,17]])}))),function(e){return r.apply(this,arguments)})},{key:"reStartMixTranscode",value:function(){this.isMixing_&&this.startMixTranscode(this.config_)}},{key:"stopMixTranscode",value:(i=o(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isMixing_){e.next=2;break}throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Yk})});case 2:return e.next=4,this.doStopMixTranscode();case 4:this.resetIsUsedFlag();case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"doStopMixTranscode",value:(t=o(n().mark((function e(){var t,i,r,o,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={mcuRequestTime:Date.now(),outputSessionId:this.data_.outputSessionId,streamType:this.data_.outputParam.streamType},this.log_.info("stopMixTranscode: ".concat(JSON.stringify(t))),e.next=4,this.signalChannel_.sendWaitForResponse({command:hL,data:t,timeout:5e3,responseCommand:JR.STOP_MIX_TRANSCODE_RES,commandDesc:"stopMixTranscode"});case 4:if(i=e.sent,r=i.data,o=r.code,a=r.message,0!==o){e.next=10;break}this.isMixing_=!1,e.next=12;break;case 10:throw this.log_.error("stopMixTranscode failed, errCode: ".concat(o," errMsg: ").concat(a)),new _L({code:vL.STOP_MIX_TRANSCODE_FAILED,message:ow({key:Wk,data:{message:a},link:{className:"Client",fnName:"stopMixTranscode"}})});case 12:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getOutputSessionId",value:function(e){var t=e.config,n=e.userId,i=e.roomId;return gw(t.streamId)&&t.streamId.length>0?t.streamId:lW("".concat(i,"_").concat(n,"_main"))}},{key:"getInputParam",value:function(e,t){var n=this,i=e.mixUsers.map((function(e){return{userId:e.userId,roomId:String(e.roomId||n.client_.getRoomId()),width:e.width||0,height:e.height||0,locationX:e.locationX||0,locationY:e.locationY||0,zOrder:e.zOrder,streamType:fw(e.streamType)||e.streamType!==BC?0:1,inputType:e.pureAudio?NS.IT_PURE_AUDIO:NS.IT_AUDIO_VIDEO,renderMode:e.renderMode||0}}));return e.mode===LS.PRESET_LAYOUT&&(i.forEach((function(e){if(e.userId===OS.REMOTE){var n=M(t.values()).find((function(e){return!e.isUsed}));n&&(e.userId=n.remoteStream.getUserId(),e.streamType=n.remoteStream.getType()===BC?1:0,n.isUsed=!0)}})),i=i.filter((function(e){return e.userId!==OS.REMOTE}))),i}},{key:"getOutputParam",value:function(e){var t=e.streamId||"";return{streamId:t,streamType:t.length>0?1:0,width:fw(e.videoWidth)?640:e.videoWidth,height:fw(e.videoHeight)?480:e.videoHeight,videoBps:e.videoBitrate||0,fps:e.videoFramerate||15,gop:e.videoGOP||2,audioSampleRate:e.audioSampleRate||48e3,audioBps:e.audioBitrate||64,audioChannels:e.audioChannels||1,backgroundColor:e.backgroundColor||0,backgroundImg:e.backgroundImage||"",extraInfo:"",videoCodec:2,audioCodec:0}}},{key:"hasAvailablePlaceHolder",value:function(){return!!this.isPresetLayoutMode&&this.data_.inputParam.length!==this.config_.mixUsers.length}},{key:"resetIsUsedFlag",value:function(){this.remoteStreamMap_.forEach((function(e){return e.isUsed=!1}))}}]),e}(),pW=function(){function e(t){a(this,e),this.client_=t.client,this.signalChannel_=t.signalChannel,this.publishTencentMainStreamObj_={params_:null,streamId_:void 0,isPublishing_:!1},this.publishTencentAuxStreamObj_={params_:null,streamId_:void 0,isPublishing_:!1},this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1}var t,i,r,s,u,l;return c(e,[{key:"setSignalChannel",value:function(e){this.signalChannel_=e.signalChannel}},{key:"getIsPublishingTencentCDN",value:function(){return this.publishTencentMainStreamObj_.isPublishing_||this.publishTencentAuxStreamObj_.isPublishing_}},{key:"getIsPublishingGivenCDN",value:function(){return this.isPublishingGivenCDN_}},{key:"generatePublishCDNStreamId",value:function(e,t){if(!e){var n="".concat(this.client_.getRoomId(),"_").concat(this.client_.getUserId(),"_").concat(t);return/^[A-Za-z\d_-]*$/.test(n)||(n=lW(n)),"".concat(this.client_.getSDKAppId(),"_").concat(n)}return e}},{key:"generatePublishCDNSessionId",value:function(e){return lW("".concat(this.client_.getRoomId(),"_").concat(this.client_.getUserId(),"_").concat(e))}},{key:"startPublishTencentCDN",value:(l=o(n().mark((function e(t){var i,r,o,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.streamType===HT?(this.publishTencentAuxStreamObj_.params_=t,this.publishTencentAuxStreamObj_.isPublishing_=!0):(this.publishTencentMainStreamObj_.params_=t,this.publishTencentMainStreamObj_.isPublishing_=!0),this.client_.isJoined_){e.next=3;break}return e.abrupt("return");case 3:return i=this.generatePublishCDNStreamId(t.streamId,t.streamType),r=this.generatePublishCDNSessionId(t.streamType),o=t.streamType===HT?1:0,a={requestTime:Date.now(),sessionId:r,streamId:i,streamType:o},e.next=9,this.doStartPublishTencentCDN(a,t.streamType);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"doStartPublishTencentCDN",value:(u=o(n().mark((function e(t,i){var r,o,a,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,PA.info("startPublishTencentCDN: "+JSON.stringify(t)),e.next=4,this.signalChannel_.sendWaitForResponseWithRetry({command:cL,data:t,timeout:2e3,responseCommand:JR.START_PUBLISH_TENCENT_CDN_RES,commandDesc:"startPublishCDNStream",retries:2});case 4:if(r=e.sent,o=r.data,a=o.code,s=o.message,0!==a){e.next=10;break}i===HT?this.publishTencentAuxStreamObj_.streamId_=t.streamId:this.publishTencentMainStreamObj_.streamId_=t.streamId,e.next=14;break;case 10:throw i===HT?this.publishTencentAuxStreamObj_.isPublishing_=!1:this.publishTencentMainStreamObj_.isPublishing_=!1,-102083===a&&(s="Please enable relayed-push in ".concat(cE," and try later, refer to ").concat(lE,"tutorial-26-advanced-publish-cdn-stream.html")),PA.error("startPublishTencentCDN failed, errCode: ".concat(a,", errMsg: ").concat(s)),new _L({code:vL.START_PUBLISH_CDN_FAILED,message:ow({key:_k,data:{message:s},link:{className:"Client",fnName:"startPublishCDNStream"}})});case 14:e.next=20;break;case 16:throw e.prev=16,e.t0=e.catch(0),i===HT?this.publishTencentAuxStreamObj_.isPublishing_=!1:this.publishTencentMainStreamObj_.isPublishing_=!1,e.t0;case 20:case"end":return e.stop()}}),e,this,[[0,16]])}))),function(e,t){return u.apply(this,arguments)})},{key:"resetPublishTencentParam",value:function(e){e===rC&&(this.publishTencentMainStreamObj_={params_:null,streamId_:void 0,isPublishing_:!1}),e===HT&&(this.publishTencentAuxStreamObj_={params_:null,streamId_:void 0,isPublishing_:!1})}},{key:"stopPublishTencentCDN",value:(s=o(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client_.isJoined_){e.next=4;break}return this.resetPublishTencentParam(rC),this.resetPublishTencentParam(HT),e.abrupt("return");case 4:if(!this.publishTencentMainStreamObj_.isPublishing_){e.next=7;break}return e.next=7,this.doStopPublishTencentCDN(rC);case 7:if(!this.publishTencentAuxStreamObj_.isPublishing_){e.next=10;break}return e.next=10,this.doStopPublishTencentCDN(HT);case 10:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"doStopPublishTencentCDN",value:(r=o(n().mark((function e(t){var i,r,o,a,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={requestTime:Date.now(),sessionId:lW("".concat(this.client_.getRoomId(),"_").concat(this.client_.getUserId(),"_").concat(t))},PA.info("stopPublishTencentCDN: "+JSON.stringify(i)),e.next=4,this.signalChannel_.sendWaitForResponse({command:uL,data:i,timeout:5e3,responseCommand:JR.STOP_PUBLISH_TENCENT_CDN_RES,commandDesc:"stopPublishCDNStream"});case 4:if(r=e.sent,o=r.data,a=o.code,s=o.message,0!==a){e.next=10;break}this.resetPublishTencentParam(t),e.next=17;break;case 10:if(-102069!==a){e.next=15;break}PA.warn("stopPublishTencentCDN failed, can not stopPublishTencentCDN in auto relayed-push mode"),this.resetPublishTencentParam(t),e.next=17;break;case 15:throw PA.error("stopPublishTencentCDN failed, errCode: ".concat(a," errMsg: ").concat(s)),new _L({code:vL.STOP_PUBLISH_CDN_FAILED,message:ow({key:yk,data:{message:s},link:{className:"Client",fnName:"stopPublishCDNStream"}})});case 17:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"startPublishGivenCDN",value:(i=o(n().mark((function e(t){var i,r,o,a,s,c;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.streamType===rC?this.publishTencentMainStreamObj_.streamId_:this.publishTencentAuxStreamObj_.streamId_,r={pushRequestTime:Date.now(),pushAppId:t.appId,pushBizId:t.bizId,pushCdnUrl:t.url,pushStreamType:t.streamType,pushStreamId:i},PA.info("startPublishGivenCDN: "+JSON.stringify(r)),this.publishGivenCDNData_=r,this.isPublishingGivenCDN_=!0,this.client_.isJoined_){e.next=7;break}return e.abrupt("return");case 7:return e.prev=7,e.next=10,this.signalChannel_.sendWaitForResponse({command:lL,data:r,timeout:5e3,responseCommand:JR.START_PUBLISH_GIVEN_CDN_RES,commandDesc:"startPublishCDNStream"});case 10:if(o=e.sent,a=o.data,s=a.code,c=a.message,0===s){e.next=17;break}throw PA.error("startPublishGivenCDN failed, errCode: ".concat(s,", errMsg: ").concat(c)),this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1,new _L({code:vL.START_PUBLISH_CDN_FAILED,message:ow({key:_k,data:{message:c},link:{className:"Client",fnName:"startPublishCDNStream"}})});case 17:e.next=24;break;case 19:throw e.prev=19,e.t0=e.catch(7),this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1,e.t0;case 24:case"end":return e.stop()}}),e,this,[[7,19]])}))),function(e){return i.apply(this,arguments)})},{key:"stopPublishGivenCDN",value:(t=o(n().mark((function e(){var t,i,r,o,a,s,c,u,l,d;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client_.isJoined_){e.next=4;break}return this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1,e.abrupt("return");case 4:return t=this.publishGivenCDNData_,i=t.pushAppId,r=t.pushBizId,o=t.pushCdnUrl,a=t.pushStreamType,s={pushRequestTime:Date.now(),pushAppId:i,pushBizId:r,pushCdnUrl:o,pushStreamType:a},PA.info("stopPublishGivenCDN: "+JSON.stringify(s)),e.next=9,this.signalChannel_.sendWaitForResponse({command:dL,data:s,timeout:5e3,responseCommand:JR.STOP_PUBLISH_GIVEN_CDN_RES,commandDesc:"stopPublishCDNStream"});case 9:if(c=e.sent,u=c.data,l=u.code,d=u.message,0!==l){e.next=16;break}this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1,e.next=18;break;case 16:throw PA.error("stopPublishGivenCDN failed, errCode: ".concat(l," errMsg: ").concat(d)),new _L({code:vL.STOP_PUBLISH_CDN_FAILED,message:ow({key:yk,data:{message:d},link:{className:"Client",fnName:"stopPublishCDNStream"}})});case 18:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"handleCDNConfigForJoinData",value:function(e){var t,n=e;if(this.publishTencentMainStreamObj_.isPublishing_||this.publishTencentAuxStreamObj_.isPublishing_){var i={};gw(n)&&(i=JSON.parse(n)),i.Str_uc_params||(i.Str_uc_params={}),this.publishTencentMainStreamObj_.isPublishing_&&(this.publishTencentMainStreamObj_.streamId_?i.Str_uc_params.userdefine_streamid_main=this.publishTencentMainStreamObj_.streamId_:this.publishTencentMainStreamObj_.params_&&(i.Str_uc_params.userdefine_streamid_main=this.generatePublishCDNStreamId(this.publishTencentMainStreamObj_.params_.streamId,rC))),this.publishTencentAuxStreamObj_.isPublishing_&&(this.publishTencentAuxStreamObj_.streamId_?i.Str_uc_params.userdefine_streamid_aux=this.publishTencentAuxStreamObj_.streamId_:this.publishTencentAuxStreamObj_.params_&&(i.Str_uc_params.userdefine_streamid_aux=this.generatePublishCDNStreamId(this.publishTencentAuxStreamObj_.params_.streamId,HT))),n=JSON.stringify(i)}if(this.isPublishingGivenCDN_){var r=this.publishGivenCDNData_,o=r.pushAppId,a=r.pushBizId,s=r.pushCdnUrl,c=r.pushStreamType,u=r.pushStreamId;t={pushRequestTime:Date.now(),pushAppId:o,pushBizId:a,pushCdnUrl:s,pushStreamType:c,pushStreamId:u}}return{bussinessInfo:n,pushUserCdnInfo:t}}},{key:"reset",value:function(){this.resetPublishTencentParam(rC),this.resetPublishTencentParam(HT),this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1}}]),e}(),hW=function(){function e(t){a(this,e),this.client_=t.client,this.durationMap_=new Map,this.installEvents()}return c(e,[{key:"installEvents",value:function(){Gw.on(uA,this.handleSubscribed,this),Gw.on(aA,this.handleStreamTrackUpdated,this),Gw.on(lA,this.handleStreamStopped,this),Gw.on(pA,this.handleStreamStopped,this)}},{key:"uninstallEvents",value:function(){Gw.off(uA,this.handleSubscribed,this),Gw.off(aA,this.handleStreamTrackUpdated,this),Gw.off(lA,this.handleStreamStopped,this),Gw.off(pA,this.handleStreamStopped,this)}},{key:"handleSubscribed",value:function(e){var t=e.client,n=e.stream;if(t===this.client_){var i=n.getUserId(),r=n.getType(),o="".concat(i,"_").concat(r);if(n.hasAudio())if(n.isMainAudioSubscribed){var a=new rW,s=this.durationMap_.get(o);s?this.isRecording(s.audio)||s.audio.push(a):this.durationMap_.set(o,{userId:i,type:r,audio:[a],video:[]})}else this.stopDurationItem(o,xT);if(n.hasVideo())if(r===qC&&n.isMainVideoSubscribed||r===BC&&n.isAuxVideoSubscribed){var c=new rW,u=this.durationMap_.get(o);u?this.isRecording(u.video)||u.video.push(c):this.durationMap_.set(o,{userId:i,type:r,audio:[],video:[c]})}else this.stopDurationItem(o,GT)}}},{key:"handleStreamStopped",value:function(e){var t=e.client,n=e.stream;if(this.clientHitTest(t)){var i=n.getUserId(),r=n.getType(),o="".concat(i,"_").concat(r);this.stopDurationItem(o,xT),this.stopDurationItem(o,GT)}}},{key:"handleStreamTrackUpdated",value:function(e){var t=e.client,n=e.userId,i=e.tinyId,r=e.kind,o=e.action;if(this.clientHitTest(t)&&this.client_.getConnections().has(i)){var a=r===BT?r:qC,s="".concat(n,"_").concat(a);if(o===VS.ADD){var c=this.client_.getConnections().get(i).getSubscribeState();if(r===xT&&!c.audio||r===GT&&!c.video||r===BT&&!c.auxiliary)return;var u=new rW,l=this.durationMap_.get(s);l?(r!==xT||this.isRecording(l.audio)||l.audio.push(u),r===xT||this.isRecording(l.video)||l.video.push(u)):this.durationMap_.set(s,{userId:n,type:a,audio:r===xT?[u]:[],video:r===xT?[]:[u]})}else this.stopDurationItem(s,r===xT?xT:GT)}}},{key:"isRecording",value:function(e){return e.findIndex((function(e){return 0===e.endTime}))>=0}},{key:"stopDurationItem",value:function(e,t){if(this.durationMap_.has(e)){var n=this.durationMap_.get(e)[t].find((function(e){return 0===e.endTime}));n&&n.stop()}}},{key:"clientHitTest",value:function(e){return this.client_===e}},{key:"getDuration",value:function(e,t){return this.durationMap_.has(e)?this.durationMap_.get(e)[t].reduce((function(e,t){return e+t.getDuration()}),0):0}},{key:"getDurationMap",value:function(){return this.durationMap_}},{key:"reset",value:function(){this.durationMap_.clear()}},{key:"destroy",value:function(){this.client_=null,this.uninstallEvents()}}]),e}(),fW=Er,gW=R,mW=Hc.f;fW({target:"Object",stat:!0,forced:gW((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:mW});var vW=5e3,_W={msg_user_info:0,uint32_video_avg_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_avg_bitrate:0,uint32_video_block_time:0,uint32_video_play_time:0,uint32_audio_block_time:0,uint32_audio_play_time:0,uint32_audio_play_db:0,uint32_avg_down_loss:0,uint32_stream_type:0,uint32_video_render_first:0,uint32_video_block_count:0,uint32_audio_block_count:0,uint32_audio_bitrate:0,uint32_video_black_screen_subjective:0,uint32_audio_recv_bitrate:0,uint32_video_external_block_time:0},yW=c((function e(t){a(this,e),this.str_identifier=String(t.userId),this.uint64_tinyid=Number(t.tinyId),this.uint32_role=t.role})),IW=(cW=LK({timeout:500,retries:3}),uW=function(){function e(t){var i=this;a(this,e),this.frameWorkType_=t.frameWorkType||30,this.component_=t.component||0,this.client_=t.client,this.keyPrefix_="key_point",this.storageKey_="".concat(this.keyPrefix_,"_").concat(this.client_.getUserId()),this.log_=PA.createLogger({id:"kpm|"+this.client_.getUserId(),userId:this.client_.getUserId(),sdkAppId:this.client_.getSDKAppId()}),Object.getOwnPropertyNames(this.__proto__).forEach((function(e){var t,r,a;e.startsWith("handle")&&hw(i[e])&&(i[e]=(t={fn:i[e],context:i},r=t.fn,a=t.context,o(n().mark((function e(){var t,i,o,s=arguments;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(e.prev=0,t=s.length,i=new Array(t),o=0;o<t;o++)i[o]=s[o];return e.next=4,r.apply(a||this,i);case 4:return e.abrupt("return",e.sent);case 7:e.prev=7,e.t0=e.catch(0),PA.error("".concat(r.name,"() error observed ")+e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})))))})),this.initData(),this.installEvents(),this.intervalId_=QO.run(_E,this.setStorage.bind(this),{delay:2e4})}var i,r,s;return c(e,[{key:"initData",value:function(){this.firstPublishedUserList_=[],this.networkQuality_={totalUplinkRTT:0,totalUplinkLoss:0,count:0,totalDownlinkRTTAndLossMap:new Map},this.basicInfo={string_sdk_version:za,uint32_os_type:15,string_device_name:"",string_http_user_agent:navigator.userAgent,string_os_version:"",uint32_avg_rtt:0,uint32_avg_up_loss:0,uint32_scene:"live"===this.client_.getMode()?1:0,uint32_joining_duration:0,uint32_networkType:qS[uw()],uint32_framework:this.frameWorkType_,uint32_component:this.component_},this.pathJoinRoom_={uint64_start_time:0,uint64_init_audio_start_time:0,uint64_init_audio_end_time:0,uint64_init_camera_start_time:0,uint64_init_camera_end_time:0,uint64_send_request_acc_ip_cmd_start_time:0,uint64_send_request_acc_ip_cmd_end_time:0,uint64_send_request_enter_room_cmd_start_time:0,uint64_send_request_enter_room_cmd_end_time:0,uint64_send_first_video_frame_time:0,uint64_recv_userlist_time:0,uint64_end_time:0,int32_init_audio_ret:0,int32_init_camera_ret:0,int32_send_request_acc_ip_cmd_ret:0,int32_send_request_enter_room_cmd_ret:0,int32_end_ret:0},this.pathLeaveRoom_={uint64_start_time:0,uint64_send_request_exit_room_cmd_start_time:0,uint64_send_request_exit_room_cmd_end_time:0,uint64_end_time:0,int32_send_request_exit_room_cmd_ret:0,int32_end_ret:0},this.pathMainVideoMap_=new Map,this.pathMainAudioMap_=new Map,this.pathAuxiliaryMap_=new Map,this.localStreamStats_={totalVideoBitrate:0,totalVideoFPS:0,totalVideoHeight:0,totalVideoWidth:0,totalAudioLevel:0,videoCount:0,audioLevelCount:0,publishStartTime:0,statsToReport:{uint32_audio_capture_db:0,uint32_video_big_capture_fps:0,uint32_video_big_bitrate:0,uint32_video_big_resolution:0}},this.remoteStreamStatsMap_=new Map}},{key:"installEvents",value:function(){Gw.on(Fw,this.handleJoinStart,this),Gw.on(Jw,this.handleWSStart,this),Gw.on(Xw,this.handleWSEnd,this),Gw.on(Vw,this.handleJoinSendCMD,this),Gw.on(qw,this.handleJoinReceivedCMDResponce,this),Gw.on(Bw,this.handleJoinSuccess,this),Gw.on(Hw,this.handleJoinFailed,this),Gw.on(Yw,this.handleReceivedPublishUserList,this),Gw.on(EA,this.handleConnectionStateChanged,this),Gw.on(jw,this.handleLeaveStart,this),Gw.on(zw,this.handleLeaveSuccess,this),Gw.on(Kw,this.handleLeaveSendCMD,this),Gw.on(kA,this.handleSendSubscribeCMD,this),Gw.on(rA,this.handleVideoPlaying,this),Gw.on(oA,this.handleAudioPlaying,this),Gw.on(bA,this.handleNetworkQuality,this),Gw.on(Ww,this.handleHeartbeatStats,this),Gw.on(sA,this.handleRemoteStreamAdded,this),Gw.on(cA,this.handleRemoteStreamSubscribeStart,this),Gw.on(uA,this.handleRemoteStreamSubscribed,this),Gw.on(pA,this.handleRemoteStreamRemoved,this),Gw.on(IA,this.handleVideoLoadedData,this),Gw.on(yA,this.handlePlayStream,this),Gw.on($w,this.handlePublishStart,this),Gw.on(fA,this.handleLocalStreamInitStart,this),Gw.on(gA,this.handleLocalStreamInitEnd,this),Gw.on(mA,this.handleLocalStreamInitFailed,this)}},{key:"uninstallEvents",value:function(){Gw.off(Fw,this.handleJoinStart,this),Gw.off(Jw,this.handleWSStart,this),Gw.off(Xw,this.handleWSEnd,this),Gw.off(Vw,this.handleJoinSendCMD,this),Gw.off(qw,this.handleJoinReceivedCMDResponce,this),Gw.off(Yw,this.handleReceivedPublishUserList,this),Gw.off(EA,this.handleConnectionStateChanged,this),Gw.off(jw,this.handleLeaveStart,this),Gw.off(zw,this.handleLeaveSuccess,this),Gw.off(Bw,this.handleJoinSuccess,this),Gw.off(Hw,this.handleJoinFailed,this),Gw.off(Kw,this.handleLeaveSendCMD,this),Gw.off(kA,this.handleSendSubscribeCMD,this),Gw.off(rA,this.handleVideoPlaying,this),Gw.off(oA,this.handleAudioPlaying,this),Gw.off(bA,this.handleNetworkQuality,this),Gw.off(Ww,this.handleHeartbeatStats,this),Gw.off(sA,this.handleRemoteStreamAdded,this),Gw.off(cA,this.handleRemoteStreamSubscribeStart,this),Gw.off(uA,this.handleRemoteStreamSubscribed,this),Gw.off(pA,this.handleRemoteStreamRemoved,this),Gw.off(IA,this.handleVideoLoadedData,this),Gw.off(yA,this.handlePlayStream,this),Gw.off($w,this.handlePublishStart,this),Gw.off(fA,this.handleLocalStreamInitStart,this),Gw.off(gA,this.handleLocalStreamInitEnd,this),Gw.off(mA,this.handleLocalStreamInitFailed,this)}},{key:"destroy",value:function(){this.uninstallEvents(),QO.clearTask(this.intervalId_),this.client_=null}},{key:"handleJoinStart",value:function(e){this.hitTest(e.client)&&0===this.pathJoinRoom_.uint64_start_time&&(this.pathJoinRoom_.uint64_start_time=Date.now(),this.checkStorage())}},{key:"handleWSStart",value:function(e){var t=e.client;this.hitTest(t)&&0===this.pathJoinRoom_.uint64_send_request_acc_ip_cmd_start_time&&(this.pathJoinRoom_.uint64_send_request_acc_ip_cmd_start_time=Date.now())}},{key:"handleWSEnd",value:function(e){var t=e.client,n=e.error;this.hitTest(t)&&0===this.pathJoinRoom_.uint64_send_request_acc_ip_cmd_end_time&&(this.pathJoinRoom_.uint64_send_request_acc_ip_cmd_end_time=Date.now(),n&&(this.pathJoinRoom_.int32_send_request_acc_ip_cmd_ret=n instanceof _L?Number(n.getExtraCode()||n.getCode()):vL.UNKNOWN,this.pathJoinRoom_.int32_end_ret=2))}},{key:"handleJoinSendCMD",value:function(e){this.hitTest(e.client)&&0===this.pathJoinRoom_.uint64_send_request_enter_room_cmd_start_time&&(this.pathJoinRoom_.uint64_send_request_enter_room_cmd_start_time=Date.now())}},{key:"handleJoinReceivedCMDResponce",value:function(e){this.hitTest(e.client)&&0===this.pathJoinRoom_.uint64_send_request_enter_room_cmd_end_time&&(this.pathJoinRoom_.uint64_send_request_enter_room_cmd_end_time=Date.now(),this.pathJoinRoom_.int32_send_request_enter_room_cmd_ret=e.code,0!==e.code&&(this.pathJoinRoom_.int32_end_ret=3))}},{key:"handleJoinSuccess",value:function(e){this.hitTest(e.client)&&0===this.pathJoinRoom_.uint64_end_time&&(this.pathJoinRoom_.uint64_end_time=Date.now(),this.pathJoinRoom_.int32_end_ret=0)}},{key:"handleJoinFailed",value:function(e){var t=e.client;this.hitTest(t)&&(this.pathJoinRoom_.uint64_end_time=Date.now(),0===this.pathJoinRoom_.int32_end_ret&&(this.pathJoinRoom_.int32_end_ret=3),this.prepareReport(),this.report())}},{key:"handleReceivedPublishUserList",value:function(e){this.hitTest(e.client)&&0===this.pathJoinRoom_.uint64_recv_userlist_time&&(this.pathJoinRoom_.uint64_recv_userlist_time=Date.now(),this.firstPublishedUserList_=e.data.data&&e.data.data.userList||[])}},{key:"handleConnectionStateChanged",value:function(e){var t=e.client,n=e.state,i=e.connection;if(this.hitTest(t)&&n===WC){this.client_.getUplinkConnection()===i&&0===this.pathJoinRoom_.uint64_send_first_video_frame_time&&this.localStreamStats_.publishStartTime>this.pathJoinRoom_.uint64_end_time&&this.localStreamStats_.publishStartTime-this.pathJoinRoom_.uint64_end_time<=100&&(this.pathJoinRoom_.uint64_send_first_video_frame_time=Date.now());var r=this.pathMainVideoMap_.get("".concat(i.getUserId(),"_").concat(qC));r&&0===r.statsToReport.uint64_pc_connected_time&&(r.statsToReport.uint64_pc_connected_time=Date.now())}}},{key:"handleLeaveStart",value:function(e){this.hitTest(e.client)&&(this.pathLeaveRoom_.uint64_start_time=Date.now())}},{key:"handleLeaveSuccess",value:function(e){this.hitTest(e.client)&&0===this.pathLeaveRoom_.uint64_end_time&&(this.pathLeaveRoom_.uint64_end_time=Date.now(),0!==this.pathJoinRoom_.uint64_end_time?this.basicInfo.uint32_joining_duration=this.pathLeaveRoom_.uint64_end_time-this.pathJoinRoom_.uint64_end_time:this.log_.warn("pathJoinRoom endTime is 0"),this.report())}},{key:"handleLeaveSendCMD",value:function(e){this.hitTest(e.client)&&(this.pathLeaveRoom_.uint64_send_request_exit_room_cmd_start_time=Date.now(),this.pathLeaveRoom_.uint64_send_request_exit_room_cmd_end_time=Date.now())}},{key:"handleRemoteStreamAdded",value:function(e){var n=e.client,i=e.stream;if(this.hitTest(n)){var r=i.getUserId(),o=i.getType(),a="".concat(r,"_").concat(o),s=this.remoteStreamStatsMap_.get(a);if(s)s.stream=i;else{var c={userId:r,totalVideoFPS:0,totalVideoBitrate:0,totalAudioLevel:0,totalAudioBitrate:0,totalLoss:0,audioCount:0,audioLevelCount:0,videoCount:0,networkQualityCount:0,streamAddedTime:Date.now(),subscribeStartTime:0,subscribedTime:0,playStreamTime:0,statsToReport:t({},_W),stream:i};c.statsToReport.msg_user_info=new yW({userId:r,tinyId:i.getTinyId(),role:NC}),c.statsToReport.uint32_stream_type=o===qC?2:7,this.remoteStreamStatsMap_.set(a,c)}}}},{key:"handleRemoteStreamSubscribeStart",value:function(e){var t=e.client,n=e.stream;if(this.hitTest(t)){var i=n.getUserId(),r=n.getType(),o="".concat(i,"_").concat(r),a=this.remoteStreamStatsMap_.get(o);a&&0===a.subscribeStartTime&&(a.subscribeStartTime=Date.now())}}},{key:"handleSendSubscribeCMD",value:function(e){if(this.hitTest(e.client)){var t=new yW(e),n=Date.now(),i="".concat(e.userId,"_").concat(qC);e.trackState.video&&e.subscribeState.video&&!this.pathMainVideoMap_.has(i)&&this.pathMainVideoMap_.set(i,{statsToReport:{msg_user_info:t,uint64_start_enter_time:this.pathJoinRoom_.uint64_start_time,uint64_render_first_frame_time:0,uint64_combine_first_frame_time:0,uint64_pc_connected_time:0},userId:e.userId,sendSubscribeCMDTime:n}),e.trackState.audio&&e.subscribeState.audio&&!this.pathMainAudioMap_.has(i)&&this.pathMainAudioMap_.set(i,{statsToReport:{msg_user_info:t,uint64_start_enter_time:this.pathJoinRoom_.uint64_start_time,uint64_play_first_frame_time:0},userId:e.userId,sendSubscribeCMDTime:n});var r="".concat(e.userId,"_").concat(BC);e.trackState.auxiliary&&e.subscribeState.auxiliary&&!this.pathAuxiliaryMap_.has(r)&&this.pathAuxiliaryMap_.set(r,{sendSubscribeCMDTime:n})}}},{key:"handleRemoteStreamSubscribed",value:function(e){var t=e.client,n=e.stream;if(this.hitTest(t)){var i=n.getUserId(),r=n.getType(),o="".concat(i,"_").concat(r),a=this.remoteStreamStatsMap_.get(o);a&&0===a.subscribedTime&&(a.subscribedTime=Date.now(),a.stream=n)}}},{key:"handleRemoteStreamRemoved",value:function(e){var t=e.client,n=e.stream;if(this.hitTest(t)){var i=n.getUserId(),r=n.getType(),o=this.remoteStreamStatsMap_.get("".concat(i,"_").concat(r));o&&(o.stream=null)}}},{key:"handlePlayStream",value:function(e){var t=e.stream;if(t.isRemote()&&t.getConnection()&&this.hitTest(t.getConnection().getClient())){var n=t.getConnection().getUserId(),i="".concat(n,"_").concat(t.getType());if(this.remoteStreamStatsMap_.has(i)){var r=this.remoteStreamStatsMap_.get(i);0===r.playStreamTime&&(r.playStreamTime=Date.now())}}}},{key:"handleVideoLoadedData",value:function(e){var t=e.stream;if(t.isRemote()&&t.getConnection()&&this.hitTest(t.getConnection().getClient())){var n=t.getConnection().getUserId(),i="".concat(n,"_").concat(t.getType());if(this.pathMainVideoMap_.has(i)){var r=this.pathMainVideoMap_.get(i);0===r.statsToReport.uint64_combine_first_frame_time&&(r.statsToReport.uint64_combine_first_frame_time=Date.now())}}}},{key:"handleVideoPlaying",value:function(e){var t=e.stream;if(t.isRemote()&&t.getConnection()&&this.hitTest(t.getConnection().getClient())){var n=t.getConnection().getUserId(),i="".concat(n,"_").concat(t.getType()),r=Date.now();if(this.pathMainVideoMap_.has(i)){var o=this.pathMainVideoMap_.get(i);if(0===o.statsToReport.uint64_render_first_frame_time&&(o.statsToReport.uint64_render_first_frame_time=r),this.remoteStreamStatsMap_.has(i)){var a=this.remoteStreamStatsMap_.get(i),s=a.statsToReport,c=a.playStreamTime,u=a.subscribedTime;0===s.uint32_video_render_first&&c-u<=100&&(s.uint32_video_render_first=r-o.sendSubscribeCMDTime)}}if(t.getType()===BC&&this.pathAuxiliaryMap_.has(i)&&this.remoteStreamStatsMap_.has(i)){var l=this.remoteStreamStatsMap_.get(i),d=l.statsToReport,p=l.playStreamTime,h=l.subscribedTime;0===d.uint32_video_render_first&&p-h<=100&&(d.uint32_video_render_first=r-this.pathAuxiliaryMap_.get(i).sendSubscribeCMDTime)}}}},{key:"handleAudioPlaying",value:function(e){if(e.stream.isRemote()&&e.stream.getConnection()&&this.hitTest(e.stream.getConnection().getClient())){var t=e.stream.getConnection().getUserId(),n="".concat(t,"_").concat(e.stream.getType());if(this.pathMainAudioMap_.has(n)){var i=this.pathMainAudioMap_.get(n);0===i.statsToReport.uint64_play_first_frame_time&&(i.statsToReport.uint64_play_first_frame_time=Date.now())}}}},{key:"handleNetworkQuality",value:function(e){var t=this;this.hitTest(e.client)&&(this.networkQuality_.totalUplinkLoss+=e.uplinkLoss,this.networkQuality_.totalUplinkRTT+=e.uplinkRTT,this.networkQuality_.count++,e.downlinkLossAndRTTMap.forEach((function(e){var n=e.rtt,i=e.loss,r=e.userId,o=t.networkQuality_.totalDownlinkRTTAndLossMap.get(r);o?(o.totalRTT+=n,o.totalLoss+=i,o.count++):t.networkQuality_.totalDownlinkRTTAndLossMap.set(r,{totalRTT:n,totalLoss:i,count:1})})))}},{key:"handleHeartbeatStats",value:function(e){var t=this;if(this.hitTest(e.client)){var n=e.stats,i=n.msg_up_stream_info,r=n.msg_down_stream_info;if(i.msg_video_status[0]){var o=i.msg_video_status[0],a=o.uint32_video_codec_bitrate,s=o.uint32_video_enc_fps,c=o.uint32_video_width,u=o.uint32_video_height;this.localStreamStats_.totalVideoBitrate+=a,this.localStreamStats_.totalVideoFPS+=s,this.localStreamStats_.totalVideoWidth+=c,this.localStreamStats_.totalVideoHeight+=u,this.localStreamStats_.videoCount++}if(i.msg_audio_status){var l=i.msg_audio_status.audioLevel;Math.floor(100*l)>0&&(this.localStreamStats_.totalAudioLevel+=l,this.localStreamStats_.audioLevelCount++)}r.forEach((function(e){var n=e.msg_user_info,i=e.msg_audio_status,r=e.msg_video_status,o=n.str_identifier;if(r.forEach((function(e){var n=2===e.uint32_video_stream_type,i=7===e.uint32_video_stream_type,r="".concat(o,"_").concat(n?qC:BC);if(t.remoteStreamStatsMap_.has(r)){var a,s,c=t.remoteStreamStatsMap_.get(r);(n&&null!==(a=c.stream)&&void 0!==a&&a.isMainVideoSubscribed||i&&null!==(s=c.stream)&&void 0!==s&&s.isAuxVideoSubscribed)&&(c.totalVideoFPS+=e.uint32_video_receive_fps,c.totalVideoBitrate+=e.uint32_video_codec_bitrate,c.videoCount++,0===c.statsToReport.uint32_video_width&&(c.statsToReport.uint32_video_width=e.uint32_video_width),0===c.statsToReport.uint32_video_height&&(c.statsToReport.uint32_video_height=e.uint32_video_height))}})),i){var a="".concat(o,"_").concat(qC);if(t.remoteStreamStatsMap_.has(a)){var s,c=t.remoteStreamStatsMap_.get(a);null!==(s=c.stream)&&void 0!==s&&s.isMainAudioSubscribed&&(c.totalAudioBitrate+=i.uint32_audio_codec_bitrate,c.audioCount++,Math.floor(100*i.audioLevel)>0&&(c.totalAudioLevel+=i.audioLevel,c.audioLevelCount++))}}}))}}},{key:"handlePublishStart",value:function(e){var t=e.client;this.hitTest(t)&&0===this.localStreamStats_.publishStartTime&&(this.localStreamStats_.publishStartTime=Date.now())}},{key:"handleLocalStreamInitStart",value:function(e){var t=e.audio,n=e.video;t&&0===this.pathJoinRoom_.uint64_init_audio_start_time&&(this.pathJoinRoom_.uint64_init_audio_start_time=Date.now()),n&&0===this.pathJoinRoom_.uint64_init_camera_start_time&&(this.pathJoinRoom_.uint64_init_camera_start_time=Date.now())}},{key:"handleLocalStreamInitEnd",value:function(e){var t=e.audio,n=e.video;t&&0===this.pathJoinRoom_.uint64_init_audio_end_time&&(this.pathJoinRoom_.uint64_init_audio_end_time=Date.now()),n&&0===this.pathJoinRoom_.uint64_init_camera_end_time&&(this.pathJoinRoom_.uint64_init_camera_end_time=Date.now())}},{key:"handleLocalStreamInitFailed",value:function(e){var t=e.audio,n=e.video,i=e.error,r=i instanceof _L?i.getExtraCode()||i.getCode():{NotFoundError:1,NotAllowedError:2,NotReadableError:3,OverConstrainedError:4,AbortError:5}[i.name]||vL.UNKNOWN;t&&0===this.pathJoinRoom_.uint64_init_audio_end_time&&(this.pathJoinRoom_.int32_init_audio_ret=r,this.pathJoinRoom_.uint64_init_audio_end_time=Date.now()),n&&0===this.pathJoinRoom_.uint64_init_camera_end_time&&(this.pathJoinRoom_.int32_init_camera_ret=r,this.pathJoinRoom_.uint64_init_camera_end_time=Date.now())}},{key:"hasVideoFlag",value:function(e){return this.firstPublishedUserList_.findIndex((function(t){return t.userId===e&&1&t.flag}))>=0}},{key:"hasAudioFlag",value:function(e){return this.firstPublishedUserList_.findIndex((function(t){return t.userId===e&&8&t.flag}))>=0}},{key:"hasAuxFlag",value:function(e){return this.firstPublishedUserList_.findIndex((function(t){return t.userId===e&&4&t.flag}))>=0}},{key:"hitTest",value:function(e){return e===this.client_}},{key:"checkStorage",value:(s=o(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(t=tN.getItem(this.storageKey_))){e.next=6;break}return e.next=5,this.upload(t);case 5:tN.deleteItem(this.storageKey_);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.log_.warn(e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return s.apply(this,arguments)})},{key:"setStorage",value:function(){this.prepareReport();var e=this.getReportData();0!==e.msg_path_enter_room.uint64_start_time&&tN.setItem(this.storageKey_,e)}},{key:"prepareReport",value:function(){var e=this;if(this.networkQuality_.count>0&&(this.basicInfo.uint32_avg_rtt=Math.floor(this.networkQuality_.totalUplinkRTT/this.networkQuality_.count),this.basicInfo.uint32_avg_up_loss=Math.floor(this.networkQuality_.totalUplinkLoss/this.networkQuality_.count)),this.localStreamStats_.videoCount>0){this.localStreamStats_.statsToReport.uint32_video_big_capture_fps=Math.floor(this.localStreamStats_.totalVideoFPS/this.localStreamStats_.videoCount),this.localStreamStats_.statsToReport.uint32_video_big_bitrate=Math.floor(this.localStreamStats_.totalVideoBitrate/this.localStreamStats_.videoCount);var t=Math.floor(this.localStreamStats_.totalVideoWidth/this.localStreamStats_.videoCount),n=Math.floor(this.localStreamStats_.totalVideoHeight/this.localStreamStats_.videoCount);this.localStreamStats_.statsToReport.uint32_video_big_resolution=t<<16|n}this.localStreamStats_.audioLevelCount>0&&(this.localStreamStats_.statsToReport.uint32_audio_capture_db=Math.floor(this.localStreamStats_.totalAudioLevel/this.localStreamStats_.audioLevelCount*100)),this.remoteStreamStatsMap_.forEach((function(t,n){var i=t.userId;if(e.networkQuality_.totalDownlinkRTTAndLossMap.has(i)){var r=e.networkQuality_.totalDownlinkRTTAndLossMap.get(i),o=r.totalLoss,a=r.count;t.statsToReport.uint32_avg_down_loss=Math.floor(o/a)}t.videoCount>0&&(t.statsToReport.uint32_video_avg_fps=Math.floor(t.totalVideoFPS/t.videoCount),t.statsToReport.uint32_video_avg_bitrate=Math.floor(t.totalVideoBitrate/t.videoCount)),t.audioCount>0&&(t.statsToReport.uint32_audio_recv_bitrate=t.statsToReport.uint32_audio_bitrate=Math.floor(t.totalAudioBitrate/t.audioCount)),t.audioLevelCount>0&&(t.statsToReport.uint32_audio_play_db=Math.floor(t.totalAudioLevel/t.audioLevelCount*100));var s=e.client_.getCallDurationCalculator();s&&(t.statsToReport.uint32_audio_play_time=s.getDuration(n,xT),t.statsToReport.uint32_video_play_time=s.getDuration(n,GT)),t.statsToReport.uint32_video_render_first=Math.min(t.statsToReport.uint32_video_render_first,vW);var c=e.client_.getBadCaseDetector();if(c){var u=c.getDataFreezeDuration(n),l=u.dataFreeze,d=u.count,p=c.getRenderFreezeDuration(n).renderFreeze;t.statsToReport.uint32_video_block_count=d,t.statsToReport.uint32_video_block_time=Math.min(l,t.statsToReport.uint32_video_play_time),t.statsToReport.uint32_video_external_block_time=Math.min(p,t.statsToReport.uint32_video_play_time),c.isBlackStream(n)&&0===t.statsToReport.uint32_video_avg_fps?t.statsToReport.uint32_video_black_screen_subjective=1:t.statsToReport.uint32_video_black_screen_subjective=0}(0===t.subscribeStartTime||t.subscribeStartTime-t.streamAddedTime>100||0===t.playStreamTime)&&(e.pathMainAudioMap_.delete(n),e.pathMainVideoMap_.delete(n),t.statsToReport.uint32_video_render_first=0)})),this.pathMainAudioMap_.forEach((function(t,n){e.hasAudioFlag(t.userId)?t.statsToReport.uint64_play_first_frame_time-t.statsToReport.uint64_start_enter_time>vW&&(t.statsToReport.uint64_play_first_frame_time=t.statsToReport.uint64_start_enter_time+vW):e.pathMainAudioMap_.delete(n)})),this.pathMainVideoMap_.forEach((function(t,n){e.hasVideoFlag(t.userId)?t.statsToReport.uint64_render_first_frame_time-t.statsToReport.uint64_start_enter_time>vW&&(t.statsToReport.uint64_render_first_frame_time=t.statsToReport.uint64_start_enter_time+vW):e.pathMainVideoMap_.delete(n)})),this.pathJoinRoom_.uint64_end_time-this.pathJoinRoom_.uint64_start_time>vW&&(this.pathJoinRoom_.uint64_end_time=this.pathJoinRoom_.uint64_start_time+vW)}},{key:"getReportData",value:function(){var e=this.client_.getSignalInfo();return{uint32_sdk_app_id:Number(this.client_.getSDKAppId()),msg_user_info:new yW({userId:this.client_.getUserId(),tinyId:this.client_.getTinyId(),role:this.client_.getRole()===UC?NC:PC}),msg_basic_info:this.basicInfo,uint32_acc_ip:Sw(e.relayIp),uint32_client_ip:Sw(e.clientIp,"small"),uint32_acc_port:0,uint64_timestamp:Date.now(),uint32_seq:Math.floor(Math.random()*Math.pow(2,31)),msg_path_enter_room:this.pathJoinRoom_,msg_path_exit_room:this.pathLeaveRoom_,msg_path_recv_video:M(this.pathMainVideoMap_.values()).map((function(e){return e.statsToReport})),msg_quality_statistics:M(this.remoteStreamStatsMap_.values()).map((function(e){return e.statsToReport})),str_room_name:String(this.client_.getRoomId()),msg_path_recv_audio:M(this.pathMainAudioMap_.values()).map((function(e){return e.statsToReport})),uint32_info_client_ip:Sw(e.clientIp,"small"),error_code:[],msg_local_statistics:this.localStreamStats_.statsToReport}}},{key:"report",value:(r=o(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.getReportData(),e.next=4,this.upload(t);case 4:tN.deleteItem(this.storageKey_),this.initData(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.log_.warn(e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return r.apply(this,arguments)})},{key:"upload",value:(i=o(n().mark((function e(t){var i,r,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(QD||0===t.msg_path_enter_room.uint64_start_time||[oE,aE,sE].findIndex((function(e){return e===location.host}))>=0)){e.next=2;break}return e.abrupt("return");case 2:return i=Number(this.client_.getSDKAppId()),r=cw(i,wC),e.next=6,Pw({url:r,body:JSON.stringify(t)});case 6:if("ok"===(o=e.sent).data){e.next=9;break}throw"key point upload failed: ".concat(o.data);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})}]),e}(),k(uW.prototype,"upload",[cW],Object.getOwnPropertyDescriptor(uW.prototype,"upload"),uW.prototype),uW);function MW(){return function(e,t,i){var r=i.value,a=new Set;return i.value=o(n().mark((function e(){var i,o,s,c,u=arguments;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.has(this)){e.next=2;break}throw new _L({code:vL.INVALID_OPERATION,message:ow({key:RE,data:{name:t}})});case 2:for(e.prev=2,a.add(this),i=u.length,o=new Array(i),s=0;s<i;s++)o[s]=u[s];return e.next=7,r.apply(this,o);case 7:return c=e.sent,a.delete(this),e.abrupt("return",c);case 12:throw e.prev=12,e.t0=e.catch(2),a.delete(this),e.t0;case 16:case"end":return e.stop()}}),e,this,[[2,12]])}))),i}}function TW(e){return CW.apply(this,arguments)}function CW(){return CW=o(n().mark((function e(t){var i,r,o,a,s,c,u,l,d,p,h,f,g;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.userId,r=t.sdkAppId,o=t.useStringRoomId,a=t.roomId,s=t.userSig,c={delta:0,count:[1,1],msg:[]},e.prev=2,(u=new FormData).append("userId",String(i)),u.append("sdkAppId",String(r)),u.append("isStrGroupId",o),u.append("groupId",String(a)),u.append("sdkVersion",za),u.append("userSig",String(s)),ZS&&u.append("oversea",!0),l=Cw(),e.next=14,DW(u,c,r);case 14:return d=e.sent,c.delta=Cw()-l,SW({stat:c,userId:i}),e.abrupt("return",d);case 20:throw e.prev=20,e.t0=e.catch(2),p=yw(e.t0)?e.t0[0]:e.t0,h=mw(p.code)?p.code:0,f="get websocket url failed: ".concat(p.message.includes("timeout")?"timeout":p.message),g=new _L({code:vL.SCHEDULE_FAILED,extraCode:h,message:ow({key:ek,data:{error:f,code:h}})}),PA.error(g),SW({stat:c,userId:i,roomId:a,error:g}),g;case 29:case"end":return e.stop()}}),e,null,[[2,20]])}))),CW.apply(this,arguments)}function SW(e){var t=e.stat,n=e.userId,i=e.error;i?sO.logFailedEvent({eventType:bS,error:i,userId:n}):sO.logSuccessEvent({eventType:bS,delta:t.delta,userId:n}),sO.uploadEvent({log:"stat-schedule:"+JSON.stringify(t),userId:n})}function EW(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rC;return t=ZS?n===rC?ZS:$S:sw(e)?n===rC?JS:XS:n===rC?YS:$S,"https://".concat(t,"/api/v1/config")}function kW(e,t,n){return new Promise((function(i,r){Pw({url:e,body:t,timeout:n.timeout}).then((function(e){0===e.data.code?i(e.data.data):r({code:e.data.code,message:e.data.msg})})).catch(r)}))}var bW=function(e,t){return RA({retryFunction:kW,settings:{retries:3,timeout:0},onError:t,onRetrying:e})};function DW(e,t,n){return new Promise((function(i,r){var o,a=null;(o=[bW((function(e){return t.count[0]=e+1}),(function(e,n){t.msg[0]=e.message,a||n()}))(EW(n,rC),e,{get timeout(){return 1e3*dw(2+t.count[0])}}),bW((function(e){return t.count[1]=e+1}),(function(e,n){t.msg[1]=e.message,a||n()}))(EW(n,oC),e,{get timeout(){return 1e3*dw(2+t.count[1])}})],new Promise((function(e,t){var n=[];o.forEach((function(i){i.then(e).catch((function(e){n.push(e),n.length===o.length&&t(n)}))}))}))).then((function(e){i(a=e)})).catch(r)}))}var wW,AW,RW,LW,OW,NW,PW,UW,xW,GW,FW,VW,qW,BW,HW,jW,KW,zW,WW,YW,$W,JW,XW,ZW,QW=new(function(){function e(){a(this,e)}return c(e,[{key:"call",value:function(e,t){return hw(this[e])?this[e](t):Promise.reject(new _L({code:vL.INVALID_PARAMETER,message:ow({key:Tb,data:{name:e}})}))}},{key:"updatePrivateMapKey",value:function(e){var t=e.privateMapKey;return e.client.setProperty("privateMapKey",t),Promise.resolve()}}]),e}()),eY=(wW=MW(),AW=TK(IK.CLIENT.join),RW=MW(),LW=LK({retries:3}),OW=MW(),NW=TK.apply(void 0,M(IK.CLIENT.publish)),PW=MW(),UW=TK(IK.CLIENT.unpublish),xW=TK.apply(void 0,M(IK.CLIENT.subscribe)),GW=TK(IK.CLIENT.unsubscribe),FW=MW(),VW=TK(IK.CLIENT.switchRole),qW=TK(IK.CLIENT.startPublishCDNStream),BW=TK(IK.CLIENT.startMixTranscode),HW=MK.apply(void 0,M(IK.CLIENT.sendSEIMessage)),zW={timesInSecond:30,maxSizeInSecond:8e3,getSize:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t[0].byteLength}},WW=zW.timesInSecond,YW=zW.maxSizeInSecond,$W=zW.getSize,jW=function(e,t,n){var i=n.value,r=new Map;return Gw.on(Qw,(function(e){var t=e.client;return r.delete(t)})),n.value=function(){var e=r.get(this);e||(e={callCountInSecond:0,timestamp:0,totalSizeInSecond:0},r.set(this,e)),0===e.timestamp?e.timestamp=Date.now():Date.now()-e.timestamp>1e3&&(e.timestamp=Date.now(),e.callCountInSecond=0,e.totalSizeInSecond=0);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];if($W&&(e.totalSizeInSecond+=$W.apply(void 0,o)),0!==e.timestamp&&Date.now()-e.timestamp<1e3&&(e.callCountInSecond>=WW||e.totalSizeInSecond>YW))throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Rb,data:{isTimes:e.callCountInSecond>=WW,isSize:e.totalSizeInSecond>YW,name:t,timesInSecond:WW,maxSizeInSecond:YW}})});return e.callCountInSecond++,i.apply(this,o)},n},KW=function(){function e(t){var n,i;a(this,e),this.name_=tE,this.mode_=t.mode,this.sdpSemantics_=RS,fw(t.sdpSemantics)?function(){var e;if(fw(window.RTCRtpTransceiver))return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var t=null,n=!1;try{(t=new RTCPeerConnection({sdpSemantics:AS})).addTransceiver(xT),n=!0}catch(oY){}return null===(e=t)||void 0===e||e.close(),n}()&&(this.sdpSemantics_=AS):this.sdpSemantics_=t.sdpSemantics,this.sdkAppId_=t.sdkAppId,this.userId_=t.userId,this.log_=PA.createLogger({id:"c".concat(t.seq,"|").concat(this.userId_),userId:this.userId_,sdkAppId:this.sdkAppId_}),this.userSig_=t.userSig,this.roomId_=0,this.useStringRoomId_=t.useStringRoomId||!1,this.pureAudioPushMode_=null,this.version_=t.version,this.log_.info("using sdpSemantics: "+this.sdpSemantics_),this.signalChannel_=null,this.role_=UC,this.privateMapKey_="",this.tinyId_=0,this.env_="",this.proxy_=null,this.connections_=new Map,this.mutedStates_=new Map,this.userMap_=new Map,this.syncUserListInterval_=-1,this.localStream_=null,this.localAuxStream_=null,this.uplinkConnection_=null,this.emitter_=Lw(new xw,this.name_),this.isJoined_=!1,this.heartbeat_=-1,this.lastHeartBeatTime_=-1,this.stats_=new jN(this),this.joinTimeout_=-1,this.changeBigSmallRecords_=new Map,this.networkQuality_=null,this.badCaseDetector_=null,this.networkType_=uw(),this.autoSubscribe_=!!fw(t.autoSubscribe)||t.autoSubscribe,this.joinedTimestamp_=0,this.joinOptions_={},this.basis_=(i={browser:nw().name+"/"+nw().version,os:bN(),displayResolution:DN(),isScreenShareSupported:gN(),isWebRTCSupported:oN(),isGetUserMediaSupported:wN(),isWebAudioSupported:AN(),isWebSocketsSupported:"WebSocket"in window&&2===window.WebSocket.CLOSING,isWebCodecSupported:(n={AudioDecoder:!1,AudioEncoder:!1,VideoDecoder:!1,VideoEncoder:!1,ImageDecoder:!1},fw(window.AudioDecoder)||(n.AudioDecoder=!0),fw(window.AudioEncoder)||(n.AudioEncoder=!0),fw(window.VideoDecoder)||(n.VideoDecoder=!0),fw(window.VideoEncoder)||(n.VideoEncoder=!0),fw(window.ImageDecoder)||(n.ImageDecoder=!0),n),isMediaSessionSupported:"mediaSession"in navigator&&!fw(navigator.mediaSession.setActionHandler),isWebTransportSupported:!fw(window.WebTransport)},navigator.userAgent.includes("miniProgram")&&(i.browser="mini/".concat(i.browser)),i),this.initBussinessInfo_(t),this.publishedCDN_=!1,this.publishCDNData_=null,this.mixedMCU_=!1,this.mixTranscodeData_=null,this.checkSystemResult_=null,this.enableAudioVolumeEvaluation_=!1,this.audioVolumeIntervalId_=null,this.mixTranscodeManager_=null,this.publishCDNManager_=new pW({client:this}),this.keyPointManager_=new IW({client:this,frameWorkType:t.frameWorkType,component:t.component}),this.isPublishing_=!1,this.isEnableSmallStream_=!1,this.smallStreamConfig_={bitrate:100,frameRate:15,height:120,width:160},this.turnServers_=[],this.iceTransportPolicy_=t.iceTransportPolicy,this.schedule_={domains:null,iceServers:null,iceTransportPolicy:null,trtcCapability:null},this.enableAutoPlayDialog_=!!fw(t.enableAutoPlayDialog)||t.enableAutoPlayDialog,this.enableMultiAuxStream_=!fw(t.enableMultiAuxStream)&&t.enableMultiAuxStream,this.signalInfo_={},this.enableSEI_=!fw(t.enableSEI)&&t.enableSEI,this.isDestroyed_=!1}var i,r,s,u,l,d,p,h,f,g,m,v,_,y,T,C,S,k,b,D,w,A,R,L,O,N,P;return c(e,[{key:"initBussinessInfo_",value:function(e){this.bussinessInfo_=e.bussinessInfo;var t={};if(gw(e.bussinessInfo)&&(t=JSON.parse(e.bussinessInfo)),!fw(e.pureAudioPushMode)){if(!Number.isInteger(Number(e.pureAudioPushMode)))throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:KE})});this.pureAudioPushMode_=e.pureAudioPushMode,t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.pure_audio_push_mod=this.pureAudioPushMode_}if(!fw(e.streamId)){if(!(gw(e.streamId)&&String(e.streamId)&&String(e.streamId).length<=64))throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:zE})});t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.userdefine_streamid_main=e.streamId}if(!fw(e.userDefineRecordId)){if(null===e.userDefineRecordId.match(/^[A-Za-z0-9_-]{1,64}$/gi))throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:WE})});t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.userdefine_record_id=e.userDefineRecordId}if(!fw(e.userDefinePushArgs)){if(!(gw(e.userDefinePushArgs)&&String(e.userDefinePushArgs)&&String(e.userDefinePushArgs).length<=256))throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:YE})});t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.userdefine_push_args=e.userDefinePushArgs}oO(t)||(this.bussinessInfo_=JSON.stringify(t))}},{key:"schedule",value:(P=o(n().mark((function e(i){var r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,TW({userId:this.userId_,sdkAppId:this.sdkAppId_,roomId:i,useStringRoomId:this.useStringRoomId_,version:this.version_,userSig:this.userSig_});case 2:(r=e.sent)&&(this.log_.info("schedule: ".concat(JSON.stringify(r))),r.trtcCapability=null==r?void 0:r.trtcAutoConf,this.schedule_=t(t({},this.schedule_),r),Gw.emit(eA,this.schedule_));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"getSignalChannelUrl",value:function(){var e={mainUrl:"",backupUrl:""},t=aw();return t?e.mainUrl=e.backupUrl="wss://".concat(t,".rtc.qq.com"):this.proxy_?e.mainUrl=e.backupUrl=this.proxy_:Array.isArray(this.schedule_.domains)&&this.schedule_.domains.length>0&&(e.mainUrl=e.backupUrl="wss://".concat(this.schedule_.domains[0]),this.schedule_.domains[1]&&(e.backupUrl="wss://".concat(this.schedule_.domains[1]))),e}},{key:"getUserId",value:function(){return this.userId_}},{key:"getUserSig",value:function(){return this.userSig_}},{key:"getRole",value:function(){return this.role_}},{key:"getSignalInfo",value:function(){return this.signalInfo_}},{key:"getRoomId",value:function(){return this.roomId_}},{key:"getSDKAppId",value:function(){return this.sdkAppId_}},{key:"getTinyId",value:function(){return this.tinyId_}},{key:"getIceTransportPolicy",value:function(){return this.iceTransportPolicy_||this.schedule_.iceTransportPolicy||"all"}},{key:"initialize",value:function(){var e=this;this.log_.info("setup signal channel");var t=this.getSignalChannelUrl(),n=t.mainUrl,i=t.backupUrl;return this.signalChannel_=new cO({sdkAppId:this.sdkAppId_,userId:this.userId_,userSig:this.userSig_,url:n,backupUrl:i,client:this}),this.networkQuality_||(this.networkQuality_=new KN({connections:this.connections_,signalChannel:this.signalChannel_,userId:this.userId_,client:this}),this.networkQuality_.on(UN.NETWORK_QUALITY,(function(t){e.emitter_.emit(UN.NETWORK_QUALITY,t)}))),this.deviceDetector_||(this.deviceDetector_=new zN({client:this})),this.subscriptionManager_||(this.subscriptionManager_=new bK({client:this})),this.badCaseDetector_||(this.badCaseDetector_=new oW({client:this,stats:this.stats_})),this.callDurationCalculator_||(this.callDurationCalculator_=new hW({client:this})),this.mixTranscodeManager_||(this.mixTranscodeManager_=new dW({client:this,signalChannel:this.signalChannel_})),this.publishCDNManager_&&this.publishCDNManager_.setSignalChannel({signalChannel:this.signalChannel_}),this.signalChannel_.on(qR,(function(t){e.log_.info("SignalChannel state changed from ".concat(t.prevState," to ").concat(t.state)),e.emitter_.emit(UN.CONNECTION_STATE_CHANGED,t)})),this.signalChannel_.on(HR,(function(t){e.reset(),e.emitter_.emit(UN.ERROR,t)})),this.signalChannel_.once(FR,(function(t){e.tinyId_=t.signalInfo.tinyId,Gw.emit(Xw,{client:e})})),this.signalChannel_.on(JR.PEER_JOIN,this.onPeerJoin,this),this.signalChannel_.on(JR.PEER_LEAVE,this.onPeerLeave,this),this.signalChannel_.on(JR.UPDATE_REMOTE_MUTE_STAT,(function(t){Date.now()-e.lastHeartBeatTime_>=1e4&&e.doHeartbeat(),Gw.emit(Yw,{client:e,data:t.data}),e.onPublishedUserList(t.data),e.onUpdateRemoteMuteStat(t.data)})),this.signalChannel_.on(JR.CLIENT_BANNED,(function(t){var n,i=t.data.data.reason;if(sO.uploadEvent({log:"stat-banned:".concat(i),userId:e.userId_}),i===aC)n="you got banned by the admin";else if(i===sC)n="duplicated userId joining the room";else if(i===uC)n="the room has been disbanded by the admin",i=i.replace("_","-");else if(i===cC)return e.log_.warn("".concat(i," last heart beat time: ").concat(e.lastHeartBeatTime_," interval: ").concat(Date.now()-e.lastHeartBeatTime_,", visibility: ").concat(document.visibilityState)),void e.reJoin();e.log_["kick"===i?"error":"info"]("user was banned because of [".concat(i,"]")),e.reset(),e.emitter_.emit(UN.CLIENT_BANNED,{reason:i,message:ow({key:fk,data:{message:n,reason:i}})||i})})),Gw.emit(Jw,{client:this}),this.signalChannel_.connect()}},{key:"preJoin",value:(N=o(n().mark((function e(t){var i,r,o,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.joinOptions_=t,e.next=3,pN();case 3:if(this.checkSystemResult_=e.sent,this.checkDestroy(),(i=aw())||(i=CC,this.proxy_&&(this.proxy_.startsWith(MC)?i=SC:this.proxy_.startsWith(TC)&&(i=EC))),this.env_=i,sO.setConfig({env:i,sdkAppId:this.sdkAppId_,userId:this.userId_,roomId:t.roomId}),this.uploadTrtcStats(),r=this.checkSystemResult_.detail,o=r.isH264EncodeSupported,a=r.isVp8EncodeSupported,oN()&&(o||a)){e.next=13;break}throw new _L({code:vL.NOT_SUPPORTED,message:ow({key:lb})});case 13:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"join",value:(O=o(n().mark((function e(t){var i,r=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.roomId_=t.roomId,fw(t.role)||(this.role_=t.role),fw(t.privateMapKey)||(this.privateMapKey_=t.privateMapKey),i=Cw(),Gw.emit(Fw,{client:this}),nO(this.userId_,{eventId:GL,eventDesc:"joining room",timestamp:rv(),userId:this.userId_,tinyId:this.tinyId_}),e.next=8,this.preJoin(t);case 8:return e.abrupt("return",new Promise(function(){var e=o(n().mark((function e(o,a){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.joinReject_=a,e.prev=1,r.proxy_||r.schedule_.domains){e.next=5;break}return e.next=5,r.schedule(t.roomId);case 5:return r.checkDestroy(),e.next=8,r.initialize(t);case 8:return e.next=10,r.doJoin(t);case 10:r.signalInfo_=r.signalChannel_.getSignalInfo(),Gw.emit(Bw,{client:r}),r.joinedTimestamp_=Cw(),sO.logSuccessEvent({userId:r.userId_,eventType:iS,delta:r.joinedTimestamp_-i}),sO.logSuccessEvent({userId:r.userId_,eventType:nS}),sO.uploadEvent({log:"stat-autoplay-dialog:".concat(r.enableAutoPlayDialog_),userId:r.userId_}),sO.uploadEvent({log:"stat-conv-".concat(QD,"-").concat(location.hostname),userId:r.userId_}),o(),e.next=26;break;case 20:e.prev=20,e.t0=e.catch(1),Gw.emit(Hw,{client:r,error:e.t0}),sO.logFailedEvent({userId:r.userId_,eventType:nS,error:e.t0}),r.reset(),a(e.t0);case 26:r.joinReject_=null;case 27:case"end":return e.stop()}}),e,null,[[1,20]])})));return function(t,n){return e.apply(this,arguments)}}()));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"checkDestroy",value:function(){if(this.isDestroyed_)throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Kk,data:{funName:"join"}})})}},{key:"uploadTrtcStats",value:(L=o(n().mark((function e(){var t,i,r,o,a,s,c,u,l,d,p,h,f;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,rY.getMicrophones();case 3:r=e.sent,t=r&&r.length,e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:return e.prev=9,e.next=12,rY.getCameras();case 12:o=e.sent,i=o&&o.length,e.next=18;break;case 16:e.prev=16,e.t1=e.catch(9);case 18:a={microphone:t,camera:i},s=this.checkSystemResult_.detail,c=s.isH264EncodeSupported,u=s.isVp8EncodeSupported,l=s.isH264DecodeSupported,d=s.isVp8DecodeSupported,p={webRTC:this.basis_.isWebRTCSupported,getUserMedia:this.basis_.isGetUserMediaSupported,webSocket:this.basis_.isWebSocketsSupported,screenShare:this.basis_.isScreenShareSupported,webAudio:this.basis_.isWebAudioSupported,h264Encode:c,h264Decode:l,vp8Encode:u,vp8Decode:d},h={browser:this.basis_.browser,os:this.basis_.os,trtc:p,devices:a},f={isWebCodecSupported:this.basis_.isWebCodecSupported,isMediaSessionSupported:this.basis_.isMediaSessionSupported,isWebTransportSupported:this.basis_.isWebTransportSupported},sO.uploadEvent({log:"trtcstats-"+JSON.stringify(h),userId:this.userId_}),this.log_.info("TrtcStats-"+JSON.stringify(h)),sO.uploadEvent({log:"trtcadvancedstats-"+JSON.stringify(f),userId:this.userId_});case 26:case"end":return e.stop()}}),e,this,[[0,7],[9,16]])}))),function(){return L.apply(this,arguments)})},{key:"doJoin",value:function(e){var t=this;return new Promise((function(e,n){t.log_.info("Join() => joining room: ".concat(t.roomId_," useStringRoomId: ").concat(t.useStringRoomId_," mode: ").concat(t.mode_," role: ").concat(t.role_));var i={roomId:String(t.roomId_),useStringRoomId:t.useStringRoomId_,privateMapKey:t.privateMapKey_,trtcRole:t.role_===UC?NC:PC,trtcScene:t.mode_===OC?LC:RC,sdpSemantics:t.sdpSemantics_,version:Nw(t.version_),ua:navigator&&navigator.userAgent||"",autoSubscribe:t.autoSubscribe_,terminalType:Zb?4:$b?2:Wb?3:bD?12:kD?5:DD?13:1,netType:qS[uw()],bussinessInfo:t.bussinessInfo_};if(t.publishCDNManager_){var r=t.publishCDNManager_.handleCDNConfigForJoinData(t.bussinessInfo_),o=r.bussinessInfo,a=r.pushUserCdnInfo;Object.assign(i,{bussinessInfo:o,pushUserCdnInfo:a})}t.log_.debug("join room signal data: ".concat(JSON.stringify(i))),t.joinTimeout_=setTimeout((function(){t.log_.error("join room timeout observed"),n(new _L({code:vL.JOIN_ROOM_FAILED,message:ow({key:QE})}))}),5e3),Gw.emit(Vw,{client:t}),t.signalChannel_.once(VR,(function(e){t.clearJoinTimeout(),Gw.emit(Xw,{client:t,error:e}),n(e)})),t.signalChannel_.send(QR,i),t.signalChannel_.once(JR.JOIN_ROOM_RESULT,(function(i){t.clearJoinTimeout();var r=i.data,o=r.code,a=r.message,s=r.data;t.onPublishedUserList({data:{userList:s.publishers}}),Gw.emit(qw,{client:t,code:o}),0===o?(t.isJoined_=!0,t.log_.info("Join room success, start heartbeat"),t.startHeartbeat(),t.badCaseDetector_&&t.badCaseDetector_.start(),t.syncUserList(),t.startSyncUserListInterval(),e()):(t.log_.error("Join room failed result: "+o+" error: "+a),n(new _L({code:vL.JOIN_ROOM_FAILED,extraCode:o,message:ow({key:ek,data:{error:a,code:o}})})))}))}))}},{key:"reJoin",value:(R=o(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isJoined_){e.next=3;break}return this.log_.warn("reJoin abort"),e.abrupt("return");case 3:return this.isJoined_=!1,e.prev=4,this.log_.warn("reJoin pending: ".concat(this.joinOptions_.roomId)),this.subscriptionManager_&&this.subscriptionManager_.markAllStream(),this.signalChannel_.close(),e.next=10,this.signalChannel_.connect();case 10:return e.next=12,this.doJoin(t(t({},this.joinOptions_),{},{role:this.role_,privateMapKey:this.privateMapKey_}));case 12:this.log_.warn("reJoin success"),sO.logSuccessEvent({userId:this.userId_,eventType:rS}),this.checkConnectionsToReconnect(),this.uplinkConnection_&&!this.uplinkConnection_.getIsReconnecting()&&this.uplinkConnection_.startReconnection(),this.mixTranscodeManager_&&this.mixTranscodeManager_.reStartMixTranscode(),e.next=25;break;case 19:e.prev=19,e.t0=e.catch(4),this.log_.warn("reJoin fail "+e.t0),this.reset(),sO.logFailedEvent({userId:this.userId_,eventType:rS,error:e.t0}),this.emitter_.emit(UN.ERROR,new _L({code:vL.JOIN_ROOM_FAILED,message:ow({key:tk,data:{roomId:this.joinOptions_.roomId}})}));case 25:case"end":return e.stop()}}),e,this,[[4,19]])}))),function(){return R.apply(this,arguments)})},{key:"leave",value:(A=o(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Gw.emit(jw,{client:this}),nO(this.userId_,{eventId:FL,eventDesc:"leaving room",timestamp:rv(),userId:this.userId_,tinyId:this.tinyId_}),e.prev=2,e.next=5,this.doHeartbeat();case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:this.doLeave(),Gw.emit(zw,{client:this}),sO.logSuccessEvent({userId:this.userId_,eventType:oS}),t=Math.floor((Cw()-this.joinedTimestamp_)/1e3),sO.logSuccessEvent({userId:this.userId_,eventType:aS,delta:t});case 14:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(){return A.apply(this,arguments)})},{key:"doLeave",value:function(){this.isJoined_&&(Gw.emit(Kw,{client:this}),this.log_.info("leave() => leaving room"),this.signalChannel_.send(eL),this.reset())}},{key:"clearNetworkQuality",value:function(){this.networkQuality_&&(this.networkQuality_.stop(),this.networkQuality_=null)}},{key:"closeConnections",value:function(){var e=this;this.connections_.forEach((function(t){e.closeDownLink(t.getTinyId())}))}},{key:"clearJoinTimeout",value:function(){clearTimeout(this.joinTimeout_),this.joinTimeout_=-1}},{key:"destroy",value:function(){var e,t,n;if(this.isJoined_)throw this.log_.warn(Pb.INVALID_DESTROY),new _L({code:vL.INVALID_OPERATION,message:ow({key:nk})});this.isDestroyed_||(this.log_.info("destroy client"),this.joinReject_&&(this.joinReject_(new _L({code:vL.INVALID_OPERATION,message:ow({key:Kk,data:{funName:"join"}})})),this.clearJoinTimeout(),this.reset()),this.off("*"),null===(e=this.callDurationCalculator_)||void 0===e||e.destroy(),null===(t=this.keyPointManager_)||void 0===t||t.destroy(),null===(n=this.deviceDetector_)||void 0===n||n.destroy(),this.callDurationCalculator_=null,this.keyPointManager_=null,this.deviceDetector_=null,this.badCaseDetector_=null,this.publishCDNManager_=null,this.isDestroyed_=!0,Gw.emit(Qw,{client:this}))}},{key:"reset",value:function(){this.isJoined_=!1,this.keyPointManager_&&this.keyPointManager_.prepareReport(),this.mixTranscodeManager_&&(this.mixTranscodeManager_.reset(),this.mixTranscodeManager_=null),this.publishCDNManager_&&this.publishCDNManager_.reset(),this.userMap_.clear(),this.stopSyncUserListInterval(),this.stopHeartbeat(),this.closeConnections(),this.mutedStates_.clear(),this.clearNetworkQuality(),this.badCaseDetector_&&this.callDurationCalculator_&&this.uploadAllCallStats(),this.closeUplink(),this.signalChannel_&&(this.log_.info("destroying SignalChannel"),this.signalChannel_.close(),this.signalChannel_=null),this.stats_.reset()}},{key:"startSyncUserListInterval",value:function(){-1===this.syncUserListInterval_&&(this.syncUserListInterval_=QO.run(_E,this.syncUserList.bind(this)))}},{key:"stopSyncUserListInterval",value:function(){QO.clearTask(this.syncUserListInterval_),this.syncUserListInterval_=-1}},{key:"syncUserList",value:(w=o(n().mark((function e(){var t,i=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getUserList();case 3:t=e.sent,0!==this.userMap_.size&&this.userMap_.forEach((function(e){t.findIndex((function(t){return t.userId===e.userId}))<0&&(i.log_.info("peer leave detected: ".concat(e.userId)),i.cleanUser({userId:e.userId,tinyId:e.tinyId}))})),t.forEach((function(e){var t=e.userId;i.userMap_.has(t)||t===i.userId_||(i.userMap_.set(t,e),i.emitter_.emit(UN.PEER_JOIN,{userId:t}))})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.log_.warn("sync user list failed: "+e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return w.apply(this,arguments)})},{key:"getUserList",value:function(){return this.signalChannel_?this.signalChannel_.sendWaitForResponse({command:fL,responseCommand:JR.USER_LIST_RES,enableLog:!1,timeout:2e3}).then((function(e){var t=e.data,n=t.code,i=t.message;if(0===n)return(t.data&&t.data.userList||[]).map((function(e){var t=e.userId,n=e.srcTinyId,i=e.role;return new aW({userId:t,tinyId:n,role:i})}));throw ow({key:Ib,data:{signalResponse:JR.USER_LIST_RES,code:n,message:i}})})):[]}},{key:"publish",value:(D=o(n().mark((function e(t){var i,r,o,a,s,c,u,l,d=this,p=arguments;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=p.length>1&&void 0!==p[1]?p[1]:{isAuxiliary:!1},t.setPublishState(HS),this.isPublishing_=!0,r=Cw(),Gw.emit($w,{client:this,stream:t}),o=i.isAuxiliary,a=o?BT:rC,s=t.getScreen(),this.log_.info("publish() => publishing ".concat(s?FT+" ":"").concat(a," stream ").concat(t.getId())),c=this.uplinkConnection_,e.prev=10,c||((c=new tz({userId:this.userId_,tinyId:this.tinyId_,client:this,isUplink:!0,signalChannel:this.signalChannel_,enableSEI:this.enableSEI_})).initialize(),c.on(PN.ERROR,(function(e){var t=e.getCode();t!==vL.ICE_TRANSPORT_ERROR&&(t===vL.UPLINK_RECONNECTION_FAILED&&d.closeUplink(),d.emitter_.emit(UN.ERROR,e))}))),t.setConnection(c),e.next=15,c.publish(t,o);case 15:this.log_.info("local ".concat(s?FT+" ":"").concat(a," stream is published")),this.isPublishing_=!1,o?this.localAuxStream_=t:(this.localStream_=t,this.deviceDetector_&&this.deviceDetector_.setLocalStream(this.localStream_),this.localStream_.getBeautyStatus()&&this.log_.info("beauty stream is published successfully")),t.setPublishState(jS),t.setClient(this,o),this.uplinkConnection_=c,u=Cw(),l=u-r,sO.logSuccessEvent({userId:this.userId_,eventType:sS}),sO.logSuccessEvent({userId:this.userId_,eventType:cS,delta:l}),t.hasAudio()&&nO(this.userId_,{eventId:IL,eventDesc:"publish audio track",timestamp:rv(),userId:this.userId_,tinyId:this.tinyId_}),t.hasVideo()&&nO(this.userId_,{eventId:yL,eventDesc:"publish video track",timestamp:rv(),userId:this.userId_,tinyId:this.tinyId_}),this.networkQuality_&&this.networkQuality_.setUplinkConnection(this.uplinkConnection_),Gw.emit(hA,{localStream:t,isAuxiliary:o,client:this}),this.notPublishWithoutH264Supported_=!1,e.next=41;break;case 32:throw e.prev=32,e.t0=e.catch(10),e.t0 instanceof _L&&e.t0.getCode()===vL.NOT_SUPPORTED_H264&&(this.notPublishWithoutH264Supported_=!0),t.setPublishState(BS),c.close(),this.log_.error("failed to publish stream "+e.t0),this.isPublishing_=!1,sO.logFailedEvent({userId:this.userId_,eventType:sS,error:e.t0}),e.t0;case 41:case"end":return e.stop()}}),e,this,[[10,32]])}))),function(e){return D.apply(this,arguments)})},{key:"unpublish",value:(b=o(n().mark((function e(t){var i,r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.uplinkConnection_){e.next=2;break}return e.abrupt("return");case 2:return i=t===this.localAuxStream_,r=t.getScreen(),this.log_.info("unpublish() => unpublishing local ".concat(r?FT+" ":"").concat(i?BT:rC," stream")),e.prev=5,e.next=8,this.uplinkConnection_.unpublish(t);case 8:t.setClient(null),t.setConnection(null),i?this.localAuxStream_=null:(this.localStream_=null,t.hasAudio()&&nO(this.userId_,{eventId:TL,eventDesc:"unpublish audio track",timestamp:rv(),userId:this.userId_,tinyId:this.tinyId_}),t.hasVideo()&&nO(this.userId_,{eventId:ML,eventDesc:"unpublish video track",timestamp:rv(),userId:this.userId_,tinyId:this.tinyId_})),this.localStream_||this.localAuxStream_||this.closeUplink(),sO.logSuccessEvent({userId:this.userId_,eventType:uS}),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(5),sO.logFailedEvent({userId:this.userId_,eventType:uS,error:e.t0}),e.t0;case 19:case"end":return e.stop()}}),e,this,[[5,15]])}))),function(e){return b.apply(this,arguments)})},{key:"closeUplink",value:function(){this.uplinkConnection_&&(this.uplinkConnection_.close(),this.uplinkConnection_=null,this.networkQuality_&&this.networkQuality_.setUplinkConnection(null),this.localStream_&&(this.localStream_.setClient(null),this.localStream_.setConnection(null),this.localStream_=null),this.localAuxStream_&&(this.localAuxStream_.setClient(null),this.localAuxStream_.setConnection(null),this.localAuxStream_=null),this.deviceDetector_&&this.deviceDetector_.setLocalStream(null))}},{key:"closeDownLink",value:function(e){var t=this.connections_.get(e);t&&(t.getIsReconnecting()&&t.stopReconnection(),this.subscriptionManager_&&this.subscriptionManager_.delete(t.getUserId()),t.close(),this.connections_.delete(e),this.mutedStates_.delete(e))}},{key:"subscribe",value:(k=o(n().mark((function e(t,i){var r,o,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log_.info("subscribe() => subscribe to [".concat(t.getUserId(),"] ").concat(t.getType()," stream with options: ").concat(JSON.stringify(i))),fw(i)&&(i={audio:!0,video:!0}),fw(i.audio)&&(i.audio=!0),fw(i.smallVideo)?fw(i.video)&&(i.video=!0):i.smallVideo?fw(i.video)?(i.video=!1,i.smallVideo=!0):i.video&&(i.video=!0,delete i.smallVideo,this.log_.warn("options.video and options.smallVideo can't be both true")):fw(i.video)&&(i.video=!0,delete i.smallVideo),i.video&&this.changeBigSmallRecords_.delete(t.getUserId()),r=t.getConnection(),i.smallVideo&&(r.getTrackState().smallVideo||(this.setRemoteVideoStreamType(t,"small"),i.video=!0,delete i.smallVideo)),e.prev=7,Gw.emit(cA,{client:this,stream:t}),e.next=11,r.subscribe(t,i);case 11:this.subscriptionManager_&&this.subscriptionManager_.addSubscriptionRecord(t.getUserId(),t,i),this.notSubscribeWithoutH264Supported_=!1,sO.logSuccessEvent({userId:this.userId_,eventType:lS}),e.next=24;break;case 16:throw e.prev=16,e.t0=e.catch(7),(o=e.t0 instanceof _L?e.t0.getCode():vL.UNKNOWN)===vL.NOT_SUPPORTED_H264&&(this.notSubscribeWithoutH264Supported_=!0),(a=new _L(o===vL.REMOTE_STREAM_NOT_EXIST?{code:vL.API_CALL_ABORTED,message:ow({key:Ob,data:{message:e.t0.message,stream:t}})}:{code:o,message:ow({key:uk,data:{message:e.t0.message,stream:t}})})).getCode()===vL.API_CALL_ABORTED?this.log_.warn(a):this.log_.error(a),sO.logFailedEvent({userId:this.userId_,eventType:lS,error:a}),a;case 24:case"end":return e.stop()}}),e,this,[[7,16]])}))),function(e,t){return k.apply(this,arguments)})},{key:"unsubscribe",value:(S=o(n().mark((function e(t){var i;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log_.info("unsubscribe() => unsubscribe to [".concat(t.getUserId(),"] ").concat(t.getType()," stream")),e.prev=1,i=t.getConnection(),e.next=5,i.unsubscribe(t);case 5:this.subscriptionManager_&&this.subscriptionManager_.addUnsubscriptionRecord(t.getUserId(),t),Gw.emit(lA,{client:this,stream:t}),sO.logSuccessEvent({userId:this.userId_,eventType:dS}),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(1),sO.logFailedEvent({userId:this.userId_,eventType:dS,error:e.t0}),e.t0;case 14:case"end":return e.stop()}}),e,this,[[1,10]])}))),function(e){return S.apply(this,arguments)})},{key:"switchRole",value:(C=o(n().mark((function e(t){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.role_!==t){e.next=2;break}return e.abrupt("return");case 2:return t===xC&&this.uplinkConnection_&&this.closeUplink(),this.log_.info("switchRole() => switch role to: "+t),e.next=6,this.doSwitchRole(t);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"doSwitchRole",value:function(e){var t,n,i=this,r={command:gL,data:{role:e===UC?NC:PC,privateMapKey:this.privateMapKey_},responseCommand:JR.SWITCH_ROLE_RES,retries:(null===(t=this.schedule_.config)||void 0===t||null===(n=t.retries)||void 0===n?void 0:n.switchRole)||1};return this.log_.info("switchRole signal data: "+JSON.stringify(r.data)),this.signalChannel_.sendWaitForResponseWithRetry(r).then((function(t){var n=t.data,r=n.code,o=n.message;if(0!==r)throw new _L({code:vL.SWITCH_ROLE_FAILED,message:ow({key:hk,data:{errMsg:o,errCode:r}})});i.role_=e})).catch((function(e){throw e instanceof _L&&e.getCode()===vL.API_CALL_TIMEOUT&&(e=new _L({code:vL.SWITCH_ROLE_FAILED,message:ow({key:pk})})),i.log_.error(e),e}))}},{key:"on",value:function(e,t,n){this.emitter_.on(e,t,n)}},{key:"off",value:function(e,t,n){"*"===e?this.emitter_.removeAllListeners():this.emitter_.off(e,t,n)}},{key:"getRemoteMutedState",value:function(){var e=this,n=[];return this.mutedStates_.forEach((function(i,r,o){var a=e.connections_.get(r);a&&n.push(t({userId:a.getUserId()},i))})),n}},{key:"getTransportStats",value:(T=o(n().mark((function e(){var t,i,r,o,a,s,c;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={rtt:0,downlinksRTT:{}},!this.uplinkConnection_){e.next=6;break}return e.next=4,this.stats_.getSenderStats(this.uplinkConnection_);case 4:i=e.sent,t.rtt=i.rtt;case 6:r=E(this.connections_),e.prev=7,r.s();case 9:if((o=r.n()).done){e.next=17;break}return(a=I(o.value,2))[0],s=a[1],e.next=13,this.stats_.getReceiverStats(s);case 13:c=e.sent,t.downlinksRTT[c.userId]=c.rtt;case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(7),r.e(e.t0);case 22:return e.prev=22,r.f(),e.finish(22);case 25:return e.abrupt("return",t);case 26:case"end":return e.stop()}}),e,this,[[7,19,22,25]])}))),function(){return T.apply(this,arguments)})},{key:"getLocalAudioStats",value:(y=o(n().mark((function e(){var t,i;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t={})[this.userId_]={bytesSent:0,packetsSent:0},!this.uplinkConnection_){e.next=7;break}return e.next=5,this.stats_.getSenderStats(this.uplinkConnection_);case 5:i=e.sent,t[this.userId_]={bytesSent:i.audio.bytesSent,packetsSent:i.audio.packetsSent};case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"getLocalVideoStats",value:(_=o(n().mark((function e(){var t,i;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t={})[this.userId_]={bytesSent:0,packetsSent:0,framesEncoded:0,framesSent:0,frameWidth:0,frameHeight:0},!this.uplinkConnection_){e.next=7;break}return e.next=5,this.stats_.getSenderStats(this.uplinkConnection_);case 5:i=e.sent,t[this.userId_]={bytesSent:i.video.bytesSent,packetsSent:i.video.packetsSent,framesEncoded:i.video.framesEncoded,framesSent:i.video.framesSent,frameWidth:i.video.frameWidth,frameHeight:i.video.frameHeight};case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"getRemoteAudioStats",value:(v=o(n().mark((function e(){var t,i,r,o,a,s,c,u;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={},i=E(this.connections_),e.prev=2,i.s();case 4:if((r=i.n()).done){e.next=13;break}return(o=I(r.value,2))[0],a=o[1],s=a.getDelay(),c=s.audioDelay,e.next=9,this.stats_.getReceiverStats(a);case 9:(u=e.sent).hasAudio&&(t[u.userId]={bytesReceived:u.audio.bytesReceived,packetsReceived:u.audio.packetsReceived,packetsLost:u.audio.packetsLost,end2EndDelay:c});case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),i.e(e.t0);case 18:return e.prev=18,i.f(),e.finish(18);case 21:return e.abrupt("return",t);case 22:case"end":return e.stop()}}),e,this,[[2,15,18,21]])}))),function(){return v.apply(this,arguments)})},{key:"getRemoteVideoStats",value:(m=o(n().mark((function e(){var t,i,r,o,a,s,c,u,l,d=arguments;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=d.length>0&&void 0!==d[0]?d[0]:qC,i={},r=E(this.connections_),e.prev=3,r.s();case 5:if((o=r.n()).done){e.next=15;break}return(a=I(o.value,2))[0],s=a[1],e.next=9,this.stats_.getReceiverStats(s);case 9:c=e.sent,u=s.getDelay(),l=u.videoDelay,t===qC&&c.hasVideo&&(i[c.userId]={bytesReceived:c.video.bytesReceived,packetsReceived:c.video.packetsReceived,packetsLost:c.video.packetsLost,framesDecoded:c.video.framesDecoded,frameWidth:c.video.frameWidth,frameHeight:c.video.frameHeight,end2EndDelay:l}),t===BC&&c.hasAuxiliary&&(i[c.userId]={bytesReceived:c.auxiliary.bytesReceived,packetsReceived:c.auxiliary.packetsReceived,packetsLost:c.auxiliary.packetsLost,framesDecoded:c.auxiliary.framesDecoded,frameWidth:c.auxiliary.frameWidth,frameHeight:c.auxiliary.frameHeight,end2EndDelay:l});case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return e.abrupt("return",i);case 24:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(){return m.apply(this,arguments)})},{key:"getSdpSemantics",value:function(){return this.sdpSemantics_}},{key:"getIceServers",value:function(){return 0===this.turnServers_.length&&this.schedule_.iceServers?this.schedule_.iceServers:this.turnServers_}},{key:"getConnections",value:function(){return this.connections_}},{key:"getMutedStates",value:function(){return this.mutedStates_}},{key:"startHeartbeat",value:function(){-1===this.heartbeat_&&(this.log_.info("startHeartbeat..."),this.heartbeat_=QO.run(_E,this.doHeartbeat.bind(this),{delay:2e3}))}},{key:"stopHeartbeat",value:function(){-1!==this.heartbeat_&&(this.log_.info("stopHeartbeat"),QO.clearTask(this.heartbeat_),this.heartbeat_=-1,this.lastHeartBeatTime_=-1)}},{key:"doHeartbeat",value:(g=o(n().mark((function e(){var i,r,o,a,s,c;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.badCaseDetector_.getMonitorFreeze(),e.next=3,this.stats_.getStatsReport({uplinkConnection:this.uplinkConnection_,downlinkConnections:this.connections_,freezeMap:r});case 3:if(o=e.sent,Gw.emit(Ww,{client:this,stats:o}),null===(i=this.badCaseDetector_)||void 0===i||i.resetMonitor(),this.signalChannel_){e.next=8;break}return e.abrupt("return");case 8:a=this.signalChannel_.isConnected()?iO(this.userId_):[],s=t(t({str_sdk_version:this.version_,uint64_datetime:(new Date).getTime(),msg_user_info:{str_identifier:this.userId_,uint64_tinyid:this.tinyId_},msg_device_info:{uint32_terminal_type:15,str_device_name:navigator.platform,str_os_version:"",uint32_net_type:qS[this.networkType_]}},o),{},{msg_event_msg:a}),this.signalChannel_.send(tL,s),c=Date.now(),this.lastHeartBeatTime_>0&&c-this.lastHeartBeatTime_>1e4&&this.log_.warn("heartbeat took ".concat(c-this.lastHeartBeatTime_)),this.lastHeartBeatTime_=c,!this.isRelayChanged_&&this.isRelayMaybeFailed()&&(this.reJoin(),this.isRelayChanged_=!0);case 15:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"onRemoteStreamAdded",value:function(e){var t=e.content,n=t.userId,i=t.tinyId,r=t.audio,o=t.bigVideo,a=t.auxVideo,s=t.smallVideo;if(null!==n){this.userMap_.has(n)||(this.userMap_.set(n,new aW({userId:n,tinyId:i,role:UC})),this.emitter_.emit(UN.PEER_JOIN,{userId:n}));var c=this.connections_.get(i);if(c){if(c.getIsReconnecting())return;this.log_.warn("duplicated stream-added observed, rebuild the connection"),c.close(),this.connections_.delete(i)}var u={audio:r,video:o,auxiliary:a,smallVideo:s};this.log_.info("remote peer [".concat(n,"] published stream. trackState: ").concat(JSON.stringify(u))),this.createDownlinkConnection({userId:n,tinyId:i,trackState:u})}else this.log_.warn("received null userId on stream added")}},{key:"createDownlinkConnection",value:function(e){var t=this,n=e.userId,i=e.tinyId,r=e.trackState,o=new iW({userId:n,tinyId:i,client:this,isUplink:!1,signalChannel:this.signalChannel_,autoSubscribe:this.autoSubscribe_,trackState:r,enableSEI:this.enableSEI_});this.connections_.set(i,o),this.installDownlinkEvents(o,n,i),this.autoSubscribe_?(o.initialize(),o.connect().catch((function(){!o.getMainStream()&&o.hasMainStream()&&t.initRemoteStream({type:qC,userId:n,downlinkConnection:o}),!o.getAuxStream()&&o.hasAuxStream()&&t.initRemoteStream({type:BC,userId:n,downlinkConnection:o})}))):(o.hasMainStream()&&this.initRemoteStream({type:qC,userId:n,downlinkConnection:o}),o.hasAuxStream()&&this.initRemoteStream({type:BC,userId:n,downlinkConnection:o}))}},{key:"initRemoteStream",value:function(e){var t=e.type,n=e.userId,i=e.downlinkConnection,r=new kK({type:t,userId:n,client:this});r.setConnection(i),i.setRemoteStream(t===qC?GC:FC,r),r.setIsStreamAddedEventEmitted(!0),Gw.emit(sA,{client:this,stream:r}),this.emitter_.emit(UN.STREAM_ADDED,{stream:r})}},{key:"installDownlinkEvents",value:function(e,t,n){var i=this;e.on(PN.SEI_MESSAGE,(function(e){i.emitter_.emit(UN.SEI_MESSAGE,e)})),e.on(PN.STREAM_ADDED,(function(e){e.stream.setIsStreamAddedEventEmitted(!0),Gw.emit(sA,{client:i,stream:e.stream}),i.emitter_.emit(UN.STREAM_ADDED,{stream:e.stream})})),e.on(PN.STREAM_REMOVED,(function(e){i.changeBigSmallRecords_.delete(e.stream.getUserId()),e.stream.stop(),e.stream.setIsStreamAddedEventEmitted(!1),i.subscriptionManager_&&i.subscriptionManager_.deleteAutoRecoveryFlag(e.stream.getUserId(),e.stream.getType()),Gw.emit(pA,{client:i,stream:e.stream}),i.emitter_.emit(UN.STREAM_REMOVED,{stream:e.stream})})),e.on(PN.STREAM_UPDATED,(function(e){Gw.emit(dA,{client:i,stream:e.stream}),i.emitter_.emit(UN.STREAM_UPDATED,{stream:e.stream})})),e.on(PN.STREAM_SUBSCRIBED,(function(e){Gw.emit(uA,{client:i,stream:e.stream}),i.emitter_.emit(UN.STREAM_SUBSCRIBED,{stream:e.stream})})),e.on(PN.ERROR,(function(e){var t=e.getCode();t!==vL.ICE_TRANSPORT_ERROR&&(t===vL.DOWNLINK_RECONNECTION_FAILED&&i.closeDownLink(n),i.emitter_.emit(UN.ERROR,e))}))}},{key:"onPeerJoin",value:function(e){var t=e.data.data,n=t.srcTinyId,i=t.userId,r=t.role;this.userMap_.has(i)||(this.userMap_.set(i,new aW({userId:i,tinyId:n,role:r})),this.emitter_.emit(UN.PEER_JOIN,{userId:i}))}},{key:"onPeerLeave",value:function(e){var t=e.data.data,n=t.srcTinyId,i=t.userId,r=t.reason,o=void 0===r?0:r;this.log_.info("peer leave [".concat(i,"]: ").concat(mE[o])),this.cleanUser({userId:i,tinyId:n})}},{key:"cleanUser",value:function(e){var t=e.userId,n=e.tinyId;this.userMap_.delete(t),this.closeDownLink(n),this.emitter_.emit(UN.PEER_LEAVE,{userId:t})}},{key:"onPublishedUserList",value:function(e){var t=this;try{var n=e.data.userList.map((function(e){return e.userId}));this.connections_.forEach((function(e){var i=e.getUserId(),r=e.getTinyId();n.findIndex((function(e){return e===i}))<0&&(t.log_.info("peer unpublished detected [".concat(i,"]")),t.closeDownLink(r))})),e.data.userList.forEach((function(e){var n=e.userId,i=e.srcTinyId,r=e.flag;if(n!==t.userId_){var o=!!(1&r),a=!!(8&r),s=!!(4&r),c=!!(2&r),u=t.connections_.get(i);if((c||o)&&t.checkSubscribeBigSmallVideo(u,c),u){var l=u.getTrackState(),d=l.audio,p=l.video,h=l.auxiliary,f=l.smallVideo;!p&&o&&Gw.emit(aA,{client:t,tinyId:i,userId:n,action:VS.ADD,kind:GT}),!d&&a&&Gw.emit(aA,{client:t,tinyId:i,userId:n,action:VS.ADD,kind:xT}),!h&&s&&Gw.emit(aA,{client:t,tinyId:i,userId:n,action:VS.ADD,kind:BT}),!f&&c&&Gw.emit(aA,{client:t,tinyId:i,userId:n,action:VS.ADD,kind:jT}),p&&!o&&Gw.emit(aA,{client:t,tinyId:i,userId:n,action:VS.REMOVE,kind:GT}),d&&!a&&Gw.emit(aA,{client:t,tinyId:i,userId:n,action:VS.REMOVE,kind:xT}),h&&!s&&Gw.emit(aA,{client:t,tinyId:i,userId:n,action:VS.REMOVE,kind:BT}),f&&!c&&Gw.emit(aA,{client:t,tinyId:i,userId:n,action:VS.REMOVE,kind:jT})}else t.log_.info("peer published detected [".concat(n,"]")),t.onRemoteStreamAdded({content:{audio:a,bigVideo:o,auxVideo:s,smallVideo:c,userId:n,tinyId:i}})}}))}catch(oY){}}},{key:"onUpdateRemoteMuteStat",value:function(e){var t=this,n=e.data;(n&&n.userList||[]).forEach((function(e){var n=e.srcTinyId,i=e.userId;if(0!==n&&n!==t.tinyId_){var r=t.connections_.get(n);if(r){var o=r.getMainStream();if(o&&o.getIsStreamAddedEventEmitted()){var a=!!(1&e.flag),s=!!(8&e.flag),c=!!(2&e.flag),u=!!(64&e.flag),l=!!(16&e.flag),d=t.mutedStates_.get(n);if(void 0===d)return t.mutedStates_.set(n,{hasAudio:s,hasVideo:a,hasSmall:c,audioMuted:u,videoMuted:l}),a?l?t.emitter_.emit(UN.MUTE_VIDEO,{userId:i}):t.emitter_.emit(UN.UNMUTE_VIDEO,{userId:i}):t.emitter_.emit(UN.MUTE_VIDEO,{userId:i}),void(s?u?t.emitter_.emit(UN.MUTE_AUDIO,{userId:i}):t.emitter_.emit(UN.UNMUTE_AUDIO,{userId:i}):t.emitter_.emit(UN.MUTE_AUDIO,{userId:i}));var p=!d.audioMuted&&d.hasAudio,h=!u&&s,f=!d.videoMuted&&d.hasVideo,g=!l&&a;t.mutedStates_.set(n,{hasAudio:s,hasVideo:a,hasSmall:c,audioMuted:u,videoMuted:l}),p!==h&&(h?t.emitter_.emit(UN.UNMUTE_AUDIO,{userId:i}):t.emitter_.emit(UN.MUTE_AUDIO,{userId:i})),f!==g&&(g?t.emitter_.emit(UN.UNMUTE_VIDEO,{userId:i}):t.emitter_.emit(UN.MUTE_VIDEO,{userId:i}))}}else t.mutedStates_.delete(n)}}))}},{key:"getEnv",value:function(){return this.env_}},{key:"getSubscriptionManager",value:function(){return this.subscriptionManager_}},{key:"startPublishCDNStream",value:(f=o(n().mark((function e(){var t,i=arguments;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},this.log_.info("startPublishCDNStream with params: ".concat(JSON.stringify(t),"; isJoined: ").concat(this.isJoined_,"; hasMainStream: ").concat(!!this.localStream_,"; hasAuxStream: ").concat(!!this.localAuxStream_,";")),t.streamType=t.streamType||rC,t.streamType===BT&&(t.streamType=HT),t.streamId=t.streamId||"",!this.isJoined_){e.next=10;break}if(t.streamType!==rC||this.localStream_){e.next=8;break}throw new _L({code:vL.INVALID_OPERATION,message:ow({key:gk})});case 8:if(t.streamType!==HT||this.localAuxStream_){e.next=10;break}throw new _L({code:vL.INVALID_OPERATION,message:ow({key:gk})});case 10:return e.next=12,this.publishCDNManager_.startPublishTencentCDN(t);case 12:if(!(t.appId&&t.bizId&&t.url)){e.next=15;break}return e.next=15,this.publishCDNManager_.startPublishGivenCDN(t);case 15:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"stopPublishCDNStream",value:(h=o(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.publishCDNManager_.getIsPublishingTencentCDN()){e.next=2;break}throw new _L({code:vL.INVALID_OPERATION,message:ow({key:mk})});case 2:return this.log_.info("stopPublishCDNStream"),e.next=5,this.publishCDNManager_.stopPublishTencentCDN();case 5:if(!this.publishCDNManager_.getIsPublishingGivenCDN()){e.next=8;break}return e.next=8,this.publishCDNManager_.stopPublishGivenCDN();case 8:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"startMixTranscode",value:(p=o(n().mark((function e(t){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isJoined_&&this.mixTranscodeManager_){e.next=2;break}throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Ik})});case 2:return fw(t.mode)&&(t.mode=LS.MANUAL),e.prev=3,this.log_.info("startMixTranscode with config ".concat(JSON.stringify(t))),sO.uploadEvent({log:"mix-transcode-mode:".concat(t.mode),userId:this.userId_}),e.next=8,this.mixTranscodeManager_.startMixTranscode(t);case 8:sO.logSuccessEvent({userId:this.userId_,eventType:SS}),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(3),sO.logFailedEvent({userId:this.userId_,eventType:SS,error:e.t0}),e.t0;case 15:case"end":return e.stop()}}),e,this,[[3,11]])}))),function(e){return p.apply(this,arguments)})},{key:"stopMixTranscode",value:(d=o(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isJoined_&&this.mixTranscodeManager_){e.next=2;break}throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Mk})});case 2:return e.prev=2,e.next=5,this.mixTranscodeManager_.stopMixTranscode();case 5:sO.logSuccessEvent({userId:this.userId_,eventType:ES}),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(2),sO.logFailedEvent({userId:this.userId_,eventType:ES,error:e.t0}),e.t0;case 12:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(){return d.apply(this,arguments)})},{key:"getSystemResult",value:function(){return this.checkSystemResult_}},{key:"enableAudioVolumeEvaluation",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!mw(t))throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:Tk})});if(this.log_.info("enableAudioVolumeEvaluation with interval: "+t),t<=0)return this.enableAudioVolumeEvaluation_=!1,QO.clearTask(this.audioVolumeIntervalId_),void(this.audioVolumeIntervalId_=null);t=Math.floor(Math.max(t,16)),Gw.emit(tA,{interval:t}),this.audioVolumeIntervalId_&&(QO.clearTask(this.audioVolumeIntervalId_),this.audioVolumeIntervalId_=null),this.enableAudioVolumeEvaluation_=!0,this.audioVolumeIntervalId_=QO.run(yE,(function(){var t=[];if(e.localStream_){var n=Math.floor(100*e.localStream_.getAudioLevel());t.push({userId:e.userId_,audioVolume:n,stream:e.localStream_})}e.connections_.forEach((function(e){var n=e.getSubscribedMainStream();if(n){var i=Math.floor(100*n.getAudioLevel());t.push({userId:e.getUserId(),audioVolume:i,stream:n})}})),e.emitter_.emit(UN.AUDIO_VOLUME,{result:t})}),{fps:1e3/t,backgroundTask:n})}},{key:"callExperimentalAPI",value:function(e,n){return QW.call(e,t({client:this},n))}},{key:"setProperty",value:function(e,t){var n="".concat(e,"_");fw(this[n])||(this[n]=t)}},{key:"uploadAllCallStats",value:function(){var e=this;this.callDurationCalculator_.getDurationMap().forEach((function(t,n){var i={userId:t.userId,type:t.type,duration:e.callDurationCalculator_.getDuration(n,GT),dataFreeze:e.badCaseDetector_.getDataFreezeDuration(n).dataFreeze,renderFreeze:e.badCaseDetector_.getRenderFreezeDuration(n).renderFreeze};sO.uploadEvent({log:"callStats-"+JSON.stringify(i),userId:e.userId_})})),this.badCaseDetector_.stop(),this.callDurationCalculator_.reset()}},{key:"enableSmallStream",value:(l=o(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPublished()&&!this.isPublishing_){e.next=2;break}throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Ck})});case 2:if(!RN()){e.next=7;break}this.setIsEnableSmallStream(!0),this.log_.info("SmallStream successfully enabled"),e.next=8;break;case 7:throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Ek})});case 8:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"disableSmallStream",value:(u=o(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPublished()&&!this.isPublishing_){e.next=2;break}throw new _L({code:vL.INVALID_OPERATION,message:ow({key:Sk})});case 2:this.setIsEnableSmallStream(!1),this.log_.info("SmallStream successfully disabled");case 4:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"setSmallStreamProfile",value:function(e){var t=this;e&&e.framerate&&(e.frameRate=e.framerate),e.width*e.height>307200&&(e.width=320,e.height=240,this.log_.info("Small stream resolution is beyond limitation, which is invalid. Reset to 320 * 240")),Object.keys(this.smallStreamConfig_).forEach((function(n){e[n]&&(t.smallStreamConfig_[n]=e[n])}));var n=this.smallStreamConfig_,i=n.width,r=n.height,o=n.bitrate,a=n.frameRate;if(this.log_.info("setSmallStreamProfile: bitrate=".concat(o,", frameRate=").concat(a,", height=").concat(r,", width=").concat(i)),i<0||r<0||o<0||a<0)throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:kk})})}},{key:"setRemoteVideoStreamType",value:(s=o(n().mark((function e(t,i){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof kK){e.next=2;break}throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:bk})});case 2:if(t.getConnection()){e.next=4;break}throw new _L({code:vL.INVALID_OPERATION,message:ow({key:ck})});case 4:if(t.getType()!==BC){e.next=6;break}return e.abrupt("return");case 6:e.t0=i,e.next=e.t0===KS||e.t0===zS?9:12;break;case 9:return e.next=11,this.changeVideoType(t,i);case 11:case 12:return e.abrupt("break",13);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"changeVideoType",value:(r=o(n().mark((function e(t,i){var r,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.getUserId(),o={stream:t,options:{video:i===KS,smallVideo:i===zS},isSubscribing:!1,reSubscribeCount:10},this.changeBigSmallRecords_.set(r,o),this.log_.info("set [".concat(r,"] ").concat(t.getType()," stream video prefer type: ").concat(i));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"checkSubscribeBigSmallVideo",value:(i=o(n().mark((function e(t,i){var r,o,a,s,c,u,l,d,p,h,f;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.isBigStreamSubscribed||null!=t&&t.isSmallStreamSubscribed){e.next=2;break}return e.abrupt("return");case 2:if(r=t.getUserId(),this.changeBigSmallRecords_.has(r)){e.next=5;break}return e.abrupt("return");case 5:if(o=this.changeBigSmallRecords_.get(r),a=t.getSubscribeState(),s=a.video,c=a.smallVideo,u=o.stream,l=o.options,d=o.isSubscribing,p=o.reSubscribeCount,!(l.video&&s||l.smallVideo&&c&&i)){e.next=10;break}return e.abrupt("return");case 10:if(h={video:l.video,smallVideo:l.smallVideo},!(i&&t.isBigStreamSubscribed||t.isSmallStreamSubscribed)){e.next=31;break}if(e.prev=12,!(l&&u&&!d&&p>=1)){e.next=24;break}return o.isSubscribing=!0,o.reSubscribeCount=p-1,f=u.getConnection(),!i&&f.isSmallStreamSubscribed&&(h={video:!0,smallVideo:!1}),h.emitEvent=!1,e.next=21,null==f?void 0:f.subscribe(u,h);case 21:this.log_.info("change [".concat(r,"] to ").concat(h.smallVideo?"small":"big"," video successfully. count ").concat(10-o.reSubscribeCount,".")),o.isSubscribing=!1,o.reSubscribeCount=10;case 24:e.next=31;break;case 26:e.prev=26,e.t0=e.catch(12),this.log_.info("change [".concat(r,"] to ").concat(h.smallVideo?"small":"big"," video failed. count ").concat(10-o.reSubscribeCount,".")),o.isSubscribing=!1,0===p&&this.changeBigSmallRecords_.delete(r);case 31:case"end":return e.stop()}}),e,this,[[12,26]])}))),function(e,t){return i.apply(this,arguments)})},{key:"setIsEnableSmallStream",value:function(e){this.isEnableSmallStream_=e}},{key:"getIsEnableSmallStream",value:function(){return this.isEnableSmallStream_}},{key:"smallStreamConfig",get:function(){return this.smallStreamConfig_}},{key:"isPublished",value:function(){return!!this.localStream_}},{key:"getUplinkConnection",value:function(){return this.uplinkConnection_}},{key:"getLocalStream",value:function(){return this.localStream_}},{key:"getMode",value:function(){return this.mode_}},{key:"getBadCaseDetector",value:function(){return this.badCaseDetector_}},{key:"getCallDurationCalculator",value:function(){return this.callDurationCalculator_}},{key:"getIsJoined",value:function(){return this.isJoined_}},{key:"getAllConnections",value:function(){var e=M(this.connections_.values());return this.uplinkConnection_&&e.push(this.uplinkConnection_),e}},{key:"isRelayMaybeFailed",value:function(){if(!this.signalChannel_.isOnline)return!1;var e=this.getAllConnections();if(0===e.length)return!1;for(var t=0;t<e.length;t++)if(e[t].getReconnectionCount()<6)return!1;return!0}},{key:"getUseStringRoomId",value:function(){return this.useStringRoomId_}},{key:"checkConnectionsToReconnect",value:function(){var e=this;this.getAllConnections().forEach((function(t){if(!t.getIsReconnecting()){var n=t.getPeerConnection();n&&n.connectionState===XC&&(e.log_.warn("[".concat(t.getUserId(),"] pc is closed but not reconnect")),t.startReconnection())}}))}},{key:"getEnableAutoPlayDialog",value:function(){return this.enableAutoPlayDialog_}},{key:"sendSEIMessage",value:function(e,t){this.uplinkConnection_.sendSEI(e,t)}},{key:"setProxyServer",value:function(e){if(this.log_.info("set proxy server: ".concat(JSON.stringify(e))),gw(e)){if(!e.startsWith("wss://"))throw new _L({code:vL.INVALID_PARAMETER,message:ow({key:$E})});this.proxy_=e}else if(lw(e)){var t=e.websocketProxy,n=e.loggerProxy,i=e.scheduleProxy;t&&(this.proxy_=t),n&&AC(n),i&&QS(i)}}},{key:"setTurnServer",value:function(e){this.log_.info("set turn server: "+JSON.stringify(e));var t=[];Array.isArray(e)?e.forEach((function(e){return t.push(Tw(e))})):lw(e)&&t.push(Tw(e)),this.turnServers_=t}},{key:"get2k4kFlag",value:function(){var e,t;return null===(e=this.schedule_)||void 0===e||null===(t=e.trtcCapability)||void 0===t?void 0:t["2k4k"]}}]),e}(),k(KW.prototype,"join",[wW,AW],Object.getOwnPropertyDescriptor(KW.prototype,"join"),KW.prototype),k(KW.prototype,"leave",[RW],Object.getOwnPropertyDescriptor(KW.prototype,"leave"),KW.prototype),k(KW.prototype,"getUserList",[LW],Object.getOwnPropertyDescriptor(KW.prototype,"getUserList"),KW.prototype),k(KW.prototype,"publish",[OW,NW],Object.getOwnPropertyDescriptor(KW.prototype,"publish"),KW.prototype),k(KW.prototype,"unpublish",[PW,UW],Object.getOwnPropertyDescriptor(KW.prototype,"unpublish"),KW.prototype),k(KW.prototype,"subscribe",[xW],Object.getOwnPropertyDescriptor(KW.prototype,"subscribe"),KW.prototype),k(KW.prototype,"unsubscribe",[GW],Object.getOwnPropertyDescriptor(KW.prototype,"unsubscribe"),KW.prototype),k(KW.prototype,"switchRole",[FW,VW],Object.getOwnPropertyDescriptor(KW.prototype,"switchRole"),KW.prototype),k(KW.prototype,"startPublishCDNStream",[qW],Object.getOwnPropertyDescriptor(KW.prototype,"startPublishCDNStream"),KW.prototype),k(KW.prototype,"startMixTranscode",[BW],Object.getOwnPropertyDescriptor(KW.prototype,"startMixTranscode"),KW.prototype),k(KW.prototype,"sendSEIMessage",[HW,jW],Object.getOwnPropertyDescriptor(KW.prototype,"sendSEIMessage"),KW.prototype),KW),tY=0,nY=0,iY=(JW=MK(IK.TRTC.createClient),XW=MK(IK.TRTC.createStream),ZW=function(){function e(){a(this,e),this.name_=eE,this.VERSION=za,this.Logger={loggerManager:PA,LogLevel:fE,setLogLevel:function(e){PA.setLogLevel(e),e<=1&&rw()},enableUploadLog:function(){PA.enableUploadLog()},disableUploadLog:function(){PA.warn("disableUploadLog"),PA.disableUploadLog()}}}var i,r;return c(e,[{key:"checkSystemRequirements",value:(r=o(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pN();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"isScreenShareSupported",value:function(){return gN()}},{key:"isSmallStreamSupported",value:function(){return RN()}},{key:"getDevices",value:(i=o(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!CN()&&!TN()){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,navigator.mediaDevices.enumerateDevices();case 4:return t=e.sent,e.abrupt("return",t.filter((function(e){return e.kind!==eC||e.deviceId!=hE})).map((function(e,t){var n=e.label;e.label||(n=e.kind+"_"+t);var i={label:n,deviceId:e.deviceId,kind:e.kind};return e.groupId&&(i.groupId=e.groupId),e.getCapabilities&&(i.getCapabilities=function(){return e.getCapabilities()}),i})));case 6:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"getCameras",value:function(){return WN()}},{key:"getMicrophones",value:function(){return function(){return $N.apply(this,arguments)}()}},{key:"getSpeakers",value:function(){return function(){return JN.apply(this,arguments)}()}},{key:"createClient",value:function(e){UA&&(UA=!1,PA.getLogLevel(),rY.Logger.LogLevel.NONE,PA.info("TRTC Web SDK Version: 4.15.6"),PA.info("UserAgent: "+navigator.userAgent),PA.info("URL of current page: "+location.href));var n={version:this.VERSION},i=new eY(t(t(t({},n),e),{},{seq:++tY}));return Gw.emit(Zw,{client:i}),i}},{key:"createStream",value:function(e){return new QK(t(t({},e),{},{seq:++nY}))}}]),e}(),k(ZW.prototype,"createClient",[JW],Object.getOwnPropertyDescriptor(ZW.prototype,"createClient"),ZW.prototype),k(ZW.prototype,"createStream",[XW],Object.getOwnPropertyDescriptor(ZW.prototype,"createStream"),ZW.prototype),ZW),rY=new iY;return rY}()),dP}var fP,gP={},mP={get exports(){return gP},set exports(e){gP=e}};function vP(){return fP||(fP=1,mP.exports=function(e){function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=t(e);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(){o=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(b){c=function(e,t,n){return e[t]=n}}function u(e,t,n,i){var r,o,a,s,c=t&&t.prototype instanceof p?t:p,u=Object.create(c.prototype),h=new S(i||[]);return u._invoke=(r=e,o=n,a=h,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return k()}for(a.method=e,a.arg=t;;){var n=a.delegate;if(n){var i=M(n,a);if(i){if(i===d)continue;return i}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";var c=l(r,o,a);if("normal"===c.type){if(s=a.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:a.done}}"throw"===c.type&&(s="completed",a.method="throw",a.arg=c.arg)}}),u}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(b){return{type:"throw",arg:b}}}e.wrap=u;var d={};function p(){}function h(){}function f(){}var g={};c(g,r,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(E([])));v&&v!==t&&n.call(v,r)&&(g=v);var _=f.prototype=p.prototype=Object.create(g);function y(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function i(r,o,a,s){var c=l(e[r],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var r;this._invoke=function(e,n){function o(){return new t((function(t,r){i(e,n,t,r)}))}return r=r?r.then(o,o):o()}}function M(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,M(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=l(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function E(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return h.prototype=f,c(_,"constructor",f),c(f,"constructor",h),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},y(I.prototype),c(I.prototype,a,(function(){return this})),e.AsyncIterator=I,e.async=function(t,n,i,r,o){void 0===o&&(o=Promise);var a=new I(u(t,n,i,r),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(_),c(_,s,"Generator"),c(_,r,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=E,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return a.type="throw",a.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;C(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function a(e,t,n,i,r,o,a){try{var s=e[o](a),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(i,r)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){a(o,i,r,s,c,"next",e)}function c(e){a(o,i,r,s,c,"throw",e)}s(void 0)}))}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==C?C:"undefined"!=typeof self?self:{},h=function(e){try{return!!e()}catch(t){return!0}},f=!h((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),g=f,m=Function.prototype,v=m.call,_=g&&m.bind.bind(v,v),y=function(e){return g?_(e):function(){return v.apply(e,arguments)}},I=y,M=I({}.toString),T=I("".slice),S=function(e){return T(M(e),8,-1)},E=S,k=y,b=function(e){if("Function"===E(e))return k(e)},D=h,w=S,A=Object,R=b("".split),L=D((function(){return!A("z").propertyIsEnumerable(0)}))?function(e){return"String"==w(e)?R(e,""):A(e)}:A,O=function(e){return null==e},N=O,P=TypeError,U=function(e){if(N(e))throw P("Can't call method on "+e);return e},x=L,G=U,F=function(e){return x(G(e))},V=function(e){return e&&e.Math==Math&&e},q=V("object"==typeof globalThis&&globalThis)||V("object"==typeof window&&window)||V("object"==typeof self&&self)||V("object"==typeof p&&p)||function(){return this}()||Function("return this")(),B={exports:{}},H=q,j=Object.defineProperty,K=function(e,t){try{j(H,e,{value:t,configurable:!0,writable:!0})}catch(n){H[e]=t}return t},z=K,W="__core-js_shared__",Y=q[W]||z(W,{}),$=Y;(B.exports=function(e,t){return $[e]||($[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.25.5",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.5/LICENSE",source:"https://github.com/zloirock/core-js"});var J,X,Z=U,Q=Object,ee=function(e){return Q(Z(e))},te=ee,ne=b({}.hasOwnProperty),ie=Object.hasOwn||function(e,t){return ne(te(e),t)},re=b,oe=0,ae=Math.random(),se=re(1..toString),ce=function(e){return"Symbol("+(void 0===e?"":e)+")_"+se(++oe+ae,36)},ue="object"==typeof document&&document.all,le={all:ue,IS_HTMLDDA:void 0===ue&&void 0!==ue},de=le.all,pe=le.IS_HTMLDDA?function(e){return"function"==typeof e||e===de}:function(e){return"function"==typeof e},he=q,fe=pe,ge=function(e){return fe(e)?e:void 0},me=function(e,t){return arguments.length<2?ge(he[e]):he[e]&&he[e][t]},ve=me("navigator","userAgent")||"",_e=q,ye=ve,Ie=_e.process,Me=_e.Deno,Te=Ie&&Ie.versions||Me&&Me.version,Ce=Te&&Te.v8;Ce&&(X=(J=Ce.split("."))[0]>0&&J[0]<4?1:+(J[0]+J[1])),!X&&ye&&(!(J=ye.match(/Edge\/(\d+)/))||J[1]>=74)&&(J=ye.match(/Chrome\/(\d+)/))&&(X=+J[1]);var Se=X,Ee=Se,ke=h,be=!!Object.getOwnPropertySymbols&&!ke((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ee&&Ee<41})),De=be&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,we=q,Ae=B.exports,Re=ie,Le=ce,Oe=be,Ne=De,Pe=Ae("wks"),Ue=we.Symbol,xe=Ue&&Ue.for,Ge=Ne?Ue:Ue&&Ue.withoutSetter||Le,Fe=function(e){if(!Re(Pe,e)||!Oe&&"string"!=typeof Pe[e]){var t="Symbol."+e;Oe&&Re(Ue,e)?Pe[e]=Ue[e]:Pe[e]=Ne&&xe?xe(t):Ge(t)}return Pe[e]},Ve=pe,qe=le.all,Be=le.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:Ve(e)||e===qe}:function(e){return"object"==typeof e?null!==e:Ve(e)},He=Be,je=String,Ke=TypeError,ze=function(e){if(He(e))return e;throw Ke(je(e)+" is not an object")},We={},Ye=!h((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),$e=Ye&&h((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Je={},Xe=Be,Ze=q.document,Qe=Xe(Ze)&&Xe(Ze.createElement),et=function(e){return Qe?Ze.createElement(e):{}},tt=et,nt=!Ye&&!h((function(){return 7!=Object.defineProperty(tt("div"),"a",{get:function(){return 7}}).a})),it=f,rt=Function.prototype.call,ot=it?rt.bind(rt):function(){return rt.apply(rt,arguments)},at=b({}.isPrototypeOf),st=me,ct=pe,ut=at,lt=Object,dt=De?function(e){return"symbol"==typeof e}:function(e){var t=st("Symbol");return ct(t)&&ut(t.prototype,lt(e))},pt=String,ht=function(e){try{return pt(e)}catch(t){return"Object"}},ft=pe,gt=ht,mt=TypeError,vt=function(e){if(ft(e))return e;throw mt(gt(e)+" is not a function")},_t=vt,yt=O,It=function(e,t){var n=e[t];return yt(n)?void 0:_t(n)},Mt=ot,Tt=pe,Ct=Be,St=TypeError,Et=ot,kt=Be,bt=dt,Dt=It,wt=function(e,t){var n,i;if("string"===t&&Tt(n=e.toString)&&!Ct(i=Mt(n,e)))return i;if(Tt(n=e.valueOf)&&!Ct(i=Mt(n,e)))return i;if("string"!==t&&Tt(n=e.toString)&&!Ct(i=Mt(n,e)))return i;throw St("Can't convert object to primitive value")},At=TypeError,Rt=Fe("toPrimitive"),Lt=function(e,t){if(!kt(e)||bt(e))return e;var n,i=Dt(e,Rt);if(i){if(void 0===t&&(t="default"),n=Et(i,e,t),!kt(n)||bt(n))return n;throw At("Can't convert object to primitive value")}return void 0===t&&(t="number"),wt(e,t)},Ot=Lt,Nt=dt,Pt=function(e){var t=Ot(e,"string");return Nt(t)?t:t+""},Ut=Ye,xt=nt,Gt=$e,Ft=ze,Vt=Pt,qt=TypeError,Bt=Object.defineProperty,Ht=Object.getOwnPropertyDescriptor,jt="enumerable",Kt="configurable",zt="writable";Je.f=Ut?Gt?function(e,t,n){if(Ft(e),t=Vt(t),Ft(n),"function"==typeof e&&"prototype"===t&&"value"in n&&zt in n&&!n.writable){var i=Ht(e,t);i&&i.writable&&(e[t]=n.value,n={configurable:Kt in n?n.configurable:i.configurable,enumerable:jt in n?n.enumerable:i.enumerable,writable:!1})}return Bt(e,t,n)}:Bt:function(e,t,n){if(Ft(e),t=Vt(t),Ft(n),xt)try{return Bt(e,t,n)}catch(i){}if("get"in n||"set"in n)throw qt("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Wt=Math.ceil,Yt=Math.floor,$t=Math.trunc||function(e){var t=+e;return(t>0?Yt:Wt)(t)},Jt=function(e){var t=+e;return t!=t||0===t?0:$t(t)},Xt=Jt,Zt=Math.max,Qt=Math.min,en=function(e,t){var n=Xt(e);return n<0?Zt(n+t,0):Qt(n,t)},tn=Jt,nn=Math.min,rn=function(e){return e>0?nn(tn(e),9007199254740991):0},on=rn,an=function(e){return on(e.length)},sn=F,cn=en,un=an,ln=function(e){return function(t,n,i){var r,o=sn(t),a=un(o),s=cn(i,a);if(e&&n!=n){for(;a>s;)if((r=o[s++])!=r)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},dn={includes:ln(!0),indexOf:ln(!1)},pn={},hn=ie,fn=F,gn=dn.indexOf,mn=pn,vn=b([].push),_n=function(e,t){var n,i=fn(e),r=0,o=[];for(n in i)!hn(mn,n)&&hn(i,n)&&vn(o,n);for(;t.length>r;)hn(i,n=t[r++])&&(~gn(o,n)||vn(o,n));return o},yn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],In=_n,Mn=yn,Tn=Object.keys||function(e){return In(e,Mn)},Cn=Ye,Sn=$e,En=Je,kn=ze,bn=F,Dn=Tn;We.f=Cn&&!Sn?Object.defineProperties:function(e,t){kn(e);for(var n,i=bn(t),r=Dn(t),o=r.length,a=0;o>a;)En.f(e,n=r[a++],i[n]);return e};var wn,An=me("document","documentElement"),Rn=B.exports,Ln=ce,On=Rn("keys"),Nn=function(e){return On[e]||(On[e]=Ln(e))},Pn=ze,Un=We,xn=yn,Gn=pn,Fn=An,Vn=et,qn=Nn("IE_PROTO"),Bn=function(){},Hn=function(e){return"<script>"+e+"<\/script>"},jn=function(e){e.write(Hn("")),e.close();var t=e.parentWindow.Object;return e=null,t},Kn=function(){try{wn=new ActiveXObject("htmlfile")}catch(i){}var e,t;Kn="undefined"!=typeof document?document.domain&&wn?jn(wn):((t=Vn("iframe")).style.display="none",Fn.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Hn("document.F=Object")),e.close(),e.F):jn(wn);for(var n=xn.length;n--;)delete Kn.prototype[xn[n]];return Kn()};Gn[qn]=!0;var zn=Object.create||function(e,t){var n;return null!==e?(Bn.prototype=Pn(e),n=new Bn,Bn.prototype=null,n[qn]=e):n=Kn(),void 0===t?n:Un.f(n,t)},Wn=Fe,Yn=zn,$n=Je.f,Jn=Wn("unscopables"),Xn=Array.prototype;null==Xn[Jn]&&$n(Xn,Jn,{configurable:!0,value:Yn(null)});var Zn,Qn,ei,ti={},ni=pe,ii=q.WeakMap,ri=ni(ii)&&/native code/.test(String(ii)),oi=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ai=Je,si=oi,ci=Ye?function(e,t,n){return ai.f(e,t,si(1,n))}:function(e,t,n){return e[t]=n,e},ui=ri,li=q,di=Be,pi=ci,hi=ie,fi=Y,gi=Nn,mi=pn,vi="Object already initialized",_i=li.TypeError,yi=li.WeakMap;if(ui||fi.state){var Ii=fi.state||(fi.state=new yi);Ii.get=Ii.get,Ii.has=Ii.has,Ii.set=Ii.set,Zn=function(e,t){if(Ii.has(e))throw _i(vi);return t.facade=e,Ii.set(e,t),t},Qn=function(e){return Ii.get(e)||{}},ei=function(e){return Ii.has(e)}}else{var Mi=gi("state");mi[Mi]=!0,Zn=function(e,t){if(hi(e,Mi))throw _i(vi);return t.facade=e,pi(e,Mi,t),t},Qn=function(e){return hi(e,Mi)?e[Mi]:{}},ei=function(e){return hi(e,Mi)}}var Ti={set:Zn,get:Qn,has:ei,enforce:function(e){return ei(e)?Qn(e):Zn(e,{})},getterFor:function(e){return function(t){var n;if(!di(t)||(n=Qn(t)).type!==e)throw _i("Incompatible receiver, "+e+" required");return n}}},Ci={},Si={},Ei={}.propertyIsEnumerable,ki=Object.getOwnPropertyDescriptor,bi=ki&&!Ei.call({1:2},1);Si.f=bi?function(e){var t=ki(this,e);return!!t&&t.enumerable}:Ei;var Di=Ye,wi=ot,Ai=Si,Ri=oi,Li=F,Oi=Pt,Ni=ie,Pi=nt,Ui=Object.getOwnPropertyDescriptor;Ci.f=Di?Ui:function(e,t){if(e=Li(e),t=Oi(t),Pi)try{return Ui(e,t)}catch(n){}if(Ni(e,t))return Ri(!wi(Ai.f,e,t),e[t])};var xi={exports:{}},Gi=Ye,Fi=ie,Vi=Function.prototype,qi=Gi&&Object.getOwnPropertyDescriptor,Bi=Fi(Vi,"name"),Hi={EXISTS:Bi,PROPER:Bi&&"something"===function(){}.name,CONFIGURABLE:Bi&&(!Gi||Gi&&qi(Vi,"name").configurable)},ji=pe,Ki=Y,zi=b(Function.toString);ji(Ki.inspectSource)||(Ki.inspectSource=function(e){return zi(e)});var Wi=Ki.inspectSource,Yi=h,$i=pe,Ji=ie,Xi=Ye,Zi=Hi.CONFIGURABLE,Qi=Wi,er=Ti.enforce,tr=Ti.get,nr=Object.defineProperty,ir=Xi&&!Yi((function(){return 8!==nr((function(){}),"length",{value:8}).length})),rr=String(String).split("String"),or=xi.exports=function(e,t,n){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!Ji(e,"name")||Zi&&e.name!==t)&&(Xi?nr(e,"name",{value:t,configurable:!0}):e.name=t),ir&&n&&Ji(n,"arity")&&e.length!==n.arity&&nr(e,"length",{value:n.arity});try{n&&Ji(n,"constructor")&&n.constructor?Xi&&nr(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(r){}var i=er(e);return Ji(i,"source")||(i.source=rr.join("string"==typeof t?t:"")),e};Function.prototype.toString=or((function(){return $i(this)&&tr(this).source||Qi(this)}),"toString");var ar=pe,sr=Je,cr=xi.exports,ur=K,lr=function(e,t,n,i){i||(i={});var r=i.enumerable,o=void 0!==i.name?i.name:t;if(ar(n)&&cr(n,o,i),i.global)r?e[t]=n:ur(t,n);else{try{i.unsafe?e[t]&&(r=!0):delete e[t]}catch(a){}r?e[t]=n:sr.f(e,t,{value:n,enumerable:!1,configurable:!i.nonConfigurable,writable:!i.nonWritable})}return e},dr={},pr=_n,hr=yn.concat("length","prototype");dr.f=Object.getOwnPropertyNames||function(e){return pr(e,hr)};var fr={};fr.f=Object.getOwnPropertySymbols;var gr,mr,vr,_r=me,yr=dr,Ir=fr,Mr=ze,Tr=b([].concat),Cr=_r("Reflect","ownKeys")||function(e){var t=yr.f(Mr(e)),n=Ir.f;return n?Tr(t,n(e)):t},Sr=ie,Er=Cr,kr=Ci,br=Je,Dr=h,wr=pe,Ar=/#|\.prototype\./,Rr=function(e,t){var n=Or[Lr(e)];return n==Pr||n!=Nr&&(wr(t)?Dr(t):!!t)},Lr=Rr.normalize=function(e){return String(e).replace(Ar,".").toLowerCase()},Or=Rr.data={},Nr=Rr.NATIVE="N",Pr=Rr.POLYFILL="P",Ur=Rr,xr=q,Gr=Ci.f,Fr=ci,Vr=lr,qr=K,Br=function(e,t,n){for(var i=Er(t),r=br.f,o=kr.f,a=0;a<i.length;a++){var s=i[a];Sr(e,s)||n&&Sr(n,s)||r(e,s,o(t,s))}},Hr=Ur,jr=function(e,t){var n,i,r,o,a,s=e.target,c=e.global,u=e.stat;if(n=c?xr:u?xr[s]||qr(s,{}):(xr[s]||{}).prototype)for(i in t){if(o=t[i],r=e.dontCallGetSet?(a=Gr(n,i))&&a.value:n[i],!Hr(c?i:s+(u?".":"#")+i,e.forced)&&void 0!==r){if(typeof o==typeof r)continue;Br(o,r)}(e.sham||r&&r.sham)&&Fr(o,"sham",!0),Vr(n,i,o,e)}},Kr=!h((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),zr=ie,Wr=pe,Yr=ee,$r=Kr,Jr=Nn("IE_PROTO"),Xr=Object,Zr=Xr.prototype,Qr=$r?Xr.getPrototypeOf:function(e){var t=Yr(e);if(zr(t,Jr))return t[Jr];var n=t.constructor;return Wr(n)&&t instanceof n?n.prototype:t instanceof Xr?Zr:null},eo=h,to=pe,no=Be,io=Qr,ro=lr,oo=Fe("iterator"),ao=!1;[].keys&&("next"in(vr=[].keys())?(mr=io(io(vr)))!==Object.prototype&&(gr=mr):ao=!0),(!no(gr)||eo((function(){var e={};return gr[oo].call(e)!==e})))&&(gr={}),to(gr[oo])||ro(gr,oo,(function(){return this}));var so={IteratorPrototype:gr,BUGGY_SAFARI_ITERATORS:ao},co=Je.f,uo=ie,lo=Fe("toStringTag"),po=function(e,t,n){e&&!n&&(e=e.prototype),e&&!uo(e,lo)&&co(e,lo,{configurable:!0,value:t})},ho=so.IteratorPrototype,fo=zn,go=oi,mo=po,vo=ti,_o=function(){return this},yo=pe,Io=String,Mo=TypeError,To=b,Co=ze,So=function(e){if("object"==typeof e||yo(e))return e;throw Mo("Can't set "+Io(e)+" as a prototype")},Eo=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=To(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch(i){}return function(n,i){return Co(n),So(i),t?e(n,i):n.__proto__=i,n}}():void 0),ko=jr,bo=ot,Do=pe,wo=function(e,t,n,i){var r=t+" Iterator";return e.prototype=fo(ho,{next:go(+!i,n)}),mo(e,r,!1),vo[r]=_o,e},Ao=Qr,Ro=Eo,Lo=po,Oo=ci,No=lr,Po=ti,Uo=Hi.PROPER,xo=Hi.CONFIGURABLE,Go=so.IteratorPrototype,Fo=so.BUGGY_SAFARI_ITERATORS,Vo=Fe("iterator"),qo="keys",Bo="values",Ho="entries",jo=function(){return this},Ko=function(e,t,n,i,r,o,a){wo(n,t,i);var s,c,u,l=function(e){if(e===r&&g)return g;if(!Fo&&e in h)return h[e];switch(e){case qo:case Bo:case Ho:return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",p=!1,h=e.prototype,f=h[Vo]||h["@@iterator"]||r&&h[r],g=!Fo&&f||l(r),m="Array"==t&&h.entries||f;if(m&&(s=Ao(m.call(new e)))!==Object.prototype&&s.next&&(Ao(s)!==Go&&(Ro?Ro(s,Go):Do(s[Vo])||No(s,Vo,jo)),Lo(s,d,!0)),Uo&&r==Bo&&f&&f.name!==Bo&&(xo?Oo(h,"name",Bo):(p=!0,g=function(){return bo(f,this)})),r)if(c={values:l(Bo),keys:o?g:l(qo),entries:l(Ho)},a)for(u in c)(Fo||p||!(u in h))&&No(h,u,c[u]);else ko({target:t,proto:!0,forced:Fo||p},c);return h[Vo]!==g&&No(h,Vo,g,{name:r}),Po[t]=g,c},zo=function(e,t){return{value:e,done:t}},Wo=F,Yo=function(e){Xn[Jn][e]=!0},$o=ti,Jo=Ti,Xo=Je.f,Zo=Ko,Qo=zo,ea=Ye,ta="Array Iterator",na=Jo.set,ia=Jo.getterFor(ta),ra=Zo(Array,"Array",(function(e,t){na(this,{type:ta,target:Wo(e),index:0,kind:t})}),(function(){var e=ia(this),t=e.target,n=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,Qo(void 0,!0)):Qo("keys"==n?i:"values"==n?t[i]:[i,t[i]],!1)}),"values"),oa=$o.Arguments=$o.Array;if(Yo("keys"),Yo("values"),Yo("entries"),ea&&"values"!==oa.name)try{Xo(oa,"name",{value:"values"})}catch(eM){}var aa={exports:{}},sa={},ca=Pt,ua=Je,la=oi,da=function(e,t,n){var i=ca(t);i in e?ua.f(e,i,la(0,n)):e[i]=n},pa=en,ha=an,fa=da,ga=Array,ma=Math.max,va=function(e,t,n){for(var i=ha(e),r=pa(t,i),o=pa(void 0===n?i:n,i),a=ga(ma(o-r,0)),s=0;r<o;r++,s++)fa(a,s,e[r]);return a.length=s,a},_a=S,ya=F,Ia=dr.f,Ma=va,Ta="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];sa.f=function(e){return Ta&&"Window"==_a(e)?function(e){try{return Ia(e)}catch(eM){return Ma(Ta)}}(e):Ia(ya(e))};var Ca=h((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),Sa=h,Ea=Be,ka=S,ba=Ca,Da=Object.isExtensible,wa=Sa((function(){Da(1)}))||ba?function(e){return!!Ea(e)&&(!ba||"ArrayBuffer"!=ka(e))&&(!Da||Da(e))}:Da,Aa=!h((function(){return Object.isExtensible(Object.preventExtensions({}))})),Ra=jr,La=b,Oa=pn,Na=Be,Pa=ie,Ua=Je.f,xa=dr,Ga=sa,Fa=wa,Va=Aa,qa=!1,Ba=ce("meta"),Ha=0,ja=function(e){Ua(e,Ba,{value:{objectID:"O"+Ha++,weakData:{}}})},Ka=aa.exports={enable:function(){Ka.enable=function(){},qa=!0;var e=xa.f,t=La([].splice),n={};n[Ba]=1,e(n).length&&(xa.f=function(n){for(var i=e(n),r=0,o=i.length;r<o;r++)if(i[r]===Ba){t(i,r,1);break}return i},Ra({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Ga.f}))},fastKey:function(e,t){if(!Na(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Pa(e,Ba)){if(!Fa(e))return"F";if(!t)return"E";ja(e)}return e[Ba].objectID},getWeakData:function(e,t){if(!Pa(e,Ba)){if(!Fa(e))return!0;if(!t)return!1;ja(e)}return e[Ba].weakData},onFreeze:function(e){return Va&&qa&&Fa(e)&&!Pa(e,Ba)&&ja(e),e}};Oa[Ba]=!0;var za=vt,Wa=f,Ya=b(b.bind),$a=function(e,t){return za(e),void 0===t?e:Wa?Ya(e,t):function(){return e.apply(t,arguments)}},Ja=ti,Xa=Fe("iterator"),Za=Array.prototype,Qa=function(e){return void 0!==e&&(Ja.Array===e||Za[Xa]===e)},es={};es[Fe("toStringTag")]="z";var ts="[object z]"===String(es),ns=ts,is=pe,rs=S,os=Fe("toStringTag"),as=Object,ss="Arguments"==rs(function(){return arguments}()),cs=ns?rs:function(e){var t,n,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(eM){}}(t=as(e),os))?n:ss?rs(t):"Object"==(i=rs(t))&&is(t.callee)?"Arguments":i},us=cs,ls=It,ds=O,ps=ti,hs=Fe("iterator"),fs=function(e){if(!ds(e))return ls(e,hs)||ls(e,"@@iterator")||ps[us(e)]},gs=ot,ms=vt,vs=ze,_s=ht,ys=fs,Is=TypeError,Ms=function(e,t){var n=arguments.length<2?ys(e):t;if(ms(n))return vs(gs(n,e));throw Is(_s(e)+" is not iterable")},Ts=ot,Cs=ze,Ss=It,Es=$a,ks=ot,bs=ze,Ds=ht,ws=Qa,As=an,Rs=at,Ls=Ms,Os=fs,Ns=function(e,t,n){var i,r;Cs(e);try{if(!(i=Ss(e,"return"))){if("throw"===t)throw n;return n}i=Ts(i,e)}catch(eM){r=!0,i=eM}if("throw"===t)throw n;if(r)throw i;return Cs(i),n},Ps=TypeError,Us=function(e,t){this.stopped=e,this.result=t},xs=Us.prototype,Gs=function(e,t,n){var i,r,o,a,s,c,u,l=n&&n.that,d=!(!n||!n.AS_ENTRIES),p=!(!n||!n.IS_RECORD),h=!(!n||!n.IS_ITERATOR),f=!(!n||!n.INTERRUPTED),g=Es(t,l),m=function(e){return i&&Ns(i,"normal",e),new Us(!0,e)},v=function(e){return d?(bs(e),f?g(e[0],e[1],m):g(e[0],e[1])):f?g(e,m):g(e)};if(p)i=e.iterator;else if(h)i=e;else{if(!(r=Os(e)))throw Ps(Ds(e)+" is not iterable");if(ws(r)){for(o=0,a=As(e);a>o;o++)if((s=v(e[o]))&&Rs(xs,s))return s;return new Us(!1)}i=Ls(e,r)}for(c=p?e.next:i.next;!(u=ks(c,i)).done;){try{s=v(u.value)}catch(eM){Ns(i,"throw",eM)}if("object"==typeof s&&s&&Rs(xs,s))return s}return new Us(!1)},Fs=at,Vs=TypeError,qs=function(e,t){if(Fs(t,e))return e;throw Vs("Incorrect invocation")},Bs=Fe("iterator"),Hs=!1;try{var js=0,Ks={next:function(){return{done:!!js++}},return:function(){Hs=!0}};Ks[Bs]=function(){return this},Array.from(Ks,(function(){throw 2}))}catch(eM){}var zs=function(e,t){if(!t&&!Hs)return!1;var n=!1;try{var i={};i[Bs]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch(eM){}return n},Ws=pe,Ys=Be,$s=Eo,Js=function(e,t,n){var i,r;return $s&&Ws(i=t.constructor)&&i!==n&&Ys(r=i.prototype)&&r!==n.prototype&&$s(e,r),e},Xs=jr,Zs=q,Qs=b,ec=Ur,tc=lr,nc=aa.exports,ic=Gs,rc=qs,oc=pe,ac=O,sc=Be,cc=h,uc=zs,lc=po,dc=Js,pc=lr,hc=function(e,t,n){for(var i in t)pc(e,i,t[i],n);return e},fc=me,gc=Je,mc=Ye,vc=Fe("species"),_c=function(e){var t=fc(e),n=gc.f;mc&&t&&!t[vc]&&n(t,vc,{configurable:!0,get:function(){return this}})},yc=Je.f,Ic=zn,Mc=hc,Tc=$a,Cc=qs,Sc=O,Ec=Gs,kc=Ko,bc=zo,Dc=_c,wc=Ye,Ac=aa.exports.fastKey,Rc=Ti.set,Lc=Ti.getterFor,Oc={getConstructor:function(e,t,n,i){var r=e((function(e,r){Cc(e,o),Rc(e,{type:t,index:Ic(null),first:void 0,last:void 0,size:0}),wc||(e.size=0),Sc(r)||Ec(r,e[i],{that:e,AS_ENTRIES:n})})),o=r.prototype,a=Lc(t),s=function(e,t,n){var i,r,o=a(e),s=c(e,t);return s?s.value=n:(o.last=s={index:r=Ac(t,!0),key:t,value:n,previous:i=o.last,next:void 0,removed:!1},o.first||(o.first=s),i&&(i.next=s),wc?o.size++:e.size++,"F"!==r&&(o.index[r]=s)),e},c=function(e,t){var n,i=a(e),r=Ac(t);if("F"!==r)return i.index[r];for(n=i.first;n;n=n.next)if(n.key==t)return n};return Mc(o,{clear:function(){for(var e=a(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,wc?e.size=0:this.size=0},delete:function(e){var t=this,n=a(t),i=c(t,e);if(i){var r=i.next,o=i.previous;delete n.index[i.index],i.removed=!0,o&&(o.next=r),r&&(r.previous=o),n.first==i&&(n.first=r),n.last==i&&(n.last=o),wc?n.size--:t.size--}return!!i},forEach:function(e){for(var t,n=a(this),i=Tc(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:n.first;)for(i(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),Mc(o,n?{get:function(e){var t=c(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),wc&&yc(o,"size",{get:function(){return a(this).size}}),r},setStrong:function(e,t,n){var i=t+" Iterator",r=Lc(t),o=Lc(i);kc(e,t,(function(e,t){Rc(this,{type:i,target:e,state:r(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?bc("keys"==t?n.key:"values"==t?n.value:[n.key,n.value],!1):(e.target=void 0,bc(void 0,!0))}),n?"entries":"values",!n,!0),Dc(t)}};!function(e,t,n){var i=-1!==e.indexOf("Map"),r=-1!==e.indexOf("Weak"),o=i?"set":"add",a=Zs[e],s=a&&a.prototype,c=a,u={},l=function(e){var t=Qs(s[e]);tc(s,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(r&&!sc(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return r&&!sc(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(r&&!sc(e))&&t(this,0===e?0:e)}:function(e,n){return t(this,0===e?0:e,n),this})};if(ec(e,!oc(a)||!(r||s.forEach&&!cc((function(){(new a).entries().next()})))))c=n.getConstructor(t,e,i,o),nc.enable();else if(ec(e,!0)){var d=new c,p=d[o](r?{}:-0,1)!=d,h=cc((function(){d.has(1)})),f=uc((function(e){new a(e)})),g=!r&&cc((function(){for(var e=new a,t=5;t--;)e[o](t,t);return!e.has(-0)}));f||((c=t((function(e,t){rc(e,s);var n=dc(new a,e,c);return ac(t)||ic(t,n[o],{that:n,AS_ENTRIES:i}),n}))).prototype=s,s.constructor=c),(h||g)&&(l("delete"),l("has"),i&&l("get")),(g||p)&&l(o),r&&s.clear&&delete s.clear}u[e]=c,Xs({global:!0,constructor:!0,forced:c!=a},u),lc(c,e),r||n.setStrong(c,e,i)}("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Oc);var Nc=cs,Pc=ts?{}.toString:function(){return"[object "+Nc(this)+"]"};ts||lr(Object.prototype,"toString",Pc,{unsafe:!0});var Uc=cs,xc=String,Gc=function(e){if("Symbol"===Uc(e))throw TypeError("Cannot convert a Symbol value to a string");return xc(e)},Fc=b,Vc=Jt,qc=Gc,Bc=U,Hc=Fc("".charAt),jc=Fc("".charCodeAt),Kc=Fc("".slice),zc=function(e){return function(t,n){var i,r,o=qc(Bc(t)),a=Vc(n),s=o.length;return a<0||a>=s?e?"":void 0:(i=jc(o,a))<55296||i>56319||a+1===s||(r=jc(o,a+1))<56320||r>57343?e?Hc(o,a):i:e?Kc(o,a,a+2):r-56320+(i-55296<<10)+65536}},Wc=(zc(!1),zc(!0)),Yc=Gc,$c=Ti,Jc=Ko,Xc=zo,Zc="String Iterator",Qc=$c.set,eu=$c.getterFor(Zc);Jc(String,"String",(function(e){Qc(this,{type:Zc,string:Yc(e),index:0})}),(function(){var e,t=eu(this),n=t.string,i=t.index;return i>=n.length?Xc(void 0,!0):(e=Wc(n,i),t.index+=e.length,Xc(e,!1))}));var tu=et("span").classList,nu=tu&&tu.constructor&&tu.constructor.prototype,iu=nu===Object.prototype?void 0:nu,ru=q,ou={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},au=iu,su=ra,cu=ci,uu=Fe,lu=uu("iterator"),du=uu("toStringTag"),pu=su.values,hu=function(e,t){if(e){if(e[lu]!==pu)try{cu(e,lu,pu)}catch(eM){e[lu]=pu}if(e[du]||cu(e,du,t),ou[t])for(var n in su)if(e[n]!==su[n])try{cu(e,n,su[n])}catch(eM){e[n]=su[n]}}};for(var fu in ou)hu(ru[fu]&&ru[fu].prototype,fu);hu(au,"DOMTokenList");var gu=S,mu=Array.isArray||function(e){return"Array"==gu(e)},vu=b,_u=h,yu=pe,Iu=cs,Mu=Wi,Tu=function(){},Cu=[],Su=me("Reflect","construct"),Eu=/^\s*(?:class|function)\b/,ku=vu(Eu.exec),bu=!Eu.exec(Tu),Du=function(e){if(!yu(e))return!1;try{return Su(Tu,Cu,e),!0}catch(eM){return!1}},wu=function(e){if(!yu(e))return!1;switch(Iu(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return bu||!!ku(Eu,Mu(e))}catch(eM){return!0}};wu.sham=!0;var Au=!Su||_u((function(){var e;return Du(Du.call)||!Du(Object)||!Du((function(){e=!0}))||e}))?wu:Du,Ru=h,Lu=Se,Ou=Fe("species"),Nu=function(e){return Lu>=51||!Ru((function(){var t=[];return(t.constructor={})[Ou]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Pu=b([].slice),Uu=jr,xu=mu,Gu=Au,Fu=Be,Vu=en,qu=an,Bu=F,Hu=da,ju=Fe,Ku=Pu,zu=Nu("slice"),Wu=ju("species"),Yu=Array,$u=Math.max;Uu({target:"Array",proto:!0,forced:!zu},{slice:function(e,t){var n,i,r,o=Bu(this),a=qu(o),s=Vu(e,a),c=Vu(void 0===t?a:t,a);if(xu(o)&&(n=o.constructor,(Gu(n)&&(n===Yu||xu(n.prototype))||Fu(n)&&null===(n=n[Wu]))&&(n=void 0),n===Yu||void 0===n))return Ku(o,s,c);for(i=new(void 0===n?Yu:n)($u(c-s,0)),r=0;s<c;s++,r++)s in o&&Hu(i,r,o[s]);return i.length=r,i}});var Ju=jr,Xu=Date,Zu=b(Xu.prototype.getTime);Ju({target:"Date",stat:!0},{now:function(){return Zu(new Xu)}});var Qu=b,el=lr,tl=Date.prototype,nl="Invalid Date",il="toString",rl=Qu(tl.toString),ol=Qu(tl.getTime);String(new Date(NaN))!=nl&&el(tl,il,(function(){var e=ol(this);return e==e?rl(this):nl}));var al=TypeError,sl=mu,cl=Au,ul=Be,ll=Fe("species"),dl=Array,pl=function(e){var t;return sl(e)&&(t=e.constructor,(cl(t)&&(t===dl||sl(t.prototype))||ul(t)&&null===(t=t[ll]))&&(t=void 0)),void 0===t?dl:t},hl=function(e,t){return new(pl(e))(0===t?0:t)},fl=jr,gl=h,ml=mu,vl=Be,_l=ee,yl=an,Il=function(e){if(e>9007199254740991)throw al("Maximum allowed index exceeded");return e},Ml=da,Tl=hl,Cl=Nu,Sl=Se,El=Fe("isConcatSpreadable"),kl=Sl>=51||!gl((function(){var e=[];return e[El]=!1,e.concat()[0]!==e})),bl=Cl("concat"),Dl=function(e){if(!vl(e))return!1;var t=e[El];return void 0!==t?!!t:ml(e)};fl({target:"Array",proto:!0,arity:1,forced:!kl||!bl},{concat:function(e){var t,n,i,r,o,a=_l(this),s=Tl(a,0),c=0;for(t=-1,i=arguments.length;t<i;t++)if(Dl(o=-1===t?a:arguments[t]))for(r=yl(o),Il(c+r),n=0;n<r;n++,c++)n in o&&Ml(s,c,o[n]);else Il(c+1),Ml(s,c++,o);return s.length=c,s}});var wl,Al,Rl,Ll,Ol="process"==S(q.process),Nl=Au,Pl=ht,Ul=TypeError,xl=function(e){if(Nl(e))return e;throw Ul(Pl(e)+" is not a constructor")},Gl=ze,Fl=xl,Vl=O,ql=Fe("species"),Bl=function(e,t){var n,i=Gl(e).constructor;return void 0===i||Vl(n=Gl(i)[ql])?t:Fl(n)},Hl=f,jl=Function.prototype,Kl=jl.apply,zl=jl.call,Wl="object"==typeof Reflect&&Reflect.apply||(Hl?zl.bind(Kl):function(){return zl.apply(Kl,arguments)}),Yl=TypeError,$l=/(?:ipad|iphone|ipod).*applewebkit/i.test(ve),Jl=q,Xl=Wl,Zl=$a,Ql=pe,ed=ie,td=h,nd=An,id=Pu,rd=et,od=function(e,t){if(e<t)throw Yl("Not enough arguments");return e},ad=$l,sd=Ol,cd=Jl.setImmediate,ud=Jl.clearImmediate,ld=Jl.process,dd=Jl.Dispatch,pd=Jl.Function,hd=Jl.MessageChannel,fd=Jl.String,gd=0,md={},vd="onreadystatechange";try{wl=Jl.location}catch(eM){}var _d=function(e){if(ed(md,e)){var t=md[e];delete md[e],t()}},yd=function(e){return function(){_d(e)}},Id=function(e){_d(e.data)},Md=function(e){Jl.postMessage(fd(e),wl.protocol+"//"+wl.host)};cd&&ud||(cd=function(e){od(arguments.length,1);var t=Ql(e)?e:pd(e),n=id(arguments,1);return md[++gd]=function(){Xl(t,void 0,n)},Al(gd),gd},ud=function(e){delete md[e]},sd?Al=function(e){ld.nextTick(yd(e))}:dd&&dd.now?Al=function(e){dd.now(yd(e))}:hd&&!ad?(Ll=(Rl=new hd).port2,Rl.port1.onmessage=Id,Al=Zl(Ll.postMessage,Ll)):Jl.addEventListener&&Ql(Jl.postMessage)&&!Jl.importScripts&&wl&&"file:"!==wl.protocol&&!td(Md)?(Al=Md,Jl.addEventListener("message",Id,!1)):Al=vd in rd("script")?function(e){nd.appendChild(rd("script")).onreadystatechange=function(){nd.removeChild(this),_d(e)}}:function(e){setTimeout(yd(e),0)});var Td,Cd,Sd,Ed,kd,bd,Dd,wd,Ad={set:cd,clear:ud},Rd=q,Ld=/ipad|iphone|ipod/i.test(ve)&&void 0!==Rd.Pebble,Od=/web0s(?!.*chrome)/i.test(ve),Nd=q,Pd=$a,Ud=Ci.f,xd=Ad.set,Gd=$l,Fd=Ld,Vd=Od,qd=Ol,Bd=Nd.MutationObserver||Nd.WebKitMutationObserver,Hd=Nd.document,jd=Nd.process,Kd=Nd.Promise,zd=Ud(Nd,"queueMicrotask"),Wd=zd&&zd.value;Wd||(Td=function(){var e,t;for(qd&&(e=jd.domain)&&e.exit();Cd;){t=Cd.fn,Cd=Cd.next;try{t()}catch(eM){throw Cd?Ed():Sd=void 0,eM}}Sd=void 0,e&&e.enter()},Gd||qd||Vd||!Bd||!Hd?!Fd&&Kd&&Kd.resolve?((Dd=Kd.resolve(void 0)).constructor=Kd,wd=Pd(Dd.then,Dd),Ed=function(){wd(Td)}):qd?Ed=function(){jd.nextTick(Td)}:(xd=Pd(xd,Nd),Ed=function(){xd(Td)}):(kd=!0,bd=Hd.createTextNode(""),new Bd(Td).observe(bd,{characterData:!0}),Ed=function(){bd.data=kd=!kd}));var Yd=Wd||function(e){var t={fn:e,next:void 0};Sd&&(Sd.next=t),Cd||(Cd=t,Ed()),Sd=t},$d=q,Jd=function(e){try{return{error:!1,value:e()}}catch(eM){return{error:!0,value:eM}}},Xd=function(){this.head=null,this.tail=null};Xd.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var Zd=Xd,Qd=q.Promise,ep="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,tp=!ep&&!Ol&&"object"==typeof window&&"object"==typeof document,np=q,ip=Qd,rp=pe,op=Ur,ap=Wi,sp=Fe,cp=tp,up=ep,lp=Se;ip&&ip.prototype;var dp=sp("species"),pp=!1,hp=rp(np.PromiseRejectionEvent),fp={CONSTRUCTOR:op("Promise",(function(){var e=ap(ip),t=e!==String(ip);if(!t&&66===lp)return!0;if(!lp||lp<51||!/native code/.test(e)){var n=new ip((function(e){e(1)})),i=function(e){e((function(){}),(function(){}))};if((n.constructor={})[dp]=i,!(pp=n.then((function(){}))instanceof i))return!0}return!t&&(cp||up)&&!hp})),REJECTION_EVENT:hp,SUBCLASSING:pp},gp={},mp=vt,vp=TypeError,_p=function(e){var t,n;this.promise=new e((function(e,i){if(void 0!==t||void 0!==n)throw vp("Bad Promise constructor");t=e,n=i})),this.resolve=mp(t),this.reject=mp(n)};gp.f=function(e){return new _p(e)};var yp,Ip,Mp,Tp=jr,Cp=Ol,Sp=q,Ep=ot,kp=lr,bp=Eo,Dp=po,wp=_c,Ap=vt,Rp=pe,Lp=Be,Op=qs,Np=Bl,Pp=Ad.set,Up=Yd,xp=function(e,t){var n=$d.console;n&&n.error&&(1==arguments.length?n.error(e):n.error(e,t))},Gp=Jd,Fp=Zd,Vp=Ti,qp=Qd,Bp=gp,Hp="Promise",jp=fp.CONSTRUCTOR,Kp=fp.REJECTION_EVENT,zp=fp.SUBCLASSING,Wp=Vp.getterFor(Hp),Yp=Vp.set,$p=qp&&qp.prototype,Jp=qp,Xp=$p,Zp=Sp.TypeError,Qp=Sp.document,eh=Sp.process,th=Bp.f,nh=th,ih=!!(Qp&&Qp.createEvent&&Sp.dispatchEvent),rh="unhandledrejection",oh=function(e){var t;return!(!Lp(e)||!Rp(t=e.then))&&t},ah=function(e,t){var n,i,r,o=t.value,a=1==t.state,s=a?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{s?(a||(2===t.rejection&&dh(t),t.rejection=1),!0===s?n=o:(l&&l.enter(),n=s(o),l&&(l.exit(),r=!0)),n===e.promise?u(Zp("Promise-chain cycle")):(i=oh(n))?Ep(i,n,c,u):c(n)):u(o)}catch(eM){l&&!r&&l.exit(),u(eM)}},sh=function(e,t){e.notified||(e.notified=!0,Up((function(){for(var n,i=e.reactions;n=i.get();)ah(n,e);e.notified=!1,t&&!e.rejection&&uh(e)})))},ch=function(e,t,n){var i,r;ih?((i=Qp.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),Sp.dispatchEvent(i)):i={promise:t,reason:n},!Kp&&(r=Sp["on"+e])?r(i):e===rh&&xp("Unhandled promise rejection",n)},uh=function(e){Ep(Pp,Sp,(function(){var t,n=e.facade,i=e.value;if(lh(e)&&(t=Gp((function(){Cp?eh.emit("unhandledRejection",i,n):ch(rh,n,i)})),e.rejection=Cp||lh(e)?2:1,t.error))throw t.value}))},lh=function(e){return 1!==e.rejection&&!e.parent},dh=function(e){Ep(Pp,Sp,(function(){var t=e.facade;Cp?eh.emit("rejectionHandled",t):ch("rejectionhandled",t,e.value)}))},ph=function(e,t,n){return function(i){e(t,i,n)}},hh=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,sh(e,!0))},fh=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw Zp("Promise can't be resolved itself");var i=oh(t);i?Up((function(){var n={done:!1};try{Ep(i,t,ph(fh,n,e),ph(hh,n,e))}catch(eM){hh(n,eM,e)}})):(e.value=t,e.state=1,sh(e,!1))}catch(eM){hh({done:!1},eM,e)}}};if(jp&&(Xp=(Jp=function(e){Op(this,Xp),Ap(e),Ep(yp,this);var t=Wp(this);try{e(ph(fh,t),ph(hh,t))}catch(eM){hh(t,eM)}}).prototype,(yp=function(e){Yp(this,{type:Hp,done:!1,notified:!1,parent:!1,reactions:new Fp,rejection:!1,state:0,value:void 0})}).prototype=kp(Xp,"then",(function(e,t){var n=Wp(this),i=th(Np(this,Jp));return n.parent=!0,i.ok=!Rp(e)||e,i.fail=Rp(t)&&t,i.domain=Cp?eh.domain:void 0,0==n.state?n.reactions.add(i):Up((function(){ah(i,n)})),i.promise})),Ip=function(){var e=new yp,t=Wp(e);this.promise=e,this.resolve=ph(fh,t),this.reject=ph(hh,t)},Bp.f=th=function(e){return e===Jp||void 0===e?new Ip(e):nh(e)},Rp(qp)&&$p!==Object.prototype)){Mp=$p.then,zp||kp($p,"then",(function(e,t){var n=this;return new Jp((function(e,t){Ep(Mp,n,e,t)})).then(e,t)}),{unsafe:!0});try{delete $p.constructor}catch(eM){}bp&&bp($p,Xp)}Tp({global:!0,constructor:!0,wrap:!0,forced:jp},{Promise:Jp}),Dp(Jp,Hp,!1),wp(Hp);var gh=Qd,mh=fp.CONSTRUCTOR||!zs((function(e){gh.all(e).then(void 0,(function(){}))})),vh=ot,_h=vt,yh=gp,Ih=Jd,Mh=Gs;jr({target:"Promise",stat:!0,forced:mh},{all:function(e){var t=this,n=yh.f(t),i=n.resolve,r=n.reject,o=Ih((function(){var n=_h(t.resolve),o=[],a=0,s=1;Mh(e,(function(e){var c=a++,u=!1;s++,vh(n,t,e).then((function(e){u||(u=!0,o[c]=e,--s||i(o))}),r)})),--s||i(o)}));return o.error&&r(o.value),n.promise}});var Th=jr,Ch=fp.CONSTRUCTOR,Sh=Qd,Eh=me,kh=pe,bh=lr,Dh=Sh&&Sh.prototype;if(Th({target:"Promise",proto:!0,forced:Ch,real:!0},{catch:function(e){return this.then(void 0,e)}}),kh(Sh)){var wh=Eh("Promise").prototype.catch;Dh.catch!==wh&&bh(Dh,"catch",wh,{unsafe:!0})}var Ah=ot,Rh=vt,Lh=gp,Oh=Jd,Nh=Gs;jr({target:"Promise",stat:!0,forced:mh},{race:function(e){var t=this,n=Lh.f(t),i=n.reject,r=Oh((function(){var r=Rh(t.resolve);Nh(e,(function(e){Ah(r,t,e).then(n.resolve,i)}))}));return r.error&&i(r.value),n.promise}});var Ph=ot,Uh=gp;jr({target:"Promise",stat:!0,forced:fp.CONSTRUCTOR},{reject:function(e){var t=Uh.f(this);return Ph(t.reject,void 0,e),t.promise}});var xh=ze,Gh=Be,Fh=gp,Vh=jr,qh=fp.CONSTRUCTOR,Bh=function(e,t){if(xh(e),Gh(t)&&t.constructor===e)return t;var n=Fh.f(e);return(0,n.resolve)(t),n.promise};me("Promise"),Vh({target:"Promise",stat:!0,forced:qh},{resolve:function(e){return Bh(this,e)}}),window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;var Hh,jh=function(){if(Hh)return Hh;Hh=new window.AudioContext({sampleRate:48e3});var e=function e(){"suspended"===Hh.state?(Hh.resume(),document.removeEventListener("click",e)):"interrupted"===Hh.state?Hh.resume():document.removeEventListener("click",e)};return document.addEventListener("click",e),Hh.onstatechange=function(){e()},Hh},Kh="input",zh="output";function Wh(e){return Yh.apply(this,arguments)}function Yh(){return(Yh=s(o().mark((function e(t){var n,i,r,a,s,c,u,l,d,p,h,f,g,m;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.sdkAppId,i=t.userId,r=t.userSig,a=t.timestamp,s="https://schedule.rtc.qq.com/api/v1/audioAiAuth?sdkAppId=".concat(n,"&userId=").concat(i,"&userSig=").concat(r,"&timestamp=").concat(a),e.next=4,fetch(s);case 4:return c=e.sent,e.next=7,c.json();case 7:if(u=e.sent,l=u.data,d=l.errCode,p=l.errMsg,h=l.sign,"1"!==(f=l.status)){e.next=15;break}return e.abrupt("return",{auth:!0,sign:h,status:f,message:p});case 15:g="Init RTCAIDenoiser failed.",m="",e.t0=d,e.next=1===e.t0?20:2===e.t0?22:3===e.t0?24:4===e.t0?26:5===e.t0?28:6===e.t0?30:32;break;case 20:return m="Please check your params.",e.abrupt("break",32);case 22:return m="You need to buy packages. Refer to: https://cloud.tencent.com/document/product/647/44247",e.abrupt("break",32);case 24:return m="Server is invalid. Please contact our engineer. ",e.abrupt("break",32);case 26:return m="Your packages is not active. Refer to: https://cloud.tencent.com/document/product/647/44247",e.abrupt("break",32);case 28:return m="Your packages is expired. Refer to: https://cloud.tencent.com/document/product/647/44247",e.abrupt("break",32);case 30:return m="Your version is not supported.",e.abrupt("break",32);case 32:return e.abrupt("return",{auth:!1,status:f,message:p?"".concat(g," Reason: ").concat(p,". ").concat(m):"".concat(g,", ").concat(m)});case 33:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $h={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,i,o,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new r(i,o||e,a),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},s.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,o=i.length,a=new Array(o);r<o;r++)a[r]=i[r].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},s.prototype.emit=function(e,t,i,r,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,r),!0;case 5:return l.fn.call(l.context,t,i,r,o),!0;case 6:return l.fn.call(l.context,t,i,r,o,a),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,h=l.length;for(u=0;u<h;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,i);break;case 4:l[u].fn.call(l[u].context,t,i,r);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,i,r){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||r&&!s.once||i&&s.context!==i||a(this,o);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==t||r&&!s[c].once||i&&s[c].context!==i)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}($h);var Jh=$h.exports,Xh="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Zh=Jt,Qh=rn,ef=RangeError,tf=function(e){if(void 0===e)return 0;var t=Zh(e),n=Qh(t);if(t!==n)throw ef("Wrong length or index");return n},nf=Array,rf=Math.abs,of=Math.pow,af=Math.floor,sf=Math.log,cf=Math.LN2,uf=ee,lf=en,df=an,pf=function(e){for(var t=uf(this),n=df(t),i=arguments.length,r=lf(i>1?arguments[1]:void 0,n),o=i>2?arguments[2]:void 0,a=void 0===o?n:lf(o,n);a>r;)t[r++]=e;return t},hf=q,ff=b,gf=Ye,mf=Xh,vf=Hi,_f=ci,yf=hc,If=h,Mf=qs,Tf=Jt,Cf=rn,Sf=tf,Ef={pack:function(e,t,n){var i,r,o,a=nf(n),s=8*n-t-1,c=(1<<s)-1,u=c>>1,l=23===t?of(2,-24)-of(2,-77):0,d=e<0||0===e&&1/e<0?1:0,p=0;for((e=rf(e))!=e||1/0===e?(r=e!=e?1:0,i=c):(i=af(sf(e)/cf),e*(o=of(2,-i))<1&&(i--,o*=2),(e+=i+u>=1?l/o:l*of(2,1-u))*o>=2&&(i++,o/=2),i+u>=c?(r=0,i=c):i+u>=1?(r=(e*o-1)*of(2,t),i+=u):(r=e*of(2,u-1)*of(2,t),i=0));t>=8;)a[p++]=255&r,r/=256,t-=8;for(i=i<<t|r,s+=t;s>0;)a[p++]=255&i,i/=256,s-=8;return a[--p]|=128*d,a},unpack:function(e,t){var n,i=e.length,r=8*i-t-1,o=(1<<r)-1,a=o>>1,s=r-7,c=i-1,u=e[c--],l=127&u;for(u>>=7;s>0;)l=256*l+e[c--],s-=8;for(n=l&(1<<-s)-1,l>>=-s,s+=t;s>0;)n=256*n+e[c--],s-=8;if(0===l)l=1-a;else{if(l===o)return n?NaN:u?-1/0:1/0;n+=of(2,t),l-=a}return(u?-1:1)*n*of(2,l-t)}},kf=Qr,bf=Eo,Df=dr.f,wf=Je.f,Af=pf,Rf=va,Lf=po,Of=vf.PROPER,Nf=vf.CONFIGURABLE,Pf=Ti.get,Uf=Ti.set,xf="ArrayBuffer",Gf="DataView",Ff="Wrong index",Vf=hf.ArrayBuffer,qf=Vf,Bf=qf&&qf.prototype,Hf=hf.DataView,jf=Hf&&Hf.prototype,Kf=Object.prototype,zf=hf.Array,Wf=hf.RangeError,Yf=ff(Af),$f=ff([].reverse),Jf=Ef.pack,Xf=Ef.unpack,Zf=function(e){return[255&e]},Qf=function(e){return[255&e,e>>8&255]},eg=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},tg=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},ng=function(e){return Jf(e,23,4)},ig=function(e){return Jf(e,52,8)},rg=function(e,t){wf(e.prototype,t,{get:function(){return Pf(this)[t]}})},og=function(e,t,n,i){var r=Sf(n),o=Pf(e);if(r+t>o.byteLength)throw Wf(Ff);var a=Pf(o.buffer).bytes,s=r+o.byteOffset,c=Rf(a,s,s+t);return i?c:$f(c)},ag=function(e,t,n,i,r,o){var a=Sf(n),s=Pf(e);if(a+t>s.byteLength)throw Wf(Ff);for(var c=Pf(s.buffer).bytes,u=a+s.byteOffset,l=i(+r),d=0;d<t;d++)c[u+d]=l[o?d:t-d-1]};if(mf){var sg=Of&&Vf.name!==xf;if(If((function(){Vf(1)}))&&If((function(){new Vf(-1)}))&&!If((function(){return new Vf,new Vf(1.5),new Vf(NaN),1!=Vf.length||sg&&!Nf})))sg&&Nf&&_f(Vf,"name",xf);else{(qf=function(e){return Mf(this,Bf),new Vf(Sf(e))}).prototype=Bf;for(var cg,ug=Df(Vf),lg=0;ug.length>lg;)(cg=ug[lg++])in qf||_f(qf,cg,Vf[cg]);Bf.constructor=qf}bf&&kf(jf)!==Kf&&bf(jf,Kf);var dg=new Hf(new qf(2)),pg=ff(jf.setInt8);dg.setInt8(0,2147483648),dg.setInt8(1,2147483649),!dg.getInt8(0)&&dg.getInt8(1)||yf(jf,{setInt8:function(e,t){pg(this,e,t<<24>>24)},setUint8:function(e,t){pg(this,e,t<<24>>24)}},{unsafe:!0})}else Bf=(qf=function(e){Mf(this,Bf);var t=Sf(e);Uf(this,{bytes:Yf(zf(t),0),byteLength:t}),gf||(this.byteLength=t)}).prototype,jf=(Hf=function(e,t,n){Mf(this,jf),Mf(e,Bf);var i=Pf(e).byteLength,r=Tf(t);if(r<0||r>i)throw Wf("Wrong offset");if(r+(n=void 0===n?i-r:Cf(n))>i)throw Wf("Wrong length");Uf(this,{buffer:e,byteLength:n,byteOffset:r}),gf||(this.buffer=e,this.byteLength=n,this.byteOffset=r)}).prototype,gf&&(rg(qf,"byteLength"),rg(Hf,"buffer"),rg(Hf,"byteLength"),rg(Hf,"byteOffset")),yf(jf,{getInt8:function(e){return og(this,1,e)[0]<<24>>24},getUint8:function(e){return og(this,1,e)[0]},getInt16:function(e){var t=og(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=og(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return tg(og(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return tg(og(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return Xf(og(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return Xf(og(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){ag(this,1,e,Zf,t)},setUint8:function(e,t){ag(this,1,e,Zf,t)},setInt16:function(e,t){ag(this,2,e,Qf,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){ag(this,2,e,Qf,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){ag(this,4,e,eg,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){ag(this,4,e,eg,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){ag(this,4,e,ng,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){ag(this,8,e,ig,t,arguments.length>2?arguments[2]:void 0)}});Lf(qf,xf),Lf(Hf,Gf);var hg={ArrayBuffer:qf,DataView:Hf},fg=jr,gg=b,mg=h,vg=ze,_g=en,yg=rn,Ig=Bl,Mg=hg.ArrayBuffer,Tg=hg.DataView,Cg=Tg.prototype,Sg=gg(Mg.prototype.slice),Eg=gg(Cg.getUint8),kg=gg(Cg.setUint8);fg({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:mg((function(){return!new Mg(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(Sg&&void 0===t)return Sg(vg(this),e);for(var n=vg(this).byteLength,i=_g(e,n),r=_g(void 0===t?n:t,n),o=new(Ig(this,Mg))(yg(r-i)),a=new Tg(this),s=new Tg(o),c=0;i<r;)kg(s,c++,Eg(a,i++));return o}});var bg,Dg,wg,Ag={exports:{}},Rg=Xh,Lg=Ye,Og=q,Ng=pe,Pg=Be,Ug=ie,xg=cs,Gg=ht,Fg=ci,Vg=lr,qg=Je.f,Bg=at,Hg=Qr,jg=Eo,Kg=Fe,zg=ce,Wg=Ti.enforce,Yg=Ti.get,$g=Og.Int8Array,Jg=$g&&$g.prototype,Xg=Og.Uint8ClampedArray,Zg=Xg&&Xg.prototype,Qg=$g&&Hg($g),em=Jg&&Hg(Jg),tm=Object.prototype,nm=Og.TypeError,im=Kg("toStringTag"),rm=zg("TYPED_ARRAY_TAG"),om="TypedArrayConstructor",am=Rg&&!!jg&&"Opera"!==xg(Og.opera),sm=!1,cm={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},um={BigInt64Array:8,BigUint64Array:8},lm=function(e){var t=Hg(e);if(Pg(t)){var n=Yg(t);return n&&Ug(n,om)?n.TypedArrayConstructor:lm(t)}},dm=function(e){if(!Pg(e))return!1;var t=xg(e);return Ug(cm,t)||Ug(um,t)};for(bg in cm)(wg=(Dg=Og[bg])&&Dg.prototype)?Wg(wg).TypedArrayConstructor=Dg:am=!1;for(bg in um)(wg=(Dg=Og[bg])&&Dg.prototype)&&(Wg(wg).TypedArrayConstructor=Dg);if((!am||!Ng(Qg)||Qg===Function.prototype)&&(Qg=function(){throw nm("Incorrect invocation")},am))for(bg in cm)Og[bg]&&jg(Og[bg],Qg);if((!am||!em||em===tm)&&(em=Qg.prototype,am))for(bg in cm)Og[bg]&&jg(Og[bg].prototype,em);if(am&&Hg(Zg)!==em&&jg(Zg,em),Lg&&!Ug(em,im))for(bg in sm=!0,qg(em,im,{get:function(){return Pg(this)?this[rm]:void 0}}),cm)Og[bg]&&Fg(Og[bg],rm,bg);var pm={NATIVE_ARRAY_BUFFER_VIEWS:am,TYPED_ARRAY_TAG:sm&&rm,aTypedArray:function(e){if(dm(e))return e;throw nm("Target is not a typed array")},aTypedArrayConstructor:function(e){if(Ng(e)&&(!jg||Bg(Qg,e)))return e;throw nm(Gg(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n,i){if(Lg){if(n)for(var r in cm){var o=Og[r];if(o&&Ug(o.prototype,e))try{delete o.prototype[e]}catch(eM){try{o.prototype[e]=t}catch(a){}}}em[e]&&!n||Vg(em,e,n?t:am&&Jg[e]||t,i)}},exportTypedArrayStaticMethod:function(e,t,n){var i,r;if(Lg){if(jg){if(n)for(i in cm)if((r=Og[i])&&Ug(r,e))try{delete r[e]}catch(eM){}if(Qg[e]&&!n)return;try{return Vg(Qg,e,n?t:am&&Qg[e]||t)}catch(eM){}}for(i in cm)!(r=Og[i])||r[e]&&!n||Vg(r,e,t)}},getTypedArrayConstructor:lm,isView:function(e){if(!Pg(e))return!1;var t=xg(e);return"DataView"===t||Ug(cm,t)||Ug(um,t)},isTypedArray:dm,TypedArray:Qg,TypedArrayPrototype:em},hm=q,fm=h,gm=zs,mm=pm.NATIVE_ARRAY_BUFFER_VIEWS,vm=hm.ArrayBuffer,_m=hm.Int8Array,ym=!mm||!fm((function(){_m(1)}))||!fm((function(){new _m(-1)}))||!gm((function(e){new _m,new _m(null),new _m(1.5),new _m(e)}),!0)||fm((function(){return 1!==new _m(new vm(2),1,void 0).length})),Im=Be,Mm=Math.floor,Tm=Number.isInteger||function(e){return!Im(e)&&isFinite(e)&&Mm(e)===e},Cm=Jt,Sm=RangeError,Em=function(e){var t=Cm(e);if(t<0)throw Sm("The argument can't be less than 0");return t},km=RangeError,bm=function(e,t){var n=Em(e);if(n%t)throw km("Wrong offset");return n},Dm=cs,wm=b("".slice),Am=Lt,Rm=TypeError,Lm=function(e){var t=Am(e,"number");if("number"==typeof t)throw Rm("Can't convert number to bigint");return BigInt(t)},Om=$a,Nm=ot,Pm=xl,Um=ee,xm=an,Gm=Ms,Fm=fs,Vm=Qa,qm=function(e){return"Big"===wm(Dm(e),0,3)},Bm=pm.aTypedArrayConstructor,Hm=Lm,jm=$a,Km=L,zm=ee,Wm=an,Ym=hl,$m=b([].push),Jm=function(e){var t=1==e,n=2==e,i=3==e,r=4==e,o=6==e,a=7==e,s=5==e||o;return function(c,u,l,d){for(var p,h,f=zm(c),g=Km(f),m=jm(u,l),v=Wm(g),_=0,y=d||Ym,I=t?y(c,v):n||a?y(c,0):void 0;v>_;_++)if((s||_ in g)&&(h=m(p=g[_],_,f),e))if(t)I[_]=h;else if(h)switch(e){case 3:return!0;case 5:return p;case 6:return _;case 2:$m(I,p)}else switch(e){case 4:return!1;case 7:$m(I,p)}return o?-1:i||r?r:I}},Xm={forEach:Jm(0),map:Jm(1),filter:Jm(2),some:Jm(3),every:Jm(4),find:Jm(5),findIndex:Jm(6),filterReject:Jm(7)},Zm=jr,Qm=q,ev=ot,tv=Ye,nv=ym,iv=pm,rv=hg,ov=qs,av=oi,sv=ci,cv=Tm,uv=rn,lv=tf,dv=bm,pv=Pt,hv=ie,fv=cs,gv=Be,mv=dt,vv=zn,_v=at,yv=Eo,Iv=dr.f,Mv=function(e){var t,n,i,r,o,a,s,c,u=Pm(this),l=Um(e),d=arguments.length,p=d>1?arguments[1]:void 0,h=void 0!==p,f=Fm(l);if(f&&!Vm(f))for(c=(s=Gm(l,f)).next,l=[];!(a=Nm(c,s)).done;)l.push(a.value);for(h&&d>2&&(p=Om(p,arguments[2])),n=xm(l),i=new(Bm(u))(n),r=qm(i),t=0;n>t;t++)o=h?p(l[t],t):l[t],i[t]=r?Hm(o):+o;return i},Tv=Xm.forEach,Cv=_c,Sv=Je,Ev=Ci,kv=Js,bv=Ti.get,Dv=Ti.set,wv=Ti.enforce,Av=Sv.f,Rv=Ev.f,Lv=Math.round,Ov=Qm.RangeError,Nv=rv.ArrayBuffer,Pv=Nv.prototype,Uv=rv.DataView,xv=iv.NATIVE_ARRAY_BUFFER_VIEWS,Gv=iv.TYPED_ARRAY_TAG,Fv=iv.TypedArray,Vv=iv.TypedArrayPrototype,qv=iv.aTypedArrayConstructor,Bv=iv.isTypedArray,Hv="BYTES_PER_ELEMENT",jv="Wrong length",Kv=function(e,t){qv(e);for(var n=0,i=t.length,r=new e(i);i>n;)r[n]=t[n++];return r},zv=function(e,t){Av(e,t,{get:function(){return bv(this)[t]}})},Wv=function(e){var t;return _v(Pv,e)||"ArrayBuffer"==(t=fv(e))||"SharedArrayBuffer"==t},Yv=function(e,t){return Bv(e)&&!mv(t)&&t in e&&cv(+t)&&t>=0},$v=function(e,t){return t=pv(t),Yv(e,t)?av(2,e[t]):Rv(e,t)},Jv=function(e,t,n){return t=pv(t),!(Yv(e,t)&&gv(n)&&hv(n,"value"))||hv(n,"get")||hv(n,"set")||n.configurable||hv(n,"writable")&&!n.writable||hv(n,"enumerable")&&!n.enumerable?Av(e,t,n):(e[t]=n.value,e)};tv?(xv||(Ev.f=$v,Sv.f=Jv,zv(Vv,"buffer"),zv(Vv,"byteOffset"),zv(Vv,"byteLength"),zv(Vv,"length")),Zm({target:"Object",stat:!0,forced:!xv},{getOwnPropertyDescriptor:$v,defineProperty:Jv}),Ag.exports=function(e,t,n){var i=e.match(/\d+$/)[0]/8,r=e+(n?"Clamped":"")+"Array",o="get"+e,a="set"+e,s=Qm[r],c=s,u=c&&c.prototype,l={},d=function(e,t){Av(e,t,{get:function(){return e=t,(n=bv(this)).view[o](e*i+n.byteOffset,!0);var e,n},set:function(e){return r=t,o=e,s=bv(this),n&&(o=(o=Lv(o))<0?0:o>255?255:255&o),void s.view[a](r*i+s.byteOffset,o,!0);var r,o,s},enumerable:!0})};xv?nv&&(c=t((function(e,t,n,r){return ov(e,u),kv(gv(t)?Wv(t)?void 0!==r?new s(t,dv(n,i),r):void 0!==n?new s(t,dv(n,i)):new s(t):Bv(t)?Kv(c,t):ev(Mv,c,t):new s(lv(t)),e,c)})),yv&&yv(c,Fv),Tv(Iv(s),(function(e){e in c||sv(c,e,s[e])})),c.prototype=u):(c=t((function(e,t,n,r){ov(e,u);var o,a,s,l=0,p=0;if(gv(t)){if(!Wv(t))return Bv(t)?Kv(c,t):ev(Mv,c,t);o=t,p=dv(n,i);var h=t.byteLength;if(void 0===r){if(h%i)throw Ov(jv);if((a=h-p)<0)throw Ov(jv)}else if((a=uv(r)*i)+p>h)throw Ov(jv);s=a/i}else s=lv(t),o=new Nv(a=s*i);for(Dv(e,{buffer:o,byteOffset:p,byteLength:a,length:s,view:new Uv(o)});l<s;)d(e,l++)})),yv&&yv(c,Fv),u=c.prototype=vv(Vv)),u.constructor!==c&&sv(u,"constructor",c),wv(u).TypedArrayConstructor=c,Gv&&sv(u,Gv,r);var p=c!=s;l[r]=c,Zm({global:!0,constructor:!0,forced:p,sham:!xv},l),Hv in c||sv(c,Hv,i),Hv in u||sv(u,Hv,i),Cv(r)}):Ag.exports=function(){},(0,Ag.exports)("Float32",(function(e){return function(t,n,i){return e(this,t,n,i)}}));var Xv=ht,Zv=TypeError,Qv=ee,e_=en,t_=an,n_=function(e,t){if(!delete e[t])throw Zv("Cannot delete property "+Xv(t)+" of "+Xv(e))},i_=Math.min,r_=[].copyWithin||function(e,t){var n=Qv(this),i=t_(n),r=e_(e,i),o=e_(t,i),a=arguments.length>2?arguments[2]:void 0,s=i_((void 0===a?i:e_(a,i))-o,i-r),c=1;for(o<r&&r<o+s&&(c=-1,o+=s-1,r+=s-1);s-- >0;)o in n?n[r]=n[o]:n_(n,r),r+=c,o+=c;return n},o_=pm,a_=b(r_),s_=o_.aTypedArray;(0,o_.exportTypedArrayMethod)("copyWithin",(function(e,t){return a_(s_(this),e,t,arguments.length>2?arguments[2]:void 0)}));var c_=Xm.every,u_=pm.aTypedArray;(0,pm.exportTypedArrayMethod)("every",(function(e){return c_(u_(this),e,arguments.length>1?arguments[1]:void 0)}));var l_=pf,d_=Lm,p_=cs,h_=ot,f_=h,g_=pm.aTypedArray,m_=pm.exportTypedArrayMethod,v_=b("".slice);m_("fill",(function(e){var t=arguments.length;g_(this);var n="Big"===v_(p_(this),0,3)?d_(e):+e;return h_(l_,this,n,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),f_((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})));var __=an,y_=Bl,I_=pm.aTypedArrayConstructor,M_=pm.getTypedArrayConstructor,T_=function(e){return I_(y_(e,M_(e)))},C_=function(e,t){for(var n=0,i=__(t),r=new e(i);i>n;)r[n]=t[n++];return r},S_=T_,E_=Xm.filter,k_=function(e,t){return C_(S_(e),t)},b_=pm.aTypedArray;(0,pm.exportTypedArrayMethod)("filter",(function(e){var t=E_(b_(this),e,arguments.length>1?arguments[1]:void 0);return k_(this,t)}));var D_=Xm.find,w_=pm.aTypedArray;(0,pm.exportTypedArrayMethod)("find",(function(e){return D_(w_(this),e,arguments.length>1?arguments[1]:void 0)}));var A_=Xm.findIndex,R_=pm.aTypedArray;(0,pm.exportTypedArrayMethod)("findIndex",(function(e){return A_(R_(this),e,arguments.length>1?arguments[1]:void 0)}));var L_=Xm.forEach,O_=pm.aTypedArray;(0,pm.exportTypedArrayMethod)("forEach",(function(e){L_(O_(this),e,arguments.length>1?arguments[1]:void 0)}));var N_=dn.includes,P_=pm.aTypedArray;(0,pm.exportTypedArrayMethod)("includes",(function(e){return N_(P_(this),e,arguments.length>1?arguments[1]:void 0)}));var U_=dn.indexOf,x_=pm.aTypedArray;(0,pm.exportTypedArrayMethod)("indexOf",(function(e){return U_(x_(this),e,arguments.length>1?arguments[1]:void 0)}));var G_=q,F_=h,V_=b,q_=pm,B_=ra,H_=Fe("iterator"),j_=G_.Uint8Array,K_=V_(B_.values),z_=V_(B_.keys),W_=V_(B_.entries),Y_=q_.aTypedArray,$_=q_.exportTypedArrayMethod,J_=j_&&j_.prototype,X_=!F_((function(){J_[H_].call([1])})),Z_=!!J_&&J_.values&&J_[H_]===J_.values&&"values"===J_.values.name,Q_=function(){return K_(Y_(this))};$_("entries",(function(){return W_(Y_(this))}),X_),$_("keys",(function(){return z_(Y_(this))}),X_),$_("values",Q_,X_||!Z_,{name:"values"}),$_(H_,Q_,X_||!Z_,{name:"values"});var ey=pm.aTypedArray,ty=pm.exportTypedArrayMethod,ny=b([].join);ty("join",(function(e){return ny(ey(this),e)}));var iy=h,ry=Wl,oy=F,ay=Jt,sy=an,cy=function(e,t){var n=[][e];return!!n&&iy((function(){n.call(null,t||function(){return 1},1)}))},uy=Math.min,ly=[].lastIndexOf,dy=!!ly&&1/[1].lastIndexOf(1,-0)<0,py=cy("lastIndexOf"),hy=dy||!py?function(e){if(dy)return ry(ly,this,arguments)||0;var t=oy(this),n=sy(t),i=n-1;for(arguments.length>1&&(i=uy(i,ay(arguments[1]))),i<0&&(i=n+i);i>=0;i--)if(i in t&&t[i]===e)return i||0;return-1}:ly,fy=Wl,gy=hy,my=pm.aTypedArray;(0,pm.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return fy(gy,my(this),t>1?[e,arguments[1]]:[e])}));var vy=Xm.map,_y=T_,yy=pm.aTypedArray;(0,pm.exportTypedArrayMethod)("map",(function(e){return vy(yy(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(_y(e))(t)}))}));var Iy=vt,My=ee,Ty=L,Cy=an,Sy=TypeError,Ey=function(e){return function(t,n,i,r){Iy(n);var o=My(t),a=Ty(o),s=Cy(o),c=e?s-1:0,u=e?-1:1;if(i<2)for(;;){if(c in a){r=a[c],c+=u;break}if(c+=u,e?c<0:s<=c)throw Sy("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=u)c in a&&(r=n(r,a[c],c,o));return r}},ky={left:Ey(!1),right:Ey(!0)},by=ky.left,Dy=pm.aTypedArray;(0,pm.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return by(Dy(this),e,t,t>1?arguments[1]:void 0)}));var wy=ky.right,Ay=pm.aTypedArray;(0,pm.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return wy(Ay(this),e,t,t>1?arguments[1]:void 0)}));var Ry=pm.aTypedArray,Ly=pm.exportTypedArrayMethod,Oy=Math.floor;Ly("reverse",(function(){for(var e,t=this,n=Ry(t).length,i=Oy(n/2),r=0;r<i;)e=t[r],t[r++]=t[--n],t[n]=e;return t}));var Ny=q,Py=ot,Uy=pm,xy=an,Gy=bm,Fy=ee,Vy=h,qy=Ny.RangeError,By=Ny.Int8Array,Hy=By&&By.prototype,jy=Hy&&Hy.set,Ky=Uy.aTypedArray,zy=Uy.exportTypedArrayMethod,Wy=!Vy((function(){var e=new Uint8ClampedArray(2);return Py(jy,e,{length:1,0:3},1),3!==e[1]})),Yy=Wy&&Uy.NATIVE_ARRAY_BUFFER_VIEWS&&Vy((function(){var e=new By(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));zy("set",(function(e){Ky(this);var t=Gy(arguments.length>1?arguments[1]:void 0,1),n=Fy(e);if(Wy)return Py(jy,this,n,t);var i=this.length,r=xy(n),o=0;if(r+t>i)throw qy("Wrong length");for(;o<r;)this[t+o]=n[o++]}),!Wy||Yy);var $y=T_,Jy=Pu,Xy=pm.aTypedArray;(0,pm.exportTypedArrayMethod)("slice",(function(e,t){for(var n=Jy(Xy(this),e,t),i=$y(this),r=0,o=n.length,a=new i(o);o>r;)a[r]=n[r++];return a}),h((function(){new Int8Array(1).slice()})));var Zy=Xm.some,Qy=pm.aTypedArray;(0,pm.exportTypedArrayMethod)("some",(function(e){return Zy(Qy(this),e,arguments.length>1?arguments[1]:void 0)}));var eI=va,tI=Math.floor,nI=function(e,t){var n=e.length,i=tI(n/2);return n<8?iI(e,t):rI(e,nI(eI(e,0,i),t),nI(eI(e,i),t),t)},iI=function(e,t){for(var n,i,r=e.length,o=1;o<r;){for(i=o,n=e[o];i&&t(e[i-1],n)>0;)e[i]=e[--i];i!==o++&&(e[i]=n)}return e},rI=function(e,t,n,i){for(var r=t.length,o=n.length,a=0,s=0;a<r||s<o;)e[a+s]=a<r&&s<o?i(t[a],n[s])<=0?t[a++]:n[s++]:a<r?t[a++]:n[s++];return e},oI=nI,aI=ve.match(/firefox\/(\d+)/i),sI=!!aI&&+aI[1],cI=/MSIE|Trident/.test(ve),uI=ve.match(/AppleWebKit\/(\d+)\./),lI=!!uI&&+uI[1],dI=b,pI=h,hI=vt,fI=oI,gI=sI,mI=cI,vI=Se,_I=lI,yI=pm.aTypedArray,II=pm.exportTypedArrayMethod,MI=q.Uint16Array,TI=MI&&dI(MI.prototype.sort),CI=!(!TI||pI((function(){TI(new MI(2),null)}))&&pI((function(){TI(new MI(2),{})}))),SI=!!TI&&!pI((function(){if(vI)return vI<74;if(gI)return gI<67;if(mI)return!0;if(_I)return _I<602;var e,t,n=new MI(516),i=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,i[e]=e-2*t+3;for(TI(n,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==i[e])return!0}));II("sort",(function(e){return void 0!==e&&hI(e),SI?TI(this,e):fI(yI(this),(t=e,function(e,n){return void 0!==t?+t(e,n)||0:n!=n?-1:e!=e?1:0===e&&0===n?1/e>0&&1/n<0?1:-1:e>n}));var t}),!SI||CI);var EI=rn,kI=en,bI=T_,DI=pm.aTypedArray;(0,pm.exportTypedArrayMethod)("subarray",(function(e,t){var n=DI(this),i=n.length,r=kI(e,i);return new(bI(n))(n.buffer,n.byteOffset+r*n.BYTES_PER_ELEMENT,EI((void 0===t?i:kI(t,i))-r))}));var wI=Wl,AI=pm,RI=h,LI=Pu,OI=q.Int8Array,NI=AI.aTypedArray,PI=AI.exportTypedArrayMethod,UI=[].toLocaleString,xI=!!OI&&RI((function(){UI.call(new OI(1))}));PI("toLocaleString",(function(){return wI(UI,xI?LI(NI(this)):NI(this),LI(arguments))}),RI((function(){return[1,2].toLocaleString()!=new OI([1,2]).toLocaleString()}))||!RI((function(){OI.prototype.toLocaleString.call([1,2])})));var GI=pm.exportTypedArrayMethod,FI=h,VI=b,qI=q.Uint8Array,BI=qI&&qI.prototype||{},HI=[].toString,jI=VI([].join);FI((function(){HI.call({})}))&&(HI=function(){return jI(this)});var KI=BI.toString!=HI;GI("toString",HI,KI),jr({global:!0,constructor:!0,forced:!Xh},{DataView:hg.DataView});var zI=_c,WI="ArrayBuffer",YI=hg.ArrayBuffer;function $I(e,t){t=t||{};var n,i,r,o,a,s,c,u,l,d=e.numberOfChannels,p=e.sampleRate,h=t.float32?3:1,f=3===h?32:16;return n=2===d?function(e,t){for(var n=e.length+t.length,i=new Float32Array(n),r=0,o=0;r<n;)i[r++]=e[o],i[r++]=t[o],o++;return i}(e.getChannelData(0),e.getChannelData(1)):e.getChannelData(0),i=h,r=p,c=(o=d)*(s=(a=f)/8),u=new ArrayBuffer(44+n.length*s),JI(l=new DataView(u),0,"RIFF"),l.setUint32(4,36+n.length*s,!0),JI(l,8,"WAVE"),JI(l,12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,i,!0),l.setUint16(22,o,!0),l.setUint32(24,r,!0),l.setUint32(28,r*c,!0),l.setUint16(32,c,!0),l.setUint16(34,a,!0),JI(l,36,"data"),l.setUint32(40,n.length*s,!0),1===i?function(e,t,n){for(var i=0;i<n.length;i++,t+=2){var r=Math.max(-1,Math.min(1,n[i]));e.setInt16(t,r<0?32768*r:32767*r,!0)}}(l,44,n):function(e,t,n){for(var i=0;i<n.length;i++,t+=4)e.setFloat32(t,n[i],!0)}(l,44,n),u}function JI(e,t,n){for(var i=0;i<n.length;i++)e.setUint8(t+i,n.charCodeAt(i))}jr({global:!0,constructor:!0,forced:q.ArrayBuffer!==YI},{ArrayBuffer:YI}),zI(WI);var XI=function(){function e(t){c(this,e),this.audioContext_=t,this.inputPCM_=new Float32Array,this.outputPCM_=new Float32Array}return l(e,[{key:"onDump",value:function(e,t){if(t===Kh){var n=this.inputPCM_.length,i=new Float32Array(n+e[0].length);i.set(this.inputPCM_),i.set(e[0],n),this.inputPCM_=i}if(t===zh){var r=this.outputPCM_.length,o=new Float32Array(r+e[0].length);o.set(this.outputPCM_),o.set(e[0],r),this.outputPCM_=o}}},{key:"getBlob",value:function(e){var t=e===Kh?this.inputPCM_:this.outputPCM_,n=this.audioContext_.createBuffer(2,t.length,48e3);n.copyToChannel(t,0,0),n.copyToChannel(t,1,0);var i=$I(n);return n=null,new window.Blob([new DataView(i)],{type:"audio/wav"})}},{key:"reset",value:function(){this.inputPCM_=new Float32Array,this.outputPCM_=new Float32Array}},{key:"destroy",value:function(){this.inputPCM_=null,this.outputPCM_=null}}]),e}(),ZI=function(){function e(t){var n=this,i=t.sdkAppId,r=t.userId,o=t.audioContext,a=t.sign,s=t.status,u=t.worklet,l=t.timestamp,d=t.logger;c(this,e),this.audioContext_=o,this.destination_=this.audioContext_.createMediaStreamDestination(),this.gainNode_=this.audioContext_.createGain(),this.gainNode_.gain.value=1.1,this.log_=d,this.workletNode_=u,this.workletNode_.connect(this.gainNode_).connect(this.destination_),this.workletNode_.port.postMessage({type:"init",data:{sdkAppId:String(i),userId:r,timestamp:l,sign:a,status:s}}),this.workletNode_.port.onmessage=function(e){var t=e.data,i=t.type,r=t.data;if("ondump"===i&&n.isDumping_){var o=r.inputPCM,a=r.outputPCM;n.dump_.onDump(o,Kh),n.dump_.onDump(a,zh)}"dumped"===i&&n.dumped()},this.trackConstraint_={},this.localStream_=null,this.audioTrack_=null,this.source_=null,this.denoiserTrack_=null,this.enableDenoise_=!0,this.emitter_=new Jh,this.dump_=new XI(this.audioContext_)}var t,i,r,a;return l(e,[{key:"dumped",value:function(){this.isDumping_=!1;var e=this.dump_.getBlob(Kh),t=this.dump_.getBlob(zh);this.emitter_.emit("ondumpend",{blob:e,name:Kh}),this.emitter_.emit("ondumpend",{blob:t,name:zh}),this.dump_.reset()}},{key:"process",value:(a=s(o().mark((function e(t){var n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.localStream_=t,this.log_.info("RTCAIDenoiser: denoiser process stream ID: ".concat(t.getId(),".")),this.audioTrack_=null==t?void 0:t.getAudioTrack(),this.audioTrack_){e.next=5;break}throw new Error("RTCAIDenoiser: cannot process localStream without audioTrack.");case 5:return(n=new MediaStream).addTrack(this.audioTrack_),this.source_=this.audioContext_.createMediaStreamSource(n),e.next=10,this.source_.connect(this.workletNode_);case 10:return this.trackConstraint_=this.audioTrack_.getConstraints(),this.trackConstraint_.noiseSuppression=!1,e.next=14,this.audioTrack_.applyConstraints(this.trackConstraint_);case 14:return i=this.destination_.stream,this.denoiserTrack_=i.getAudioTracks()[0],e.next=18,this.localStream_.replaceTrack(this.denoiserTrack_);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"updateTrack",value:(r=s(o().mark((function e(t){var n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new MediaStream,e.next=3,n.addTrack(t);case 3:i=this.audioContext_.createMediaStreamSource(n),this.source_.disconnect(),i.connect(this.workletNode_),this.audioTrack_.stop(),this.audioTrack_=t,this.source_=i,this.log_.info("RTCAIDenoiser: ".concat(this.localStream_.getUserId()," updateTrack success."));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"disable",value:(i=s(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.enableDenoise_=!1,null===(t=this.workletNode_)||void 0===t||t.port.postMessage({type:"disable"}),this.trackConstraint_.noiseSuppression=!0,e.next=5,this.audioTrack_.applyConstraints(this.trackConstraint_);case 5:return this.log_.info("RTCAIDenoiser: disable ai denoiser."),e.abrupt("return",this.enableDenoise_);case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"enable",value:(t=s(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.enableDenoise_=!0,null===(t=this.workletNode_)||void 0===t||t.port.postMessage({type:"enable"}),this.trackConstraint_.noiseSuppression=!1,e.next=5,this.audioTrack_.applyConstraints(this.trackConstraint_);case 5:return this.log_.info("RTCAIDenoiser: enable ai denoiser."),e.abrupt("return",this.enableDenoise_);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"startDump",value:function(){return this.isDumping_?(this.log_.info("RTCAIDenoiser: data is currently being dumped."),!1):(this.workletNode_.port.postMessage({type:"startDump"}),this.dump_?this.dump_.reset():this.dump_=new XI(this.audioContext_),this.isDumping_=!0,this.log_.info("RTCAIDenoiser: start dump data."),!0)}},{key:"stopDump",value:function(){this.workletNode_.port.postMessage({type:"stopDump"}),this.isDumping_=!1,this.log_.info("RTCAIDenoiser: stop dump data.")}},{key:"getAudioTrack",value:function(){return this.audioTrack_}},{key:"getDenoiserTrack",value:function(){return this.denoiserTrack_}},{key:"enabled",get:function(){return this.enableDenoise_}},{key:"destroy",value:function(){var e,t,n,i,r,o,a;this.log_.info("RTCAIDenoiser: ".concat(this.localStream_.getUserId()," destroy processor.")),null===(e=this.localStream_)||void 0===e||e.stop(),null===(t=this.audioTrack_)||void 0===t||t.stop(),null===(n=this.workletNode_)||void 0===n||n.port.postMessage({type:"destroy"}),this.workletNode_.port.onmessage=null,null===(i=this.source_)||void 0===i||i.disconnect(),null===(r=this.destination_)||void 0===r||r.disconnect(),null===(o=this.workletNode_)||void 0===o||o.disconnect(),null===(a=this.dump_)||void 0===a||a.destroy(),this.emitter_.removeAllListeners()}},{key:"on",value:function(e,t,n){this.emitter_.on(e,t,n)}},{key:"off",value:function(e,t,n){"*"===e?this.emitter_.removeAllListeners():this.emitter_.off(e,t,n)}},{key:"resetDenoiser",value:function(e){if(n.default){var t=n.default.DenoiserMap;null!=t&&t.has(e.getUserId())&&t.delete(e.getUserId())}}}]),e}();n.default&&(n.default.addDenoiserProcessor=function(e){var t=e.processor,i=e.userId;if(n.default.DenoiserMap)n.default.DenoiserMap.set(i,t);else{var r=new Map;r.set(i,t),n.default.DenoiserMap=r}});var QI=function(){function e(t){var n=t.assetsPath;c(this,e),this.audioContext_=jh(),this.assetsPath_=n,this.isLoaded_=!1}var t,i,a;return l(e,[{key:"createProcessor",value:(a=s(o().mark((function e(t){var i,a,s,c,u,l,d,p,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.default?n.default.Logger.loggerManager.createLogger({id:t.userId,userId:t.userId,sdkAppId:t.sdkAppId}):{info:console.log},a=String(Date.now()).slice(0,-3),e.next=4,Wh(r(r({},t),{},{timestamp:a}));case 4:if(s=e.sent,c=s.auth,u=s.sign,l=s.status,d=s.message,c){e.next=12;break}throw i.info("RTCAIDenoiser: ".concat(t.userId," auth result: ").concat(c,". Message: ").concat(d)),new Error(d);case 12:return e.next=14,this.load();case 14:return e.next=16,this.initWorklet();case 16:return p=e.sent,h=new ZI(r(r({},t),{},{audioContext:this.audioContext_,timestamp:a,sign:u,status:l,worklet:p,logger:i})),i.info("RTCAIDenoiser: ".concat(t.userId," create denoiser processor success.")),n.default&&n.default.addDenoiserProcessor({processor:h,userId:t.userId}),e.abrupt("return",h);case 21:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"load",value:(i=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLoaded_){e.next=10;break}return e.prev=1,e.next=4,this.audioContext_.audioWorklet.addModule("".concat(this.assetsPath_,"/denoiser-wasm.js"));case 4:this.isLoaded_=!0,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1);case 10:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(){return i.apply(this,arguments)})},{key:"initWorklet",value:(t=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",new AudioWorkletNode(this.audioContext_,"trtc-denoiser-processor",{numberOfInputs:1,numberOfOutputs:1}));case 4:return e.prev=4,e.t0=e.catch(0),e.next=8,this.load();case 8:return e.abrupt("return",new AudioWorkletNode(this.audioContext_,"trtc-denoiser-processor",{numberOfInputs:1,numberOfOutputs:1}));case 9:case"end":return e.stop()}}),e,this,[[0,4]])}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e;null===(e=this.audioContext_)||void 0===e||e.close()}},{key:"isSupported",value:function(){return"AudioWorklet"in window&&"WebAssembly"in window}}]),e}();return QI}(hP())),gP}var _P,yP={},IP={get exports(){return yP},set exports(e){yP=e}};function MP(){return _P||(_P=1,window,IP.exports=(e=su(),function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t,n){n.d(t,"e",(function(){return a})),n.d(t,"g",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"f",(function(){return u})),n.d(t,"b",(function(){return d})),n.d(t,"d",(function(){return p})),n.d(t,"a",(function(){return g})),n.d(t,"h",(function(){return m}));const i="undefined"!=typeof window,r=("undefined"!=typeof wx&&wx.getSystemInfoSync,i&&window.navigator&&window.navigator.userAgent||""),o=/AppleWebKit\/([\d.]+)/i.exec(r);o&&parseFloat(o.pop()),/iPad/i.test(r),function(){const e=r.match(/OS (\d+)_/i);e&&e[1]&&e[1]}(),/Android/i.test(r),function(){const e=r.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;const t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);t&&n&&parseFloat(e[1]+"."+e[2])}(),function(){const e=r.match(/Chrome\/(\d+)/);e&&e[1]&&parseFloat(e[1])}(),function(){const e=/MSIE\s(\d+)\.\d/.exec(r);e&&parseFloat(e[1])}(),/TBS\/\d+/i.test(r),function(){const e=r.match(/TBS\/(\d+)/i);e&&e[1]&&e[1]}(),n(2),n(1);const a=function(e){return"map"===h(e)},s=function(e){return"set"===h(e)},c=function(e){return"file"===h(e)},u=function(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);if(null===t)return!0;let n=t;for(;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n},l=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"array"===h(e)},d=function(e){return l(e)||null!==(t=e)&&"object"==typeof t;var t},p=function(e){return e instanceof Error},h=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()};let f=0;Date.now||(Date.now=function(){return(new Date).getTime()});const g={now:function(){0===f&&(f=Date.now()-1);const e=Date.now()-f;return e>4294967295?(f+=4294967295,Date.now()-f):e},utc:function(){return Math.round(Date.now()/1e3)}},m=function(e){return JSON.stringify(e,["message","code"])}},function(e,t,n){n.r(t);var i=n(3),r=n(0);let o=0;const a=new Map;function s(){const e=new Date;return"TSignaling "+e.toLocaleTimeString("en-US",{hour12:!1})+"."+function(e){let t;switch(e.toString().length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}return t}(e.getMilliseconds())+":"}const c={_data:[],_length:0,_visible:!1,arguments2String(e){let t;if(1===e.length)t=s()+e[0];else{t=s();for(let n=0,i=e.length;n<i;n++)Object(r.b)(e[n])?Object(r.d)(e[n])?t+=Object(r.h)(e[n]):t+=JSON.stringify(e[n]):t+=e[n],t+=" "}return t},debug:function(){if(o<=-1){const e=this.arguments2String(arguments);c.record(e,"debug"),i.a.debug(e)}},log:function(){if(o<=0){const e=this.arguments2String(arguments);c.record(e,"log"),i.a.log(e)}},info:function(){if(o<=1){const e=this.arguments2String(arguments);c.record(e,"info"),i.a.info(e)}},warn:function(){if(o<=2){const e=this.arguments2String(arguments);c.record(e,"warn"),i.a.warn(e)}},error:function(){if(o<=3){const e=this.arguments2String(arguments);c.record(e,"error"),i.a.error(e)}},time:function(e){a.set(e,r.a.now())},timeEnd:function(e){if(a.has(e)){const t=r.a.now()-a.get(e);return a.delete(e),t}return i.a.warn(`未找到对应label: ${e}, 请在调用 logger.timeEnd 前，调用 logger.time`),0},setLevel:function(e){e<4&&i.a.log(s()+"set level from "+o+" to "+e),o=e},record:function(e,t){1100===c._length&&(c._data.splice(0,100),c._length=1e3),c._length++,c._data.push(`${e} [${t}] \n`)},getLog:function(){return c._data}};t.default=c},function(e,t,n){n.r(t),t.default={MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",ENTER_ROOM_SUCCESS:"JoinedSuccess",ALREADY_IN_ROOM:"AlreadyInGroup"}},function(e,t,n){(function(e){let n,i;n="undefined"!=typeof console?console:void 0!==e&&e.console?e.console:"undefined"!=typeof window&&window.console?window.console:{};const r=function(){},o=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];let a=o.length;for(;a--;)i=o[a],console[i]||(n[i]=r);t.a=n}).call(this,n(9))},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default={NEW_INVITATION_RECEIVED:"ts_new_invitation_received",INVITEE_ACCEPTED:"ts_invitee_accepted",INVITEE_REJECTED:"ts_invitee_rejected",INVITATION_CANCELLED:"ts_invitation_cancelled",INVITATION_TIMEOUT:"ts_invitation_timeout",SDK_READY:"ts_im_ready",SDK_NOT_READY:"ts_im_not_ready",TEXT_MESSAGE_RECEIVED:"ts_text_message_received",CUSTOM_MESSAGE_RECEIVED:"ts_custom_message_received",REMOTE_USER_JOIN:"ts_remote_user_join",REMOTE_USER_LEAVE:"ts_remote_user_leave",KICKED_OUT:"ts_kicked_out",NET_STATE_CHANGE:"ts_net_state_change",MESSAGE_SENT_BY_ME:"ts_message_sent_by_me"}},function(e,t,n){var i,r,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorCode=t.BusinessID=t.ActionType=void 0,(a=i||(i={}))[a.INVITE=1]="INVITE",a[a.CANCEL_INVITE=2]="CANCEL_INVITE",a[a.ACCEPT_INVITE=3]="ACCEPT_INVITE",a[a.REJECT_INVITE=4]="REJECT_INVITE",a[a.INVITE_TIMEOUT=5]="INVITE_TIMEOUT",t.ActionType=i,function(e){e[e.SIGNAL=1]="SIGNAL"}(r||(r={})),t.BusinessID=r,function(e){e[e.ERR_INVALID_PARAMETERS=6017]="ERR_INVALID_PARAMETERS",e[e.ERR_SDK_SIGNALING_INVALID_INVITE_ID=8010]="ERR_SDK_SIGNALING_INVALID_INVITE_ID",e[e.ERR_SDK_SIGNALING_NO_PERMISSION=8011]="ERR_SDK_SIGNALING_NO_PERMISSION"}(o||(o={})),t.ErrorCode=o},function(t,n){t.exports=e},function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i};Object.defineProperty(t,"__esModule",{value:!0});var a=n(5),s=n(8),c=n(4),u=n(2),l=n(1),d=n(10),p=n(11),h=n(12),f=n(13),g=n(6),m=n(15).version,v=n(16),_=function(){function e(e){if(this._outerEmitter=null,this._safetyCallbackFactory=null,this._tim=null,this._imSDKAppID=0,this._userID=null,this._groupID="",this._isHandling=!1,this._inviteInfoMap=new Map,this._isRejectNotifyAll=!1,this.offlineSupport=!0,l.default.info("TSignaling version:"+m),d.default(e.SDKAppID))return l.default.error("TSignaling 请传入 SDKAppID !!!"),null;d.default(e.offlineSupport)||"boolean"!=typeof e.offlineSupport?this.offlineSupport=!0:this.offlineSupport=e.offlineSupport,this._outerEmitter=new s.default,this._outerEmitter._emit=this._outerEmitter.emit,this._outerEmitter.emit=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=[e[0],{name:e[0],data:e[1]}];this._outerEmitter._emit.apply(this._outerEmitter,o(n))}.bind(this),this._safetyCallbackFactory=new h.default,e.tim?this._tim=e.tim:this._tim=g.create({SDKAppID:e.SDKAppID,scene:"TSignaling"}),e.isRejectNotifyAll&&(this._isRejectNotifyAll=!0),this.messageClient=new v.default({tim:this._tim}),this._imSDKAppID=e.SDKAppID,this._tim.on(g.EVENT.SDK_READY,this._onIMReady.bind(this)),this._tim.on(g.EVENT.SDK_NOT_READY,this._onIMNotReady.bind(this)),this._tim.on(g.EVENT.KICKED_OUT,this._onKickedOut.bind(this)),this._tim.on(g.EVENT.NET_STATE_CHANGE,this._onNetStateChange.bind(this)),this._tim.on(g.EVENT.MESSAGE_RECEIVED,this._onMessageReceived.bind(this))}return e.prototype.setLogLevel=function(e){l.default.setLevel(e),this._tim.setLogLevel(e)},e.prototype.login=function(e){return i(this,void 0,void 0,(function(){return r(this,(function(t){return l.default.log("TSignaling.login",e),this._userID=e.userID,[2,this._tim.login(e)]}))}))},e.prototype.logout=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){return l.default.log("TSignaling.logout"),this._userID="",this._inviteInfoMap.clear(),[2,this._tim.logout()]}))}))},e.prototype.on=function(e,t,n){l.default.log("TSignaling.on eventName:"+e),this._outerEmitter.on(e,this._safetyCallbackFactory.defense(e,t,n),n)},e.prototype.off=function(e,t){l.default.log("TSignaling.off eventName:"+e);var n=this._safetyCallbackFactory.find(e,t);null!==n&&(this._outerEmitter.off(e,n),this._safetyCallbackFactory.delete(e,t))},e.prototype.joinGroup=function(e){return i(this,void 0,void 0,(function(){return r(this,(function(t){return l.default.log("TSignaling.joinGroup groupID:"+e),this._groupID=e,[2,this._tim.joinGroup({groupID:e})]}))}))},e.prototype.quitGroup=function(e){return i(this,void 0,void 0,(function(){return r(this,(function(t){return l.default.log("TSignaling.quitGroup groupID:"+e),[2,this._tim.quitGroup(e)]}))}))},e.prototype.sendTextMessage=function(e){return i(this,void 0,void 0,(function(){var t;return r(this,(function(n){return t=this._tim.createTextMessage({to:e.to,conversationType:!0===e.groupFlag?g.TYPES.CONV_GROUP:g.TYPES.CONV_C2C,priority:e.priority||g.TYPES.MSG_PRIORITY_NORMAL,payload:{text:e.text}}),[2,this._tim.sendMessage(t)]}))}))},e.prototype.sendCustomMessage=function(e){return i(this,void 0,void 0,(function(){var t;return r(this,(function(n){return t=this._tim.createCustomMessage({to:e.to,conversationType:!0===e.groupFlag?g.TYPES.CONV_GROUP:g.TYPES.CONV_C2C,priority:e.priority||g.TYPES.MSG_PRIORITY_NORMAL,payload:{data:e.data||"",description:e.description||"",extension:e.extension||""}}),[2,this._tim.sendMessage(t)]}))}))},e.prototype.invite=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,s,c,u;return r(this,(function(r){switch(r.label){case 0:return t=f.generate(),l.default.log("TSignaling.invite",e,"inviteID="+t),d.default(e)||d.default(e.userID)?[2,Promise.reject(new p.default({code:a.ErrorCode.ERR_INVALID_PARAMETERS,message:"userID is invalid"}))]:(n=e.userID,i=e.data,o=e.timeout,s=e.offlinePushInfo,c={businessID:a.BusinessID.SIGNAL,inviteID:t,inviter:this._userID,actionType:a.ActionType.INVITE,inviteeList:[n],data:i,timeout:d.default(o)?0:o,groupID:""},[4,this._sendCustomMessage(n,c,s)]);case 1:return 0===(u=r.sent()).code?(l.default.log("TSignaling.invite ok"),this._inviteInfoMap.set(t,c),this._startTimer(c,!0),[2,{inviteID:t,code:u.code,data:u.data}]):[2,u]}}))}))},e.prototype.inviteSync=function(e,t,n){var i=f.generate();l.default.log("TSignaling.inviteSync",e,"inviteID="+i),(d.default(e)||d.default(e.userID))&&n&&n(a.ErrorCode.ERR_INVALID_PARAMETERS,"userID is missing");var r=e.userID,o=e.data,s=e.timeout,c=e.offlinePushInfo,u={businessID:a.BusinessID.SIGNAL,inviteID:i,inviter:this._userID,actionType:a.ActionType.INVITE,inviteeList:[r],data:o,timeout:d.default(s)?0:s,groupID:""};return this._sendCustomMessageSync(r,u,(function(){l.default.log("TSignaling.inviteSync ok"),t&&t()}),(function(e,t){n&&n(e,t)}),c),i},e.prototype.inviteInGroup=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,s,c,u,h;return r(this,(function(r){switch(r.label){case 0:return t=f.generate(),l.default.log("TSignaling.inviteInGroup",e,"inviteID="+t),d.default(e)||d.default(e.groupID)?[2,Promise.reject(new p.default({code:a.ErrorCode.ERR_INVALID_PARAMETERS,message:"groupID is invalid"}))]:(n=e.groupID,i=e.inviteeList,o=e.data,s=e.timeout,c=e.offlinePushInfo,u={businessID:a.BusinessID.SIGNAL,inviteID:t,inviter:this._userID,actionType:a.ActionType.INVITE,inviteeList:i,data:o,timeout:d.default(s)?0:s,groupID:n},[4,this._sendCustomMessage(n,u,c)]);case 1:return 0===(h=r.sent()).code?(l.default.log("TSignaling.inviteInGroup ok"),this._inviteInfoMap.set(t,u),this._startTimer(u,!0),[2,{inviteID:t,code:h.code,data:h.data}]):[2,h]}}))}))},e.prototype.inviteInGroupSync=function(e,t,n){var i=f.generate();l.default.log("TSignaling.inviteInGroupSync",e,"inviteID="+i),(d.default(e)||d.default(e.groupID))&&n&&n(a.ErrorCode.ERR_INVALID_PARAMETERS,"groupID is missing");var r=e.groupID,o=e.inviteeList,s=e.data,c=e.timeout,u=e.offlinePushInfo,p={businessID:a.BusinessID.SIGNAL,inviteID:i,inviter:this._userID,actionType:a.ActionType.INVITE,inviteeList:o,data:s,timeout:d.default(c)?0:c,groupID:r};return this._sendCustomMessageSync(r,p,(function(){l.default.log("TSignaling.inviteInGroupSync ok"),t&&t()}),(function(e,t){n&&n(e,t)}),u),i},e.prototype.cancel=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,s,c,u,h,f;return r(this,(function(r){switch(r.label){case 0:return l.default.log("TSignaling.cancel",e),d.default(e)||d.default(e.inviteID)||!this._inviteInfoMap.has(e.inviteID)||this._isHandling?[2,Promise.reject(new p.default({code:a.ErrorCode.ERR_SDK_SIGNALING_INVALID_INVITE_ID,message:"inviteID is invalid or invitation has been processed"}))]:(this._isHandling=!0,t=e.inviteID,n=e.data,i=this._inviteInfoMap.get(t),o=i.inviter,s=i.groupID,c=i.inviteeList,o!==this._userID?[3,2]:(u={businessID:a.BusinessID.SIGNAL,inviteID:t,inviter:o,actionType:a.ActionType.CANCEL_INVITE,inviteeList:c,data:n,timeout:0,groupID:s},h=s||c[0],[4,this._sendCustomMessage(h,u)]));case 1:return f=r.sent(),this._isHandling=!1,f&&0===f.code?(l.default.log("TSignaling.cancel ok"),this._deleteInviteInfoByID(t),[2,{inviteID:t,code:f.code,data:f.data}]):[2,f];case 2:return l.default.error("TSignaling.cancel unmatched inviter="+o+" and userID="+this._userID),this._isHandling=!1,[2,Promise.reject(new p.default({code:a.ErrorCode.ERR_SDK_SIGNALING_NO_PERMISSION,message:"信令请求无权限，比如取消非自己发起的邀请，接受或则拒绝非发给自己的邀请"}))]}}))}))},e.prototype.accept=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,s,c,u,h;return r(this,(function(r){switch(r.label){case 0:return l.default.log("TSignaling.accept",e),d.default(e)||d.default(e.inviteID)||!this._inviteInfoMap.has(e.inviteID)||this._isHandling?[2,Promise.reject(new p.default({code:a.ErrorCode.ERR_SDK_SIGNALING_INVALID_INVITE_ID,message:"inviteID is invalid or invitation has been processed"}))]:(this._isHandling=!0,t=e.inviteID,n=e.data,i=this._inviteInfoMap.get(t),o=i.inviter,s=i.groupID,i.inviteeList.includes(this._userID)?(c={businessID:a.BusinessID.SIGNAL,inviteID:t,inviter:o,actionType:a.ActionType.ACCEPT_INVITE,inviteeList:[this._userID],data:n,timeout:0,groupID:s},u=s||o,[4,this._sendCustomMessage(u,c)]):[3,2]);case 1:return h=r.sent(),this._isHandling=!1,h&&0===h.code?(l.default.log("TSignaling.accept ok"),this._updateLocalInviteInfo(c),[2,{inviteID:t,code:h.code,data:h.data}]):[2,h];case 2:return l.default.error("TSignaling.accept inviteeList do not include userID="+this._userID+". inviteID="+t+" groupID="+s),this._isHandling=!1,[2,Promise.reject(new p.default({code:a.ErrorCode.ERR_SDK_SIGNALING_INVALID_INVITE_ID,message:"inviteID is invalid or invitation has been processed"}))]}}))}))},e.prototype.reject=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,s,c,u,h;return r(this,(function(r){switch(r.label){case 0:return l.default.log("TSignaling.reject",e),d.default(e)||d.default(e.inviteID)||!this._inviteInfoMap.has(e.inviteID)||this._isHandling?[2,Promise.reject(new p.default({code:a.ErrorCode.ERR_SDK_SIGNALING_INVALID_INVITE_ID,message:"inviteID is invalid or invitation has been processed"}))]:(this._isHandling=!0,t=e.inviteID,n=e.data,i=this._inviteInfoMap.get(t),o=i.inviter,s=i.groupID,i.inviteeList.includes(this._userID)?(c={businessID:a.BusinessID.SIGNAL,inviteID:t,inviter:o,actionType:a.ActionType.REJECT_INVITE,inviteeList:[this._userID],data:n,timeout:0,groupID:s},u=s||o,[4,this._sendCustomMessage(u,c)]):[3,2]);case 1:return h=r.sent(),this._isHandling=!1,h&&0===h.code?(l.default.log("TSignaling.reject ok"),this._updateLocalInviteInfo(c),[2,{inviteID:t,code:h.code,data:h.data}]):[2,h];case 2:return l.default.error("TSignaling.reject inviteeList do not include userID="+this._userID+". inviteID="+t+" groupID="+s),this._isHandling=!1,[2,Promise.reject(new p.default({code:a.ErrorCode.ERR_SDK_SIGNALING_INVALID_INVITE_ID,message:"inviteID is invalid or invitation has been processed"}))]}}))}))},e.prototype._onIMReady=function(e){return i(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return l.default.log("TSignaling._onIMReady"),this._outerEmitter.emit(c.default.SDK_READY),!0!==this.offlineSupport?[3,2]:[4,this.messageClient.getHistoricalSignaling()];case 1:e=t.sent(),!d.default(e)&&this._onMessageReceived({data:e}),t.label=2;case 2:return[2]}}))}))},e.prototype._onIMNotReady=function(e){l.default.log("TSignaling.onSdkNotReady"),this._outerEmitter.emit(c.default.SDK_NOT_READY)},e.prototype._onKickedOut=function(e){l.default.log("TSignaling._onKickedOut"),this._outerEmitter.emit(c.default.KICKED_OUT,e.data)},e.prototype._onNetStateChange=function(e){l.default.log("TSignaling._onNetStateChange"),this._outerEmitter.emit(c.default.NET_STATE_CHANGE,e.data)},e.prototype._onMessageReceived=function(e){var t=this;l.default.log("TSignaling._onMessageReceived inviteID="+JSON.stringify(e));var n=e.data,i=n.filter((function(e){return e.type===g.TYPES.MSG_TEXT}));l.default.log("TSignaling._onMessageReceived textMessages"+JSON.stringify(i)),d.default(i)||this._outerEmitter.emit(c.default.TEXT_MESSAGE_RECEIVED,i);var r=n.filter((function(e){return e.type===g.TYPES.MSG_GRP_TIP&&e.payload.operationType===g.TYPES.GRP_TIP_MBR_JOIN}));d.default(r)||this._outerEmitter.emit(c.default.REMOTE_USER_JOIN,r);var o=n.filter((function(e){return e.type===g.TYPES.MSG_GRP_TIP&&e.payload.operationType===g.TYPES.GRP_TIP_MBR_QUIT}));d.default(o)||this._outerEmitter.emit(c.default.REMOTE_USER_LEAVE,o);var s=n.filter((function(e){return e.type===g.TYPES.MSG_CUSTOM})),u=[];s.forEach((function(e){var n,i=e.payload.data,r=!0;try{n=JSON.parse(i)}catch(c){r=!1}if(r){var o=n.businessID,s=n.actionType;if(1===o)switch(s){case a.ActionType.INVITE:t._onNewInvitationReceived(n);break;case a.ActionType.REJECT_INVITE:t._onInviteeRejected(n);break;case a.ActionType.ACCEPT_INVITE:t._onInviteeAccepted(n);break;case a.ActionType.CANCEL_INVITE:t._onInvitationCancelled(n);break;case a.ActionType.INVITE_TIMEOUT:t._onInvitationTimeout(n)}else{if("av_call"===o)return!0;l.default.warn("TSignaling._onMessageReceived unknown businessID="+o),u.push(e)}}else u.push(e)})),d.default(u)||this._outerEmitter.emit(c.default.CUSTOM_MESSAGE_RECEIVED,u)},e.prototype._hasLocalInviteInfo=function(e,t){var n=e.inviteID,i=e.groupID;if(l.default.log("TSignaling._hasLocalInviteInfo inviteID="+n+" groupID="+i),!this._inviteInfoMap.has(n))return!1;var r=this._inviteInfoMap.get(n).inviteeList;return!i||(t?r.length>0:r.length>0&&r.includes(this._userID))},e.prototype._startTimer=function(e,t){var n=this;void 0===t&&(t=!0);var i=e.timeout;if(l.default.log("TSignaling._startTimer timeout="+i+" isInvitator="+t+" timeoutStatus="+(0===i)),0!==i)var r=t?i+5:i,o=1,a=setInterval((function(){var i=n._hasLocalInviteInfo(e,t);l.default.log("TSignaling.setInterval hasInviteInfo="+i),o<r&&i?++o:(i&&n._sendTimeoutNotice(e,t),clearInterval(a))}),1e3)},e.prototype._sendTimeoutNotice=function(e,t){return i(this,void 0,void 0,(function(){var n,i,o,s,u,d,p,h;return r(this,(function(r){switch(r.label){case 0:return n=e.inviteID,i=e.groupID,o=e.inviteeList,s=e.inviter,u=e.data,d=t?i||o[0]:i||s,l.default.log("TSignaling._sendTimeoutNotice inviteID="+n+" to="+d+" isInvitator="+t),p={businessID:a.BusinessID.SIGNAL,inviteID:n,inviter:s,actionType:a.ActionType.INVITE_TIMEOUT,inviteeList:t?o:[this._userID],data:u,timeout:0,groupID:i},[4,this._sendCustomMessage(d,p)];case 1:return(h=r.sent())&&0===h.code&&(this._outerEmitter.emit(c.default.INVITATION_TIMEOUT,{inviter:s,inviteID:n,groupID:i,inviteeList:p.inviteeList,isSelfTimeout:!0}),t?this._deleteInviteInfoByID(n):this._updateLocalInviteInfo(p)),[2,h]}}))}))},e.prototype._onNewInvitationReceived=function(t){var n=t.inviteID,i=t.inviter,r=t.inviteeList,o=t.groupID,a=t.data,s=r.includes(this._userID);l.default.log("TSignaling._onNewInvitationReceived",t,"myselfIncluded="+s);var c=JSON.parse(a),u=o&&d.default(c.room_id);d.default(c.room_id)&&c.call_end>0||u?this._outerEmitter.emit(e.EVENT.NEW_INVITATION_RECEIVED,{inviteID:n,inviter:i,groupID:o,inviteeList:r,data:t.data||""}):(o&&s||!o)&&(this._inviteInfoMap.set(n,t),this._outerEmitter.emit(e.EVENT.NEW_INVITATION_RECEIVED,{inviteID:n,inviter:i,groupID:o,inviteeList:r,data:t.data||""}),this._startTimer(t,!1))},e.prototype._onInviteeRejected=function(e){var t=e.inviteID,n=e.inviter,i=e.groupID,r=this._inviteInfoMap.has(t);l.default.log("TSignaling._onInviteeRejected inviteID="+t+" hasInviteID="+r+" inviter="+n+" groupID="+i+" _isRejectNotifyAll="+this._isRejectNotifyAll),(i&&r||!i||this._isRejectNotifyAll)&&(this._updateLocalInviteInfo(e),this._outerEmitter.emit(c.default.INVITEE_REJECTED,{inviteID:t,inviter:n,groupID:i,invitee:e.inviteeList[0],data:e.data||""}))},e.prototype._onInviteeAccepted=function(e){var t=e.inviteID,n=e.inviter,i=e.groupID,r=this._inviteInfoMap.has(t);l.default.log("TSignaling._onInviteeAccepted inviteID="+t+" hasInviteID="+r+" inviter="+n+" groupID="+i),(i&&r||!i)&&(this._updateLocalInviteInfo(e),this._outerEmitter.emit(c.default.INVITEE_ACCEPTED,{inviteID:t,inviter:n,groupID:i,invitee:e.inviteeList[0],data:e.data||""}))},e.prototype._onInvitationCancelled=function(e){var t=e.inviteID,n=e.inviter,i=e.groupID,r=this._inviteInfoMap.has(t);l.default.log("TSignaling._onInvitationCancelled inviteID="+t+" hasInviteID="+r+" inviter="+n+" groupID="+i),(i&&r||!i)&&(this._deleteInviteInfoByID(t),this._outerEmitter.emit(c.default.INVITATION_CANCELLED,{inviteID:t,inviter:n,groupID:i,data:e.data||""}))},e.prototype._onInvitationTimeout=function(e){var t=e.inviteID,n=e.inviter,i=e.groupID,r=e.data,o=this._inviteInfoMap.has(t);l.default.log("TSignaling._onInvitationTimeout inviteID="+t+" hasInviteID="+o+" inviter="+n+" groupID="+i),l.default.log("TSignaling._onInvitationTimeout data="+e.data);var a=JSON.parse(r),s=i&&(0===a.call_end||d.default(a.room_id));d.default(a.room_id)&&a.call_end>0||s||(i&&o||!i)&&(this._updateLocalInviteInfo(e),this._outerEmitter.emit(c.default.INVITATION_TIMEOUT,{inviteID:t,inviter:n,groupID:i,inviteeList:e.inviteeList,isSelfTimeout:!1}))},e.prototype._updateLocalInviteInfo=function(e){var t=e.inviteID,n=e.inviter,i=e.inviteeList,r=e.groupID;if(l.default.log("TSignaling._updateLocalInviteInfo inviteID="+t+" inviter="+n+" groupID="+r),r){if(this._inviteInfoMap.has(t)){var o=i[0],a=this._inviteInfoMap.get(t).inviteeList;a.includes(o)&&(a.splice(a.indexOf(o),1),l.default.log("TSignaling._updateLocalInviteInfo remove "+o+" from localInviteeList. "+a.length+" invitees left")),0===a.length&&this._deleteInviteInfoByID(t)}}else this._deleteInviteInfoByID(t)},e.prototype._deleteInviteInfoByID=function(e){this._inviteInfoMap.has(e)&&(l.default.log("TSignaling._deleteInviteInfoByID remove "+e+" from inviteInfoMap."),this._inviteInfoMap.delete(e))},e.prototype._sendCustomMessage=function(e,t,n){var o,s,u,d;return i(this,void 0,void 0,(function(){var i,p,h,f,m,v;return r(this,(function(r){switch(r.label){case 0:return i=t.groupID,p=this._tim.createCustomMessage({to:e,conversationType:i?g.TYPES.CONV_GROUP:g.TYPES.CONV_C2C,priority:g.TYPES.MSG_PRIORITY_HIGH,payload:{data:JSON.stringify(t)}}),t.actionType!==a.ActionType.INVITE?[3,2]:(f={title:(h=n||{}).title||"",description:h.description||"您有一个通话请求",androidOPPOChannelID:h.androidOPPOChannelID||"",extension:this._handleOfflineInfo(t,h.extension||"")},l.default.log("TSignaling.offlinePushInfo "+JSON.stringify(f)),[4,this._tim.sendMessage(p,{offlinePushInfo:{title:f.title,description:f.description,androidOPPOChannelID:f.androidOPPOChannelID,extension:f.extension}})]);case 1:return m=r.sent(),(null===(o=null==m?void 0:m.data)||void 0===o?void 0:o.message)&&this._outerEmitter.emit(c.default.MESSAGE_SENT_BY_ME,null===(s=null==m?void 0:m.data)||void 0===s?void 0:s.message),[2,m];case 2:return[4,this._tim.sendMessage(p)];case 3:return v=r.sent(),(null===(u=null==v?void 0:v.data)||void 0===u?void 0:u.message)&&this._outerEmitter.emit(c.default.MESSAGE_SENT_BY_ME,null===(d=null==v?void 0:v.data)||void 0===d?void 0:d.message),[2,v]}}))}))},e.prototype._sendCustomMessageSync=function(e,t,n,o,a){return i(this,void 0,void 0,(function(){var i;return r(this,(function(r){switch(r.label){case 0:return[4,this._sendCustomMessage(e,t,a)];case 1:return 0===(i=r.sent()).code?(this._inviteInfoMap.set(t.inviteID,t),this._startTimer(t,!0),n()):o(i.code,i.message||""),[2]}}))}))},e.prototype._handleOfflineInfo=function(e,t){var n=JSON.parse(e.data),i={action:e.actionType,call_type:n.call_type,room_id:n.room_id,call_id:e.inviteID,timeout:n.timeout,version:4,invited_list:e.inviteeList};e.groupID&&(i.group_id=e.groupID);var r={entity:{action:2,chatType:e.groupID?2:1,content:JSON.stringify(i),sendTime:parseInt(Date.now()/1e3+""),sender:e.inviter,version:1},userData:t||""},o=JSON.stringify(r);return l.default.log("TSignaling._handleOfflineInfo "+o),o},e.EVENT=c.default,e.TYPES=u.default,e}();t.default=_},function(e,t,n){n.r(t),n.d(t,"default",(function(){return a}));const i=Function.prototype.apply,r=new WeakMap;function o(e){return r.has(e)||r.set(e,{}),r.get(e)}class a{constructor(e=null,t=console){const n=o(this);return n._events=new Set,n._callbacks={},n._console=t,n._maxListeners=null===e?null:parseInt(e,10),this}_addCallback(e,t,n,i){return this._getCallbacks(e).push({callback:t,context:n,weight:i}),this._getCallbacks(e).sort(((e,t)=>e.weight>t.weight)),this}_getCallbacks(e){return o(this)._callbacks[e]}_getCallbackIndex(e,t){return this._has(e)?this._getCallbacks(e).findIndex((e=>e.callback===t)):null}_achieveMaxListener(e){return null!==o(this)._maxListeners&&o(this)._maxListeners<=this.listenersNumber(e)}_callbackIsExists(e,t,n){const i=this._getCallbackIndex(e,t),r=-1!==i?this._getCallbacks(e)[i]:void 0;return-1!==i&&r&&r.context===n}_has(e){return o(this)._events.has(e)}on(e,t,n=null,i=1){const r=o(this);if("function"!=typeof t)throw new TypeError(t+" is not a function");return this._has(e)?(this._achieveMaxListener(e)&&r._console.warn(`Max listeners (${r._maxListeners}) for event "${e}" is reached!`),this._callbackIsExists(...arguments)&&r._console.warn(`Event "${e}" already has the callback ${t}.`)):(r._events.add(e),r._callbacks[e]=[]),this._addCallback(...arguments),this}once(e,t,n=null,r=1){const o=(...r)=>(this.off(e,o),i.call(t,n,r));return this.on(e,o,n,r)}off(e,t=null){const n=o(this);let i;return this._has(e)&&(null===t?(n._events.delete(e),n._callbacks[e]=null):(i=this._getCallbackIndex(e,t),-1!==i&&(n._callbacks[e].splice(i,1),this.off(...arguments)))),this}emit(e,...t){return this._has(e)&&this._getCallbacks(e).forEach((e=>i.call(e.callback,e.context,t))),this}clear(){const e=o(this);return e._events.clear(),e._callbacks={},this}listenersNumber(e){return this._has(e)?this._getCallbacks(e).length:null}}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(i){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){n.r(t);var i=n(0);const r=Object.prototype.hasOwnProperty;t.default=function(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(Object(i.f)(e)){for(const t in e)if(r.call(e,t))return!1;return!0}return!!(Object(i.e)(e)||Object(i.g)(e)||Object(i.c)(e))&&0===e.size}},function(e,t,n){n.r(t);class i extends Error{constructor(e){super(),this.code=e.code,this.message=e.message,this.data=e.data||{}}}t.default=i},function(e,t,n){n.r(t);var i=n(1),r=n(4),o=n.n(r);t.default=class{constructor(){this._funcMap=new Map}defense(e,t,n){if("string"!=typeof e)return null;if(0===e.length)return null;if("function"!=typeof t)return null;if(this._funcMap.has(e)&&this._funcMap.get(e).has(t))return this._funcMap.get(e).get(t);this._funcMap.has(e)||this._funcMap.set(e,new Map);let i=null;return this._funcMap.get(e).has(t)?i=this._funcMap.get(e).get(t):(i=this._pack(e,t,n),this._funcMap.get(e).set(t,i)),i}defenseOnce(e,t,n){return"function"!=typeof t?null:this._pack(e,t,n)}find(e,t){return"string"!=typeof e||0===e.length||"function"!=typeof t?null:this._funcMap.has(e)?this._funcMap.get(e).has(t)?this._funcMap.get(e).get(t):(i.default.log(`SafetyCallback.find: 找不到 func —— ${e}/${""!==t.name?t.name:"[anonymous]"}`),null):(i.default.log(`SafetyCallback.find: 找不到 eventName-${e} 对应的 func`),null)}delete(e,t){return"function"==typeof t&&!!this._funcMap.has(e)&&!!this._funcMap.get(e).has(t)&&(this._funcMap.get(e).delete(t),0===this._funcMap.get(e).size&&this._funcMap.delete(e),!0)}_pack(e,t,n){return function(){try{t.apply(n,Array.from(arguments))}catch(r){const t=Object.values(o.a).indexOf(e),n=Object.keys(o.a)[t];i.default.error(`接入侧事件 EVENT.${n} 对应的回调函数逻辑存在问题，请检查！`,r)}}}}},function(e,t,n){
/**
         * UUID.js - RFC-compliant UUID Generator for JavaScript
         *
         * @file
         * @author  LiosK
         * @version v4.2.13
         * @license Apache License 2.0: Copyright (c) 2010-2023 LiosK
         */
var i;i=function(t){function i(){var e=r._getRandomInt;this.timestamp=0,this.tick=0,this.sequence=e(14),this.node=1099511627776*(1|e(8))+e(40)}function r(){}return r.generate=function(){var e=r._getRandomInt,t=r._hexAligner;return t(e(32),8)+"-"+t(e(16),4)+"-"+t(16384|e(12),4)+"-"+t(32768|e(14),4)+"-"+t(e(48),12)},r._getRandomInt=function(e){if(e<0||e>53)return NaN;var t=0|1073741824*Math.random();return e>30?t+1073741824*(0|Math.random()*(1<<e-30)):t>>>30-e},r._hexAligner=function(e,t){for(var n=e.toString(16),i=t-n.length,r="0";i>0;i>>>=1,r+=r)1&i&&(n=r+n);return n},r.overwrittenUUID=t,function(){var e=r._getRandomInt;r.useMathRandom=function(){r._getRandomInt=e};var t=null,i=e;"undefined"!=typeof window&&(t=window.crypto||window.msCrypto)?t.getRandomValues&&"undefined"!=typeof Uint32Array&&(i=function(e){if(e<0||e>53)return NaN;var n=new Uint32Array(e>32?2:1);return n=t.getRandomValues(n)||n,e>32?n[0]+4294967296*(n[1]>>>64-e):n[0]>>>32-e}):(t=n(14))&&t.randomBytes&&(i=function(e){if(e<0||e>53)return NaN;var n=t.randomBytes(e>32?8:4),i=n.readUInt32BE(0);return e>32?i+4294967296*(n.readUInt32BE(4)>>>64-e):i>>>32-e}),r._getRandomInt=i}(),r.FIELD_NAMES=["timeLow","timeMid","timeHiAndVersion","clockSeqHiAndReserved","clockSeqLow","node"],r.FIELD_SIZES=[32,16,16,8,8,48],r.genV4=function(){var e=r._getRandomInt;return(new r)._init(e(32),e(16),16384|e(12),128|e(6),e(8),e(48))},r.parse=function(e){var t;if(t=/^\s*(urn:uuid:|\{)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{2})([0-9a-f]{2})-([0-9a-f]{12})(\})?\s*$/i.exec(e)){var n=t[1]||"",i=t[8]||"";if(n+i===""||"{"===n&&"}"===i||"urn:uuid:"===n.toLowerCase()&&""===i)return(new r)._init(parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16),parseInt(t[5],16),parseInt(t[6],16),parseInt(t[7],16))}return null},r.prototype._init=function(){var e=r.FIELD_NAMES,t=r.FIELD_SIZES,n=r._binAligner,i=r._hexAligner;this.intFields=new Array(6),this.bitFields=new Array(6),this.hexFields=new Array(6);for(var o=0;o<6;o++){var a=parseInt(arguments[o]||0);this.intFields[o]=this.intFields[e[o]]=a,this.bitFields[o]=this.bitFields[e[o]]=n(a,t[o]),this.hexFields[o]=this.hexFields[e[o]]=i(a,t[o]>>>2)}return this.version=this.intFields.timeHiAndVersion>>>12&15,this.bitString=this.bitFields.join(""),this.hexNoDelim=this.hexFields.join(""),this.hexString=this.hexFields[0]+"-"+this.hexFields[1]+"-"+this.hexFields[2]+"-"+this.hexFields[3]+this.hexFields[4]+"-"+this.hexFields[5],this.urn="urn:uuid:"+this.hexString,this},r._binAligner=function(e,t){for(var n=e.toString(2),i=t-n.length,r="0";i>0;i>>>=1,r+=r)1&i&&(n=r+n);return n},r.prototype.toString=function(){return this.hexString},r.prototype.equals=function(e){if(!(e instanceof r))return!1;for(var t=0;t<6;t++)if(this.intFields[t]!==e.intFields[t])return!1;return!0},r.NIL=(new r)._init(0,0,0,0,0,0),r.genV1=function(){null==r._state&&r.resetState();var e=(new Date).getTime(),t=r._state;e!=t.timestamp?(e<t.timestamp&&t.sequence++,t.timestamp=e,t.tick=r._getRandomInt(12)):t.tick<9992?t.tick+=1+r._getRandomInt(3):t.sequence++;var n=r._getTimeFieldValues(t.timestamp),i=n.low+t.tick,o=4095&n.hi|4096;t.sequence&=16383;var a=t.sequence>>>8|128,s=255&t.sequence;return(new r)._init(i,n.mid,o,a,s,t.node)},r.resetState=function(){r._state=new i},r._tsRatio=1/4,r._state=null,r._getTimeFieldValues=function(e){var t=e-Date.UTC(1582,9,15),n=t/4294967296*1e4&268435455;return{low:1e4*(268435455&t)%4294967296,mid:65535&n,hi:n>>>16,timestamp:t}},r.genV6=function(){null==r._state&&r.resetState();var e=(new Date).getTime(),t=r._state;e!=t.timestamp?(e<t.timestamp&&t.sequence++,t.timestamp=e,t.tick=r._getRandomInt(12)):t.tick<9992?t.tick+=1+r._getRandomInt(3):t.sequence++;var n=t.timestamp-Date.UTC(1582,9,15),i=Math.floor(n/268435456*1e4)%4294967296,o=(1e4*(268435455&n)&268435455)+t.tick,a=o>>>12,s=4095&o|24576;t.sequence&=16383;var c=t.sequence>>>8|128,u=255&t.sequence;return(new r)._init(i,a,s,c,u,t.node)},"object"==typeof e.exports&&(e.exports=r),r}(i)},function(e,t){},function(e){e.exports=JSON.parse('{"name":"tsignaling","version":"1.0.5","description":"腾讯云 Web 信令 SDK","main":"./src/index.ts","scripts":{"lint":"./node_modules/.bin/eslint ./src","fix":"./node_modules/.bin/eslint --fix ./src","ts2js":"tsc src/index.ts --outDir build/ts2js","doc":"npm run ts2js && npm run doc:clean && npm run doc:build","doc:build":"./node_modules/.bin/jsdoc -c build/jsdoc/jsdoc.json && node ./build/jsdoc/fix-doc.js","doc:clean":"node ./build/jsdoc/clean-doc.js","build:wx":"cross-env NODE_ENV=wx webpack --config webpack.prod.config.js","build:web":"node node_modules/cross-env/src/bin/cross-env.js NODE_ENV=web node_modules/webpack/bin/webpack.js --config webpack.prod.config.js","build:package":"node build/package-bundle.js","prerelease":"npm run changelog && npm run build:web && npm run build:wx && npm run build:package && node ./build/copy.js","start:wx":"cross-env NODE_ENV=wx  webpack-dev-server --config webpack.config.js","start:web":"node node_modules/cross-env/src/bin/cross-env.js NODE_ENV=web node_modules/webpack-dev-server/bin/webpack-dev-server.js --config webpack.dev.config.js","build_withcopy":"npm run build:web && cp dist/npm/tsignaling-js.js ../TIM-demo-web/node_modules/tsignaling/tsignaling-js.js","build_withcopy:mp":"npm run build:wx && cp dist/npm/tsignaling-wx.js ../TIM-demo-mini/static/component/TRTCCalling/utils/tsignaling-wx.js","changelog":"cp CHANGELOG.md build/jsdoc/tutorials/CHANGELOG.md"},"husky":{"hooks":{"pre-commit":"npm run lint"}},"lint-staged":{"*.{.ts,.tsx}":["eslint","git add"]},"keywords":["腾讯云","即时通信","信令"],"author":"","license":"ISC","devDependencies":{"conventional-changelog-cli":"^2.1.1","cross-env":"^7.0.2","fs-extra":"^9.0.1","html-webpack-plugin":"^4.3.0","ts-loader":"^7.0.5","typescript":"^3.9.9","webpack":"^4.43.0","@types/node":"18.11.9","webpack-cli":"^3.3.11","webpack-dev-server":"^3.11.0"},"dependencies":{"@typescript-eslint/eslint-plugin":"^4.22.1","@typescript-eslint/parser":"^4.22.1","EventEmitter":"^1.0.0","docdash-blue":"^1.1.3","eslint":"^5.16.0","eslint-config-google":"^0.13.0","eslint-plugin-classes":"^0.1.1","jsdoc":"^3.6.4","jsdoc-plugin-typescript":"^2.0.5","pretty":"^2.0.0","replace":"^1.2.0","uuidjs":"^4.2.5"}}')},function(e,t,n){var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),c=n(6),u=function(){function e(){Object.defineProperty(this,"currentTime",{get:function(){return(new Date).getTime()}})}return e.prototype.doFilter=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2]}))}))},e}(),l=function(){function e(){this.filterList=[],this.result=[]}return e.prototype.register=function(e){this.filterList.push(e)},e.prototype.run=function(e){return void 0===e&&(e=[]),o(this,void 0,void 0,(function(){var t,n;return a(this,(function(i){switch(i.label){case 0:this.result=e,t=0,i.label=1;case 1:return t<this.filterList.length?(n=this,[4,this.filterList[t].doFilter(this.result)]):[3,4];case 2:n.result=i.sent(),i.label=3;case 3:return t++,[3,1];case 4:return[2,this.result]}}))}))},e}(),d=function(e){function t(t){var n=e.call(this)||this;return n.tim=null,n.expiredTime=3e4,n.maxCircleLength=20,n.tim=t.tim,n}return r(t,e),t.prototype.doFilter=function(e){return o(this,void 0,void 0,(function(){var e,t,n,i,r,o,s,c;return a(this,(function(a){switch(a.label){case 0:return e=[],[4,this.tim.getConversationList()];case 1:if(t=a.sent(),n=t.code,i=t.data,r=i.conversationList.length,o=r<=20?r:this.maxCircleLength,0===n)for(s=0;s<o;s++)(c=i.conversationList[s]).unreadCount>0&&c.lastMessage.lastTime&&1e3*c.lastMessage.lastTime>this.currentTime-this.expiredTime&&e.push(c);return[2,e]}}))}))},t}(u),p=function(e){function t(t){var n=e.call(this)||this;return n.tim=null,n.expiredTime=3e4,n.tim=t.tim,n}return r(t,e),t.prototype.doFilter=function(e){return o(this,void 0,void 0,(function(){var t,n,i,r,o,s,u,l,d=this;return a(this,(function(a){switch(a.label){case 0:t=[],n=0,a.label=1;case 1:return n<e.length?(i=e[n],r=i.conversationID,o=i.unreadCount,[4,this.tim.getMessageList({conversationID:r,count:o<=15?o:15})]):[3,4];case 2:s=a.sent(),u=s.code,l=s.data,0===u&&t.push(l.messageList.filter((function(e){return e.type===c.TYPES.MSG_CUSTOM&&e.time&&1e3*e.time>d.currentTime-d.expiredTime}))),a.label=3;case 3:return n++,[3,1];case 4:return[2,t.flat().sort((function(e,t){return e.time-t.time}))]}}))}))},t}(u),h=function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype.doFilter=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){return[2,e.filter((function(e){var t=!1;try{t=JSON.parse(e.payload.data).businessID===s.BusinessID.SIGNAL}catch(n){}return t}))]}))}))},t}(u),f=function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype.doFilter=function(e){return o(this,void 0,void 0,(function(){var t,n,i;return a(this,(function(r){return Array.isArray(e)?0===e.length?[2,[]]:(t=new Map,e.forEach((function(e,n){var i=JSON.parse(e.payload.data),r=i.inviteID,o=i.actionType;!t.has(r)||t.get(r).actionType!==s.ActionType.INVITE||o!==s.ActionType.CANCEL_INVITE&&o!==s.ActionType.ACCEPT_INVITE&&o!==s.ActionType.REJECT_INVITE&&o!==s.ActionType.INVITE_TIMEOUT?t.set(r,{index:n,actionType:o}):t.delete(r)})),n=[],t.forEach((function(e){e.actionType===s.ActionType.INVITE&&n.push(e.index)})),0===n.length?[2,[]]:(i=[],n.sort((function(e,t){return e-t})).forEach((function(t){i.push(e[t])})),[2,i])):[2,[]]}))}))},t}(u),g=function(){function e(e){this.tim=null;var t=e.tim;this.tim=t}return e.prototype.getHistoricalSignaling=function(){return o(this,void 0,void 0,(function(){var e;return a(this,(function(t){return(e=new l).register(new d({tim:this.tim})),e.register(new p({tim:this.tim})),e.register(new h),e.register(new f),[2,e.run()]}))}))},e}();t.default=g}]).default)),yP;var e}window,{get exports(){return lP},set exports(e){lP=e}}.exports=function(e,t,n,i){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=30)}([function(e,t,n){n.r(t);var i=n(6),r=n(1);let o=0;const a=new Map;function s(){const e=new Date;return`TUICallEngine ${e.toLocaleTimeString("en-US",{hour12:!1})}.${function(e){let t;switch(e.toString().length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}return t}(e.getMilliseconds())}:`}const c={_data:[],_length:0,_visible:!1,arguments2String(e){let t;if(1===e.length)t=s()+e[0];else{t=s();for(let n=0,{length:i}=e;n<i;n++)Object(r.isArrayOrObject)(e[n])?Object(r.isInstanceOfError)(e[n])?t+=Object(r.stringifyError)(e[n]):t+=JSON.stringify(e[n]):t+=e[n],t+=" "}return t},debug(){if(o<=-1){const e=this.arguments2String(arguments);c.record(e,"debug"),i.a.debug(e)}},log(){if(o<=0){const e=this.arguments2String(arguments);c.record(e,"log"),i.a.log(e)}},info(){if(o<=1){const e=this.arguments2String(arguments);c.record(e,"info"),i.a.info(e)}},warn(){if(o<=2){const e=this.arguments2String(arguments);c.record(e,"warn"),i.a.warn(e)}},error(){if(o<=3){const e=this.arguments2String(arguments);c.record(e,"error"),i.a.error(e)}},time(e){a.set(e,r.TimeUtil.now())},timeEnd(e){if(a.has(e)){const t=r.TimeUtil.now()-a.get(e);return a.delete(e),t}return i.a.warn(`未找到对应label: ${e}, 请在调用 logger.timeEnd 前，调用 logger.time`),0},setLevel(e){e<4&&i.a.log(`${s()}set level from ${o} to ${e}`),o=e},getLevel:()=>o,record(e,t){1100===c._length&&(c._data.splice(0,100),c._length=1e3),c._length++,c._data.push(`${e} [${t}] \n`)},getLog:()=>c._data};t.default=c},function(e,t,n){n.r(t),n.d(t,"isMap",(function(){return o})),n.d(t,"isSet",(function(){return a})),n.d(t,"isFile",(function(){return s})),n.d(t,"isNumber",(function(){return c})),n.d(t,"isString",(function(){return u})),n.d(t,"isObject",(function(){return l})),n.d(t,"isBoolean",(function(){return d})),n.d(t,"isPlainObject",(function(){return p})),n.d(t,"isArray",(function(){return h})),n.d(t,"isUndefined",(function(){return f})),n.d(t,"isNativeClass",(function(){return m})),n.d(t,"isArrayOrObject",(function(){return v})),n.d(t,"isFunction",(function(){return _})),n.d(t,"isInstanceOfError",(function(){return y})),n.d(t,"getType",(function(){return I})),n.d(t,"TimeUtil",(function(){return T})),n.d(t,"stringifyError",(function(){return C})),n.d(t,"map2String",(function(){return S})),n.d(t,"randomString",(function(){return b})),n.d(t,"isValidType",(function(){return D})),n.d(t,"mapKeys",(function(){return w})),n.d(t,"mapValues",(function(){return A})),n.d(t,"generateRandomRoomID",(function(){return R})),n.d(t,"formatDuration",(function(){return O})),n.d(t,"compareVersion",(function(){return N})),n.d(t,"date2ISOString",(function(){return P})),n.d(t,"getHostType",(function(){return U}));var i=n(10),r=n(2);const o=function(e){return I(e)===r.NAME.MAP},a=function(e){return I(e)===r.NAME.SET},s=function(e){return I(e)===r.NAME.FILE},c=function(e){return null!==e&&(typeof e===r.NAME.NUMBER&&!isNaN(e-0)||typeof e===r.NAME.OBJECT&&e.constructor===Number)},u=function(e){return typeof e===r.NAME.STRING},l=function(e){return null!==e&&typeof e===r.NAME.OBJECT},d=function(e){return typeof e===r.NAME.BOOLEAN},p=function(e){if(typeof e!==r.NAME.OBJECT||null===e)return!1;const t=Object.getPrototypeOf(e);if(null===t)return!0;let n=t;for(;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n},h=function(e){return typeof Array.isArray===r.NAME.FUNCTION?Array.isArray(e):I(e)===r.NAME.ARRAY},f=function(e){return typeof e===r.NAME.UNDEFINED},g=/^class\s/,m=function(e){return typeof e===r.NAME.FUNCTION&&g.test(e.toString())},v=function(e){return h(e)||l(e)},_=function(e){return typeof e===r.NAME.FUNCTION},y=function(e){return e instanceof Error},I=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()};let M=0;Date.now||(Date.now=function(){return(new Date).getTime()});const T={now(){0===M&&(M=Date.now()-1);const e=Date.now()-M;return e>4294967295?(M+=4294967295,Date.now()-M):e},utc:()=>Math.round(Date.now()/1e3)},C=function(e){return JSON.stringify(e,["message","code"])},S=function(e){if(!o(e))return"not a map!!!";let t="";for(const[n,i]of e.entries()){if(o(i))return`[k=${n} -> ${S(i)}`;t+=`[k=${n} v=${i}] `}return t},E="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",k=E.length,b=function(){let e="";for(let t=32;t>0;--t)e+=E[Math.floor(Math.random()*k)];return e},D=function(e,t){for(const n in e)if(e[n]===t)return!0;return!1};function w(e,t){const n={};return Object.keys(e).forEach((i=>{n[t(e[i],i)]=e[i]})),n}function A(e,t){const n={};return Object.keys(e).forEach((i=>{n[i]=t(e[i],i)})),n}function R(){return Math.round(1e8*Math.random())}function L(e){return e<10?"0"+e:e}function O(e){if(e<60)return"00:00:"+L(e);if(e<3600){const t=parseInt(e/60),n=e-60*t;return`00:${L(t)}:${L(n)}`}const t=parseInt(e/3600),n=e-3600*t,i=parseInt(n/60),r=n-60*i;return`${L(t)}:${L(i)}:${L(r)}`}function N(e,t){e=e.split("."),t=t.split(".");const n=Math.max(e.length,t.length);for(;e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(let i=0;i<n;i++){const n=parseInt(e[i]),r=parseInt(t[i]);if(n>r)return 1;if(n<r)return-1}return 0}const P=function(){const e=new Date,t=e.toISOString(),n=e.getTimezoneOffset()/60;let i="";return i=n<0?n>-10?"+0"+Math.abs(100*n):"+"+Math.abs(100*n):n>=10?"-"+100*n:"-0"+100*n,t.replace("Z",i)};function U(){let e="unknown";return i.IS_MAC&&(e="mac"),i.IS_WIN&&(e="windows"),i.IS_IOS&&(e="ios"),i.IS_ANDROID&&(e="android"),e}},function(e,t,n){n.r(t),n.d(t,"mainUrl",(function(){return i})),n.d(t,"backupUrl",(function(){return r})),n.d(t,"Mode",(function(){return o})),n.d(t,"Role",(function(){return a})),n.d(t,"VIDEO_STAT_BIT",(function(){return s})),n.d(t,"AUDIO_STAT_BIT",(function(){return c})),n.d(t,"AUDIO_MUTE_BIT",(function(){return u})),n.d(t,"VIDEO_MUTE_BIT",(function(){return l})),n.d(t,"VIDEO_MUTED_MASK",(function(){return d})),n.d(t,"AUX_VIDEO_MUTED_MASK",(function(){return p})),n.d(t,"AUDIO_MUTED_MASK",(function(){return h})),n.d(t,"MAIN_STREAM_MSID",(function(){return f})),n.d(t,"AUX_STREAM_MSID",(function(){return g})),n.d(t,"StreamType",(function(){return m})),n.d(t,"TRTC_QUALITY_UNKNOWN",(function(){return v})),n.d(t,"TRTC_QUALITY_EXCELLENT",(function(){return _})),n.d(t,"TRTC_QUALITY_GOOD",(function(){return y})),n.d(t,"TRTC_QUALITY_POOR",(function(){return I})),n.d(t,"TRTC_QUALITY_BAD",(function(){return M})),n.d(t,"TRTC_QUALITY_VBAD",(function(){return T})),n.d(t,"TRTC_QUALITY_DISCONNECTED",(function(){return C})),n.d(t,"DTLS_STATE_UNKNOWN",(function(){return S})),n.d(t,"SuccessRate",(function(){return E})),n.d(t,"MTA_API_PENDING",(function(){return k})),n.d(t,"MTA_API_SUCCESS",(function(){return b})),n.d(t,"ConnectionState",(function(){return D})),n.d(t,"UPLINK_RECONNECTION_COUNT",(function(){return w})),n.d(t,"DOWNLINK_RECONNECTION_COUNT",(function(){return A})),n.d(t,"SIGNAL_RECONNECTION_COUNT",(function(){return R})),n.d(t,"KIBANA_EVENT",(function(){return L})),n.d(t,"SIGNAL_PING_TIMEOUT",(function(){return O})),n.d(t,"SIGNAL_PING_PONG_INTERVAL",(function(){return N})),n.d(t,"INNER_EVENT",(function(){return P})),n.d(t,"AI_NOISE_REDUCE_ASSETS_PATH",(function(){return U})),n.d(t,"NAME",(function(){return x}));const i="wss://qcloud.rtc.qq.com:8687",r="wss://bk.rtc.qq.com:8687",o={RTC:1,LIVE:2},a={HOST:20,AUDIENCE:21},s=1,c=8,u=64,l=16,d=1,p=2,h=4,f="5Y2wZK8nANNAoVw6dSAHVjNxrD1ObBM2kBPV",g="224d130c-7b5c-415b-aaa2-79c2eb5a6df2",m={NONE:0,AUDIO:1,MAIN:2,AUX:7},v=0,_=1,y=2,I=3,M=4,T=5,C=6,S="unknown",E={JOIN:"join",PUBLISH:"publish",UNPUBLISH:"unpublish",LOCAL_STREAM_INITIALIZE:"local_stream_initialize",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscibe",UPLINK_CONNECTION:"uplink_connection",UPLINK_RECONNECTION:"uplink_reconnection",DOWNLINK_CONNECTION:"downlink_connection",DOWNLINK_RECONNECTION:"downlink_reconnection",SIGNAL_CONNECTION:"signal_connection",SIGNAL_RECONNECTION:"signal_reconnection",UPDATE_STREAM:"update_stream"},k="pending",b="success",D={CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTED:"disconnected"},w=30,A=30,R=30,L={SDK_CONSTRUCT:"sdkConstruct",SDK_LOGIN:"sdkLogin",DELTA_JOIN:"delta-join",REJOIN:"rejoin",LEAVE:"leave",DELTA_LEAVE:"delta-leave",PUBLISH:"publish",DELTA_PUBLISH:"delta-publish",UNPUBLISH:"unpublish",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",UPLINK_CONNECTION:"uplink-connection",UPLINK_RECONNECTION:"uplink-reconnection",DOWNLINK_CONNECTION:"downlink-connection",DOWNLINK_RECONNECTION:"downlink-reconnection",ON_TRACK:"ontrack",SET_LOCAL_DESCRIPTION:"setLocalDescription",SET_REMOTE_DESCRIPTION:"setRemoteDescription",ICE_CONNECTION_STATE:"iceConnectionState",LOCAL_STREAM_INITIALIZE:"stream-initialize",SIGNAL_CONNECTION:"websocketConnectionState",SIGNAL_RECONNECTION:"websocketReconnectionState",UPDATE_STREAM:"update-stream",RECOVER_SUBSCRIPTION:"recover-subscription"},O=6e3,N=1e4,P={SET_REMOTE_OFFER_FINISHED:"set-remote-offer-finished"},U="https://web.sdk.qcloud.com/trtc/webrtc/download/aiNoiseReduce/",x={DEFAULT:"default",BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object",ARRAY:"array",FUNCTION:"function",FILE:"file",MAP:"map",SET:"set",UNDEFINED:"undefined",VIDEO:"video",AUDIO:"audio",ON_ERROR:"onError",MAIN:"main",RTC:"rtc",LIVE:"live",SMALL:"small",BIG:"big",AUXILIARY:"auxiliary",INVITER:"inviter",INVITEE:"invitee",VIDEO_INPUT:"videoinput",AUDIO_INPUT:"audioinput",LOCAL:"local",REMOTE:"remote",TRTC:"TRTC",WEB:"web",NORMAL:"normal",REJECT:"reject",IGNORE:"ignore",TIMEOUT:"timeout",CANCEL:"cancel",BUSYLINE:"busyline",UNKNOWN:"unknown",SINGLE_CALL:"SingleCall",GROUP_CALL:"groupCall",CALLER:"caller",CALLEE:"callee",COVER:"cover",CONTAIN:"contain",FILL:"fill"}},function(e,t,n){var i=n(18),r=Object.prototype.toString;function o(e){return"[object Array]"===r.call(e)}function a(e){return void 0===e}function s(e){return null!==e&&"object"==typeof e}function c(e){if("[object Object]"!==r.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function u(e){return"[object Function]"===r.call(e)}function l(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),o(e))for(var n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(null,e[r],r,e)}e.exports={isArray:o,isArrayBuffer:function(e){return"[object ArrayBuffer]"===r.call(e)},isBuffer:function(e){return null!==e&&!a(e)&&null!==e.constructor&&!a(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isPlainObject:c,isUndefined:a,isDate:function(e){return"[object Date]"===r.call(e)},isFile:function(e){return"[object File]"===r.call(e)},isBlob:function(e){return"[object Blob]"===r.call(e)},isFunction:u,isStream:function(e){return s(e)&&u(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:l,merge:function e(){var t={};function n(n,i){c(t[i])&&c(n)?t[i]=e(t[i],n):c(n)?t[i]=e({},n):o(n)?t[i]=n.slice():t[i]=n}for(var i=0,r=arguments.length;i<r;i++)l(arguments[i],n);return t},extend:function(e,t,n){return l(t,(function(t,r){e[r]=n&&"function"==typeof t?i(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default={UNKNOWN:65535,NO_SDK_APPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USER_SIG:2003,NO_TINY_ID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,NO_NETWORK:2805,FAILURE_SWITCH_TO_AUDIO:60001,FAILURE_SWITCH_TO_VIDEO:60002,NOT_MICROPHONE_LIST:60003,NOT_CAMERA_LIST:60004,NOT_MEDIA_ACCESS:60005,NOT_SUPPORT:60006,ERROR_PACKAGE_NOT_PURCHASED:-1001,ERROR_PACKAGE_NOT_SUPPORTED:-1002,ERROR_TIM_VERSION_OUTDATED:-1003,ERROR_PERMISSION_DENIED:-1101,ERROR_GET_DEVICE_LIST_FAIL:-1102,ERROR_INIT_FAIL:-1201,ERROR_PARAM_INVALID:-1202,ERROR_REQUEST_REFUSED:-1203,ERROR_REQUEST_REPEATED:-1204,ERROR_SCENE_NOT_SUPPORTED:-1205,ERROR_SIGNALING_SEND_FAIL:-1401,ERROR_INVALID_INVITEID:8010,ERROR_INVALID_SEND_FAIL:20003,ERROR_HTTP:3e4}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ERROR_CN_MESSAGE=t.ERROR_MESSAGE=void 0,t.ERROR_MESSAGE={NO_SDK_APPID:"无 SDKAppID",NO_ACCOUNT_TYPE:"无 accountType",NO_IDENTIFIER:"无 userID",NO_USER_SIG:"无 userSig",NO_NETWORK:"未连接到网络",FAILURE_SWITCH_TO_AUDIO:"switch to audio call error",FAILURE_SWITCH_TO_VIDEO:"switch to video call error",NOT_MICROPHONE_LIST:"No microphone or microphone permission denied",NOT_CAMERA_LIST:"No camera or camera permission denied",ERROR_NULL:"success",ERROR_PACKAGE_NOT_PURCHASED:"You do not currently have TUICallKit package, please open the free experience in the console or purchase the official package",ERROR_PACKAGE_NOT_SUPPORTED:'The package you purchased does not support this ability. You can refer to "Activate TRTC and IM": https://www.tencentcloud.com/document/product/647/50993#step-1.-activate-trtc-and-im',ERROR_TIM_VERSION_OUTDATED:"TIM SDK version is too old, Please upgrade version",ERROR_PERMISSION_DENIED:"camera permission refused / microphone permission refused. You can perform the trtc capability test at https://web.sdk.qcloud.com/trtc/webrtc/demo/detect/index.html to check whether the current environment supports audio and video calls",ERROR_GET_DEVICE_LIST_FAIL:"Failed to get device list",ERROR_INIT_FAIL:"init or login is not complete, this API needs to be used after init. To solve the problem, please go to: https://cloud.tencent.com/document/product/647/78769#3a61f42b-e06f-49af-88bf-362d40025887",ERROR_REQUEST_REFUSED:"The API is support use in the state of. To solve the problem, please go to: https://cloud.tencent.com/document/product/647/78769#5e65043d-e3dc-4bd3-8220-3ac7694dfa42",ERROR_REQUEST_REPEATED:"The current method is being executed, please do not call it repeatedly",ERROR_REQUEST_REPEATED_SWITCH:"Consistent with the current call type, please do not switch repeatedly",ERROR_SCENE_NOT_SUPPORTED:"In the current call scene, this function is not supported",ERROR_SIGNALING_SEND_FAIL:"signaling failed to send",ERROR_INVALID_INVITEID:"inviteID is invalid or invitation has been processed. To solve the problem, please go to: https://cloud.tencent.com/document/product/647/84363#e97ea97b-7812-42ed-89b7-2a3840ac0e3f",ERROR_INVALID_SEND_FAIL:"Invalid sender or receiver identifier! To solve the problem, please go to: https://cloud.tencent.com/document/product/647/84363#661be1b0-f649-4199-a343-958c3f4f4bbb",ERROR_PARAM_INVALID:"invalid parameter",ERROR_HTTP:"The current page is detected to be using the http protocol. To ensure smooth access and experience of all functions of TUICallEngine SDK for production environment users, please use the https protocol to access the audio and video application page. More Info: https://web.sdk.qcloud.com/trtc/webrtc/doc/en/tutorial-05-info-browser.html#h2-3",NOT_SUPPORT:"The current page does not have webRTC capability. You can perform the trtc capability test at https://web.sdk.qcloud.com/trtc/webrtc/demo/detect/index.html to check whether the current environment supports audio and video calls"},t.ERROR_CN_MESSAGE={NO_SDK_APPID:"无 SDKAppID",NO_ACCOUNT_TYPE:"无帐户类型",NO_IDENTIFIER:"无 userID",NO_USER_SIG:"无 userSig",NO_NETWORK:"未连接到网络",FAILURE_SWITCH_TO_AUDIO:"切换语音通话失败",FAILURE_SWITCH_TO_VIDEO:"切换视频通话失败",NOT_MICROPHONE_LIST:"没有麦克风权限",NOT_CAMERA_LIST:"没有摄像头权限",ERROR_NULL:"成功",ERROR_PACKAGE_NOT_PURCHASED:"您目前没有 TUICallKit 包，请在控制台开启免费体验或购买官方包",ERROR_PACKAGE_NOT_SUPPORTED:"您购买的套餐不支持该功能。可参考开通方式：https://cloud.tencent.com/document/product/647/84363#ff45b4ad-f605-42b8-a0af-b2397c8f3e1a",ERROR_TIM_VERSION_OUTDATED:"TIM SDK 版本太旧,请升级版本",ERROR_PERMISSION_DENIED:"摄像头/麦克风权限被拒绝，可以前往: https://web.sdk.qcloud.com/trtc/webrtc/demo/detect/index.html 进行 trtc 能力测试，查看当前环境是否支持音视频通话",ERROR_GET_DEVICE_LIST_FAIL:"获取设备列表失败",ERROR_INIT_FAIL:"TUICallEngine 初始化登录未完成，需要在 init 或 login 完成后使用此 API 。解决方案请前往: https://cloud.tencent.com/document/product/647/78769#3a61f42b-e06f-49af-88bf-362d40025887",ERROR_REQUEST_REFUSED:"当前通话状态无法使用该 API。解决方案请前往: https://cloud.tencent.com/document/product/647/78769#5e65043d-e3dc-4bd3-8220-3ac7694dfa42",ERROR_REQUEST_REPEATED:"当前方法正在执行中，请勿重复调用",ERROR_REQUEST_REPEATED_SWITCH:"与当前通话类型一致，请勿重复切换",ERROR_SCENE_NOT_SUPPORTED:"当前通话场景不支持该功能",ERROR_SIGNALING_SEND_FAIL:"信令发送失败",ERROR_INVALID_INVITEID:"邀请 ID 无效或邀请已处理。解决方案请前往: https://cloud.tencent.com/document/product/647/84363#e97ea97b-7812-42ed-89b7-2a3840ac0e3f",ERROR_INVALID_SEND_FAIL:"消息发送方或接收方 UserID 无效或不存在。解决方案请前往: https://cloud.tencent.com/document/product/647/84363#661be1b0-f649-4199-a343-958c3f4f4bbb",ERROR_PARAM_INVALID:"参数错误",ERROR_HTTP:"检测到当前页面正处于 http 协议下，为确保生产环境用户顺畅接入和体验 TUICallEngine SDK 的全部功能，请使用 https 协议访问音视频应用页面。详情请前往：https://web.sdk.qcloud.com/trtc/webrtc/doc/zh-cn/tutorial-05-info-browser.html#h2-3",NOT_SUPPORT:"当前页面不具备 webRTC 能力。可以前往: https://web.sdk.qcloud.com/trtc/webrtc/demo/detect/index.html 进行 trtc 能力测试，查看当前环境是否支持音视频通话"}},function(e,t,n){(function(e){let n,i;n="undefined"!=typeof console?console:void 0!==e&&e.console?e.console:"undefined"!=typeof window&&window.console?window.console:{};const r=function(){},o=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];let{length:a}=o;for(;a--;)i=o[a],console[i]||(n[i]=r);n.methods=o,t.a=n}).call(this,n(34))},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.DEVICEID_TYPE=t.DEVICE_TYPE=t.CALL_EXPERMENTEL_API_TYPE=t.MODE_TYPE=t.VALID_VIDEO_PROFILE_LIST=t.BUSINESS_ID=t.ACTION_TYPE=t.CALL_ROLE=t.CALL_STATUS=t.CMD_TYPE=t.CMD_TYPE_LIST=t.CALL_TYPE=void 0;var i,r=n(13);(i=t.CALL_TYPE||(t.CALL_TYPE={}))[i.UNKNOWN=0]="UNKNOWN",i[i.AUDIO_CALL=1]="AUDIO_CALL",i[i.VIDEO_CALL=2]="VIDEO_CALL",t.CMD_TYPE_LIST=["","audioCall","videoCall"],function(e){e.AUDIO_CALL="audioCall",e.VIDEO_CALL="videoCall",e.HANG_UP="hangup",e.SWITCH_TO_AUDIO="switchToAudio",e.SWITCH_TO_AUDIO_CALL="switch_to_audio_call",e.SWITCH_TO_VIDEO="switchToVideo"}(t.CMD_TYPE||(t.CMD_TYPE={})),function(e){e.IDLE="idle",e.CALLING="calling",e.CONNECTED="connected"}(t.CALL_STATUS||(t.CALL_STATUS={})),function(e){e.UNKNOWN="",e.INVITER="inviter",e.INVITEE="invitee"}(t.CALL_ROLE||(t.CALL_ROLE={})),function(e){e[e.INVITE=1]="INVITE",e[e.CANCEL_INVITE=2]="CANCEL_INVITE",e[e.ACCEPT_INVITE=3]="ACCEPT_INVITE",e[e.REJECT_INVITE=4]="REJECT_INVITE",e[e.INVITE_TIMEOUT=5]="INVITE_TIMEOUT"}(t.ACTION_TYPE||(t.ACTION_TYPE={})),function(e){e[e.SIGNAL=1]="SIGNAL"}(t.BUSINESS_ID||(t.BUSINESS_ID={})),t.VALID_VIDEO_PROFILE_LIST=Object.keys(r.TUICommonDefine.VideoEncoderParams),function(e){e.AUDIO="audio",e.VIDEO="video"}(t.MODE_TYPE||(t.MODE_TYPE={})),function(e){e[e.BASE=Math.pow(2,16)]="BASE",e[e.PRO=Math.pow(2,17)]="PRO",e[e.ULTIMATE=Math.pow(2,18)]="ULTIMATE"}(t.CALL_EXPERMENTEL_API_TYPE||(t.CALL_EXPERMENTEL_API_TYPE={})),function(e){e.AUDIO="audio",e.VIDEO="video",e.CAMERA="camera",e.MICROPHONES="microphones"}(t.DEVICE_TYPE||(t.DEVICE_TYPE={})),function(e){e.audio="microphoneId",e.video="cameraId"}(t.DEVICEID_TYPE||(t.DEVICEID_TYPE={}))},function(e,t,n){var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(5),s=function(e){function t(t){var n=t.message,i=t.code,r=void 0===i?o.default.UNKNOWN:i,s=e.call(this,n+" "+function(e){for(var t in a.ERROR_CN_MESSAGE)if(o.default[t]===e)return a.ERROR_CN_MESSAGE[t];return"UNKNOWN"}(r)+" <"+function(e){for(var t in o.default)if(o.default[t]===e)return t;return"UNKNOWN"}(r)+": "+r+">")||this;return s.code=r,s.name="TUICallEngineError",s.message_=n,s}return r(t,e),t.prototype.getCode=function(){return this.code},t}(Error);t.default=s},function(e,t,n){n.r(t);var i=n(1),r=n(0),o=n(4),a=n.n(o),s=n(5);class c{constructor(e){this.sdkappid="",this.version="",this.userid="",this.platform="",this.useragent="",this.method=e,this.codeint=1,this.calltype=1,this.talktime=0,this.message="",this.text="",this.startts=Date.now(),this.endts=0,this.timespan=0,this.time="",this.networktype="",this.host=Object(i.getHostType)()}static bindController(e){c.prototype._eventStatController=e}setCommonInfo(e){const{SDKAppID:t,version:n,userID:r,platform:o,scene:a}=e;this.sdkappid=t,this.version=""+n,this.userid=r,this.platform=o,this.scene=a,this.time=Object(i.date2ISOString)(),this.startts&&this.endts&&!this.timespan&&(this.timespan=Math.abs(this.endts-this.startts))}setEnd(e=!1){this.endts=Date.now(),e?this._eventStatController.pushIn(this):setTimeout((()=>{this._eventStatController.pushIn(this)}),0)}setError(e,t,n){return this.setNetworkType(n),t?(e.code&&this.setCode(e.code),e.message&&this.setMessage(e.message)):(this.setCode(a.a.NO_NETWORK),this.setMessage(s.ERROR_MESSAGE.NO_NETWORK)),this}setCode(e){return"ECONNABORTED"===e&&(this.codeint=103),Object(i.isNumber)(e)?this.codeint=e:r.default.warn("SSOLogData.setCode value not a number, please check!",e,typeof e),this}setMessage(e){return Object(i.isString)(e)?(this.message=e,this):this}setText(e){return Object(i.isNumber)(e)?this.text=e.toString():Object(i.isString)(e)&&(this.text=e),this}setTalkTime(e){return this.talktime=e,this}setMessageType(e){return this.msgType=e,this}setCallType(e){return this.calltype=e,this}setNetworkType(e){return Object(i.isUndefined)(e)?r.default.warn("SSOLogData.setNetworkType value is undefined, please check!"):this.networktype=e,this}}t.default=c},function(e,t,n){n.r(t),n.d(t,"IN_Browser",(function(){return i})),n.d(t,"IN_WXMiniProgram",(function(){return r})),n.d(t,"USER_AGENT",(function(){return o})),n.d(t,"IS_IPAD",(function(){return c})),n.d(t,"IS_IPHONE",(function(){return u})),n.d(t,"IS_IPOD",(function(){return l})),n.d(t,"IS_IOS",(function(){return d})),n.d(t,"IOS_VERSION",(function(){return p})),n.d(t,"IS_ANDROID",(function(){return h})),n.d(t,"ANDROID_VERSION",(function(){return f})),n.d(t,"IS_OLD_ANDROID",(function(){return g})),n.d(t,"IS_NATIVE_ANDROID",(function(){return m})),n.d(t,"IS_FIREFOX",(function(){return v})),n.d(t,"FIREFOX_VERSION",(function(){return _})),n.d(t,"IS_EDGE",(function(){return y})),n.d(t,"IS_EDG",(function(){return I})),n.d(t,"EDG_VERSION",(function(){return M})),n.d(t,"IS_CHROME",(function(){return T})),n.d(t,"CHROME_MAJOR_VERSION",(function(){return C})),n.d(t,"CHROME_VERSION",(function(){return S})),n.d(t,"IS_IE8",(function(){return E})),n.d(t,"IE_VERSION",(function(){return k})),n.d(t,"IS_SAFARI",(function(){return b})),n.d(t,"IS_ANY_SAFARI",(function(){return D})),n.d(t,"SAFARI_VERSION",(function(){return w})),n.d(t,"IS_TBS",(function(){return A})),n.d(t,"TBS_VERSION",(function(){return R})),n.d(t,"IS_MQQB",(function(){return L})),n.d(t,"IS_QQB",(function(){return O})),n.d(t,"IS_WECHAT",(function(){return N})),n.d(t,"IS_WIN",(function(){return P})),n.d(t,"IS_MAC",(function(){return U})),n.d(t,"IS_LINUX",(function(){return x})),n.d(t,"IS_WX",(function(){return G})),n.d(t,"IS_UCBROWSER",(function(){return F})),n.d(t,"IS_MIUIBROWSER",(function(){return V})),n.d(t,"IS_HUAWEIBROWSER",(function(){return q})),n.d(t,"BROWSER_VERSION",(function(){return B})),n.d(t,"IS_LOCAL",(function(){return H}));const i="undefined"!=typeof window,r="undefined"!=typeof wx,o=window.navigator&&window.navigator.userAgent||"",a=/AppleWebKit\/([\d.]+)/i.exec(o),s=a?parseFloat(a.pop()):null,c=/iPad/i.test(o),u=/iPhone/i.test(o)&&!c,l=/iPod/i.test(o),d=u||c||l,p=function(){const e=o.match(/OS (\d+)_/i);return e&&e[1]?e[1]:null}(),h=/Android/i.test(o),f=function(){const e=o.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;const t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(`${e[1]}.${e[2]}`):t||null}(),g=h&&/webkit/i.test(o)&&f<2.3,m=h&&f<5&&s<537,v=/Firefox/i.test(o),_=function(){const e=o.match(/Firefox\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),y=/Edge\//i.test(o),I=/Edg\//i.test(o),M=function(){const e=o.match(/Edg\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),T=!y&&/Chrome/i.test(o),C=function(){const e=o.match(/Chrome\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),S=function(){const e=o.match(/Chrome\/([\d.]+)/);return e&&e[1]?e[1]:null}(),E=/MSIE\s8\.0/.test(o),k=function(){const e=/MSIE\s(\d+)\.\d/.exec(o);let t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(o)&&/rv:11.0/.test(o)&&(t=11),t}(),b=/Safari/i.test(o)&&!T&&!h&&!y,D=b||d,w=function(){const e=o.match(/Version\/([\d.]+)/);return e&&e[1]?e[1]:null}(),A=/TBS\/\d+/i.test(o),R=function(){const e=o.match(/TBS\/(\d+)/i);if(e&&e[1])return e[1]}(),L=!A&&/MQQBrowser\/\d+/i.test(o),O=!A&&/ QQBrowser\/\d+/i.test(o),N=/(micromessenger|webbrowser)/i.test(o),P=/Windows/i.test(o),U=/MAC OS X/i.test(o),x=/Linux/i.test(o),G=/MicroMessenger/i.test(o),F=/UCBrowser/i.test(o),V=/MiuiBrowser/i.test(o),q=/HuaweiBrowser/i.test(o),B=T?"Chrome/"+S:b?"Safari/"+w:"NotSupportedBrowser",H="file:"===location.protocol||"localhost"===location.hostname||/^\d+\.\d+\.\d+\.\d+$/.test(location.hostname)},function(e,t,n){n.r(t),t.default={SDK_CONSTRUCT:"sdkConstruct",SDK_READY:"sdkReady",SDK_NOT_READY:"sdkNotReady",LOGIN:"login",LOGOUT:"logout",CALL:"call",GROUP_CALL:"groupCall",ACCEPT:"accept",REJECT:"reject",HANGUP:"hangup",START_REMOTE_VIEW:"startRemoteView",STOP_REMOTE_VIEW:"stopRemoteView",START_LOCAL_VIEW:"startLocalView",STOP_LOCAL_VIEW:"stopLocalView",OPEN_CAMERA:"openCamera",CLOSE_CAMERA:"closeCamera",SET_MIC_MUTE:"setMicMute",SET_VIDEO_QUALITY:"setVideoQuality",SWITCH_TO_AUDIO_CALL:"switchToAudioCall",SWITCH_TO_VIDEO_CALL:"switchToVideoCall",CHANGE_CALL_STATUS:"changeCallStatus",TALK_TIME:"talktime",ERROR:"error",INVITED:"invited",GROUP_CALL_INVITEE_LIST_UPDATE:"group_call_invitee_list_update",USER_ENTER:"user_enter",USER_LEAVE:"user_leave",NO_RESP:"no_resp",LINE_BUSY:"line_busy",CALLING_CANCEL:"calling_cancel",KICKED_OUT:"kicked_out",CALLING_TIMEOUT:"calling_timeout",CALLING_END:"calling_end",USER_VIDEO_AVAILABLE:"user_video_available",USER_AUDIO_AVAILABLE:"user_audio_available",USER_VOICE_VOLUME:"user_voice_volume",CALL_TYPE_CHANGED:"call_type_changed",DEVICED_UPDATED:"deviced_updated",QUALITY_REPORT:"quality_report"}},function(e,t,n){n.r(t),n.d(t,"default",(function(){return f}));var i=n(0),r=n(1);class o{constructor(){this._table="timweb-trtccalling",this._report=[]}pushIn(e){i.default.debug("SSOLogBody.pushIn",this._report.length,e),this._report.push(e)}backfill(e){Object(r.isArray)(e)&&0!==e.length&&(i.default.debug("SSOLogBody.backfill",this._report.length,e.length),this._report.unshift(...e))}getLogsNumInMemory(){return this._report.length}isEmpty(){return 0===this._report.length}_reset(){this._report.length=0,this._report=[]}getTable(){return this._table}getLogsInMemory(){const e=this._report.slice();return this._reset(),e}}var a=n(9),s=n(16),c=n(28),u=n.n(c);const l={CURRENT:{COMMON:"https://webim.tim.qq.com"},PRODUCTION:{COMMON:"https://webim.tim.qq.com"},OVERSEA_PRODUCTION:{COMMON:"https://api.im.qcloud.com"},SANDBOX:{COMMON:"https://events.tim.qq.com"},TEST:{COMMON:"https://test.tim.qq.com"}},d={IM_OPEN_STAT:"imopenstat"},p={TIM_WEB_TRTCCALLING_REPORT:"tweb_trtccalling_report"},h={imopenstat:"v4"};class f{constructor(){this.TAG="trtccalling-ssolog-event",this._reportBody=new o,this._version=s.version||"",this.MIN_THRESHOLD=20,this.MAX_THRESHOLD=100,this.WAITING_TIME=6e4,this.INTERVAL=2e4,this._timerID=0,this._resetLastReportTime(),this._startReportTimer(),this._retryCount=0,this.MAX_RETRY_COUNT=3}reportAtOnce(){i.default.debug("EventStatController.reportAtOnce"),this._report()}pushIn(e){e instanceof a.default&&(e.setCommonInfo({SDKAppID:Number(sessionStorage.getItem("sdkAppId")),version:this._version,userID:sessionStorage.getItem("userId")}),this._reportBody.pushIn(e),this._report())}_resetLastReportTime(){this._lastReportTime=Date.now()}_startReportTimer(){this._timerID=setInterval((()=>{Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()}),this.INTERVAL)}_stopReportTimer(){this._timerID>0&&(clearInterval(this._timerID),this._timerID=0)}_report(){if(this._reportBody.isEmpty())return;const e=Math.ceil(+new Date/1e3),t=sessionStorage.getItem("sdkAppId"),n=this._reportBody.getLogsInMemory(),o={table:this._reportBody.getTable(),report:n},a=`${l.CURRENT.COMMON}/${h.imopenstat}/${d.IM_OPEN_STAT}/${p.TIM_WEB_TRTCCALLING_REPORT}/?sdkappid=${t}&reqtime=${e}`;u.a.post(a,JSON.stringify(o)).then((()=>{this._resetLastReportTime(),this._retryCount>0&&(i.default.debug("EventStatController.report retry success"),this._retryCount=0)})).catch((e=>{i.default.warn("EventStatController.report, error:"+Object(r.stringifyError)(e)),this._reportBody.backfill(n),this._reportBody.getLogsNumInMemory()>this.MAX_THRESHOLD||this._retryCount===this.MAX_RETRY_COUNT||0===this._timerID?this._retryCount=0:this._retryCount+=1}))}reset(){i.default.log("EventStatController.reset"),this._stopReportTimer(),this._report()}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.TUICommonDefine=t.TUICallType=void 0,t.TUICallType={AUDIO_CALL:1,VIDEO_CALL:2,DEVCIED_CAMERA:"camera",DEVCIED_MICROPHONES:"microphones"},t.TUICommonDefine={VideoEncoderParams:{"120p":"120p","120p_2":"120p_2","180p":"180p","180p_2":"180p_2","240p":"240p","360p":"360p","360p_2":"360p_2","480p":"480p","480p_2":"480p_2","720p":"720p","1080p":"1080p","1440p":"1440p","4K":"4K"}}},function(e,t,n){(function(t){var i=n(3),r=n(42),o=n(20),a={"Content-Type":"application/x-www-form-urlencoded"};function s(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var c,u={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(c=n(21)),c),transformRequest:[function(e,t){return r(t,"Accept"),r(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(s(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)||t&&"application/json"===t["Content-Type"]?(s(t,"application/json"),function(e,t,n){if(i.isString(e))try{return(t||JSON.parse)(e),i.trim(e)}catch(r){if("SyntaxError"!==r.name)throw r}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,a=!n&&"json"===this.responseType;if(a||r&&i.isString(e)&&e.length)try{return JSON.parse(e)}catch(s){if(a){if("SyntaxError"===s.name)throw o(s,this,"E_JSON_PARSE");throw s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};i.forEach(["delete","get","head"],(function(e){u.headers[e]={}})),i.forEach(["post","put","patch"],(function(e){u.headers[e]=i.merge(a)})),e.exports=u}).call(this,n(41))},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.TUICallEvent=void 0,t.TUICallEvent={ERROR:"onError",SDK_READY:"sdkReady",INVITED:"onInvited",USER_ACCEPT:"onUserAccept",USER_ENTER:"onUserEnter",USER_LEAVE:"onUserLeave",REJECT:"onReject",NO_RESP:"onNoResp",LINE_BUSY:"onLineBusy",CALLING_CANCEL:"onCallingCancel",KICKED_OUT:"onKickedOut",CALLING_TIMEOUT:"onCallingTimeout",CALL_END:"onCallEnd",CALLING_END:"onCallEnd",USER_VIDEO_AVAILABLE:"onUserVideoAvailable",USER_AUDIO_AVAILABLE:"onUserAudioAvailable",USER_VOICE_VOLUME:"onUserVoiceVolume",GROUP_CALL_INVITEE_LIST_UPDATE:"onGroupCallInviteeListUpdate",CALL_TYPE_CHANGED:"onCallTypeChanged",DEVICED_UPDATED:"onDeviceUpdated",MESSAGE_SENT_BY_ME:"onMessageSentByMe"}},function(e){e.exports=JSON.parse('{"name":"tuicall-engine-webrtc","version":"1.4.1","description":"腾讯云 tuicall-engine-webrtc","main":"index","private":true,"dependencies":{"EventEmitter":"^1.0.0","axios":"^0.21.0","dayjs":"^1.11.7"},"peerDependencies":{"trtc-js-sdk":"^4.15.6","tim-js-sdk":"^2.26.6","rtc-ai-denoiser":"^1.1.3","tsignaling":"^1.0.5"},"devDependencies":{"@babel/preset-typescript":"^7.12.7","@tencent/eslint-config-tencent":"^0.16.1","@typescript-eslint/eslint-plugin":"^4.33.0","@typescript-eslint/parser":"^4.33.0","docdash-blue":"^1.1.9","eslint":"^7.27.0","eslint-config-google":"^0.14.0","eslint-plugin-prettier":"^4.0.0","fs-extra":"^9.0.1","jsdoc":"^3.6.11","prettier":"^2.5.0","pretty":"^2.0.0","replace":"^1.2.2","rimraf":"^4.1.2","ts-loader":"^8.4.0","typescript":"^3.9.7","watch":"^1.0.2","webpack":"^4.44.1","webpack-cli":"^3.3.12"},"scripts":{"watch":"watch \'npm run build_withcopy3\' src","dev":"npm run watch","build":"webpack --config webpack.config.js","build_withcopy":"npm run build && cp dist/npm/tuicall-engine-webrtc.js ../../github/TUICalling/Web/node_modules/tuicall-engine-webrtc/tuicall-engine-webrtc.js","build_withcopy2":"npm run build && cp dist/npm/tuicall-engine-webrtc.js ../sdk/trtc-calling-webrtc-demo/node_modules/tuicall-engine-webrtc/tuicall-engine-webrtc.js","build_withcopy3":"npm run build && cp dist/npm/tuicall-engine-webrtc.js ./example-js/tuicall-engine-webrtc.js","build:package":"node build/package-bundle.js","lint":"./node_modules/.bin/eslint ./src; exit 0","fix":"./node_modules/.bin/eslint --fix ./src; exit 0","prerelease":"npm run lint && npm run build && npm run doc && npm run build:package","doc":"npm run doc:clean && tsc  --target ESNEXT && npm run doc:build","doc:build":"npm run changelog && npm run main && ./node_modules/.bin/jsdoc -c build/jsdoc/jsdoc.json && node ./build/jsdoc/fix-doc.js","doc:clean":"node ./build/jsdoc/clean-doc.js","changelog":"cp CHANGELOG.md build/jsdoc/tutorials/20-CHANGELOG.md","main":"cp README.md build/jsdoc/main.md"},"repository":{"type":"git","url":"https://github.com/tencentyun/TUICallKit/tree/main/Web"},"author":"Tencent Cloud Terminal R&D Center","license":"ISC"}')},function(t,n){t.exports=e},function(e,t,n){e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return e.apply(t,n)}}},function(e,t,n){var i=n(3);function r(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var o;if(n)o=n(t);else if(i.isURLSearchParams(t))o=t.toString();else{var a=[];i.forEach(t,(function(e,t){null!=e&&(i.isArray(e)?t+="[]":e=[e],i.forEach(e,(function(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),a.push(r(t)+"="+r(e))})))})),o=a.join("&")}if(o){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}},function(e,t,n){e.exports=function(e,t,n,i,r){return e.config=t,n&&(e.code=n),e.request=i,e.response=r,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,n){var i=n(3),r=n(43),o=n(44),a=n(19),s=n(45),c=n(48),u=n(49),l=n(22);e.exports=function(e){return new Promise((function(t,n){var d=e.data,p=e.headers,h=e.responseType;i.isFormData(d)&&delete p["Content-Type"];var f=new XMLHttpRequest;if(e.auth){var g=e.auth.username||"",m=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";p.Authorization="Basic "+btoa(g+":"+m)}var v=s(e.baseURL,e.url);function _(){if(f){var i="getAllResponseHeaders"in f?c(f.getAllResponseHeaders()):null,o={data:h&&"text"!==h&&"json"!==h?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:i,config:e,request:f};r(t,n,o),f=null}}if(f.open(e.method.toUpperCase(),a(v,e.params,e.paramsSerializer),!0),f.timeout=e.timeout,"onloadend"in f?f.onloadend=_:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(_)},f.onabort=function(){f&&(n(l("Request aborted",e,"ECONNABORTED",f)),f=null)},f.onerror=function(){n(l("Network Error",e,null,f)),f=null},f.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(l(t,e,e.transitional&&e.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",f)),f=null},i.isStandardBrowserEnv()){var y=(e.withCredentials||u(v))&&e.xsrfCookieName?o.read(e.xsrfCookieName):void 0;y&&(p[e.xsrfHeaderName]=y)}"setRequestHeader"in f&&i.forEach(p,(function(e,t){void 0===d&&"content-type"===t.toLowerCase()?delete p[t]:f.setRequestHeader(t,e)})),i.isUndefined(e.withCredentials)||(f.withCredentials=!!e.withCredentials),h&&"json"!==h&&(f.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&f.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){f&&(f.abort(),n(e),f=null)})),d||(d=null),f.send(d)}))}},function(e,t,n){var i=n(20);e.exports=function(e,t,n,r,o){var a=new Error(e);return i(a,t,n,r,o)}},function(e,t,n){e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,n){var i=n(3);e.exports=function(e,t){t=t||{};var n={},r=["url","method","data"],o=["headers","auth","proxy","params"],a=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],s=["validateStatus"];function c(e,t){return i.isPlainObject(e)&&i.isPlainObject(t)?i.merge(e,t):i.isPlainObject(t)?i.merge({},t):i.isArray(t)?t.slice():t}function u(r){i.isUndefined(t[r])?i.isUndefined(e[r])||(n[r]=c(void 0,e[r])):n[r]=c(e[r],t[r])}i.forEach(r,(function(e){i.isUndefined(t[e])||(n[e]=c(void 0,t[e]))})),i.forEach(o,u),i.forEach(a,(function(r){i.isUndefined(t[r])?i.isUndefined(e[r])||(n[r]=c(void 0,e[r])):n[r]=c(void 0,t[r])})),i.forEach(s,(function(i){i in t?n[i]=c(e[i],t[i]):i in e&&(n[i]=c(void 0,e[i]))}));var l=r.concat(o).concat(a).concat(s),d=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===l.indexOf(e)}));return i.forEach(d,u),n}},function(e,t,n){function i(e){this.message=e}i.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},i.prototype.__CANCEL__=!0,e.exports=i},function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.validateBusiness=t.businessValidate=void 0;var o=n(8),a=n(4),s=n(5),c=n(7);function u(e,t,n){return i(this,void 0,void 0,(function(){return r(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.tim.callExperimentalAPI("isCommercialAbilityEnabled",e)];case 1:if(i.sent().data.enabled)return[2,t.apply(this,n)];try{e===c.CALL_EXPERMENTEL_API_TYPE.BASE&&(this._callDataReport.setCodeAndMessage(a.default.ERROR_PACKAGE_NOT_SUPPORTED,s.ERROR_MESSAGE.ERROR_PACKAGE_NOT_SUPPORTED),this._callDataReport.uploadToKibana())}catch(r){}throw new o.default({message:s.ERROR_MESSAGE.ERROR_PACKAGE_NOT_SUPPORTED,code:a.default.ERROR_PACKAGE_NOT_SUPPORTED});case 2:throw 2905===i.sent().code?new o.default({message:s.ERROR_MESSAGE.ERROR_TIM_VERSION_OUTDATED+" >= 2.21.2",code:a.default.ERROR_TIM_VERSION_OUTDATED}):new o.default({message:s.ERROR_MESSAGE.ERROR_PACKAGE_NOT_SUPPORTED,code:a.default.ERROR_PACKAGE_NOT_SUPPORTED});case 3:return[2]}}))}))}t.businessValidate=function(e){return function(t,n,o){var a=o.value;return o.value=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return i(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,u.call(this,e,a,t)];case 1:return[2,n.sent()];case 2:throw n.sent();case 3:return[2]}}))}))},o}},t.validateBusiness=function(e,t){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e.callExperimentalAPI("isCommercialAbilityEnabled",t)];case 1:if((n=i.sent()).data.enabled)return[2,Promise.resolve(n.data.enabled)];throw new o.default({message:s.ERROR_MESSAGE.ERROR_PACKAGE_NOT_SUPPORTED,code:a.default.ERROR_PACKAGE_NOT_SUPPORTED});case 2:throw 2905===i.sent().code?new o.default({message:s.ERROR_MESSAGE.ERROR_TIM_VERSION_OUTDATED+" >= 2.21.2",code:a.default.ERROR_TIM_VERSION_OUTDATED}):new o.default({message:s.ERROR_MESSAGE.ERROR_PACKAGE_NOT_SUPPORTED,code:a.default.ERROR_PACKAGE_NOT_SUPPORTED});case 3:return[2]}}))}))}},function(e,t,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.API_STATUS=t.VALIDATE_TYPR=void 0,(i=t.VALIDATE_TYPR||(t.VALIDATE_TYPR={})).NUMBER="number",i.STRING="string",i.FUNCTION="function",i.OBJECT="object",i.ARRAY="array",i.BOOLEAN="boolean",function(e){e.ADD="add",e.DEL="del"}(t.API_STATUS||(t.API_STATUS={}))},function(e,t,n){e.exports=n(36)},function(e,t,n){e.exports=function(){var e=6e4,t=36e5,n="millisecond",i="second",r="minute",o="hour",a="day",s="week",c="month",u="quarter",l="year",d="date",p="Invalid Date",h=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,f=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},m=function(e,t,n){var i=String(e);return!i||i.length>=t?e:""+Array(t+1-i.length).join(n)+e},v={s:m,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),i=Math.floor(n/60),r=n%60;return(t<=0?"+":"-")+m(i,2,"0")+":"+m(r,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var i=12*(n.year()-t.year())+(n.month()-t.month()),r=t.clone().add(i,c),o=n-r<0,a=t.clone().add(i+(o?-1:1),c);return+(-(i+(n-r)/(o?r-a:a-r))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:c,y:l,w:s,d:a,D:d,h:o,m:r,s:i,ms:n,Q:u}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},_="en",y={};y[_]=g;var I=function(e){return e instanceof S},M=function e(t,n,i){var r;if(!t)return _;if("string"==typeof t){var o=t.toLowerCase();y[o]&&(r=o),n&&(y[o]=n,r=o);var a=t.split("-");if(!r&&a.length>1)return e(a[0])}else{var s=t.name;y[s]=t,r=s}return!i&&r&&(_=r),r||!i&&_},T=function(e,t){if(I(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new S(n)},C=v;C.l=M,C.i=I,C.w=function(e,t){return T(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var S=function(){function g(e){this.$L=M(e.locale,null,!0),this.parse(e)}var m=g.prototype;return m.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(C.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var i=t.match(h);if(i){var r=i[2]-1||0,o=(i[7]||"0").substring(0,3);return n?new Date(Date.UTC(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,o)):new Date(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,o)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},m.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},m.$utils=function(){return C},m.isValid=function(){return!(this.$d.toString()===p)},m.isSame=function(e,t){var n=T(e);return this.startOf(t)<=n&&n<=this.endOf(t)},m.isAfter=function(e,t){return T(e)<this.startOf(t)},m.isBefore=function(e,t){return this.endOf(t)<T(e)},m.$g=function(e,t,n){return C.u(e)?this[t]:this.set(n,e)},m.unix=function(){return Math.floor(this.valueOf()/1e3)},m.valueOf=function(){return this.$d.getTime()},m.startOf=function(e,t){var n=this,u=!!C.u(t)||t,p=C.p(e),h=function(e,t){var i=C.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return u?i:i.endOf(a)},f=function(e,t){return C.w(n.toDate()[e].apply(n.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},g=this.$W,m=this.$M,v=this.$D,_="set"+(this.$u?"UTC":"");switch(p){case l:return u?h(1,0):h(31,11);case c:return u?h(1,m):h(0,m+1);case s:var y=this.$locale().weekStart||0,I=(g<y?g+7:g)-y;return h(u?v-I:v+(6-I),m);case a:case d:return f(_+"Hours",0);case o:return f(_+"Minutes",1);case r:return f(_+"Seconds",2);case i:return f(_+"Milliseconds",3);default:return this.clone()}},m.endOf=function(e){return this.startOf(e,!1)},m.$set=function(e,t){var s,u=C.p(e),p="set"+(this.$u?"UTC":""),h=(s={},s[a]=p+"Date",s[d]=p+"Date",s[c]=p+"Month",s[l]=p+"FullYear",s[o]=p+"Hours",s[r]=p+"Minutes",s[i]=p+"Seconds",s[n]=p+"Milliseconds",s)[u],f=u===a?this.$D+(t-this.$W):t;if(u===c||u===l){var g=this.clone().set(d,1);g.$d[h](f),g.init(),this.$d=g.set(d,Math.min(this.$D,g.daysInMonth())).$d}else h&&this.$d[h](f);return this.init(),this},m.set=function(e,t){return this.clone().$set(e,t)},m.get=function(e){return this[C.p(e)]()},m.add=function(n,u){var d,p=this;n=Number(n);var h=C.p(u),f=function(e){var t=T(p);return C.w(t.date(t.date()+Math.round(e*n)),p)};if(h===c)return this.set(c,this.$M+n);if(h===l)return this.set(l,this.$y+n);if(h===a)return f(1);if(h===s)return f(7);var g=(d={},d[r]=e,d[o]=t,d[i]=1e3,d)[h]||1,m=this.$d.getTime()+n*g;return C.w(m,this)},m.subtract=function(e,t){return this.add(-1*e,t)},m.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||p;var i=e||"YYYY-MM-DDTHH:mm:ssZ",r=C.z(this),o=this.$H,a=this.$m,s=this.$M,c=n.weekdays,u=n.months,l=function(e,n,r,o){return e&&(e[n]||e(t,i))||r[n].slice(0,o)},d=function(e){return C.s(o%12||12,e,"0")},h=n.meridiem||function(e,t,n){var i=e<12?"AM":"PM";return n?i.toLowerCase():i},g={YY:String(this.$y).slice(-2),YYYY:this.$y,M:s+1,MM:C.s(s+1,2,"0"),MMM:l(n.monthsShort,s,u,3),MMMM:l(u,s),D:this.$D,DD:C.s(this.$D,2,"0"),d:String(this.$W),dd:l(n.weekdaysMin,this.$W,c,2),ddd:l(n.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(o),HH:C.s(o,2,"0"),h:d(1),hh:d(2),a:h(o,a,!0),A:h(o,a,!1),m:String(a),mm:C.s(a,2,"0"),s:String(this.$s),ss:C.s(this.$s,2,"0"),SSS:C.s(this.$ms,3,"0"),Z:r};return i.replace(f,(function(e,t){return t||g[e]||r.replace(":","")}))},m.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},m.diff=function(n,d,p){var h,f=C.p(d),g=T(n),m=(g.utcOffset()-this.utcOffset())*e,v=this-g,_=C.m(this,g);return _=(h={},h[l]=_/12,h[c]=_,h[u]=_/3,h[s]=(v-m)/6048e5,h[a]=(v-m)/864e5,h[o]=v/t,h[r]=v/e,h[i]=v/1e3,h)[f]||v,p?_:C.a(_)},m.daysInMonth=function(){return this.endOf(c).$D},m.$locale=function(){return y[this.$L]},m.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),i=M(e,t,!0);return i&&(n.$L=i),n},m.clone=function(){return C.w(this.$d,this)},m.toDate=function(){return new Date(this.valueOf())},m.toJSON=function(){return this.isValid()?this.toISOString():null},m.toISOString=function(){return this.$d.toISOString()},m.toString=function(){return this.$d.toUTCString()},g}(),E=S.prototype;return T.prototype=E,[["$ms",n],["$s",i],["$m",r],["$H",o],["$W",a],["$M",c],["$y",l],["$D",d]].forEach((function(e){E[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),T.extend=function(e,t){return e.$i||(e(t,S,T),e.$i=!0),T},T.locale=M,T.isDayjs=I,T.unix=function(e){return T(1e3*e)},T.en=y[_],T.Ls=y,T.p={},T}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(31),r=n(15),o=n(13);t.default={TUICallEngine:i.default,TUICallEvent:r.TUICallEvent,TUICallType:o.TUICallType}},function(e,t,n){var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},c=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i};Object.defineProperty(t,"__esModule",{value:!0});var u=n(32),l=n(1),d=n(33),p=n(17),h=n(56),f=n(57),g=n(59),m=n(9),v=n(11),_=n(12),y=n(10),I=n(60),M=n(0),T=n(7),C=n(8),S=n(4),E=n(5),k=n(2),b=n(61),D=n(68),w=p,A=h,R=n(16),L="TUICallEngine",O=function(){function e(e){this._localPlayOptions={mirror:!1,muted:!0,objectFit:k.NAME.COVER},this._remotePlayOptions={mirror:!1,muted:!1,objectFit:k.NAME.COVER},this._permission={audio:!1,video:!1},this._sdkAppID=e.SDKAppID,this._isLogin=!1,this._trtcClient=null,this._userID="",this._userSig="",this._switchCallModeStatus=!0,this._timExternal=!1,this._inviterInviteID={},this._audioVideoSwitchIdList=[],this._acceptedUserObject={},this._callTimeout=30,this._callStatus=T.CALL_STATUS.IDLE,this._callType=T.CALL_TYPE.UNKNOWN,this._roomID=0,this._isInviter=!1,this._isGroupCall=!1,this._groupCallStatus=!1,this._inviteeList=[],this._unHandledInviteeList=[],this._handledInviteeList=[],sessionStorage.setItem("sdkAppId",""+this._sdkAppID),this._localViewId="",this._netMonitor=new I.default,this._outerEmitter=new u.default,this._delegate=new g.default(this._outerEmitter),this._callDataReport=new D.CallDataReport({version:R.version,sdkAppId:e.SDKAppID}),this._dataReportObserver=new D.TUICallEngineObserver(this._outerEmitter,this._callDataReport),this._connectStartTime=0,e.tim&&(this._timExternal=!0),this.tim=e.tim||A.create(e),this._tsignalingClient=new f.default(this,i(i({tim:this.tim},e),{isRejectNotifyAll:!0})),this._quality="480p";var t=new m.default(v.default.SDK_CONSTRUCT);this._eventStatController=new _.default,m.default.bindController(this._eventStatController),t.setText("version="+R.version+"-ua="+y.USER_AGENT).setEnd(),M.default.info(L+" SDK Version:"+R.version+", SDKAppID:"+e.SDKAppID+", UserAgent:"+y.USER_AGENT)}return e.prototype.getDevicePermission=function(){return this._permission},e.prototype.setDevicePermission=function(e,t){this._permission[e]=t},e.prototype.getTrtcClient=function(){var e;return null===(e=this._trtcClient)||void 0===e?void 0:e.getClient()},e.prototype.getUserID=function(){return this._userID},e.prototype.setRoomID=function(e){this._roomID=e},e.prototype.getRoomID=function(){return this._roomID},e.prototype.getCallType=function(){return this._callType},e.prototype.setCallType=function(e){this._callType=e},e.prototype.isInviter=function(){return this._isInviter},e.prototype.setConnectStartTime=function(e){this._connectStartTime=e},e.prototype.getConnectStartTime=function(){return this._connectStartTime},e.prototype.getInviteeList=function(){return this._inviteeList},e.prototype.setInviteeList=function(e){this._inviteeList=c(e)},e.prototype.getCallDataReport=function(){return this._callDataReport},e.prototype.getUnHandledInviteeList=function(){return this._unHandledInviteeList||[]},e.prototype.setUnHandledInviteeList=function(e){this._unHandledInviteeList=c(e),M.default.log(L+".setUnHandledInviteeList",this._unHandledInviteeList)},e.prototype.addUnHandledInviteeList=function(e){var t=this;void 0===e&&(e=[]),0!==e.length&&e.forEach((function(e){-1===t._unHandledInviteeList.indexOf(e)&&t._unHandledInviteeList.push(e)}))},e.prototype.deleteUnHandledInviteeList=function(e){var t=this;void 0===e&&(e=[]),0!==e.length&&e.forEach((function(e){t._unHandledInviteeList=t._unHandledInviteeList.filter((function(t){return t!==e}))}))},e.prototype.getHandledInviteeList=function(){return this._handledInviteeList||[]},e.prototype.setHandledInviteeList=function(e){this._handledInviteeList=c(e),M.default.log(L+".setHandledInviteeList",this._handledInviteeList)},e.prototype.addHandledInviteeList=function(e){var t=this;void 0===e&&(e=[]),0!==e.length&&e.forEach((function(e){-1===t._handledInviteeList.indexOf(e)&&t._handledInviteeList.push(e)}))},e.prototype.deleteHandledInviteeList=function(e){var t=this;void 0===e&&(e=[]),0!==e.length&&e.forEach((function(e){t._handledInviteeList=t._handledInviteeList.filter((function(t){return t!==e}))}))},e.prototype.isGroupCall=function(){return this._isGroupCall},e.prototype.setIsGroupCall=function(e){this._isGroupCall=e},e.prototype.getGroupID=function(){return this._groupID},e.prototype.setGroupID=function(e){this._groupID=e},e.prototype.setLocalPlayOptions=function(e){void 0===e&&(e={}),this._localPlayOptions=i(i({},this._localPlayOptions),e)},e.prototype.getLocalPlayOptions=function(){return this._localPlayOptions||{}},e.prototype.setRemotePlayOptions=function(e){void 0===e&&(e={}),this._remotePlayOptions=i(i({},this._remotePlayOptions),e)},e.prototype.getRemotePlayOptions=function(){return this._remotePlayOptions||{}},e.prototype.addAcceptedUserList=function(e,t){var n=this;if(0!==t.length)if(e)0===(this._acceptedUserObject[e]||[]).length?this._acceptedUserObject[e]=t:t.forEach((function(t){-1===n._acceptedUserObject[e].indexOf(t)&&n._acceptedUserObject[e].push(t)}));else for(var i=this.getInviterInviteIdList(),r=function(e){var r=i[e],a=o.getInviterInviteIdUserList(r),s=t.filter((function(e){return-1!==a.indexOf(e)}));0===(o._acceptedUserObject[r]||[]).length?o._acceptedUserObject[r]=s:s.forEach((function(e){-1===n._acceptedUserObject[r].indexOf(e)&&n._acceptedUserObject[r].push(e)}))},o=this,a=0;a<i.length;a++)r(a)},e.prototype.getAcceptedUserList=function(e){return this._acceptedUserObject[e]||[]},e.prototype.setIsLogin=function(e){this._isLogin=e},e.prototype.getIsLogin=function(){return this._isLogin},e.createInstance=function(t){return e.instance||(e.instance=new e(t)),e.instance},e.prototype.destroyInstance=function(){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.getIsLogin()?this._timExternal?[4,this.logout()]:[3,2]:[3,4];case 1:return t.sent(),[3,4];case 2:return[4,this.tim.destroy()];case 3:t.sent(),t.label=4;case 4:return this._callDataReport.reset(),this._dataReportObserver.removeLister(),e.instance=null,[2]}}))}))},e.prototype.setLogLevel=function(e){M.default.setLevel(e),this._tsignalingClient.setLogLevel(e),w.Logger.setLogLevel(1)},e.prototype.on=function(e,t,n){this._outerEmitter.on(e,t,n||this)},e.prototype.off=function(e,t,n){this._outerEmitter.off(e,t,n||this)},e.prototype.init=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.login(e)]}))}))},e.prototype.login=function(e){return a(this,void 0,void 0,(function(){var t,n,i,r,o;return s(this,(function(a){switch(a.label){case 0:if(this.getIsLogin())return M.default.warn(L+".login - userId has been login"),[2];a.label=1;case 1:return a.trys.push([1,3,,4]),M.default.debug(L+".login - params:",e),this._netMonitor.start(),t=e.userID,n=e.userSig,i=e.assetsPath,this._userID=t,this._callDataReport.setUserID(t),this._userSig=n,this._trtcClient=new d.default({sdkAppID:this._sdkAppID,userID:t,userSig:n,tuiCallEngine:this,assetsPath:i}),sessionStorage.setItem("userId",""+this._userID),[4,this._tsignalingClient.login({userID:t,userSig:n})];case 2:return r=a.sent(),this.setIsLogin(!0),this._setInterfaceUpLoad(v.default.LOGIN).setText("userId: "+this._userID+" login succeeded, assetsPath: "+i).setEnd(),[2,r];case 3:throw o=a.sent(),this._setInterfaceUpLoad(v.default.LOGIN).setText("userId: "+this._userID+" login failed, error: "+o).setEnd(),new Error(L+".login - userId: "+this._userID+" login failed, error: "+o+" ");case 4:return[2]}}))}))},e.prototype.logout=function(){return a(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:M.default.debug(L+".logout"),this._setInterfaceUpLoad(v.default.LOGOUT).setText("userId: "+this._userID+" logout").setEnd(),this._userID="",this._userSig="",t.label=1;case 1:return t.trys.push([1,5,,6]),[4,this._resetTUICallEngine()];case 2:return t.sent(),this._trtcClient.removeTRTCEvents(),this._trtcClient=null,this.setIsLogin(!1),this._timExternal?[3,4]:[4,this._tsignalingClient.logout()];case 3:t.sent(),t.label=4;case 4:return[2,!0];case 5:throw e=t.sent(),new Error(L+".logout failed, error: "+e+" ");case 6:return[2]}}))}))},e.prototype.call=function(e){var t,n;return a(this,void 0,void 0,(function(){var r,o,a,c,u,d,p,h,f,g;return s(this,(function(s){switch(s.label){case 0:M.default.log(L+".call - params:",e),this._callDataReport.setAbilityBit(!0),this._callDataReport.setCallScene(k.NAME.SINGLE_CALL),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,null===(t=this._trtcClient)||void 0===t?void 0:t.getMediaDevicesAuth({audio:!0})];case 2:return s.sent(),[3,4];case 3:throw r=s.sent(),this._delegate.onError(S.default.NOT_MEDIA_ACCESS,JSON.stringify(r)),this._callDataReport.setCodeAndMessage(S.default.NOT_MEDIA_ACCESS,JSON.stringify(r)),this._callDataReport.uploadToKibana(),new Error(L+".call failed. error: "+r);case 4:if(o=e.userID,a=e.type,c=e.offlinePushInfo,u=e.roomID,d=e.timeout,this.getUserID()===o)throw M.default.log(L+".call failed. Called id can't be yourself. userId:"+this.getUserID()+", inviteeId:"+o),new Error(L+".call failed. Called id can't be yourself. userId:"+this.getUserID()+", inviteeId:"+o);this._callStatus=T.CALL_STATUS.CALLING,this._callType=a,this._isInviter=!0,this._inviterID=this._userID,this._inviteeID=o,this._isGroupCall=!1,this._groupID="",this._roomID=u||l.generateRandomRoomID(),this._callTimeout=d||this._callTimeout,M.default.info("roomID:"+this._roomID),s.label=5;case 5:return s.trys.push([5,11,,13]),[4,null===(n=this._trtcClient)||void 0===n?void 0:n.join(this._roomID)];case 6:return s.sent(),this._callDataReport.setEnterRoomTime((new Date).getTime()),this._tsignalingClient.setTSignalingIsJoined(!0),p=this._callDataReport.getCallData(),p=i(i({},p),{roomID:this._roomID,callRole:T.CALL_ROLE.INVITER,callType:this._callType,inviteeList:[o]}),this._callDataReport.setCallData(p),[4,this._tsignalingClient.invite({userID:o,type:a,roomID:this._roomID,timeout:this._callTimeout,offlinePushInfo:c,userIDList:[o]})];case 7:return h=s.sent(),this._callDataReport.setSendSignalingTime((new Date).getTime()),this.setHandledInviteeList([this._userID]),this.setUnHandledInviteeList([o]),f="callType: "+(a+1)+",\n        conversationType: "+h.data.message.conversationType+", \n        userId:{ "+h.data.message.from+" } invite userId:{ "+h.data.message.to+" }",0!==h.code?[3,8]:(this.addInviterInviteId(h.inviteID,[this._userID,o]),this._callDataReport.setInviteID(h.inviteID),this._setInterfaceUpLoad(v.default.CALL).setCallType(a+1).setText(f+" succeeded").setEnd(),[3,10]);case 8:return this._callDataReport.setCodeAndMessage(h.code,h.message),this._callDataReport.uploadToKibana(),this._setInterfaceUpLoad(v.default.CALL).setCallType(a+1).setText(f+" failed").setEnd(),[4,this._resetTUICallEngine()];case 9:s.sent(),s.label=10;case 10:return[2,h];case 11:return(g=s.sent()).getCode?this._callDataReport.setCodeAndMessage(g.getCode(),g.message):this._callDataReport.setCodeAndMessage(S.default.UNKNOWN,JSON.stringify(g)),this._callDataReport.uploadToKibana(),[4,this._resetTUICallEngine()];case 12:throw s.sent(),new C.default({message:L+"<call>: failed "+g.message,code:g.code});case 13:return[2]}}))}))},e.prototype.addAudioVideoSwitchIdList=function(e){e&&this._audioVideoSwitchIdList.push(e)},e.prototype.getAudioVideoSwitchIdList=function(){return this._audioVideoSwitchIdList||[]},e.prototype.addInviterInviteId=function(e,t){0!==t.length&&(0===(this._inviterInviteID[e]||[]).length?this._inviterInviteID[e]=t:this._inviterInviteID[e]=c(this._inviterInviteID[e],t))},e.prototype.getInviterInviteIdList=function(){return Object.keys(this._inviterInviteID||{})},e.prototype.getTotalInviterInviteIdList=function(){var e=this.getInviterInviteIdList();return c(this._audioVideoSwitchIdList,e)},e.prototype.getInviterInviteIdUserList=function(e){return this._inviterInviteID[e]||[]},e.prototype._setInterfaceUpLoad=function(e){return M.default.time(e),new m.default(e)},e.prototype.getInviterID=function(){return this._inviterID},e.prototype.setInviterID=function(e){this._inviterID=e},e.prototype.groupCall=function(e){var t,n;return a(this,void 0,void 0,(function(){var i,r,o,a,u,d,p,h,f,g;return s(this,(function(s){switch(s.label){case 0:if(0===(null===(t=null==e?void 0:e.userIDList)||void 0===t?void 0:t.length))throw new C.default({message:L+"<groupCall>: userIDList don'\t empty ",code:S.default.ERROR_PARAM_INVALID});if(this._groupCallStatus)throw new Error(L+".groupCall - CALL_STATUS: "+this._callStatus);this._groupCallStatus=!0,M.default.debug(L+".groupCall - params:",e),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,null===(n=this._trtcClient)||void 0===n?void 0:n.getMediaDevicesAuth({audio:!0})];case 2:return s.sent(),[3,4];case 3:throw i=s.sent(),this._delegate.onError(S.default.NOT_MEDIA_ACCESS,JSON.stringify(i)),new Error(L+".groupCall failed. error: "+i);case 4:if(r=e.userIDList,o=e.type,a=e.groupID,u=e.offlinePushInfo,d=e.roomID,p=e.timeout,-1!==(r=c(r)).indexOf(this.getUserID()))throw M.default.log(L+".groupCall failed. Called list can't contain yourself. userId:"+this.getUserID()+", inviteeIdList:"+r),new Error(L+".groupCall failed. Called list can't contain yourself. userId:"+this.getUserID()+", inviteeIdList:"+r);this._callType=o,this._isInviter=!0,this._isGroupCall=!0,this._inviterID=this._userID,this._groupID=a||"",this.setInviteeList(r),this.setHandledInviteeList([this._userID]),this.setUnHandledInviteeList(r),this._roomID||(this._roomID=d||l.generateRandomRoomID(),this._callStatus=T.CALL_STATUS.CALLING),this._callTimeout=p||this._callTimeout,this._callDataReport.setCallScene(k.NAME.GROUP_CALL),s.label=5;case 5:return s.trys.push([5,8,,10]),[4,this._trtcClient.join(this._roomID)];case 6:return s.sent(),this._tsignalingClient.setTSignalingIsJoined(!0),[4,this._tsignalingClient.inviteInGroup({groupID:this._groupID,userIDList:r,type:o,roomID:this._roomID,timeout:this._callTimeout,offlinePushInfo:u})];case 7:return h=s.sent(),M.default.log("groupCall res",h),a&&(f="callType: "+(o+1)+",\n        conversationType: "+h.data.message.conversationType+",\n        userId:{ "+h.data.message.from+" } invite { "+h.data.message.to+": "+r+" }",0===h.code?(this.addInviterInviteId(h.inviteID,c([this._userID],r)),this._setInterfaceUpLoad(v.default.GROUP_CALL).setCallType(o+1).setText(f+"  succeeded").setEnd()):this._setInterfaceUpLoad(v.default.GROUP_CALL).setCallType(o+1).setText(f+"  failed").setEnd()),this._groupCallStatus=!1,[2,h];case 8:return g=s.sent(),[4,this._resetTUICallEngine()];case 9:throw s.sent(),new C.default({message:L+"<groupCall>: failed "+g.message,code:g.code});case 10:return[2]}}))}))},e.prototype.joinInGroupCall=function(e){var t,n;return a(this,void 0,void 0,(function(){var i,r,o,a,c;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,null===(t=this._trtcClient)||void 0===t?void 0:t.getMediaDevicesAuth({audio:!0})];case 1:return s.sent(),[3,3];case 2:throw i=s.sent(),new Error(L+".joinInGroupCall failed, error: "+i);case 3:return s.trys.push([3,5,,7]),r=e.roomID,o=e.type,a=e.groupID,this._callType=o,this._groupID=a,this._roomID=r,this._isGroupCall=!0,this._isInviter=!1,this.addHandledInviteeList([this.getUserID()]),this.changeCallStatus(T.CALL_STATUS.CALLING),[4,null===(n=this._trtcClient)||void 0===n?void 0:n.join(r)];case 4:return s.sent(),M.default.log(L+".joinInGroupCall roomID:"+r+",type:"+o+",userID:"+this.getUserID()),[3,7];case 5:return c=s.sent(),[4,this._resetTUICallEngine()];case 6:throw s.sent(),new Error(L+".joinInGroupCall failed error: "+c);case 7:return[2]}}))}))},e.prototype.inviteUser=function(e){return a(this,void 0,void 0,(function(){var t,n,i,r,o,a,u,l,d,p,h,f=this;return s(this,(function(s){switch(s.label){case 0:if(!this.isGroupCall())throw M.default.error(L+".inviteUser failed - groupID:"+this._groupID+", roomID:"+this._roomID+", type:"+this._callType),new Error(L+".inviteUser failed - groupID:"+this._groupID+", roomID:"+this._roomID+", type:"+this._callType);if(!this.isInviter()&&this._callStatus!==T.CALL_STATUS.CONNECTED)throw M.default.error(L+".inviteUser failed - current status:"+this._callStatus+" not support"),new Error(L+".inviteUser failed - current status:"+this._callStatus+" not support");if(t=e.userIDList,n=void 0===t?[]:t,i=e.offlinePushInfo,0===n.length)throw M.default.error(L+".inviteUser failed - userIDList is empty"),new Error(L+".inviteUser failed - userIDList is empty");if(r=this.getHandledInviteeList(),o=this.getUnHandledInviteeList(),a=c(r,o),0===(u=n.filter((function(e){return-1===a.indexOf(e)}))).length)return M.default.error(L+".inviteUser failed - userIDList in call list. userIDList:"+JSON.stringify(n)+", call list:"+JSON.stringify(a)),[2,Promise.reject(L+".inviteUser failed - userIDList in call list. userIDList:"+JSON.stringify(n)+", call list:"+JSON.stringify(a))];n=u,s.label=1;case 1:return s.trys.push([1,3,,4]),l=this._handledInviteeList.filter((function(e){return e!==f._userID})),[4,this._tsignalingClient.inviteInGroup({groupID:this._groupID,userIDList:n,type:this._callType,roomID:this._roomID,timeout:this._callTimeout,inCallUserIDs:c(this._unHandledInviteeList,l),offlinePushInfo:i})];case 2:return d=s.sent(),M.default.log("inviteUser res",d),p="callType: "+(this._callType+1)+",\n      conversationType: "+d.data.message.conversationType+",\n      userId:{ "+d.data.message.from+" } invite { "+d.data.message.to+": "+n+" }",0===d.code?(this.addUnHandledInviteeList(n),this.addInviterInviteId(d.inviteID,c([this._userID],n)),this._setInterfaceUpLoad(v.default.GROUP_CALL).setCallType(this._callType+1).setText(p+"  succeeded").setEnd()):this._setInterfaceUpLoad(v.default.GROUP_CALL).setCallType(this._callType+1).setText(p+"  failed").setEnd(),[2,d];case 3:throw h=s.sent(),new Error(L+".inviteUser failed, userId:"+this.getUserID()+", inviteeIdList:"+n+", error: "+h);case 4:return[2]}}))}))},e.prototype.accept=function(){var e,t,n,r,o,c;return a(this,void 0,void 0,(function(){var a,u,l,d,p,h,f,g,m,_,y;return s(this,(function(s){switch(s.label){case 0:if(M.default.debug(L+".accept"),this.getCallStatus()===T.CALL_STATUS.CONNECTED)return M.default.warn(L+".accept - already connected, avoid repeat accept"),[2];if(!this._tsignalingClient.getInviteData())return M.default.warn(L+".accept - there are no calls to accept"),[2];this._callDataReport.setCallAcceptTime((new Date).getTime()),s.label=1;case 1:return s.trys.push([1,5,,6]),[4,null===(e=this._trtcClient)||void 0===e?void 0:e.getMediaDevicesAuth({audio:!0})];case 2:return s.sent().audio?[3,4]:[4,this._resetTUICallEngine()];case 3:s.sent(),s.label=4;case 4:return[3,6];case 5:throw a=s.sent(),this.isGroupCall()&&(this._callDataReport.setCodeAndMessage(S.default.NOT_MEDIA_ACCESS,JSON.stringify(a)),this._callDataReport.uploadToKibana()),new Error(L+".accept failed, error: "+a);case 6:u=this._tsignalingClient.getInviteData(),l=u.inviteID,d=u.inviteData,p=d.roomID,h=d.callType,M.default.debug(L+".accept - params","inviteID: "+l+",callType: "+h+",roomID: "+p+"."),this._callType=h,this._callStatus=T.CALL_STATUS.CALLING,f={},s.label=7;case 7:return s.trys.push([7,9,,11]),this._callDataReport.setEnterRoomTime((new Date).getTime()),[4,null===(t=this._trtcClient)||void 0===t?void 0:t.join(p)];case 8:return f=s.sent(),this.addHandledInviteeList([this.getUserID()]),this.deleteUnHandledInviteeList([this.getUserID()]),this.addAcceptedUserList(l,[this.getUserID()]),this._tsignalingClient.setInviteData(null),this.changeCallStatus(T.CALL_STATUS.CONNECTED),[3,11];case 9:return g=s.sent(),this.isGroupCall()||(g.getCode?this._callDataReport.setCodeAndMessage(g.getCode(),g.message):this._callDataReport.setCodeAndMessage(S.default.UNKNOWN,JSON.stringify(g)),this._callDataReport.uploadToKibana()),[4,this._resetTUICallEngine()];case 10:throw s.sent(),new Error(L+".accept failed, error: "+g);case 11:f=i(i({},f),{roomID:p,callType:h}),s.label=12;case 12:return s.trys.push([12,14,,16]),[4,this._tsignalingClient.accept({inviteID:l,callType:h})];case 13:return m=s.sent(),y="callType: "+(h+1)+",\n      conversationType: "+m.data.message.conversationType+",\n      userId:{ "+this._userID+" } accept userId:{ "+m.data.message.to+" } succeeded",this._setInterfaceUpLoad(v.default.ACCEPT).setCallType(h+1).setText(""+y).setEnd(),[3,16];case 14:return _=s.sent(),M.default.error(_),[4,this._resetTUICallEngine()];case 15:throw s.sent(),y="callType: "+(h+1)+",\n      conversationType: "+(null===(r=null===(n=null==m?void 0:m.data)||void 0===n?void 0:n.message)||void 0===r?void 0:r.conversationType)+",\n      userId:{ "+this._userID+" } accept userId:{ "+(null===(c=null===(o=null==m?void 0:m.data)||void 0===o?void 0:o.message)||void 0===c?void 0:c.to)+" } failed",this._setInterfaceUpLoad(v.default.ACCEPT).setCallType(h+1).setText(""+y).setEnd(),this.isGroupCall()||(this._callDataReport.setCodeAndMessage(S.default.UNKNOWN,JSON.stringify(_)),this._callDataReport.uploadToKibana()),new C.default({message:L+"<accept>: failed "+_.message,code:_.code});case 16:return this.isGroupCall()&&(y="callType: "+(h+1)+",\n      conversationType: "+m.data.message.conversationType+",\n      userId:{ "+this._userID+" } accept userId:{ "+m.data.message.to+" } succeeded",this._setInterfaceUpLoad(v.default.ACCEPT).setCallType(h+1).setText(y).setEnd()),[2,i(i({},f),m)]}}))}))},e.prototype.reject=function(){return a(this,void 0,void 0,(function(){var e,t,n,i,r,o,a,c;return s(this,(function(s){switch(s.label){case 0:if(!this._tsignalingClient.getInviteData())return M.default.warn(L+".reject - there are no calls to reject"),[2];e=this._callStatus===T.CALL_STATUS.CONNECTED,t=this._tsignalingClient.getInviteData(),n=t.inviteID,i=t.inviteData,r=i.callType,M.default.warn(L+".reject - params","inviteID: "+n+",callType: "+r+",isBusy: "+e+"."),s.label=1;case 1:return s.trys.push([1,5,,6]),[4,this._tsignalingClient.reject({inviteID:n,callType:r,isBusy:e})];case 2:return o=s.sent(),a="callType: "+(r+1)+",\n      conversationType: "+o.data.message.conversationType+",\n      userId:{ "+this._userID+" } reject userId:{ "+o.data.message.to+" } succeeded",this._setInterfaceUpLoad(v.default.REJECT).setCallType(r+1).setText(a).setEnd(),e?[3,4]:[4,this._resetTUICallEngine()];case 3:s.sent(),this._delegate.onCallingCancel(this._userID),s.label=4;case 4:return[2,o];case 5:throw c=s.sent(),new C.default({message:L+"<reject>: failed "+c.message,code:c.code});case 6:return[2]}}))}))},e.prototype.hangup=function(){var e;return a(this,void 0,void 0,(function(){var t,n,i,r,o,a,u,l,d,p,h,f,g,m,_,y,I,C,S;return s(this,(function(E){switch(E.label){case 0:if(M.default.warn(L+". - callStatus:"+this._callStatus+" _inviterInviteID:"+JSON.stringify(this._acceptedUserObject)),this._callStatus===T.CALL_STATUS.IDLE)throw new Error(L+".hangup failed. current status:"+this._callStatus);if(this._callStatus===T.CALL_STATUS.CALLING&&0===this.getInviterInviteIdList().length)throw new Error(L+".call/groupCall incomplete。please wait cancel");if(t=this.isGroupCall(),n=this.isInviter(),i=this.getUserID(),r=Math.round((Date.now()-this.getConnectStartTime())/1e3),o=this.getCallType(),u=this.getInviterInviteIdList(),this._callStatus!==T.CALL_STATUS.CONNECTED)return[3,8];E.label=1;case 1:return E.trys.push([1,5,,7]),[4,null===(e=this._trtcClient)||void 0===e?void 0:e.leave()];case 2:return E.sent(),0!==u.length?[3,4]:(h=this.generateCallEndData({callMediaType:o,totalTime:r}),this._delegate.onCallEnd(h),[4,this._resetTUICallEngine()]);case 3:E.sent(),E.label=4;case 4:return[3,7];case 5:return l=E.sent(),[4,this._resetTUICallEngine()];case 6:throw E.sent(),new Error(l);case 7:this._setInterfaceUpLoad(v.default.REJECT).setText("userId: "+this._userID+" hangup succeeded").setEnd(),E.label=8;case 8:d=this.getHandledInviteeList(),p=this.getUnHandledInviteeList(),E.label=9;case 9:return E.trys.push([9,31,,32]),t?[3,16]:(h=this.generateCallEndData(),n?1!==p.length?[3,11]:[4,this._cancel()]:[3,13]);case 10:return a=E.sent(),this._delegate.onCallingCancel(i),[3,12];case 11:this._delegate.onCallEnd(h),E.label=12;case 12:return[3,14];case 13:this._delegate.onCallEnd(h),E.label=14;case 14:return[4,this._resetTUICallEngine()];case 15:return E.sent(),[3,30];case 16:return f=this.getCallStatus(),g={callType:o,userIDList:c(d.filter((function(e){return e!==i})),p),callEnd:r},n?f!==T.CALL_STATUS.CALLING?[3,19]:[4,this._cancel(this.getInviterInviteIdList())]:[3,24];case 17:return a=E.sent(),[4,this._resetTUICallEngine()];case 18:E.sent(),this._delegate.onCallingCancel(i),E.label=19;case 19:if(f!==T.CALL_STATUS.CONNECTED)return[3,23];m=function(e){var t,n,r,o,l,h;return s(this,(function(s){switch(s.label){case 0:return t=u[e],n=_.getInviterInviteIdUserList(t),(r=_.getAcceptedUserList(t)).length>0?(o=r.filter((function(e){return-1!==d.indexOf(e)})),l=n.filter((function(e){return-1!==p.indexOf(e)})),g.userIDList=c(o,l).filter((function(e){return e!==i})),M.default.warn("inviter emit hangup signal, notify userIDList:"+JSON.stringify(g.userIDList)),[4,_._tsignalingClient.hangup(g)]):[3,2];case 1:return a=s.sent(),[3,4];case 2:return h=_.getUnHandledInviteeList(),n.filter((function(e){return-1!==h.indexOf(e)})).length>0?(M.default.warn("inviter emit cancel signal, userIdList:"+n),[4,_._cancel([t])]):[3,4];case 3:a=s.sent(),s.label=4;case 4:return[2]}}))},_=this,C=0,E.label=20;case 20:return C<u.length?[5,m(C)]:[3,23];case 21:E.sent(),E.label=22;case 22:return C++,[3,20];case 23:return[3,28];case 24:y=function(e){var t,n,r,o,l,h;return s(this,(function(s){switch(s.label){case 0:return t=u[e],n=I.getInviterInviteIdUserList(t),(r=I.getAcceptedUserList(t)).length>0?(o=r.filter((function(e){return-1!==d.indexOf(e)})),l=n.filter((function(e){return-1!==p.indexOf(e)})),g.userIDList=c(o,l).filter((function(e){return e!==i})),M.default.warn("invitee emit hangup signal, notify userIDList:"+JSON.stringify(g.userIDList)),[4,I._tsignalingClient.hangup(g)]):[3,2];case 1:return a=s.sent(),[3,4];case 2:return h=I.getUnHandledInviteeList(),n.filter((function(e){return-1!==h.indexOf(e)})).length>0?(M.default.warn("invitee emit cancel signal, inviteID:"+t),[4,I._cancel([t])]):[3,4];case 3:a=s.sent(),s.label=4;case 4:return[2]}}))},I=this,C=0,E.label=25;case 25:return C<u.length?[5,y(C)]:[3,28];case 26:E.sent(),E.label=27;case 27:return C++,[3,25];case 28:return[4,this._resetTUICallEngine()];case 29:E.sent(),E.label=30;case 30:return[2,a];case 31:throw S=E.sent(),M.default.warn(L+".hangup failed, error: "+S),new Error(L+".hangup failed, error: "+S);case 32:return[2]}}))}))},e.prototype._cancel=function(e){return a(this,void 0,void 0,(function(){var t,n,i,r,o,a;return s(this,(function(s){switch(s.label){case 0:M.default.log("_cancel _inviterInviteID",this._inviterInviteID),t=[],s.label=1;case 1:s.trys.push([1,6,,7]),0===(e||[]).length&&(e=this.getInviterInviteIdList().slice(0,1)),n=0,s.label=2;case 2:return n<e.length?(i=e[n],[4,this._tsignalingClient.cancel({inviteID:i})]):[3,5];case 3:r=s.sent(),t.push(r),s.label=4;case 4:return n++,[3,2];case 5:return[3,7];case 6:throw o=s.sent(),new C.default({message:L+"<_cancel>: failed "+o.message,code:o.code});case 7:return a="cancel "+JSON.stringify(t)+" succeeded",M.default.log(L+"._cancel "+a),this._setInterfaceUpLoad(v.default.CALLING_CANCEL).setText(a).setEnd(),[2,t]}}))}))},e.prototype.startRemoteView=function(e){var t;return a(this,void 0,void 0,(function(){var n,i,r;return s(this,(function(o){return M.default.debug(L+".startRemoteView - params:",e),n=e.userID,i=e.videoViewDomID,r=e.options,this._setInterfaceUpLoad(v.default.START_REMOTE_VIEW).setText("remote userId:{ "+n+" } startRemoveView succeeded").setEnd(),[2,null===(t=this._trtcClient)||void 0===t?void 0:t.playRemoteVideo({videoViewDomID:i,userID:n,options:r})]}))}))},e.prototype.stopRemoteView=function(e){var t;return a(this,void 0,void 0,(function(){var n;return s(this,(function(i){return M.default.debug(L+".stopRemoteView - params:",e),n=e.userID,this._setInterfaceUpLoad(v.default.STOP_REMOTE_VIEW).setText("remote userId:{ "+n+" } stopRemoveView succeeded").setEnd(),[2,null===(t=this._trtcClient)||void 0===t?void 0:t.stopRemoteVideo({userID:n})]}))}))},e.prototype.startLocalView=function(e){var t;return a(this,void 0,void 0,(function(){var n,i,r,o;return s(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),M.default.debug(L+".startLocalView - params:",e),n=e.userID,i=e.videoViewDomID,r=e.options,this._localViewId=i,this._setInterfaceUpLoad(v.default.START_LOCAL_VIEW).setText("remote userId:{ "+n+" } startLocalView succeeded").setEnd(),[4,null===(t=this._trtcClient)||void 0===t?void 0:t.playLocalVideo({videoViewDomID:i,userID:n,options:r})];case 1:return a.sent(),[3,3];case 2:throw o=a.sent(),new Error(L+".startLocalView failed. error: "+o);case 3:return[2]}}))}))},e.prototype.stopLocalView=function(e){var t;return a(this,void 0,void 0,(function(){var n;return s(this,(function(i){return M.default.debug(L+".stopLocalView - params:",e),n=e.userID,this._localViewId="",this._setInterfaceUpLoad(v.default.STOP_LOCAL_VIEW).setText("remote userId:{ "+n+" } stopLocalView succeeded").setEnd(),[2,null===(t=this._trtcClient)||void 0===t?void 0:t.stopLocalVideo()]}))}))},e.prototype.openCamera=function(e){var t,n;return a(this,void 0,void 0,(function(){var i,r,o;return s(this,(function(a){switch(a.label){case 0:if(a.trys.push([0,3,,4]),i=e,!e){if(!this._localViewId)return M.default.error(L+".openCamera failed. error: A DOM parameter is required to render the camera data"),[2];M.default.warn(L+".openCamera warning. warn: A DOM parameter is required to render the camera data. "+L+".startLocalView() will be deprecated soon."),i=this._localViewId}return[4,null===(t=this._trtcClient)||void 0===t?void 0:t.getMediaDevicesAuth({video:!0,isThrowVideoError:!0})];case 1:return a.sent(),r={videoViewDomID:i,userID:this.getUserID()},[4,null===(n=this._trtcClient)||void 0===n?void 0:n.playLocalVideo(r)];case 2:return a.sent(),[3,4];case 3:throw o=a.sent(),M.default.error(L+".openCamera failed. error: "+o),new Error(L+".openCamera failed. error: "+o);case 4:return[2]}}))}))},e.prototype.closeCamera=function(){var e;return a(this,void 0,void 0,(function(){return s(this,(function(t){try{return this._setInterfaceUpLoad(v.default.CLOSE_CAMERA).setText("close camera").setEnd(),[2,null===(e=this._trtcClient)||void 0===e?void 0:e.stopLocalVideo()]}catch(n){throw new Error(L+".closeCamera failed. error: "+n)}return[2]}))}))},e.prototype.openMicrophone=function(){var e;return a(this,void 0,void 0,(function(){return s(this,(function(t){return this._setInterfaceUpLoad(v.default.SET_MIC_MUTE).setText("openMicrophone").setEnd(),[2,null===(e=this._trtcClient)||void 0===e?void 0:e.unMuteLocalAudio()]}))}))},e.prototype.closeMicrophone=function(){var e;return a(this,void 0,void 0,(function(){return s(this,(function(t){return this._setInterfaceUpLoad(v.default.SET_MIC_MUTE).setText("closeMicrophone").setEnd(),[2,null===(e=this._trtcClient)||void 0===e?void 0:e.muteLocalAudio()]}))}))},e.prototype.setVideoQuality=function(e){var t;return a(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return M.default.debug(L+".setVideoQuality - quality:"+JSON.stringify(e)),e===this.getVideoQuality()?(M.default.warn(L+".setVideoQuality failed - profile not change"),[2]):(this._setInterfaceUpLoad(v.default.SET_VIDEO_QUALITY).setText("setVideoQuality: "+JSON.stringify(e)).setEnd(),this._quality=e,this._trtcClient?[4,this._trtcClient._setVideoProfile(this._trtcClient.getLocalStream(),e)]:[3,2]);case 1:n.sent(),n.label=2;case 2:return this.isInviter()?[4,this._trtcClient]:[3,6];case 3:return n.sent()?[4,null===(t=this._trtcClient)||void 0===t?void 0:t._setVideoProfile(this._trtcClient.getDisplayLocalStream(),e)]:[3,5];case 4:n.sent(),n.label=5;case 5:n.label=6;case 6:return[2]}}))}))},e.prototype.getVideoQuality=function(){return this._quality},e.prototype.setVideoRenderParams=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._trtcClient?[4,this._trtcClient._setVideoRenderParams(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.prototype.switchCallMediaType=function(e){return a(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:if(this._callType===e)throw new C.default({message:L+"<switchCallMediaType>: "+E.ERROR_MESSAGE.ERROR_REQUEST_REPEATED_SWITCH,code:S.default.ERROR_REQUEST_REPEATED});if(!this._switchCallModeStatus)throw new Error(L+" audio and video call switching.");M.default.log(L+".switchCallMediaType",this._inviterID,this._inviteeID),this._setInterfaceUpLoad(v.default.SWITCH_TO_AUDIO_CALL).setText("switchCallMediaType").setEnd(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._tsignalingClient.switchCallMode({userID:this._isInviter?this._inviteeID:this._inviterID,callType:this._callType,roomID:this._roomID,timeout:this._callTimeout,mode:e===T.CALL_TYPE.AUDIO_CALL?T.MODE_TYPE.AUDIO:T.MODE_TYPE.VIDEO})];case 2:return n.sent(),this.setSwitchCallModeStatus(!1),[3,4];case 3:throw t=n.sent(),new Error(L+".switchCallMediaType failed, error: "+t);case 4:return[2]}}))}))},e.prototype.setSwitchCallModeStatus=function(e){this._switchCallModeStatus=e},e.prototype.getSwitchCallModeStatus=function(){return this._switchCallModeStatus},e.prototype.getDeviceList=function(e){var t,n;return a(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:if(e!==T.DEVICE_TYPE.CAMERA)return[3,5];i.label=1;case 1:return i.trys.push([1,4,,5]),[4,null===(t=this._trtcClient)||void 0===t?void 0:t.getMediaDevicesAuth({video:!0,isThrowVideoError:!0})];case 2:return i.sent(),[4,w.getCameras()];case 3:return[2,i.sent()];case 4:throw i.sent(),new C.default({message:L+"<getDeviceList>: "+E.ERROR_MESSAGE.ERROR_PERMISSION_DENIED,code:S.default.ERROR_PERMISSION_DENIED});case 5:if(e!==T.DEVICE_TYPE.MICROPHONES)return[3,10];i.label=6;case 6:return i.trys.push([6,9,,10]),[4,null===(n=this._trtcClient)||void 0===n?void 0:n.getMediaDevicesAuth({audio:!0})];case 7:return i.sent(),[4,w.getMicrophones()];case 8:return[2,i.sent()];case 9:throw i.sent(),new C.default({message:L+"<getDeviceList>: "+E.ERROR_MESSAGE.ERROR_PERMISSION_DENIED,code:S.default.ERROR_PERMISSION_DENIED});case 10:return[2]}}))}))},e.prototype.switchDevice=function(e){var t;return a(this,void 0,void 0,(function(){var n,i;return s(this,(function(r){return n=e.deviceType,i=e.deviceId,M.default.debug(L+".switchDevice -params: deviceType:"+n+",deviceID:"+i),[2,null===(t=this._trtcClient)||void 0===t?void 0:t.switchDevice(n,i)]}))}))},e.prototype.setSelfInfo=function(e){return a(this,void 0,void 0,(function(){var t,n,i;return s(this,(function(r){return t=e.nickName,n=e.avatar,i={nick:t,avatar:n},!t&&delete i.nick,!n&&delete i.avatar,M.default.log(L+".setSelfInfo -params: nickName:"+i.nick+",avatar:"+i.avatar),[2,this.tim.updateMyProfile(i)]}))}))},e.prototype.generateCallEndData=function(e){var t=e||{},n=t.roomId,i=t.callMediaType,r=t.callRole,o=t.totalTime,a=t.userId;return n=n||this.getRoomID(),i=i||this.getCallType(),r||(r=this.isInviter()?T.CALL_ROLE.INVITER:T.CALL_ROLE.INVITEE),{roomID:n,callMediaType:i,callRole:r,totalTime:o=l.isUndefined(o)?Math.round((Date.now()-this.getConnectStartTime())/1e3):o,userID:a=a||this.getUserID()}},e.prototype.enableAIVoice=function(e){var t;return a(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return this._trtcClient?[4,null===(t=this._trtcClient)||void 0===t?void 0:t.enableAIVoice(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},e.prototype._resetTUICallEngine=function(){var e;return a(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return M.default.debug(L+"._resetTUICallEngine"),this._roomID=0,this._isInviter=!1,this._isGroupCall=!1,this.setSwitchCallModeStatus(!0),this._groupID="",this._callStatus=T.CALL_STATUS.IDLE,this._inviteeList=[],this._unHandledInviteeList=[],this._handledInviteeList=[],this._inviterInviteID={},this._audioVideoSwitchIdList=[],this._acceptedUserObject={},this._connectStartTime=0,this._switchCallModeStatus=!0,this._localViewId="",[4,null===(e=this._trtcClient)||void 0===e?void 0:e.reset()];case 1:return n.sent(),this._tsignalingClient.setInviteData(null),this._tsignalingClient.resetJoined(),(t=document.getElementById("_trtc_calling_layer"))&&(t.innerHTML=""),[2]}}))}))},e.prototype.getCallStatus=function(){return this._callStatus},e.prototype.changeCallStatus=function(e){this._callStatus!==e&&(M.default.debug(L+".changeCallStatus from "+this._callStatus+" to "+e),this._setInterfaceUpLoad(v.default.CHANGE_CALL_STATUS).setText("changeCallStatus from "+this._callStatus+" to "+e).setEnd(),this._callStatus=e)},e.prototype.extractCallingInfoFromMessage=function(e){if(!e)return"";if("TIMCustomElem"!==e.type)return"";var t=JSON.parse(e.payload.data);if(M.default.debug(L+".extractCallingInfoFromMessage - signalingData:",e.payload.data),t.businessID!==T.BUSINESS_ID.SIGNAL)return"";switch(t.actionType){case T.ACTION_TYPE.INVITE:var n=JSON.parse(t.data);return n.call_end>0?"结束通话，通话时长："+l.formatDuration(n.call_end):0!==n.call_end&&n.room_id?"发起通话":"结束群聊";case T.ACTION_TYPE.CANCEL_INVITE:return"取消通话";case T.ACTION_TYPE.ACCEPT_INVITE:return"已接听";case T.ACTION_TYPE.REJECT_INVITE:return"拒绝通话";case T.ACTION_TYPE.INVITE_TIMEOUT:return"无应答";default:return""}},e.CALL_TYPE=T.CALL_TYPE,r([b.paramValidate(b.VALIDATE_PARAMS.login),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"init",null),r([b.paramValidate(b.VALIDATE_PARAMS.login),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"login",null),r([b.avoidRepeatedCall(),b.paramValidate(b.VALIDATE_PARAMS.call),b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.IDLE]}),b.businessValidate(T.CALL_EXPERMENTEL_API_TYPE.BASE),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"call",null),r([b.avoidRepeatedCall(),b.paramValidate(b.VALIDATE_PARAMS.groupCall),b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.IDLE]}),b.businessValidate(T.CALL_EXPERMENTEL_API_TYPE.PRO),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"groupCall",null),r([b.paramValidate(b.VALIDATE_PARAMS.joinInGroupCall),b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.IDLE]}),b.businessValidate(T.CALL_EXPERMENTEL_API_TYPE.PRO),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"joinInGroupCall",null),r([b.paramValidate(b.VALIDATE_PARAMS.inviteUser),b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.CALLING,T.CALL_STATUS.CONNECTED]}),b.businessValidate(T.CALL_EXPERMENTEL_API_TYPE.PRO),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"inviteUser",null),r([b.avoidRepeatedCall(),b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.CALLING]}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],e.prototype,"accept",null),r([b.avoidRepeatedCall(),b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.CALLING]}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],e.prototype,"reject",null),r([b.avoidRepeatedCall(),b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.CALLING,T.CALL_STATUS.CONNECTED]}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],e.prototype,"hangup",null),r([b.paramValidate(b.VALIDATE_PARAMS.startRemoteView),b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.CONNECTED]}),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"startRemoteView",null),r([b.paramValidate(b.VALIDATE_PARAMS.stopRemoteView),b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.CONNECTED]}),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"stopRemoteView",null),r([b.paramValidate(b.VALIDATE_PARAMS.startLocalView),b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.CALLING,T.CALL_STATUS.CONNECTED]}),b.apiCallQueue(),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"startLocalView",null),r([b.paramValidate(b.VALIDATE_PARAMS.stopLocalView),b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.CALLING,T.CALL_STATUS.CONNECTED]}),b.apiCallQueue(),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"stopLocalView",null),r([b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.CALLING,T.CALL_STATUS.CONNECTED]}),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"openCamera",null),r([b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.CALLING,T.CALL_STATUS.CONNECTED]}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],e.prototype,"closeCamera",null),r([b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.CALLING,T.CALL_STATUS.CONNECTED]}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],e.prototype,"openMicrophone",null),r([b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.CALLING,T.CALL_STATUS.CONNECTED]}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],e.prototype,"closeMicrophone",null),r([b.paramValidate(b.VALIDATE_PARAMS.setVideoQuality),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"setVideoQuality",null),r([b.paramValidate(b.VALIDATE_PARAMS.setVideoRenderParams),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"setVideoRenderParams",null),r([b.paramValidate(b.VALIDATE_PARAMS.switchCallMediaType),b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.CONNECTED,T.CALL_STATUS.CALLING],scene:!0}),o("design:type",Function),o("design:paramtypes",[Number]),o("design:returntype",Promise)],e.prototype,"switchCallMediaType",null),r([b.paramValidate(b.VALIDATE_PARAMS.getDeviceList),b.statusValidate({init:!0}),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],e.prototype,"getDeviceList",null),r([b.paramValidate(b.VALIDATE_PARAMS.switchDevice),b.statusValidate({init:!0,callStatus:[T.CALL_STATUS.CALLING,T.CALL_STATUS.CONNECTED]}),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"switchDevice",null),r([b.paramValidate(b.VALIDATE_PARAMS.setSelfInfo),b.statusValidate({init:!0}),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"setSelfInfo",null),r([b.statusValidate({init:!0}),o("design:type",Function),o("design:paramtypes",[Boolean]),o("design:returntype",Promise)],e.prototype,"enableAIVoice",null),r([b.paramValidate(b.VALIDATE_PARAMS.createInstance),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",void 0)],e,"createInstance",null),e}();t.default=O},function(e,t,n){n.r(t),n.d(t,"default",(function(){return a}));const i=Function.prototype.apply,r=new WeakMap;function o(e){return r.has(e)||r.set(e,{}),r.get(e)}class a{constructor(e=null,t=console){const n=o(this);return n._events=new Set,n._callbacks={},n._console=t,n._maxListeners=null===e?null:parseInt(e,10),this}_addCallback(e,t,n,i){return this._getCallbacks(e).push({callback:t,context:n,weight:i}),this._getCallbacks(e).sort(((e,t)=>e.weight>t.weight)),this}_getCallbacks(e){return o(this)._callbacks[e]}_getCallbackIndex(e,t){return this._has(e)?this._getCallbacks(e).findIndex((e=>e.callback===t)):null}_achieveMaxListener(e){return null!==o(this)._maxListeners&&o(this)._maxListeners<=this.listenersNumber(e)}_callbackIsExists(e,t,n){const i=this._getCallbackIndex(e,t),r=-1!==i?this._getCallbacks(e)[i]:void 0;return-1!==i&&r&&r.context===n}_has(e){return o(this)._events.has(e)}on(e,t,n=null,i=1){const r=o(this);if("function"!=typeof t)throw new TypeError(t+" is not a function");return this._has(e)?(this._achieveMaxListener(e)&&r._console.warn(`Max listeners (${r._maxListeners}) for event "${e}" is reached!`),this._callbackIsExists(...arguments)&&r._console.warn(`Event "${e}" already has the callback ${t}.`)):(r._events.add(e),r._callbacks[e]=[]),this._addCallback(...arguments),this}once(e,t,n=null,r=1){const o=(...r)=>(this.off(e,o),i.call(t,n,r));return this.on(e,o,n,r)}off(e,t=null){const n=o(this);let i;return this._has(e)&&(null===t?(n._events.delete(e),n._callbacks[e]=null):(i=this._getCallbackIndex(e,t),-1!==i&&(n._callbacks[e].splice(i,1),this.off(...arguments)))),this}emit(e,...t){return this._has(e)&&this._getCallbacks(e).forEach((e=>i.call(e.callback,e.context,t))),this}clear(){const e=o(this);return e._events.clear(),e._callbacks={},this}listenersNumber(e){return this._has(e)?this._getCallbacks(e).length:null}}},function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i};Object.defineProperty(t,"__esModule",{value:!0});var a=n(17),s=n(0),c=n(35),u=n(7),l=n(1),d=n(9),p=n(11),h=n(12),f=n(8),g=n(4),m=n(5),v=n(7),_=n(55),y=n(26),I=n(2),M=n(2),T="TRTCClient",C=a,S=function(){function e(e){var t,n=this;this._sdkAppID=e.sdkAppID,this._userID=e.userID,this._userSig=e.userSig,this._tuiCallEngine=e.tuiCallEngine,this._videoAvailableMap=new Map,this._isJoined=!1,this._isPublished=!1,this._unpublishing=!1,this._localStream=null,this._remoteStreams=[],this._userIdDomMap=new Map,this._device={video:null,audio:null,microphoneList:[],cameraList:[]},this._prevDevices=[],this._displayLocalStream=null,this._isMuteAudioVideo=!1,this._assetsPath=e.assetsPath,this._eventStatController=new h.default,d.default.bindController(this._eventStatController),this._isAiNoiseSuppress=!0;var i=C.VERSION;l.compareVersion(i,"4.7.0")>=0?C.checkSystemRequirements().then((function(e){if(!e.result)throw n._tuiCallEngine._delegate.onError(g.default.NOT_SUPPORT,JSON.stringify(e)),new f.default({message:m.ERROR_MESSAGE.NOT_SUPPORT+" "+JSON.stringify(e),code:g.default.NOT_SUPPORT})})):C.checkSystemRequirements().then((function(e){if(!e)throw n._tuiCallEngine._delegate.onError(g.default.NOT_SUPPORT,e),new f.default({message:m.ERROR_MESSAGE.NOT_SUPPORT+" "+JSON.stringify(e),code:g.default.NOT_SUPPORT})})),this._frameWorkType=32,l.compareVersion(i,"4.15.1")>=0?(this._frameWorkType=30,this._component=14,((null===(t=null===window||void 0===window?void 0:window.localStorage)||void 0===t?void 0:t.getItem("_isTIMCallKit"))||(null===window||void 0===window?void 0:window._isTIMCallKit))&&(this._component=15)):this._component=3,this.init()}return e.prototype.init=function(){this._client=C.createClient({mode:M.NAME.RTC,sdkAppId:this._sdkAppID,userId:this._userID,userSig:this._userSig,frameWorkType:this._frameWorkType,component:this._component}),this.addTRTCEvents()},e.prototype.getClient=function(){return this._client},e.prototype.getRemoteStreams=function(){return this._remoteStreams},e.prototype.getLocalStream=function(){return this._localStream},e.prototype.getDisplayLocalStream=function(){return this._displayLocalStream},e.prototype.getMicrophoneList=function(){return i(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return[4,C.getMicrophones()];case 1:return e=t.sent(),this._device.microphoneList=e,[2]}}))}))},e.prototype.getCamerasList=function(){return i(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return[4,C.getCameras()];case 1:return e=t.sent(),this._device.cameraList=e,[2]}}))}))},e.prototype.getDevices=function(e){return i(this,void 0,void 0,(function(){var t=this;return r(this,(function(n){switch(n.label){case 0:return[4,this.getMicrophoneList()];case 1:return n.sent(),0!==this._device.microphoneList.length?[3,3]:[4,this._tuiCallEngine._resetTUICallEngine()];case 2:return n.sent(),this._tuiCallEngine._delegate.onError(g.default.NOT_MICROPHONE_LIST,m.ERROR_MESSAGE.NOT_MICROPHONE_LIST),[2];case 3:return this._device.audio=JSON.parse(JSON.stringify(this._device.microphoneList[0])),e===u.CALL_TYPE.VIDEO_CALL&&this._tuiCallEngine.getDevicePermission().video?[4,this.getCamerasList()]:[3,5];case 4:n.sent(),this._device.video=JSON.parse(JSON.stringify(this._device.cameraList[0])),n.label=5;case 5:return this._prevDevices.length>0||(this._prevDevices=o(this._device.microphoneList,this._device.cameraList),navigator.mediaDevices.addEventListener("devicechange",(function(){return i(t,void 0,void 0,(function(){var e,t,n,i,a,s=this;return r(this,(function(r){switch(r.label){case 0:return[4,C.getMicrophones()];case 1:return e=r.sent(),[4,C.getCameras()];case 2:return t=r.sent(),n=o(e,t),this.setDevcies(n),i=n.filter((function(e){return s._prevDevices.findIndex((function(t){var n=t.deviceId;return e.deviceId===n}))<0})),a=this._prevDevices.filter((function(e){return n.findIndex((function(t){var n=t.deviceId;return e.deviceId===n}))<0})),i.length>0&&this.handleDevices(i),a.length>0&&this.handleDevicesRemoved(a),this._tuiCallEngine._delegate.onDeviceUpdated(this._device.microphoneList,this._device.cameraList,this._device.audio,this._device.video),this._prevDevices=n,[2]}}))}))}))),[2]}}))}))},e.prototype.setDevcies=function(e){this._device.microphoneList=e.filter((function(e){return e.kind===M.NAME.AUDIO_INPUT}))||[],this._device.cameraList=e.filter((function(e){return e.kind===M.NAME.VIDEO_INPUT}))||[]},e.prototype.handleDevices=function(e,t){var n=this;e.forEach((function(e){e.kind===M.NAME.AUDIO_INPUT?n.switchDevice(u.DEVICE_TYPE.AUDIO,e.deviceId):e.kind===M.NAME.VIDEO_INPUT&&t&&n.switchDevice(u.DEVICE_TYPE.VIDEO,e.deviceId)}))},e.prototype.handleDevicesRemoved=function(e){var t=this;e.forEach((function(e){e.kind===M.NAME.AUDIO_INPUT?t.isCurrentMicrophoneRemoved(e.deviceId)&&t.handleDevices(t._prevDevices):e.kind===M.NAME.VIDEO_INPUT&&t.isCurrentCameraRemoved(e.deviceId)&&t.handleDevices(t._prevDevices,!0)}))},e.prototype.isCurrentMicrophoneRemoved=function(e){var t=this._localStream.getAudioTrack();return!(!t||t.getSettings().deviceId!==e)},e.prototype.isCurrentCameraRemoved=function(e){var t=this._localStream.getVideoTrack();return!(!t||t.getSettings().deviceId!==e)},e.prototype.switchDevice=function(e,t){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return s.default.log(T+".switchDevice - params: deviceType:"+e+",deviceID:"+t),this._localStream?[4,this._localStream.switchDevice(e,t)]:[3,2];case 1:i.sent(),i.label=2;case 2:return this._displayLocalStream?[4,this._displayLocalStream.switchDevice(e,t)]:[3,4];case 3:i.sent(),i.label=4;case 4:return n={deviceType:e,deviceId:t},this._device[e]=n,this._tuiCallEngine._delegate.onDeviceUpdated(this._device.microphoneList,this._device.cameraList,this._device.audio,this._device.video),[2]}}))}))},e.prototype.join=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o;return r(this,(function(r){switch(r.label){case 0:return(t=this.getCallType())!==u.CALL_TYPE.VIDEO_CALL||this._tuiCallEngine.getDevicePermission().video?[3,2]:[4,this.getMediaDevicesAuth({video:!0})];case 1:r.sent(),r.label=2;case 2:return[4,this.getDevices(t)];case 3:if(r.sent(),this._isJoined)return s.default.warn(T+".join - duplicate RtcClient.join() observed"),[2];r.label=4;case 4:return r.trys.push([4,6,,7]),[4,this._client.join({roomId:e})];case 5:return r.sent(),this._isJoined=!0,s.default.log(T+".join - join room success, callType:"+t),[3,7];case 6:throw n=r.sent(),s.default.error(T+".join - join room failed! "+n),new Error(T+".join - join room failed! "+n);case 7:if(this._tuiCallEngine.getCallStatus()===u.CALL_STATUS.IDLE)return s.default.warn(T+".join - early hangup"),[2,this._tuiCallEngine.hangup()];i={audio:!0,video:!1,userId:this._userID},t===u.CALL_TYPE.VIDEO_CALL&&this._tuiCallEngine.getDevicePermission().video&&(i.video=!0),r.label=8;case 8:return r.trys.push([8,17,,18]),this._localStream=C.createStream(i),[4,this._setVideoProfile(this._localStream)];case 9:return r.sent(),[4,this._localStream.initialize()];case 10:return r.sent(),this._tuiCallEngine.tim?[4,this._addAiNoiseReduce(this._tuiCallEngine.tim)]:[3,12];case 11:r.sent(),r.label=12;case 12:return s.default.log(T+".join - initialize local stream success"),[4,this.publish()];case 13:return r.sent(),this._tuiCallEngine.isInviter()?(this.muteLocalVideo(),this.muteLocalAudio(),this._displayLocalStream=C.createStream(i),[4,this._setVideoProfile(this._displayLocalStream)]):[3,16];case 14:return r.sent(),[4,this._displayLocalStream.initialize()];case 15:r.sent(),this._isMuteAudioVideo=!0,r.label=16;case 16:return s.default.log(T+".publish success"),this._joinedTimestamp=new Date,[2,{audio:i.audio,video:i.video,userId:i.userId}];case 17:throw o=r.sent(),s.default.error(T+".join - failed to initialize local stream - "+o),new f.default({message:T+"<join>: "+m.ERROR_MESSAGE.ERROR_PERMISSION_DENIED,code:g.default.ERROR_PERMISSION_DENIED});case 18:return[2]}}))}))},e.prototype._addAiNoiseReduce=function(e){return i(this,void 0,void 0,(function(){var t,n,i;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,6,,7]),[4,y.validateBusiness(e,v.CALL_EXPERMENTEL_API_TYPE.PRO)];case 1:return t=r.sent(),s.default.info(T+"._addAiNoiseReduce - aiNoiseReduceSupport."+t),t&&_?(this._assetsPath||s.default.warn(T+"._addAiNoiseReduce - please pass validate assetsPath"),this._aiNoiseSuppression=new _({assetsPath:this._assetsPath||I.AI_NOISE_REDUCE_ASSETS_PATH}),n=this,[4,this._aiNoiseSuppression.createProcessor({sdkAppId:this._sdkAppID,userId:this._userID,userSig:this._userSig})]):[3,5];case 2:return n._aiNoiseSuppressionProcessor=r.sent(),[4,this._aiNoiseSuppressionProcessor.process(this._localStream)];case 3:return r.sent(),[4,this.enableAIVoice(this._isAiNoiseSuppress)];case 4:r.sent(),r.label=5;case 5:return[3,7];case 6:return i=r.sent(),s.default.warn(T+"._addAiNoiseReduce - error."+i),[3,7];case 7:return[2]}}))}))},e.prototype.playLocalVideo=function(e){var t,n;return i(this,void 0,void 0,(function(){var i,o,a,c,l,d,p,h;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,13,,14]),s.default.debug(T+".playLocalVideo - params:",e),i=e.videoViewDomID,o=e.userID,e.options&&this._tuiCallEngine.setLocalPlayOptions(e.options),a=this._tuiCallEngine.getLocalPlayOptions(),c={userId:o,video:!0,audio:!1,screenAudio:!1},l=i,typeof i===M.NAME.STRING&&(l=document.getElementById(i)),this._userIdDomMap.set(o,l),this._tuiCallEngine.isInviter()?!this._displayLocalStream||this._displayLocalStream.hasVideo()?[3,5]:(d=null==C?void 0:C.createStream(c),[4,this._setVideoProfile(d)]):[3,7];case 1:return r.sent(),[4,d.initialize()];case 2:return r.sent(),(p=d.getVideoTrack())?[4,this._displayLocalStream.addTrack(p)]:[3,4];case 3:r.sent(),r.label=4;case 4:r.label=5;case 5:return[4,null===(t=null==this?void 0:this._displayLocalStream)||void 0===t?void 0:t.play(l,a)];case 6:r.sent(),r.label=7;case 7:return!this._localStream||this._localStream.hasVideo()?[3,9]:(p=this._localStream.getVideoTrack(),[4,this.addTrack(p)]);case 8:r.sent(),r.label=9;case 9:return this._tuiCallEngine.isInviter()?[3,12]:l?[4,null===(n=null==this?void 0:this._localStream)||void 0===n?void 0:n.play(l,a)]:[3,11];case 10:r.sent(),r.label=11;case 11:r.label=12;case 12:return this._tuiCallEngine.getCallStatus()===u.CALL_STATUS.CONNECTED&&this.unMuteLocalVideo(),[3,14];case 13:throw h=r.sent(),s.default.error(T+".playLocalVideo - failed, error:"+h),new Error(T+".playLocalVideo - failed, error:"+h);case 14:return[2]}}))}))},e.prototype.stopLocalVideo=function(){return i(this,void 0,void 0,(function(){var e,t;return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,8,,9]),this._tuiCallEngine.isInviter()?[4,this.stopLocalPlayStreamTrack(M.NAME.VIDEO)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this._localStream?this._localStream.hasAudio()?(e=this._localStream.getVideoTrack())?[4,this._localStream.removeTrack(e)]:[3,4]:[3,5]:[3,7];case 3:n.sent(),e.stop(),n.label=4;case 4:return[3,7];case 5:return[4,this.unpublish()];case 6:n.sent(),this._localStream.stop(),this._localStream.close(),this._localStream=null,this._userIdDomMap.delete(this._tuiCallEngine.getUserID()),n.label=7;case 7:return[3,9];case 8:throw t=n.sent(),s.default.error(T+".stopLocalVideo - failed to play local video "+t),new Error(T+".stopLocalVideo - failed to play local video "+t);case 9:return[2]}}))}))},e.prototype.playRemoteVideo=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,a,c;return r(this,(function(r){switch(r.label){case 0:s.default.debug(T+".playRemoteVideo - params:",e),t=e.videoViewDomID,n=e.userID,e.options&&this._tuiCallEngine.setRemotePlayOptions(e.options),i=this._tuiCallEngine.getRemotePlayOptions(),o=t,typeof t===M.NAME.STRING&&(o=document.getElementById(t)),this._userIdDomMap.set(n,o),r.label=1;case 1:if(r.trys.push([1,5,,6]),!(a=this._remoteStreams.find((function(e){return e.getUserId()===n}))))throw new Error("currentRemoteUserStream is empty");if(!o)throw new Error("domID is empty");return document.getElementById("_trtc_calling_audio_call-"+n)?[4,a.stop()]:[3,3];case 2:r.sent(),document.getElementById("_trtc_calling_audio_call-"+n).remove(),r.label=3;case 3:return[4,null==a?void 0:a.play(o,i)];case 4:return r.sent(),[3,6];case 5:throw c=r.sent(),s.default.error(T+".playRemoteVideo - failed to play remote video reason: "+c),new Error(T+".playRemoteVideo - failed to play remote video reason: "+c);case 6:return[2]}}))}))},e.prototype.stopRemoteVideo=function(e){return i(this,void 0,void 0,(function(){var t,n;return r(this,(function(i){s.default.debug(T+".stopRemoteVideo - params:",e),t=e.userID;try{(n=this._remoteStreams.find((function(e){return e.getUserId()===t})))&&n.hasVideo()&&n.getVideoTrack().stop()}catch(r){throw s.default.error(T+".stopRemoteVideo - failed to stop remote video "+r),new Error(T+".stopRemoteVideo - failed to stop remote video "+r)}return[2]}))}))},e.prototype.getCallType=function(){return this._tuiCallEngine.getCallType()},e.prototype.leave=function(){var e,t,n;return i(this,void 0,void 0,(function(){var i;return r(this,(function(r){switch(r.label){case 0:return s.default.log(T+"-leave._isJoined:"+this._isJoined),s.default.log(T+"-leave._localStream:"+this._localStream),this._isJoined?[4,this.unpublish()]:(s.default.warn(T+".leave - please join() firstly"),[2]);case 1:return r.sent(),this._tuiCallEngine.getCallDataReport().setExitRoomTime((new Date).getTime()),[4,this._client.leave()];case 2:return r.sent(),this._isJoined=!1,this._isPublished=!1,null===(e=null==this?void 0:this._localStream)||void 0===e||e.close(),null===(t=null==this?void 0:this._displayLocalStream)||void 0===t||t.close(),this._localStream=null,this._remoteStreams=[],this._userIdDomMap.clear(),this._displayLocalStream=null,this._videoAvailableMap.clear(),this._isMuteAudioVideo=!1,this._leaveTimestamp=new Date,this._client.enableAudioVolumeEvaluation(-1),null===(n=null==this?void 0:this._aiNoiseSuppressionProcessor)||void 0===n||n.destroy(),this._aiNoiseSuppressionProcessor=null,this._isAiNoiseSuppress=!0,i=Math.floor((this._leaveTimestamp-this._joinedTimestamp)/1e3),new d.default(p.default.TALK_TIME).setTalkTime(i).setText("talkTime record").setEnd(),[2]}}))}))},e.prototype.publish=function(){return i(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:if(!this._isJoined)return s.default.warn(T+".publish - please join() firstly"),[2];if(this._isPublished)return s.default.warn(T+".publish - duplicate RtcClient.publish() observed"),[2];if(this._tuiCallEngine.getCallStatus()===u.CALL_STATUS.IDLE)return s.default.warn(T+".join - early hangup"),this._tuiCallEngine.hangup(),[2];if(!this._localStream)return[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._client.publish(this._localStream)];case 2:return t.sent(),this._isPublished=!0,s.default.log(T+".publish - success"),[3,4];case 3:return e=t.sent(),s.default.error(T+".publish - failed to publish local stream "+e),this._isPublished=!1,[3,4];case 4:return[2]}}))}))},e.prototype.unpublish=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return this._isPublished?this._localStream?this._unpublishing?(s.default.log(T+".unpublish - _unpublishing"),[2]):(this._unpublishing=!0,[4,this._client.unpublish(this._localStream)]):(s.default.warn(T+".unpublish - RtcClient._localStream is null"),[2]):(s.default.warn(T+".unpublish - RtcClient.unpublish() called but not published yet"),[2]);case 1:return e.sent(),s.default.log(T+".unpublish - complete"),this._unpublishing=!1,this._isPublished=!1,[2]}}))}))},e.prototype.playAudioStream=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o;return r(this,(function(r){return t=e.getUserId(),n="_trtc_calling_audio_call-"+t,(i=document.getElementById("_trtc_calling_layer"))||((i=document.createElement("div")).setAttribute("id","_trtc_calling_layer"),i.style.display="none",document.body.appendChild(i)),(o=document.createElement("div")).setAttribute("id",n),i.appendChild(o),e&&(e.play(n),e.on("error",(function(t){if(16451===t.getCode()){var n=document.createElement("button");n.onclick=function(){s.default.log(T+".remoteStream - resume"),e.resume()},n.style.display="none",document.body.appendChild(n);var i=setTimeout((function(){n.click(),clearTimeout(i),document.body.removeChild(n)}),0)}}))),[2]}))}))},e.prototype.delegateVideoAvailableState=function(e,t){e&&this._videoAvailableMap.get(e)!==t&&(this._videoAvailableMap.set(e,t),this._tuiCallEngine._delegate.onUserVideoAvailable({userID:e,isVideoAvailable:t}))},e.prototype.querySubscribeSuccess=function(e){return void 0!==this._videoAvailableMap.get(e)},e.prototype.addTRTCEvents=function(){var e=this;this._client.on("error",(function(t){s.default.error(T+".handleEvents - client on error "+t);var n=t.getCode(),i=JSON.stringify({name:M.NAME.TRTC,error:t});e._tuiCallEngine._delegate.onError(n,i)})),this._client.on("client-banned",(function(t){return i(e,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return s.default.error(T+".handleEvents - client has been banned for "+t),this._tuiCallEngine.getCallStatus()===u.CALL_STATUS.CONNECTED&&(e=this._tuiCallEngine.generateCallEndData(),this._tuiCallEngine._delegate.onCallEnd(e)),this._tuiCallEngine.getCallStatus()!==u.CALL_STATUS.CALLING?[3,2]:(this._tuiCallEngine._delegate.onCallingCancel(this._tuiCallEngine.getUserID()),[4,this._tuiCallEngine._cancel()]);case 1:n.sent(),n.label=2;case 2:return[4,this._tuiCallEngine._resetTUICallEngine()];case 3:return n.sent(),[2]}}))}))})),this._client.on("peer-join",(function(t){return i(e,void 0,void 0,(function(){var e,n,i;return r(this,(function(r){return e=t.userId,this._localStream&&this._isPublished&&this._tuiCallEngine.isInviter()&&this._isMuteAudioVideo&&(this.unMuteLocalVideo(),this.unMuteLocalAudio(),this._isMuteAudioVideo=!1),s.default.log(T+".handleEvents - peer-join "+e),this._tuiCallEngine.getConnectStartTime()||(this._tuiCallEngine.setConnectStartTime(Date.now()),this._client.enableAudioVolumeEvaluation(1e3)),this._tuiCallEngine._delegate.onUserEnter(e),n=this._tuiCallEngine.isGroupCall(),this._tuiCallEngine.addHandledInviteeList([e]),this._tuiCallEngine.deleteUnHandledInviteeList([e]),this._tuiCallEngine.addAcceptedUserList(null,[e]),this._tuiCallEngine.changeCallStatus(u.CALL_STATUS.CONNECTED),n&&(i=this._tuiCallEngine.getHandledInviteeList(),this._tuiCallEngine._delegate.onGroupCallInviteeListUpdate(i)),[2]}))}))})),this._client.on("peer-leave",(function(t){return i(e,void 0,void 0,(function(){var e,n,i,o,a,c,l,d;return r(this,(function(r){switch(r.label){case 0:return this._tuiCallEngine.getCallStatus()===u.CALL_STATUS.IDLE?[2]:(e=t.userId,s.default.log(T+".handleEvents - peer-leave:"+e),n=this._tuiCallEngine.isGroupCall(),this._tuiCallEngine.deleteHandledInviteeList([e]),this._videoAvailableMap.delete(e),this._tuiCallEngine._delegate.onUserLeave(e),n?(i=this._tuiCallEngine.getHandledInviteeList(),o=this._tuiCallEngine.getUnHandledInviteeList(),0!==i.length&&this._tuiCallEngine._delegate.onGroupCallInviteeListUpdate(i),a=this._tuiCallEngine.getUserID(),1!==i.length||i[0]!==a||0!==o.length?[3,2]:(c=this._tuiCallEngine.generateCallEndData(),this._tuiCallEngine._delegate.onCallEnd(c),[4,this._tuiCallEngine._resetTUICallEngine()])):[3,3]);case 1:r.sent(),r.label=2;case 2:return[3,6];case 3:return l=this._tuiCallEngine.getHandledInviteeList(),d={callType:this._tuiCallEngine.getCallType(),userIDList:[e],callEnd:Math.round((Date.now()-this._tuiCallEngine.getConnectStartTime())/1e3)},1!==l.length?[3,6]:[4,this._tuiCallEngine._tsignalingClient.hangup(d)];case 4:return r.sent(),[4,this._tuiCallEngine._resetTUICallEngine()];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))})),this._client.on("stream-added",(function(t){return i(e,void 0,void 0,(function(){var e,n,i,o,a,c;return r(this,(function(r){switch(r.label){case 0:e=t.stream,n=e.getId(),i=e.getUserId(),s.default.log(T+".handleEvents - remote stream added, userID:"+i+" streamID:"+n+" type:"+e.getType()),r.label=1;case 1:return r.trys.push([1,3,,5]),[4,this._client.subscribe(e)];case 2:return r.sent(),[3,5];case 3:return o=r.sent(),a=o.getCode(),c=JSON.stringify({name:"TRTC",error:o}),[4,this._tuiCallEngine._resetTUICallEngine()];case 4:return r.sent(),this._tuiCallEngine._delegate.onError(a,c),[3,5];case 5:return[2]}}))}))})),this._client.on("stream-subscribed",(function(t){return i(e,void 0,void 0,(function(){var e,n;return r(this,(function(i){return e=t.stream,n=e.getUserId(),s.default.log(T+".handleEvents - stream subscribed, _remoteStreams:"+this._remoteStreams+", userID:"+n+", video: "+e.hasVideo()),this._remoteStreams.push(e),this._tuiCallEngine.getCallType()===u.CALL_TYPE.VIDEO_CALL&&this.delegateVideoAvailableState(n,e.hasVideo()),(this.getCallType()===u.CALL_TYPE.AUDIO_CALL||this._tuiCallEngine.getCallType()===u.CALL_TYPE.VIDEO_CALL&&!e.hasVideo())&&this.playAudioStream(e),[2]}))}))})),this._client.on("stream-removed",(function(t){var n=t.stream,i=n.getId(),r=n.getUserId(),o="_trtc_calling_audio_call-"+r;if(s.default.log(T+".handleEvents - remote stream-removed, streamID:"+i+" type:"+n.getType()),e._tuiCallEngine._delegate.onUserAudioAvailable({userID:r,isAudioAvailable:!1}),e._tuiCallEngine._delegate.onUserVideoAvailable({userID:r,isVideoAvailable:!1}),n.stop(),n.close(),e._remoteStreams=e._remoteStreams.filter((function(e){return e.getId()!==i})),e.getCallType()===u.CALL_TYPE.AUDIO_CALL){var a=document.getElementById("_trtc_calling_layer"),c=document.getElementById(o);a&&c&&a.removeChild(c)}e._videoAvailableMap.delete(r)})),this._client.on("stream-updated",(function(t){var n=t.stream,i=n.getUserId(),r=n.getType(),o=n.hasAudio(),a=n.hasVideo();s.default.log(T+".handleEvents - stream-updated, type:"+r+" hasAudio:"+o+" hasVideo:"+a),e.querySubscribeSuccess(i)&&e.delegateVideoAvailableState(i,!!a)})),this._client.on("mute-audio",(function(t){s.default.debug(T+".handleEvents - "+t.userId+" mute audio"),e._tuiCallEngine._delegate.onUserAudioAvailable({userID:t.userId,isAudioAvailable:!1})})),this._client.on("unmute-audio",(function(t){s.default.debug(T+".handleEvents - "+t.userId+" unmute audio"),e._tuiCallEngine._delegate.onUserAudioAvailable({userID:t.userId,isAudioAvailable:!0})})),this._client.on("mute-video",(function(t){s.default.debug(T+".handleEvents - "+t.userId+" mute video"),e.querySubscribeSuccess(t.userId)&&e.delegateVideoAvailableState(t.userId,!1)})),this._client.on("unmute-video",(function(t){s.default.debug(T+".handleEvents - "+t.userId+" unmute video"),e.querySubscribeSuccess(t.userId)&&e.delegateVideoAvailableState(t.userId,!0)})),this._client.on("audio-volume",(function(t){s.default.debug(T+".handleEvents - "+t+" audio volume"),e._tuiCallEngine._delegate.onUserVoiceVolume(t.result)})),this._client.on("connection-state-changed",(function(e){s.default.log(T+".handleEvents - RtcClient state changed from "+e.prevState+" to "+e.state)}))},e.prototype.removeTRTCEvents=function(){this._client.off("*")},e.prototype.muteLocalVideo=function(){var e;null===(e=this._localStream)||void 0===e||e.muteVideo()},e.prototype.unMuteLocalVideo=function(){var e;null===(e=this._localStream)||void 0===e||e.unmuteVideo()},e.prototype.muteLocalAudio=function(){var e,t;null===(e=this._displayLocalStream)||void 0===e||e.muteAudio(),null===(t=this._localStream)||void 0===t||t.muteAudio()},e.prototype.unMuteLocalAudio=function(){var e,t;null===(e=this._displayLocalStream)||void 0===e||e.unmuteAudio(),null===(t=this._localStream)||void 0===t||t.unmuteAudio()},e.prototype.switchCallMode=function(e){return i(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:switch(s.default.log(T+".switchCallMode - type",e),t=this._localStream.getVideoTrack(),e){case u.CALL_TYPE.VIDEO_CALL:return[3,1];case u.CALL_TYPE.AUDIO_CALL:return[3,5]}return[3,9];case 1:return n.trys.push([1,3,,4]),[4,this.stopLocalPlayStreamTrack(M.NAME.VIDEO)];case 2:return n.sent(),this.removeTrack(t),this._tuiCallEngine.setCallType(u.CALL_TYPE.AUDIO_CALL),this._tuiCallEngine.setSwitchCallModeStatus(!0),this._tuiCallEngine._delegate.onCallTypeChanged(u.CALL_TYPE.VIDEO_CALL,u.CALL_TYPE.AUDIO_CALL),[3,4];case 3:return n.sent(),this._tuiCallEngine._delegate.onError(g.default.FAILURE_SWITCH_TO_AUDIO,m.ERROR_MESSAGE.FAILURE_SWITCH_TO_AUDIO),[3,4];case 4:case 8:return[3,9];case 5:return n.trys.push([5,7,,8]),[4,this.addTrack(t)];case 6:return n.sent(),this._tuiCallEngine.setCallType(u.CALL_TYPE.VIDEO_CALL),this._tuiCallEngine.setSwitchCallModeStatus(!0),this._tuiCallEngine._delegate.onCallTypeChanged(u.CALL_TYPE.AUDIO_CALL,u.CALL_TYPE.VIDEO_CALL),[3,8];case 7:return n.sent(),this._tuiCallEngine._delegate.onError(g.default.FAILURE_SWITCH_TO_VIDEO,m.ERROR_MESSAGE.FAILURE_SWITCH_TO_VIDEO),[3,8];case 9:return[2]}}))}))},e.prototype.removeTrack=function(e){return i(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:if(s.default.log(T+".removeTrack ",!!e),!e)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._localStream.removeTrack(e)];case 2:return n.sent(),e.stop(),[3,4];case 3:throw t=n.sent(),s.default.error(T+".removeTrack - failed to removeTrack local stream "+t),new Error(t);case 4:return[2]}}))}))},e.prototype.addTrack=function(e){var t;return i(this,void 0,void 0,(function(){var n,i,o;return r(this,(function(r){switch(r.label){case 0:return s.default.log(T+".addTrack ",!e),e?[3,7]:(n=C.createStream({userId:this._tuiCallEngine.getUserID(),audio:!1,video:!0}),[4,this._setVideoProfile(n)]);case 1:return r.sent(),[4,n.initialize()];case 2:r.sent(),i=n.getVideoTrack(),r.label=3;case 3:return r.trys.push([3,6,,7]),i?[4,null===(t=this._localStream)||void 0===t?void 0:t.addTrack(i)]:[3,5];case 4:r.sent(),r.label=5;case 5:return[3,7];case 6:throw o=r.sent(),s.default.error(T+".addTrack - failed to addTrack local stream "+o),new Error(o);case 7:return[2]}}))}))},e.prototype.reset=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return this._isJoined?[4,this.leave()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.getMediaDevicesAuth=function(e){return i(this,void 0,void 0,(function(){var t,n,i;return r(this,(function(r){switch(r.label){case 0:if(!c.checkProtocols())throw new f.default({message:""+m.ERROR_MESSAGE.ERROR_HTTP,code:g.default.ERROR_HTTP});if(!e.audio)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({audio:!0,video:!1})];case 2:return n=r.sent(),this.releaseStream(n),this._tuiCallEngine.setDevicePermission(u.DEVICE_TYPE.AUDIO,!0),[3,4];case 3:throw t=r.sent(),this._tuiCallEngine.setDevicePermission(u.DEVICE_TYPE.AUDIO,!1),new Error(t);case 4:if(!e.video)return[3,8];r.label=5;case 5:return r.trys.push([5,7,,8]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 6:return n=r.sent(),this.releaseStream(n),this._tuiCallEngine.setDevicePermission(u.DEVICE_TYPE.VIDEO,!0),[3,8];case 7:if(i=r.sent(),this._tuiCallEngine.setDevicePermission(u.DEVICE_TYPE.VIDEO,!1),s.default.error(T+".getMediaDevicesAuth - failed to get user video steam - "+i),e.isThrowVideoError)throw new Error(i);return[3,8];case 8:return[2,this._tuiCallEngine.getDevicePermission()]}}))}))},e.prototype.enableAIVoice=function(e){return i(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return this._isAiNoiseSuppress=e,this._aiNoiseSuppressionProcessor?(s.default.info(T+".enableAIVoice "+e),e?[4,this._aiNoiseSuppressionProcessor.enable()]:[3,2]):[2];case 1:return t.sent(),[3,4];case 2:return[4,this._aiNoiseSuppressionProcessor.disable()];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))},e.prototype.releaseStream=function(e){for(var t=e.getTracks(),n=0;n<t.length;n++)t[n].stop()},e.prototype.stopLocalPlayStreamTrack=function(e){return i(this,void 0,void 0,(function(){var t,n;return r(this,(function(i){switch(i.label){case 0:return this._displayLocalStream?e!==M.NAME.VIDEO?[3,4]:this._displayLocalStream.hasAudio()?(t=this._displayLocalStream.getVideoTrack())?[4,this._displayLocalStream.removeTrack(t)]:[3,2]:[3,3]:[3,5];case 1:i.sent(),t.stop(),i.label=2;case 2:return[3,4];case 3:this._displayLocalStream.stop(),this._displayLocalStream.close(),this._displayLocalStream=null,i.label=4;case 4:e===M.NAME.AUDIO&&(this._displayLocalStream.hasVideo()?(n=this._displayLocalStream.getAudioTrack())&&(this.muteLocalAudio(),n.stop()):(this._displayLocalStream.stop(),this._displayLocalStream.close(),this._displayLocalStream=null)),i.label=5;case 5:return[2]}}))}))},e.prototype._setVideoProfile=function(e,t){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,7]),e?(t=t||this._tuiCallEngine.getVideoQuality(),e?[4,e.setVideoProfile(t)]:[3,2]):(s.default.warn(T+"._setVideoProfile - stream is empty"),[2]);case 1:i.sent(),i.label=2;case 2:return[3,7];case 3:return"OverconstrainedError"!==i.sent().name?[3,5]:[4,(n=C.createStream({video:!0,audio:!1})).initialize()];case 4:return i.sent(),this._localStream.replaceTrack(n.getVideoTrack()),[3,6];case 5:i.label=6;case 6:return[3,7];case 7:return[2]}}))}))},e.prototype._setVideoRenderParams=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,a,c,u,d,p,h,f,g,m,v,_;return r(this,(function(y){switch(y.label){case 0:return y.trys.push([0,14,,15]),n=(t=e||{}).userID,i=t.objectFit,o=void 0===i?"":i,n&&!this._userIdDomMap.has(n)?(s.default.warn(T+"._setVideoRenderParams - failed the userID: "+n+" does not have a play node"),[2]):(a={},o!==M.NAME.CONTAIN&&o!==M.NAME.COVER&&o!==M.NAME.FILL||(a.objectFit=e.objectFit),l.isBoolean(e.muted)&&(a.muted=e.muted),l.isBoolean(e.mirror)&&(a.mirror=e.mirror),c=this._tuiCallEngine.getUserID(),n!==c&&n?[3,6]:(this._tuiCallEngine.setLocalPlayOptions(a),u=this._tuiCallEngine.getLocalPlayOptions(),m=this._userIdDomMap.get(c),this._tuiCallEngine.isInviter()?this._displayLocalStream?[4,this._displayLocalStream.play(m,u)]:[3,2]:[3,3]));case 1:y.sent(),y.label=2;case 2:return[3,6];case 3:return this._localStream?[4,this._localStream.play(m,u)]:[3,5];case 4:y.sent(),y.label=5;case 5:y.label=6;case 6:if(n)return[3,10];this._tuiCallEngine.setRemotePlayOptions(a),g=this._tuiCallEngine.getRemotePlayOptions(),d=(d=Array.from(this._userIdDomMap,(function(e){return e[0]}))).filter((function(e){return e!==c})),p=function(e){var t,n;return r(this,(function(i){switch(i.label){case 0:return t=h._userIdDomMap.get(d[e]),(n=h._remoteStreams.find((function(t){return t.getUserId()===d[e]})))?[4,n.play(t,g)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))},h=this,f=0,y.label=7;case 7:return f<d.length?[5,p(f)]:[3,10];case 8:y.sent(),y.label=9;case 9:return f++,[3,7];case 10:return n&&n!==c?(this._tuiCallEngine.setRemotePlayOptions(a),g=this._tuiCallEngine.getRemotePlayOptions(),m=this._userIdDomMap.get(n),(v=this._remoteStreams.find((function(e){return e.getUserId()===n})))?[4,v.play(m,g)]:[3,12]):[3,13];case 11:y.sent(),y.label=12;case 12:y.label=13;case 13:return[3,15];case 14:return _=y.sent(),s.default.warn(T+"._setVideoRenderParams - failed call stream.play error: "+_),[3,15];case 15:return[2]}}))}))},e}();t.default=S},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(i){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.checkProtocols=void 0,t.checkProtocols=function(){if(!window)return!1;if(!window.location)return!1;var e=window.location,t=e.protocol,n=e.hostname;return"http:"!==t||"localhost"===n||"127.0.0.1"===n}},function(e,t,n){var i=n(3),r=n(18),o=n(37),a=n(24);function s(e){var t=new o(e),n=r(o.prototype.request,t);return i.extend(n,o.prototype,t),i.extend(n,t),n}var c=s(n(14));c.Axios=o,c.create=function(e){return s(a(c.defaults,e))},c.Cancel=n(25),c.CancelToken=n(52),c.isCancel=n(23),c.all=function(e){return Promise.all(e)},c.spread=n(53),c.isAxiosError=n(54),e.exports=c,e.exports.default=c},function(e,t,n){var i=n(3),r=n(19),o=n(38),a=n(39),s=n(24),c=n(50),u=c.validators;function l(e){this.defaults=e,this.interceptors={request:new o,response:new o}}l.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=s(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&c.assertOptions(t,{silentJSONParsing:u.transitional(u.boolean,"1.0.0"),forcedJSONParsing:u.transitional(u.boolean,"1.0.0"),clarifyTimeoutError:u.transitional(u.boolean,"1.0.0")},!1);var n=[],i=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(i=i&&t.synchronous,n.unshift(t.fulfilled,t.rejected))}));var r,o=[];if(this.interceptors.response.forEach((function(e){o.push(e.fulfilled,e.rejected)})),!i){var l=[a,void 0];for(Array.prototype.unshift.apply(l,n),l=l.concat(o),r=Promise.resolve(e);l.length;)r=r.then(l.shift(),l.shift());return r}for(var d=e;n.length;){var p=n.shift(),h=n.shift();try{d=p(d)}catch(f){h(f);break}}try{r=a(d)}catch(f){return Promise.reject(f)}for(;o.length;)r=r.then(o.shift(),o.shift());return r},l.prototype.getUri=function(e){return e=s(this.defaults,e),r(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},i.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,n){return this.request(s(n||{},{method:e,url:t,data:(n||{}).data}))}})),i.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,n,i){return this.request(s(i||{},{method:e,url:t,data:n}))}})),e.exports=l},function(e,t,n){var i=n(3);function r(){this.handlers=[]}r.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},r.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},r.prototype.forEach=function(e){i.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=r},function(e,t,n){var i=n(3),r=n(40),o=n(23),a=n(14);function s(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return s(e),e.headers=e.headers||{},e.data=r.call(e,e.data,e.headers,e.transformRequest),e.headers=i.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),i.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||a.adapter)(e).then((function(t){return s(e),t.data=r.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return o(t)||(s(e),t&&t.response&&(t.response.data=r.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},function(e,t,n){var i=n(3),r=n(14);e.exports=function(e,t,n){var o=this||r;return i.forEach(n,(function(n){e=n.call(o,e,t)})),e}},function(e,t){var n,i,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(i){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var c,u=[],l=!1,d=-1;function p(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&h())}function h(){if(!l){var e=s(p);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(n){return i.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||l||s(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){var i=n(3);e.exports=function(e,t){i.forEach(e,(function(n,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[i])}))}},function(e,t,n){var i=n(22);e.exports=function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(i("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},function(e,t,n){var i=n(3);e.exports=i.isStandardBrowserEnv()?{write:function(e,t,n,r,o,a){var s=[];s.push(e+"="+encodeURIComponent(t)),i.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),i.isString(r)&&s.push("path="+r),i.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,n){var i=n(46),r=n(47);e.exports=function(e,t){return e&&!i(t)?r(e,t):t}},function(e,t,n){e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,n){e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,n){var i=n(3),r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,o,a={};return e?(i.forEach(e.split("\n"),(function(e){if(o=e.indexOf(":"),t=i.trim(e.substr(0,o)).toLowerCase(),n=i.trim(e.substr(o+1)),t){if(a[t]&&r.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([n]):a[t]?a[t]+", "+n:n}})),a):a}},function(e,t,n){var i=n(3);e.exports=i.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var i=e;return t&&(n.setAttribute("href",i),i=n.href),n.setAttribute("href",i),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=i.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},function(e,t,n){var i=n(51),r={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){r[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var o={},a=i.version.split(".");function s(e,t){for(var n=t?t.split("."):a,i=e.split("."),r=0;r<3;r++){if(n[r]>i[r])return!0;if(n[r]<i[r])return!1}return!1}r.transitional=function(e,t,n){var r=t&&s(t);function a(e,t){return"[Axios v"+i.version+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,i,s){if(!1===e)throw new Error(a(i," has been removed in "+t));return r&&!o[i]&&(o[i]=!0),!e||e(n,i,s)}},e.exports={isOlderVersion:s,assertOptions:function(e,t,n){if("object"!=typeof e)throw new TypeError("options must be an object");for(var i=Object.keys(e),r=i.length;r-- >0;){var o=i[r],a=t[o];if(a){var s=e[o],c=void 0===s||a(s,o,e);if(!0!==c)throw new TypeError("option "+o+" must be "+c)}else if(!0!==n)throw Error("Unknown option "+o)}},validators:r}},function(e){e.exports=JSON.parse('{"name":"axios","version":"0.21.4","description":"Promise based HTTP client for the browser and node.js","main":"index.js","scripts":{"test":"grunt test","start":"node ./sandbox/server.js","build":"NODE_ENV=production grunt build","preversion":"npm test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json","postversion":"git push && git push --tags","examples":"node ./examples/server.js","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","fix":"eslint --fix lib/**/*.js"},"repository":{"type":"git","url":"https://github.com/axios/axios.git"},"keywords":["xhr","http","ajax","promise","node"],"author":"Matt Zabriskie","license":"MIT","bugs":{"url":"https://github.com/axios/axios/issues"},"homepage":"https://axios-http.com","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"jsdelivr":"dist/axios.min.js","unpkg":"dist/axios.min.js","typings":"./index.d.ts","dependencies":{"follow-redirects":"^1.14.0"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}]}')},function(e,t,n){var i=n(25);function r(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new i(e),t(n.reason))}))}r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.source=function(){var e;return{token:new r((function(t){e=t})),cancel:e}},e.exports=r},function(e,t,n){e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,n){e.exports=function(e){return"object"==typeof e&&!0===e.isAxiosError}},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n},s=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i};Object.defineProperty(t,"__esModule",{value:!0});var c=n(58),u=n(0),l=n(7),d="TSignalClient",p=n(2),h=function(){function e(e,t){this._tuiCallEngine=e,this._tsignaling=new c(t),this._tsignalingReady=!1,this._joined=!1,this._newInvitationData=null,this._resolveMap=new Map,this.addTSignalEvents()}return e.prototype.setTSignalingIsJoined=function(e){this._joined=e},e.prototype.getTSignalingIsJoined=function(){return this._joined},e.prototype.setLogLevel=function(e){this._tsignaling.setLogLevel(e)},e.prototype.addTSignalEvents=function(){var e=this._tsignaling;e.on(c.EVENT.SDK_READY,this.onSdkReady,this),e.on(c.EVENT.SDK_NOT_READY,this.onSdkNotReady,this),e.on(c.EVENT.NEW_INVITATION_RECEIVED,this.onNewInvitationReceived,this),e.on(c.EVENT.INVITEE_ACCEPTED,this.onInviteeAccepted,this),e.on(c.EVENT.INVITEE_REJECTED,this.onInviteeRejected,this),e.on(c.EVENT.INVITATION_CANCELLED,this.onInvitationCancelled,this),e.on(c.EVENT.INVITATION_TIMEOUT,this.onInvitationTimeout,this),e.on(c.EVENT.KICKED_OUT,this.onKickedOut,this),e.on(c.EVENT.NET_STATE_CHANGE,this.onNetStateChange,this),c.EVENT.MESSAGE_SENT_BY_ME&&e.on(c.EVENT.MESSAGE_SENT_BY_ME,this.onMessageSentByMe,this)},e.prototype.onSdkReady=function(e){this._tsignalingReady=!0,this._tuiCallEngine._delegate.onSdkReady(e);var t=this._resolveMap.get("login");t&&(t.resolve(t.value),this._resolveMap.delete("login"))},e.prototype.onSdkNotReady=function(){this._tsignalingReady=!1},e.prototype.onNewInvitationReceived=function(e){var t,n;return r(this,void 0,void 0,(function(){var i,r,a,s,c,p,h,f,g,m;return o(this,(function(o){switch(o.label){case 0:return i=this._tuiCallEngine.getCallStatus(),u.default.log(d+".onNewInvitationReceived - params:",e,"currentCallStatus:"+i),r=e.data,a=r.inviter,s=r.inviteeList,c=r.data,p=r.inviteID,h=r.groupID,(f=JSON.parse(c)).room_id||(f.room_id=null===(t=null==f?void 0:f.data)||void 0===t?void 0:t.room_id),this._tuiCallEngine.getUserID()===a?[2]:(m={inviter:a,inviteeList:s,inviteID:p,isGroupCall:g=!!h,inviteData:f,groupID:h,currentCallStatus:i,inCallUserIDs:(null==f?void 0:f.inCallUserIDs)||[]},(null===(n=null==f?void 0:f.data)||void 0===n?void 0:n.cmd)!==l.CMD_TYPE.HANG_UP?[3,2]:(u.default.log(d+".hangup - params:",a,f,this._tuiCallEngine.getHandledInviteeList(),this._tuiCallEngine.getUnHandledInviteeList(),i,g),i===l.CALL_STATUS.IDLE?[2]:[4,this.handleHangupSignal(m)]));case 1:return o.sent(),[2];case 2:return!h&&this.judgeSwitchCallMode(f)?(i!==l.CALL_STATUS.IDLE&&this._tuiCallEngine.getRoomID()===f.room_id&&(this.handleSwitchCallMode(p,f),this._tuiCallEngine.addAudioVideoSwitchIdList(p)),[2]):i!==l.CALL_STATUS.IDLE?(this.reject({inviteID:p,callType:f.call_type,isBusy:!0}),[2]):(this.handleInvitedSignal(m),[2])}}))}))},e.prototype.handleHangupSignal=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,a,s,c,u,d;return o(this,(function(o){switch(o.label){case 0:if(t=e.inviter,n=e.inviteData,i=e.currentCallStatus,r=e.inviteeList,a=this._tuiCallEngine.isGroupCall(),s=this._tuiCallEngine.isInviter(),i===l.CALL_STATUS.CALLING){if(u=this._tuiCallEngine.getHandledInviteeList(),-1!==(d=this._tuiCallEngine.getUnHandledInviteeList()).indexOf(t)&&this._tuiCallEngine.deleteUnHandledInviteeList([t]),-1===u.indexOf(t))return[2]}else if(this._tuiCallEngine.deleteHandledInviteeList([t]),-1===(u=this._tuiCallEngine.getHandledInviteeList()).indexOf(t)&&u.length>1)return[2];return c=this._tuiCallEngine.generateCallEndData({totalTime:n.call_end||0}),a?[3,2]:[4,this._tuiCallEngine._resetTUICallEngine()];case 1:return o.sent(),this._tuiCallEngine._delegate.onCallEnd(c),[3,10];case 2:return this._tuiCallEngine.deleteHandledInviteeList([t]),u=this._tuiCallEngine.getHandledInviteeList(),d=this._tuiCallEngine.getUnHandledInviteeList(),s?1!==u.length||0!==d.length?[3,4]:[4,this._tuiCallEngine._resetTUICallEngine()]:[3,5];case 3:o.sent(),this._tuiCallEngine._delegate.onCallEnd(c),o.label=4;case 4:return[3,10];case 5:return i!==l.CALL_STATUS.CALLING?[3,8]:(-1!==r.indexOf(this._tuiCallEngine.getUserID())&&this._tuiCallEngine._delegate.onUserLeave(t),0!==u.length||1!==d.length?[3,7]:[4,this._tuiCallEngine._resetTUICallEngine()]);case 6:o.sent(),this._tuiCallEngine._delegate.onCallingCancel(t),o.label=7;case 7:return[3,10];case 8:return 1!==u.length||0!==d.length?[3,10]:[4,this._tuiCallEngine._resetTUICallEngine()];case 9:o.sent(),this._tuiCallEngine._delegate.onCallEnd(c),o.label=10;case 10:return[2]}}))}))},e.prototype.handleInvitedSignal=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,c,u,d,h,f,g;return o(this,(function(o){return t=e.inviter,n=e.inviteeList,r=e.isGroupCall,a=e.groupID,c=e.inviteID,u=e.inviteData,d=e.inCallUserIDs,h=void 0===d?[]:d,this._tuiCallEngine.changeCallStatus(l.CALL_STATUS.CALLING),this._tuiCallEngine.setInviterID(t),this._tuiCallEngine.setInviteeList(n),this._tuiCallEngine.setRoomID(u.room_id),this._tuiCallEngine.addUnHandledInviteeList(s(n,h)),this._tuiCallEngine.addHandledInviteeList([t]),this._tuiCallEngine.addAcceptedUserList(c,[t]),r&&(this._tuiCallEngine.setIsGroupCall(r),this._tuiCallEngine.setGroupID(a)),this._tuiCallEngine.addInviterInviteId(c,s([t],n)),f=h.filter((function(e){return-1===n.indexOf(e)})),this._newInvitationData={sponsor:t,userIDList:s(n,f),isFromGroup:r,inviteID:c,groupID:a,inviteData:{version:u.version,callType:u.call_type,roomID:u.room_id}},g=this._tuiCallEngine.getCallDataReport().getCallData(),g=i(i({},g),{roomID:u.room_id,inviteID:c,callRole:l.CALL_ROLE.INVITEE,callType:u.call_type,inviteeList:n,callScene:a?p.NAME.GROUP_CALL:p.NAME.SINGLE_CALL}),this._tuiCallEngine.getCallDataReport().setCallData(g),this._tuiCallEngine._delegate.onInvited(this._newInvitationData),[2]}))}))},e.prototype.getInviteData=function(){return this._newInvitationData},e.prototype.setInviteData=function(e){this._newInvitationData=e},e.prototype.handleSwitchCallMode=function(e,t){var n={inviteID:e,callType:t.call_type,switch_to_audio_call:null},i={cmd:l.CMD_TYPE.SWITCH_TO_VIDEO};t.call_type===l.CALL_TYPE.VIDEO_CALL?(n.switch_to_audio_call=l.CMD_TYPE.SWITCH_TO_AUDIO_CALL,i.cmd=l.CMD_TYPE.SWITCH_TO_AUDIO):delete n.switch_to_audio_call;var r=this._tuiCallEngine.getCallStatus();if(this.accept(n,i),r===l.CALL_STATUS.CALLING){var o=t.call_type===l.CALL_TYPE.VIDEO_CALL?l.CALL_TYPE.AUDIO_CALL:l.CALL_TYPE.VIDEO_CALL;this._tuiCallEngine._delegate.onCallTypeChanged(t.call_type,o),this._newInvitationData.inviteData.callType=o,this._tuiCallEngine.setSwitchCallModeStatus(!1)}else r===l.CALL_STATUS.CONNECTED&&(this._tuiCallEngine.setSwitchCallModeStatus(!1),this._tuiCallEngine._trtcClient.switchCallMode(this._tuiCallEngine.getCallType()))},e.prototype.judgeSwitchCallMode=function(e){var t=e.switch_to_audio_call&&e.switch_to_audio_call===l.CMD_TYPE.SWITCH_TO_AUDIO_CALL||e.data&&e.data.cmd===l.CMD_TYPE.SWITCH_TO_AUDIO||e.data&&e.data.cmd===l.CMD_TYPE.SWITCH_TO_VIDEO;return u.default.log(d+".switchCallMode:",e,"isSwitchCallMode-"+t),t},e.prototype.onInviteeAccepted=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r;return o(this,(function(o){switch(o.label){case 0:return u.default.log(d+".onInviteeAccepted - params:",e),t=JSON.parse(e.data.data),n=e.data.invitee,i=e.data.inviteID,-1===this._tuiCallEngine.getTotalInviterInviteIdList().indexOf(i)?[2]:this._tuiCallEngine.isGroupCall()||!this.judgeSwitchCallMode(t)||this._tuiCallEngine.getSwitchCallModeStatus()?(r=this._tuiCallEngine.getCallStatus(),n!==this._tuiCallEngine.getUserID()||r!==l.CALL_STATUS.CALLING?[3,2]:[4,this._tuiCallEngine._resetTUICallEngine()]):(this._tuiCallEngine._trtcClient.switchCallMode(this._tuiCallEngine.getCallType()),[2]);case 1:return o.sent(),this._tuiCallEngine._delegate.onCallingCancel(n),[2];case 2:return this._tuiCallEngine.isInviter()&&this._tuiCallEngine.changeCallStatus(l.CALL_STATUS.CONNECTED),this._tuiCallEngine._delegate.onUserAccept(n),this._tuiCallEngine.addHandledInviteeList([n]),this._tuiCallEngine.deleteUnHandledInviteeList([n]),this._tuiCallEngine.addAcceptedUserList(i,[n]),[2]}}))}))},e.prototype.onInviteeRejected=function(e){var t;return r(this,void 0,void 0,(function(){var n,i,r,a,s,c,p,h,f,g,m;return o(this,(function(o){switch(o.label){case 0:return u.default.log(d+".onInviteeRejected - params:",e),n=e.data.inviteID,this._tuiCallEngine.isGroupCall()||this._tuiCallEngine.getSwitchCallModeStatus()||-1===this._tuiCallEngine.getAudioVideoSwitchIdList().indexOf(n)?(i=e.data.invitee,r=e.data.inviter,a=this._tuiCallEngine.getUserID(),s=this._tuiCallEngine.getCallStatus(),c=JSON.parse(e.data.data),s===l.CALL_STATUS.IDLE?[2]:-1===this._tuiCallEngine.getInviterInviteIdList().indexOf(n)?(this._tuiCallEngine.deleteUnHandledInviteeList([i]),[2]):a!==i||s!==l.CALL_STATUS.CALLING?[3,2]:[4,this._tuiCallEngine._resetTUICallEngine()]):(u.default.log(d+".onInviteeRejected - Audio and video switching is not available"),this._tuiCallEngine.setSwitchCallModeStatus(!0),[2]);case 1:return o.sent(),this._tuiCallEngine._delegate.onCallingCancel(i),[2];case 2:return p=this._tuiCallEngine.isGroupCall(),h=this._tuiCallEngine.isInviter(),this._tuiCallEngine.deleteUnHandledInviteeList([i]),f=this._tuiCallEngine.getUnHandledInviteeList(),g=this._tuiCallEngine.getHandledInviteeList(),s===l.CALL_STATUS.CONNECTED&&-1!==g.indexOf(i)?[2]:"line_busy"===c.line_busy||""===c.line_busy||(null===(t=null==c?void 0:c.data)||void 0===t?void 0:t.message)&&"lineBusy"===c.data.message?p?[3,4]:[4,this._tuiCallEngine._resetTUICallEngine()]:[3,7];case 3:return o.sent(),this._tuiCallEngine._delegate.onCallingCancel(i),[3,6];case 4:return 0!==f.length||1!==g.length?[3,6]:[4,this._tuiCallEngine._resetTUICallEngine()];case 5:o.sent(),this._tuiCallEngine._delegate.onCallingCancel(i),o.label=6;case 6:return r===this._tuiCallEngine.getInviterID()&&this._tuiCallEngine._delegate.onLineBusy(i),[3,18];case 7:return p?[3,9]:[4,this._tuiCallEngine._resetTUICallEngine()];case 8:return o.sent(),this._tuiCallEngine._delegate.onCallingCancel(i),this._tuiCallEngine._delegate.onReject(i),[3,18];case 9:return s!==l.CALL_STATUS.CALLING?[3,15]:h?0!==f.length||1!==g.length?[3,11]:[4,this._tuiCallEngine._resetTUICallEngine()]:[3,12];case 10:o.sent(),this._tuiCallEngine._delegate.onCallingCancel(i),o.label=11;case 11:return[3,14];case 12:return 1!==f.length||0!==g.length?[3,14]:[4,this._tuiCallEngine._resetTUICallEngine()];case 13:o.sent(),this._tuiCallEngine._delegate.onCallingCancel(i),o.label=14;case 14:return[3,17];case 15:return 0!==f.length||1!==g.length?[3,17]:(m=this._tuiCallEngine.generateCallEndData({userId:i}),[4,this._tuiCallEngine._resetTUICallEngine()]);case 16:o.sent(),this._tuiCallEngine._delegate.onCallEnd(m),o.label=17;case 17:this._tuiCallEngine._delegate.onReject(i),o.label=18;case 18:return[2]}}))}))},e.prototype.onInvitationCancelled=function(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return u.default.log(d+".onInvitationCancelled - params:",e,this._tuiCallEngine.getCallStatus()),this._tuiCallEngine.getCallStatus()===l.CALL_STATUS.IDLE||-1===this._tuiCallEngine.getInviterInviteIdList().indexOf(e.data.inviteID)?[2]:[4,this._tuiCallEngine._resetTUICallEngine()];case 1:return t.sent(),this._tuiCallEngine._delegate.onCallingCancel(this._tuiCallEngine.getUserID()),[2]}}))}))},e.prototype.onInvitationTimeout=function(e){var t;return r(this,void 0,void 0,(function(){var n,i,r,a,s,c,p,h,f,g,m,v;return o(this,(function(o){switch(o.label){case 0:return n=e.data,i=n.inviter,r=n.inviteeList,a=void 0===r?[]:r,s=n.inviteID,c=this._tuiCallEngine.getUserID(),p=this._tuiCallEngine.isGroupCall(),h=this._tuiCallEngine.isInviter(),f=this._tuiCallEngine.getCallStatus(),this._tuiCallEngine.deleteUnHandledInviteeList(a),u.default.log(d+".onInvitationTimeout - params:",e,"currentUserID:"+c+" isInviter:"+h+" isGroupCall:"+p+" currentCallStatus:"+f+" inviteID:"+(null===(t=null==this?void 0:this._newInvitationData)||void 0===t?void 0:t.inviteID)),-1===this._tuiCallEngine.getInviterInviteIdList().indexOf(s)||f===l.CALL_STATUS.IDLE?[2]:(g=this._tuiCallEngine.getHandledInviteeList(),m=this._tuiCallEngine.getUnHandledInviteeList(),p?[3,2]:[4,this._tuiCallEngine._resetTUICallEngine()]);case 1:return o.sent(),h?(this._tuiCallEngine._delegate.onCallingCancel(a[0]),this._tuiCallEngine._delegate.onNoResp(i,a)):this._tuiCallEngine._delegate.onCallingCancel(a[0]||""),[3,11];case 2:return f!==l.CALL_STATUS.CALLING?[3,9]:h?0!==m.length?[3,4]:[4,this._tuiCallEngine._resetTUICallEngine()]:[3,5];case 3:o.sent(),this._tuiCallEngine._delegate.onCallingCancel(a.join(",")),o.label=4;case 4:return this._tuiCallEngine._delegate.onNoResp(i,a),[3,8];case 5:return-1!==a.indexOf(c)?[3,6]:(this._tuiCallEngine._delegate.onNoResp(i,a),[3,8]);case 6:return[4,this._tuiCallEngine._resetTUICallEngine()];case 7:o.sent(),this._tuiCallEngine._delegate.onCallingCancel(c),o.label=8;case 8:return[3,11];case 9:return this._tuiCallEngine._delegate.onNoResp(i,a),1!==g.length||0!==m.length?[3,11]:(v=this._tuiCallEngine.generateCallEndData(),[4,this._tuiCallEngine._resetTUICallEngine()]);case 10:o.sent(),this._tuiCallEngine._delegate.onCallEnd(v),o.label=11;case 11:return[2]}}))}))},e.prototype.onKickedOut=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return u.default.log(d+".onKickedOut"),this._tuiCallEngine.setIsLogin(!1),this._tuiCallEngine._trtcClient.removeTRTCEvents(),[4,this._tuiCallEngine._resetTUICallEngine()];case 1:return e.sent(),this._tuiCallEngine._delegate.onKickedOut(),[2]}}))}))},e.prototype.onNetStateChange=function(){u.default.debug(d+".onNetStateChange")},e.prototype.onMessageSentByMe=function(e){this._tuiCallEngine._delegate.onMessageSentByMe(e)},e.prototype.login=function(e){return r(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){return[2,new Promise((function(n,i){t._tsignaling.login(e).then((function(e){var i;if(null===(i=e.data)||void 0===i?void 0:i.repeatLogin)return u.default.warn(d+".login - success: The TIM login status has been inherited into Call. IM 登录状态已成功被 Call 继承。"),void n();t._resolveMap.set("login",{resolve:n,value:e})})).catch((function(e){i(e)}))}))]}))}))},e.prototype.logout=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){return this._joined=!1,[2,this._tsignaling.logout()]}))}))},e.prototype.invite=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,s,c,u;return o(this,(function(o){switch(o.label){case 0:return t=e.userID,n=e.type,r=e.roomID,a=e.timeout,s=e.offlinePushInfo,c=e.userIDList,[4,this._tsignaling.invite({userID:t,data:JSON.stringify(this.handleNewSignaling({version:0,call_type:n,room_id:r},{userIDs:c})),timeout:a,offlinePushInfo:s})];case 1:return u=o.sent(),[2,i(i({},u),{roomID:r,userID:t})]}}))}))},e.prototype.inviteInGroup=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,s,c,u,l;return o(this,(function(o){switch(o.label){case 0:return t=e.groupID,n=e.userIDList,r=e.roomID,a=e.type,s=e.timeout,c=e.offlinePushInfo,u=e.inCallUserIDs,[4,this._tsignaling.inviteInGroup({groupID:t,inviteeList:n,data:JSON.stringify(this.handleNewSignaling({version:0,call_type:a,room_id:r,inCallUserIDs:u})),timeout:s,offlinePushInfo:c})];case 1:return l=o.sent(),[2,i(i({},l),{roomID:r,groupID:t})]}}))}))},e.prototype.hangup=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,a,s,c,p;return o(this,(function(o){switch(o.label){case 0:return u.default.log(d+".hangup - params:",e),t=e.userIDList,n=e.callType,i=e.callEnd,a={version:0,call_type:n,call_end:r=void 0===i?0:i},s={cmd:l.CMD_TYPE.HANG_UP},c=JSON.stringify(this.handleNewSignaling(a,s)),this._tuiCallEngine.isGroupCall()&&this._tuiCallEngine.getGroupID()?[4,this._tsignaling.inviteInGroup({inviteeList:t,groupID:this._tuiCallEngine.getGroupID(),data:c,timeout:0})]:[3,2];case 1:return o.sent(),[3,4];case 2:return[4,this._tsignaling.invite({userID:t[0],data:c,timeout:0})];case 3:o.sent(),o.label=4;case 4:return this._joined=!1,p=this._tuiCallEngine.generateCallEndData({callMediaType:n,totalTime:r}),this._tuiCallEngine._delegate.onCallEnd(p),[2]}}))}))},e.prototype.accept=function(e,t){return r(this,void 0,void 0,(function(){var n,r,s;return o(this,(function(o){switch(o.label){case 0:return n=e.inviteID,r=e.callType,s=a(e,["inviteID","callType"]),[4,this._tsignaling.accept({inviteID:n,data:JSON.stringify(this.handleNewSignaling(i({version:0,call_type:r},s),t))})];case 1:return[2,o.sent()]}}))}))},e.prototype.reject=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r;return o(this,(function(o){return t=e.inviteID,n=e.callType,i=e.isBusy,r={version:0,call_type:n},i&&(r.line_busy="line_busy"),[2,this._tsignaling.reject({inviteID:t,data:JSON.stringify(this.handleNewSignaling(r,{message:i?"lineBusy":""}))})]}))}))},e.prototype.cancel=function(e){return r(this,void 0,void 0,(function(){var t,n;return o(this,(function(i){return t=e.inviteID,n=JSON.stringify(this.handleNewSignaling({version:4,businessID:"av_call",call_type:this._tuiCallEngine.getCallType()})),[2,this._tsignaling.cancel({inviteID:t,data:n})]}))}))},e.prototype.resetJoined=function(){this._joined=!1},e.prototype.switchCallMode=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,a,s,c,u;return o(this,(function(o){switch(o.label){case 0:return t=e.userID,n=e.callType,i=e.roomID,r=e.timeout,a=e.mode,s={version:0,call_type:n,room_id:i,switch_to_audio_call:null},c={cmd:l.CMD_TYPE.SWITCH_TO_VIDEO},a===l.MODE_TYPE.AUDIO?(s.switch_to_audio_call=l.CMD_TYPE.SWITCH_TO_AUDIO_CALL,c.cmd=l.CMD_TYPE.SWITCH_TO_AUDIO):delete s.switch_to_audio_call,[4,this._tsignaling.invite({userID:t,data:JSON.stringify(this.handleNewSignaling(s,c)),timeout:r})];case 1:return(u=o.sent()).inviteID&&this._tuiCallEngine.addAudioVideoSwitchIdList(u.inviteID),[2]}}))}))},e.prototype.handleNewSignaling=function(e,t){return i(i({extraInfo:""},e),{version:4,businessID:"av_call",platform:"Web",data:i({cmd:l.CMD_TYPE_LIST[e.call_type],room_id:e.room_id,message:""},t)})},e}();t.default=h},function(e,t){e.exports=i},function(e,t,n){var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(15),o=n(0),a=n(9),s=n(11),c=n(12),u="TUICallObserver",l=function(){function e(e){this._eventEmitter=e,this._eventStatController=new c.default,a.default.bindController(this._eventStatController)}return e.prototype._setInterfaceUpLoad=function(e){return o.default.time(e),new a.default(e)},e.prototype.onError=function(e,t){o.default.debug(u+".onError code:"+e+" msg:"+t),this._eventEmitter.emit(r.TUICallEvent.ERROR,{code:e,msg:t}),this._setInterfaceUpLoad(s.default.ERROR).setText("").setEnd()},e.prototype.onSdkReady=function(e){o.default.debug(u+".onSdkReady params:"+e),this._eventEmitter.emit(r.TUICallEvent.SDK_READY,e),this._setInterfaceUpLoad(s.default.SDK_READY).setText("").setEnd()},e.prototype.onInvited=function(e){o.default.debug(u+".onInvited params:",e);var t=e.sponsor,n=e.userIDList,i=e.isFromGroup,a=e.inviteData,c=e.inviteID;this._eventEmitter.emit(r.TUICallEvent.INVITED,{sponsor:t,userIDList:n,isFromGroup:i,inviteData:a,inviteID:c}),this._setInterfaceUpLoad(s.default.INVITED).setText("TUICallEvent.INVITED emitted").setEnd()},e.prototype.onUserAccept=function(e){o.default.debug(u+".onUserAccept userID:"+e),this._eventEmitter.emit(r.TUICallEvent.USER_ACCEPT,{userID:e})},e.prototype.onUserEnter=function(e){o.default.debug(u+".onUserEnter userID:"+e),this._eventEmitter.emit(r.TUICallEvent.USER_ENTER,{userID:e}),this._setInterfaceUpLoad(s.default.USER_ENTER).setText("TUICallEvent.USER_ENTER emitted").setEnd()},e.prototype.onUserLeave=function(e){o.default.debug(u+".onUserLeave userID:"+e),this._eventEmitter.emit(r.TUICallEvent.USER_LEAVE,{userID:e}),this._setInterfaceUpLoad(s.default.USER_LEAVE).setText("TUICallEvent.USER_LEAVE emitted").setEnd()},e.prototype.onReject=function(e){o.default.debug(u+".onReject userID:"+e),this._eventEmitter.emit(r.TUICallEvent.REJECT,{userID:e}),this._setInterfaceUpLoad(s.default.REJECT).setText("TUICallEvent.REJECT emitted").setEnd()},e.prototype.onNoResp=function(e,t){o.default.debug(u+".onNoResp userIDList:",e,t),this._eventEmitter.emit(r.TUICallEvent.NO_RESP,{sponsor:e,userIDList:t}),this._setInterfaceUpLoad(s.default.NO_RESP).setText("TUICallEvent.NO_RESP emitted").setEnd()},e.prototype.onLineBusy=function(e){o.default.debug(u+".onLineBusy userID:"+e),this._eventEmitter.emit(r.TUICallEvent.LINE_BUSY,{userID:e}),this._setInterfaceUpLoad(s.default.LINE_BUSY).setText("TUICallEvent.LINE_BUSY emitted").setEnd()},e.prototype.onCallingCancel=function(e){void 0===e&&(e=""),o.default.debug(u+".onCallingCancel ",e),this._eventEmitter.emit(r.TUICallEvent.CALLING_CANCEL,{userID:e}),this._setInterfaceUpLoad(s.default.CALLING_CANCEL).setText("TUICallEvent.CALLING_CANCEL emitted").setEnd()},e.prototype.onKickedOut=function(){o.default.debug(u+".onKickedOut"),this._eventEmitter.emit(r.TUICallEvent.KICKED_OUT,{}),this._setInterfaceUpLoad(s.default.KICKED_OUT).setText("TUICallEvent.KICKED_OUT emitted").setEnd()},e.prototype.onCallingTimeout=function(e,t){o.default.debug(u+".onCallingTimeout userIDList:",t),this._eventEmitter.emit(r.TUICallEvent.CALLING_TIMEOUT,{sponsor:e,userIDList:t}),this._setInterfaceUpLoad(s.default.CALLING_TIMEOUT).setText("TUICallEvent.CALLING_TIMEOUT emitted").setEnd()},e.prototype.onCallEnd=function(e){o.default.debug(u+".onCallEnd params:"+e),this._eventEmitter.emit(r.TUICallEvent.CALLING_END,i(i({},e),{callEnd:e.totalTime})),this._setInterfaceUpLoad(s.default.CALLING_END).setText("TUICallEvent.CALLING_END emitted").setEnd()},e.prototype.onUserVideoAvailable=function(e){o.default.debug(u+".onUserVideoAvailable params:",e);var t=e.userID,n=e.isVideoAvailable;this._eventEmitter.emit(r.TUICallEvent.USER_VIDEO_AVAILABLE,{userID:t,isVideoAvailable:n});var i="TUICallEvent.USER_VIDEO_AVAILABLE emitted, userID: "+t+", video: "+n;this._setInterfaceUpLoad(s.default.USER_VIDEO_AVAILABLE).setText(i).setEnd()},e.prototype.onUserAudioAvailable=function(e){o.default.debug(u+".onUserAudioAvailable params:",e);var t=e.userID,n=e.isAudioAvailable;this._eventEmitter.emit(r.TUICallEvent.USER_AUDIO_AVAILABLE,{userID:t,isAudioAvailable:n});var i="TUICallEvent.USER_AUDIO_AVAILABLE emitted, userID: "+t+", mic: "+n;this._setInterfaceUpLoad(s.default.USER_AUDIO_AVAILABLE).setText(i).setEnd()},e.prototype.onUserVoiceVolume=function(e){this._eventEmitter.emit(r.TUICallEvent.USER_VOICE_VOLUME,{volumeMap:e}),this._setInterfaceUpLoad(s.default.USER_VOICE_VOLUME).setText("TUICallEvent.USER_VOICE_VOLUME emitted").setEnd()},e.prototype.onGroupCallInviteeListUpdate=function(e){this._eventEmitter.emit(r.TUICallEvent.GROUP_CALL_INVITEE_LIST_UPDATE,{userIDList:e}),this._setInterfaceUpLoad(s.default.GROUP_CALL_INVITEE_LIST_UPDATE).setText("TUICallEvent.GROUP_CALL_INVITEE_LIST_UPDATE emitted").setEnd()},e.prototype.onCallTypeChanged=function(e,t){this._eventEmitter.emit(r.TUICallEvent.CALL_TYPE_CHANGED,{oldCallType:e,newCallType:t}),this._setInterfaceUpLoad(s.default.CALL_TYPE_CHANGED).setText("TUICallEvent.CALL_TYPE_CHANGED "+t).setEnd()},e.prototype.onDeviceUpdated=function(e,t,n,i){this._eventEmitter.emit(r.TUICallEvent.DEVICED_UPDATED,{microphoneList:e,cameraList:t,currentMicrophone:n,currentCamera:i}),this._setInterfaceUpLoad(s.default.DEVICED_UPDATED).setText("TUICallEvent.GROUP_CALL_INVITEE_LIST_UPDATE emitted").setEnd()},e.prototype.onMessageSentByMe=function(e){this._eventEmitter.emit(r.TUICallEvent.MESSAGE_SENT_BY_ME,e)},e}();t.default=l},function(e,t,n){n.r(t);var i=n(0);const r="none",o="online",a=function(){let e=window.location.protocol;return["http:","https:"].indexOf(e)<0&&(e="http:"),e};t.default=class{constructor(){this._networkType="",this.maxWaitTime=3e3}start(){this._networkType=o}_onNetworkStatusChange(e){this._networkType=e.networkType,e.isConnected?i.default.info("NetMonitor networkType:"+e.networkType):i.default.warn("NetMonitor no network, please check!")}probe(){return new Promise((e=>{if(window&&window.fetch)fetch(`${a()}//webim-1252463788.file.myqcloud.com/assets/test/speed.xml?random=${Math.random()}`).then((t=>{t.ok?e([!0,o]):e([!1,r])})).catch((()=>{e([!1,r])}));else{const t=new XMLHttpRequest,n=setTimeout((()=>{i.default.warn("NetMonitor fetch timeout. Probably no network, please check!"),t.abort(),this._networkType=r,e([!1,r])}),this.maxWaitTime);t.onreadystatechange=function(){4===t.readyState&&(clearTimeout(n),200===t.status||304===t.status?(this._networkType=o,e([!0,o])):(i.default.warn(`NetMonitor fetch status:${t.status}. Probably no network, please check!`),this._networkType=r,e([!1,r])))},t.open("GET",`${a()}//webim-1252463788.file.myqcloud.com/assets/test/speed.xml?random=${Math.random()}`),t.send()}}))}getNetworkType(){return this._networkType}reset(){this._networkType=""}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.apiCallQueue=t.avoidRepeatedCall=t.statusValidate=t.deviceValidate=t.businessValidate=t.paramValidate=t.API_STATUS=t.VALIDATE_PARAMS=void 0;var i=n(62);Object.defineProperty(t,"VALIDATE_PARAMS",{enumerable:!0,get:function(){return i.VALIDATE_PARAMS}});var r=n(27);Object.defineProperty(t,"API_STATUS",{enumerable:!0,get:function(){return r.API_STATUS}});var o=n(63);Object.defineProperty(t,"paramValidate",{enumerable:!0,get:function(){return o.paramValidate}});var a=n(26);Object.defineProperty(t,"businessValidate",{enumerable:!0,get:function(){return a.businessValidate}});var s=n(64);Object.defineProperty(t,"deviceValidate",{enumerable:!0,get:function(){return s.deviceValidate}});var c=n(65);Object.defineProperty(t,"statusValidate",{enumerable:!0,get:function(){return c.statusValidate}});var u=n(66);Object.defineProperty(t,"avoidRepeatedCall",{enumerable:!0,get:function(){return u.avoidRepeatedCall}});var l=n(67);Object.defineProperty(t,"apiCallQueue",{enumerable:!0,get:function(){return l.apiCallQueue}})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.VALIDATE_PARAMS=void 0;var i=n(27),r=n(13),o=n(2);t.VALIDATE_PARAMS={createInstance:{SDKAppID:{required:!0,rules:[i.VALIDATE_TYPR.NUMBER],allowEmpty:!1},tim:{required:!1,rules:[i.VALIDATE_TYPR.OBJECT],allowEmpty:!0}},login:{userID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1},userSig:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1}},call:{userID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1},type:{required:!0,rules:[i.VALIDATE_TYPR.NUMBER],range:[1,2],allowEmpty:!1},timeout:{required:!1,rules:[i.VALIDATE_TYPR.NUMBER],allowEmpty:!1}},groupCall:{userIDList:{required:!0,rules:[i.VALIDATE_TYPR.ARRAY],allowEmpty:!1},type:{required:!0,rules:[i.VALIDATE_TYPR.NUMBER],range:[1,2],allowEmpty:!1},groupID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1},timeout:{required:!1,rules:[i.VALIDATE_TYPR.NUMBER],allowEmpty:!1}},joinInGroupCall:{type:{required:!0,rules:[i.VALIDATE_TYPR.NUMBER],range:[1,2],allowEmpty:!1},groupID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1},roomID:{required:!0,rules:[i.VALIDATE_TYPR.NUMBER],allowEmpty:!1}},inviteUser:{userIDList:{required:!0,rules:[i.VALIDATE_TYPR.ARRAY],allowEmpty:!1}},startRemoteView:{userID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1},videoViewDomID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1}},stopRemoteView:{userID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1}},startLocalView:{userID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1},videoViewDomID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1}},stopLocalView:{userID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1}},switchDevice:{deviceType:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1},deviceId:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1}},setVideoQuality:[{key:"profile",required:!0,rules:[i.VALIDATE_TYPR.STRING,i.VALIDATE_TYPR.OBJECT],range:Object.keys(r.TUICommonDefine.VideoEncoderParams),allowEmpty:!1}],switchCallMediaType:[{key:"newMediaType",required:!0,rules:[i.VALIDATE_TYPR.NUMBER],range:[1,2],allowEmpty:!1}],getDeviceList:[{key:"deviceType",required:!0,rules:[i.VALIDATE_TYPR.STRING],range:["camera","microphones"],allowEmpty:!1}],setSelfInfo:{nickName:{required:!1,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1},avatar:{required:!1,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1}},setVideoRenderParams:{objectFit:{require:!1,rules:[i.VALIDATE_TYPR.STRING],range:[o.NAME.CONTAIN,o.NAME.COVER,o.NAME.FILL],allowEmpty:!1},muted:{require:!1,rules:[i.VALIDATE_TYPR.BOOLEAN],allowEmpty:!1},mirror:{require:!1,rules:[i.VALIDATE_TYPR.BOOLEAN],allowEmpty:!1}}}},function(e,t,n){var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.paramValidate=void 0;var r=n(1),o=n(8),a=n(4);function s(e,t,n){try{if(r.isArray(e))for(var o=0;o<e.length;o++)c.call(this,i(i({},e[o]),{value:t[o],name:n}));else for(var a in e)c.call(this,i(i({},e[a]),{value:t[0][a],name:n,key:a}))}catch(s){throw s}}function c(e){var t=e.required,n=e.rules,i=e.range,s=e.value,c=e.allowEmpty,u=e.name,l=e.key;if(t&&!c||s){if(!s)throw new o.default({message:"API<"+u+">: "+l+" is blank",code:a.default.ERROR_PARAM_INVALID});var d="";if(!n.some((function(e){return e===r.getType(s)}))){for(var p=0;p<n.length;p++){var h=n[p];d+=(h=h.replace(h[0],h[0].toUpperCase()))+"/"}throw d=d.substring(0,d.length-1),new o.default({message:"API<"+u+">: "+l+" must is "+d,code:a.default.ERROR_PARAM_INVALID})}if(i&&-1===i.indexOf(s))throw new o.default({message:"API<"+u+">: "+l+" error, only be "+i,code:a.default.ERROR_PARAM_INVALID})}}t.paramValidate=function(e){return function(t,n,i){var r=i.value;return i.value=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return s.call(this,e,t,n),r.apply(this,t)},i}}},function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.deviceValidate=void 0;var o=n(8),a=n(4),s=n(5);function c(e,t,n){return i(this,void 0,void 0,(function(){var i,c;return r(this,(function(r){switch(r.label){case 0:if(this._permission[n])return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._trtcClient.getMediaDevicesAuth((c={},c[n]=!0,c.isThrowVideoError=!0,c))];case 2:return r.sent(),[3,4];case 3:throw i=r.sent(),this._delegate.onError(a.default.NOT_MEDIA_ACCESS,JSON.stringify(i)),new o.default({message:"<doValidate>: "+s.ERROR_MESSAGE.ERROR_PERMISSION_DENIED,code:a.default.ERROR_PERMISSION_DENIED});case 4:return e.apply(this,t),[2]}}))}))}t.deviceValidate=function(e){return function(t,n,o){var a=o.value;return o.value=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return i(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,c.call(this,a,t,e)];case 1:return[2,n.sent()];case 2:throw n.sent();case 3:return[2]}}))}))},o}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.statusValidate=void 0;var i=n(8),r=n(4),o=n(5);function a(e,t,n){var a;if((null==e?void 0:e.init)&&!this._isLogin)throw new i.default({message:"API<"+n+">: "+o.ERROR_MESSAGE.ERROR_INIT_FAIL,code:r.default.ERROR_INIT_FAIL});if(-1===(null===(a=null==e?void 0:e.callStatus)||void 0===a?void 0:a.indexOf(this._callStatus)))throw new i.default({message:"API<"+n+">: "+o.ERROR_MESSAGE.ERROR_REQUEST_REFUSED+". support status: ["+e.callStatus.join(",")+"], current status: "+this._callStatus,code:r.default.ERROR_REQUEST_REFUSED});if((null==e?void 0:e.scene)&&this._isGroupCall)throw new i.default({message:"API<"+n+">: "+o.ERROR_MESSAGE.ERROR_SCENE_NOT_SUPPORTED,code:r.default.ERROR_SCENE_NOT_SUPPORTED})}t.statusValidate=function(e){return function(t,n,i){var r=i.value;return i.value=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return a.call(this,e,t,n),r.apply(this,t)},i}}},function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.avoidRepeatedCall=void 0,t.avoidRepeatedCall=function(){return function(e,t,n){var o=n.value,a=new Set;return n.value=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return i(this,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:if(a.has(this))throw new Error("previous "+t+"() is ongoing, please avoid repeated calls");r.label=1;case 1:return r.trys.push([1,3,,4]),a.add(this),[4,o.apply(this,e)];case 2:return n=r.sent(),a.delete(this),[2,n];case 3:throw i=r.sent(),a.delete(this),i;case 4:return[2]}}))}))},n}}},function(e,t,n){var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.apiCallQueue=void 0;var r=new WeakMap;t.apiCallQueue=function(){return function(e,t,n){var o=n.value,a=function(e){var t=e.fn,n=e.args,o=e.context,s=e.resolve,c=e.reject;t.apply(o,n).then(s,c).finally((function(){var e=r.get(o);e.shift(),e[0]&&a(i({},e[0]))}))};return n.value=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new Promise((function(n,i){if(r.has(e)){var s=r.get(e),c=s.length;s.push({fn:o,args:t,context:e,resolve:n,reject:i}),0===c&&a({fn:o,args:t,context:e,resolve:n,reject:i})}else r.set(e,[{fn:o,args:t,context:e,resolve:n,reject:i}]),a({fn:o,args:t,context:e,resolve:n,reject:i})}))},n}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.TUICallEngineObserver=t.CallDataReport=void 0;var i=n(7),r=n(15),o=n(9),a=n(11),s=n(12),c=n(2),u=n(69),l=n(1),d=function(){function e(e){this._eventStatController=new s.default,o.default.bindController(this._eventStatController),this.initializeCallData(e),this._ssoLog=new o.default(a.default.QUALITY_REPORT)}return e.prototype.setCallData=function(e){this._callData=e},e.prototype.getCallData=function(){return this._callData},e.prototype.setInviteID=function(e){this._callData.inviteID=e},e.prototype.setTotalTime=function(e){this._callData.totalTime=e},e.prototype.setAbilityBit=function(e){this._callData.abilityBit=!!e},e.prototype.setEnterRoomTime=function(e){this._callData.enterRoomTime=u.convertTimeStampToString(e)},e.prototype.setSendSignalingTime=function(e){this._callData.sendSignalingTime=u.convertTimeStampToString(e)},e.prototype.setCallAcceptTime=function(e){this._callData.callAcceptTime=u.convertTimeStampToString(e)},e.prototype.setExitRoomTime=function(e){this._callData.exitRoomTime=u.convertTimeStampToString(e)},e.prototype.setCallEndTime=function(e){this._callData.callEndTime=e},e.prototype.setCodeAndMessage=function(e,t){this._callData.code=e||0,this._callData.message=t||""},e.prototype.setCallScene=function(e){this._callData.callScene=e||""},e.prototype.getResult=function(){return this._callData.result},e.prototype.setResult=function(e){this._callData.result=e||""},e.prototype.setUserID=function(e){this._callData.userID=e||""},e.prototype._callTypeMapping=function(e){var t=c.NAME.UNKNOWN;switch(e){case i.CALL_TYPE.AUDIO_CALL:t=c.NAME.AUDIO;break;case i.CALL_TYPE.VIDEO_CALL:t=c.NAME.VIDEO}return t},e.prototype._callRoleMapping=function(e){var t=e;return t===i.CALL_ROLE.INVITER?t=c.NAME.CALLER:t===i.CALL_ROLE.INVITEE&&(t=c.NAME.CALLEE),t},e.prototype.packageCallDataToKibana=function(){var e=this._callTypeMapping(this._callData.callType),t=this._callRoleMapping(this._callData.callRole);return"CallData{version='"+this._callData.version+", platform="+this._callData.platform+", framework="+this._callData.framework+", sdk_app_id="+this._callData.sdkAppId+", user_id="+this._callData.userID+", room_id="+this._callData.roomID+", invite_id="+this._callData.inviteID+", invitee_list="+this._callData.inviteeList+", media_type="+e+", role="+t+", call_scene="+this._callData.callScene+", result="+this._callData.result+", total_time="+this._callData.totalTime+", total_score="+this._callData.totalScore+", ability_bit="+this._callData.abilityBit+", enter_room="+this._callData.enterRoomTime+", send_signaling="+this._callData.sendSignalingTime+", call_accept="+this._callData.callAcceptTime+", exit_room="+this._callData.exitRoomTime+", call_end="+this._callData.callEndTime+", code="+this._callData.code+", message="+this._callData.message+", network="+this._callData.network+", audio="+this._callData.audio+", video="+this._callData.video+"}"},e.prototype.initializeCallData=function(e){var t=e||{},n=t.version,r=void 0===n?"":n,o=t.sdkAppId,a=void 0===o?0:o,s=t.userID,u=void 0===s?"":s,d=l.getHostType();this._callData={version:r,platform:d,framework:c.NAME.WEB,sdkAppId:a,userID:u,roomID:0,inviteID:"",callRole:i.CALL_ROLE.UNKNOWN,callScene:"",callType:i.CALL_TYPE.UNKNOWN,inviteeList:[],result:c.NAME.UNKNOWN,totalTime:0,totalScore:0,code:0,message:"",abilityBit:!1,enterRoomTime:"",sendSignalingTime:"",callAcceptTime:"",exitRoomTime:"",callEndTime:"",network:0,audio:0,video:0}},e.prototype.reset=function(){this.initializeCallData(),this._ssoLog=null},e.prototype.clearCallDataAfterUpload=function(){var e=this.getCallData(),t=e.version,n=e.sdkAppId,i=e.userID;this.initializeCallData({version:t,sdkAppId:n,userID:i})},e.prototype.uploadToKibana=function(){try{this._ssoLog.setText(this.packageCallDataToKibana()).setEnd(),this.clearCallDataAfterUpload()}catch(e){}},e}();t.CallDataReport=d;var p=function(){function e(e,t){this._eventEmitter=e,this._callDataReport=t,this.registerListener()}return e.prototype.registerListener=function(){this._eventEmitter.on(r.TUICallEvent.CALLING_END,this.onCallEnd.bind(this)),this._eventEmitter.on(r.TUICallEvent.CALLING_CANCEL,this.onCallingCancel.bind(this)),this._eventEmitter.on(r.TUICallEvent.NO_RESP,this.onNoResponse.bind(this)),this._eventEmitter.on(r.TUICallEvent.LINE_BUSY,this.onLineBusy.bind(this)),this._eventEmitter.on(r.TUICallEvent.REJECT,this.onReject.bind(this))},e.prototype.removeLister=function(){this._eventEmitter.off(r.TUICallEvent.CALLING_END,this.onCallEnd.bind(this)),this._eventEmitter.off(r.TUICallEvent.CALLING_CANCEL,this.onCallingCancel.bind(this)),this._eventEmitter.off(r.TUICallEvent.NO_RESP,this.onNoResponse.bind(this)),this._eventEmitter.off(r.TUICallEvent.LINE_BUSY,this.onLineBusy.bind(this)),this._eventEmitter.off(r.TUICallEvent.REJECT,this.onReject.bind(this))},e.prototype.onCallEnd=function(e){var t=e.totalTime,n=void 0===t?0:t;this._callDataReport.setTotalTime(n),this._callDataReport.setResult(c.NAME.NORMAL),this._callDataReport.setCodeAndMessage(),this._callDataReport.uploadToKibana()},e.prototype.onCallingCancel=function(){this._callDataReport.getResult()||this._callDataReport.setResult(c.NAME.CANCEL),this._callDataReport.setCodeAndMessage(),this._callDataReport.uploadToKibana()},e.prototype.onNoResponse=function(){this._callDataReport.setResult(c.NAME.TIMEOUT)},e.prototype.onLineBusy=function(){this._callDataReport.setResult(c.NAME.BUSYLINE)},e.prototype.onReject=function(){this._callDataReport.setResult(c.NAME.REJECT)},e}();t.TUICallEngineObserver=p},function(e,t,n){n.r(t),n.d(t,"setBaseTime",(function(){return c})),n.d(t,"getCurrentTime",(function(){return u})),n.d(t,"getTimestamp",(function(){return l})),n.d(t,"convertTimeStampToString",(function(){return d}));var i=n(0),r=n(29),o=n.n(r);let a=(new Date).getTime(),s=0;const c=function(e){a=e,s=a-(new Date).getTime();const t=new Date;t.setTime(e),i.default.info("baseTime from server: "+t+" offset: "+s)},u=function(){return(new Date).getTime()+s},l=function(){const e=new Date;return e.setTime(u()),e.toLocaleString()},d=e=>e<=0?"":o()(e).format("YYYY-MM-DD HH:mm:ss")}]).default}(hP(),vP(),su(),MP()),function(){try{if("undefined"!=typeof document){var e=document.createElement("style");e.appendChild(document.createTextNode('.tui-call-kit[data-v-fe5ee432]{width:100%;height:100%;position:relative;border-radius:inherit}.calling-wrapper[data-v-fe5ee432]{position:relative;width:100%;height:100%;border-radius:inherit;background:rgba(0,24,60,.7);backdrop-filter:blur(34px);display:flex;flex-direction:column;justify-content:center;overflow:hidden;z-index:12}.calling-wrapper[data-v-fe5ee432]:hover{z-index:inherit;transition:all .5s ease-in-out}.dialing-wrapper[data-v-fe5ee432]{background:#00183C;color:#fff;opacity:.7;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;border-radius:inherit;top:0;left:0;z-index:10;overflow:hidden}.dialing-local[data-v-fe5ee432]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.dialing-content[data-v-fe5ee432]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;position:relative;top:-3rem}#local-dialing[data-v-fe5ee432],#local-group[data-v-fe5ee432]{background:black;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWRhc2hhcnJheT0iMTUiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNSIKCQlzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTIiPgoJCTxhbmltYXRlIGZpbGw9ImZyZWV6ZSIgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIGR1cj0iMC4zcyIgdmFsdWVzPSIxNTswIiAvPgoJCTxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgZHVyPSIxLjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKCQkJdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgMTIgMTI7MzYwIDEyIDEyIiAvPgoJPC9wYXRoPgo8L3N2Zz4=);background-repeat:no-repeat;background-size:auto;background-position-x:center;background-position-y:calc(50% + 10px)}.dialing-user-id[data-v-fe5ee432]{font-style:normal;font-weight:600;font-size:40px;width:100%;line-height:56px;display:flex;align-items:center;justify-content:center}.dialing-info[data-v-fe5ee432]{font-style:normal;font-weight:400;font-size:14px;line-height:20px}.control-wrapper[data-v-fe5ee432]{transform:translate(-50%);position:absolute;bottom:0;padding-bottom:40px;left:50%;width:100%;color:#fff;border-radius:inherit;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.4) 100%);display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;z-index:11;user-select:none}.panel-button-area[data-v-fe5ee432]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin:30px 0}.panel-dialing-info[data-v-fe5ee432]{text-align:center}.control-wrapper[data-v-fe5ee432]:hover{z-index:13}.control-item[data-v-fe5ee432]{display:flex;flex-direction:column;width:100px;margin:0 20px}.control-item-h5[data-v-fe5ee432]{display:flex;flex-direction:column;width:100px;margin:0}.control-item-text[data-v-fe5ee432]{margin-top:5px;white-space:nowrap;font-weight:400;font-size:14px;line-height:20px;text-align:center}.control-item-icon[data-v-fe5ee432]{width:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;position:relative}.control-item-icon-container-small[data-v-fe5ee432]{background:rgba(218,218,218,.3);border-radius:40px;width:40px;height:40px;margin:8px;cursor:pointer}.control-item-icon-container-medium[data-v-fe5ee432]{background:rgba(0,0,0,.3);border-radius:56px;width:56px;height:56px;margin:8px;cursor:pointer}.control-item-icon-container-large[data-v-fe5ee432]{background:rgba(0,0,0,.3);border-radius:68px;width:68px;height:68px;margin:8px;cursor:pointer}.control-item-summary[data-v-fe5ee432]{height:40px;width:12px;right:0;display:flex;justify-content:center;align-items:center;cursor:pointer}.control-item-summary[data-v-fe5ee432]:hover{background:rgba(0,0,0,.4)}.control-item-detail[data-v-fe5ee432]{width:300px;border-radius:4px;background:#FEFEFF;box-shadow:#0000003d 0 3px 8px;color:#000;padding:20px;position:absolute;transform:translate(28px);bottom:110%}.control-item-detail-row[data-v-fe5ee432]{margin-bottom:6px;font-size:16px}.device-select[data-v-fe5ee432]{height:32px;width:100%;border:1px solid #DEE0E3;padding-left:6px;padding-top:6px;padding-bottom:6px;margin-top:10px;margin-bottom:10px;font-size:14px;color:#596174}.control-item-detail[data-v-fe5ee432]:before{content:"";width:0;height:0;border-width:10px;border-style:solid;border-color:#FEFEFF transparent transparent;bottom:-3px;margin-left:-9px;position:absolute;left:50%;border-color:#fff;border-radius:4px;transform:rotate(60deg) skew(30deg)}.tag[data-v-fe5ee432]{color:#fff;z-index:inherit;background:rgba(0,0,0,.6);padding:2px 10px;border-top-right-radius:inherit;border-bottom-left-radius:inherit;font-size:14px;position:absolute;left:0;bottom:0;z-index:11;display:flex;align-items:center}.tag .microphone-icon-container[data-v-fe5ee432]{margin-left:0;margin-right:2px;width:20px;background-color:transparent}.switch-large-small[data-v-fe5ee432]{position:absolute;right:12px;top:12px;width:16px;height:16px;z-index:inherit;cursor:pointer}.small-h5[data-v-fe5ee432]{position:absolute;width:94px;height:160px;min-height:100px;max-height:60%;top:30px;right:10px;z-index:2;overflow:hidden;background:#000;border-radius:4px}.small[data-v-fe5ee432]{position:absolute;width:260px;height:170px;min-height:100px;max-height:60%;top:30px;left:30px;z-index:2;overflow:hidden;resize:both;background:#000;border-radius:4px}.large[data-v-fe5ee432]{min-height:100px;width:100%;height:100%;z-index:1;border-radius:inherit;overflow:hidden}.large .switch-large-small[data-v-fe5ee432]{display:none}.group-calling-container[data-v-fe5ee432]{width:100%;height:100%;display:flex;flex-wrap:wrap;justify-content:center}.group-user-view[data-v-fe5ee432]{width:33.333%;height:33.333%;position:relative;background:rgba(32,32,32,.45);backdrop-filter:blur(34px);color:#fff;overflow:hidden}.user-view-text-container[data-v-fe5ee432]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;display:flex;flex-direction:column;justify-content:center;align-items:center;transform:translateY(-20px)}.user-view-user-id[data-v-fe5ee432]{font-family:PingFang SC;font-style:normal;font-weight:600;font-size:24px;line-height:34px}.user-view-info[data-v-fe5ee432]{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:12px;line-height:17px}.page-turn[data-v-fe5ee432]{width:40px;height:86px;border-radius:4.21px;background:rgba(0,0,0,.2);position:absolute;top:50%;transform:translateY(-50%);z-index:11;display:flex;justify-content:center;align-items:center;cursor:pointer}.turn-icon-container[data-v-fe5ee432]{width:14px;height:23px}.right[data-v-fe5ee432]{right:0}.microphone-icon-container[data-v-fe5ee432]{width:24px;height:24px;background:rgba(0,0,0,.4);border-radius:12px;display:flex;justify-content:center;align-items:center;margin-left:8px}.group-user-view-1[data-v-fe5ee432]{width:100%;height:100%}.group-calling-container-1[data-v-fe5ee432]{height:100%}.group-user-view-2[data-v-fe5ee432]{width:50%;height:100%}.group-calling-container-2[data-v-fe5ee432]{height:50%}.group-user-view-3[data-v-fe5ee432],.group-user-view-4[data-v-fe5ee432]{width:50%;height:50%}.group-calling-container-3[data-v-fe5ee432],.group-calling-container-4[data-v-fe5ee432]{height:100%}.group-user-view-5[data-v-fe5ee432],.group-user-view-6[data-v-fe5ee432]{width:33.333%;height:50%}.group-calling-container-5[data-v-fe5ee432],.group-calling-container-6[data-v-fe5ee432]{height:66%}.user-view-user-id-1[data-v-fe5ee432]{font-size:24px}.user-view-user-id-2[data-v-fe5ee432],.user-view-user-id-3[data-v-fe5ee432],.user-view-user-id-4[data-v-fe5ee432]{font-size:22px}.user-view-user-id-5[data-v-fe5ee432],.user-view-user-id-6[data-v-fe5ee432],.user-view-user-id-7[data-v-fe5ee432],.user-view-user-id-8[data-v-fe5ee432],.user-view-user-id-9[data-v-fe5ee432]{font-size:18px}.float-control-panel[data-v-fe5ee432]{width:168px;height:56px;background:white;z-index:13;position:fixed;top:20px;right:20px;display:flex;flex-wrap:nowrap;justify-content:center;border-radius:40px;box-shadow:#00000029 0 3px 6px,#0000003b 0 3px 6px}.function-buttons[data-v-fe5ee432]{position:absolute;right:12px;top:12px;z-index:13;cursor:pointer;display:flex;flex-direction:row;justify-content:flex-start}.minimize[data-v-fe5ee432]{margin-left:10px}.float-control-item-icon[data-v-fe5ee432]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:56px;height:56px;position:relative}.float-control-item-icon-container[data-v-fe5ee432]{border-radius:40px;width:40px;height:40px;margin:.5rem;cursor:pointer;display:flex;flex-direction:row;justify-content:center;align-items:center}.float-control-item-icon-container[data-v-fe5ee432]:hover{background:rgba(218,218,218,.3)}.tui-call-kit[data-v-516ff97a]{width:100%;height:100%;position:relative;border-radius:inherit}.calling-wrapper[data-v-516ff97a]{position:relative;width:100%;height:100%;border-radius:inherit;background:rgba(0,24,60,.7);backdrop-filter:blur(34px);display:flex;flex-direction:column;justify-content:center;overflow:hidden;z-index:12}.calling-wrapper[data-v-516ff97a]:hover{z-index:inherit;transition:all .5s ease-in-out}.dialing-wrapper[data-v-516ff97a]{background:#00183C;color:#fff;opacity:.7;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;border-radius:inherit;top:0;left:0;z-index:10;overflow:hidden}.dialing-local[data-v-516ff97a]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.dialing-content[data-v-516ff97a]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;position:relative;top:-3rem}#local-dialing[data-v-516ff97a],#local-group[data-v-516ff97a]{background:black;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWRhc2hhcnJheT0iMTUiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNSIKCQlzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTIiPgoJCTxhbmltYXRlIGZpbGw9ImZyZWV6ZSIgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIGR1cj0iMC4zcyIgdmFsdWVzPSIxNTswIiAvPgoJCTxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgZHVyPSIxLjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKCQkJdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgMTIgMTI7MzYwIDEyIDEyIiAvPgoJPC9wYXRoPgo8L3N2Zz4=);background-repeat:no-repeat;background-size:auto;background-position-x:center;background-position-y:calc(50% + 10px)}.dialing-user-id[data-v-516ff97a]{font-style:normal;font-weight:600;font-size:40px;width:100%;line-height:56px;display:flex;align-items:center;justify-content:center}.dialing-info[data-v-516ff97a]{font-style:normal;font-weight:400;font-size:14px;line-height:20px}.control-wrapper[data-v-516ff97a]{transform:translate(-50%);position:absolute;bottom:0;padding-bottom:40px;left:50%;width:100%;color:#fff;border-radius:inherit;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.4) 100%);display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;z-index:11;user-select:none}.panel-button-area[data-v-516ff97a]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin:30px 0}.panel-dialing-info[data-v-516ff97a]{text-align:center}.control-wrapper[data-v-516ff97a]:hover{z-index:13}.control-item[data-v-516ff97a]{display:flex;flex-direction:column;width:100px;margin:0 20px}.control-item-h5[data-v-516ff97a]{display:flex;flex-direction:column;width:100px;margin:0}.control-item-text[data-v-516ff97a]{margin-top:5px;white-space:nowrap;font-weight:400;font-size:14px;line-height:20px;text-align:center}.control-item-icon[data-v-516ff97a]{width:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;position:relative}.control-item-icon-container-small[data-v-516ff97a]{background:rgba(218,218,218,.3);border-radius:40px;width:40px;height:40px;margin:8px;cursor:pointer}.control-item-icon-container-medium[data-v-516ff97a]{background:rgba(0,0,0,.3);border-radius:56px;width:56px;height:56px;margin:8px;cursor:pointer}.control-item-icon-container-large[data-v-516ff97a]{background:rgba(0,0,0,.3);border-radius:68px;width:68px;height:68px;margin:8px;cursor:pointer}.control-item-summary[data-v-516ff97a]{height:40px;width:12px;right:0;display:flex;justify-content:center;align-items:center;cursor:pointer}.control-item-summary[data-v-516ff97a]:hover{background:rgba(0,0,0,.4)}.control-item-detail[data-v-516ff97a]{width:300px;border-radius:4px;background:#FEFEFF;box-shadow:#0000003d 0 3px 8px;color:#000;padding:20px;position:absolute;transform:translate(28px);bottom:110%}.control-item-detail-row[data-v-516ff97a]{margin-bottom:6px;font-size:16px}.device-select[data-v-516ff97a]{height:32px;width:100%;border:1px solid #DEE0E3;padding-left:6px;padding-top:6px;padding-bottom:6px;margin-top:10px;margin-bottom:10px;font-size:14px;color:#596174}.control-item-detail[data-v-516ff97a]:before{content:"";width:0;height:0;border-width:10px;border-style:solid;border-color:#FEFEFF transparent transparent;bottom:-3px;margin-left:-9px;position:absolute;left:50%;border-color:#fff;border-radius:4px;transform:rotate(60deg) skew(30deg)}.tag[data-v-516ff97a]{color:#fff;z-index:inherit;background:rgba(0,0,0,.6);padding:2px 10px;border-top-right-radius:inherit;border-bottom-left-radius:inherit;font-size:14px;position:absolute;left:0;bottom:0;z-index:11;display:flex;align-items:center}.tag .microphone-icon-container[data-v-516ff97a]{margin-left:0;margin-right:2px;width:20px;background-color:transparent}.switch-large-small[data-v-516ff97a]{position:absolute;right:12px;top:12px;width:16px;height:16px;z-index:inherit;cursor:pointer}.small-h5[data-v-516ff97a]{position:absolute;width:94px;height:160px;min-height:100px;max-height:60%;top:30px;right:10px;z-index:2;overflow:hidden;background:#000;border-radius:4px}.small[data-v-516ff97a]{position:absolute;width:260px;height:170px;min-height:100px;max-height:60%;top:30px;left:30px;z-index:2;overflow:hidden;resize:both;background:#000;border-radius:4px}.large[data-v-516ff97a]{min-height:100px;width:100%;height:100%;z-index:1;border-radius:inherit;overflow:hidden}.large .switch-large-small[data-v-516ff97a]{display:none}.group-calling-container[data-v-516ff97a]{width:100%;height:100%;display:flex;flex-wrap:wrap;justify-content:center}.group-user-view[data-v-516ff97a]{width:33.333%;height:33.333%;position:relative;background:rgba(32,32,32,.45);backdrop-filter:blur(34px);color:#fff;overflow:hidden}.user-view-text-container[data-v-516ff97a]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;display:flex;flex-direction:column;justify-content:center;align-items:center;transform:translateY(-20px)}.user-view-user-id[data-v-516ff97a]{font-family:PingFang SC;font-style:normal;font-weight:600;font-size:24px;line-height:34px}.user-view-info[data-v-516ff97a]{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:12px;line-height:17px}.page-turn[data-v-516ff97a]{width:40px;height:86px;border-radius:4.21px;background:rgba(0,0,0,.2);position:absolute;top:50%;transform:translateY(-50%);z-index:11;display:flex;justify-content:center;align-items:center;cursor:pointer}.turn-icon-container[data-v-516ff97a]{width:14px;height:23px}.right[data-v-516ff97a]{right:0}.microphone-icon-container[data-v-516ff97a]{width:24px;height:24px;background:rgba(0,0,0,.4);border-radius:12px;display:flex;justify-content:center;align-items:center;margin-left:8px}.group-user-view-1[data-v-516ff97a]{width:100%;height:100%}.group-calling-container-1[data-v-516ff97a]{height:100%}.group-user-view-2[data-v-516ff97a]{width:50%;height:100%}.group-calling-container-2[data-v-516ff97a]{height:50%}.group-user-view-3[data-v-516ff97a],.group-user-view-4[data-v-516ff97a]{width:50%;height:50%}.group-calling-container-3[data-v-516ff97a],.group-calling-container-4[data-v-516ff97a]{height:100%}.group-user-view-5[data-v-516ff97a],.group-user-view-6[data-v-516ff97a]{width:33.333%;height:50%}.group-calling-container-5[data-v-516ff97a],.group-calling-container-6[data-v-516ff97a]{height:66%}.user-view-user-id-1[data-v-516ff97a]{font-size:24px}.user-view-user-id-2[data-v-516ff97a],.user-view-user-id-3[data-v-516ff97a],.user-view-user-id-4[data-v-516ff97a]{font-size:22px}.user-view-user-id-5[data-v-516ff97a],.user-view-user-id-6[data-v-516ff97a],.user-view-user-id-7[data-v-516ff97a],.user-view-user-id-8[data-v-516ff97a],.user-view-user-id-9[data-v-516ff97a]{font-size:18px}.float-control-panel[data-v-516ff97a]{width:168px;height:56px;background:white;z-index:13;position:fixed;top:20px;right:20px;display:flex;flex-wrap:nowrap;justify-content:center;border-radius:40px;box-shadow:#00000029 0 3px 6px,#0000003b 0 3px 6px}.function-buttons[data-v-516ff97a]{position:absolute;right:12px;top:12px;z-index:13;cursor:pointer;display:flex;flex-direction:row;justify-content:flex-start}.minimize[data-v-516ff97a]{margin-left:10px}.float-control-item-icon[data-v-516ff97a]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:56px;height:56px;position:relative}.float-control-item-icon-container[data-v-516ff97a]{border-radius:40px;width:40px;height:40px;margin:.5rem;cursor:pointer;display:flex;flex-direction:row;justify-content:center;align-items:center}.float-control-item-icon-container[data-v-516ff97a]:hover{background:rgba(218,218,218,.3)}.tui-call-kit[data-v-974fb4e2]{width:100%;height:100%;position:relative;border-radius:inherit}.calling-wrapper[data-v-974fb4e2]{position:relative;width:100%;height:100%;border-radius:inherit;background:rgba(0,24,60,.7);backdrop-filter:blur(34px);display:flex;flex-direction:column;justify-content:center;overflow:hidden;z-index:12}.calling-wrapper[data-v-974fb4e2]:hover{z-index:inherit;transition:all .5s ease-in-out}.dialing-wrapper[data-v-974fb4e2]{background:#00183C;color:#fff;opacity:.7;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;border-radius:inherit;top:0;left:0;z-index:10;overflow:hidden}.dialing-local[data-v-974fb4e2]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.dialing-content[data-v-974fb4e2]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;position:relative;top:-3rem}#local-dialing[data-v-974fb4e2],#local-group[data-v-974fb4e2]{background:black;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWRhc2hhcnJheT0iMTUiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNSIKCQlzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTIiPgoJCTxhbmltYXRlIGZpbGw9ImZyZWV6ZSIgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIGR1cj0iMC4zcyIgdmFsdWVzPSIxNTswIiAvPgoJCTxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgZHVyPSIxLjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKCQkJdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgMTIgMTI7MzYwIDEyIDEyIiAvPgoJPC9wYXRoPgo8L3N2Zz4=);background-repeat:no-repeat;background-size:auto;background-position-x:center;background-position-y:calc(50% + 10px)}.dialing-user-id[data-v-974fb4e2]{font-style:normal;font-weight:600;font-size:40px;width:100%;line-height:56px;display:flex;align-items:center;justify-content:center}.dialing-info[data-v-974fb4e2]{font-style:normal;font-weight:400;font-size:14px;line-height:20px}.control-wrapper[data-v-974fb4e2]{transform:translate(-50%);position:absolute;bottom:0;padding-bottom:40px;left:50%;width:100%;color:#fff;border-radius:inherit;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.4) 100%);display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;z-index:11;user-select:none}.panel-button-area[data-v-974fb4e2]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin:30px 0}.panel-dialing-info[data-v-974fb4e2]{text-align:center}.control-wrapper[data-v-974fb4e2]:hover{z-index:13}.control-item[data-v-974fb4e2]{display:flex;flex-direction:column;width:100px;margin:0 20px}.control-item-h5[data-v-974fb4e2]{display:flex;flex-direction:column;width:100px;margin:0}.control-item-text[data-v-974fb4e2]{margin-top:5px;white-space:nowrap;font-weight:400;font-size:14px;line-height:20px;text-align:center}.control-item-icon[data-v-974fb4e2]{width:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;position:relative}.control-item-icon-container-small[data-v-974fb4e2]{background:rgba(218,218,218,.3);border-radius:40px;width:40px;height:40px;margin:8px;cursor:pointer}.control-item-icon-container-medium[data-v-974fb4e2]{background:rgba(0,0,0,.3);border-radius:56px;width:56px;height:56px;margin:8px;cursor:pointer}.control-item-icon-container-large[data-v-974fb4e2]{background:rgba(0,0,0,.3);border-radius:68px;width:68px;height:68px;margin:8px;cursor:pointer}.control-item-summary[data-v-974fb4e2]{height:40px;width:12px;right:0;display:flex;justify-content:center;align-items:center;cursor:pointer}.control-item-summary[data-v-974fb4e2]:hover{background:rgba(0,0,0,.4)}.control-item-detail[data-v-974fb4e2]{width:300px;border-radius:4px;background:#FEFEFF;box-shadow:#0000003d 0 3px 8px;color:#000;padding:20px;position:absolute;transform:translate(28px);bottom:110%}.control-item-detail-row[data-v-974fb4e2]{margin-bottom:6px;font-size:16px}.device-select[data-v-974fb4e2]{height:32px;width:100%;border:1px solid #DEE0E3;padding-left:6px;padding-top:6px;padding-bottom:6px;margin-top:10px;margin-bottom:10px;font-size:14px;color:#596174}.control-item-detail[data-v-974fb4e2]:before{content:"";width:0;height:0;border-width:10px;border-style:solid;border-color:#FEFEFF transparent transparent;bottom:-3px;margin-left:-9px;position:absolute;left:50%;border-color:#fff;border-radius:4px;transform:rotate(60deg) skew(30deg)}.tag[data-v-974fb4e2]{color:#fff;z-index:inherit;background:rgba(0,0,0,.6);padding:2px 10px;border-top-right-radius:inherit;border-bottom-left-radius:inherit;font-size:14px;position:absolute;left:0;bottom:0;z-index:11;display:flex;align-items:center}.tag .microphone-icon-container[data-v-974fb4e2]{margin-left:0;margin-right:2px;width:20px;background-color:transparent}.switch-large-small[data-v-974fb4e2]{position:absolute;right:12px;top:12px;width:16px;height:16px;z-index:inherit;cursor:pointer}.small-h5[data-v-974fb4e2]{position:absolute;width:94px;height:160px;min-height:100px;max-height:60%;top:30px;right:10px;z-index:2;overflow:hidden;background:#000;border-radius:4px}.small[data-v-974fb4e2]{position:absolute;width:260px;height:170px;min-height:100px;max-height:60%;top:30px;left:30px;z-index:2;overflow:hidden;resize:both;background:#000;border-radius:4px}.large[data-v-974fb4e2]{min-height:100px;width:100%;height:100%;z-index:1;border-radius:inherit;overflow:hidden}.large .switch-large-small[data-v-974fb4e2]{display:none}.group-calling-container[data-v-974fb4e2]{width:100%;height:100%;display:flex;flex-wrap:wrap;justify-content:center}.group-user-view[data-v-974fb4e2]{width:33.333%;height:33.333%;position:relative;background:rgba(32,32,32,.45);backdrop-filter:blur(34px);color:#fff;overflow:hidden}.user-view-text-container[data-v-974fb4e2]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;display:flex;flex-direction:column;justify-content:center;align-items:center;transform:translateY(-20px)}.user-view-user-id[data-v-974fb4e2]{font-family:PingFang SC;font-style:normal;font-weight:600;font-size:24px;line-height:34px}.user-view-info[data-v-974fb4e2]{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:12px;line-height:17px}.page-turn[data-v-974fb4e2]{width:40px;height:86px;border-radius:4.21px;background:rgba(0,0,0,.2);position:absolute;top:50%;transform:translateY(-50%);z-index:11;display:flex;justify-content:center;align-items:center;cursor:pointer}.turn-icon-container[data-v-974fb4e2]{width:14px;height:23px}.right[data-v-974fb4e2]{right:0}.microphone-icon-container[data-v-974fb4e2]{width:24px;height:24px;background:rgba(0,0,0,.4);border-radius:12px;display:flex;justify-content:center;align-items:center;margin-left:8px}.group-user-view-1[data-v-974fb4e2]{width:100%;height:100%}.group-calling-container-1[data-v-974fb4e2]{height:100%}.group-user-view-2[data-v-974fb4e2]{width:50%;height:100%}.group-calling-container-2[data-v-974fb4e2]{height:50%}.group-user-view-3[data-v-974fb4e2],.group-user-view-4[data-v-974fb4e2]{width:50%;height:50%}.group-calling-container-3[data-v-974fb4e2],.group-calling-container-4[data-v-974fb4e2]{height:100%}.group-user-view-5[data-v-974fb4e2],.group-user-view-6[data-v-974fb4e2]{width:33.333%;height:50%}.group-calling-container-5[data-v-974fb4e2],.group-calling-container-6[data-v-974fb4e2]{height:66%}.user-view-user-id-1[data-v-974fb4e2]{font-size:24px}.user-view-user-id-2[data-v-974fb4e2],.user-view-user-id-3[data-v-974fb4e2],.user-view-user-id-4[data-v-974fb4e2]{font-size:22px}.user-view-user-id-5[data-v-974fb4e2],.user-view-user-id-6[data-v-974fb4e2],.user-view-user-id-7[data-v-974fb4e2],.user-view-user-id-8[data-v-974fb4e2],.user-view-user-id-9[data-v-974fb4e2]{font-size:18px}.float-control-panel[data-v-974fb4e2]{width:168px;height:56px;background:white;z-index:13;position:fixed;top:20px;right:20px;display:flex;flex-wrap:nowrap;justify-content:center;border-radius:40px;box-shadow:#00000029 0 3px 6px,#0000003b 0 3px 6px}.function-buttons[data-v-974fb4e2]{position:absolute;right:12px;top:12px;z-index:13;cursor:pointer;display:flex;flex-direction:row;justify-content:flex-start}.minimize[data-v-974fb4e2]{margin-left:10px}.float-control-item-icon[data-v-974fb4e2]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:56px;height:56px;position:relative}.float-control-item-icon-container[data-v-974fb4e2]{border-radius:40px;width:40px;height:40px;margin:.5rem;cursor:pointer;display:flex;flex-direction:row;justify-content:center;align-items:center}.float-control-item-icon-container[data-v-974fb4e2]:hover{background:rgba(218,218,218,.3)}.tui-call-kit[data-v-b0f0172b]{width:100%;height:100%;position:relative;border-radius:inherit}.calling-wrapper[data-v-b0f0172b]{position:relative;width:100%;height:100%;border-radius:inherit;background:rgba(0,24,60,.7);backdrop-filter:blur(34px);display:flex;flex-direction:column;justify-content:center;overflow:hidden;z-index:12}.calling-wrapper[data-v-b0f0172b]:hover{z-index:inherit;transition:all .5s ease-in-out}.dialing-wrapper[data-v-b0f0172b]{background:#00183C;color:#fff;opacity:.7;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;border-radius:inherit;top:0;left:0;z-index:10;overflow:hidden}.dialing-local[data-v-b0f0172b]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.dialing-content[data-v-b0f0172b]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;position:relative;top:-3rem}#local-dialing[data-v-b0f0172b],#local-group[data-v-b0f0172b]{background:black;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWRhc2hhcnJheT0iMTUiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNSIKCQlzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTIiPgoJCTxhbmltYXRlIGZpbGw9ImZyZWV6ZSIgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIGR1cj0iMC4zcyIgdmFsdWVzPSIxNTswIiAvPgoJCTxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgZHVyPSIxLjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKCQkJdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgMTIgMTI7MzYwIDEyIDEyIiAvPgoJPC9wYXRoPgo8L3N2Zz4=);background-repeat:no-repeat;background-size:auto;background-position-x:center;background-position-y:calc(50% + 10px)}.dialing-user-id[data-v-b0f0172b]{font-style:normal;font-weight:600;font-size:40px;width:100%;line-height:56px;display:flex;align-items:center;justify-content:center}.dialing-info[data-v-b0f0172b]{font-style:normal;font-weight:400;font-size:14px;line-height:20px}.control-wrapper[data-v-b0f0172b]{transform:translate(-50%);position:absolute;bottom:0;padding-bottom:40px;left:50%;width:100%;color:#fff;border-radius:inherit;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.4) 100%);display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;z-index:11;user-select:none}.panel-button-area[data-v-b0f0172b]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin:30px 0}.panel-dialing-info[data-v-b0f0172b]{text-align:center}.control-wrapper[data-v-b0f0172b]:hover{z-index:13}.control-item[data-v-b0f0172b]{display:flex;flex-direction:column;width:100px;margin:0 20px}.control-item-h5[data-v-b0f0172b]{display:flex;flex-direction:column;width:100px;margin:0}.control-item-text[data-v-b0f0172b]{margin-top:5px;white-space:nowrap;font-weight:400;font-size:14px;line-height:20px;text-align:center}.control-item-icon[data-v-b0f0172b]{width:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;position:relative}.control-item-icon-container-small[data-v-b0f0172b]{background:rgba(218,218,218,.3);border-radius:40px;width:40px;height:40px;margin:8px;cursor:pointer}.control-item-icon-container-medium[data-v-b0f0172b]{background:rgba(0,0,0,.3);border-radius:56px;width:56px;height:56px;margin:8px;cursor:pointer}.control-item-icon-container-large[data-v-b0f0172b]{background:rgba(0,0,0,.3);border-radius:68px;width:68px;height:68px;margin:8px;cursor:pointer}.control-item-summary[data-v-b0f0172b]{height:40px;width:12px;right:0;display:flex;justify-content:center;align-items:center;cursor:pointer}.control-item-summary[data-v-b0f0172b]:hover{background:rgba(0,0,0,.4)}.control-item-detail[data-v-b0f0172b]{width:300px;border-radius:4px;background:#FEFEFF;box-shadow:#0000003d 0 3px 8px;color:#000;padding:20px;position:absolute;transform:translate(28px);bottom:110%}.control-item-detail-row[data-v-b0f0172b]{margin-bottom:6px;font-size:16px}.device-select[data-v-b0f0172b]{height:32px;width:100%;border:1px solid #DEE0E3;padding-left:6px;padding-top:6px;padding-bottom:6px;margin-top:10px;margin-bottom:10px;font-size:14px;color:#596174}.control-item-detail[data-v-b0f0172b]:before{content:"";width:0;height:0;border-width:10px;border-style:solid;border-color:#FEFEFF transparent transparent;bottom:-3px;margin-left:-9px;position:absolute;left:50%;border-color:#fff;border-radius:4px;transform:rotate(60deg) skew(30deg)}.tag[data-v-b0f0172b]{color:#fff;z-index:inherit;background:rgba(0,0,0,.6);padding:2px 10px;border-top-right-radius:inherit;border-bottom-left-radius:inherit;font-size:14px;position:absolute;left:0;bottom:0;z-index:11;display:flex;align-items:center}.tag .microphone-icon-container[data-v-b0f0172b]{margin-left:0;margin-right:2px;width:20px;background-color:transparent}.switch-large-small[data-v-b0f0172b]{position:absolute;right:12px;top:12px;width:16px;height:16px;z-index:inherit;cursor:pointer}.small-h5[data-v-b0f0172b]{position:absolute;width:94px;height:160px;min-height:100px;max-height:60%;top:30px;right:10px;z-index:2;overflow:hidden;background:#000;border-radius:4px}.small[data-v-b0f0172b]{position:absolute;width:260px;height:170px;min-height:100px;max-height:60%;top:30px;left:30px;z-index:2;overflow:hidden;resize:both;background:#000;border-radius:4px}.large[data-v-b0f0172b]{min-height:100px;width:100%;height:100%;z-index:1;border-radius:inherit;overflow:hidden}.large .switch-large-small[data-v-b0f0172b]{display:none}.group-calling-container[data-v-b0f0172b]{width:100%;height:100%;display:flex;flex-wrap:wrap;justify-content:center}.group-user-view[data-v-b0f0172b]{width:33.333%;height:33.333%;position:relative;background:rgba(32,32,32,.45);backdrop-filter:blur(34px);color:#fff;overflow:hidden}.user-view-text-container[data-v-b0f0172b]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;display:flex;flex-direction:column;justify-content:center;align-items:center;transform:translateY(-20px)}.user-view-user-id[data-v-b0f0172b]{font-family:PingFang SC;font-style:normal;font-weight:600;font-size:24px;line-height:34px}.user-view-info[data-v-b0f0172b]{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:12px;line-height:17px}.page-turn[data-v-b0f0172b]{width:40px;height:86px;border-radius:4.21px;background:rgba(0,0,0,.2);position:absolute;top:50%;transform:translateY(-50%);z-index:11;display:flex;justify-content:center;align-items:center;cursor:pointer}.turn-icon-container[data-v-b0f0172b]{width:14px;height:23px}.right[data-v-b0f0172b]{right:0}.microphone-icon-container[data-v-b0f0172b]{width:24px;height:24px;background:rgba(0,0,0,.4);border-radius:12px;display:flex;justify-content:center;align-items:center;margin-left:8px}.group-user-view-1[data-v-b0f0172b]{width:100%;height:100%}.group-calling-container-1[data-v-b0f0172b]{height:100%}.group-user-view-2[data-v-b0f0172b]{width:50%;height:100%}.group-calling-container-2[data-v-b0f0172b]{height:50%}.group-user-view-3[data-v-b0f0172b],.group-user-view-4[data-v-b0f0172b]{width:50%;height:50%}.group-calling-container-3[data-v-b0f0172b],.group-calling-container-4[data-v-b0f0172b]{height:100%}.group-user-view-5[data-v-b0f0172b],.group-user-view-6[data-v-b0f0172b]{width:33.333%;height:50%}.group-calling-container-5[data-v-b0f0172b],.group-calling-container-6[data-v-b0f0172b]{height:66%}.user-view-user-id-1[data-v-b0f0172b]{font-size:24px}.user-view-user-id-2[data-v-b0f0172b],.user-view-user-id-3[data-v-b0f0172b],.user-view-user-id-4[data-v-b0f0172b]{font-size:22px}.user-view-user-id-5[data-v-b0f0172b],.user-view-user-id-6[data-v-b0f0172b],.user-view-user-id-7[data-v-b0f0172b],.user-view-user-id-8[data-v-b0f0172b],.user-view-user-id-9[data-v-b0f0172b]{font-size:18px}.float-control-panel[data-v-b0f0172b]{width:168px;height:56px;background:white;z-index:13;position:fixed;top:20px;right:20px;display:flex;flex-wrap:nowrap;justify-content:center;border-radius:40px;box-shadow:#00000029 0 3px 6px,#0000003b 0 3px 6px}.function-buttons[data-v-b0f0172b]{position:absolute;right:12px;top:12px;z-index:13;cursor:pointer;display:flex;flex-direction:row;justify-content:flex-start}.minimize[data-v-b0f0172b]{margin-left:10px}.float-control-item-icon[data-v-b0f0172b]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:56px;height:56px;position:relative}.float-control-item-icon-container[data-v-b0f0172b]{border-radius:40px;width:40px;height:40px;margin:.5rem;cursor:pointer;display:flex;flex-direction:row;justify-content:center;align-items:center}.float-control-item-icon-container[data-v-b0f0172b]:hover{background:rgba(218,218,218,.3)}.tui-call-kit[data-v-f5cadefc]{width:100%;height:100%;position:relative;border-radius:inherit}.calling-wrapper[data-v-f5cadefc]{position:relative;width:100%;height:100%;border-radius:inherit;background:rgba(0,24,60,.7);backdrop-filter:blur(34px);display:flex;flex-direction:column;justify-content:center;overflow:hidden;z-index:12}.calling-wrapper[data-v-f5cadefc]:hover{z-index:inherit;transition:all .5s ease-in-out}.dialing-wrapper[data-v-f5cadefc]{background:#00183C;color:#fff;opacity:.7;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;border-radius:inherit;top:0;left:0;z-index:10;overflow:hidden}.dialing-local[data-v-f5cadefc]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.dialing-content[data-v-f5cadefc]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;position:relative;top:-3rem}#local-dialing[data-v-f5cadefc],#local-group[data-v-f5cadefc]{background:black;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWRhc2hhcnJheT0iMTUiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNSIKCQlzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTIiPgoJCTxhbmltYXRlIGZpbGw9ImZyZWV6ZSIgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIGR1cj0iMC4zcyIgdmFsdWVzPSIxNTswIiAvPgoJCTxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgZHVyPSIxLjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKCQkJdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgMTIgMTI7MzYwIDEyIDEyIiAvPgoJPC9wYXRoPgo8L3N2Zz4=);background-repeat:no-repeat;background-size:auto;background-position-x:center;background-position-y:calc(50% + 10px)}.dialing-user-id[data-v-f5cadefc]{font-style:normal;font-weight:600;font-size:40px;width:100%;line-height:56px;display:flex;align-items:center;justify-content:center}.dialing-info[data-v-f5cadefc]{font-style:normal;font-weight:400;font-size:14px;line-height:20px}.control-wrapper[data-v-f5cadefc]{transform:translate(-50%);position:absolute;bottom:0;padding-bottom:40px;left:50%;width:100%;color:#fff;border-radius:inherit;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.4) 100%);display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;z-index:11;user-select:none}.panel-button-area[data-v-f5cadefc]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin:30px 0}.panel-dialing-info[data-v-f5cadefc]{text-align:center}.control-wrapper[data-v-f5cadefc]:hover{z-index:13}.control-item[data-v-f5cadefc]{display:flex;flex-direction:column;width:100px;margin:0 20px}.control-item-h5[data-v-f5cadefc]{display:flex;flex-direction:column;width:100px;margin:0}.control-item-text[data-v-f5cadefc]{margin-top:5px;white-space:nowrap;font-weight:400;font-size:14px;line-height:20px;text-align:center}.control-item-icon[data-v-f5cadefc]{width:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;position:relative}.control-item-icon-container-small[data-v-f5cadefc]{background:rgba(218,218,218,.3);border-radius:40px;width:40px;height:40px;margin:8px;cursor:pointer}.control-item-icon-container-medium[data-v-f5cadefc]{background:rgba(0,0,0,.3);border-radius:56px;width:56px;height:56px;margin:8px;cursor:pointer}.control-item-icon-container-large[data-v-f5cadefc]{background:rgba(0,0,0,.3);border-radius:68px;width:68px;height:68px;margin:8px;cursor:pointer}.control-item-summary[data-v-f5cadefc]{height:40px;width:12px;right:0;display:flex;justify-content:center;align-items:center;cursor:pointer}.control-item-summary[data-v-f5cadefc]:hover{background:rgba(0,0,0,.4)}.control-item-detail[data-v-f5cadefc]{width:300px;border-radius:4px;background:#FEFEFF;box-shadow:#0000003d 0 3px 8px;color:#000;padding:20px;position:absolute;transform:translate(28px);bottom:110%}.control-item-detail-row[data-v-f5cadefc]{margin-bottom:6px;font-size:16px}.device-select[data-v-f5cadefc]{height:32px;width:100%;border:1px solid #DEE0E3;padding-left:6px;padding-top:6px;padding-bottom:6px;margin-top:10px;margin-bottom:10px;font-size:14px;color:#596174}.control-item-detail[data-v-f5cadefc]:before{content:"";width:0;height:0;border-width:10px;border-style:solid;border-color:#FEFEFF transparent transparent;bottom:-3px;margin-left:-9px;position:absolute;left:50%;border-color:#fff;border-radius:4px;transform:rotate(60deg) skew(30deg)}.tag[data-v-f5cadefc]{color:#fff;z-index:inherit;background:rgba(0,0,0,.6);padding:2px 10px;border-top-right-radius:inherit;border-bottom-left-radius:inherit;font-size:14px;position:absolute;left:0;bottom:0;z-index:11;display:flex;align-items:center}.tag .microphone-icon-container[data-v-f5cadefc]{margin-left:0;margin-right:2px;width:20px;background-color:transparent}.switch-large-small[data-v-f5cadefc]{position:absolute;right:12px;top:12px;width:16px;height:16px;z-index:inherit;cursor:pointer}.small-h5[data-v-f5cadefc]{position:absolute;width:94px;height:160px;min-height:100px;max-height:60%;top:30px;right:10px;z-index:2;overflow:hidden;background:#000;border-radius:4px}.small[data-v-f5cadefc]{position:absolute;width:260px;height:170px;min-height:100px;max-height:60%;top:30px;left:30px;z-index:2;overflow:hidden;resize:both;background:#000;border-radius:4px}.large[data-v-f5cadefc]{min-height:100px;width:100%;height:100%;z-index:1;border-radius:inherit;overflow:hidden}.large .switch-large-small[data-v-f5cadefc]{display:none}.group-calling-container[data-v-f5cadefc]{width:100%;height:100%;display:flex;flex-wrap:wrap;justify-content:center}.group-user-view[data-v-f5cadefc]{width:33.333%;height:33.333%;position:relative;background:rgba(32,32,32,.45);backdrop-filter:blur(34px);color:#fff;overflow:hidden}.user-view-text-container[data-v-f5cadefc]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;display:flex;flex-direction:column;justify-content:center;align-items:center;transform:translateY(-20px)}.user-view-user-id[data-v-f5cadefc]{font-family:PingFang SC;font-style:normal;font-weight:600;font-size:24px;line-height:34px}.user-view-info[data-v-f5cadefc]{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:12px;line-height:17px}.page-turn[data-v-f5cadefc]{width:40px;height:86px;border-radius:4.21px;background:rgba(0,0,0,.2);position:absolute;top:50%;transform:translateY(-50%);z-index:11;display:flex;justify-content:center;align-items:center;cursor:pointer}.turn-icon-container[data-v-f5cadefc]{width:14px;height:23px}.right[data-v-f5cadefc]{right:0}.microphone-icon-container[data-v-f5cadefc]{width:24px;height:24px;background:rgba(0,0,0,.4);border-radius:12px;display:flex;justify-content:center;align-items:center;margin-left:8px}.group-user-view-1[data-v-f5cadefc]{width:100%;height:100%}.group-calling-container-1[data-v-f5cadefc]{height:100%}.group-user-view-2[data-v-f5cadefc]{width:50%;height:100%}.group-calling-container-2[data-v-f5cadefc]{height:50%}.group-user-view-3[data-v-f5cadefc],.group-user-view-4[data-v-f5cadefc]{width:50%;height:50%}.group-calling-container-3[data-v-f5cadefc],.group-calling-container-4[data-v-f5cadefc]{height:100%}.group-user-view-5[data-v-f5cadefc],.group-user-view-6[data-v-f5cadefc]{width:33.333%;height:50%}.group-calling-container-5[data-v-f5cadefc],.group-calling-container-6[data-v-f5cadefc]{height:66%}.user-view-user-id-1[data-v-f5cadefc]{font-size:24px}.user-view-user-id-2[data-v-f5cadefc],.user-view-user-id-3[data-v-f5cadefc],.user-view-user-id-4[data-v-f5cadefc]{font-size:22px}.user-view-user-id-5[data-v-f5cadefc],.user-view-user-id-6[data-v-f5cadefc],.user-view-user-id-7[data-v-f5cadefc],.user-view-user-id-8[data-v-f5cadefc],.user-view-user-id-9[data-v-f5cadefc]{font-size:18px}.float-control-panel[data-v-f5cadefc]{width:168px;height:56px;background:white;z-index:13;position:fixed;top:20px;right:20px;display:flex;flex-wrap:nowrap;justify-content:center;border-radius:40px;box-shadow:#00000029 0 3px 6px,#0000003b 0 3px 6px}.function-buttons[data-v-f5cadefc]{position:absolute;right:12px;top:12px;z-index:13;cursor:pointer;display:flex;flex-direction:row;justify-content:flex-start}.minimize[data-v-f5cadefc]{margin-left:10px}.float-control-item-icon[data-v-f5cadefc]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:56px;height:56px;position:relative}.float-control-item-icon-container[data-v-f5cadefc]{border-radius:40px;width:40px;height:40px;margin:.5rem;cursor:pointer;display:flex;flex-direction:row;justify-content:center;align-items:center}.float-control-item-icon-container[data-v-f5cadefc]:hover{background:rgba(218,218,218,.3)}.tui-call-kit[data-v-be0037c8]{width:100%;height:100%;position:relative;border-radius:inherit}.calling-wrapper[data-v-be0037c8]{position:relative;width:100%;height:100%;border-radius:inherit;background:rgba(0,24,60,.7);backdrop-filter:blur(34px);display:flex;flex-direction:column;justify-content:center;overflow:hidden;z-index:12}.calling-wrapper[data-v-be0037c8]:hover{z-index:inherit;transition:all .5s ease-in-out}.dialing-wrapper[data-v-be0037c8]{background:#00183C;color:#fff;opacity:.7;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;border-radius:inherit;top:0;left:0;z-index:10;overflow:hidden}.dialing-local[data-v-be0037c8]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.dialing-content[data-v-be0037c8]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;position:relative;top:-3rem}#local-dialing[data-v-be0037c8],#local-group[data-v-be0037c8]{background:black;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWRhc2hhcnJheT0iMTUiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNSIKCQlzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTIiPgoJCTxhbmltYXRlIGZpbGw9ImZyZWV6ZSIgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIGR1cj0iMC4zcyIgdmFsdWVzPSIxNTswIiAvPgoJCTxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgZHVyPSIxLjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKCQkJdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgMTIgMTI7MzYwIDEyIDEyIiAvPgoJPC9wYXRoPgo8L3N2Zz4=);background-repeat:no-repeat;background-size:auto;background-position-x:center;background-position-y:calc(50% + 10px)}.dialing-user-id[data-v-be0037c8]{font-style:normal;font-weight:600;font-size:40px;width:100%;line-height:56px;display:flex;align-items:center;justify-content:center}.dialing-info[data-v-be0037c8]{font-style:normal;font-weight:400;font-size:14px;line-height:20px}.control-wrapper[data-v-be0037c8]{transform:translate(-50%);position:absolute;bottom:0;padding-bottom:40px;left:50%;width:100%;color:#fff;border-radius:inherit;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.4) 100%);display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;z-index:11;user-select:none}.panel-button-area[data-v-be0037c8]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin:30px 0}.panel-dialing-info[data-v-be0037c8]{text-align:center}.control-wrapper[data-v-be0037c8]:hover{z-index:13}.control-item[data-v-be0037c8]{display:flex;flex-direction:column;width:100px;margin:0 20px}.control-item-h5[data-v-be0037c8]{display:flex;flex-direction:column;width:100px;margin:0}.control-item-text[data-v-be0037c8]{margin-top:5px;white-space:nowrap;font-weight:400;font-size:14px;line-height:20px;text-align:center}.control-item-icon[data-v-be0037c8]{width:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;position:relative}.control-item-icon-container-small[data-v-be0037c8]{background:rgba(218,218,218,.3);border-radius:40px;width:40px;height:40px;margin:8px;cursor:pointer}.control-item-icon-container-medium[data-v-be0037c8]{background:rgba(0,0,0,.3);border-radius:56px;width:56px;height:56px;margin:8px;cursor:pointer}.control-item-icon-container-large[data-v-be0037c8]{background:rgba(0,0,0,.3);border-radius:68px;width:68px;height:68px;margin:8px;cursor:pointer}.control-item-summary[data-v-be0037c8]{height:40px;width:12px;right:0;display:flex;justify-content:center;align-items:center;cursor:pointer}.control-item-summary[data-v-be0037c8]:hover{background:rgba(0,0,0,.4)}.control-item-detail[data-v-be0037c8]{width:300px;border-radius:4px;background:#FEFEFF;box-shadow:#0000003d 0 3px 8px;color:#000;padding:20px;position:absolute;transform:translate(28px);bottom:110%}.control-item-detail-row[data-v-be0037c8]{margin-bottom:6px;font-size:16px}.device-select[data-v-be0037c8]{height:32px;width:100%;border:1px solid #DEE0E3;padding-left:6px;padding-top:6px;padding-bottom:6px;margin-top:10px;margin-bottom:10px;font-size:14px;color:#596174}.control-item-detail[data-v-be0037c8]:before{content:"";width:0;height:0;border-width:10px;border-style:solid;border-color:#FEFEFF transparent transparent;bottom:-3px;margin-left:-9px;position:absolute;left:50%;border-color:#fff;border-radius:4px;transform:rotate(60deg) skew(30deg)}.tag[data-v-be0037c8]{color:#fff;z-index:inherit;background:rgba(0,0,0,.6);padding:2px 10px;border-top-right-radius:inherit;border-bottom-left-radius:inherit;font-size:14px;position:absolute;left:0;bottom:0;z-index:11;display:flex;align-items:center}.tag .microphone-icon-container[data-v-be0037c8]{margin-left:0;margin-right:2px;width:20px;background-color:transparent}.switch-large-small[data-v-be0037c8]{position:absolute;right:12px;top:12px;width:16px;height:16px;z-index:inherit;cursor:pointer}.small-h5[data-v-be0037c8]{position:absolute;width:94px;height:160px;min-height:100px;max-height:60%;top:30px;right:10px;z-index:2;overflow:hidden;background:#000;border-radius:4px}.small[data-v-be0037c8]{position:absolute;width:260px;height:170px;min-height:100px;max-height:60%;top:30px;left:30px;z-index:2;overflow:hidden;resize:both;background:#000;border-radius:4px}.large[data-v-be0037c8]{min-height:100px;width:100%;height:100%;z-index:1;border-radius:inherit;overflow:hidden}.large .switch-large-small[data-v-be0037c8]{display:none}.group-calling-container[data-v-be0037c8]{width:100%;height:100%;display:flex;flex-wrap:wrap;justify-content:center}.group-user-view[data-v-be0037c8]{width:33.333%;height:33.333%;position:relative;background:rgba(32,32,32,.45);backdrop-filter:blur(34px);color:#fff;overflow:hidden}.user-view-text-container[data-v-be0037c8]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;display:flex;flex-direction:column;justify-content:center;align-items:center;transform:translateY(-20px)}.user-view-user-id[data-v-be0037c8]{font-family:PingFang SC;font-style:normal;font-weight:600;font-size:24px;line-height:34px}.user-view-info[data-v-be0037c8]{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:12px;line-height:17px}.page-turn[data-v-be0037c8]{width:40px;height:86px;border-radius:4.21px;background:rgba(0,0,0,.2);position:absolute;top:50%;transform:translateY(-50%);z-index:11;display:flex;justify-content:center;align-items:center;cursor:pointer}.turn-icon-container[data-v-be0037c8]{width:14px;height:23px}.right[data-v-be0037c8]{right:0}.microphone-icon-container[data-v-be0037c8]{width:24px;height:24px;background:rgba(0,0,0,.4);border-radius:12px;display:flex;justify-content:center;align-items:center;margin-left:8px}.group-user-view-1[data-v-be0037c8]{width:100%;height:100%}.group-calling-container-1[data-v-be0037c8]{height:100%}.group-user-view-2[data-v-be0037c8]{width:50%;height:100%}.group-calling-container-2[data-v-be0037c8]{height:50%}.group-user-view-3[data-v-be0037c8],.group-user-view-4[data-v-be0037c8]{width:50%;height:50%}.group-calling-container-3[data-v-be0037c8],.group-calling-container-4[data-v-be0037c8]{height:100%}.group-user-view-5[data-v-be0037c8],.group-user-view-6[data-v-be0037c8]{width:33.333%;height:50%}.group-calling-container-5[data-v-be0037c8],.group-calling-container-6[data-v-be0037c8]{height:66%}.user-view-user-id-1[data-v-be0037c8]{font-size:24px}.user-view-user-id-2[data-v-be0037c8],.user-view-user-id-3[data-v-be0037c8],.user-view-user-id-4[data-v-be0037c8]{font-size:22px}.user-view-user-id-5[data-v-be0037c8],.user-view-user-id-6[data-v-be0037c8],.user-view-user-id-7[data-v-be0037c8],.user-view-user-id-8[data-v-be0037c8],.user-view-user-id-9[data-v-be0037c8]{font-size:18px}.float-control-panel[data-v-be0037c8]{width:168px;height:56px;background:white;z-index:13;position:fixed;top:20px;right:20px;display:flex;flex-wrap:nowrap;justify-content:center;border-radius:40px;box-shadow:#00000029 0 3px 6px,#0000003b 0 3px 6px}.function-buttons[data-v-be0037c8]{position:absolute;right:12px;top:12px;z-index:13;cursor:pointer;display:flex;flex-direction:row;justify-content:flex-start}.minimize[data-v-be0037c8]{margin-left:10px}.float-control-item-icon[data-v-be0037c8]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:56px;height:56px;position:relative}.float-control-item-icon-container[data-v-be0037c8]{border-radius:40px;width:40px;height:40px;margin:.5rem;cursor:pointer;display:flex;flex-direction:row;justify-content:center;align-items:center}.float-control-item-icon-container[data-v-be0037c8]:hover{background:rgba(218,218,218,.3)}.tui-call-kit[data-v-e5973e5d]{width:100%;height:100%;position:relative;border-radius:inherit}.calling-wrapper[data-v-e5973e5d]{position:relative;width:100%;height:100%;border-radius:inherit;background:rgba(0,24,60,.7);backdrop-filter:blur(34px);display:flex;flex-direction:column;justify-content:center;overflow:hidden;z-index:12}.calling-wrapper[data-v-e5973e5d]:hover{z-index:inherit;transition:all .5s ease-in-out}.dialing-wrapper[data-v-e5973e5d]{background:#00183C;color:#fff;opacity:.7;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;border-radius:inherit;top:0;left:0;z-index:10;overflow:hidden}.dialing-local[data-v-e5973e5d]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.dialing-content[data-v-e5973e5d]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;position:relative;top:-3rem}#local-dialing[data-v-e5973e5d],#local-group[data-v-e5973e5d]{background:black;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWRhc2hhcnJheT0iMTUiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNSIKCQlzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTIiPgoJCTxhbmltYXRlIGZpbGw9ImZyZWV6ZSIgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIGR1cj0iMC4zcyIgdmFsdWVzPSIxNTswIiAvPgoJCTxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgZHVyPSIxLjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKCQkJdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgMTIgMTI7MzYwIDEyIDEyIiAvPgoJPC9wYXRoPgo8L3N2Zz4=);background-repeat:no-repeat;background-size:auto;background-position-x:center;background-position-y:calc(50% + 10px)}.dialing-user-id[data-v-e5973e5d]{font-style:normal;font-weight:600;font-size:40px;width:100%;line-height:56px;display:flex;align-items:center;justify-content:center}.dialing-info[data-v-e5973e5d]{font-style:normal;font-weight:400;font-size:14px;line-height:20px}.control-wrapper[data-v-e5973e5d]{transform:translate(-50%);position:absolute;bottom:0;padding-bottom:40px;left:50%;width:100%;color:#fff;border-radius:inherit;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.4) 100%);display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;z-index:11;user-select:none}.panel-button-area[data-v-e5973e5d]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin:30px 0}.panel-dialing-info[data-v-e5973e5d]{text-align:center}.control-wrapper[data-v-e5973e5d]:hover{z-index:13}.control-item[data-v-e5973e5d]{display:flex;flex-direction:column;width:100px;margin:0 20px}.control-item-h5[data-v-e5973e5d]{display:flex;flex-direction:column;width:100px;margin:0}.control-item-text[data-v-e5973e5d]{margin-top:5px;white-space:nowrap;font-weight:400;font-size:14px;line-height:20px;text-align:center}.control-item-icon[data-v-e5973e5d]{width:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;position:relative}.control-item-icon-container-small[data-v-e5973e5d]{background:rgba(218,218,218,.3);border-radius:40px;width:40px;height:40px;margin:8px;cursor:pointer}.control-item-icon-container-medium[data-v-e5973e5d]{background:rgba(0,0,0,.3);border-radius:56px;width:56px;height:56px;margin:8px;cursor:pointer}.control-item-icon-container-large[data-v-e5973e5d]{background:rgba(0,0,0,.3);border-radius:68px;width:68px;height:68px;margin:8px;cursor:pointer}.control-item-summary[data-v-e5973e5d]{height:40px;width:12px;right:0;display:flex;justify-content:center;align-items:center;cursor:pointer}.control-item-summary[data-v-e5973e5d]:hover{background:rgba(0,0,0,.4)}.control-item-detail[data-v-e5973e5d]{width:300px;border-radius:4px;background:#FEFEFF;box-shadow:#0000003d 0 3px 8px;color:#000;padding:20px;position:absolute;transform:translate(28px);bottom:110%}.control-item-detail-row[data-v-e5973e5d]{margin-bottom:6px;font-size:16px}.device-select[data-v-e5973e5d]{height:32px;width:100%;border:1px solid #DEE0E3;padding-left:6px;padding-top:6px;padding-bottom:6px;margin-top:10px;margin-bottom:10px;font-size:14px;color:#596174}.control-item-detail[data-v-e5973e5d]:before{content:"";width:0;height:0;border-width:10px;border-style:solid;border-color:#FEFEFF transparent transparent;bottom:-3px;margin-left:-9px;position:absolute;left:50%;border-color:#fff;border-radius:4px;transform:rotate(60deg) skew(30deg)}.tag[data-v-e5973e5d]{color:#fff;z-index:inherit;background:rgba(0,0,0,.6);padding:2px 10px;border-top-right-radius:inherit;border-bottom-left-radius:inherit;font-size:14px;position:absolute;left:0;bottom:0;z-index:11;display:flex;align-items:center}.tag .microphone-icon-container[data-v-e5973e5d]{margin-left:0;margin-right:2px;width:20px;background-color:transparent}.switch-large-small[data-v-e5973e5d]{position:absolute;right:12px;top:12px;width:16px;height:16px;z-index:inherit;cursor:pointer}.small-h5[data-v-e5973e5d]{position:absolute;width:94px;height:160px;min-height:100px;max-height:60%;top:30px;right:10px;z-index:2;overflow:hidden;background:#000;border-radius:4px}.small[data-v-e5973e5d]{position:absolute;width:260px;height:170px;min-height:100px;max-height:60%;top:30px;left:30px;z-index:2;overflow:hidden;resize:both;background:#000;border-radius:4px}.large[data-v-e5973e5d]{min-height:100px;width:100%;height:100%;z-index:1;border-radius:inherit;overflow:hidden}.large .switch-large-small[data-v-e5973e5d]{display:none}.group-calling-container[data-v-e5973e5d]{width:100%;height:100%;display:flex;flex-wrap:wrap;justify-content:center}.group-user-view[data-v-e5973e5d]{width:33.333%;height:33.333%;position:relative;background:rgba(32,32,32,.45);backdrop-filter:blur(34px);color:#fff;overflow:hidden}.user-view-text-container[data-v-e5973e5d]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;display:flex;flex-direction:column;justify-content:center;align-items:center;transform:translateY(-20px)}.user-view-user-id[data-v-e5973e5d]{font-family:PingFang SC;font-style:normal;font-weight:600;font-size:24px;line-height:34px}.user-view-info[data-v-e5973e5d]{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:12px;line-height:17px}.page-turn[data-v-e5973e5d]{width:40px;height:86px;border-radius:4.21px;background:rgba(0,0,0,.2);position:absolute;top:50%;transform:translateY(-50%);z-index:11;display:flex;justify-content:center;align-items:center;cursor:pointer}.turn-icon-container[data-v-e5973e5d]{width:14px;height:23px}.right[data-v-e5973e5d]{right:0}.microphone-icon-container[data-v-e5973e5d]{width:24px;height:24px;background:rgba(0,0,0,.4);border-radius:12px;display:flex;justify-content:center;align-items:center;margin-left:8px}.group-user-view-1[data-v-e5973e5d]{width:100%;height:100%}.group-calling-container-1[data-v-e5973e5d]{height:100%}.group-user-view-2[data-v-e5973e5d]{width:50%;height:100%}.group-calling-container-2[data-v-e5973e5d]{height:50%}.group-user-view-3[data-v-e5973e5d],.group-user-view-4[data-v-e5973e5d]{width:50%;height:50%}.group-calling-container-3[data-v-e5973e5d],.group-calling-container-4[data-v-e5973e5d]{height:100%}.group-user-view-5[data-v-e5973e5d],.group-user-view-6[data-v-e5973e5d]{width:33.333%;height:50%}.group-calling-container-5[data-v-e5973e5d],.group-calling-container-6[data-v-e5973e5d]{height:66%}.user-view-user-id-1[data-v-e5973e5d]{font-size:24px}.user-view-user-id-2[data-v-e5973e5d],.user-view-user-id-3[data-v-e5973e5d],.user-view-user-id-4[data-v-e5973e5d]{font-size:22px}.user-view-user-id-5[data-v-e5973e5d],.user-view-user-id-6[data-v-e5973e5d],.user-view-user-id-7[data-v-e5973e5d],.user-view-user-id-8[data-v-e5973e5d],.user-view-user-id-9[data-v-e5973e5d]{font-size:18px}.float-control-panel[data-v-e5973e5d]{width:168px;height:56px;background:white;z-index:13;position:fixed;top:20px;right:20px;display:flex;flex-wrap:nowrap;justify-content:center;border-radius:40px;box-shadow:#00000029 0 3px 6px,#0000003b 0 3px 6px}.function-buttons[data-v-e5973e5d]{position:absolute;right:12px;top:12px;z-index:13;cursor:pointer;display:flex;flex-direction:row;justify-content:flex-start}.minimize[data-v-e5973e5d]{margin-left:10px}.float-control-item-icon[data-v-e5973e5d]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:56px;height:56px;position:relative}.float-control-item-icon-container[data-v-e5973e5d]{border-radius:40px;width:40px;height:40px;margin:.5rem;cursor:pointer;display:flex;flex-direction:row;justify-content:center;align-items:center}.float-control-item-icon-container[data-v-e5973e5d]:hover{background:rgba(218,218,218,.3)}.tui-call-kit[data-v-9c84be0f]{width:100%;height:100%;position:relative;border-radius:inherit}.calling-wrapper[data-v-9c84be0f]{position:relative;width:100%;height:100%;border-radius:inherit;background:rgba(0,24,60,.7);backdrop-filter:blur(34px);display:flex;flex-direction:column;justify-content:center;overflow:hidden;z-index:12}.calling-wrapper[data-v-9c84be0f]:hover{z-index:inherit;transition:all .5s ease-in-out}.dialing-wrapper[data-v-9c84be0f]{background:#00183C;color:#fff;opacity:.7;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;border-radius:inherit;top:0;left:0;z-index:10;overflow:hidden}.dialing-local[data-v-9c84be0f]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.dialing-content[data-v-9c84be0f]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;position:relative;top:-3rem}#local-dialing[data-v-9c84be0f],#local-group[data-v-9c84be0f]{background:black;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWRhc2hhcnJheT0iMTUiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNSIKCQlzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTIiPgoJCTxhbmltYXRlIGZpbGw9ImZyZWV6ZSIgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIGR1cj0iMC4zcyIgdmFsdWVzPSIxNTswIiAvPgoJCTxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgZHVyPSIxLjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKCQkJdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgMTIgMTI7MzYwIDEyIDEyIiAvPgoJPC9wYXRoPgo8L3N2Zz4=);background-repeat:no-repeat;background-size:auto;background-position-x:center;background-position-y:calc(50% + 10px)}.dialing-user-id[data-v-9c84be0f]{font-style:normal;font-weight:600;font-size:40px;width:100%;line-height:56px;display:flex;align-items:center;justify-content:center}.dialing-info[data-v-9c84be0f]{font-style:normal;font-weight:400;font-size:14px;line-height:20px}.control-wrapper[data-v-9c84be0f]{transform:translate(-50%);position:absolute;bottom:0;padding-bottom:40px;left:50%;width:100%;color:#fff;border-radius:inherit;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.4) 100%);display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;z-index:11;user-select:none}.panel-button-area[data-v-9c84be0f]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin:30px 0}.panel-dialing-info[data-v-9c84be0f]{text-align:center}.control-wrapper[data-v-9c84be0f]:hover{z-index:13}.control-item[data-v-9c84be0f]{display:flex;flex-direction:column;width:100px;margin:0 20px}.control-item-h5[data-v-9c84be0f]{display:flex;flex-direction:column;width:100px;margin:0}.control-item-text[data-v-9c84be0f]{margin-top:5px;white-space:nowrap;font-weight:400;font-size:14px;line-height:20px;text-align:center}.control-item-icon[data-v-9c84be0f]{width:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;position:relative}.control-item-icon-container-small[data-v-9c84be0f]{background:rgba(218,218,218,.3);border-radius:40px;width:40px;height:40px;margin:8px;cursor:pointer}.control-item-icon-container-medium[data-v-9c84be0f]{background:rgba(0,0,0,.3);border-radius:56px;width:56px;height:56px;margin:8px;cursor:pointer}.control-item-icon-container-large[data-v-9c84be0f]{background:rgba(0,0,0,.3);border-radius:68px;width:68px;height:68px;margin:8px;cursor:pointer}.control-item-summary[data-v-9c84be0f]{height:40px;width:12px;right:0;display:flex;justify-content:center;align-items:center;cursor:pointer}.control-item-summary[data-v-9c84be0f]:hover{background:rgba(0,0,0,.4)}.control-item-detail[data-v-9c84be0f]{width:300px;border-radius:4px;background:#FEFEFF;box-shadow:#0000003d 0 3px 8px;color:#000;padding:20px;position:absolute;transform:translate(28px);bottom:110%}.control-item-detail-row[data-v-9c84be0f]{margin-bottom:6px;font-size:16px}.device-select[data-v-9c84be0f]{height:32px;width:100%;border:1px solid #DEE0E3;padding-left:6px;padding-top:6px;padding-bottom:6px;margin-top:10px;margin-bottom:10px;font-size:14px;color:#596174}.control-item-detail[data-v-9c84be0f]:before{content:"";width:0;height:0;border-width:10px;border-style:solid;border-color:#FEFEFF transparent transparent;bottom:-3px;margin-left:-9px;position:absolute;left:50%;border-color:#fff;border-radius:4px;transform:rotate(60deg) skew(30deg)}.tag[data-v-9c84be0f]{color:#fff;z-index:inherit;background:rgba(0,0,0,.6);padding:2px 10px;border-top-right-radius:inherit;border-bottom-left-radius:inherit;font-size:14px;position:absolute;left:0;bottom:0;z-index:11;display:flex;align-items:center}.tag .microphone-icon-container[data-v-9c84be0f]{margin-left:0;margin-right:2px;width:20px;background-color:transparent}.switch-large-small[data-v-9c84be0f]{position:absolute;right:12px;top:12px;width:16px;height:16px;z-index:inherit;cursor:pointer}.small-h5[data-v-9c84be0f]{position:absolute;width:94px;height:160px;min-height:100px;max-height:60%;top:30px;right:10px;z-index:2;overflow:hidden;background:#000;border-radius:4px}.small[data-v-9c84be0f]{position:absolute;width:260px;height:170px;min-height:100px;max-height:60%;top:30px;left:30px;z-index:2;overflow:hidden;resize:both;background:#000;border-radius:4px}.large[data-v-9c84be0f]{min-height:100px;width:100%;height:100%;z-index:1;border-radius:inherit;overflow:hidden}.large .switch-large-small[data-v-9c84be0f]{display:none}.group-calling-container[data-v-9c84be0f]{width:100%;height:100%;display:flex;flex-wrap:wrap;justify-content:center}.group-user-view[data-v-9c84be0f]{width:33.333%;height:33.333%;position:relative;background:rgba(32,32,32,.45);backdrop-filter:blur(34px);color:#fff;overflow:hidden}.user-view-text-container[data-v-9c84be0f]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;display:flex;flex-direction:column;justify-content:center;align-items:center;transform:translateY(-20px)}.user-view-user-id[data-v-9c84be0f]{font-family:PingFang SC;font-style:normal;font-weight:600;font-size:24px;line-height:34px}.user-view-info[data-v-9c84be0f]{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:12px;line-height:17px}.page-turn[data-v-9c84be0f]{width:40px;height:86px;border-radius:4.21px;background:rgba(0,0,0,.2);position:absolute;top:50%;transform:translateY(-50%);z-index:11;display:flex;justify-content:center;align-items:center;cursor:pointer}.turn-icon-container[data-v-9c84be0f]{width:14px;height:23px}.right[data-v-9c84be0f]{right:0}.microphone-icon-container[data-v-9c84be0f]{width:24px;height:24px;background:rgba(0,0,0,.4);border-radius:12px;display:flex;justify-content:center;align-items:center;margin-left:8px}.group-user-view-1[data-v-9c84be0f]{width:100%;height:100%}.group-calling-container-1[data-v-9c84be0f]{height:100%}.group-user-view-2[data-v-9c84be0f]{width:50%;height:100%}.group-calling-container-2[data-v-9c84be0f]{height:50%}.group-user-view-3[data-v-9c84be0f],.group-user-view-4[data-v-9c84be0f]{width:50%;height:50%}.group-calling-container-3[data-v-9c84be0f],.group-calling-container-4[data-v-9c84be0f]{height:100%}.group-user-view-5[data-v-9c84be0f],.group-user-view-6[data-v-9c84be0f]{width:33.333%;height:50%}.group-calling-container-5[data-v-9c84be0f],.group-calling-container-6[data-v-9c84be0f]{height:66%}.user-view-user-id-1[data-v-9c84be0f]{font-size:24px}.user-view-user-id-2[data-v-9c84be0f],.user-view-user-id-3[data-v-9c84be0f],.user-view-user-id-4[data-v-9c84be0f]{font-size:22px}.user-view-user-id-5[data-v-9c84be0f],.user-view-user-id-6[data-v-9c84be0f],.user-view-user-id-7[data-v-9c84be0f],.user-view-user-id-8[data-v-9c84be0f],.user-view-user-id-9[data-v-9c84be0f]{font-size:18px}.float-control-panel[data-v-9c84be0f]{width:168px;height:56px;background:white;z-index:13;position:fixed;top:20px;right:20px;display:flex;flex-wrap:nowrap;justify-content:center;border-radius:40px;box-shadow:#00000029 0 3px 6px,#0000003b 0 3px 6px}.function-buttons[data-v-9c84be0f]{position:absolute;right:12px;top:12px;z-index:13;cursor:pointer;display:flex;flex-direction:row;justify-content:flex-start}.minimize[data-v-9c84be0f]{margin-left:10px}.float-control-item-icon[data-v-9c84be0f]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:56px;height:56px;position:relative}.float-control-item-icon-container[data-v-9c84be0f]{border-radius:40px;width:40px;height:40px;margin:.5rem;cursor:pointer;display:flex;flex-direction:row;justify-content:center;align-items:center}.float-control-item-icon-container[data-v-9c84be0f]:hover{background:rgba(218,218,218,.3)}')),document.head.appendChild(e)}}catch(t){}}();var TP=Object.defineProperty,CP=(e,t,n)=>(((e,t,n)=>{t in e?TP(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n),SP=(e=>(e.CONTAIN="contain",e.COVER="cover",e.FILL="fill",e))(SP||{}),EP=(e=>(e.RESOLUTION_480P="480p",e.RESOLUTION_720P="720p",e.RESOLUTION_1080P="1080p",e))(EP||{});let kP,bP=0;const DP=f("");function wP(){return 0===bP&&(kP=setInterval((()=>{bP+=1,DP.value=function(){const e=Math.floor(bP/3600),t=Math.floor(bP/60%60),n=Math.floor(bP%60);let i=`${n}`;return n<10&&(i=`0${n}`),i=`${t}:${i}`,t<10&&(i=`0${i}`),e>10?i=`${e}:${i}`:e>0&&(i=`0${e}:${i}`),i}()}),1e3),!0)}const AP={IDLE:"idle",BE_INVITED:"be-invited",DIALING_C2C:"dialing-c2c",DIALING_GROUP:"dialing-group",CALLING_C2C_AUDIO:"calling-c2c-audio",CALLING_C2C_VIDEO:"calling-c2c-video",CALLING_GROUP_AUDIO:"calling-group-audio",CALLING_GROUP_VIDEO:"calling-group-video"},RP={REJECT:"change-status-because-of-rejected",NO_RESPONSE:"change-status-because-of-no-response",LINE_BUSY:"change-status-because-of-line-busy",CALLING_CANCEL:"change-status-because-of-calling-cancel",CALLING_TIMEOUT:"change-status-because-of-calling-timeout",CALL_TYPE_CHANGED:"call-type-changed",ACCEPT_DEVICE_ERROR:"accept-device-error",ACCEPT_ERROR:"accept-error",CALL_ERROR:"call-error"},LP={VIDEO:"call-type-string-video",AUDIO:"call-type-string-audio"},OP={en:{call:"call","video-call":"video call","audio-call":"audio call",search:"search","search-result":"search result","no-user":"user not found","member-not-added":"member not added","input-phone-userID":"phone number or userID","not-login":"not logged in","login-status-expire":"login status is invalid, please refresh the page and try again","experience-multi-call":"experience multi-person calls, please download the full-featured demo: ","not-support-multi-call":"multi-person call interface is not open",userID:"userID","already-enter":"entered the call",waiting:"Calling...",hangup:"Hang up",reject:"Decline",accept:"Accept","camera-opened":"Camera on","camera-closed":"Camera off","microphone-opened":"Mic on","microphone-closed":"Mic off",camera:"Camera",microphone:"Microphone","image-resolution":"Resolution","default-image-resolution":"Default","invited-person":"Invite","video-to-audio":"Switch to audio",me:"(me)","start-voice-call":"Audio call from ","start-video-call":"Video call from ","be-rejected":"Call declined, ","be-no-response":"No response, ","be-line-busy":"Line busy, ","be-canceled":"The call is canceled, ",timeout:"The call timed out","voice-call-end":"Voice call ended","video-call-end":"Video call ended","method-call-failed":"Failed to sync the operation","failed-to-obtain-permission":"Failed to obtain permissions","environment-detection-failed":"Failed to check the environment","call-failed":"call method failed","microphone-unavailable":"No mic found","ban-device":"Device access denied","not-supported-webrtc":"Your current environment does not support WebRTC","is-already-calling":"TUICallKit is already on a call","need-init":"Before initiating a call with TUICallKit, ensure that the TUICallKitServer.init() method has executed successfully. ","can't call yourself":"Can't call yourself","Use-phone-and-computer":"Use your mobile phone and computer to experience video calls","Wechat scan right QR code":"Wechat scan right QR code",try:"try","Scan the QR code above":"Scan the QR code above","Make video calls yourself":"Make video calls yourself","accept-error":"Accept failed","accept-device-error":"Accept failed, unable to auth calling device","call-error":"Start call failed"},"zh-cn":{call:"通话","video-call":"视频通话","audio-call":"音频通话",search:"搜索","search-result":"搜索结果","Wechat scan right QR code":"微信扫右二维码","Use-phone-and-computer":"用手机与电脑互打体验视频通话",try:"试试","Scan the QR code above":"扫描上方二维码","Make video calls yourself":"自己玩转视频通话","no-user":"未搜索到用户","member-not-added":"未添加成员","not-login":"未登录","login-status-expire":"登录状态已失效，请刷新网页重试","experience-multi-call":"体验多人通话请下载全功能demo:","not-support-multi-call":"多人通话接口未开放","input-phone-userID":"请输入手机号/用户ID",userID:"用户ID","already-enter":"已经进入当前通话",waiting:"等待接听...",hangup:"挂断",reject:"拒绝",accept:"接受","camera-opened":"摄像头已开","camera-closed":"摄像头已关","microphone-opened":"麦克风已开","microphone-closed":"麦克风已关",camera:"摄像头",microphone:"麦克风","image-resolution":"分辨率","default-image-resolution":"默认分辨率","invited-person":"添加成员","video-to-audio":"视频转语音",me:"（我）","start-voice-call":"发起的语音通话","start-video-call":"发起的视频通话","be-rejected":"对方已拒绝，","be-no-response":"对方无应答，","be-line-busy":"对方忙线中，","be-canceled":"对方已取消",timeout:"本次通话超时未应答","voice-call-end":"语音通话结束","video-call-end":"视频通话结束","method-call-failed":"同步操作失败","failed-to-obtain-permission":"权限获取失败","environment-detection-failed":"环境检测失败","call-failed":"调用失败","microphone-unavailable":"没有可用的麦克风设备","ban-device":"用户禁止使用设备","not-supported-webrtc":"当前环境不支持 WebRTC","is-already-calling":"TUICallKit 已在通话状态","need-init":"TUICallKit 发起通话前需保证 TUICallKitServer.init() 方法执行成功","can't call yourself":"不能呼叫自己","accept-error":"接通失败","accept-device-error":"接通失败，通话设备获取失败","call-error":"发起通话失败"}},NP=f(null),PP=f("zh-cn"),UP=f(SP.COVER),xP=f(EP.RESOLUTION_480P),GP=f([]),FP=f([]),VP=f(""),qP=f(""),BP=f(new Set),HP=f(AP.IDLE),jP=f(!1),KP=f("waiting"),zP=f(),WP=f(!1),YP=f([]),$P=f(new Map),JP=f({userID:"",isEntered:!0,microphone:!0,camera:!0});function XP(...e){"function"==typeof NP.value&&NP.value(...e)}function ZP(e){var t;for(const n in OP)if(n===PP.value){const t=OP[n];for(const n in t)if(n===e)return t[n]}return null==(t=e.en)?void 0:t.key}async function QP(e,t="",n=0){if(HP.value!==e){switch(t!==RP.CALL_TYPE_CHANGED&&(clearInterval(kP),bP=0),t){case RP.REJECT:nU(`${ZP("be-rejected")}${zP.value===LP.AUDIO?ZP("voice-call-end"):ZP("video-call-end")}`);break;case RP.NO_RESPONSE:nU(`${ZP("be-no-response")}${zP.value===LP.AUDIO?ZP("voice-call-end"):ZP("video-call-end")}`);break;case RP.LINE_BUSY:nU(`${ZP("be-line-busy")}${zP.value===LP.AUDIO?ZP("voice-call-end"):ZP("video-call-end")}`);break;case RP.CALLING_CANCEL:nU(ZP("be-canceled"));break;case RP.CALLING_TIMEOUT:nU(ZP("timeout"));break;case RP.ACCEPT_DEVICE_ERROR:nU(ZP("accept-device-error"));break;case RP.CALL_ERROR:nU(ZP("call-error"));break;default:nU("")}return new Promise((t=>{setTimeout((()=>{mF.statusChanged&&mF.statusChanged({oldStatus:HP.value,newStatus:e}),XP("status-changed",{oldStatus:HP.value,newStatus:e}),HP.value=e,t()}),n)}))}}function eU(e){let t=YP.value.findIndex((t=>t.userID===e));if(t>=0){const e=YP.value;e.splice(t,1),aU([...e])}return BP.value.delete(e),YP.value.length}function tU(e,t,n){const i=YP.value.findIndex((t=>t.userID===e));i>=0&&(t===LP.VIDEO?YP.value[i].camera=n:t===LP.AUDIO&&(YP.value[i].microphone=n))}function nU(e){KP.value=e}function iU(e){switch(e){case lP.TUICallType.AUDIO_CALL:zP.value=LP.AUDIO;break;case lP.TUICallType.VIDEO_CALL:zP.value=LP.VIDEO;break;default:return}HP.value===AP.CALLING_C2C_VIDEO&&zP.value===LP.AUDIO&&QP(AP.CALLING_C2C_AUDIO,RP.CALL_TYPE_CHANGED),HP.value===AP.CALLING_C2C_AUDIO&&zP.value===LP.VIDEO&&QP(AP.CALLING_C2C_VIDEO,RP.CALL_TYPE_CHANGED),HP.value===AP.BE_INVITED&&nU(zP.value===LP.AUDIO?ZP("start-voice-call"):ZP("start-video-call"))}function rU(e){WP.value=e}async function oU(e){const t=mF.getTim();if(!t)return e;let n=e;const{data:i}=await t.getUserProfile({userIDList:[e]})||{};return i&&i.length>0&&(n=i[0].nick),""===n&&(n=e),n}async function aU(e){YP.value=e;for(const t of YP.value)null!=t&&t.nick||(t.nick=await oU(t.userID),Oe(YP))}async function sU(e){JP.value=e,JP.value.nick=await oU(e.userID),Oe(JP)}function cU(e){return $P.value.get(e)||0}v(DP,(()=>{nU(DP.value)})),v(HP,(()=>{HP.value===AP.BE_INVITED&&nU(zP.value===LP.AUDIO?ZP("start-voice-call"):ZP("start-video-call")),"dialing"===HP.value.split("-")[0]&&nU(ZP("waiting")),"calling"===HP.value.split("-")[0]&&(nU(""),wP()),HP.value===AP.IDLE&&(JP.value.microphone=!0,JP.value.camera=!0,jP.value=!1,nU(""),aU([]),mF.afterCalling&&mF.afterCalling())}));const uU="2.1.0";const lU=e=>(F("data-v-fe5ee432"),e=e(),V(),e),dU={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",class:"design-iconfont"},pU={key:0},hU=[lU((()=>P("path",{d:"M8.62462 7.17395C8.90076 7.17395 9.12462 7.38807 9.12462 7.65221C9.12462 7.89434 8.93651 8.09444 8.69246 8.12611L8.62462 8.13047H7.3335C7.05735 8.13047 6.8335 7.91635 6.8335 7.65221C6.8335 7.41009 7.0216 7.20998 7.26565 7.17832L7.3335 7.17395H8.62462Z",fill:"#43D92B"},null,-1)))],fU={key:1},gU=[lU((()=>P("path",{d:"M8.62462 5.57971C8.90076 5.57971 9.12462 5.79384 9.12462 6.05797C9.12462 6.3001 8.93651 6.5002 8.69246 6.53187L8.62462 6.53623H7.3335C7.05735 6.53623 6.8335 6.32211 6.8335 6.05797C6.8335 5.81585 7.0216 5.61575 7.26565 5.58408L7.3335 5.57971H8.62462Z",fill:"#43D92B"},null,-1)))],mU={key:2},vU=[lU((()=>P("path",{d:"M8.62462 3.98547C8.90076 3.98547 9.12462 4.1996 9.12462 4.46373C9.12462 4.70586 8.93651 4.90596 8.69246 4.93763L8.62462 4.942H7.3335C7.05735 4.942 6.8335 4.72787 6.8335 4.46373C6.8335 4.22161 7.0216 4.02151 7.26565 3.98984L7.3335 3.98547H8.62462Z",fill:"#43D92B"},null,-1)))],_U=lU((()=>P("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.3301 3.45938C11.2517 1.89175 9.77808 0.658081 8 0.658081C6.17253 0.658081 4.66667 1.96123 4.66667 3.59077V7.72539L4.66994 7.85678C4.7483 9.42442 6.22192 10.6581 8 10.6581C9.82747 10.6581 11.3333 9.35493 11.3333 7.72539V3.59077L11.3301 3.45938ZM6.0035 3.54179C6.06337 2.69234 6.92083 1.99146 8.00016 1.99146C9.11947 1.99146 10.0002 2.74521 10.0002 3.63675V7.67949L9.99682 7.77446C9.93695 8.62391 9.07949 9.32479 8.00016 9.32479C6.88086 9.32479 6.00016 8.57103 6.00016 7.67949V3.63675L6.0035 3.54179ZM8.33333 15.3333C8.51743 15.3333 8.66667 15.1841 8.66667 15V13.2964C11.5402 12.9793 14 10.6655 14 8.27322V7.68092C14 7.49682 13.8508 7.34758 13.6667 7.34758H13C12.8159 7.34758 12.6667 7.49682 12.6667 7.68092V8.27322L12.6634 8.39309C12.5681 10.1524 10.3982 11.9979 8.00396 12C8.00264 12 8.00132 12 8 12C7.99868 12 7.99736 12 7.99604 12C5.54737 11.9979 3.33333 10.0675 3.33333 8.27322L3.33043 7.65652C3.32956 7.47164 3.17839 7.32278 2.99352 7.32477L2.32975 7.33191C2.14706 7.33387 2 7.48252 2 7.66522V8.27322L2.00292 8.4162C2.09825 10.757 4.51708 12.9856 7.33333 13.2964V15C7.33333 15.1841 7.48257 15.3333 7.66667 15.3333H8.33333Z",fill:"#fff"},null,-1))),yU=S({__name:"MicrophoneIcon",props:{volume:null},setup(e){const t=e,{volume:n}=b(t);return(e,t)=>(w(),A("svg",dU,[H(n)&&H(n)>0?(w(),A("g",pU,hU)):O("",!0),H(n)&&H(n)>5?(w(),A("g",fU,gU)):O("",!0),H(n)&&H(n)>10?(w(),A("g",mU,vU)):O("",!0),_U]))}}),IU=(e,t)=>{const n=e.__vccOpts||e;for(const[i,r]of t)n[i]=r;return n},MU=IU(yU,[["__scopeId","data-v-fe5ee432"]]),TU={},CU={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",class:"design-iconfont"},SU=[P("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.82825 12.4759C5.58172 12.9048 6.43742 13.1978 7.33333 13.2967V15.0002C7.33333 15.1843 7.48257 15.3335 7.66667 15.3335H8.33333C8.51743 15.3335 8.66667 15.1843 8.66667 15.0002V13.2967C11.5402 12.9796 14 10.6658 14 8.27347V7.68116C14 7.49707 13.8508 7.34783 13.6667 7.34783H13C12.8159 7.34783 12.6667 7.49707 12.6667 7.68116V8.27347L12.6634 8.39333C12.5681 10.1526 10.3982 11.9982 8.00396 12.0002L8 12.0002L7.99604 12.0002C7.22514 11.9996 6.47749 11.8078 5.81487 11.4893L4.82825 12.4759ZM6.83168 10.4725C7.196 10.5927 7.5899 10.6583 8 10.6583C9.82747 10.6583 11.3333 9.35517 11.3333 7.72563V5.97083L6.83168 10.4725ZM10.9068 2.1547L4.73629 8.32524C4.70043 8.17327 4.67793 8.01689 4.66994 7.85702L4.66667 7.72563V3.59102C4.66667 1.96148 6.17253 0.658325 8 0.658325C9.24072 0.658325 10.3332 1.25901 10.9068 2.1547ZM3.62455 9.43698L2.64622 10.4153C2.26208 9.78985 2.03108 9.10804 2.00292 8.41644L2 8.27347V7.66546C2 7.48277 2.14706 7.33411 2.32975 7.33215L2.99352 7.32502C3.17839 7.32303 3.32956 7.47188 3.33043 7.65676L3.33333 8.27347C3.33333 8.66191 3.4371 9.05672 3.62455 9.43698Z",fill:"#fff"},null,-1),P("rect",{x:".609863",y:"13.4514",width:"19.0127",height:"1.5",rx:".75",transform:"rotate(-45 .609863 13.4514)",fill:"#FE3C44"},null,-1)];const EU=IU(TU,[["render",function(e,t){return w(),A("svg",CU,SU)}]]),kU=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),bU=()=>{},DU=Array.isArray;const wU=e=>(e.w&LU)>0,AU=e=>(e.n&LU)>0;let RU=0,LU=1;const OU=30;let NU;class PU{constructor(e,t=null,n){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],this.parent=void 0,function(e,t){t&&t.active&&t.effects.push(e)}(this,n)}run(){if(!this.active)return this.fn();let e=NU,t=xU;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=NU,NU=this,xU=!0,LU=1<<++RU,RU<=OU?(({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=LU})(this):UU(this),this.fn()}finally{RU<=OU&&(e=>{const{deps:t}=e;if(t.length){let n=0;for(let i=0;i<t.length;i++){const r=t[i];wU(r)&&!AU(r)?r.delete(e):t[n++]=r,r.w&=~LU,r.n&=~LU}t.length=n}})(this),LU=1<<--RU,NU=this.parent,xU=t,this.parent=void 0,this.deferStop&&this.stop()}}stop(){NU===this?this.deferStop=!0:this.active&&(UU(this),this.onStop&&this.onStop(),this.active=!1)}}function UU(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}let xU=!0;function GU(e,t){(e!==NU||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}function FU(e){const t=e&&e.__v_raw;return t?FU(t):e}function VU(e){xU&&NU&&function(e,t){let n=!1;RU<=OU?AU(e)||(e.n|=LU,n=!wU(e)):n=!e.has(NU),n&&(e.add(NU),NU.deps.push(e))}((e=FU(e)).dep||(e.dep=(e=>{const t=new Set(e);return t.w=0,t.n=0,t})()))}function qU(e,t){const n=(e=FU(e)).dep;n&&function(e,t){const n=DU(e)?e:[...e];for(const i of n)i.computed&&GU(i);for(const i of n)i.computed||GU(i)}(n)}var BU;class HU{constructor(e,t,n,i){this._setter=t,this.dep=void 0,this.__v_isRef=!0,this[BU]=!1,this._dirty=!0,this.effect=new PU(e,(()=>{this._dirty||(this._dirty=!0,qU(this))})),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=n}get value(){const e=FU(this);return VU(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}BU="__v_isReadonly";const jU={key:0,id:"local-dialing",class:"dialing-local"},KU={class:"dialing-content"},zU={class:"dialing-user-id"},WU={key:1,class:"microphone-icon-container"},YU={class:"dialing-info"},$U=S({__name:"Dialing",setup(e){const t=function(e,t,n=!1){let i,r;const o=(e=>"function"==typeof e)(e);return o?(i=e,r=bU):(i=e.get,r=e.set),new HU(i,r,o||!r,n)}((()=>HP.value===AP.DIALING_C2C&&zP.value===LP.VIDEO?"1":"0.7"));return(e,n)=>{var i,r;return w(),A("div",{class:"dialing-wrapper",style:U(`opacity: ${H(t)}`)},[H(HP)===H(AP).DIALING_C2C&&H(zP)===H(LP).VIDEO?(w(),A("div",jU)):O("",!0),z(P("div",KU,[P("div",zU,[H(YP).length>=1?(w(),A(_,{key:0},[oe(L(null==(i=H(YP)[0])?void 0:i.nick),1)],64)):O("",!0),H(HP)===H(AP).CALLING_C2C_AUDIO?(w(),A("div",WU,[null!=(r=H(YP)[0])&&r.microphone?(w(),j(MU,{key:0,volume:H(cU)(H(YP)[0].userID)},null,8,["volume"])):(w(),j(EU,{key:1}))])):O("",!0)]),P("div",YU,L(H(KP)),1)],512),[[W,!(H(kU)&&H(HP)===H(AP).DIALING_C2C&&H(zP)===H(LP).VIDEO)]])],4)}}}),JU=IU($U,[["__scopeId","data-v-516ff97a"]]),XU={},ZU={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 12 12",class:"design-iconfont"},QU=[P("path",{opacity:".01",transform:"matrix(1 0 0 -1 0 12)",fill:"#000",d:"M0 0H12V12H0z"},null,-1),P("path",{d:"M9.14646 7.14643C9.46144 7.46141 9.23835 7.99998 8.7929 7.99998L3.20712 7.99998C2.76167 7.99998 2.53859 7.4614 2.85357 7.14642L5.6465 4.35355C5.84177 4.15829 6.15835 4.15829 6.35361 4.35355L9.14646 7.14643Z",fill:"#fff"},null,-1)];const ex=IU(XU,[["render",function(e,t){return w(),A("svg",ZU,QU)}]]),tx={class:"control-item-icon"},nx={class:"control-item-detail"},ix={class:"control-item-text"},rx=S({__name:"ControlPanelItem",props:{action:null,hasDetail:{type:Boolean,default:!1},size:{default:"small"},isMobile:{type:Boolean,default:!1}},setup(e){const t=e,n=f(!1),{action:i,hasDetail:r,isMobile:o,size:a}=b(t),s=g((()=>`control-item-icon-container-${a.value}`));async function c(e){e.stopPropagation(),async function(){await N();const e=document.getElementsByClassName("control-item-detail");for(let t=0;t<e.length;t++)e[t].addEventListener("click",(e=>e.stopPropagation()))}(),n.value=!n.value}return d((()=>{document.documentElement.addEventListener("click",(e=>{n.value=!1}))})),(e,t)=>(w(),A("div",{class:G(H(o)?"control-item-h5":"control-item")},[P("div",tx,[P("div",{class:G(H(s)),onClick:t[0]||(t[0]=(...e)=>H(i)&&H(i)(...e))},[X(e.$slots,"icon",{},void 0,!0)],2),H(r)?(w(),A("div",{key:0,class:"control-item-summary",onClick:c},[M(ex)])):O("",!0),z(P("div",nx,[X(e.$slots,"detail",{},void 0,!0)],512),[[W,n.value]])]),P("div",ix,[X(e.$slots,"text",{},void 0,!0)])],2))}}),ox=IU(rx,[["__scopeId","data-v-974fb4e2"]]),ax={},sx={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40",class:"design-iconfont"},cx=[P("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M0 20C0 8.95431 8.95431 0 20 0C31.0457 0 40 8.95431 40 20C40 31.0457 31.0457 40 20 40C8.95431 40 0 31.0457 0 20Z",fill:"#FE3C44"},null,-1),P("path",{d:"M25.4437 20.449C25.4437 22.1142 25.2336 23.3515 28.5089 23.7126C31.7875 24.0737 31.3666 21.6794 31.3662 20.0669C31.3649 18.2061 27.0602 15.619 20.2726 15.6173C13.4866 15.6173 9.1789 18.205 9.17888 20.067C9.17887 21.68 8.75621 24.0726 12.0332 23.7123C15.3101 23.3537 15.1 22.1155 15.0984 20.4495C15.1013 19.2862 17.7587 19.0316 20.2725 19.0298C22.7863 19.0281 25.4454 19.2844 25.4437 20.449Z",fill:"#fff"},null,-1)];const ux=IU(ax,[["render",function(e,t){return w(),A("svg",sx,cx)}]]),lx={},dx={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40",class:"design-iconfont"},px=[P("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M0 20C0 8.95431 8.95431 0 20 0V0C31.0457 0 40 8.95431 40 20V20C40 31.0457 31.0457 40 20 40V40C8.95431 40 0 31.0457 0 20V20Z",fill:"#19D255"},null,-1),P("path",{d:"M23.5397 16.9535C24.7172 18.131 25.4436 19.1544 28.0149 17.0938C30.5885 15.0308 28.5979 13.6354 27.4573 12.4955C26.1407 11.1806 21.2674 12.3951 16.4667 17.1935C11.6683 21.9919 10.4521 26.8677 11.7687 28.1844C12.9092 29.3249 14.3022 31.3156 16.3646 28.7437C18.4282 26.173 17.4041 25.446 16.2248 24.2691C15.4043 23.4444 17.1034 21.3853 18.8797 19.6066C20.656 17.8278 22.7174 16.1288 23.5397 16.9535Z",fill:"white"},null,-1)];const hx=IU(lx,[["render",function(e,t){return w(),A("svg",dx,px)}]]),fx={},gx={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40",class:"design-iconfont"},mx=[P("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M0 20C0 8.95431 8.95431 0 20 0C31.0457 0 40 8.95431 40 20C40 31.0457 31.0457 40 20 40C8.95431 40 0 31.0457 0 20Z",fill:"#19D255"},null,-1),P("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24.0421 14.8129C23.8814 14.0792 23.3684 13.5231 22.7291 13.3902C21.6674 13.2126 20.3495 13 17.6667 13C14.7319 13 13.5011 13.2009 12.5263 13.3669C11.9235 13.5295 11.4484 14.0688 11.2926 14.7675C11.153 15.6419 11 17.8298 11 19.6667C11 21.4724 11.1481 23.6461 11.2912 24.5205C11.4519 25.2542 11.9649 25.8103 12.6042 25.9431C13.666 26.1207 14.9839 26.3333 17.6667 26.3333C20.3495 26.3333 21.6674 26.1207 22.7305 25.9522C23.3726 25.8194 23.8891 25.26 24.0512 24.5231C24.1853 23.6461 24.3333 21.4724 24.3333 19.6667C24.3333 17.8609 24.1853 15.6872 24.0421 14.8129ZM12.6667 15.5C12.6667 15.0398 13.0398 14.6667 13.5 14.6667H14.3333C14.7936 14.6667 15.1667 15.0398 15.1667 15.5C15.1667 15.9602 14.7936 16.3333 14.3333 16.3333H13.5C13.0398 16.3333 12.6667 15.9602 12.6667 15.5ZM28.5 14.6667C27.0942 14.6667 26 16.547 26 17.6429V21.6905C26 22.9804 26.8008 24.6667 28.5 24.6667C29.2858 24.6667 29.3333 21.4524 29.3333 19.6667C29.3333 17.881 29.3333 14.6667 28.5 14.6667Z",fill:"#fff"},null,-1)];const vx=IU(fx,[["render",function(e,t){return w(),A("svg",gx,mx)}]]),_x={},yx={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40",class:"design-iconfont"},Ix=[P("rect",{width:"40",height:"40",rx:"20",fill:"#DADADA","fill-opacity":".3"},null,-1),P("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24.0164 14.5395C23.8498 13.7141 23.3182 13.0884 22.6556 12.939C21.5553 12.7392 20.1895 12.5 17.4091 12.5C14.3676 12.5 13.092 12.726 12.0818 12.9127C11.4571 13.0957 10.9647 13.7024 10.8033 14.4884C10.6585 15.4721 10.5 17.9335 10.5 20C10.5 22.0315 10.6535 24.4769 10.8018 25.4605C10.9684 26.2859 11.5 26.9116 12.1625 27.061C13.2629 27.2608 14.6287 27.5 17.4091 27.5C20.1895 27.5 21.5553 27.2608 22.6571 27.0712C23.3225 26.9218 23.8578 26.2925 24.0258 25.4634C24.1647 24.4769 24.3182 22.0315 24.3182 20C24.3182 17.9685 24.1647 15.5231 24.0164 14.5395ZM12.2273 15.2083C12.2273 14.7481 12.6004 14.375 13.0606 14.375H13.9848C14.4451 14.375 14.8182 14.7481 14.8182 15.2083V15.4167C14.8182 15.8769 14.4451 16.25 13.9848 16.25H13.0606C12.6004 16.25 12.2273 15.8769 12.2273 15.4167V15.2083ZM28.6364 14.375C27.1794 14.375 26.0455 16.4904 26.0455 17.7232V22.2768C26.0455 23.7279 26.8754 25.625 28.6364 25.625C29.4508 25.625 29.5 22.0089 29.5 20C29.5 17.9911 29.5 14.375 28.6364 14.375Z",fill:"#fff"},null,-1)];const Mx=IU(_x,[["render",function(e,t){return w(),A("svg",yx,Ix)}]]),Tx={},Cx={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40",class:"design-iconfont"},Sx=[P("rect",{width:"40",height:"40",rx:"20",fill:"#DADADA","fill-opacity":".3"},null,-1),P("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M16.6665 14.1667C16.6665 12.3284 18.1615 10.8334 19.9998 10.8334C21.8382 10.8334 23.3332 12.3284 23.3332 14.1667V19.1667C23.3332 21.005 21.8382 22.5 19.9998 22.5C18.1615 22.5 16.6665 21.005 16.6665 19.1667V14.1667ZM16.6665 28.3334C16.6665 27.8725 17.0398 27.5 17.4998 27.5H22.4998C22.9607 27.5 23.3332 27.8725 23.3332 28.3334C23.3332 28.7942 22.9607 29.1667 22.4998 29.1667H17.4998C17.0398 29.1667 16.6665 28.7942 16.6665 28.3334Z",fill:"#fff"},null,-1),P("path",{d:"M25.8332 18.3512V19.5083C25.8332 22.0811 23.2215 25 19.9998 25C16.7782 25 14.1665 22.0811 14.1665 19.5083V18.3334",stroke:"#fff","stroke-width":"1.66667","stroke-linecap":"round"},null,-1)];const Ex=IU(Tx,[["render",function(e,t){return w(),A("svg",Cx,Sx)}]]),kx={},bx={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40",class:"design-iconfont"},Dx=[P("rect",{width:"40",height:"40",rx:"20",fill:"#DADADA","fill-opacity":".3"},null,-1),P("path",{d:"M17.7311 15.7485C17.7311 15.4339 18.1333 15.289 18.3596 15.507L22.9808 19.6831C23.1314 19.828 23.1314 20.0453 22.9808 20.166L18.3341 24.3435C18.1086 24.5608 17.7063 24.3917 17.7063 24.102V22.3396C17.7063 22.1464 17.5303 22.0016 17.3296 22.0016C14.2147 22.074 12.4319 22.8707 10.649 24.5366C10.3726 24.778 9.89538 24.5366 10.0205 24.1986C11.1007 21.1565 12.9345 18.4042 17.7311 17.8006V15.7485Z",fill:"#fff"},null,-1),P("path",{d:"M24.7603 17.0411C26.4103 18.6911 26.4328 21.3438 24.8106 22.9661C24.5788 23.1978 24.1999 23.1946 23.9642 22.9589C23.7284 22.7232 23.7252 22.3442 23.957 22.1124C25.1157 20.9537 25.0996 19.0589 23.9211 17.8803C23.6853 17.6446 23.6821 17.2656 23.9139 17.0339C24.1456 16.8021 24.5246 16.8053 24.7603 17.0411Z",fill:"#fff"},null,-1),P("path",{d:"M26.8765 14.925C29.7051 17.7536 29.7437 22.3011 26.9627 25.0821C26.731 25.3138 26.352 25.3106 26.1163 25.0749C25.8806 24.8392 25.8773 24.4602 26.1091 24.2285C28.4266 21.911 28.3944 18.1214 26.0373 15.7642C25.8016 15.5285 25.7983 15.1495 26.0301 14.9178C26.2618 14.686 26.6408 14.6893 26.8765 14.925Z",fill:"#fff"},null,-1)];const Ax=IU(kx,[["render",function(e,t){return w(),A("svg",bx,Dx)}]]),Rx={},Lx={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40",class:"design-iconfont"},Ox=[P("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M0 20C0 8.95431 8.95431 0 20 0C31.0457 0 40 8.95431 40 20C40 31.0457 31.0457 40 20 40C8.95431 40 0 31.0457 0 20Z",fill:"#FE3C44"},null,-1),P("path",{d:"M25.4437 20.449C25.4437 22.1142 25.2336 23.3515 28.5089 23.7126C31.7875 24.0737 31.3666 21.6794 31.3662 20.0669C31.3649 18.2061 27.0602 15.619 20.2726 15.6173C13.4866 15.6173 9.1789 18.205 9.17888 20.067C9.17887 21.68 8.75621 24.0726 12.0332 23.7123C15.3101 23.3537 15.1 22.1155 15.0984 20.4495C15.1013 19.2862 17.7587 19.0316 20.2725 19.0298C22.7863 19.0281 25.4454 19.2844 25.4437 20.449Z",fill:"#fff"},null,-1)];const Nx=IU(Rx,[["render",function(e,t){return w(),A("svg",Lx,Ox)}]]),Px={},Ux={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40",class:"design-iconfont"},xx=[P("rect",{opacity:".3",width:"40",height:"40",rx:"20",fill:"#fff"},null,-1),P("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M20 11.5C18.0697 11.5 16.5 12.9678 16.5 14.7727V19.6818C16.5 20.2623 16.6623 20.8078 16.9468 21.281L23.4997 14.7281C23.4741 12.9437 21.9143 11.5 20 11.5ZM23.5 18.9704L19.5436 22.9269C19.693 22.9451 19.8453 22.9545 20 22.9545C21.9303 22.9545 23.5 21.4867 23.5 19.6818V18.9704ZM15.7321 22.4957C15.1207 21.7452 14.75 20.8727 14.75 20.0171V18.8636L14.7432 18.761C14.6892 18.3575 14.3211 18.0454 13.875 18.0454C13.3918 18.0454 13 18.4117 13 18.8636V20.0171L13.0047 20.2215C13.0611 21.4647 13.6284 22.6883 14.5245 23.7033L15.7321 22.4957ZM16.9482 25.5222L18.2094 24.261C18.7777 24.4715 19.3834 24.5909 20 24.5909C22.6589 24.5909 25.1138 22.3716 25.2445 20.1981L25.25 20.0171V18.8811C25.25 18.4293 25.6418 18.0629 26.125 18.0629C26.5711 18.0629 26.9392 18.3751 26.9932 18.7785L27 18.8811V20.0171C27 23.1518 23.6976 26.2272 20 26.2272C18.9256 26.2272 17.8845 25.9676 16.9482 25.5222ZM16.5 28.6818C16.5 28.2294 16.892 27.8636 17.375 27.8636H22.625C23.1089 27.8636 23.5 28.2294 23.5 28.6818C23.5 29.1343 23.1089 29.5 22.625 29.5H17.375C16.892 29.5 16.5 29.1343 16.5 28.6818Z",fill:"#fff"},null,-1),P("rect",{x:"27.249",y:"11.7688",width:"1.5",height:"22",rx:".75",transform:"rotate(45 27.249 11.7688)",fill:"#FE3C44"},null,-1)];const Gx=IU(Px,[["render",function(e,t){return w(),A("svg",Ux,xx)}]]),Fx={},Vx={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40",class:"design-iconfont"},qx=[P("rect",{width:"40",height:"40",rx:"20",fill:"#DADADA","fill-opacity":".3"},null,-1),P("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M22.7221 12.9557C22.7001 12.9496 22.6779 12.944 22.6556 12.939C21.5553 12.7392 20.1895 12.5 17.4091 12.5C14.3676 12.5 13.092 12.726 12.0818 12.9127C11.4571 13.0957 10.9647 13.7024 10.8033 14.4884C10.6585 15.4721 10.5 17.9335 10.5 20C10.5 21.7343 10.6118 23.7703 10.7369 24.9409L22.7221 12.9557ZM12.755 27.1654C13.7704 27.3355 15.1033 27.5 17.4091 27.5C20.1658 27.5 21.5319 27.2649 22.6289 27.0761L22.6571 27.0712C23.3225 26.9218 23.8578 26.2925 24.0258 25.4634C24.1647 24.4769 24.3182 22.0315 24.3182 20C24.3182 18.5797 24.2432 16.957 24.1473 15.773L12.755 27.1654ZM13.0606 14.375C12.6004 14.375 12.2273 14.7481 12.2273 15.2083V15.4167C12.2273 15.8769 12.6004 16.25 13.0606 16.25H13.9848C14.4451 16.25 14.8182 15.8769 14.8182 15.4167V15.2083C14.8182 14.7481 14.4451 14.375 13.9848 14.375H13.0606ZM26.0455 17.7232C26.0455 16.4904 27.1794 14.375 28.6364 14.375C29.5 14.375 29.5 17.9911 29.5 20C29.5 22.0089 29.4508 25.625 28.6364 25.625C26.8754 25.625 26.0455 23.7279 26.0455 22.2768V17.7232Z",fill:"#fff"},null,-1),P("rect",{x:"24.8574",y:"11.8564",width:"1.5",height:"22",rx:".75",transform:"rotate(45 24.8574 11.8564)",fill:"#FE3C44"},null,-1)];const Bx=IU(Fx,[["render",function(e,t){return w(),A("svg",Vx,qx)}]]),Hx={class:"control-wrapper"},jx={class:"panel-button-area"},Kx={class:"control-item-detail-row"},zx={value:"",selected:"",disabled:"",hidden:""},Wx=["value"],Yx={key:0},$x={value:"",selected:"",disabled:"",hidden:""},Jx=["value"],Xx=["value"],Zx=["value"],Qx={value:"",selected:"",disabled:"",hidden:""},eG=["value"],tG={key:0,class:"panel-hangup"},nG=S({__name:"ControlPanel",setup(e){const t=f(!1),n=f(!1);async function i(){await mF.hangup()}function r(){mF.switchDevice("video",VP.value),t.value=!1}function o(){mF.switchDevice("audio",qP.value),n.value=!1}async function a(){var e;if(null!=(e=JP.value)&&e.camera)await mF.closeCamera();else{const e=WP.value?"local-group":"local-c2c";await mF.openCamera(e)}}async function s(){var e;null!=(e=JP.value)&&e.microphone?await mF.closeMicrophone():await mF.openMicrophone()}async function c(){await mF.setVideoQuality(xP.value)}async function u(){await mF.switchCallMediaType()}function l(){mF.accept()}function p(){mF.reject()}return d((()=>{document.documentElement.addEventListener("click",(e=>{t.value=!1,n.value=!1}))})),(e,t)=>(w(),A("div",Hx,[z(P("div",null,L(H(KP)),513),[[W,H(kU)&&H(HP)===H(AP).DIALING_C2C&&H(zP)===H(LP).VIDEO]]),P("div",jx,[H(HP)===H(AP).BE_INVITED?(w(),A(_,{key:0},[M(ox,{action:p,isMobile:H(kU),size:H(kU)?"medium":"small"},{text:K((()=>[oe(L(H(ZP)("reject")),1)])),icon:K((()=>[M(ux)])),_:1},8,["isMobile","size"]),M(ox,{action:l,isMobile:H(kU),size:H(kU)?"medium":"small"},{text:K((()=>[oe(L(H(ZP)("accept")),1)])),icon:K((()=>[H(zP)===H(LP).AUDIO?(w(),j(hx,{key:0})):H(zP)===H(LP).VIDEO?(w(),j(vx,{key:1})):O("",!0)])),_:1},8,["isMobile","size"])],64)):"idle"!==H(HP)?(w(),A(_,{key:1},[H(zP)===H(LP).VIDEO?(w(),j(ox,{key:0,action:a,hasDetail:!H(kU),isMobile:H(kU),size:H(kU)?"medium":"small"},{text:K((()=>{var e;return[oe(L(null!=(e=H(JP))&&e.camera?H(ZP)("camera-opened"):H(ZP)("camera-closed")),1)]})),icon:K((()=>{var e,t;return[null!=(e=H(JP))&&e.camera?(w(),j(Mx,{key:0})):O("",!0),null!=(t=H(JP))&&t.camera?O("",!0):(w(),j(Bx,{key:1}))]})),detail:K((()=>{var e;return[P("div",Kx,[P("div",null,L(H(ZP)("camera")),1),z(P("select",{class:"device-select","onUpdate:modelValue":t[0]||(t[0]=e=>I(VP)?VP.value=e:null),onChange:r,onClick:t[1]||(t[1]=e=>H(mF).updateCameraList())},[P("option",zx,L(H(GP)&&(null==(e=H(GP)[0])?void 0:e.label)),1),(w(!0),A(_,null,R(H(GP),(e=>(w(),A("option",{value:e.deviceId,key:e.deviceId},L(e.label),9,Wx)))),128))],544),[[Ne,H(VP)]])]),H(HP)===H(AP).DIALING_C2C?(w(),A("div",Yx,[P("div",null,L(H(ZP)("image-resolution")),1),z(P("select",{class:"device-select","onUpdate:modelValue":t[2]||(t[2]=e=>I(xP)?xP.value=e:null),onChange:c},[P("option",$x,L(H(ZP)("default-image-resolution")),1),P("option",{value:H(EP).RESOLUTION_480P,selected:""}," 480p ",8,Jx),P("option",{value:H(EP).RESOLUTION_720P,selected:""}," 720p ",8,Xx),P("option",{value:H(EP).RESOLUTION_1080P,selected:""}," 1080p ",8,Zx)],544),[[Ne,H(xP)]])])):O("",!0)]})),_:1},8,["hasDetail","isMobile","size"])):O("",!0),M(ox,{action:s,hasDetail:!H(kU),isMobile:H(kU),size:H(kU)?"medium":"small"},{text:K((()=>{var e;return[oe(L(null!=(e=H(JP))&&e.microphone?H(ZP)("microphone-opened"):H(ZP)("microphone-closed")),1)]})),icon:K((()=>{var e,t;return[null!=(e=H(JP))&&e.microphone?(w(),j(Ex,{key:0})):O("",!0),null!=(t=H(JP))&&t.microphone?O("",!0):(w(),j(Gx,{key:1}))]})),detail:K((()=>{var e;return[P("div",null,[oe(L(H(ZP)("microphone"))+" ",1),z(P("select",{class:"device-select","onUpdate:modelValue":t[3]||(t[3]=e=>I(qP)?qP.value=e:null),onChange:o,onClick:t[4]||(t[4]=e=>H(mF).updateMicrophoneList())},[P("option",Qx,L(H(FP)&&(null==(e=H(FP)[0])?void 0:e.label)),1),(w(!0),A(_,null,R(H(FP),(e=>(w(),A("option",{value:e.deviceId,key:e.deviceId},L(e.label),9,eG)))),128))],544),[[Ne,H(qP)]])])]})),_:1},8,["hasDetail","isMobile","size"]),O("",!0),"calling-c2c-video"===H(HP)?z((w(),j(ox,{key:2,action:u},{text:K((()=>[oe(L(H(ZP)("video-to-audio")),1)])),icon:K((()=>[M(Ax)])),_:1},512)),[[W,!H(kU)]]):O("",!0),z(M(ox,{action:i},{text:K((()=>[oe(L(H(kU)?"":H(ZP)("hangup")),1)])),icon:K((()=>[M(Nx)])),_:1},512),[[W,!H(kU)]])],64)):O("",!0)]),H(HP)!==H(AP).IDLE&&H(HP)!==H(AP).BE_INVITED?(w(),A("div",tG,[z(M(ox,{action:i,size:H(kU)?"large":"small"},{text:K((()=>[oe(L(H(kU)?"":H(ZP)("hangup")),1)])),icon:K((()=>[M(Nx)])),_:1},8,["size"]),[[W,H(kU)]])])):O("",!0)]))}}),iG=IU(nG,[["__scopeId","data-v-b0f0172b"]]),rG={},oG={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 15 24",class:"design-iconfont"},aG=[P("path",{d:"M13.8431 1.14248C14.6564 1.93792 14.7145 3.1923 14.0174 4.0533L13.8431 4.24463L5.91455 11.9997L13.8431 19.7554C14.6564 20.5508 14.7145 21.8052 14.0174 22.6662L13.8431 22.8575C13.0299 23.653 11.7475 23.7098 10.8672 23.028L10.6716 22.8575L1.15685 13.5511C0.343607 12.7556 0.285517 11.5013 0.982587 10.6402L1.15685 10.4489L10.6716 1.14248C11.5474 0.285841 12.9673 0.285841 13.8431 1.14248Z",fill:"#fff"},null,-1)];const sG=IU(rG,[["render",function(e,t){return w(),A("svg",oG,aG)}]]),cG={},uG={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 15 24",class:"design-iconfont"},lG=[P("path",{d:"M1.15685 1.14248C0.343606 1.93792 0.285517 3.1923 0.982587 4.0533L1.15685 4.24463L9.08545 11.9997L1.15685 19.7554C0.343606 20.5508 0.285517 21.8052 0.982587 22.6662L1.15685 22.8575C1.9701 23.653 3.25255 23.7098 4.13282 23.028L4.32843 22.8575L13.8431 13.5511C14.6564 12.7556 14.7145 11.5013 14.0174 10.6402L13.8431 10.4489L4.32843 1.14248C3.45262 0.285841 2.03266 0.285841 1.15685 1.14248Z",fill:"#fff"},null,-1)];const dG=IU(cG,[["render",function(e,t){return w(),A("svg",uG,lG)}]]),pG={class:"calling-wrapper"},hG={class:"turn-icon-container"},fG={class:"turn-icon-container"},gG={class:"tag"},mG={class:"microphone-icon-container"},vG=["id"],_G={key:0,class:"user-view-text-container"},yG={class:"user-view-info"},IG={class:"tag"},MG={class:"microphone-icon-container"},TG=S({__name:"Calling-Group",setup(e){const t=f(1),n=f([]),i=f("group-user-view"),r=f("group-calling-container"),o=f("user-view-user-id");function a(){t.value>1&&t.value--}function s(){t.value<Math.floor((YP.value.length-1)/8+1)&&t.value++}return d((async()=>{(HP.value===AP.CALLING_GROUP_VIDEO||HP.value===AP.CALLING_GROUP_AUDIO)&&await mF.renderLocal(),await mF.renderRemoteWaitList()})),v(n,(async()=>{const e=n.value.length+1;i.value=`group-user-view group-user-view-${e}`,r.value=`group-calling-container group-calling-container-${e}`,o.value=`user-view-user-id user-view-user-id-${e}`,mF.renderRemoteList(n.value)}),{flush:"post",deep:!0}),k((async()=>{await async function(){let e=[];for(let n=8*(t.value-1);n<8*t.value&&n<YP.value.length;n++)e.push(YP.value[n]);n.value=e}()})),(e,t)=>{var c,u;return w(),A("div",pG,[H(YP).length>8?(w(),A(_,{key:0},[P("div",{class:"page-turn left",onClick:a},[P("div",hG,[M(sG)])]),P("div",{class:"page-turn right",onClick:s},[P("div",fG,[M(dG)])])],64)):O("",!0),P("div",{class:G(r.value)},[P("div",{id:"local-group",class:G(i.value)},[P("span",gG,[P("div",mG,[null!=(c=H(JP))&&c.microphone?(w(),j(MU,{key:0,volume:H(cU)(H(JP).userID)},null,8,["volume"])):(w(),j(EU,{key:1}))]),oe(" "+L(`${null==(u=H(JP))?void 0:u.nick} ${H(ZP)("me")}`),1)])],2),(w(!0),A(_,null,R(n.value,(e=>(w(),A("div",{class:G(i.value),id:e.userID,key:e.userID},[!e.isEntered||H(WP)&&H(zP)===H(LP).AUDIO?(w(),A("div",_G,[P("div",{class:G(o.value)},L(null==e?void 0:e.nick),3),P("div",yG,L(e.isEntered?H(ZP)("already-enter"):H(ZP)("waiting")),1)])):O("",!0),P("span",IG,[P("div",MG,[null!=e&&e.microphone?(w(),j(MU,{key:0,volume:H(cU)(null==e?void 0:e.userID)},null,8,["volume"])):(w(),j(EU,{key:1}))]),oe(" "+L(null==e?void 0:e.nick),1)])],10,vG)))),128))],2)])}}}),CG=IU(TG,[["__scopeId","data-v-f5cadefc"]]),SG={},EG={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",class:"design-iconfont"},kG=[P("path",{d:"M13.733 6.99996C13.7997 6.99996 13.933 6.99996 13.9997 6.93329C14.133 6.86663 14.2663 6.73329 14.333 6.59996C14.3997 6.46663 14.3997 6.26663 14.333 6.06663C14.2663 5.99996 14.2663 5.93329 14.1997 5.86663L10.1997 1.86663C9.93301 1.59996 9.53301 1.59996 9.26634 1.86663C8.99967 2.13329 8.99967 2.53329 9.26634 2.79996L12.133 5.66663H1.99967C1.59967 5.66663 1.33301 5.93329 1.33301 6.33329C1.33301 6.73329 1.59967 6.99996 1.99967 6.99996H13.733ZM13.9997 8.99996H2.26634C2.19967 8.99996 2.06634 8.99996 1.99967 9.06663C1.86634 9.13329 1.73301 9.26663 1.66634 9.39996C1.59967 9.53329 1.59967 9.73329 1.66634 9.93329C1.73301 9.99996 1.73301 10.0666 1.79967 10.1333L5.79967 14.1333C5.93301 14.2666 6.13301 14.3333 6.26634 14.3333C6.39967 14.3333 6.59967 14.2666 6.73301 14.1333C6.99967 13.8666 6.99967 13.4666 6.73301 13.2L3.86634 10.3333H13.9997C14.3997 10.3333 14.6663 10.0666 14.6663 9.66663C14.6663 9.26663 14.3997 8.99996 13.9997 8.99996Z",fill:"#fff"},null,-1)];const bG=IU(SG,[["render",function(e,t){return w(),A("svg",EG,kG)}]]),DG={class:"calling-wrapper"},wG={class:"tag"},AG={class:"microphone-icon-container"},RG=["id"],LG={class:"tag"},OG={class:"microphone-icon-container"},NG=S({__name:"Calling-C2CVideo",setup(e){d((async()=>{await mF.renderLocal(),await mF.renderRemoteWaitList()}));const t=f("small"),n=f("small-h5"),i=f("large"),r=async()=>{if(kU)[n.value,i.value]=[i.value,n.value];else{[t.value,i.value]=[i.value,t.value],await N();const e=document.getElementsByClassName("large")[0],n=document.getElementsByClassName("small")[0];n.style.height="170px",n.style.width="260px",e.style.height="100%",e.style.width="100%"}},o=async()=>{kU&&r()};return(e,a)=>{var s,c,u,l,d;return w(),A("div",DG,[P("div",{id:"local-c2c",class:G(H(kU)?n.value:t.value),onClick:o},[z(P("span",wG,[P("div",AG,[null!=(s=H(JP))&&s.microphone?(w(),j(MU,{key:0,volume:H(cU)(H(JP).userID)},null,8,["volume"])):(w(),j(EU,{key:1}))]),oe(" "+L(`${null==(c=H(JP))?void 0:c.nick} ${H(ZP)("me")}`),1)],512),[[W,!H(kU)]]),z(P("div",{class:"switch-large-small",onClick:r},[M(bG)],512),[[W,!H(kU)]])],2),H(YP).length>=1?(w(),A("div",{key:0,id:H(YP)[0].userID,class:G(i.value),onClick:o},[z(P("span",LG,[P("div",OG,[null!=(u=H(YP)[0])&&u.microphone?(w(),j(MU,{key:0,volume:H(cU)(null==(l=H(YP)[0])?void 0:l.userID)},null,8,["volume"])):(w(),j(EU,{key:1}))]),oe(" "+L(null==(d=H(YP)[0])?void 0:d.nick),1)],512),[[W,!H(kU)]]),z(P("div",{class:"switch-large-small",onClick:r},[M(bG)],512),[[W,!H(kU)]])],10,RG)):O("",!0)])}}}),PG=IU(NG,[["__scopeId","data-v-be0037c8"]]),UG={},xG={width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},GG=[P("rect",{x:"0.769231",y:"0.769231",width:"18.4615",height:"18.4615",rx:"0.769231",stroke:"white","stroke-width":"1.53846"},null,-1),P("path",{d:"M11.5385 12.3077C11.5385 11.8829 11.8829 11.5385 12.3077 11.5385H19.2308V18.4615C19.2308 18.8864 18.8864 19.2308 18.4616 19.2308H11.5385V12.3077Z",stroke:"white","stroke-width":"1.53846"},null,-1),P("path",{d:"M0.769287 0.769226L8.9723 8.92412",stroke:"white","stroke-width":"1.53846"},null,-1),P("path",{d:"M9.4967 4.71716V9.4486H4.74146",stroke:"white","stroke-width":"1.53846","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)];const FG=IU(UG,[["render",function(e,t){return w(),A("svg",xG,GG)}]]),VG={},qG={width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},BG=[P("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.66683 9.33337H3.3335V4.00004C3.3335 3.63185 3.63197 3.33337 4.00016 3.33337L9.3335 3.33337V4.66671H5.60963L9.8049 8.86199L8.86209 9.8048L4.66683 5.60952V9.33337ZM15.3333 10.6667H16.6667V16C16.6667 16.3682 16.3682 16.6667 16 16.6667L10.6667 16.6667L10.6667 15.3333H14.3905L10.1953 11.138L11.1381 10.1952L15.3333 14.3905V10.6667Z",fill:"white"},null,-1),P("path",{d:"M0.666667 1.33333C0.666667 0.965144 0.965144 0.666667 1.33333 0.666667H18.6667C19.0349 0.666667 19.3333 0.965144 19.3333 1.33333V18.6667C19.3333 19.0349 19.0349 19.3333 18.6667 19.3333H1.33333C0.965143 19.3333 0.666667 19.0349 0.666667 18.6667V1.33333Z",stroke:"white","stroke-width":"1.33333"},null,-1)];const HG=IU(VG,[["render",function(e,t){return w(),A("svg",qG,BG)}]]),jG={key:0,class:"tui-call-kit",id:"tui-call-kit-id"},KG={class:"function-buttons"},zG=S({__name:"TUICallKit",props:{beforeCalling:null,afterCalling:null,onMinimized:null,onMessageSentByMe:null,allowedMinimized:{type:Boolean,default:!1},allowedFullScreen:{type:Boolean,default:!0},videoDisplayMode:{default:SP.COVER},videoResolution:{default:EP.RESOLUTION_480P},lang:{default:"zh-cn"}},emits:["kicked-out","status-changed"],setup(e,{emit:t}){const n=e;NP.value=t;const{beforeCalling:i,afterCalling:r,onMinimized:o,onMessageSentByMe:a,allowedMinimized:s,allowedFullScreen:c,videoDisplayMode:u,videoResolution:l}=b(n);function d(){document.fullscreenElement&&document.exitFullscreen(),mF.toggleMinimize()}function p(){let e=document.getElementById("tui-call-kit-id");document.fullscreenElement?document.exitFullscreen():e.requestFullscreen().catch((e=>{alert(`Error attempting to enable fullscreen mode: ${e.message} (${e.name})`)}))}return k((()=>{mF.setCallback({beforeCalling:i&&i.value,afterCalling:r&&r.value,onMinimized:o&&o.value,onMessageSentByMe:a&&a.value}),UP.value=u.value,xP.value=l.value})),(e,t)=>H(HP)!==H(AP).IDLE?z((w(),A("div",jG,[P("div",KG,[H(HP)!==H(AP).IDLE&&!0===H(s)&&H(HP)!==H(AP).DIALING_C2C&&H(HP)!==H(AP).DIALING_GROUP&&H(HP)!==H(AP).BE_INVITED?(w(),A("div",{key:0,class:"minimize",onClick:d},[M(FG)])):O("",!0),!0===H(c)?(w(),A("div",{key:1,class:"minimize",onClick:p},[M(HG)])):O("",!0)]),H(HP)===H(AP).BE_INVITED||H(HP)===H(AP).DIALING_C2C||H(HP)===H(AP).CALLING_C2C_AUDIO?(w(),j(JU,{key:0})):O("",!0),H(HP)===H(AP).CALLING_C2C_VIDEO?(w(),j(PG,{key:1})):O("",!0),H(HP)===H(AP).DIALING_GROUP||H(HP)===H(AP).CALLING_GROUP_AUDIO||H(HP)===H(AP).CALLING_GROUP_VIDEO?(w(),j(CG,{key:2})):O("",!0),H(HP)!==H(AP).IDLE?(w(),j(iG,{key:3})):O("",!0)],512)),[[W,!H(jP)]]):O("",!0)}}),WG=IU(zG,[["__scopeId","data-v-e5973e5d"]]),YG={},$G={width:"26",height:"26",viewBox:"0 0 26 26",fill:"none",xmlns:"http://www.w3.org/2000/svg"},JG=[P("path",{d:"M18.4437 12.449C18.4437 14.1142 18.2336 15.3515 21.5089 15.7126C24.7875 16.0737 24.3666 13.6794 24.3662 12.0669C24.3649 10.2061 20.0602 7.61895 13.2726 7.6173C6.48662 7.61735 2.1789 10.205 2.17888 12.067C2.17887 13.68 1.75621 16.0726 5.03315 15.7123C8.31009 15.3537 8.10005 14.1155 8.09837 12.4495C8.10134 11.2862 10.7587 11.0316 13.2725 11.0298C15.7863 11.0281 18.4454 11.2844 18.4437 12.449Z",fill:"#FE3C44"},null,-1)];const XG=IU(YG,[["render",function(e,t){return w(),A("svg",$G,JG)}]]),ZG={},QG={width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},eF=[P("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.66666 4.16668C6.66666 2.32834 8.16166 0.833344 9.99999 0.833344C11.8383 0.833344 13.3333 2.32834 13.3333 4.16668V9.16668C13.3333 11.005 11.8383 12.5 9.99999 12.5C8.16166 12.5 6.66666 11.005 6.66666 9.16668V4.16668ZM6.66666 18.3333C6.66666 17.8725 7.03999 17.5 7.49999 17.5H12.5C12.9608 17.5 13.3333 17.8725 13.3333 18.3333C13.3333 18.7942 12.9608 19.1667 12.5 19.1667H7.49999C7.03999 19.1667 6.66666 18.7942 6.66666 18.3333Z",fill:"#101419"},null,-1),P("path",{d:"M15.8333 8.3512V9.50825C15.8333 12.081 13.2217 15 9.99999 15C6.77833 15 4.16666 12.081 4.16666 9.50825V8.33334",stroke:"#101419","stroke-width":"1.66667","stroke-linecap":"round"},null,-1)];const tF=IU(ZG,[["render",function(e,t){return w(),A("svg",QG,eF)}]]),nF={},iF={width:"15",height:"21",viewBox:"0 0 15 21",fill:"none",xmlns:"http://www.w3.org/2000/svg"},rF=[P("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.6247 0.719168C14.1934 0.374158 13.5641 0.44408 13.2191 0.875342L10.8168 3.83203C10.1789 3.02455 9.15387 2.50004 8.00001 2.50004C6.06976 2.50004 4.50001 3.96785 4.50001 5.77276V10.6819C4.50001 10.9563 4.5363 11.2229 4.60463 11.4778L3.388 12.9752C2.98449 12.3433 2.75001 11.6522 2.75001 10.9717V9.81819L2.74319 9.71556C2.6892 9.31213 2.32108 9.00001 1.87501 9.00001C1.39176 9.00001 1.00001 9.36632 1.00001 9.81819V10.9717L1.00466 11.1761C1.05557 12.2968 1.52161 13.4016 2.26939 14.3519L0.219137 16.8753L0.146861 16.9782C-0.112977 17.4017 -0.0227767 17.9624 0.375311 18.2809C0.806573 18.6259 1.43587 18.556 1.78088 18.1247L3.71661 15.7423C3.71849 15.7437 3.72038 15.745 3.72227 15.7464L4.2997 15.0246L8.28088 10.1247L14.7809 2.12473L14.8532 2.02191C15.113 1.59834 15.0228 1.03764 14.6247 0.719168ZM7.72499 13.9446L11.5 9.22582V10.6819C11.5 12.4868 9.93026 13.9546 8.00001 13.9546C7.90746 13.9546 7.81575 13.9512 7.72499 13.9446ZM6.60445 15.3453L5.50798 16.7159C6.29225 17.0136 7.13532 17.1818 8.00001 17.1818C11.6976 17.1818 15 14.1064 15 10.9717V9.83572L14.9932 9.73309C14.9392 9.32966 14.5711 9.01754 14.125 9.01754C13.6418 9.01754 13.25 9.38385 13.25 9.83572V10.9717L13.2445 11.1527C13.1138 13.3262 10.6589 15.5455 8.00001 15.5455C7.52424 15.5455 7.05501 15.4744 6.60445 15.3453ZM5.37501 18.8637C4.89201 18.8637 4.50001 19.2294 4.50001 19.6819C4.50001 20.1343 4.89201 20.5 5.37501 20.5H10.625C11.1089 20.5 11.5 20.1343 11.5 19.6819C11.5 19.2294 11.1089 18.8637 10.625 18.8637H5.37501Z",fill:"#101419"},null,-1)];const oF=IU(nF,[["render",function(e,t){return w(),A("svg",iF,rF)}]]),aF={},sF={width:"21",height:"21",viewBox:"0 0 21 21",fill:"none",xmlns:"http://www.w3.org/2000/svg"},cF=[P("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M2.33337 9.33331H0.333374V0.99998C0.333374 0.63179 0.631851 0.333313 1.00004 0.333313L9.33338 0.333313V2.33331H3.74758L10.0405 8.62624L8.62627 10.0404L2.33337 3.74753V9.33331ZM18.3331 11.3333H20.3331V19.6666C20.3331 20.0348 20.0347 20.3333 19.6665 20.3333L11.3331 20.3333L11.3331 18.3333H16.9189L10.626 12.0403L12.0402 10.6261L18.3331 16.919V11.3333Z",fill:"#101419"},null,-1)];const uF=IU(aF,[["render",function(e,t){return w(),A("svg",sF,cF)}]]),lF={key:0,class:"float-control-panel"},dF={class:"float-control-item-icon"},pF={class:"float-control-item-icon"},hF={class:"float-control-item-icon"},fF=S({__name:"TUICallKitMini",setup(e){function t(){mF.toggleMinimize()}async function n(){await mF.hangup()}async function i(){var e;null!=(e=JP.value)&&e.microphone?await mF.closeMicrophone():await mF.openMicrophone()}return(e,r)=>{var o,a;return H(HP)!==H(AP).IDLE?z((w(),A("div",lF,[P("div",dF,[P("div",{class:"float-control-item-icon-container",onClick:n},[M(XG)])]),P("div",pF,[P("div",{class:"float-control-item-icon-container",onClick:i},[null!=(o=H(JP))&&o.microphone?(w(),j(tF,{key:0})):O("",!0),null!=(a=H(JP))&&a.microphone?O("",!0):(w(),j(oF,{key:1}))])]),P("div",hF,[P("div",{class:"float-control-item-icon-container",onClick:t},[M(uF)])])],512)),[[W,H(jP)]]):O("",!0)}}}),gF=IU(fF,[["__scopeId","data-v-9c84be0f"]]),mF=new class{constructor(){CP(this,"SDKAppID"),CP(this,"tuiCallEngine"),CP(this,"TUICore"),CP(this,"version"),CP(this,"beforeCalling"),CP(this,"afterCalling"),CP(this,"onMinimized"),CP(this,"onMessageSentByMe"),CP(this,"statusChanged"),CP(this,"error"),CP(this,"tim"),CP(this,"userID"),this.TUICore=null,this.tuiCallEngine=null,this.SDKAppID=0,this.version=uU,this.userID=""}async init(e){let{SDKAppID:t,tim:n}=e;const{userID:i,userSig:r,assetsPath:o}=e;this.TUICore&&(t=this.TUICore.SDKAppID,n=this.TUICore.tim),this.tim=n,this.SDKAppID=t,this.userID=i;try{null!==this.tuiCallEngine&&this.unbindTIMEvent(),this.tuiCallEngine=lP.TUICallEngine.createInstance({SDKAppID:t,tim:n}),this.bindTIMEvent(),await this.tuiCallEngine.login({userID:i,userSig:r,assetsPath:o})}catch(a){throw a}}async call(e){this.checkStatus();const{userID:t,type:n,timeout:i,offlinePushInfo:r}=e;try{aU([{userID:t,isEntered:!1}]),iU(n),rU(!1),QP(AP.DIALING_C2C),await this.tuiCallEngine.call({userID:t,type:n,timeout:i,offlinePushInfo:r}),await this.setDefaultDevice({camera:n===lP.TUICallType.VIDEO_CALL}),await this.renderLocal(),this.beforeCalling&&this.beforeCalling("call")}catch(o){throw this.error&&this.beforeCalling&&this.beforeCalling("call",this.error),this.error=null,await QP(AP.IDLE,RP.CALL_ERROR,1e3),o}}async groupCall(e){this.checkStatus();const{userIDList:t,type:n,groupID:i,timeout:r,offlinePushInfo:o,roomID:a}=e;try{aU(t.map((e=>({userID:e,isEntered:!1})))),iU(n),rU(!0),QP(AP.DIALING_GROUP),await this.tuiCallEngine.groupCall({userIDList:t,type:n,groupID:i,timeout:r,offlinePushInfo:o,roomID:a}),await this.setDefaultDevice({camera:n===lP.TUICallType.VIDEO_CALL}),await this.renderLocal(),this.beforeCalling&&this.beforeCalling("groupCall")}catch(s){throw this.error&&this.beforeCalling&&this.beforeCalling("groupCall",this.error),this.error=null,QP(AP.IDLE),s}}async joinInGroupCall(e){const{roomID:t,type:n,groupID:i}=e;await this.tuiCallEngine.joinInGroupCall({roomID:t,type:n,groupID:i}),this.beforeCalling&&this.beforeCalling("groupCall"),QP(AP.DIALING_GROUP),iU(n),rU(!0),this.getIntoCallingStatus()}checkStatus(){if(HP.value!==AP.IDLE)throw new Error(ZP("is-already-calling"));if(!this.tuiCallEngine)throw new Error(ZP("need-init"))}async updateCameraList(){GP.value=await this.tuiCallEngine.getDeviceList("camera")}async updateMicrophoneList(){FP.value=await this.tuiCallEngine.getDeviceList("microphones")}async setDefaultDevice(e){var t,n;try{await this.updateMicrophoneList(),FP.value.length>0&&(-1===FP.value.findIndex((e=>e.deviceId===VP.value))||""===qP.value)&&await this.switchDevice("audio",null==(t=FP.value[0])?void 0:t.deviceId)}catch(i){}try{if(!e.camera)return;await this.updateCameraList(),GP.value.length>0&&(-1===GP.value.findIndex((e=>e.deviceId===VP.value))||""===VP.value)&&await this.switchDevice("video",null==(n=GP.value[0])?void 0:n.deviceId)}catch(i){}}async switchDevice(e,t){try{await this.tuiCallEngine.switchDevice({deviceType:e,deviceId:t}),"video"===e&&(VP.value=t),"audio"===e&&(qP.value=t),await this.setVideoQuality(xP.value)}catch(n){}}bindTUICore(e){this.TUICore=e}setCallback(e){const{beforeCalling:t,afterCalling:n,onMinimized:i,onMessageSentByMe:r}=e;t&&(this.beforeCalling=t),n&&(this.afterCalling=n),i&&(this.onMinimized=i),r&&(this.onMessageSentByMe=r)}setLanguage(e){var t;"en"!==e&&"zh-cn"!==e&&(e="en"),t=e,PP.value=t}toggleMinimize(){var e;this.onMinimized&&this.onMinimized(jP.value,!jP.value),e=!jP.value,jP.value=e}async accept(){if(HP.value!==AP.BE_INVITED)throw new Error("[TUICallKit] accept() should be called when be invited. 此接口应该在收到通话邀请时使用。");try{await this.tuiCallEngine.accept(),this.getIntoCallingStatus(),await this.setDefaultDevice({camera:zP.value===LP.VIDEO})}catch(ok){throw"TUICallEngine.accept failed, error: Error: NotAllowedError: Permission denied"===(null==ok?void 0:ok.message)?await QP(AP.IDLE,RP.ACCEPT_DEVICE_ERROR,1e3):await QP(AP.IDLE,RP.ACCEPT_ERROR,1e3),await this.tuiCallEngine.reject(),ok}}async reject(){if(HP.value!==AP.BE_INVITED)throw new Error("[TUICallKit] reject() should be called when be invited. 此接口应该在收到通话邀请时使用。");try{await this.tuiCallEngine.reject()}catch(ok){}QP(AP.IDLE)}async startLocalView(e){await this.tuiCallEngine.startLocalView({userID:JP.value.userID,videoViewDomID:e})}async stopLocalView(){await this.tuiCallEngine.stopLocalView({userID:JP.value.userID})}async startRemoteView(e){if(e&&document.getElementById(e))try{await this.tuiCallEngine.startRemoteView({userID:e,videoViewDomID:e,options:{objectFit:UP.value}})}catch(t){}}async stopRemoteView(e){await this.tuiCallEngine.stopRemoteView({userID:e})}async hangup(){if(HP.value==AP.BE_INVITED||HP.value===AP.IDLE)throw new Error("[TUICallKit] hangup() should be called when be dialing or calling status. 此接口应该在呼叫状态或在接通状态使用。");try{await this.tuiCallEngine.hangup()}catch(ok){throw ok}QP(AP.IDLE)}async renderLocal(){if(HP.value!==AP.IDLE&&(JP.value.microphone?this.openMicrophone():this.closeMicrophone(),zP.value===LP.VIDEO)){let e=WP.value?"local-group":"local-c2c";HP.value===AP.DIALING_C2C&&(e="local-dialing"),JP.value.camera?this.openCamera(e):this.closeCamera()}}async renderRemoteWaitList(){for(;BP.value.size>0;){const e=BP.value.values().next().value;await this.startRemoteView(e),BP.value.delete(e)}}async renderRemoteList(e){for(let t=0;t<e.length;t++){const{userID:n,isEntered:i,isReadyRender:r}=e[t];i&&r&&await this.startRemoteView(n)}}async openCamera(e){try{await this.tuiCallEngine.openCamera(e),sU(Object.assign(JP.value,{camera:!0}))}catch(t){}}async closeCamera(){try{await this.tuiCallEngine.closeCamera(),sU(Object.assign(JP.value,{camera:!1}))}catch(ok){}}async openMicrophone(){try{await this.tuiCallEngine.openMicrophone(),sU(Object.assign(JP.value,{microphone:!0}))}catch(ok){sU(Object.assign(JP.value,{microphone:!1}))}}async closeMicrophone(){try{await this.tuiCallEngine.closeMicrophone(),sU(Object.assign(JP.value,{microphone:!1}))}catch(ok){}}async setVideoQuality(e){await this.tuiCallEngine.setVideoQuality(e),xP.value=e}async switchCallMediaType(){try{await this.tuiCallEngine.switchCallMediaType(lP.TUICallType.AUDIO_CALL)}catch(ok){}}onStatusChanged(e){this.statusChanged=e}async enableAIVoice(e){try{this.tuiCallEngine.enableAIVoice(e)}catch(t){throw t}}async inviteUser(e){const{userIDList:t=[]}=e;try{this.tuiCallEngine&&await this.tuiCallEngine.inviteUser(e);const n=YP.value;t.forEach((e=>{n.push({userID:e,isEntered:!1})})),aU(n)}catch(n){throw n}}getTim(){return this.tim?this.tim:this.tuiCallEngine?this.tuiCallEngine.tim:null}async destroyed(){try{if(HP.value!==AP.IDLE)throw new Error(`please destroyed when status is calling end (idle), now status: ${HP.value}`);this.unbindTIMEvent(),this.tuiCallEngine&&await this.tuiCallEngine.destroyInstance()}catch(ok){throw ok}}getIntoCallingStatus(){!WP.value&&zP.value===LP.AUDIO&&QP(AP.CALLING_C2C_AUDIO),!WP.value&&zP.value===LP.VIDEO&&QP(AP.CALLING_C2C_VIDEO),WP.value&&zP.value===LP.AUDIO&&QP(AP.CALLING_GROUP_AUDIO),WP.value&&zP.value===LP.VIDEO&&QP(AP.CALLING_GROUP_VIDEO)}bindTIMEvent(){this.tuiCallEngine.on(lP.TUICallEvent.ERROR,this.handleError,this),this.tuiCallEngine.on(lP.TUICallEvent.SDK_READY,this.handleSDKReady,this),this.tuiCallEngine.on(lP.TUICallEvent.INVITED,this.handleInvited,this),this.tuiCallEngine.on(lP.TUICallEvent.USER_ACCEPT,this.handleUserAccept,this),this.tuiCallEngine.on(lP.TUICallEvent.USER_ENTER,this.handleUserEnter,this),this.tuiCallEngine.on(lP.TUICallEvent.USER_LEAVE,this.handleUserLeave,this),this.tuiCallEngine.on(lP.TUICallEvent.REJECT,this.handleReject,this),this.tuiCallEngine.on(lP.TUICallEvent.NO_RESP,this.handleNoResponse,this),this.tuiCallEngine.on(lP.TUICallEvent.LINE_BUSY,this.handleLineBusy,this),this.tuiCallEngine.on(lP.TUICallEvent.CALLING_CANCEL,this.handleCallingCancel,this),this.tuiCallEngine.on(lP.TUICallEvent.KICKED_OUT,this.handleKickedOut,this),this.tuiCallEngine.on(lP.TUICallEvent.CALLING_TIMEOUT,this.handleCallingTimeOut,this),this.tuiCallEngine.on(lP.TUICallEvent.CALLING_END,this.handleCallingEnd,this),this.tuiCallEngine.on(lP.TUICallEvent.USER_VIDEO_AVAILABLE,this.handleUserVideoAvailable,this),this.tuiCallEngine.on(lP.TUICallEvent.USER_AUDIO_AVAILABLE,this.handleUserAudioAvailable,this),this.tuiCallEngine.on(lP.TUICallEvent.USER_VOICE_VOLUME,this.handleUserVoiceVolume,this),this.tuiCallEngine.on(lP.TUICallEvent.CALL_TYPE_CHANGED,this.handleCallTypeChanged,this),this.tuiCallEngine.on(lP.TUICallEvent.MESSAGE_SENT_BY_ME,this.handleMessageSentByMe,this)}unbindTIMEvent(){this.tuiCallEngine.off(lP.TUICallEvent.ERROR,this.handleError,this),this.tuiCallEngine.off(lP.TUICallEvent.SDK_READY,this.handleSDKReady,this),this.tuiCallEngine.off(lP.TUICallEvent.INVITED,this.handleInvited),this.tuiCallEngine.off(lP.TUICallEvent.USER_ACCEPT,this.handleUserAccept),this.tuiCallEngine.off(lP.TUICallEvent.USER_ENTER,this.handleUserEnter,this),this.tuiCallEngine.off(lP.TUICallEvent.USER_LEAVE,this.handleUserLeave,this),this.tuiCallEngine.off(lP.TUICallEvent.REJECT,this.handleReject,this),this.tuiCallEngine.off(lP.TUICallEvent.NO_RESP,this.handleNoResponse,this),this.tuiCallEngine.off(lP.TUICallEvent.LINE_BUSY,this.handleLineBusy,this),this.tuiCallEngine.off(lP.TUICallEvent.CALLING_CANCEL,this.handleCallingCancel,this),this.tuiCallEngine.off(lP.TUICallEvent.KICKED_OUT,this.handleKickedOut,this),this.tuiCallEngine.off(lP.TUICallEvent.CALLING_TIMEOUT,this.handleCallingTimeOut,this),this.tuiCallEngine.off(lP.TUICallEvent.CALLING_END,this.handleCallingEnd,this),this.tuiCallEngine.off(lP.TUICallEvent.USER_VIDEO_AVAILABLE,this.handleUserVideoAvailable,this),this.tuiCallEngine.off(lP.TUICallEvent.USER_AUDIO_AVAILABLE,this.handleUserAudioAvailable,this),this.tuiCallEngine.off(lP.TUICallEvent.USER_VOICE_VOLUME,this.handleUserVoiceVolume,this),this.tuiCallEngine.off(lP.TUICallEvent.CALL_TYPE_CHANGED,this.handleCallTypeChanged,this),this.tuiCallEngine.off(lP.TUICallEvent.MESSAGE_SENT_BY_ME,this.handleMessageSentByMe,this)}handleError(e){const{code:t}=e;switch(this.error={code:t,type:"",message:""},t){case 60001:this.error.type=ZP("method-call-failed"),this.error.message=`switchToAudioCall ${ZP("call-failed")}`;break;case 60002:this.error.type=ZP("method-call-failed"),this.error.message=`switchToVideoCall ${ZP("call-failed")}`;break;case 60003:this.error.type=ZP("failed-to-obtain-permission"),this.error.message=ZP("microphone-unavailable");break;case 60004:this.error.type=ZP("failed-to-obtain-permission"),this.error.message=ZP("camera-unavailable");break;case 60005:this.error.type=ZP("failed-to-obtain-permission"),this.error.message=ZP("ban-device");break;case 60006:this.error.type=ZP("environment-detection-failed"),this.error.message=ZP("not-supported-webrtc")}HP.value===AP.BE_INVITED&&this.beforeCalling&&this.beforeCalling("invited",this.error),QP(AP.IDLE)}handleSDKReady(e){sU(Object.assign(JP.value,{userID:this.userID}))}handleKickedOut(e){this.unbindTIMEvent(),XP("kicked-out",e),QP(AP.IDLE)}async handleUserVideoAvailable(e){const{userID:t,isVideoAvailable:n}=e;(function(e,t){const n=YP.value.findIndex((t=>t.userID===e));n>=0&&(YP.value[n].isReadyRender=t)})(t,!0),tU(t,LP.VIDEO,n),n&&(document.getElementById(t)?await this.startRemoteView(t):BP.value.add(t))}handleUserAudioAvailable(e){const{userID:t,isAudioAvailable:n}=e;tU(t,LP.AUDIO,n)}handleUserVoiceVolume(e){const{volumeMap:t}=e;t.forEach((e=>{const{userId:t,audioVolume:n}=e;$P.value.set(t,n)}))}handleInvited(e){if(this.beforeCalling&&this.beforeCalling("invited",this.error),this.error)return this.reject(),void(this.error=null);const{sponsor:t,isFromGroup:n,inviteData:i}=e,{callType:r}=i;QP(AP.BE_INVITED),aU([{userID:t,isEntered:!1}]),iU(r),rU(n)}handleUserAccept(e){const{userID:t}=e;HP.value!==AP.BE_INVITED&&this.getIntoCallingStatus()}handleUserEnter(e){const{userID:t}=e;!function(e){const t=YP.value.findIndex((t=>t.userID===e));t>=0?YP.value[t].isEntered=!0:aU([...YP.value,{userID:e,isEntered:!0}])}(t)}handleUserLeave(e){const{userID:t}=e;eU(t)}handleReject(e){const{userID:t}=e;if(HP.value!==AP.BE_INVITED){if(HP.value===AP.CALLING_GROUP_AUDIO||HP.value===AP.CALLING_GROUP_VIDEO||HP.value===AP.DIALING_GROUP)return void eU(t);QP(AP.IDLE,RP.REJECT,1e3)}}handleNoResponse(e){const{userIDList:t}=e;t.forEach((e=>{eU(e)<=0&&QP(AP.IDLE,RP.NO_RESPONSE,WP.value?0:1e3)}))}handleLineBusy(e){const{userID:t}=e;eU(t)<=0&&QP(AP.IDLE,RP.LINE_BUSY,WP.value?0:1e3)}handleCallingCancel(e){QP(AP.IDLE,RP.CALLING_CANCEL,1e3)}handleCallingTimeOut(e){const{userIDList:t}=e;t.forEach((e=>{(eU(e)<=0||e===JP.value.userID)&&QP(AP.IDLE,RP.CALLING_TIMEOUT,WP.value?0:1e3)}))}handleCallingEnd(e){QP(AP.IDLE)}handleCallTypeChanged(e){const{newCallType:t}=e;iU(t)}handleMessageSentByMe(e){const t=null==e?void 0:e.data;this.onMessageSentByMe&&this.onMessageSentByMe(t)}};WG.plugin=e=>(e.component("TUICallKit",{server:mF}),e.component("TUICallKitMini",{server:mF}),mF.bindTUICore(e),WG),WG.install=e=>{e.component("TUICallKitMini",gF),e.component("TUICallKit",WG)},mF.version;const vF=S({props:{show:{type:Boolean,default:()=>!1},domClassName:{type:String,default:""}},setup(e,t){const n=E({show:!1,domClassName:"",startPosition:{left:"",top:"",cssText:""}});function i(e,n){let i=0;return function(...r){const o=+new Date;o-i>n&&(i=o,e.apply(t,r))}}return k((()=>{n.show=e.show,n.domClassName=e.domClassName})),d((()=>{const t=document.getElementsByClassName(e.domClassName?e.domClassName:"drag-container")[0];if(!t)return;let r=!1;v((()=>n.show),((e,i)=>{var r,o,a;n.show=e,e!==i&&!0===n.show&&(t.style.left=null==(r=n.startPosition)?void 0:r.left,t.style.top=null==(o=n.startPosition)?void 0:o.top,t.style.cssText=null==(a=n.startPosition)?void 0:a.cssText)}));t.addEventListener("mousedown",(e=>{r=!0;const n=e.clientX-t.offsetLeft,o=e.clientY-t.offsetTop,a=e=>{e.preventDefault(),r&&(t.style.left=e.clientX-n+"px",t.style.top=e.clientY-o+"px")};document.addEventListener("mousemove",i(a,20),!1),document.addEventListener("mouseup",(()=>{r=!1,document.removeEventListener("mousemove",a)}))}))})),{...b(n),throttle:i}}}),_F={class:"drag-container"};const yF=S({name:"chatView",components:{NavigationBar:Ue,Drag:D(vF,[["render",function(e,t,n,i,r,o){return z((w(),A("div",_F,[X(e.$slots,"default",{},void 0,!0)],512)),[[W,e.show]])}],["__scopeId","data-v-b0727fa8"]])},beforeCreate(){let e=Pe();if(e.user_login_status){const t=1400807426,n="c5b8e9dad518ccf326e1978d4aedb1c5d80fee9723c8a5710728577fbf501ff3",i=e.name.toString(),r=eA.init({SDKAppID:t});r.use(Kw),r.use(WG),r.login({userID:i,userSig:cP({SDKAppID:t,secretKey:n,userID:i}).userSig}),this.$myApp.config.globalProperties.$myApp.use(r)}else this.$router.push("/login")},setup(){var e;const t=E({env:zi(),currentModel:"conversation",showCall:!1,showCallMini:!1}),n=null==(e=null==window?void 0:window.TUIKitTUICore)?void 0:e.TUIServer;return{...b(t),handleCurrentConversation:e=>{t.currentModel=e?"message":"conversation"},beforeCalling:(e,n)=>{n?ns(n,e):t.showCall=!0},afterCalling:()=>{t.showCall=!1,t.showCallMini=!1},onMinimized:(e,n)=>{t.showCall=!n,t.showCallMini=n},onMessageSentByMe:async e=>{var t;null==(t=null==n?void 0:n.TUIChat)||t.handleMessageSentByMeToView(e)}}}}),IF={class:"CVImg"},MF={class:"home-TUIKit-main"},TF={class:"chat"},CF=(e=>(F("data-v-78a75d5c"),e=e(),V(),e))((()=>P("h2",null,"Welcome to Tabibito Online Chat",-1)));const SF=D(yF,[["render",function(e,t,n,i,r,o){var a,s,c;const u=J("navigation-bar"),l=J("TUISearch"),d=J("TUIConversation"),p=J("TUIChat"),h=J("TUICallKit"),f=J("Drag"),g=J("TUICallKitMini");return w(),A(_,null,[M(u,{class:"chatHead"}),P("div",IF,[P("div",MF,[z(P("div",{class:G((null==(a=e.env)?void 0:a.isH5)?"conversation-h5":"conversation")},[M(l,{class:"search"}),M(d,{style:{background:"linear-gradient(to bottom right, #fafafa, #d9f1f6)"},onCurrent:e.handleCurrentConversation},null,8,["onCurrent"])],2),[[W,!(null==(s=e.env)?void 0:s.isH5)||"conversation"===e.currentModel]]),z(P("div",TF,[M(p,null,{default:K((()=>[CF])),_:1})],512),[[W,!(null==(c=e.env)?void 0:c.isH5)||"message"===e.currentModel]]),M(f,{show:e.showCall,class:"callkit-drag-container",domClassName:"callkit-drag-container"},{default:K((()=>[M(h,{allowedMinimized:!0,allowedFullScreen:!1,beforeCalling:e.beforeCalling,afterCalling:e.afterCalling,onMinimized:e.onMinimized,onMessageSentByMe:e.onMessageSentByMe},null,8,["beforeCalling","afterCalling","onMinimized","onMessageSentByMe"])])),_:1},8,["show"]),M(f,{show:e.showCallMini,class:"callkit-drag-container-mini",domClassName:"callkit-drag-container-mini"},{default:K((()=>[M(g,{style:{position:"static"}})])),_:1},8,["show"])])])],64)}],["__scopeId","data-v-78a75d5c"]]);export{SF as default};
